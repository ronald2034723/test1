var extern=function(){function Bullet(){this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.ttl=0,this.active=!1,this.player=null,this.damage=20,void 0!==BulletActor&&(this.actor=new BulletActor(this))}function Collider(){this.playerCollisionMesh=BABYLON.MeshBuilder.CreateBox("pc",{size:.5,height:.6},scene),this.playerCollisionMesh.position.y=.3,this.playerCollisionMesh.bakeCurrentTransformIntoVertices(),this.playerCollisionMesh.setEnabled(!1),this.wedgeCollisionMesh=BABYLON.MeshBuilder.CreateBox("",{size:1.5},scene),this.wedgeCollisionMesh.position.y=-.75,this.wedgeCollisionMesh.bakeCurrentTransformIntoVertices(),this.wedgeCollisionMesh.rotation.x=-Math.PI/4,this.wedgeCollisionMesh.bakeTransformIntoVertices(this.wedgeCollisionMesh.getWorldMatrix()),this.wedgeCollisionMesh.setEnabled(!1),this.iwedgeCollisionMesh=BABYLON.MeshBuilder.CreateBox("",{size:1.5},scene),this.iwedgeCollisionMesh.position.y=.75,this.iwedgeCollisionMesh.bakeCurrentTransformIntoVertices(),this.iwedgeCollisionMesh.rotation.x=-Math.PI/4,this.iwedgeCollisionMesh.bakeTransformIntoVertices(this.iwedgeCollisionMesh.getWorldMatrix()),this.iwedgeCollisionMesh.setEnabled(!1),this.projectileCollisionBox=BABYLON.MeshBuilder.CreateBox("",{size:.05}),this.projectileCollisionBox.setEnabled(!1)}function Grenade(){this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.ttl=0,this.active=!1,this.player=null,void 0!==GrenadeActor&&(this.actor=new GrenadeActor(this))}function Gun(player,subClass){this.player=player,this.subClass=subClass,this.highPrecision=!1,this.equipTime=25,this.stowWeaponTime=25}function Eggk47(player,meshName){Gun.call(this,player,Eggk47),this.ammo={rounds:30,capacity:30,reload:30,store:240,storeMax:240,pickup:30},this.longReloadTime=210,this.shortReloadTime=180,void 0!==Eggk47Actor&&(this.actor=new Eggk47Actor(this,meshName))}function DozenGauge(player,meshName){Gun.call(this,player,DozenGauge),this.ammo={rounds:2,capacity:2,reload:2,store:24,storeMax:24,pickup:8},this.longReloadTime=155,this.shortReloadTime=155,void 0!==DozenGaugeActor&&(this.actor=new DozenGaugeActor(this,meshName))}function CSG1(player,meshName){Gun.call(this,player,CSG1),this.ammo={rounds:5,capacity:5,reload:5,store:15,storeMax:15,pickup:5},this.hasScope=!0,this.longReloadTime=240,this.shortReloadTime=150,this.highPrecision=!0,void 0!==CSG1Actor&&(this.actor=new CSG1Actor(this,meshName))}function Cluck9mm(player,meshName){Gun.call(this,player,Cluck9mm),this.ammo={rounds:15,capacity:15,reload:15,store:60,storeMax:60,pickup:15},this.longReloadTime=195,this.shortReloadTime=160,void 0!==Cluck9mmActor&&(this.actor=new Cluck9mmActor(this,meshName))}function RPEGG(player,meshName){Gun.call(this,player,RPEGG),this.ammo={rounds:1,capacity:1,reload:1,store:2,storeMax:2,pickup:2},this.longReloadTime=130,this.shortReloadTime=95,void 0!==RPEGGActor&&(this.actor=new RPEGGActor(this,meshName))}function MunitionsManager(){this.bulletPool=new Pool(function(){return new Bullet},200),this.rocketPool=new Pool(function(){return new Rocket},20),this.grenadePool=new Pool(function(){return new Grenade},10)}function Player(data){this.id=data.id,this.name=data.name,this.charClass=data.charClass,this.team=data.team,this.primaryWeaponItem=data.primaryWeaponItem,this.secondaryWeaponItem=data.secondaryWeaponItem,this.shellColor=data.shellColor,this.hatItem=data.hatItem,this.stampItem=data.stampItem,this.x=data.x,this.y=data.y,this.z=data.z,this.dx=data.dx,this.dy=data.dy,this.dz=data.dz,this.controlKeys=data.controlKeys,this.yaw=data.yaw,this.pitch=data.pitch,this.score=data.score,this.kills=data.kills,this.deaths=data.deaths,this.streak=data.streak,this.score=data.score,this.totalKills=data.totalKills,this.totalDeaths=data.totalDeaths,this.bestGameStreak=data.bestGameStreak,this.bestOverallStreak=data.bestOverallStreak,this.shield=data.shield,this.hp=data.hp,this.playing=data.playing,this.weaponIdx=data.weaponIdx,this.corrected={dx:0,dy:0,dz:0,pitch:0,yaw:0},this.corrections=0,this.rofCountdown=0,this.triggerPulled=!1,this.shotsQueued=0,this.reloadsQueued=0,this.roundsToReload=0,this.recoilCountdown=0,this.reloadCountdown=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.equipWeaponIdx=this.weaponIdx,this.shotSpread=0,this.randomSeed=data.randomSeed,this.grenadeCount=1,this.grenadeCapacity=3,this.grenadeCountdown=0,this.grenadesQueued=0,this.jumping=!1,this.lastTouchedGround=1,this.climbing=!1,this.climbingCell={x:0,z:0,ry:0},this.bobble=0,this.stateIdx=0,this.syncStateIdx=0,this.respawnTargetTime=0,this.pauseTargetTime=0,this.ready=!1,this.chatLineCap=3,this.respawnQueued=!1,void 0!==PlayerActor&&(this.actor=new PlayerActor(this)),this.stateBuffer=[];for(var i=0;i<stateBufferSize;i++)this.stateBuffer.push({delta:0,yaw:data.yaw,pitch:data.pitch,fire:!1,jumping:!1,climbing:!1,x:data.x,y:data.y,z:data.z,dx:data.dx,dy:data.dy,dz:data.dz,controlKeys:data.controlKeys});this.changeWeaponLoadout(this.primaryWeaponItem,this.secondaryWeaponItem)}function Pool(constructorFn,size){this.size=0,this.originalSize=size,this.constructorFn=constructorFn,this.objects=[],this.idx=0,this.numActive=0,this.expand(size)}function loadMapMeshes(scene,onComplete){mapMeshes=[null];var barrier=BABYLON.MeshBuilder.CreateBox("SPECIAL.barrier.full.verysoft",{size:1},scene),mat=new BABYLON.StandardMaterial;mat.diffuseColor=BABYLON.Color3.Red(),mat.emissiveColor=BABYLON.Color3.Red(),mat.specularColor=BABYLON.Color3.Black(),mat.wireframe=!0,barrier.material=mat,barrier.setEnabled(!1),mapMeshes.push(barrier);for(var shape=[],i=0;i<=1;i+=.125){var a=-Math.PI/2+Math.PI*i,x=Math.cos(a),y=.5*Math.sin(a+.05)+.5;x=.25*Math.pow(x,1.3),y=.6*Math.pow(y,1.3)-.48,shape.push(new BABYLON.Vector3(x,y,0))}egg=BABYLON.MeshBuilder.CreateLathe("SPECIAL.spawn-blue.none",{shape:shape,tessellation:12},scene);(mat=new BABYLON.StandardMaterial).diffuseColor=new BABYLON.Color3(0,.5,1),mat.specularColor=new BABYLON.Color3(.1,.2,.4),mat.specularPower=8,egg.material=mat,egg.setEnabled(!1),mapMeshes.push(egg);var egg=BABYLON.MeshBuilder.CreateLathe("SPECIAL.spawn-red.none",{shape:shape,tessellation:12},scene);(mat=new BABYLON.StandardMaterial).diffuseColor=new BABYLON.Color3(1,.25,.25),mat.specularColor=new BABYLON.Color3(.4,.3,.3),mat.specularPower=8,egg.material=mat,egg.setEnabled(!1),mapMeshes.push(egg),loadMeshes(scene,["map"],function(mesh){mesh.parent||mapMeshes.push(mesh)},function(){for(var i=1;i<mapMeshes.length;i++){var mesh=mapMeshes[i].getChildMeshes()[0];mesh&&(mapMeshes[i].colliderMesh=mesh)}onComplete()})}function loadObjectMeshes(scene,onComplete){loadMeshes(scene,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","eggExplode","munitions","muzzleFlash","items","reticle","mountains","sky"],null,onComplete)}function loadSounds(scene,onComplete){function catComplete(){33==++loadsComplete&&onComplete()}var options={spatialSound:!0,distanceModel:"exponential",rolloffFactor:1},loadsComplete=0;Sounds.eggk47={fire:new BABYLON.Sound("fire","sound/eggk47/fire.mp3",scene,catComplete,options),dryFire:new BABYLON.Sound("dryFire","sound/eggk47/dry fire.mp3",scene,catComplete,options),cycle:new BABYLON.Sound("cycle","sound/eggk47/full cycle.mp3",scene,catComplete,options),insertMag:new BABYLON.Sound("insertMag","sound/eggk47/insert mag.mp3",scene,catComplete,options),removeMag:new BABYLON.Sound("removeMag","sound/eggk47/remove mag.mp3",scene,catComplete,options)},Sounds.dozenGauge={fire:new BABYLON.Sound("","sound/dozenGauge/fire.mp3",scene,catComplete,options),open:new BABYLON.Sound("","sound/dozenGauge/open.mp3",scene,catComplete,options),load:new BABYLON.Sound("","sound/dozenGauge/load.mp3",scene,catComplete,options),close:new BABYLON.Sound("","sound/dozenGauge/close.mp3",scene,catComplete,options)},Sounds.csg1={fire:new BABYLON.Sound("","sound/csg1/fire.mp3",scene,catComplete,options),pullAction:new BABYLON.Sound("","sound/csg1/pull action.mp3",scene,catComplete,options),releaseAction:new BABYLON.Sound("","sound/csg1/release action.mp3",scene,catComplete,options)},Sounds.cluck9mm={fire:new BABYLON.Sound("fire","sound/cluck9mm/fire.mp3",scene,catComplete,options),removeMag:new BABYLON.Sound("","sound/cluck9mm/remove mag.mp3",scene,catComplete,options),insertMag:new BABYLON.Sound("","sound/cluck9mm/insert mag.mp3",scene,catComplete,options)},Sounds.hammerClick=new BABYLON.Sound("","sound/hammerClick.mp3",scene,catComplete),Sounds.ammo=new BABYLON.Sound("","sound/ammo.mp3",scene,catComplete),Sounds.shellBurst=new BABYLON.Sound("","sound/shellBurst.mp3",scene,catComplete,options),Sounds.hit=new BABYLON.Sound("","sound/hit.mp3",scene,catComplete,options),Sounds.endRound=new BABYLON.Sound("","sound/rooster.mp3",scene,catComplete),Sounds.grenade={explode:new BABYLON.Sound("","sound/grenade.mp3",scene,catComplete,options),beep:new BABYLON.Sound("","sound/grenadeBeep.mp3",scene,catComplete,options),pin:new BABYLON.Sound("","sound/grenadePin.mp3",scene,catComplete,options)},Sounds.death=[];for(var i=1;i<11;i++)Sounds.death.push(new BABYLON.Sound("","sound/death/scream"+i+".mp3",scene,catComplete,options))}function loadMaterials(scene){var mat;if(mat=new BABYLON.StandardMaterial("bullet",scene),mat.emissiveColor=new BABYLON.Color3(1,1,1),shadowGen){definesList=["#define RECEIVESHADOWS"];engineCaps.textureFloat&&definesList.push("#define SHADOWFULLFLOAT")}else var definesList=[];definesList.push("#define DIRT"),mat=new BABYLON.ShaderMaterial("map",scene,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:definesList}),shadowGen&&(mat.setTexture("shadowSampler",shadowGen.getShadowMapForRendering()),mat.setMatrix("shadowLightMat",shadowGen.getTransformMatrix()),mat.setVector3("shadowParams",shadowGen.getDarkness(),shadowGen.getShadowMap().getSize().width,shadowGen.bias)),mat.onBind=function(mesh){var effect=mesh.material.getEffect();effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor)},(mat=new BABYLON.ShaderMaterial("mapNoShadow",scene,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:["#define DIRT"]})).onBind=function(mesh){var effect=mesh.material.getEffect(),scene=mesh.getScene();effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor)},(mat=new BABYLON.ShaderMaterial("standard",scene,"standard",{attributes:["position","normal","color","uv",BABYLON.VertexBuffer.MatricesIndicesKind,BABYLON.VertexBuffer.MatricesWeightsKind],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","colorMult"],defines:["#define COLORMULT"]})).onBind=function(mesh){var effect=mesh.material.getEffect(),scene=mesh.getScene();if(effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor),effect.setColor3("colorMult",mesh.colorMult||BABYLON.Color3.White()),mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){var matrices=mesh.skeleton.getTransformMatrices(mesh);matrices&&effect&&effect.setMatrices("mBones",matrices)}},(mat=new BABYLON.ShaderMaterial("standardInstanced",scene,"standard",{attributes:["position","normal","color","uv","world0","world1","world2","world3"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:["#define INSTANCES"]})).onBind=function(mesh){var effect=mesh.material.getEffect(),scene=mesh.getScene();effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor)},(mat=new BABYLON.ShaderMaterial("eggShell",scene,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","hp","cameraPosition","outlineColor","colorMult","stampOffset"],defines:["#define EGGSHELL"]})).onBind=function(mesh){var effect=mesh.material.getEffect(),scene=mesh.getScene();effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor),effect.setFloat("hp",mesh.player.hp/100),effect.setColor3("colorMult",mesh.colorMult||BABYLON.Color3.White()),effect.setFloat3("cameraPosition",scene.activeCamera.globalPosition.x,scene.activeCamera.globalPosition.y,scene.activeCamera.globalPosition.z),effect.setColor4("outlineColor",mesh.outlineColor,mesh.outlineColor.a),effect.setFloat2("stampOffset",mesh.stampU,mesh.stampV)},(mat=new BABYLON.ShaderMaterial("emissive",scene,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","emissiveColor"],defines:["#define FLASH"]})).onBind=function(mesh){var effect=mesh.material.getEffect(),scene=mesh.getScene();effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor),effect.setColor3("emissiveColor",mesh.emissiveColor||BABYLON.Color3.Black())},(mat=new BABYLON.StandardMaterial("wireframe",scene)).wireframe=!0,(mat=new BABYLON.StandardMaterial("normalBackface",scene)).diffuseColor=new BABYLON.Color3(.5,.5,.5),mat.ambientColor=new BABYLON.Color3(.5,.5,.5),mat.specularColor=new BABYLON.Color3(0,0,0),mat.backFaceCulling=!1,mat.twoSidedLighting=!0,(mat=new BABYLON.StandardMaterial("muzzleFlash",scene)).emissiveColor=BABYLON.Color3.White(),(mat=new BABYLON.StandardMaterial("ui",scene)).disableLighting=!0,mat.emissiveColor=BABYLON.Color3.White(),mat.fogEnabled=!1,(mat=new BABYLON.StandardMaterial("eggWhite",scene)).disableLighting=!0,mat.alpha=.8,mat.emissiveColor=BABYLON.Color3.White(),(mat=new BABYLON.StandardMaterial("eggYolk",scene)).disableLighting=!0,mat.emissiveColor=BABYLON.Color3.White()}function loadMeshes(scene,meshNames,onMeshLoaded,onComplete){for(var meshCount=meshNames.length,that=this,mat=scene.getMaterialByName("standard"),idx=0;idx<meshCount;idx++){var rootUrl="models/",path=meshNames[idx]+".babylon";if("undefined"==typeof window){var data=fs.readFileSync(path,"utf8");path="data:"+(data=data.replace(/\r?\n|\r/g,"")),rootUrl=""}BABYLON.SceneLoader.ImportMesh("",rootUrl,path,scene,function(meshes,partcileSystems,skeletons){try{for(var m=0;m<meshes.length;m++){var mesh=meshes[m];mesh.setMaterial&&mesh.setMaterial(mat),mesh.setEnabled(!1),mesh.isPickable=!1,onMeshLoaded&&onMeshLoaded(mesh)}0==--meshCount&&onComplete&&onComplete.call(that)}catch(e){console.log(e)}})}}function Rocket(){this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.ttl=0,this.active=!1,this.player=null,this.damage=20,void 0!==RocketActor&&(this.actor=new RocketActor(this))}function isBadWord(word){var str=(word=" "+word+" ").toLowerCase().replace(/[^a-zA-Z0-9|!\|@|$|;|¡]/g,"").replace(/6|g/g,"9").replace(/b/g,"6").replace(/\||l|i|1|;|¡/g,"!").replace(/e/g,"3").replace(/a|@/g,"4").replace(/o/g,"0").replace(/s|\$/g,"5").replace(/t/g,"7").replace(/z/g,"2").replace(/7h3|my|y0ur|7h3!r|h!5|h3r/g,""),i1=str.search(/( 94y | cum| 455 )/);str.replace(/ /g,"");var reg=/(4fr!c4n|kn336r0|5ch00!5h007|73rr0r!5t|卐|卍|qu33r|d!ck|w4nk|p!55|7357!c|735735|64!!5|nu75|nu72|j3w|k!k3|r374r|4u7!5|d0wn55|6006|8d|p0rn|5w4!!0w|347m3|347my|d!k|0r4!|5p0093|fuk|j!2|5u!c!d|m4573r6|5p0063|5p3rm|p3nu5|pu55y|6u7753x|fux|6u77h0!3|4n4!|4nu5|k!!!b!4ck5|murd3rb!4ck5|h!7!3r|w3764ck|49!n4|94y|455h0!3|5uck|j3w|5p!c|ch!nk|n!994|n!993|n!663|n!994|n!664|5h!7|6!7ch|fuck|cun7|kkk|wh0r3|f49|7w47|p3n!|r4p3w0m|r4p39!r|r4p!57|r4p3r|r4p!n|c0ck|7!75|900k|d!ckh34d)/,i2=str.search(reg);str.replace(/(.)(?=\1)/g,"");var i3=str.search(reg);return i1>-1||i2>-1||i3>-1}function showBigAd(){bigAdIdx=Date.now()%bigAds.length,document.getElementById("bigAd").style.display="block",document.getElementById("bigAdImg").src="img/ads/large/"+bigAds[bigAdIdx].image;document.getElementById("bigAdLink");bigAds[bigAdIdx].link&&(document.getElementById("bigAdLink").href=bigAds[bigAdIdx].link,document.getElementById("bigAdLink").target="_window"),bigAds[bigAdIdx].linksToItemId&&(document.getElementById("bigAdLink").href="javascript: extern.openItemInCustomizer("+bigAds[bigAdIdx].linksToItemId+");"),ga("send","event",{eventCategory:"Big ad",eventAction:"show",eventLabel:bigAds[bigAdIdx].label}),bigAdTimeout=setTimeout(function(){hideBigAd()},15e3)}function hideBigAd(){clearTimeout(bigAdTimeout),document.getElementById("bigAd").style.display="none",loadBannerAd()}function preLoadHouseBannerAd(){smallAdIdx=Date.now()%smallAds.length,document.getElementById("houseAd_300x250").src="img/ads/small/"+smallAds[smallAdIdx].image}function loadBannerAd(){if("none"==document.getElementById("overlay").style.display)if(document.getElementById("placeholder_300x250").style.display="none",document.getElementById("multisizeBannerAdPlaceholder").style.display="none",inGame&&betweenRounds)displayBannerAd("bannerAdContainer","houseAd_300x250"),ga("send","event",{eventCategory:"House banner ad",eventAction:"show",eventLabel:smallAds[smallAdIdx].label});else if(inGame)displayBannerAd("gameAdContainer",tag="shellshock-io_multisize"),aipMultisizeBannerDisplayed?aiptag.cmd.display.push(function(){aipRefreshBannerForTag(tag)}):(aiptag.cmd.display.push(function(){aipDisplayBannerForTag(tag)}),aipMultisizeBannerDisplayed=!0);else{if(100*Math.random()<=smallAd_HouseAdPercentChance)return void displayBannerAd("bannerAdContainer","houseAd_300x250");var tag="shellshock-io_300x250";displayBannerAd("bannerAdContainer",tag),aipBannerDisplayed?aiptag.cmd.display.push(function(){aipRefreshBannerForTag(tag)}):(aiptag.cmd.display.push(function(){aipDisplayBannerForTag(tag)}),aipBannerDisplayed=!0)}}function displayBannerAd(parentContainerId,id){var el=document.getElementById(parentContainerId);el.style.display="block";for(var i=0;i<el.children.length;i++)el.children[i].id==id?(document.getElementById(id).style.display="block",lastBannerLoaded=id):document.getElementById(el.children[i].id).style.display="none"}function hideBannerAd(){hideBannerAdInContainer("bannerAdContainer","placeholder_300x250")}function hideMultisizeBannerAd(){hideBannerAdInContainer("gameAdContainer","multisizeBannerAdPlaceholder")}function hideBannerAdInContainer(parentContainerId,placeholderId){for(var el=document.getElementById(parentContainerId),i=0;i<el.children.length;i++)document.getElementById(el.children[i].id).style.display="none";document.getElementById(placeholderId).style.display="block"}function showBannerAd(){showBannerAdWithPlaceholder("placeholder_300x250")}function showMultisizeBannerAd(){showBannerAdWithPlaceholder("multisizeBannerAdPlaceholder")}function showBannerAdWithPlaceholder(placeholderId){lastBannerLoaded?(document.getElementById(lastBannerLoaded).style.display="block",document.getElementById(placeholderId).style.display="none"):document.getElementById(placeholderId).style.display="block"}function aipDisplayBannerForTag(tag){try{aipDisplayTag.display(tag)}catch(e){console.log(e)}}function aipRefreshBannerForTag(tag){try{aipDisplayTag.refresh(tag)}catch(e){console.log(e)}}function playVideoAd(){lastAdProvider=0,queueVideoAd=!1,console.log("AIP preroll"),showDarkOverlay(),aiptag.cmd.player.push(function(){try{aipPrerollPlayer.startPreRoll()}catch(e){console.log(e)}}),localStorage.setItem("lastPreRoll",Date.now())}function isTimeToPlayVideoAd(){var lastPreRoll=getStoredNumber("lastPreRoll",Date.now()),timeout=42e4;return adTest&&(timeout=2e3),timesPlayed>1&&deaths>1&&Date.now()>lastPreRoll+timeout}function BulletActor(bullet){this.bullet=bullet,this.delayFrames=0,this.mesh=scene.getMeshByName("bullet").createInstance(""),this.mesh.setEnabled(!1)}function loadResources(scene,onComplete){Sounds={},loadMaterials(scene),loadSounds(scene,function(){loadObjectMeshes(scene,function(){loadMapMeshes(scene,function(){onComplete()})})})}function setupLights(){gameScene.ambientColor=new BABYLON.Color3(.2,.2,.2),gameScene.fogMode=BABYLON.Scene.FOGMODE_EXP,gameScene.fogColor=new BABYLON.Color4(.5,.55,.6,1),gameScene.fogDensity=.025,gameScene.clearColor=BABYLON.Color3.Black();var light=new BABYLON.DirectionalLight("",new BABYLON.Vector3(0,-1,0),gameScene);light.intensity=1.2,light.autoUpdateExtends=!1,light.shadowMinZ=.05,light.shadowMaxZ=40,light.shadowFrustumSize=15,(shadowGen=new BABYLON.ShadowGenerator(1024,light)).forceBackFacesOnly=!0;var hemLight=new BABYLON.HemisphericLight("light2",new BABYLON.Vector3(-.25,1,-.5),gameScene);return hemLight.intensity=.8,hemLight=new BABYLON.HemisphericLight("light3",new BABYLON.Vector3(0,-1,0),gameScene),hemLight.intensity=.25,light}function beginAnimation(mesh,start,end,loop,speed){gameScene.beginAnimation(mesh,start,end,loop,speed);for(var children=mesh.getChildMeshes(),i=0;i<children.length;i++)gameScene.beginAnimation(children[i],start,end,loop,speed)}function resetGame(){for(var i=0;i<playerLimit;i++){var player=players[i];player&&(player.removeFromPlay(),player.score=0,player.kills=0,player.deaths=0,player.streak=0,player.bestGameStreak=0)}}function openGameMenu(){escPressed=!1,document.pointerLockElement?document.exitPointerLock():showGameMenu()}function showGameMenu(){var helpOpen="none"!=document.getElementById("help").style.display,menuEl=document.getElementById("gameMenu");inGame&&"none"==menuEl.style.display&&!helpOpen&&timeout.set(function(){loadBannerAd()},250),menuEl.style.display="block",document.getElementById("gameplayTip").innerHTML=getRandomGameplayTip(),showCornerButtons(),removeCanvasListeners(),document.getElementById("grenadeThrowContainer").style.visibility="hidden",document.getElementById("weaponBox").style.display="none",document.getElementById("health").style.display="none",document.getElementById("killTicker").style.display="none",console.log("is help open: "+helpOpen),helpOpen||(document.getElementById("inGameAd").style.display="block"),reticle.hide()}function hideGameMenu(){me&&(document.getElementById("gameMenu").style.display="none",document.getElementById("gameSummary").style.visibility="hidden",document.getElementById("ffaFinal").style.display="none",document.getElementById("teamFinal").style.display="none",timedGame&&betweenRounds||(document.getElementById("deathBox").style.display="none",document.getElementById("weaponBox").style.display="block",document.getElementById("health").style.display="block",document.getElementById("killTicker").style.display="block",document.getElementById("playerList").style.display="block",chatting&&chatInEl.focus(),doFirstPersonCamera(),reticle.show()),hideMultisizeBannerAd(),document.getElementById("gameAdContainer").style.display="none",hideCornerButtons(),addCanvasListeners())}function showContinueDialog(){hideGameMenu(),document.getElementById("gameClock").style.display="none",openAlertDialog("OVER-EASY","Continue to the next round?",{label:"<h3>▶ YES!&nbsp;</h3>",width:"8em",height:"2.5em",onclick:continueToSummary},{label:"<h3>No</h3>",width:"4em",height:"2.5em",onclick:showMainMenuConfirm})}function continueToSummary(){closeAlertDialog(),isTimeToPlayVideoAd()?(playVideoAd(),document.exitPointerLock()):(openGameMenu(),showGameSummary(),resetGame())}function showGameSummary(){document.getElementById("gameSummary").style.visibility="visible",document.getElementById("playerList").style.display="none"}function prepareGameSummary(){for(var playerIdxs=[[],[],[]],i=0;i<playerLimit;i++)players[i]&&playerIdxs[players[i].team].push(i);for(team=0;team<3;team++){teamSummaryEls[team].style.display="none",playerIdxs[team].sort(function(a,b){var diff=players[b].score-players[a].score;return 0==diff&&0==(diff=players[a].kills-players[b].kills)&&(diff=players[a].deaths-players[b].deaths),diff});var rowsEl=teamSummaryEls[team];for(i=0;i<playerIdxs[team].length;i++){var player=players[playerIdxs[team][i]];if(player){var row=rowsEl.children[i];row.style.display="flex",player.id==meId?row.style.color="#ff0":row.style.color=teamColors.text[team],row.children[0].innerText=i+1,row.children[1].innerText=player.name,row.children[2].innerText=player.score,row.children[3].innerText=player.kills,row.children[4].innerText=player.deaths,row.children[5].innerText=player.bestGameStreak}}for(;i<rowsEl.children.length;)rowsEl.children[i].style.display="none",i++}var teamScores=getTeamScores();if(gameType==GameType.teams){var losingTeam=1==(teamScores.leader||lastLeadingTeam)?2:1;teamSummaryEls[losingTeam].parentNode.appendChild(teamSummaryEls[losingTeam]);for(var team=1;team<3;team++)teamSummaryEls[team].style.display="flex",document.getElementById("teamScore"+team).innerText=teamScores.score[team];document.getElementById("teamFinal").style.display="flex",document.getElementById("ffaFinal").style.display="none"}else teamSummaryEls[0].style.display="flex",document.getElementById("teamScore0").innerText=teamScores.score[0],document.getElementById("teamFinal").style.display="none",document.getElementById("ffaFinal").style.display="flex"}function setRespawnTime(sec){respawnTime=Math.max(sec,respawnTime);var button=document.getElementById("goButton");button.className="ssbutton grey";var label=document.getElementById("goButtonLabel");label.innerHTML=respawnTime,respawnInterval&&interval.clear(respawnInterval),respawnInterval=interval.set(function(){respawnTime--,label.innerHTML=respawnTime,respawnTime<=0&&inGame&&(respawnTime=-1,interval.clear(respawnInterval),button.className="ssbutton green",label.innerHTML="▶ PLAY!&nbsp;",doMapOverviewCamera())},1e3)}function requestRespawn(){canvas.requestPointerLock();var output=new Comm.output(1);output.packInt8(CommCode.requestRespawn),ws.send(output.buffer),console.log("respawn() requests respawn from server"),document.getElementById("help").style.display="none"}function onCanvasMouseDown(event){inputDown("MOUSE "+event.button),1==event.button&&event.preventDefault()}function onCanvasMouseUp(event){inputUp("MOUSE "+event.button)}function onCanvasMouseMove(event){if(document.pointerLockElement&&me&&me.hp>0){var mult=5e-4*settings.mouseSensitivity+.001;me.actor.scope&&(mult*=.3);var mx=event.movementX;lastMouseMovement.x&&Math.sign(mx)!=Math.sign(lastMouseMovement.x)&&(mx=0),lastMouseMovement.x=mx;var my=event.movementY;lastMouseMovement.y&&Math.sign(my)!=Math.sign(lastMouseMovement.y)&&(my=0),lastMouseMovement.y=my,me.yaw=Math.radAdd(me.yaw,mx*mult),me.pitch=Math.clamp(me.pitch+my*settings.mouseInvert*mult,-1.5,1.5)}}function addExplosionSprite(manager,animSpeed,x,y,z,dx,dy,dz,size){var s=new BABYLON.Sprite("",manager);s.animSpeed=animSpeed,s.position.x=x,s.position.y=y,s.position.z=z,s.baseSize=size,s.dx=dx,s.dy=dy,s.dz=dz,s.df=0,s.anim=0,s.color.r=smokeColor.r,s.color.g=smokeColor.g,s.color.b=smokeColor.b,s.color.a=smokeColor.a}function addExplosion(x,y,z,damage){for(var i=0;i<Math.floor(damage/2);i++){var animSpeed=.04*Math.random()+.02,size=1*Math.random()+.5,se=.5*(.9-size),dx=(2*Math.random()-1)*se,dy=(2*Math.random()-1)*se+.1,dz=(2*Math.random()-1)*se;addExplosionSprite(explosionSmokeManager,animSpeed,x,y,z,dx,dy,dz,size),addExplosionSprite(explosionFireManager,animSpeed,x,y,z,dx,dy,dz,size)}if(me){var d=Math.length3(me.x-x,me.y-y,me.z-z);d<5&&(shake=Math.min(7,shake+Math.clamp(damage-25*d,0,5)))}}function lerp(colors,p,ref){for(var i=colors.length-1;i>=0;i--)if(p>=colors[i].pos)return void BABYLON.Color4.LerpToRef(colors[i].color,colors[i+1].color,(p-colors[i].pos)*(1/(colors[i+1].pos-colors[i].pos)),ref)}function updateExplosions(manager,delta){for(var i=0;i<manager.sprites.length;i++){var s=manager.sprites[i];s.size=s.baseSize*(1-s.anim),manager==explosionFireManager&&lerp(fireColors,s.anim,s.color),s.position.x+=s.dx,s.position.y+=s.dy,s.position.z+=s.dz;var res=collider.projectileCollidesWithMap(new BABYLON.Vector3(s.position.x,s.position.y,s.position.z),new BABYLON.Vector3(s.dx,s.dy,s.dz));res&&!mapMeshes[res.cell.idx].softness?(s.dx=0,s.dy=0,s.dz=0):s.position.y+=.01*Math.cos(s.anim*Math.PI),s.dx*=.7,s.dy*=.7,s.dz*=.7,s.anim+=delta*s.animSpeed+.01,s.animSpeed*=.85,s.anim>=1&&s.dispose()}}function onLoadingComplete(){console.log("onLoadingComplete"),buildMap(onMapComplete)}function onMapComplete(){try{if(collider=new Collider,scope=new Scope,hitIndicator=new HitIndicator,reticle=new Reticle,scene.getMeshByName("muzzleFlash").material=scene.getMaterialByName("muzzleFlash"),scene.getMeshByName("bullet").material=scene.getMaterialByName("bullet"),scene.getMeshByName("eggWhite").material=scene.getMaterialByName("eggWhite"),scene.getMeshByName("eggYolk").material=scene.getMaterialByName("eggYolk"),scene.getMeshByName("grenade").material=scene.getMaterialByName("emissive"),scene.getMeshByName("ammo").material=scene.getMaterialByName("standardInstanced"),scene.getMeshByName("grenadeItem").material=scene.getMaterialByName("standardInstanced"),munitionsManager=new MunitionsManager,itemManager=new ItemManager,nameTexture=new BABYLON.DynamicTexture("",2048,gameScene,!0,2),nameSprites=new BABYLON.SpriteManager("","",24,{width:512,height:256},gameScene),nameSprites.fogEnabled=!1,nameSprites.texture=nameTexture,bulletHoleManager=new BABYLON.SpriteManager("","img/bulletHoles.png?v=1",200,32,gameScene),bulletHoleManager.fogEnabled=!0,bulletHoleManager.addHole=function(f,x,y,z){var s=new BABYLON.Sprite("",this);s.position.x=x,s.position.y=y,s.position.z=z,s.angle=6.282*Math.random(),s.cellIndex=f,s.size=.03,200==this.sprites.length&&this.sprites[0].dispose()},explosionSmokeManager=new BABYLON.SpriteManager("","img/explosion2.png?v=3",500,128,gameScene),explosionSmokeManager.fogEnabled=!0,explosionSmokeManager.noAlphaTest=!0,explosionFireManager=new BABYLON.SpriteManager("","img/explosion2.png?v=3",500,128,gameScene),explosionFireManager.fogEnabled=!0,explosionFireManager.blendMode=BABYLON.Engine.ALPHA_ADD,playOffline)meId=0,addPlayer({id:0,name:"Test",charClass:0,team:0,primaryWeaponItem:playerAccount.getPrimaryWeapon(),secondaryWeaponItem:playerAccount.getSecondaryWeapon(),shellColor:0,hatItem:null,stampItem:null,score:0,kills:0,deaths:0,streak:0,totalKills:0,totalDeaths:0,bestGameStreak:0,bestOverallStreak:0,x:mapTest.x+.5,y:mapTest.y-.32,z:mapTest.z+.5,dx:0,dy:0,dz:0,frame:0,pitch:mapTest.pitch,yaw:mapTest.yaw,shield:0,hp:0,playing:!1,weaponIdx:0,controlKeys:0,randomSeed:0}),players[meId].hp=100,doFirstPersonCamera(),startRendering(),addCanvasListeners();else{mapOverview=!0,setUpSocket();var output=new Comm.output(2);output.packInt8(CommCode.clientReady),output.packInt8(CommCode.ping),pingStartTime=Date.now(),ws.send(output.buffer)}}catch(e){console.log(e)}}function doMapOverviewCamera(){camera.parent=null,camera.position=new BABYLON.Vector3(0,map.height+1,0),camera.lockedTarget=null,camera.setTarget(new BABYLON.Vector3(map.width/2,map.height/4,map.depth/2)),mapOverview=!0}function doFirstPersonCamera(){camera.position=BABYLON.Vector3.Zero(),camera.rotation=BABYLON.Vector3.Zero(),camera.rotationQuaternion=BABYLON.Quaternion.Zero(),camera.parent=me.actor.eye,camera.lockedTarget=null,mapOverview=!1}function startRendering(){hideDarkOverlay(),showGameDom(),resize(),captureKeys(),mapOverview&&doMapOverviewCamera(),gameScene.registerBeforeRender(function(){update(),me&&(light.position.x=me.x,light.position.y=me.y+2,light.position.z=me.z)}),engine.runRenderLoop(function(){gameScene.render()})}function setUpSocket(){ws.onmessage=function(e){for(var input=new Comm.input(e.data);input.isMoreDataAvailable();){var cmd=input.unPackInt8U();switch(cmd){case CommCode.pause:playerId=input.unPackInt8U();(player=players[playerId])&&player.removeFromPlay();break;case CommCode.clientReady:console.log("CommCode.clientReady received"),roundLength=input.unPackInt16U(),roundEndTime=input.unPackInt32U(),roundRestartTime=input.unPackInt32U(),roundLength>0?(timedGame=!0,roundEndTime>0?(document.getElementById("gameClock").style.display="block",roundEndTime+=Date.now()):roundRestartTime>0?(document.getElementById("gameClock").style.display="none",document.getElementById("goButton").className="ssbutton grey",document.getElementById("goButtonLabel").innerText="Wait...",document.getElementById("playerList").style.display="none",setRespawnTime(Math.floor(roundRestartTime/1e3))):respawnTime=-1):(timedGame=!1,respawnTime=-1),openGameMenu(),startRendering(),createPrivateGame&&inviteFriends();break;case CommCode.addPlayer:var id=input.unPackInt8U(),name=input.unPackString(),charClass=input.unPackInt8U();id>17&&debugArray.push("playerId out of bounds: "+id+", "+name);var playerData={id:id,name:name,charClass:charClass,team:input.unPackInt8U(),primaryWeaponItem:catalog.findItemBy8BitItemId(ItemType.Primary,charClass,input.unPackInt8U()),secondaryWeaponItem:catalog.findItemBy8BitItemId(ItemType.Secondary,charClass,input.unPackInt8U()),shellColor:input.unPackInt8U(),hatItem:catalog.findItemBy8BitItemId(ItemType.Hat,charClass,input.unPackInt8U()),stampItem:catalog.findItemBy8BitItemId(ItemType.Stamp,charClass,input.unPackInt8U()),x:input.unPackFloat(),y:input.unPackFloat(),z:input.unPackFloat(),dx:input.unPackFloat(),dy:input.unPackFloat(),dz:input.unPackFloat(),yaw:input.unPackRadU(),pitch:input.unPackRad(),score:input.unPackInt32U(),kills:input.unPackInt16U(),deaths:input.unPackInt16U(),streak:input.unPackInt16U(),totalKills:input.unPackInt32U(),totalDeaths:input.unPackInt32U(),bestGameStreak:input.unPackInt16U(),bestOverallStreak:input.unPackInt16U(),shield:input.unPackInt8U(),hp:input.unPackInt8U(),playing:input.unPackInt8U(),weaponIdx:input.unPackInt8U(),controlKeys:input.unPackInt8U(),randomSeed:input.unPackInt16U()};players[playerData.id]||(meId==playerData.id||(playerData.name=playerData.name.replace(/<|>/g,""),0==playerData.name.length?playerData.name="Anonymous":(playerData.name=fixStringWidth(playerData.name),isBadWord(playerData.name)&&(playerData.name=randomName()))),addPlayer(playerData));break;case CommCode.removePlayer:removePlayer(playerId=input.unPackInt8U());break;case CommCode.roundEnd:console.log("END ROUND"),prepareGameSummary(),betweenRounds=!0,document.getElementById("help").style.display="none",document.getElementById("goButton").className="ssbutton grey",document.getElementById("goButtonLabel").innerText="Wait...",Sounds.endRound.play(),timeout.set(showContinueDialog,3e3),setRespawnTime(NextRoundTimeout);break;case CommCode.roundStart:console.log("START ROUND"),betweenRounds=!1,document.getElementById("gameClock").style.display="block",roundEndTime=Date.now()+1e3*roundLength;break;case CommCode.spawnItem:var id=input.unPackInt16U(),kind=input.unPackInt8U(),x=input.unPackFloat(),y=input.unPackFloat(),z=input.unPackFloat();itemManager.spawnItem(id,kind,x,y,z);break;case CommCode.collectItem:var playerId=input.unPackInt8U(),kind=input.unPackInt8U(),applyToWeaponIdx=input.unPackInt8U(),id=input.unPackInt16U();itemManager.collectItem(kind,id),playerId==meId&&me.collectItem(kind,applyToWeaponIdx);break;case CommCode.die:var killedPlayerName,killedId=input.unPackInt8U(),byId=input.unPackInt8U(),rs=input.unPackInt8U(),killedPlayer=players[killedId],byPlayer=players[byId];if(killedPlayer){killedPlayerName=killedPlayer.name;var pos=new BABYLON.Vector3(killedPlayer.x,killedPlayer.y+.32,killedPlayer.z);killedPlayer.actor.deathSound.setPosition(pos),killedPlayer.actor.deathSound.play();var soundIdx=Math.randomInt(0,Sounds.death.length);Sounds.death[soundIdx].setPosition(pos),Sounds.death[soundIdx].play(),testing||(killedPlayer.actor.explodeMesh.setEnabled(!0),killedPlayer.actor.whiteMesh.setEnabled(!0),killedPlayer.actor.yolkMesh.setEnabled(!0),beginAnimation(killedPlayer.actor.explodeMesh,0,50,!1,1),gameScene.beginAnimation(killedPlayer.actor.whiteMesh,0,50,!1,1),gameScene.beginAnimation(killedPlayer.actor.yolkMesh,0,56,!1,1),shellFragBurst(killedPlayer.actor.mesh,200,1)),killedPlayer.die(),killedPlayer.actor.mesh.position.x=killedPlayer.x,killedPlayer.actor.mesh.position.y=killedPlayer.y,killedPlayer.actor.mesh.position.z=killedPlayer.z}else killedPlayerName="N/A";var byPlayerName;if(byPlayer?(byPlayerName=byPlayer.name,byPlayer.isDead()||(byPlayer.scoreKill(),byId==meId&&((el=document.getElementById("bestStreak")).innerText="BEST STREAK: "+byPlayer.bestOverallStreak),byId==meId&&(kills++,bestOverallStreak=Math.max(bestOverallStreak,byPlayer.streak)))):byPlayerName="N/A",killedId!=meId){if(byId==meId){var killBox=document.getElementById("killBox");killBox.style.display="block",document.getElementById("KILLED_NAME").innerText=killedPlayerName;var streakEl=document.getElementById("KILL_STREAK");me.streak>1?streakEl.innerText=me.streak+"-KILL STREAK":streakEl.innerText="";var scale=1.5,scaleInterval=interval.set(function(){killBox.style.transform="scale("+scale+","+scale+")",(scale-=.05)<=1&&(scale=1,interval.clear(scaleInterval))},33);killDisplayTimeout=timeout.set(function(){inGame&&(killBox.style.display="none")},4e3),playerAccount.isLoggedIn&&(playerAccount.currentBalance+=Reward.perKill,updateCurrentBalance())}}else{deaths++,camera.parent=null,camera.position=new BABYLON.Vector3(me.actor.mesh.position.x,me.actor.mesh.position.y+.2,me.actor.mesh.position.z),byPlayer&&(camera.lockedTarget=byPlayer.actor.bodyMesh),setRespawnTime(rs),removeCanvasListeners(),document.getElementById("KILLED_BY_NAME").innerText=byPlayerName;var deathBox=document.getElementById("deathBox");deathBox.style.display="block",console.log("CommCode.die displays deathBox");var scale=2,scaleInterval=interval.set(function(){deathBox.style.transform="scale("+scale+","+scale+")",(scale-=.05)<=1&&inGame&&(interval.clear(scaleInterval),scale=1)},33);timeout.set(function(){inGame&&(deathBox.style.display="none",openGameMenu())},3e3)}byPlayer&&killedPlayer&&addKillText(byPlayer,killedPlayer),rebuildPlayerList();break;case CommCode.chat:var playerId=input.unPackInt8U(),text=input.unPackString(),player=players[playerId];chatParser.innerHTML=text,text=chatParser.textContent.trim(),player&&text.length>0&&!isBadWord(text)&&text.indexOf("<")<0&&addChat(text,player);break;case CommCode.jump:id=input.unPackInt8U();if(!(player=players[id]))break;player.jump();break;case CommCode.sync:var id=input.unPackInt8U(),stateIdx=input.unPackInt8U(),x=input.unPackFloat(),y=input.unPackFloat(),z=input.unPackFloat(),climbing=input.unPackInt8U();if(!(player=players[id])){for(i=0;i<FramesBetweenSyncs;i++)input.unPackInt8U(),input.unPackRadU(),input.unPackRad();break}var oldx=player.x,oldy=player.y,oldz=player.z,olddx=player.dx,olddy=player.dy,olddz=player.dz,oldYaw=player.yaw,oldPitch=player.pitch,wasJumping=player.jumping,wasClimbing=player.climbing;if(id==meId){for(i=0;i<FramesBetweenSyncs;i++)input.unPackInt8U(),input.unPackRadU(),input.unPackRad();var i=stateIdx,state=player.stateBuffer[i];player.x=x,player.y=y,player.z=z,player.dx=state.dx,player.dy=state.dy,player.dz=state.dz,player.climbing=state.climbing,player.jumping=state.jumping;for(var oldKeys=me.controlKeys;i!=player.stateIdx;i=Math.mod(i+1,stateBufferSize))state=player.stateBuffer[i],player.controlKeys=state.controlKeys,player.yaw=state.yaw,state.jump&&player.jump(),player.update(state.delta,!0),player.stateBuffer[i].x=player.x,player.stateBuffer[i].y=player.y,player.stateBuffer[i].z=player.z,player.stateBuffer[i].dx=player.dx,player.stateBuffer[i].dy=player.dy,player.stateBuffer[i].dz=player.dz,player.stateBuffer[i].jumping=player.jumping;var dist=Math.length3(player.x-oldx,player.y-oldy,player.z-oldz);dist<.2?(dist>.02&&(player.corrections=FramesBetweenSyncs,player.corrected.dx=player.x-oldx,player.corrected.dy=player.y-oldy,player.corrected.dz=player.z-oldz),player.x=oldx,player.y=oldy,player.z=oldz,player.dx=olddx,player.dy=olddy,player.dz=olddz):player.corrections=0,player.jumping=wasJumping,player.climbing=wasClimbing,wasJumping&&(player.corrected.dy=0,player.y=oldy,player.dy=olddy),player.yaw=oldYaw,player.pitch=oldPitch,player.controlKeys=oldKeys}else{player.stateIdx=0;for(i=0;i<FramesBetweenSyncs;i++)player.stateBuffer[i].controlKeys=input.unPackInt8U(),player.stateBuffer[i].yaw=input.unPackRadU(),player.stateBuffer[i].pitch=input.unPackRad();player.x=x,player.jumping||(player.y=y),player.z=z,player.climbing=climbing}break;case CommCode.fire:id=input.unPackInt8U();tv1.x=input.unPackFloat(),tv1.y=input.unPackFloat(),tv1.z=input.unPackFloat(),tv2.x=input.unPackFloat(),tv2.y=input.unPackFloat(),tv2.z=input.unPackFloat();var seed=input.unPackInt8U();if(!(player=players[id]))break;id!=meId&&player.weapon.actor.fire(),Math.seed=seed,player.weapon.fireMunitions(tv1,tv2);break;case CommCode.throwGrenade:var id=input.unPackInt8U(),x=input.unPackFloat(),y=input.unPackFloat(),z=input.unPackFloat(),dx=input.unPackFloat(),dy=input.unPackFloat(),dz=input.unPackFloat();if(!(player=players[id]))break;player.grenadeCount--,id!=meId?(player.actor.head.rotation.x=player.pitch,player.actor.mesh.rotation.y=player.yaw):updateAmmoUi(),player.actor.throwGrenade(),munitionsManager.throwGrenade(player,{x:x,y:y,z:z},{x:dx,y:dy,z:dz});break;case CommCode.reload:id=input.unPackInt8U();players[id]&&players[id].reload();break;case CommCode.swapWeapon:var id=input.unPackInt8U(),weaponIdx=input.unPackInt8U();players[id]&&players[id].swapWeapon(weaponIdx);break;case CommCode.hitMe:var hp=input.unPackInt8U(),dx=input.unPackFloat(),dz=input.unPackFloat();me.hp=hp,me.actor.hit(),hitIndicator.hit(dx,dz);break;case CommCode.hitThem:var id=input.unPackInt8U(),hp=input.unPackInt8U();if(!(player=players[id]))break;player.hp=hp,player.actor.hit(),hp>0&&shellFragBurst(player.actor.mesh,100,1);break;case CommCode.respawn:var id=input.unPackInt8U(),x=input.unPackFloat(),y=input.unPackFloat(),z=input.unPackFloat();(player=players[id])&&(player.respawn(x,y,z),id==meId&&console.log("CommCode.respawn received from server for this player"));break;case CommCode.changeCharacter:var id=input.unPackInt8U(),classIdx=input.unPackInt8U(),primaryWeaponItem=catalog.findItemBy8BitItemId(ItemType.Primary,classIdx,input.unPackInt8U()),secondaryWeaponItem=catalog.findItemBy8BitItemId(ItemType.Secondary,classIdx,input.unPackInt8U()),shellColor=input.unPackInt8U(),hatItem=catalog.findItemBy8BitItemId(ItemType.Hat,classIdx,input.unPackInt8U()),stampItem=catalog.findItemBy8BitItemId(ItemType.Stamp,classIdx,input.unPackInt8U());(player=players[id])&&player.changeCharacter(classIdx,primaryWeaponItem,secondaryWeaponItem,shellColor,hatItem,stampItem);break;case CommCode.switchTeam:var id=input.unPackInt8U(),toTeam=input.unPackInt8U();if(player=players[id]){player.team=toTeam,player.score=0,player.kills=0,player.streak=0,player.bestGameStreak=0,id==meId&&(myTeam=toTeam,setTeamButton());for(i=0;i<playerLimit;i++)(player=players[i])&&player.actor&&player.actor.updateTeam();rebuildPlayerList()}break;case CommCode.ping:ping=Date.now()-pingStartTime,pingTotal+=ping,pingSamples++;var el=document.getElementById("ping");ping<100?el.style.color="#0f0":ping<150?el.style.color="#ff0":ping<200?el.style.color="#f90":el.style.color="#f00",el.innerText=ping+"ms",setTimeout(function(){var output=new Comm.output(1);output.packInt8(CommCode.ping),pingStartTime=Date.now(),ws&&ws.send(output.buffer)},1e3);break;case CommCode.notification:notify(input.unPackString(),1e3*input.unPackInt8U());break;case CommCode.updateBalance:var newBalance=input.unPackInt32U();console.log("updating balance from server: "+newBalance),playerAccount.currentBalance=newBalance,updateCurrentBalance();break;default:console.log("CommCode error: "+cmd)}}}}function shellFragBurst(mesh,count,power){if(mesh.isVisible){var particleSystem=new BABYLON.ParticleSystem("particles",count,gameScene);particleSystem.targetStopDuration=.2,particleSystem.disposeOnStop=!0,particleSystem.particleTexture=new BABYLON.Texture("./img/shellfrag.png",gameScene),particleSystem.emitter=mesh,particleSystem.minEmitBox=new BABYLON.Vector3(-.2,.2,-.2),particleSystem.maxEmitBox=new BABYLON.Vector3(.2,.4,.2),particleSystem.color1=new BABYLON.Color4(1,1,1,4),particleSystem.color2=new BABYLON.Color4(1,1,1,4),particleSystem.colorDead=new BABYLON.Color4(1,1,1,0),particleSystem.minSize=.01,particleSystem.maxSize=.04,particleSystem.minLifeTime=.1,particleSystem.maxLifeTime=.3,particleSystem.emitRate=count,particleSystem.manualEmitCount=count,particleSystem.blendMode=BABYLON.ParticleSystem.BLENDMODE_STANDARD,particleSystem.gravity=new BABYLON.Vector3(0,-10,0),particleSystem.direction1=new BABYLON.Vector3(-2,-1,-2),particleSystem.direction2=new BABYLON.Vector3(2,3,2),particleSystem.minAngularSpeed=10*-Math.PI,particleSystem.maxAngularSpeed=10*Math.PI,particleSystem.minEmitPower=1*power,particleSystem.maxEmitPower=2*power,particleSystem.updateSpeed=.01,particleSystem.start()}}function make3DArray(width,height,depth,initVal){for(var arr=Array(width),x=0;x<width;x++){arr[x]=Array(height);for(var y=0;y<height;y++){arr[x][y]=Array(depth);for(var z=0;z<depth;z++)arr[x][y][z]=initVal}}return arr}function iterateXYZ(width,height,depth,options,callback){var opt=options||{};opt.step=opt.step||1,opt.x=opt.x||0,opt.y=opt.y||0,opt.z=opt.z||0;for(var x=opt.x;x<width;x+=opt.step)for(var y=opt.y;y<height;y+=opt.step)for(var z=opt.z;z<depth;z+=opt.step)callback(x,y,z)}function createMapCells(callback){function addMeshToMap(keyIdx){if(keyIdx!=meshNames.length){var meshName=meshNames[keyIdx],meshData=minMap.data[meshName],meshIdx=meshIndex[meshName],mesh=mapMeshes[meshIdx],pct=Math.floor(keyIdx/meshNames.length*100),msgs=["Laying","Cracking","Making omelettes","Random clucking","Scratching","Scrambling","Roosting","Beating","Making bad yolks","Thinking of egg puns","Whipping","Frying","Poaching"];showSpinner("Building Map",msgs[Math.randomInt(0,msgs.length)]+"... "+pct+"%");var fields=meshName.split(".");if(mesh.theme=fields[0],mesh.colliderType=fields[2],mesh.softness=fields[3],"SPECIAL"!=mesh.theme){var i=0,meshArr=Object.values(meshData);SPS.addShape(mesh,meshArr.length,{positionFunction:function(particle,idx,shapeIdx){var rx=meshArr[i].rx||0,ry=meshArr[i].ry||0,rz=meshArr[i].rz||0;particle.position.x=meshArr[i].x+.5,particle.position.y=meshArr[i].y+.5,particle.position.z=meshArr[i].z+.5,particle.rotation.x=rx*rotInc,particle.rotation.y=ry*rotInc,particle.rotation.z=rz*rotInc,particle.alive=!1,i++}})}var nextFunction=addMeshToMap.bind(this,keyIdx+1);window.requestAnimationFrame(nextFunction)}else callback()}playOffline?minMap=JSON.parse(localStorage.getItem("mapBackup")):(console.log("MAP IDX: "+mapIdx),console.log(minMaps.length),minMap=minMaps[mapIdx]),(map={width:minMap.width,height:minMap.height+1,depth:minMap.depth}).data=make3DArray(map.width,map.height,map.depth,{}),(SPS=new BABYLON.SolidParticleSystem("SPS",gameScene,{updatable:!1})).computeParticleColor=!1,SPS.computeParticleTexture=!1,SPS.computeParticleRotation=!1,SPS.recomputeNormals=!1;for(var meshIndex={},i=1;i<mapMeshes.length;i++){var mesh=mapMeshes[i];meshIndex[mesh.name]=i}var meshesNotFound={};Object.keys(minMap.data).forEach(function(meshName){var meshData=minMap.data[meshName],meshIdx=meshIndex[meshName],mesh=mapMeshes[meshIdx];if(meshIdx){var fields=meshName.split(".");mesh.theme=fields[0],mesh.colliderType=fields[2],mesh.softness=fields[3],Object.values(meshData).forEach(function(cell){map.data[cell.x][cell.y][cell.z]={idx:meshIdx,rx:cell.rx||0,ry:cell.ry||0,rz:cell.rz||0}})}else meshesNotFound[meshName]=!0});var str="";Object.keys(meshesNotFound).forEach(function(name){str+=name+"\n"}),""!=str&&alert("The following map meshes were not found:\n\n"+str+"\nTry clearing your cache and reload the page!");var meshNames=Object.keys(minMap.data),nextFunction=addMeshToMap.bind(this,0);window.requestAnimationFrame(nextFunction)}function applyLightMap(onComplete){function worker(){self.onmessage=function(e){e=e.data;for(var samples,sum,i=0;i<e.positions.length/3;i++){var ix3=3*i,x=e.positions[ix3],y=e.positions[ix3+1],z=e.positions[ix3+2];samples=0,sum=0,function(width,height,depth,options,callback){var opt=options||{};opt.step=opt.step||1,opt.x=opt.x||0,opt.y=opt.y||0,opt.z=opt.z||0;for(var x=opt.x;x<width;x+=opt.step)for(var y=opt.y;y<height;y+=opt.step)for(var z=opt.z;z<depth;z+=opt.step)callback(x,y,z)}(Math.min(e.w-1,x+.6),Math.min(e.h-1,y+.6),Math.min(e.d-1,z+.6),{x:Math.max(0,x-.6),y:Math.max(0,y-.6),z:Math.max(0,z-.6)},function(x,y,z){var cx=Math.round(x),cy=Math.round(y),cz=Math.round(z);samples++,sum+=e.lightMap[cx][cy][cz]});var l=Math.min(Math.max(sum/samples,.5),1);e.colors[4*i]*=l,e.colors[4*i+1]*=l,e.colors[4*i+2]*=l,i%1e3==0&&postMessage({progress:Math.floor(i/(e.positions.length/3)*100)})}postMessage({colors:e.colors})}}(mapMesh=SPS.buildMesh()).receiveShadows=!0,console.log("Casting rays");var w=map.width+1,h=map.height+1,d=map.depth+1,lightMap=make3DArray(w,h,d,1.5),lightDir=new BABYLON.Vector3(.2,1,.1);lightDir.normalize();var lightRay=lightDir.clone();lightRay.scaleInPlace(1e3);var testStep=lightDir.clone();testStep.scaleInPlace(.5),iterateXYZ(map.width+1,map.height+1,map.depth+1,null,function(lmx,lmy,lmz){var rays=[],ray=new BABYLON.Ray(new BABYLON.Vector3(lmx,lmy,lmz),lightRay);rays.push(ray);var testPos=new BABYLON.Vector3(lmx,lmy,lmz);testPos.addInPlace(testStep),testPos.addInPlace(testStep);for(var cellsChecked={},hits=0;;){if(testPos.x<-1||testPos.x>map.width||testPos.y<-1||testPos.y>map.height||testPos.z<-1||testPos.z>map.depth||hits==rays.length)break;var cx=Math.floor(Math.clamp(testPos.x+0,0,map.width-1)),cy=Math.floor(Math.clamp(testPos.y+0,0,map.height-1)),cz=Math.floor(Math.clamp(testPos.z+0,0,map.depth-1)),checkId=cx+1e3*cy+1e4*cz;if(!cellsChecked[checkId]){cellsChecked[checkId]=!0;var cell=map.data[cx][cy][cz];if(cell&&cell.idx){var cellMesh=mapMeshes[cell.idx];if("SPECIAL"!=cellMesh.theme){cellMesh.rotation.x=cell.rx*Math.PI90,cellMesh.rotation.y=cell.ry*Math.PI90,cellMesh.rotation.z=cell.rz*Math.PI90,cellMesh.position.x=cx+.5,cellMesh.position.y=cy+.5,cellMesh.position.z=cz+.5,cellMesh.computeWorldMatrix();for(var ri in rays)(ray=rays[ri]).hit||ray.intersectsMesh(cellMesh,!0).hit&&(ray.hit=!0,hits++);cellMesh.position=BABYLON.Vector3.Zero()}}}testPos.addInPlace(testStep)}hits>0&&(lightMap[lmx][lmy][lmz]=.2)}),console.log("Applying lightmap");var colors=mapMesh.getVerticesData(BABYLON.VertexBuffer.ColorKind),positions=mapMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),code=worker.toString();code=code.substring(code.indexOf("{")+1,code.lastIndexOf("}"));var blob=new Blob([code],{type:"application/javascript"});(worker=new Worker(URL.createObjectURL(blob))).postMessage({colors:colors,positions:positions,lightMap:lightMap,w:w,h:h,d:d}),worker.onmessage=function(m){if(m.data.hasOwnProperty("progress"))showSpinner("Building Map","Turning on the lights... "+m.data.progress+"%");else{if(mapMesh.updateVerticesData(BABYLON.VertexBuffer.ColorKind,m.data.colors),mapMesh.material=gameScene.getMaterialByName("map"),mapMesh.freezeWorldMatrix(),!noSkybox){var skyboxName=minMap.skybox||"default",skybox=BABYLON.MeshBuilder.CreateBox("skyBox",{size:100},scene);skybox.infiniteDistance=!0;var skyboxMaterial=new BABYLON.StandardMaterial("skyBox",scene);skyboxMaterial.backFaceCulling=!1,skyboxMaterial.fogEnabled=!1,skyboxMaterial.reflectionTexture=new BABYLON.CubeTexture("img/skyboxes/"+skyboxName+"/skybox",scene),skyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,skyboxMaterial.diffuseColor=new BABYLON.Color3(0,0,0),skyboxMaterial.specularColor=new BABYLON.Color3(0,0,0),skybox.material=skyboxMaterial}onComplete()}}}function buildMap(onComplete){function complete(){hideSpinner(),onComplete()}showSpinner("Building Map","Hold on!"),createMapCells(function(){showSpinner("Building Map","Turning on the lights..."),requestAnimationFrame(applyLightMap.bind(this,complete))})}function update(){var fps=engine.getFps();if(fpsTotal+=fps,++fpsSamples%10==0&&(document.getElementById("FPS").innerText=Math.floor(fps+.5),me&&(document.getElementById("healthBar").style.width=me.hp+"%"),timedGame)){var clockEl=document.getElementById("gameClock"),date=new Date(roundEndTime-Date.now()+1e3);if(date>=0){var minutes=date.getMinutes(),seconds=date.getSeconds();if(seconds!=oldClockSeconds){var size=2;0==minutes&&seconds<11&&(size=2+(11-seconds)/4),clockEl.style.fontSize=size+"em",clockEl.innerText=minutes+":"+(seconds<10?"0":"")+seconds,oldClockSeconds=seconds}}else clockEl.innerText="0:00"}var currentTimeStamp=performance.now();pingSamples>10&&(highestPing=Math.max(highestPing,ping));for(;lastTimeStamp<currentTimeStamp;){if(lastTimeStamp+=1e3/60,freezeFrame)me.update(1),me.actor.update(1);else for(var i=0;i<players.length;i++){var player=players[i];player&&player.playing&&(player.update(1),player.actor.handsToWeaponSkeleton(),player.actor&&player.actor.update(1))}me&&(me.stateBuffer[me.stateIdx]={delta:1,yaw:me.yaw,fire:!1,jumping:me.jumping,climbing:me.climbing,x:me.x,y:me.y,z:me.z,dx:me.dx,dy:me.dy,dz:me.dz,controlKeys:me.controlKeys},me.stateIdx%FramesBetweenSyncs==0&&ws.readyState==ws.OPEN&&me.hp>0&&!freezeFrame&&serverSync(),hitIndicator.update(1),reticle.update(1),me.weapon&&0==me.weapon.ammo.rounds&&(me.stateIdx%20==0?document.getElementById("ammo").style.color="#f00":me.stateIdx%20==10&&(document.getElementById("ammo").style.color="#fff")),1==grenadePowerUp&&(grenadeThrowPower=Math.min(grenadeThrowPower+.015,1))>0&&(document.getElementById("grenadeThrowContainer").style.visibility="visible",document.getElementById("grenadeThrow").style.height=100*grenadeThrowPower+"%")),freezeFrame||(munitionsManager.update(1),itemManager.update(1),updateExplosions(explosionSmokeManager,1),updateExplosions(explosionFireManager,1)),mapOverview&&(mapOverviewAxis+=.002,camera.position.x=Math.sin(mapOverviewAxis)*map.height+map.width/2,camera.position.z=Math.cos(mapOverviewAxis)*map.height+map.depth/2,camera.setTarget(new BABYLON.Vector3(map.width/2,map.height/4,map.depth/2)))}}function hitPlayer(){}function serverSync(){if(me){var output=new Comm.output(3+5*FramesBetweenSyncs);output.packInt8(CommCode.sync),output.packInt8(me.stateIdx),output.packInt8(me.shotsQueued);for(var startIdx=Math.mod(me.stateIdx-FramesBetweenSyncs,stateBufferSize),i=0;i<FramesBetweenSyncs;i++){var idx=Math.mod(startIdx+i,stateBufferSize);output.packInt8(me.stateBuffer[idx].controlKeys),output.packRadU(me.stateBuffer[idx].yaw),output.packRad(me.stateBuffer[idx].pitch)}ws.send(output.buffer),me.shotsQueued=0}}function switchTeam(){closeAlertDialog();var output=new Comm.output(1);output.packInt8(CommCode.switchTeam),ws.send(output.buffer)}function setTeamButton(){var teamButton=document.getElementById("teamButton");1==myTeam?(teamButton.innerText="Join RED Team",teamButton.className="ssbutton red"):(teamButton.innerText="Join BLUE Team",teamButton.className="ssbutton blue")}function addPlayer(playerData){var player=new Player(playerData);player.id==meId&&((me=player).ws=ws,updateAmmoUi()),player.playing||player.actor.removeFromPlay(),players[playerData.id]=player,rebuildPlayerList()}function removePlayer(playerId){var player=players[playerId];playerId!=meId?player&&(player.actor.remove(),delete players[playerId],rebuildPlayerList()):console.log("Tried to remove ME")}function getTeamScores(){for(var teamScore=[0,0,0],i=0;i<playerLimit;i++){var player=players[i];player&&(teamScore[player.team]+=player.score)}var leadingTeam=0;return teamScore[1]>teamScore[2]?leadingTeam=1:teamScore[2]>teamScore[1]&&(leadingTeam=2),{score:teamScore,leader:leadingTeam}}function rebuildPlayerList(){for(var playerIdxs=[],i=0;i<players.length;i++)players[i]&&playerIdxs.push(i);if(gameType==GameType.teams){var teams=getTeamScores();teams.leader>0&&(lastLeadingTeam=teams.leader),teams.score[lastLeadingTeam]+=1e5,playerIdxs.sort(function(a,b){return players[b].score+teams.score[players[b].team]-(players[a].score+teams.score[players[a].team])})}else playerIdxs.sort(function(a,b){return players[b].score-players[a].score});var list=document.getElementById("playerList").children;for(i=0;i<playerIdxs.length;i++){var player=players[playerIdxs[i]];list[i].style.display="block",list[i].children[0].innerText=player.name,list[i].children[1].innerText=player.score,players[playerIdxs[i]].id==meId?(list[i].className="thisPlayer",list[i].style.background=teamColors.meBackground[player.team]):(list[i].className="otherPlayer",list[i].style.background=teamColors.themBackground[player.team],list[i].style.color=teamColors.text[player.team])}for(;i<playerLimit;)list[i].style.display="none",i++}function updateAmmoUi(){if(me){var el=document.getElementById("weaponName");el.innerHTML=me.weapon.subClass.weaponName,(el=document.getElementById("ammo")).style.color="#fff",el.innerHTML=me.weapon.ammo.rounds+"/"+Math.min(me.weapon.ammo.store,me.weapon.ammo.storeMax);for(var i=1;i<=3;i++)me.grenadeCount>=i?document.getElementById("grenade"+i).src="img/grenadeIcon.png?v=1":document.getElementById("grenade"+i).src="img/grenadeIconDark.png?v=1"}}function captureKeys(){lastKey=null,document.onkeydown=onKeyDown,document.onkeyup=onKeyUp}function releaseKeys(){document.onkeydown=null,document.onkeyup=null}function inputDown(code){me.playing&&document.pointerLockElement&&handleInputDown(inputToControlMap[code])}function handleInputDown(control){switch(control){case"up":case"down":case"left":case"right":var bit=CONTROL[control];me.controlKeys|=bit,me.stateBuffer[me.stateIdx].controlKeys=me.controlKeys;break;case"jump":if(me.lastTouchedGround>0&&Date.now()>me.lastTouchedGround+100&&me.jump()){var output=new Comm.output(1);output.packInt8(CommCode.jump),ws.send(output.buffer)}break;case"fire":document.pointerLockElement&&me&&me.pullTrigger();break;case"grenade":document.pointerLockElement&&me&&!grenadePowerUp&&me.canSwapOrReload()&&me.grenadeCount>0&&(grenadePowerUp=!0,grenadeThrowPower=-.15);break;case"scope":settings.holdToAim?me.actor.scopeIn():me.actor.scope?me.actor.scopeOut():me.actor.scopeIn();break;case"reload":me.reload();break;case"weapon":me.swapWeapon(0==me.weaponIdx?1:0)}}function inputUp(code){me.playing&&document.pointerLockElement&&handleInputUp(inputToControlMap[code])}function handleInputUp(control){switch(control){case"fire":me.weapon&&me.releaseTrigger();break;case"scope":settings.holdToAim&&me.actor.scopeOut();break;case"grenade":document.pointerLockElement&&me&&grenadePowerUp&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden",grenadePowerUp=!1,me.throwGrenade(grenadeThrowPower));break;case"up":case"down":case"left":case"right":case"jump":var bit=CONTROL[control];me.controlKeys^=me.controlKeys&bit}}function debugDump(){if(debugWindow){for(var i=0;i<playerLimit;i++){var p=players[i];if(p){var player={name:p.name,hp:p.hp,playing:p.playing,posX:p.x,posY:p.y,posZ:p.z,actorX:p.actor.mesh.position.x,actorY:p.actor.mesh.position.y,actorZ:p.actor.mesh.position.z,transformEnabled:p.actor.mesh.isEnabled(),transformVisible:p.actor.mesh.isVisible,transformFrozen:p.actor.mesh.isWorldMatrixFrozen,shellEnabled:p.actor.bodyMesh.isEnabled(),shellVisible:p.actor.bodyMesh.isVisible,shellFrozen:p.actor.bodyMesh.isWorldMatrixFrozen,weaponEnabled:p.weapon.actor.gunMesh.isEnabled(),weaponVisible:p.weapon.actor.gunMesh.isVisible};debugWindow.document.write(JSON.stringify(player)+"\n")}}debugWindow.document.write("<hr>")}else(debugWindow=window.open("","","name=Debug")).document.write("<pre>")}function addKillText(byPlayer,killedPlayer){var msgs=[" SCRAMBLED "," BEAT "," POACHED "," WHIPPED "," FRIED "," CRACKED "],str='<span style="color: '+teamColors.text[byPlayer.team]+'">'+byPlayer.name+"</span>"+msgs[Math.randomInt(0,msgs.length)]+'<span style="color: '+teamColors.text[killedPlayer.team]+'">'+killedPlayer.name+"</span>";(killEl.innerHTML.match(/<br>/g)||[]).length>4&&(killEl.innerHTML=killEl.innerHTML.substr(killEl.innerHTML.search("<br>")+4)),killEl.innerHTML+=str+"<br>"}function initChatIn(){canvas.focus(),chatInEl.style.display="block",chatInEl.value="Press ENTER to chat",chatInEl.style.background="transparent",chatInEl.blur(),chatting=!1}function addChat(str,fromPlayer){fromPlayer&&(str='<span style="color: '+teamColors.text[fromPlayer.team]+'">'+fromPlayer.name+": </span>"+str),(chatOutEl.innerHTML.match(/<br>/g)||[]).length>5&&(chatOutEl.innerHTML=chatOutEl.innerHTML.substr(chatOutEl.innerHTML.search("<br>")+4)),str='<div class="shadedPane" style="margin-top: 0.2em">'+str+"</div><br>",chatOutEl.innerHTML+=str}function onKeyDown(e){var key=(e=e||window.event).key;if(key!=lastKey)if(lastKey=key,grenadePowerUp||0!=me.controlKeys||"Enter"!=key||!settings.enableChat){var k=(""+key).toLocaleUpperCase();if(" "==k&&(k="SPACE",e.preventDefault()),debug){if("`"==k)return void debugDump();if("\\"==k){freezeFrame=!0;for(i=0;i<gameScene.particleSystems.length;i++)gameScene.particlesPaused=!0;for(var i=0;i<playerLimit;i++)players[i]&&players[i].actor&&(players[i].actor.mesh.setVisible(!0),players[i].actor.showNameSprite(),players[i].actor.positionNameSprite());ws.close()}}inputDown(k)}else me.chatLineCap>0&&(releaseKeys(),chatInEl.style.background="rgba(0, 0, 0, 0.5)",chatInEl.value="",chatInEl.focus(),lastKey=null,chatting=!0)}function onKeyUp(e){var key=(e=e||window.event).key;key==lastKey&&(lastKey=null);var k=(""+key).toLocaleUpperCase();" "==k&&(k="SPACE",e.preventDefault()),inputUp(k)}function Scope(){this.crosshairs=new BABYLON.AbstractMesh("",gameScene),this.crosshairs.setEnabled(!1),this.crosshairs.position.z=2;var p=[new BABYLON.Vector3(-1,0,0),new BABYLON.Vector3(1,0,0)],l=BABYLON.MeshBuilder.CreateLines("",{points:p},gameScene);l.layerMask=536870912,l.color=BABYLON.Color3.Black(),l.parent=this.crosshairs,p=[new BABYLON.Vector3(0,-1,0),new BABYLON.Vector3(0,1,0)],(l=BABYLON.MeshBuilder.CreateLines("",{points:p},gameScene)).layerMask=536870912,l.color=BABYLON.Color3.Black(),l.parent=this.crosshairs}function HitIndicator(){this.mesh=new BABYLON.Mesh("hitIndicator",gameScene),this.mesh.updatable=!0,this.mesh.hasVertexAlpha=!0,this.positions=[0,0,0,0,.5,0,.5,.5,0,.5,0,0,.5,-.5,0,0,-.5,0,-.5,-.5,0,-.5,0,0,-.5,.5,0];var indices=[0,1,8,0,2,1,0,2,1,0,3,2,0,3,2,0,4,3,0,4,3,0,5,4,0,5,4,0,6,5,0,6,5,0,7,6,0,7,6,0,8,7,0,8,7,0,1,8];this.colors=new Array(48).fill(0);for(var i=0;i<48;i+=4)this.colors[i]=1,this.colors[i+1]=.9,this.colors[i+2]=0,this.colors[i+3]=-.5;var vertexData=new BABYLON.VertexData;vertexData.positions=this.positions,vertexData.indices=indices,vertexData.colors=this.colors,vertexData.applyToMesh(this.mesh,!0),this.mesh.layerMask=536870912,this.mesh.material=gameScene.getMaterialByName("ui"),this.resize()}function Reticle(){this.mesh=new BABYLON.AbstractMesh("reticle",gameScene),this.mesh.position.z=1,this.lines=[];var reticleMesh=gameScene.getMeshByName("reticle");reticleMesh.setMaterial(gameScene.getMaterialByName("ui"));for(var i=0;i<4;i++){var line=reticleMesh.createInstance("",this.mesh);line.parent=this.mesh,line.scaling=new BABYLON.Vector3(1,1,1),line.rotation.z=i*Math.PI/2,this.lines.push(line)}this.mesh.setLayerMask(536870912),this.mesh.setEnabled(!1),this.resize()}function inviteFriends(){gameCode=selectedServer.toString(36)+uniqueId.toString(36)+uniqueKey.toString(36),document.getElementById("friendCode").innerText=location.href+"#"+gameCode,openAlertDialog("Don't Go Alone!","<p>Share this link with your friends so they can join you!</p><h3>"+location.href+"#"+gameCode+"</h3><p></p>",{label:"Copy to clipboard",width:"12em",onclick:copyFriendCode},{label:"Close",onclick:closeAlertDialog})}function copyFriendCode(){document.getElementById("friendCode").select();try{document.execCommand("copy")}catch(err){console.log("Unable to copy to clipboard")}closeAlertDialog()}function isMeshVisible(mesh,offset){if(freezeFrame)return!0;for(var oy=offset||mesh.getBoundingInfo().boundingBox.center.z,dx=mesh.position.x-camera.globalPosition.x,dy=mesh.position.y+oy-camera.globalPosition.y,dz=mesh.position.z-camera.globalPosition.z,distance=Math.length3(dx,dy,dz),dv=Math.normalize3({x:dx,y:dy,z:dz},.9),x=camera.globalPosition.x,y=camera.globalPosition.y,z=camera.globalPosition.z,collisions=0,i=0;i<distance-.9&&(x+=dv.x,y+=dv.y,z+=dv.z,!(x<0||x>=map.width||z<0||z>=map.depth||y<0||y>=map.height));i+=.9){var cell=map.data[Math.floor(x)][Math.floor(y)][Math.floor(z)];if(cell.idx){var m=mapMeshes[cell.idx];if("full"==m.colliderType&&!m.softness&&2==++collisions)return!1}}return!0}function resetGameUI(){chatOutEl.innerHTML="",1==settings.enableChat&&(initChatIn(),chatOutEl.style.display="block",chatInEl.style.display="block"),killEl.innerHTML="",chatOutEl.value="",hideMultisizeBannerAd(),document.getElementById("gameAdContainer").style.display="none",document.getElementById("inGameAd").style.display="none",document.getElementById("killBox").style.display="none",document.getElementById("deathBox").style.display="none",document.getElementById("scopeBorder").style.display="none",document.getElementById("help").style.display="block",document.getElementById("goButton").className="ssbutton green",document.getElementById("goButtonLabel").innerHTML="▶ PLAY!&nbsp;",document.getElementById("gameClock").style.display="none",document.getElementById("gameClock").style.fontSize="2em",document.getElementById("gameSummary").style.visibility="hidden",document.getElementById("ffaFinal").style.display="none",document.getElementById("teamFinal").style.display="none",setTeamButton(),console.log("resetGameUI")}function addCanvasListeners(){console.log("Event listeners added"),canvas.style.pointerEvents="all",canvas.addEventListener("mousedown",onCanvasMouseDown,!1),canvas.addEventListener("mouseup",onCanvasMouseUp,!1),canvas.addEventListener("mousemove",onCanvasMouseMove)}function removeCanvasListeners(){console.log("Event listeners removed"),canvas.style.pointerEvents="none",canvas.removeEventListener("mousedown",onCanvasMouseDown),canvas.removeEventListener("mouseup",onCanvasMouseUp),canvas.removeEventListener("mousemove",onCanvasMouseMove)}function Customizer(callback){this.isReady=!1,this.camX=0,this.camY=.4,this.camRadius=3.4,this.rotY=0,this.rotX=0,this.jump=0,this.turnCountdown=60,this.selectedItem=0,this.buyingItem=null,this.currentPickedItem=null,this.currentRenderFunc=null,this.currentHighlightFunc=null,this.currentSelectByIndexFunc=null,this.currentSelectByItemFunc=null,this.setupScene(),this.setupItems(),this.setupWeaponStats();var outer=this;loadResources(outer.scene,function(){outer.onResourcesLoaded(),callback(),outer.isReady=!0})}function GrenadeActor(grenade){this.grenade=grenade,this.mesh=scene.cloneMesh("grenade"),this.mesh.setEnabled(!1),this.explodeSound=Sounds.grenade.explode.clone(),this.pinSound=this.mesh.attachSound(Sounds.grenade.pin),this.beepSound=this.mesh.attachSound(Sounds.grenade.beep),this.beep=!1,this.flashColor=null}function GunActor(gun,meshName){this.gun=gun,this.meshName=meshName,this.standardMeshName=gun.subClass.standardMeshName,this.playerActor=gun.player.actor,this.skeleton=scene.cloneSkeleton("gun_"+this.standardMeshName+"_skeleton")}function Eggk47Actor(gun,meshName){GunActor.call(this,gun,meshName),this.scopeFov=.9,this.scopeY=.0438,this.setup(.6),this.fireSound=this.gunMesh.attachSound(Sounds.eggk47.fire),this.dryFireSound=this.gunMesh.attachSound(Sounds.eggk47.dryFire);var removeMag=this.gunMesh.attachSound(Sounds.eggk47.removeMag),insertMag=this.gunMesh.attachSound(Sounds.eggk47.insertMag),cycle=this.gunMesh.attachSound(Sounds.eggk47.cycle);this.addSoundEvent("shortReload",40,removeMag),this.addSoundEvent("shortReload",130,insertMag),this.addSoundEvent("longReload",40,removeMag),this.addSoundEvent("longReload",130,insertMag),this.addSoundEvent("longReload",155,cycle)}function DozenGaugeActor(gun,meshName){GunActor.call(this,gun,meshName),this.scopeFov=1,this.scopeY=.072,this.setup(.6),this.fireSound=this.gunMesh.attachSound(Sounds.dozenGauge.fire),this.dryFireSound=this.gunMesh.attachSound(Sounds.eggk47.dryFire);var open=this.gunMesh.attachSound(Sounds.dozenGauge.open),load=this.gunMesh.attachSound(Sounds.dozenGauge.load),close=this.gunMesh.attachSound(Sounds.dozenGauge.close);this.addSoundEvent("reload",0,open),this.addSoundEvent("reload",80,load),this.addSoundEvent("reload",115,close)}function CSG1Actor(gun,meshName){GunActor.call(this,gun,meshName),this.scopeFov=.5,this.scopeY=.0345,this.setup(.6),this.fireSound=this.gunMesh.attachSound(Sounds.csg1.fire),this.dryFireSound=this.gunMesh.attachSound(Sounds.eggk47.dryFire);var removeMag=this.gunMesh.attachSound(Sounds.eggk47.removeMag),insertMag=this.gunMesh.attachSound(Sounds.eggk47.insertMag),pullAction=this.gunMesh.attachSound(Sounds.csg1.pullAction),releaseAction=this.gunMesh.attachSound(Sounds.csg1.releaseAction);this.addSoundEvent("shortReload",30,removeMag),this.addSoundEvent("shortReload",120,insertMag),this.addSoundEvent("longReload",30,pullAction),this.addSoundEvent("longReload",75,removeMag),this.addSoundEvent("longReload",165,insertMag),this.addSoundEvent("longReload",200,releaseAction)}function Cluck9mmActor(gun,meshName){GunActor.call(this,gun,meshName),this.scopeFov=1.1,this.scopeY=.069,this.setup(.48),this.fireSound=this.gunMesh.attachSound(Sounds.cluck9mm.fire),this.dryFireSound=this.gunMesh.attachSound(Sounds.eggk47.dryFire);var removeMag=this.gunMesh.attachSound(Sounds.cluck9mm.removeMag),insertMag=this.gunMesh.attachSound(Sounds.cluck9mm.insertMag),cycle=this.gunMesh.attachSound(Sounds.eggk47.cycle);this.addSoundEvent("shortReload",15,removeMag),this.addSoundEvent("shortReload",100,insertMag),this.addSoundEvent("longReload",15,removeMag),this.addSoundEvent("longReload",100,insertMag),this.addSoundEvent("longReload",155,cycle)}function RPEGGActor(gun,meshName){GunActor.call(this,gun,meshName),this.scopeFov=.9,this.scopeY=.072,this.setup(),this.fireSound=this.gunMesh.attachSound(Sounds.eggk47.fire),this.dryFireSound=this.gunMesh.attachSound(Sounds.eggk47.dryFire)}function ItemActor(kind){this.kind=kind}function AmmoActor(){ItemActor.call(this,ItemManager.AMMO),this.mesh=scene.getMeshByName("ammo").createInstance(""),this.mesh.setEnabled(!1),shadowGen&&shadowGen.getShadowMap().renderList.push(this.mesh)}function GrenadeItemActor(){ItemActor.call(this,ItemManager.GRENADE),this.mesh=scene.getMeshByName("grenadeItem").createInstance(""),this.mesh.setEnabled(!1),shadowGen&&shadowGen.getShadowMap().renderList.push(this.mesh)}function ItemManager(){this.pools=[new Pool(function(){return new ItemManager.Constructors[ItemManager.AMMO]},100),new Pool(function(){return new ItemManager.Constructors[ItemManager.GRENADE]},20)]}function ItemRenderer(){this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=256,this.canvas.style.position="fixed",this.canvas.style.top="-100em",this.canvas.style.left="1em",document.body.appendChild(this.canvas),this.engine=new BABYLON.Engine(this.canvas,!0,null,!1),this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=new BABYLON.Color4(0,0,0,0),this.meshes={Skeletons:{}},loadMaterials(this.scene),loadMeshes(this.scene,["egg","gun_cluck9mm","gun_eggk47","gun_csg1","gun_dozenGauge"],null,function(){}),this.stampSprites=new BABYLON.SpriteManager("","img/stamps.png?v="+version,256,128,this.scene),this.camera=new BABYLON.ArcRotateCamera("",0,0,0,new BABYLON.Vector3(0,0,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.fov=.5,this.camera.maxZ=100,this.camera.minZ=.1}function closeServerList(){closeAlertDialog()}function pingServers(autoSelect,callback){function pingServerList(innerCallback){for(var serversPinged=0,i=0;i<servers.length;i++){var server=servers[i];server.pinger=new WebSocket("wss://"+servers[i].address),server.pinger.binaryType="arraybuffer",server.pinger.idx=i,server.pinger.timeout=setTimeout(function(){this.ping=null,this.pinger.close(),++serversPinged==servers.length&&innerCallback()}.bind(server),1e3),server.pinger.onopen=function(e){var output=new Comm.output(1);output.packInt8(CommCode.ping),this.send(output.buffer),this.pingStartTime=Date.now()},server.pinger.onmessage=function(e){clearTimeout(this.timeout);new Comm.input(e.data);var pingTime=Date.now()-this.pingStartTime;null!=servers[this.idx].ping&&(servers[this.idx].ping+=pingTime),this.close(),++serversPinged==servers.length&&innerCallback()},server.pinger.onerror=function(e){}}}function pingServerListHelper(){pingServerList(function(){if(4==++timesPinged){for(var lowestPing=1e7,i=0;i<servers.length;i++)null!=servers[i].ping&&(servers[i].ping<lowestPing&&(autoSelect&&selectServer(i),lowestPing=servers[i].ping),servers[i].ping=Math.floor(servers[i].ping/4),console.log(servers[i].name+" "+Math.floor(servers[i].ping)+"ms"));callback&&callback()}else pingServerListHelper()})}for(var i=0;i<servers.length;i++)servers[i].ping=0;var timesPinged=0;pingServerListHelper()}function selectServer(i){selectedServer=i,localStorage.setItem("selectedServer",i),document.getElementById("serverName").innerText="Server: "+servers[selectedServer].name}function resize(){canvas&&(canvas.style.width="100%",canvas.style.height="100%",canvas.className=""),engine&&engine.resize(),inGame&&(hitIndicator&&hitIndicator.resize(),reticle&&reticle.resize());var scale=Math.min(1,window.innerHeight/725),scaleStr="scale("+scale+")",widthStr=300*scale+"px",heightStr=250*scale+"px";document.getElementById("shellshock-io_300x250").style.transform=scaleStr;for(var el=document.getElementById("bannerAdContainer"),i=0;i<el.children.length;i++){var chEl=el.children[i];chEl.style.width=widthStr,chEl.style.height=heightStr}}function login(success,fail){var config={apiKey:"AIzaSyDP4SIjKaw6A4c-zvfYxICpbEjn1rRnN50",authDomain:"shellshockio-181719.firebaseapp.com",databaseURL:"https://shellshockio-181719.firebaseio.com",projectId:"shellshockio-181719",storageBucket:"shellshockio-181719.appspot.com",messagingSenderId:"68327206324"};firebase.initializeApp(config),firebase.auth().onAuthStateChanged(function(theUser){if(user=theUser){if(console.log("Login auth provider: "+user.providerData[0].providerId),!user.emailVerified&&"password"==user.providerData[0].providerId)return void console.log("email not yet verified");console.log("calling loggedIn from firebase.auth().onAuthStateChanged callback"),success(user)}else fail()})}function loggedIn(user){if(!playerAccount.isLoggedIn&&!loggingIn&&(loggingIn=!0,user.getIdToken(!0).then(function(idToken){(statsEl=document.getElementById("statsMessage")).innerHTML="Retrieving your stats...",statsEl.style.display="block",console.log("Using services server: "+servicesServer);try{var authWs=new WebSocket(servicesServer)}catch(e){console.log(e)}authWs.onopen=function(e){authWs.send(JSON.stringify({cmd:"auth",uid:user.uid,token:idToken})),console.log("authWs opened, and auth request sent")},authWs.onmessage=function(e){var accountDataResponse=JSON.parse(e.data);accountDataResponse.error?(statsEl.innerHTML="Database error. Please send us a bug report!",console.log("accountDataResponse Error: "+JSON.stringify(accountDataResponse.error))):(playerAccount.loggedIn(accountDataResponse),updatePlayerStatsDisplay(),updateCurrentBalance(),customizeWhenReady(),sendOneSignalTagsForUser(),console.log("logged in and customized"),statsEl.style.display="none",document.getElementById("playerStats").style.display="flex"),authWs.close()},authWs.onclose=function(e){console.log("authWs closed: "+e.code+" "+e.reason),loggingIn=!1},authWs.onerror=function(e){statsEl.innerHTML='<p style="text-align: left">WebSocket connection failure. Please check your connection at:<br><a href="http://websocketstest.com" target="_window">websocketstest.com</a><br>as well as your firewall and antivirus settings.</p>',console.log("authWS Error: "+JSON.stringify(e,["message","arguments","type","name"])),loggingIn=!1}}).catch(function(error){console.log(error),loggingIn=!1}),document.getElementById("login").style.display="none",document.getElementById("logout").style.display="block",user.photoURL)){var url=user.photoURL,pd=user.providerData[0];"facebook.com"==pd.providerId&&(url="https://graph.facebook.com/"+pd.uid+"/picture"),document.getElementById("profilePic").src=url,document.getElementById("profilePic").style.display="block"}}function loginFail(){(!isFromEU||consent&&consent.ofAge)&&(document.getElementById("login").style.display="block"),document.getElementById("logout").style.display="none",document.getElementById("currentBalanceContainer").style.display="none",document.getElementById("currentBalance").innerText="0",purchasingEnabled=!1,sendOneSignalTagsForAnon(),customizeWhenReady()}function openLoginDialog(){openAlertDialog("",'<div id="firebaseui-auth-container"></div>',{label:"Close",width:"8em",onclick:closeAlertDialog}),firebaseUi||(firebaseUi=new firebaseui.auth.AuthUI(firebase.auth()));var uiConfig={callbacks:{signInSuccessWithAuthResult:function(authResult,redirectUrl){var user=authResult.user,emailVerified=user.emailVerified,isNewUser=(authResult.credential,authResult.additionalUserInfo.isNewUser),providerId=authResult.additionalUserInfo.providerId;authResult.operationType;return closeAlertDialog(),emailVerified||"password"!=providerId?(console.log("calling loggedIn from signInSuccessWithAuthResult callback"),loggedIn(user)):isNewUser?(user.sendEmailVerification(),openAlertDialog("Check Your Email","An email has been sent to:<br><h2>"+user.email+"</h2>Click on the enclosed link to complete your registration.",{label:"OK",width:"6em",onclick:closeAlertDialog})):openAlertDialog("Check Your Email","An email was sent to:<br><h2>"+user.email+'</h2>Click on the enclosed link to complete your registration,<br>or click "Resend" to send a new email.',{label:"OK",width:"6em",onclick:closeAlertDialog},{label:"Resend",width:"6em",onclick:function(){user.sendEmailVerification(),closeAlertDialog()}}),!1},uiShown:function(e){}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1},firebase.auth.FacebookAuthProvider.PROVIDER_ID,firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"http://www.bluewizard.com/terms"};firebaseUi.start("#firebaseui-auth-container",uiConfig)}function onResourcesLoaded(){document.getElementById("mainMenu").style.display="block",document.getElementById("username").disabled=!1,showCornerButtons(),resize(),hideSpinner(),meId=0,console.log("customizer created, starting renderering"),customizer.startRendering(),(consent=localStorage.getItem("consent"))&&(consent=JSON.parse(consent)),isFromEU&&!consent&&openConsentNotification(),aiptag.consented=consent&&consent.ofAge&&consent.targetedAds||!isFromEU,console.log("AIP consent: "+aiptag.consented);var showDate=getStoredNumber("showBigAd",0);Date.now()>showDate?swiftShaderCheck()||(showBigAd(),localStorage.setItem("showBigAd",Date.now()+432e5)):(loadBannerAd(),swiftShaderCheck())}function swiftShaderCheck(){if("Google SwiftShader"==engine.getGlInfo().renderer&&!localStorage.getItem("swiftShaderNotice")){return openAlertDialog("SwiftShader? GROSS!",'<div style="text-align: left">It looks like your graphics card is on Chrome\'s blacklist for some reason. The game will still run, but very slowly. To change this, enter "chrome://flags" in your address bar, search for "Override software rendering list", and enable it.<br><br>CAUTION: The blacklist exists for a reason. This may make your system unstable. Make sure you save anything you\'re working on before trying it!</div>',"OK"),localStorage.setItem("swiftShaderNotice",!0),!0}return!1}function closeFeedback(){inGame&&captureKeys(),document.getElementById("feedback").style.display="none",document.body.appendChild(document.getElementById("feedback")),closeAlertDialog()}function requestService(command,data,success,fail){try{var serviceWs=new WebSocket(servicesServer)}catch(e){console.log(e),fail&&fail(e)}serviceWs.onopen=function(e){data.cmd=command,serviceWs.send(JSON.stringify(data)),console.log("services opened, and "+command+" request sent")},serviceWs.onmessage=function(e){var response=JSON.parse(e.data);response.error?(console.log(command+" error: "+JSON.stringify(response.error)),fail&&fail(response.error)):(console.log(command+" success"),success&&success(response)),serviceWs.close()},serviceWs.onclose=function(e){console.log(command+" service closed: "+e.code+" "+e.reason),success&&success(e)},serviceWs.onerror=function(e){console.log(command+" error: "+JSON.stringify(e,["message","arguments","type","name"])),fail&&fail(e)}}function sendFeedback(){for(var emailEl=document.getElementById("feedbackEmail"),descriptionEl=document.getElementById("feedbackComments"),glInfo=engine.getGlInfo(),caps=engine.getCaps(),pickedWeaponIds=[],c=0;c<classes.length;c++)pickedWeaponIds.push([playerAccount.pickedWeapons[c][0].id,playerAccount.pickedWeapons[c][1].id]);var debugJSON="";try{debugJSON=JSON.stringify({debugObject:debugObject,debugArray:debugArray})}catch(e){console.log(e)}requestService("feedback",{feedbackType:document.getElementById("feedbackTypeSelect").selectedIndex,gameVersion:version,userAgent:window.navigator.userAgent,username:username,comments:descriptionEl.value,email:emailEl.value,firebaseId:playerAccount.firebaseId||null,fromEU:isFromEU,gameServer:servers[selectedServer].name||null,session:playerAccount.session||null,ping:pingSamples>0?Math.floor(pingTotal/pingSamples):null,highestPing:highestPing||null,fps:fpsSamples>0?Math.ceil(fpsTotal/fpsSamples):null,gameType:gameType||null,privateGame:privateGame||null,localKills:kills||0,localDeaths:deaths||0,localStreak:bestOverallStreak||0,url:window.location.href,referrer:document.referrer,gameCode:gameCode||null,screenSize:screen.width+"x"+screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerSize:window.innerWidth+"x"+window.innerHeight,glVendor:glInfo.vendor,renderer:glInfo.renderer,glVersion:glInfo.version,maxTextureSize:caps.maxTextureSize,fov:camera?camera.fov:null,controls:localStorage.getItem("controlConfig"),ofAge:consent?consent.ofAge:null,targetedAds:consent?consent.targetedAds:null,volume:settings.volume,mouseSensitivity:settings.mouseSensitivity,mouseInvert:settings.mouseInvert,holdToAim:settings.holdToAim,enableChat:settings.enableChat,autoDetail:settings.autoDetail,shadowsEnabled:settings.shadowsEnabled,highRes:settings.highRes,selectedClass:playerAccount.classIdx,selectedColor:playerAccount.colorIdx,hat:playerAccount.hatItem?null:playerAccount.hatItem.id,stamp:playerAccount.stampItem?null:playerAccount.stampItem.id,weapons:"[[0,0],[0,0],[0,0]]",timesPlayed:null,xsollaToken:globalXsollaToken,current_balance:playerAccount.currentBalance,log:console.logArray(),debug:debugJSON},function(res){console.log(res),setTimeout(function(){notify("Your feedback has been received.<br>Thank you!",3e3)},1e3)},function(err){console.log(err)}),closeFeedback(),emailEl.value="",descriptionEl.value=""}function openJoinBox(){document.getElementById("customGame").style.display="none",document.getElementById("joinGame").style.display="block"}function play(createPrivate){if(console.log("play("+createPrivate+")"),dismissNotification(),settings.volume>0)try{BABYLON.Engine.audioEngine.audioContext.resume()}catch(e){console.log(e)}0==(username=document.getElementById("username").value.trim()).length&&(username=randomName()),document.body.scrollTop=document.documentElement.scrollTop=0,createPrivateGame=createPrivate,timesPlayed=getStoredNumber("timesPlayed",0),localStorage.setItem("timesPlayed",timesPlayed+1);var lastPreRoll=getStoredNumber("lastPreRoll",0);0==lastPreRoll&&(lastPreRoll=Date.now(),localStorage.setItem("lastPreRoll",lastPreRoll)),adTest||Date.now()>lastPreRoll+3e5&&timesPlayed%2==1?(console.log("play() calls PVA"),playVideoAd()):joinGame()}function joinGame(){console.log("joinGame()");var url,server=selectedServer,joinType=CommCode.joinPublicGame,protocol="ws://";"https:"===location.protocol&&(protocol="wss://");var joinGameId=document.getElementById("joinCode").value.trim();if(protocol="wss://",createPrivateGame)joinType=CommCode.createPrivateGame,url=protocol+servers[server].address;else if(""!=joinGameId){joinType=CommCode.joinPrivateGame,joinGameId.startsWith("#")&&(joinGameId=joinGameId.substr(1)),server=Number.parseInt(joinGameId.substr(0,1),36),uniqueId=Number.parseInt(joinGameId.substr(1,3),36),uniqueKey=Number.parseInt(joinGameId.substr(4,2),36);try{url=protocol+servers[server].address}catch(e){return console.log("Game not found - Invalid server: "+url+", "+server),openAlertDialog("Game Not Found","Sorry! This game ID is either<br>invalid, or no longer exists.",{label:"OK"}),uniqueId=0,uniqueKey=0,void(document.getElementById("joinCode").value="")}selectedServer=server}else url=protocol+servers[server].address;showSpinner("Connecting","Please wait!"),console.log("Connecting to: "+url),(ws=new WebSocket(url)).binaryType="arraybuffer",ws.onopen=function(e){console.log("WebSocket opened"),localStorage.setItem("lastUsername",username),ga("send","event","play game","class",classes[playerAccount.classIdx].name),fbq("trackCustom","PlayGame",{charClass:classes[playerAccount.classIdx].name,server:servers[selectedServer].name});var len=14+2*username.length;playerAccount.isLoggedIn&&(console.log("firebase id and session available"),len+=2*playerAccount.firebaseId.length+5);var output=new Comm.output(len);output.packInt8(CommCode.joinGame),output.packInt8(joinType),output.packInt8(gameType),output.packInt16(uniqueId),output.packInt16(uniqueKey),output.packInt8(playerAccount.classIdx),output.packInt8(catalog.get8BitItemId(playerAccount.getPrimaryWeapon(),playerAccount.classIdx)),output.packInt8(catalog.get8BitItemId(playerAccount.getSecondaryWeapon(),playerAccount.classIdx)),output.packInt8(playerAccount.colorIdx),output.packInt8(catalog.get8BitItemId(playerAccount.hatItem,playerAccount.classIdx)),output.packInt8(catalog.get8BitItemId(playerAccount.stampItem,playerAccount.classIdx)),output.packString(username),playerAccount.isLoggedIn&&(output.packInt32(playerAccount.session),output.packString(playerAccount.firebaseId),console.log("firebaseId: "+playerAccount.firebaseId)),ws.send(output.buffer)},ws.onclose=function(e){if(!freezeFrame)if(e.code==CloseCode.gameNotFound)console.log("Game not found - id: "+uniqueId+", key: "+uniqueKey),openAlertDialog("Game Not Found","Sorry! This game ID is either<br>invalid, or no longer exists.",{label:"OK"}),uniqueId=0,uniqueKey=0,document.getElementById("joinCode").value="";else if(e.code==CloseCode.gameFull)console.log("Game full - id: "+uniqueId+", key: "+uniqueKey),openAlertDialog("Game Full","Sorry, this game is currently full!<br>Wait a moment, or try another one!",{label:"OK"});else if(e.code==CloseCode.badName){closeAlertDialog(),openAlertDialog("Invalid Name","I'm going to guess you know why.",{label:"Yes"});var el=document.getElementById("username");el.value="",el.disabled=!1,el.focus(),document.getElementById("playButton").disabled=!1}else if(e.code==CloseCode.mainMenu)console.log("WebSocket closing - returning to Main Menu");else if(e.code==CloseCode.noMasterServer)console.log("Master Server offline"),openAlertDialog("Matchmaker Offline","Sorry! The matchmaker server is currently offline.<br>Please try again in a moment!",{label:"OK"}),uniqueId=0,uniqueKey=0,document.getElementById("joinCode").value="";else if(inGame)console.log("Connection lost: "+e.code+" "+e.reason),openAlertDialog("Connection Lost","Please try a different server,<br>or try again later!",{label:"OK",onclick:reloadPage});else{console.log("Cannot connect: "+e.code+" "+e.reason);openAlertDialog("Cannot Connect",'Please try a different server, reload<br>the page, or try again later!<br><br>Also, visit <a href="http://websocketstest.com" target="_window">websocketstest.com</a> to check for<br>problems with your network and/or system!',{label:"OK",onclick:closeAlertDialog})}},ws.onmessage=function(e){var input=new Comm.input(e.data);switch(input.unPackInt8U()){case CommCode.gameJoined:console.log("CommCode.gameJoined received"),document.getElementById("mainMenu").style.display="none",meId=input.unPackInt8U(),myTeam=input.unPackInt8U(),gameType=input.unPackInt8U(),uniqueId=input.unPackInt16U(),uniqueKey=input.unPackInt16U(),mapIdx=input.unPackInt8U(),playerLimit=input.unPackInt8U(),inGame=!0,startGame()}}}function enableChat(){document.getElementById("enableChat").checked=!0,settings.enableChat=!0,localStorage.setItem("enableChat",!0),chatInEl.value="Press ENTER to chat",inGame&&(chatOutEl.style.display="block",chatInEl.style.display="block")}function disableChat(){settings.enableChat=!1,localStorage.setItem("enableChat",!1),inGame&&(chatOutEl.style.display="none",chatInEl.style.display="none")}function setDetailSettingsVisibility(invisible){for(var els=document.getElementsByName("detail"),i=0;i<els.length;i++)els[i].style.visibility=invisible?"hidden":"visible";!invisible&&inGame?(settings.shadowsEnabled=gameScene.shadowsEnabled,settings.highRes=1==engine.getHardwareScalingLevel(),document.getElementById("shadowsEnabled").checked=settings.shadowsEnabled,document.getElementById("highRes").checked=settings.highRes,localStorage.setItem("shadowsEnabled",settings.shadowsEnabled?"true":"false"),localStorage.setItem("highRes",settings.highRes?"true":"false")):inGame&&(enableShadows(),increaseResolution())}function enableAutoDetail(){var opt=new BABYLON.SceneOptimizerOptions(40,4e3),shadowOpt=new BABYLON.SceneOptimization(0);shadowOpt.apply=disableShadows,opt.optimizations.push(shadowOpt);var scalingOpt=new BABYLON.SceneOptimization(1);scalingOpt.apply=lowerResolution,opt.optimizations.push(scalingOpt),inGame&&BABYLON.SceneOptimizer.OptimizeAsync(gameScene,opt)}function disableAutoDetail(){BABYLON.SceneOptimizer.Stop()}function disableShadows(){return gameScene.shadowsEnabled=!1,mapMesh&&inGame&&(mapMesh.material=gameScene.getMaterialByName("mapNoShadow")),!0}function enableShadows(){gameScene.shadowsEnabled=!0,mapMesh&&inGame&&(mapMesh.material=gameScene.getMaterialByName("map"))}function lowerResolution(){return engine.setHardwareScalingLevel(2),adaptToNewResolution(),!0}function increaseResolution(){engine.setHardwareScalingLevel(1),adaptToNewResolution()}function adaptToNewResolution(){reticle&&reticle.resize(),hitIndicator&&hitIndicator.resize(),scope&&scope.crosshairs.isEnabled()&&scope.show()}function getStoredNumber(name,def){var num=localStorage.getItem(name);return num?Number(num):def}function getStoredBool(name,def){var str=localStorage.getItem(name);return str?"true"==str:def}function getStoredString(name,def){var str=localStorage.getItem(name);return str||def}function refactorConfigKeys(el){var els=document.getElementsByName("config");Array.prototype.slice.call(els).forEach(function(otherEl){otherEl!=el&&otherEl.innerText==el.innerText&&(delete inputToControlMap[otherEl.innerText],otherEl.style.fontWeight="normal",otherEl.style.color="#aaa",otherEl.innerText="undefined")})}function setControl(el){refactorConfigKeys(el),delete inputToControlMap[el.oldText],inputToControlMap[el.innerText]=el.id,controlEl=null,window.onkeydown=null,window.onkeyup=null,localStorage.setItem("controlConfig",JSON.stringify(inputToControlMap))}function startAlertBar(){var el=document.getElementById("alertFooter");el.style.display="block",alertBarInterval=interval.set(function(){el.innerText+="-",el.innerText.length>10&&(el.innerText="-")},200)}function openAlertDialog(header,text,button1,button2,bar){hideSpinner(),showDarkOverlay(),document.getElementById("alert").style.display="block",document.getElementById("alertHeader").innerHTML=header,document.getElementById("alertMessage").innerHTML=text;var e=document.getElementById("alertButton1");button1?(e.style.display="inline-block",e.style.visibility="visible",e.innerHTML=button1.label||"OK",e.style.width=button1.width||"8em",e.style.height=button1.height||"",e.onclick=button1.onclick||closeAlertDialog):e.style.display="none",e=document.getElementById("alertButton2"),button2?(e.style.display="inline-block",e.style.visibility="visible",e.innerHTML=button2.label||"Cancel",e.style.width=button2.width||"8em",e.style.height=button2.height||"",e.onclick=button2.onclick||closeAlertDialog):e.style.display="none",bar?startAlertBar():(document.getElementById("alertFooter").style.display="none",interval.clear(alertBarInterval)),document.exitPointerLock(),window.onkeydown=null,window.onkeyup=null}function closeAlertDialog(){document.getElementById("alert").style.display="none",document.getElementById("alertFooter").style.display="none",document.getElementById("username").disabled=!1,hideDarkOverlay(),clearInterval(alertBarInterval)}function showDarkOverlay(){closeAlertDialog(),document.getElementById("overlay").style.display="block",hideBannerAd(),hideMultisizeBannerAd()}function hideDarkOverlay(){document.getElementById("overlay").style.display="none",showBannerAd()}function showMainMenuConfirm(){var closeFunc=closeAlertDialog;"none"==document.getElementById("gameMenu").style.display&&(closeFunc=showContinueDialog),openAlertDialog("Main Menu","Leave game and return<br>to the main menu?",{label:"Yes",width:"4em",onclick:showMainMenu},{label:"No",width:"4em",onclick:closeFunc})}function reloadPage(){window.location.reload()}function showMainMenu(){if(engine&&engine.stopRenderLoop(),document.body.style.overflow="visible",window.scrollY=0,document.getElementById("menuAdContainer").appendChild(document.getElementById("bannerAdContainer")),document.getElementById("inGameAd").style.display="none;",inGame){me&&(playerAccount.kills+=kills,playerAccount.deaths+=deaths,playerAccount.streak=Math.max(bestOverallStreak,playerAccount.streak),updatePlayerStatsDisplay()),closeAlertDialog(),interval.clearAll(),timeout.clearAll(),pingServers(),hideGameDom(),loadBannerAd();var oneSignalBell=document.getElementById("onesignal-bell-container");if(oneSignalBell&&(oneSignalBell.style.display="inline-block"),ws.close(CloseCode.mainMenu),ws=null,releaseKeys(),gameStartTime>0){var timePlayed=Date.now()-gameStartTime;if(ga("send","timing","game","play time",timePlayed),fbq("trackCustom","EndGame",{timePlayed:timePlayed}),me&&kills>0){var ratio=Math.floor(kills/Math.max(kills+deaths,1)*100);ga("send","event","player stats","kill ratio",classes[me.charClass].name,ratio),ga("send","event","player stats","best kill streak",classes[me.charClass].name,bestOverallStreak)}}gameScene.dispose(),inGame=!1}customizer=new Customizer(function(){onResourcesLoaded()}),extern.customizer=customizer}function openCustomizerFromMainMenu(){hideBannerAd(),hideMultisizeBannerAd(),menuOut("mainMenu"),customizer.open()}function onFullscreenChange(){engine.resize()}function openSettingsMenu(){ga("send","event","open settings"),inGame&&1==settings.enableChat&&initChatIn(),openAlertDialog("Settings","",{label:"Close",width:"6em",onclick:closeSettingsMenu}),document.getElementById("alertMessage").appendChild(document.getElementById("settings")),document.getElementById("settings").style.display="block"}function closeSettingsMenu(){inGame&&captureKeys(),document.getElementById("settings").style.display="none",document.body.appendChild(document.getElementById("settings")),closeAlertDialog()}function getFloatingNameWidth(name,size){var context=nameTestCanvas.getContext("2d");return context.font="bold "+size+"px Nunito, sans-serif",context.measureText(name).width}function fixStringWidth(str,len){len=len||80;var context=nameTestCanvas.getContext("2d");for(context.font="1em Nunito, sans-serif";;){if(context.measureText(str).width<len)break;str=str.substr(0,str.length-1)}return str}function notify(msg,timeout){var e=document.getElementById("notification");e.style.opacity=0,e.style.top="-3.5em",e.style.display="flex",document.getElementById("notificationMessage").innerHTML=msg;var anim=0,animIn=setInterval(function(){anim++,e.style.opacity=anim/8,e.style.top=anim/2-3.5+"em",8==anim&&(clearInterval(animIn),timeout&&setTimeout(function(){dismissNotification()},timeout))},32)}function dismissNotification(callback){var anim=8,e=document.getElementById("notification"),animIn=setInterval(function(){e.style.opacity=anim/8,e.style.top=anim/2-3.5+"em",0==--anim&&(clearInterval(animIn),e.style.display="none",callback&&callback())},32)}function promoteLogin(){var str='Login to enable this feature and others, including:<ul style="text-align: left"><li>Stat tracking - kills, deaths, etc.<li>Custom shell colors<li>Hats and accessories<li>Weapon skins</ul>';inGame?openAlertDialog("Feature Unavailable to Guests",str,{label:"OK",width:"6em",onclick:closeAlertDialog}):openAlertDialog("Feature Unavailable to Guests",str,{label:"Login",width:"6em",onclick:openLoginDialog},{label:"Close",width:"6em",onclick:closeAlertDialog})}function showCornerButtons(){document.getElementById("cornerButtons").style.display="block"}function hideCornerButtons(){document.getElementById("cornerButtons").style.display="none"}function showGameDom(){document.getElementById("game").style.display="block",document.getElementById("readouts").style.display="block",document.getElementById("homeButton").style.display="inline-block",document.getElementById("friendsButton").style.display="inline-block"}function hideGameDom(){document.getElementById("game").style.display="none",document.getElementById("readouts").style.display="none",document.getElementById("homeButton").style.display="none",document.getElementById("friendsButton").style.display="none"}function updatePlayerStatsDisplay(){var ratio=Math.floor(playerAccount.kills/Math.max(playerAccount.deaths,1)*100)/100;document.getElementById("playerStatValues").innerHTML=playerAccount.kills.toLocaleString()+"<br>"+playerAccount.deaths.toLocaleString()+"<br>"+ratio+"<br>"+playerAccount.streak.toLocaleString()}function detectChromebook(){return/\bCrOS\b/.test(navigator.userAgent)}function sendOneSignalTagsForUser(){var numPurchases=void 0===playerAccount.inventory||null===playerAccount.inventory?0:playerAccount.inventory.length;console.log("Sending user tags to OneSignal..."),sendOneSignalTags({user_id:playerAccount.firebaseId,kills:playerAccount.kills,deaths:playerAccount.deaths,kdr:calculateKDR(),num_eggs:playerAccount.currentBalance,num_items_bought:numPurchases,egg_class:playerAccount.classIdx,is_chromebook:detectChromebook()})}function sendOneSignalTagsForAnon(){console.log("Sending anon tags to OneSignal..."),sendOneSignalTags({is_chromebook:detectChromebook()})}function sendOneSignalTags(tags){OneSignal.push(function(){OneSignal.sendTags(tags).then(function(tagsSent){console.log("Completed sending tags to OneSignal")})})}function calculateKDR(){return Math.floor(playerAccount.kills/Math.max(playerAccount.deaths,1)*100)/100}function updateCurrentBalance(){document.getElementById("currentBalanceContainer").style.display="inline-block",document.getElementById("currentBalance").innerText=playerAccount.currentBalance}function menuIn(domName,callback){document.getElementById(domName).style.display="block",callback&&callback()}function menuOut(domName){document.getElementById(domName).style.display="none"}function menuFlexIn(domName){document.getElementById(domName).style.display="flex"}function openConsentNotification(){notify(document.getElementById("consent").innerHTML)}function randomName(){var num,n1=["Captain","Lord","Supreme","Master","Pro","Noob"],n2=["Egg","Yolk","Shell","Cluck","Chick","Bird"];do{num=Math.randomInt(1,99)}while(69==num);return 0==Math.randomInt(0,2)?n1[Math.randomInt(0,n1.length)]+n2[Math.randomInt(0,n2.length)]+num:n2[Math.randomInt(0,n2.length)]+n1[Math.randomInt(0,n1.length)]+num}function checkBalance(){console.log("checkBalance called");try{var servicesWs=new WebSocket(servicesServer)}catch(e){console.log(e)}servicesWs.onopen=function(e){servicesWs.send(JSON.stringify({cmd:"checkBalance",uid:playerAccount.firebaseId})),console.log("servicesWs opened, and checkBalance request sent")},servicesWs.onmessage=function(e){checkBalanceData=JSON.parse(e.data),checkBalanceData.error?console.log("checkBalance Error: "+JSON.stringify(checkBalanceData.error)):playerAccount.currentBalance!=checkBalanceData.current_balance&&(playerAccount.currentBalance=checkBalanceData.current_balance,updateCurrentBalance()),servicesWs.close()},servicesWs.onclose=function(e){console.log("servicesWs closed: "+e.code+" "+e.reason)},servicesWs.onerror=function(e){statsEl.innerHTML='<p style="text-align: left">WebSocket connection failure. Please check your connection at:<br><a href="http://websocketstest.com" target="_window">websocketstest.com</a><br>as well as your firewall and antivirus settings.</p>',console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"]))}}function getXsollaToken(){if(console.log("getXsollaToken called"),purchasingEnabled)console.log("getXsollaToken: purchasing already enabled, skipping");else{try{var servicesWs=new WebSocket(servicesServer)}catch(e){console.log(e)}servicesWs.onopen=function(e){servicesWs.send(JSON.stringify({cmd:"xsollaToken",uid:playerAccount.firebaseId})),console.log("servicesWs opened, and xsollaToken request sent")},servicesWs.onmessage=function(e){getTokenData=JSON.parse(e.data),getTokenData.error?(console.log("getTokenData Error: "+JSON.stringify(getTokenData.error)),disableProductPurchasing()):"SUCCESS"==getTokenData.result?(console.log("got Xsolla token: "+getTokenData.token),enableProductPurchasing(getTokenData.token)):(console.log("failed to get Xsolla token"),disableProductPurchasing()),servicesWs.close()},servicesWs.onclose=function(e){console.log("servicesWs closed: "+e.code+" "+e.reason)},servicesWs.onerror=function(e){disableProductPurchasing()}}}function enableProductPurchasing(xsollaToken){var options={access_token:xsollaToken,sandbox:!1,lightbox:{spinner:"round",overlayOpacity:.8}},s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src="//static.xsolla.com/embed/paystation/1.0.7/widget.min.js",s.addEventListener("load",function(e){XPayStationWidget.on("init",function(e){console.log("store initialized"),XPayStationWidget.open()}),XPayStationWidget.on("close",function(e){console.log("store closed"),setTimeout(function(){checkBalance()},3e3)}),XPayStationWidget.init(options)},!1),document.getElementsByTagName("head")[0].appendChild(s),globalXsollaToken=xsollaToken,purchasingEnabled=!0}function disableProductPurchasing(){purchasingEnabled=!1,openAlertDialog("Uh Oh!","Something broke. Try reloading the game.",null,{label:"OK",width:"4em",onclick:closeAlertDialog})}function customizeWhenReady(){customizeWhenReadyIteration(0)}function customizeWhenReadyIteration(iteration){iteration>=200||(iteration++,void 0!==customizer&&null!==customizer&&!0===customizer.isReady?(customizer.setupItems(),customizer.dressUpEgg()):setTimeout(customizeWhenReady,100,iteration))}function openItemInCustomizer(itemId){if(playerAccount.isLoggedIn){document.getElementById("bigAd").style.display="none",openCustomizerFromMainMenu();var item=catalog.findItemById(itemId);customizer.openToItem(item)}else promoteLogin()}function physicalUnlockOpenStore(){closeAlertDialog(),window.open(customizer.buyingItem.item_data.physicalItemStoreURL,"_blank")}function showSpinner(header,footer){document.getElementById("spinner").style.display="block",document.getElementById("spinnerHeader").innerText=header,document.getElementById("spinnerFooter").innerText=footer}function hideSpinner(){document.getElementById("spinner").style.display="none"}function PlayerActor(player){this.player=player,this.mesh=new BABYLON.TransformNode,this.hat=null;player.hatItem,player.stampItem;this.bodyMesh=scene.cloneMesh("egg",this.mesh),this.bodyMesh.position.y=.32,this.bodyMesh.player=this.player,this.bodyMesh.material=scene.getMaterialByName("eggShell"),this.bodyMesh.material.setTexture("textureSampler",stampTexture),this.explodeMesh=scene.cloneMesh("eggExplode",this.mesh),this.explodeMesh.position.y=.32,this.explodeMesh.parent=this.mesh,this.explodeMesh.setMaterial(scene.getMaterialByName("normalBackFace")),this.explodeMesh.setEnabled(!1),this.whiteMesh=scene.cloneMesh("eggWhite",this.mesh),this.whiteMesh.parent=this.explodeMesh,this.whiteMesh.setEnabled(!1),this.yolkMesh=scene.cloneMesh("eggYolk",this.mesh),this.yolkMesh.parent=this.explodeMesh,this.yolkMesh.setEnabled(!1),this.head=new BABYLON.TransformNode,this.head.parent=this.mesh,this.head.position.y=.3,this.head.position.z=0,this.gunContainer=new BABYLON.TransformNode,this.gunContainer.parent=this.head,this.gunContainer.rotation.y=-.14,this.gunContainer.rotation.x=-.035,this.setupStowAnims(),this.eye=new BABYLON.TransformNode,this.eye.position.y=.1,this.eye.position.x=0,this.eye.parent=this.head,this.hands=scene.cloneMesh("hands",this.gunContainer),this.hands.skeleton=scene.cloneSkeleton("hands_skeleton"),this.hands.material=scene.getMaterialByName("standard"),this.gripBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("gripHand")],this.foreBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("foreHand")],this.bodyMesh.overlayColor=BABYLON.Color3.Green(),this.hands.overlayColor=BABYLON.Color3.Green(),this.player.shield>0&&(this.bodyMesh.renderOverlay=!0,this.hands.renderOverlay=!0),this.setShellColor(this.player.shellColor),shake=0,shadowGen&&shadowGen.getShadowMap().renderList.push(this.bodyMesh),inGame?(this.player.id==meId?this.hands.setRenderingGroupId(1):(this.setupNameSprite(),this.showNameSprite()),inGame&&this.updateTeam()):(this.bodyMesh.outlineColor=teamColors.outline[0].clone(),this.bodyMesh.outlineColor.a=0),this.mesh.position.x=this.player.x,this.mesh.position.y=this.player.y,this.mesh.position.z=this.player.z,this.deathSound=Sounds.shellBurst.clone(),this.player.id==meId?this.hitSound=Sounds.hit.clone():(this.eye.position.y=.5,this.eye.position.x=.1,this.eye.position.z=-1,this.wearHat(this.player.hatItem),this.applyStamp(this.player.stampItem),this.hitSound=this.bodyMesh.attachSound(Sounds.hit)),playOffline&&this.hands.setEnabled(!1),this.bobbleIntensity=0,this.scope=!1,this.zoomed=!1,this.hitSoundDelay=0}function RocketActor(rocket){this.rocket=rocket,this.delayFrames=0,this.mesh=scene.getMeshByName("bullet").createInstance(""),this.mesh.setEnabled(!1)}var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(BABYLON){var KeyboardEventTypes=function(){function KeyboardEventTypes(){}return Object.defineProperty(KeyboardEventTypes,"KEYDOWN",{get:function(){return KeyboardEventTypes._KEYDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(KeyboardEventTypes,"KEYUP",{get:function(){return KeyboardEventTypes._KEYUP},enumerable:!0,configurable:!0}),KeyboardEventTypes._KEYDOWN=1,KeyboardEventTypes._KEYUP=2,KeyboardEventTypes}();BABYLON.KeyboardEventTypes=KeyboardEventTypes;var KeyboardInfo=function(){return function(type,event){this.type=type,this.event=event}}();BABYLON.KeyboardInfo=KeyboardInfo;var KeyboardInfoPre=function(_super){function KeyboardInfoPre(type,event){var _this=_super.call(this,type,event)||this;return _this.skipOnPointerObservable=!1,_this}return __extends(KeyboardInfoPre,_super),KeyboardInfoPre}(KeyboardInfo);BABYLON.KeyboardInfoPre=KeyboardInfoPre}(BABYLON||(BABYLON={}));!function(BABYLON){var PointerEventTypes=function(){function PointerEventTypes(){}return Object.defineProperty(PointerEventTypes,"POINTERDOWN",{get:function(){return PointerEventTypes._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERUP",{get:function(){return PointerEventTypes._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERMOVE",{get:function(){return PointerEventTypes._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERWHEEL",{get:function(){return PointerEventTypes._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERPICK",{get:function(){return PointerEventTypes._POINTERPICK},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERTAP",{get:function(){return PointerEventTypes._POINTERTAP},enumerable:!0,configurable:!0}),Object.defineProperty(PointerEventTypes,"POINTERDOUBLETAP",{get:function(){return PointerEventTypes._POINTERDOUBLETAP},enumerable:!0,configurable:!0}),PointerEventTypes._POINTERDOWN=1,PointerEventTypes._POINTERUP=2,PointerEventTypes._POINTERMOVE=4,PointerEventTypes._POINTERWHEEL=8,PointerEventTypes._POINTERPICK=16,PointerEventTypes._POINTERTAP=32,PointerEventTypes._POINTERDOUBLETAP=64,PointerEventTypes}();BABYLON.PointerEventTypes=PointerEventTypes;var PointerInfoBase=function(){return function(type,event){this.type=type,this.event=event}}();BABYLON.PointerInfoBase=PointerInfoBase;var PointerInfoPre=function(_super){function PointerInfoPre(type,event,localX,localY){var _this=_super.call(this,type,event)||this;return _this.skipOnPointerObservable=!1,_this.localPosition=new BABYLON.Vector2(localX,localY),_this}return __extends(PointerInfoPre,_super),PointerInfoPre}(PointerInfoBase);BABYLON.PointerInfoPre=PointerInfoPre;var PointerInfo=function(_super){function PointerInfo(type,event,pickInfo){var _this=_super.call(this,type,event)||this;return _this.pickInfo=pickInfo,_this}return __extends(PointerInfo,_super),PointerInfo}(PointerInfoBase);BABYLON.PointerInfo=PointerInfo}(BABYLON||(BABYLON={}));!function(BABYLON){BABYLON.ToGammaSpace=1/2.2,BABYLON.ToLinearSpace=2.2,BABYLON.Epsilon=.001;var Color3=function(){function Color3(r,g,b){void 0===r&&(r=0),void 0===g&&(g=0),void 0===b&&(b=0),this.r=r,this.g=g,this.b=b}return Color3.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},Color3.prototype.getClassName=function(){return"Color3"},Color3.prototype.getHashCode=function(){var hash=this.r||0;return hash=397*hash^(this.g||0),hash=397*hash^(this.b||0)},Color3.prototype.toArray=function(array,index){return void 0===index&&(index=0),array[index]=this.r,array[index+1]=this.g,array[index+2]=this.b,this},Color3.prototype.toColor4=function(alpha){return void 0===alpha&&(alpha=1),new Color4(this.r,this.g,this.b,alpha)},Color3.prototype.asArray=function(){var result=new Array;return this.toArray(result,0),result},Color3.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},Color3.prototype.multiply=function(otherColor){return new Color3(this.r*otherColor.r,this.g*otherColor.g,this.b*otherColor.b)},Color3.prototype.multiplyToRef=function(otherColor,result){return result.r=this.r*otherColor.r,result.g=this.g*otherColor.g,result.b=this.b*otherColor.b,this},Color3.prototype.equals=function(otherColor){return otherColor&&this.r===otherColor.r&&this.g===otherColor.g&&this.b===otherColor.b},Color3.prototype.equalsFloats=function(r,g,b){return this.r===r&&this.g===g&&this.b===b},Color3.prototype.scale=function(scale){return new Color3(this.r*scale,this.g*scale,this.b*scale)},Color3.prototype.scaleToRef=function(scale,result){return result.r=this.r*scale,result.g=this.g*scale,result.b=this.b*scale,this},Color3.prototype.add=function(otherColor){return new Color3(this.r+otherColor.r,this.g+otherColor.g,this.b+otherColor.b)},Color3.prototype.addToRef=function(otherColor,result){return result.r=this.r+otherColor.r,result.g=this.g+otherColor.g,result.b=this.b+otherColor.b,this},Color3.prototype.subtract=function(otherColor){return new Color3(this.r-otherColor.r,this.g-otherColor.g,this.b-otherColor.b)},Color3.prototype.subtractToRef=function(otherColor,result){return result.r=this.r-otherColor.r,result.g=this.g-otherColor.g,result.b=this.b-otherColor.b,this},Color3.prototype.clone=function(){return new Color3(this.r,this.g,this.b)},Color3.prototype.copyFrom=function(source){return this.r=source.r,this.g=source.g,this.b=source.b,this},Color3.prototype.copyFromFloats=function(r,g,b){return this.r=r,this.g=g,this.b=b,this},Color3.prototype.set=function(r,g,b){return this.copyFromFloats(r,g,b)},Color3.prototype.toHexString=function(){var intR=255*this.r|0,intG=255*this.g|0,intB=255*this.b|0;return"#"+BABYLON.Scalar.ToHex(intR)+BABYLON.Scalar.ToHex(intG)+BABYLON.Scalar.ToHex(intB)},Color3.prototype.toLinearSpace=function(){var convertedColor=new Color3;return this.toLinearSpaceToRef(convertedColor),convertedColor},Color3.prototype.toLinearSpaceToRef=function(convertedColor){return convertedColor.r=Math.pow(this.r,BABYLON.ToLinearSpace),convertedColor.g=Math.pow(this.g,BABYLON.ToLinearSpace),convertedColor.b=Math.pow(this.b,BABYLON.ToLinearSpace),this},Color3.prototype.toGammaSpace=function(){var convertedColor=new Color3;return this.toGammaSpaceToRef(convertedColor),convertedColor},Color3.prototype.toGammaSpaceToRef=function(convertedColor){return convertedColor.r=Math.pow(this.r,BABYLON.ToGammaSpace),convertedColor.g=Math.pow(this.g,BABYLON.ToGammaSpace),convertedColor.b=Math.pow(this.b,BABYLON.ToGammaSpace),this},Color3.FromHexString=function(hex){if("#"!==hex.substring(0,1)||7!==hex.length)return new Color3(0,0,0);var r=parseInt(hex.substring(1,3),16),g=parseInt(hex.substring(3,5),16),b=parseInt(hex.substring(5,7),16);return Color3.FromInts(r,g,b)},Color3.FromArray=function(array,offset){return void 0===offset&&(offset=0),new Color3(array[offset],array[offset+1],array[offset+2])},Color3.FromInts=function(r,g,b){return new Color3(r/255,g/255,b/255)},Color3.Lerp=function(start,end,amount){return new Color3(start.r+(end.r-start.r)*amount,start.g+(end.g-start.g)*amount,start.b+(end.b-start.b)*amount)},Color3.Red=function(){return new Color3(1,0,0)},Color3.Green=function(){return new Color3(0,1,0)},Color3.Blue=function(){return new Color3(0,0,1)},Color3.Black=function(){return new Color3(0,0,0)},Color3.White=function(){return new Color3(1,1,1)},Color3.Purple=function(){return new Color3(.5,0,.5)},Color3.Magenta=function(){return new Color3(1,0,1)},Color3.Yellow=function(){return new Color3(1,1,0)},Color3.Gray=function(){return new Color3(.5,.5,.5)},Color3.Teal=function(){return new Color3(0,1,1)},Color3.Random=function(){return new Color3(Math.random(),Math.random(),Math.random())},Color3}();BABYLON.Color3=Color3;var Color4=function(){function Color4(r,g,b,a){void 0===r&&(r=0),void 0===g&&(g=0),void 0===b&&(b=0),void 0===a&&(a=1),this.r=r,this.g=g,this.b=b,this.a=a}return Color4.prototype.addInPlace=function(right){return this.r+=right.r,this.g+=right.g,this.b+=right.b,this.a+=right.a,this},Color4.prototype.asArray=function(){var result=new Array;return this.toArray(result,0),result},Color4.prototype.toArray=function(array,index){return void 0===index&&(index=0),array[index]=this.r,array[index+1]=this.g,array[index+2]=this.b,array[index+3]=this.a,this},Color4.prototype.add=function(right){return new Color4(this.r+right.r,this.g+right.g,this.b+right.b,this.a+right.a)},Color4.prototype.subtract=function(right){return new Color4(this.r-right.r,this.g-right.g,this.b-right.b,this.a-right.a)},Color4.prototype.subtractToRef=function(right,result){return result.r=this.r-right.r,result.g=this.g-right.g,result.b=this.b-right.b,result.a=this.a-right.a,this},Color4.prototype.scale=function(scale){return new Color4(this.r*scale,this.g*scale,this.b*scale,this.a*scale)},Color4.prototype.scaleToRef=function(scale,result){return result.r=this.r*scale,result.g=this.g*scale,result.b=this.b*scale,result.a=this.a*scale,this},Color4.prototype.multiply=function(color){return new Color4(this.r*color.r,this.g*color.g,this.b*color.b,this.a*color.a)},Color4.prototype.multiplyToRef=function(color,result){return result.r=this.r*color.r,result.g=this.g*color.g,result.b=this.b*color.b,result.a=this.a*color.a,result},Color4.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},Color4.prototype.getClassName=function(){return"Color4"},Color4.prototype.getHashCode=function(){var hash=this.r||0;return hash=397*hash^(this.g||0),hash=397*hash^(this.b||0),hash=397*hash^(this.a||0)},Color4.prototype.clone=function(){return new Color4(this.r,this.g,this.b,this.a)},Color4.prototype.copyFrom=function(source){return this.r=source.r,this.g=source.g,this.b=source.b,this.a=source.a,this},Color4.prototype.copyFromFloats=function(r,g,b,a){return this.r=r,this.g=g,this.b=b,this.a=a,this},Color4.prototype.set=function(r,g,b,a){return this.copyFromFloats(r,g,b,a)},Color4.prototype.toHexString=function(){var intR=255*this.r|0,intG=255*this.g|0,intB=255*this.b|0,intA=255*this.a|0;return"#"+BABYLON.Scalar.ToHex(intR)+BABYLON.Scalar.ToHex(intG)+BABYLON.Scalar.ToHex(intB)+BABYLON.Scalar.ToHex(intA)},Color4.prototype.toLinearSpace=function(){var convertedColor=new Color4;return this.toLinearSpaceToRef(convertedColor),convertedColor},Color4.prototype.toLinearSpaceToRef=function(convertedColor){return convertedColor.r=Math.pow(this.r,BABYLON.ToLinearSpace),convertedColor.g=Math.pow(this.g,BABYLON.ToLinearSpace),convertedColor.b=Math.pow(this.b,BABYLON.ToLinearSpace),convertedColor.a=this.a,this},Color4.prototype.toGammaSpace=function(){var convertedColor=new Color4;return this.toGammaSpaceToRef(convertedColor),convertedColor},Color4.prototype.toGammaSpaceToRef=function(convertedColor){return convertedColor.r=Math.pow(this.r,BABYLON.ToGammaSpace),convertedColor.g=Math.pow(this.g,BABYLON.ToGammaSpace),convertedColor.b=Math.pow(this.b,BABYLON.ToGammaSpace),convertedColor.a=this.a,this},Color4.FromHexString=function(hex){if("#"!==hex.substring(0,1)||9!==hex.length)return new Color4(0,0,0,0);var r=parseInt(hex.substring(1,3),16),g=parseInt(hex.substring(3,5),16),b=parseInt(hex.substring(5,7),16),a=parseInt(hex.substring(7,9),16);return Color4.FromInts(r,g,b,a)},Color4.Lerp=function(left,right,amount){var result=new Color4(0,0,0,0);return Color4.LerpToRef(left,right,amount,result),result},Color4.LerpToRef=function(left,right,amount,result){result.r=left.r+(right.r-left.r)*amount,result.g=left.g+(right.g-left.g)*amount,result.b=left.b+(right.b-left.b)*amount,result.a=left.a+(right.a-left.a)*amount},Color4.FromArray=function(array,offset){return void 0===offset&&(offset=0),new Color4(array[offset],array[offset+1],array[offset+2],array[offset+3])},Color4.FromInts=function(r,g,b,a){return new Color4(r/255,g/255,b/255,a/255)},Color4.CheckColors4=function(colors,count){if(colors.length===3*count){for(var colors4=[],index=0;index<colors.length;index+=3){var newIndex=index/3*4;colors4[newIndex]=colors[index],colors4[newIndex+1]=colors[index+1],colors4[newIndex+2]=colors[index+2],colors4[newIndex+3]=1}return colors4}return colors},Color4}();BABYLON.Color4=Color4;var Vector2=function(){function Vector2(x,y){this.x=x,this.y=y}return Vector2.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},Vector2.prototype.getClassName=function(){return"Vector2"},Vector2.prototype.getHashCode=function(){var hash=this.x||0;return hash=397*hash^(this.y||0)},Vector2.prototype.toArray=function(array,index){return void 0===index&&(index=0),array[index]=this.x,array[index+1]=this.y,this},Vector2.prototype.asArray=function(){var result=new Array;return this.toArray(result,0),result},Vector2.prototype.copyFrom=function(source){return this.x=source.x,this.y=source.y,this},Vector2.prototype.copyFromFloats=function(x,y){return this.x=x,this.y=y,this},Vector2.prototype.set=function(x,y){return this.copyFromFloats(x,y)},Vector2.prototype.add=function(otherVector){return new Vector2(this.x+otherVector.x,this.y+otherVector.y)},Vector2.prototype.addToRef=function(otherVector,result){return result.x=this.x+otherVector.x,result.y=this.y+otherVector.y,this},Vector2.prototype.addInPlace=function(otherVector){return this.x+=otherVector.x,this.y+=otherVector.y,this},Vector2.prototype.addVector3=function(otherVector){return new Vector2(this.x+otherVector.x,this.y+otherVector.y)},Vector2.prototype.subtract=function(otherVector){return new Vector2(this.x-otherVector.x,this.y-otherVector.y)},Vector2.prototype.subtractToRef=function(otherVector,result){return result.x=this.x-otherVector.x,result.y=this.y-otherVector.y,this},Vector2.prototype.subtractInPlace=function(otherVector){return this.x-=otherVector.x,this.y-=otherVector.y,this},Vector2.prototype.multiplyInPlace=function(otherVector){return this.x*=otherVector.x,this.y*=otherVector.y,this},Vector2.prototype.multiply=function(otherVector){return new Vector2(this.x*otherVector.x,this.y*otherVector.y)},Vector2.prototype.multiplyToRef=function(otherVector,result){return result.x=this.x*otherVector.x,result.y=this.y*otherVector.y,this},Vector2.prototype.multiplyByFloats=function(x,y){return new Vector2(this.x*x,this.y*y)},Vector2.prototype.divide=function(otherVector){return new Vector2(this.x/otherVector.x,this.y/otherVector.y)},Vector2.prototype.divideToRef=function(otherVector,result){return result.x=this.x/otherVector.x,result.y=this.y/otherVector.y,this},Vector2.prototype.negate=function(){return new Vector2(-this.x,-this.y)},Vector2.prototype.scaleInPlace=function(scale){return this.x*=scale,this.y*=scale,this},Vector2.prototype.scale=function(scale){return new Vector2(this.x*scale,this.y*scale)},Vector2.prototype.equals=function(otherVector){return otherVector&&this.x===otherVector.x&&this.y===otherVector.y},Vector2.prototype.equalsWithEpsilon=function(otherVector,epsilon){return void 0===epsilon&&(epsilon=BABYLON.Epsilon),otherVector&&BABYLON.Scalar.WithinEpsilon(this.x,otherVector.x,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.y,otherVector.y,epsilon)},Vector2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector2.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},Vector2.prototype.normalize=function(){var len=this.length();if(0===len)return this;var num=1/len;return this.x*=num,this.y*=num,this},Vector2.prototype.clone=function(){return new Vector2(this.x,this.y)},Vector2.Zero=function(){return new Vector2(0,0)},Vector2.One=function(){return new Vector2(1,1)},Vector2.FromArray=function(array,offset){return void 0===offset&&(offset=0),new Vector2(array[offset],array[offset+1])},Vector2.FromArrayToRef=function(array,offset,result){result.x=array[offset],result.y=array[offset+1]},Vector2.CatmullRom=function(value1,value2,value3,value4,amount){var squared=amount*amount,cubed=amount*squared;return new Vector2(.5*(2*value2.x+(-value1.x+value3.x)*amount+(2*value1.x-5*value2.x+4*value3.x-value4.x)*squared+(-value1.x+3*value2.x-3*value3.x+value4.x)*cubed),.5*(2*value2.y+(-value1.y+value3.y)*amount+(2*value1.y-5*value2.y+4*value3.y-value4.y)*squared+(-value1.y+3*value2.y-3*value3.y+value4.y)*cubed))},Vector2.Clamp=function(value,min,max){var x=value.x;x=(x=x>max.x?max.x:x)<min.x?min.x:x;var y=value.y;return y=y>max.y?max.y:y,y=y<min.y?min.y:y,new Vector2(x,y)},Vector2.Hermite=function(value1,tangent1,value2,tangent2,amount){var squared=amount*amount,cubed=amount*squared,part1=2*cubed-3*squared+1,part2=-2*cubed+3*squared,part3=cubed-2*squared+amount,part4=cubed-squared;return new Vector2(value1.x*part1+value2.x*part2+tangent1.x*part3+tangent2.x*part4,value1.y*part1+value2.y*part2+tangent1.y*part3+tangent2.y*part4)},Vector2.Lerp=function(start,end,amount){return new Vector2(start.x+(end.x-start.x)*amount,start.y+(end.y-start.y)*amount)},Vector2.Dot=function(left,right){return left.x*right.x+left.y*right.y},Vector2.Normalize=function(vector){var newVector=vector.clone();return newVector.normalize(),newVector},Vector2.Minimize=function(left,right){return new Vector2(left.x<right.x?left.x:right.x,left.y<right.y?left.y:right.y)},Vector2.Maximize=function(left,right){return new Vector2(left.x>right.x?left.x:right.x,left.y>right.y?left.y:right.y)},Vector2.Transform=function(vector,transformation){var r=Vector2.Zero();return Vector2.TransformToRef(vector,transformation,r),r},Vector2.TransformToRef=function(vector,transformation,result){var x=vector.x*transformation.m[0]+vector.y*transformation.m[4]+transformation.m[12],y=vector.x*transformation.m[1]+vector.y*transformation.m[5]+transformation.m[13];result.x=x,result.y=y},Vector2.PointInTriangle=function(p,p0,p1,p2){var a=.5*(-p1.y*p2.x+p0.y*(-p1.x+p2.x)+p0.x*(p1.y-p2.y)+p1.x*p2.y),sign=a<0?-1:1,s=(p0.y*p2.x-p0.x*p2.y+(p2.y-p0.y)*p.x+(p0.x-p2.x)*p.y)*sign,t=(p0.x*p1.y-p0.y*p1.x+(p0.y-p1.y)*p.x+(p1.x-p0.x)*p.y)*sign;return s>0&&t>0&&s+t<2*a*sign},Vector2.Distance=function(value1,value2){return Math.sqrt(Vector2.DistanceSquared(value1,value2))},Vector2.DistanceSquared=function(value1,value2){var x=value1.x-value2.x,y=value1.y-value2.y;return x*x+y*y},Vector2.Center=function(value1,value2){var center=value1.add(value2);return center.scaleInPlace(.5),center},Vector2.DistanceOfPointFromSegment=function(p,segA,segB){var l2=Vector2.DistanceSquared(segA,segB);if(0===l2)return Vector2.Distance(p,segA);var v=segB.subtract(segA),t=Math.max(0,Math.min(1,Vector2.Dot(p.subtract(segA),v)/l2)),proj=segA.add(v.multiplyByFloats(t,t));return Vector2.Distance(p,proj)},Vector2}();BABYLON.Vector2=Vector2;var Vector3=function(){function Vector3(x,y,z){this.x=x,this.y=y,this.z=z}return Vector3.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},Vector3.prototype.getClassName=function(){return"Vector3"},Vector3.prototype.getHashCode=function(){var hash=this.x||0;return hash=397*hash^(this.y||0),hash=397*hash^(this.z||0)},Vector3.prototype.asArray=function(){var result=[];return this.toArray(result,0),result},Vector3.prototype.toArray=function(array,index){return void 0===index&&(index=0),array[index]=this.x,array[index+1]=this.y,array[index+2]=this.z,this},Vector3.prototype.toQuaternion=function(){var result=new Quaternion(0,0,0,1),cosxPlusz=Math.cos(.5*(this.x+this.z)),sinxPlusz=Math.sin(.5*(this.x+this.z)),coszMinusx=Math.cos(.5*(this.z-this.x)),sinzMinusx=Math.sin(.5*(this.z-this.x)),cosy=Math.cos(.5*this.y),siny=Math.sin(.5*this.y);return result.x=coszMinusx*siny,result.y=-sinzMinusx*siny,result.z=sinxPlusz*cosy,result.w=cosxPlusz*cosy,result},Vector3.prototype.addInPlace=function(otherVector){return this.x+=otherVector.x,this.y+=otherVector.y,this.z+=otherVector.z,this},Vector3.prototype.add=function(otherVector){return new Vector3(this.x+otherVector.x,this.y+otherVector.y,this.z+otherVector.z)},Vector3.prototype.addToRef=function(otherVector,result){return result.x=this.x+otherVector.x,result.y=this.y+otherVector.y,result.z=this.z+otherVector.z,this},Vector3.prototype.subtractInPlace=function(otherVector){return this.x-=otherVector.x,this.y-=otherVector.y,this.z-=otherVector.z,this},Vector3.prototype.subtract=function(otherVector){return new Vector3(this.x-otherVector.x,this.y-otherVector.y,this.z-otherVector.z)},Vector3.prototype.subtractToRef=function(otherVector,result){return result.x=this.x-otherVector.x,result.y=this.y-otherVector.y,result.z=this.z-otherVector.z,this},Vector3.prototype.subtractFromFloats=function(x,y,z){return new Vector3(this.x-x,this.y-y,this.z-z)},Vector3.prototype.subtractFromFloatsToRef=function(x,y,z,result){return result.x=this.x-x,result.y=this.y-y,result.z=this.z-z,this},Vector3.prototype.negate=function(){return new Vector3(-this.x,-this.y,-this.z)},Vector3.prototype.scaleInPlace=function(scale){return this.x*=scale,this.y*=scale,this.z*=scale,this},Vector3.prototype.scale=function(scale){return new Vector3(this.x*scale,this.y*scale,this.z*scale)},Vector3.prototype.scaleToRef=function(scale,result){return result.x=this.x*scale,result.y=this.y*scale,result.z=this.z*scale,this},Vector3.prototype.equals=function(otherVector){return otherVector&&this.x===otherVector.x&&this.y===otherVector.y&&this.z===otherVector.z},Vector3.prototype.equalsWithEpsilon=function(otherVector,epsilon){return void 0===epsilon&&(epsilon=BABYLON.Epsilon),otherVector&&BABYLON.Scalar.WithinEpsilon(this.x,otherVector.x,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.y,otherVector.y,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.z,otherVector.z,epsilon)},Vector3.prototype.equalsToFloats=function(x,y,z){return this.x===x&&this.y===y&&this.z===z},Vector3.prototype.multiplyInPlace=function(otherVector){return this.x*=otherVector.x,this.y*=otherVector.y,this.z*=otherVector.z,this},Vector3.prototype.multiply=function(otherVector){return new Vector3(this.x*otherVector.x,this.y*otherVector.y,this.z*otherVector.z)},Vector3.prototype.multiplyToRef=function(otherVector,result){return result.x=this.x*otherVector.x,result.y=this.y*otherVector.y,result.z=this.z*otherVector.z,this},Vector3.prototype.multiplyByFloats=function(x,y,z){return new Vector3(this.x*x,this.y*y,this.z*z)},Vector3.prototype.divide=function(otherVector){return new Vector3(this.x/otherVector.x,this.y/otherVector.y,this.z/otherVector.z)},Vector3.prototype.divideToRef=function(otherVector,result){return result.x=this.x/otherVector.x,result.y=this.y/otherVector.y,result.z=this.z/otherVector.z,this},Vector3.prototype.MinimizeInPlace=function(other){return other.x<this.x&&(this.x=other.x),other.y<this.y&&(this.y=other.y),other.z<this.z&&(this.z=other.z),this},Vector3.prototype.MaximizeInPlace=function(other){return other.x>this.x&&(this.x=other.x),other.y>this.y&&(this.y=other.y),other.z>this.z&&(this.z=other.z),this},Object.defineProperty(Vector3.prototype,"isNonUniform",{get:function(){var absX=Math.abs(this.x),absY=Math.abs(this.y);if(absX!==absY)return!0;var absZ=Math.abs(this.z);return absX!==absZ||absY!==absZ},enumerable:!0,configurable:!0}),Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector3.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},Vector3.prototype.normalize=function(){var len=this.length();if(0===len||1===len)return this;var num=1/len;return this.x*=num,this.y*=num,this.z*=num,this},Vector3.prototype.normalizeToNew=function(){var normalized=new Vector3(0,0,0);return this.normalizeToRef(normalized),normalized},Vector3.prototype.normalizeToRef=function(reference){var len=this.length();if(0===len||1===len)return reference.set(this.x,this.y,this.z),reference;var scale=1/len;return this.scaleToRef(scale,reference),reference},Vector3.prototype.clone=function(){return new Vector3(this.x,this.y,this.z)},Vector3.prototype.copyFrom=function(source){return this.x=source.x,this.y=source.y,this.z=source.z,this},Vector3.prototype.copyFromFloats=function(x,y,z){return this.x=x,this.y=y,this.z=z,this},Vector3.prototype.set=function(x,y,z){return this.copyFromFloats(x,y,z)},Vector3.GetClipFactor=function(vector0,vector1,axis,size){var d0=Vector3.Dot(vector0,axis)-size;return d0/(d0-(Vector3.Dot(vector1,axis)-size))},Vector3.FromArray=function(array,offset){return offset||(offset=0),new Vector3(array[offset],array[offset+1],array[offset+2])},Vector3.FromFloatArray=function(array,offset){return Vector3.FromArray(array,offset)},Vector3.FromArrayToRef=function(array,offset,result){result.x=array[offset],result.y=array[offset+1],result.z=array[offset+2]},Vector3.FromFloatArrayToRef=function(array,offset,result){return Vector3.FromArrayToRef(array,offset,result)},Vector3.FromFloatsToRef=function(x,y,z,result){result.x=x,result.y=y,result.z=z},Vector3.Zero=function(){return new Vector3(0,0,0)},Vector3.One=function(){return new Vector3(1,1,1)},Vector3.Up=function(){return new Vector3(0,1,0)},Vector3.Forward=function(){return new Vector3(0,0,1)},Vector3.Right=function(){return new Vector3(1,0,0)},Vector3.Left=function(){return new Vector3(-1,0,0)},Vector3.TransformCoordinates=function(vector,transformation){var result=Vector3.Zero();return Vector3.TransformCoordinatesToRef(vector,transformation,result),result},Vector3.TransformCoordinatesToRef=function(vector,transformation,result){var x=vector.x*transformation.m[0]+vector.y*transformation.m[4]+vector.z*transformation.m[8]+transformation.m[12],y=vector.x*transformation.m[1]+vector.y*transformation.m[5]+vector.z*transformation.m[9]+transformation.m[13],z=vector.x*transformation.m[2]+vector.y*transformation.m[6]+vector.z*transformation.m[10]+transformation.m[14],w=vector.x*transformation.m[3]+vector.y*transformation.m[7]+vector.z*transformation.m[11]+transformation.m[15];result.x=x/w,result.y=y/w,result.z=z/w},Vector3.TransformCoordinatesFromFloatsToRef=function(x,y,z,transformation,result){var rx=x*transformation.m[0]+y*transformation.m[4]+z*transformation.m[8]+transformation.m[12],ry=x*transformation.m[1]+y*transformation.m[5]+z*transformation.m[9]+transformation.m[13],rz=x*transformation.m[2]+y*transformation.m[6]+z*transformation.m[10]+transformation.m[14],rw=x*transformation.m[3]+y*transformation.m[7]+z*transformation.m[11]+transformation.m[15];result.x=rx/rw,result.y=ry/rw,result.z=rz/rw},Vector3.TransformNormal=function(vector,transformation){var result=Vector3.Zero();return Vector3.TransformNormalToRef(vector,transformation,result),result},Vector3.TransformNormalToRef=function(vector,transformation,result){var x=vector.x*transformation.m[0]+vector.y*transformation.m[4]+vector.z*transformation.m[8],y=vector.x*transformation.m[1]+vector.y*transformation.m[5]+vector.z*transformation.m[9],z=vector.x*transformation.m[2]+vector.y*transformation.m[6]+vector.z*transformation.m[10];result.x=x,result.y=y,result.z=z},Vector3.TransformNormalFromFloatsToRef=function(x,y,z,transformation,result){result.x=x*transformation.m[0]+y*transformation.m[4]+z*transformation.m[8],result.y=x*transformation.m[1]+y*transformation.m[5]+z*transformation.m[9],result.z=x*transformation.m[2]+y*transformation.m[6]+z*transformation.m[10]},Vector3.CatmullRom=function(value1,value2,value3,value4,amount){var squared=amount*amount,cubed=amount*squared;return new Vector3(.5*(2*value2.x+(-value1.x+value3.x)*amount+(2*value1.x-5*value2.x+4*value3.x-value4.x)*squared+(-value1.x+3*value2.x-3*value3.x+value4.x)*cubed),.5*(2*value2.y+(-value1.y+value3.y)*amount+(2*value1.y-5*value2.y+4*value3.y-value4.y)*squared+(-value1.y+3*value2.y-3*value3.y+value4.y)*cubed),.5*(2*value2.z+(-value1.z+value3.z)*amount+(2*value1.z-5*value2.z+4*value3.z-value4.z)*squared+(-value1.z+3*value2.z-3*value3.z+value4.z)*cubed))},Vector3.Clamp=function(value,min,max){var x=value.x;x=(x=x>max.x?max.x:x)<min.x?min.x:x;var y=value.y;y=(y=y>max.y?max.y:y)<min.y?min.y:y;var z=value.z;return z=z>max.z?max.z:z,z=z<min.z?min.z:z,new Vector3(x,y,z)},Vector3.Hermite=function(value1,tangent1,value2,tangent2,amount){var squared=amount*amount,cubed=amount*squared,part1=2*cubed-3*squared+1,part2=-2*cubed+3*squared,part3=cubed-2*squared+amount,part4=cubed-squared;return new Vector3(value1.x*part1+value2.x*part2+tangent1.x*part3+tangent2.x*part4,value1.y*part1+value2.y*part2+tangent1.y*part3+tangent2.y*part4,value1.z*part1+value2.z*part2+tangent1.z*part3+tangent2.z*part4)},Vector3.Lerp=function(start,end,amount){var result=new Vector3(0,0,0);return Vector3.LerpToRef(start,end,amount,result),result},Vector3.LerpToRef=function(start,end,amount,result){result.x=start.x+(end.x-start.x)*amount,result.y=start.y+(end.y-start.y)*amount,result.z=start.z+(end.z-start.z)*amount},Vector3.Dot=function(left,right){return left.x*right.x+left.y*right.y+left.z*right.z},Vector3.Cross=function(left,right){var result=Vector3.Zero();return Vector3.CrossToRef(left,right,result),result},Vector3.CrossToRef=function(left,right,result){MathTmp.Vector3[0].x=left.y*right.z-left.z*right.y,MathTmp.Vector3[0].y=left.z*right.x-left.x*right.z,MathTmp.Vector3[0].z=left.x*right.y-left.y*right.x,result.copyFrom(MathTmp.Vector3[0])},Vector3.Normalize=function(vector){var result=Vector3.Zero();return Vector3.NormalizeToRef(vector,result),result},Vector3.NormalizeToRef=function(vector,result){result.copyFrom(vector),result.normalize()},Vector3.Project=function(vector,world,transform,viewport){var cw=viewport.width,ch=viewport.height,cx=viewport.x,cy=viewport.y,viewportMatrix=Vector3._viewportMatrixCache?Vector3._viewportMatrixCache:Vector3._viewportMatrixCache=new Matrix;Matrix.FromValuesToRef(cw/2,0,0,0,0,-ch/2,0,0,0,0,.5,0,cx+cw/2,ch/2+cy,.5,1,viewportMatrix);var matrix=MathTmp.Matrix[0];return world.multiplyToRef(transform,matrix),matrix.multiplyToRef(viewportMatrix,matrix),Vector3.TransformCoordinates(vector,matrix)},Vector3.UnprojectFromTransform=function(source,viewportWidth,viewportHeight,world,transform){var matrix=MathTmp.Matrix[0];world.multiplyToRef(transform,matrix),matrix.invert(),source.x=source.x/viewportWidth*2-1,source.y=-(source.y/viewportHeight*2-1);var vector=Vector3.TransformCoordinates(source,matrix),num=source.x*matrix.m[3]+source.y*matrix.m[7]+source.z*matrix.m[11]+matrix.m[15];return BABYLON.Scalar.WithinEpsilon(num,1)&&(vector=vector.scale(1/num)),vector},Vector3.Unproject=function(source,viewportWidth,viewportHeight,world,view,projection){var result=Vector3.Zero();return Vector3.UnprojectToRef(source,viewportWidth,viewportHeight,world,view,projection,result),result},Vector3.UnprojectToRef=function(source,viewportWidth,viewportHeight,world,view,projection,result){Vector3.UnprojectFloatsToRef(source.x,source.y,source.z,viewportWidth,viewportHeight,world,view,projection,result)},Vector3.UnprojectFloatsToRef=function(sourceX,sourceY,sourceZ,viewportWidth,viewportHeight,world,view,projection,result){var matrix=MathTmp.Matrix[0];world.multiplyToRef(view,matrix),matrix.multiplyToRef(projection,matrix),matrix.invert();var screenSource=MathTmp.Vector3[0];screenSource.x=sourceX/viewportWidth*2-1,screenSource.y=-(sourceY/viewportHeight*2-1),screenSource.z=2*sourceZ-1,Vector3.TransformCoordinatesToRef(screenSource,matrix,result);var num=screenSource.x*matrix.m[3]+screenSource.y*matrix.m[7]+screenSource.z*matrix.m[11]+matrix.m[15];BABYLON.Scalar.WithinEpsilon(num,1)&&result.scaleInPlace(1/num)},Vector3.Minimize=function(left,right){var min=left.clone();return min.MinimizeInPlace(right),min},Vector3.Maximize=function(left,right){var max=left.clone();return max.MaximizeInPlace(right),max},Vector3.Distance=function(value1,value2){return Math.sqrt(Vector3.DistanceSquared(value1,value2))},Vector3.DistanceSquared=function(value1,value2){var x=value1.x-value2.x,y=value1.y-value2.y,z=value1.z-value2.z;return x*x+y*y+z*z},Vector3.Center=function(value1,value2){var center=value1.add(value2);return center.scaleInPlace(.5),center},Vector3.RotationFromAxis=function(axis1,axis2,axis3){var rotation=Vector3.Zero();return Vector3.RotationFromAxisToRef(axis1,axis2,axis3,rotation),rotation},Vector3.RotationFromAxisToRef=function(axis1,axis2,axis3,ref){var quat=MathTmp.Quaternion[0];Quaternion.RotationQuaternionFromAxisToRef(axis1,axis2,axis3,quat),quat.toEulerAnglesToRef(ref)},Vector3}();BABYLON.Vector3=Vector3;var Vector4=function(){function Vector4(x,y,z,w){this.x=x,this.y=y,this.z=z,this.w=w}return Vector4.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},Vector4.prototype.getClassName=function(){return"Vector4"},Vector4.prototype.getHashCode=function(){var hash=this.x||0;return hash=397*hash^(this.y||0),hash=397*hash^(this.z||0),hash=397*hash^(this.w||0)},Vector4.prototype.asArray=function(){var result=new Array;return this.toArray(result,0),result},Vector4.prototype.toArray=function(array,index){return void 0===index&&(index=0),array[index]=this.x,array[index+1]=this.y,array[index+2]=this.z,array[index+3]=this.w,this},Vector4.prototype.addInPlace=function(otherVector){return this.x+=otherVector.x,this.y+=otherVector.y,this.z+=otherVector.z,this.w+=otherVector.w,this},Vector4.prototype.add=function(otherVector){return new Vector4(this.x+otherVector.x,this.y+otherVector.y,this.z+otherVector.z,this.w+otherVector.w)},Vector4.prototype.addToRef=function(otherVector,result){return result.x=this.x+otherVector.x,result.y=this.y+otherVector.y,result.z=this.z+otherVector.z,result.w=this.w+otherVector.w,this},Vector4.prototype.subtractInPlace=function(otherVector){return this.x-=otherVector.x,this.y-=otherVector.y,this.z-=otherVector.z,this.w-=otherVector.w,this},Vector4.prototype.subtract=function(otherVector){return new Vector4(this.x-otherVector.x,this.y-otherVector.y,this.z-otherVector.z,this.w-otherVector.w)},Vector4.prototype.subtractToRef=function(otherVector,result){return result.x=this.x-otherVector.x,result.y=this.y-otherVector.y,result.z=this.z-otherVector.z,result.w=this.w-otherVector.w,this},Vector4.prototype.subtractFromFloats=function(x,y,z,w){return new Vector4(this.x-x,this.y-y,this.z-z,this.w-w)},Vector4.prototype.subtractFromFloatsToRef=function(x,y,z,w,result){return result.x=this.x-x,result.y=this.y-y,result.z=this.z-z,result.w=this.w-w,this},Vector4.prototype.negate=function(){return new Vector4(-this.x,-this.y,-this.z,-this.w)},Vector4.prototype.scaleInPlace=function(scale){return this.x*=scale,this.y*=scale,this.z*=scale,this.w*=scale,this},Vector4.prototype.scale=function(scale){return new Vector4(this.x*scale,this.y*scale,this.z*scale,this.w*scale)},Vector4.prototype.scaleToRef=function(scale,result){return result.x=this.x*scale,result.y=this.y*scale,result.z=this.z*scale,result.w=this.w*scale,this},Vector4.prototype.equals=function(otherVector){return otherVector&&this.x===otherVector.x&&this.y===otherVector.y&&this.z===otherVector.z&&this.w===otherVector.w},Vector4.prototype.equalsWithEpsilon=function(otherVector,epsilon){return void 0===epsilon&&(epsilon=BABYLON.Epsilon),otherVector&&BABYLON.Scalar.WithinEpsilon(this.x,otherVector.x,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.y,otherVector.y,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.z,otherVector.z,epsilon)&&BABYLON.Scalar.WithinEpsilon(this.w,otherVector.w,epsilon)},Vector4.prototype.equalsToFloats=function(x,y,z,w){return this.x===x&&this.y===y&&this.z===z&&this.w===w},Vector4.prototype.multiplyInPlace=function(otherVector){return this.x*=otherVector.x,this.y*=otherVector.y,this.z*=otherVector.z,this.w*=otherVector.w,this},Vector4.prototype.multiply=function(otherVector){return new Vector4(this.x*otherVector.x,this.y*otherVector.y,this.z*otherVector.z,this.w*otherVector.w)},Vector4.prototype.multiplyToRef=function(otherVector,result){return result.x=this.x*otherVector.x,result.y=this.y*otherVector.y,result.z=this.z*otherVector.z,result.w=this.w*otherVector.w,this},Vector4.prototype.multiplyByFloats=function(x,y,z,w){return new Vector4(this.x*x,this.y*y,this.z*z,this.w*w)},Vector4.prototype.divide=function(otherVector){return new Vector4(this.x/otherVector.x,this.y/otherVector.y,this.z/otherVector.z,this.w/otherVector.w)},Vector4.prototype.divideToRef=function(otherVector,result){return result.x=this.x/otherVector.x,result.y=this.y/otherVector.y,result.z=this.z/otherVector.z,result.w=this.w/otherVector.w,this},Vector4.prototype.MinimizeInPlace=function(other){return other.x<this.x&&(this.x=other.x),other.y<this.y&&(this.y=other.y),other.z<this.z&&(this.z=other.z),other.w<this.w&&(this.w=other.w),this},Vector4.prototype.MaximizeInPlace=function(other){return other.x>this.x&&(this.x=other.x),other.y>this.y&&(this.y=other.y),other.z>this.z&&(this.z=other.z),other.w>this.w&&(this.w=other.w),this},Vector4.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},Vector4.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},Vector4.prototype.normalize=function(){var len=this.length();if(0===len)return this;var num=1/len;return this.x*=num,this.y*=num,this.z*=num,this.w*=num,this},Vector4.prototype.toVector3=function(){return new Vector3(this.x,this.y,this.z)},Vector4.prototype.clone=function(){return new Vector4(this.x,this.y,this.z,this.w)},Vector4.prototype.copyFrom=function(source){return this.x=source.x,this.y=source.y,this.z=source.z,this.w=source.w,this},Vector4.prototype.copyFromFloats=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Vector4.prototype.set=function(x,y,z,w){return this.copyFromFloats(x,y,z,w)},Vector4.FromArray=function(array,offset){return offset||(offset=0),new Vector4(array[offset],array[offset+1],array[offset+2],array[offset+3])},Vector4.FromArrayToRef=function(array,offset,result){result.x=array[offset],result.y=array[offset+1],result.z=array[offset+2],result.w=array[offset+3]},Vector4.FromFloatArrayToRef=function(array,offset,result){Vector4.FromArrayToRef(array,offset,result)},Vector4.FromFloatsToRef=function(x,y,z,w,result){result.x=x,result.y=y,result.z=z,result.w=w},Vector4.Zero=function(){return new Vector4(0,0,0,0)},Vector4.One=function(){return new Vector4(1,1,1,1)},Vector4.Normalize=function(vector){var result=Vector4.Zero();return Vector4.NormalizeToRef(vector,result),result},Vector4.NormalizeToRef=function(vector,result){result.copyFrom(vector),result.normalize()},Vector4.Minimize=function(left,right){var min=left.clone();return min.MinimizeInPlace(right),min},Vector4.Maximize=function(left,right){var max=left.clone();return max.MaximizeInPlace(right),max},Vector4.Distance=function(value1,value2){return Math.sqrt(Vector4.DistanceSquared(value1,value2))},Vector4.DistanceSquared=function(value1,value2){var x=value1.x-value2.x,y=value1.y-value2.y,z=value1.z-value2.z,w=value1.w-value2.w;return x*x+y*y+z*z+w*w},Vector4.Center=function(value1,value2){var center=value1.add(value2);return center.scaleInPlace(.5),center},Vector4.TransformNormal=function(vector,transformation){var result=Vector4.Zero();return Vector4.TransformNormalToRef(vector,transformation,result),result},Vector4.TransformNormalToRef=function(vector,transformation,result){var x=vector.x*transformation.m[0]+vector.y*transformation.m[4]+vector.z*transformation.m[8],y=vector.x*transformation.m[1]+vector.y*transformation.m[5]+vector.z*transformation.m[9],z=vector.x*transformation.m[2]+vector.y*transformation.m[6]+vector.z*transformation.m[10];result.x=x,result.y=y,result.z=z,result.w=vector.w},Vector4.TransformNormalFromFloatsToRef=function(x,y,z,w,transformation,result){result.x=x*transformation.m[0]+y*transformation.m[4]+z*transformation.m[8],result.y=x*transformation.m[1]+y*transformation.m[5]+z*transformation.m[9],result.z=x*transformation.m[2]+y*transformation.m[6]+z*transformation.m[10],result.w=w},Vector4}();BABYLON.Vector4=Vector4;var Size=function(){function Size(width,height){this.width=width,this.height=height}return Size.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},Size.prototype.getClassName=function(){return"Size"},Size.prototype.getHashCode=function(){var hash=this.width||0;return hash=397*hash^(this.height||0)},Size.prototype.copyFrom=function(src){this.width=src.width,this.height=src.height},Size.prototype.copyFromFloats=function(width,height){return this.width=width,this.height=height,this},Size.prototype.set=function(width,height){return this.copyFromFloats(width,height)},Size.prototype.multiplyByFloats=function(w,h){return new Size(this.width*w,this.height*h)},Size.prototype.clone=function(){return new Size(this.width,this.height)},Size.prototype.equals=function(other){return!!other&&(this.width===other.width&&this.height===other.height)},Object.defineProperty(Size.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Size.Zero=function(){return new Size(0,0)},Size.prototype.add=function(otherSize){return new Size(this.width+otherSize.width,this.height+otherSize.height)},Size.prototype.subtract=function(otherSize){return new Size(this.width-otherSize.width,this.height-otherSize.height)},Size.Lerp=function(start,end,amount){return new Size(start.width+(end.width-start.width)*amount,start.height+(end.height-start.height)*amount)},Size}();BABYLON.Size=Size;var Quaternion=function(){function Quaternion(x,y,z,w){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0),void 0===w&&(w=1),this.x=x,this.y=y,this.z=z,this.w=w}return Quaternion.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},Quaternion.prototype.getClassName=function(){return"Quaternion"},Quaternion.prototype.getHashCode=function(){var hash=this.x||0;return hash=397*hash^(this.y||0),hash=397*hash^(this.z||0),hash=397*hash^(this.w||0)},Quaternion.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},Quaternion.prototype.equals=function(otherQuaternion){return otherQuaternion&&this.x===otherQuaternion.x&&this.y===otherQuaternion.y&&this.z===otherQuaternion.z&&this.w===otherQuaternion.w},Quaternion.prototype.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)},Quaternion.prototype.copyFrom=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this.w=other.w,this},Quaternion.prototype.copyFromFloats=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Quaternion.prototype.set=function(x,y,z,w){return this.copyFromFloats(x,y,z,w)},Quaternion.prototype.add=function(other){return new Quaternion(this.x+other.x,this.y+other.y,this.z+other.z,this.w+other.w)},Quaternion.prototype.subtract=function(other){return new Quaternion(this.x-other.x,this.y-other.y,this.z-other.z,this.w-other.w)},Quaternion.prototype.scale=function(value){return new Quaternion(this.x*value,this.y*value,this.z*value,this.w*value)},Quaternion.prototype.multiply=function(q1){var result=new Quaternion(0,0,0,1);return this.multiplyToRef(q1,result),result},Quaternion.prototype.multiplyToRef=function(q1,result){var x=this.x*q1.w+this.y*q1.z-this.z*q1.y+this.w*q1.x,y=-this.x*q1.z+this.y*q1.w+this.z*q1.x+this.w*q1.y,z=this.x*q1.y-this.y*q1.x+this.z*q1.w+this.w*q1.z,w=-this.x*q1.x-this.y*q1.y-this.z*q1.z+this.w*q1.w;return result.copyFromFloats(x,y,z,w),this},Quaternion.prototype.multiplyInPlace=function(q1){return this.multiplyToRef(q1,this),this},Quaternion.prototype.conjugateToRef=function(ref){return ref.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},Quaternion.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},Quaternion.prototype.conjugate=function(){return new Quaternion(-this.x,-this.y,-this.z,this.w)},Quaternion.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},Quaternion.prototype.normalize=function(){var length=1/this.length();return this.x*=length,this.y*=length,this.z*=length,this.w*=length,this},Quaternion.prototype.toEulerAngles=function(order){void 0===order&&(order="YZX");var result=Vector3.Zero();return this.toEulerAnglesToRef(result,order),result},Quaternion.prototype.toEulerAnglesToRef=function(result,order){void 0===order&&(order="YZX");var qz=this.z,qx=this.x,qy=this.y,qw=this.w,sqw=qw*qw,sqz=qz*qz,sqx=qx*qx,sqy=qy*qy,zAxisY=qy*qz-qx*qw;return zAxisY<-.4999999?(result.y=2*Math.atan2(qy,qw),result.x=Math.PI/2,result.z=0):zAxisY>.4999999?(result.y=2*Math.atan2(qy,qw),result.x=-Math.PI/2,result.z=0):(result.z=Math.atan2(2*(qx*qy+qz*qw),-sqz-sqx+sqy+sqw),result.x=Math.asin(-2*(qz*qy-qx*qw)),result.y=Math.atan2(2*(qz*qx+qy*qw),sqz-sqx-sqy+sqw)),this},Quaternion.prototype.toRotationMatrix=function(result){var xx=this.x*this.x,yy=this.y*this.y,zz=this.z*this.z,xy=this.x*this.y,zw=this.z*this.w,zx=this.z*this.x,yw=this.y*this.w,yz=this.y*this.z,xw=this.x*this.w;return result.m[0]=1-2*(yy+zz),result.m[1]=2*(xy+zw),result.m[2]=2*(zx-yw),result.m[3]=0,result.m[4]=2*(xy-zw),result.m[5]=1-2*(zz+xx),result.m[6]=2*(yz+xw),result.m[7]=0,result.m[8]=2*(zx+yw),result.m[9]=2*(yz-xw),result.m[10]=1-2*(yy+xx),result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result.m[15]=1,result._markAsUpdated(),this},Quaternion.prototype.fromRotationMatrix=function(matrix){return Quaternion.FromRotationMatrixToRef(matrix,this),this},Quaternion.FromRotationMatrix=function(matrix){var result=new Quaternion;return Quaternion.FromRotationMatrixToRef(matrix,result),result},Quaternion.FromRotationMatrixToRef=function(matrix,result){var s,data=matrix.m,m11=data[0],m12=data[4],m13=data[8],m21=data[1],m22=data[5],m23=data[9],m31=data[2],m32=data[6],m33=data[10],trace=m11+m22+m33;trace>0?(s=.5/Math.sqrt(trace+1),result.w=.25/s,result.x=(m32-m23)*s,result.y=(m13-m31)*s,result.z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*Math.sqrt(1+m11-m22-m33),result.w=(m32-m23)/s,result.x=.25*s,result.y=(m12+m21)/s,result.z=(m13+m31)/s):m22>m33?(s=2*Math.sqrt(1+m22-m11-m33),result.w=(m13-m31)/s,result.x=(m12+m21)/s,result.y=.25*s,result.z=(m23+m32)/s):(s=2*Math.sqrt(1+m33-m11-m22),result.w=(m21-m12)/s,result.x=(m13+m31)/s,result.y=(m23+m32)/s,result.z=.25*s)},Quaternion.Zero=function(){return new Quaternion(0,0,0,0)},Quaternion.Inverse=function(q){return new Quaternion(-q.x,-q.y,-q.z,q.w)},Quaternion.Identity=function(){return new Quaternion(0,0,0,1)},Quaternion.IsIdentity=function(quaternion){return quaternion&&0===quaternion.x&&0===quaternion.y&&0===quaternion.z&&1===quaternion.w},Quaternion.RotationAxis=function(axis,angle){return Quaternion.RotationAxisToRef(axis,angle,new Quaternion)},Quaternion.RotationAxisToRef=function(axis,angle,result){var sin=Math.sin(angle/2);return axis.normalize(),result.w=Math.cos(angle/2),result.x=axis.x*sin,result.y=axis.y*sin,result.z=axis.z*sin,result},Quaternion.FromArray=function(array,offset){return offset||(offset=0),new Quaternion(array[offset],array[offset+1],array[offset+2],array[offset+3])},Quaternion.RotationYawPitchRoll=function(yaw,pitch,roll){var q=new Quaternion;return Quaternion.RotationYawPitchRollToRef(yaw,pitch,roll,q),q},Quaternion.RotationYawPitchRollToRef=function(yaw,pitch,roll,result){var halfRoll=.5*roll,halfPitch=.5*pitch,halfYaw=.5*yaw,sinRoll=Math.sin(halfRoll),cosRoll=Math.cos(halfRoll),sinPitch=Math.sin(halfPitch),cosPitch=Math.cos(halfPitch),sinYaw=Math.sin(halfYaw),cosYaw=Math.cos(halfYaw);result.x=cosYaw*sinPitch*cosRoll+sinYaw*cosPitch*sinRoll,result.y=sinYaw*cosPitch*cosRoll-cosYaw*sinPitch*sinRoll,result.z=cosYaw*cosPitch*sinRoll-sinYaw*sinPitch*cosRoll,result.w=cosYaw*cosPitch*cosRoll+sinYaw*sinPitch*sinRoll},Quaternion.RotationAlphaBetaGamma=function(alpha,beta,gamma){var result=new Quaternion;return Quaternion.RotationAlphaBetaGammaToRef(alpha,beta,gamma,result),result},Quaternion.RotationAlphaBetaGammaToRef=function(alpha,beta,gamma,result){var halfGammaPlusAlpha=.5*(gamma+alpha),halfGammaMinusAlpha=.5*(gamma-alpha),halfBeta=.5*beta;result.x=Math.cos(halfGammaMinusAlpha)*Math.sin(halfBeta),result.y=Math.sin(halfGammaMinusAlpha)*Math.sin(halfBeta),result.z=Math.sin(halfGammaPlusAlpha)*Math.cos(halfBeta),result.w=Math.cos(halfGammaPlusAlpha)*Math.cos(halfBeta)},Quaternion.RotationQuaternionFromAxis=function(axis1,axis2,axis3,ref){var quat=new Quaternion(0,0,0,0);return Quaternion.RotationQuaternionFromAxisToRef(axis1,axis2,axis3,quat),quat},Quaternion.RotationQuaternionFromAxisToRef=function(axis1,axis2,axis3,ref){var rotMat=MathTmp.Matrix[0];BABYLON.Matrix.FromXYZAxesToRef(axis1.normalize(),axis2.normalize(),axis3.normalize(),rotMat),BABYLON.Quaternion.FromRotationMatrixToRef(rotMat,ref)},Quaternion.Slerp=function(left,right,amount){var result=Quaternion.Identity();return Quaternion.SlerpToRef(left,right,amount,result),result},Quaternion.SlerpToRef=function(left,right,amount,result){var num2,num3,num=amount,num4=left.x*right.x+left.y*right.y+left.z*right.z+left.w*right.w,flag=!1;if(num4<0&&(flag=!0,num4=-num4),num4>.999999)num3=1-num,num2=flag?-num:num;else{var num5=Math.acos(num4),num6=1/Math.sin(num5);num3=Math.sin((1-num)*num5)*num6,num2=flag?-Math.sin(num*num5)*num6:Math.sin(num*num5)*num6}result.x=num3*left.x+num2*right.x,result.y=num3*left.y+num2*right.y,result.z=num3*left.z+num2*right.z,result.w=num3*left.w+num2*right.w},Quaternion.Hermite=function(value1,tangent1,value2,tangent2,amount){var squared=amount*amount,cubed=amount*squared,part1=2*cubed-3*squared+1,part2=-2*cubed+3*squared,part3=cubed-2*squared+amount,part4=cubed-squared;return new Quaternion(value1.x*part1+value2.x*part2+tangent1.x*part3+tangent2.x*part4,value1.y*part1+value2.y*part2+tangent1.y*part3+tangent2.y*part4,value1.z*part1+value2.z*part2+tangent1.z*part3+tangent2.z*part4,value1.w*part1+value2.w*part2+tangent1.w*part3+tangent2.w*part4)},Quaternion}();BABYLON.Quaternion=Quaternion;var Matrix=function(){function Matrix(){this._isIdentity=!1,this._isIdentityDirty=!0,this.m=new Float32Array(16),this._markAsUpdated()}return Matrix.prototype._markAsUpdated=function(){this.updateFlag=Matrix._updateFlagSeed++,this._isIdentityDirty=!0},Matrix.prototype.isIdentity=function(considerAsTextureMatrix){return void 0===considerAsTextureMatrix&&(considerAsTextureMatrix=!1),this._isIdentityDirty&&(this._isIdentityDirty=!1,1!==this.m[0]||1!==this.m[5]||1!==this.m[15]?this._isIdentity=!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?this._isIdentity=!1:this._isIdentity=!0,considerAsTextureMatrix||1===this.m[10]||(this._isIdentity=!1)),this._isIdentity},Matrix.prototype.determinant=function(){var temp1=this.m[10]*this.m[15]-this.m[11]*this.m[14],temp2=this.m[9]*this.m[15]-this.m[11]*this.m[13],temp3=this.m[9]*this.m[14]-this.m[10]*this.m[13],temp4=this.m[8]*this.m[15]-this.m[11]*this.m[12],temp5=this.m[8]*this.m[14]-this.m[10]*this.m[12],temp6=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*temp1-this.m[6]*temp2+this.m[7]*temp3)-this.m[1]*(this.m[4]*temp1-this.m[6]*temp4+this.m[7]*temp5)+this.m[2]*(this.m[4]*temp2-this.m[5]*temp4+this.m[7]*temp6)-this.m[3]*(this.m[4]*temp3-this.m[5]*temp5+this.m[6]*temp6)},Matrix.prototype.toArray=function(){return this.m},Matrix.prototype.asArray=function(){return this.toArray()},Matrix.prototype.invert=function(){return this.invertToRef(this),this},Matrix.prototype.reset=function(){for(var index=0;index<16;index++)this.m[index]=0;return this._markAsUpdated(),this},Matrix.prototype.add=function(other){var result=new Matrix;return this.addToRef(other,result),result},Matrix.prototype.addToRef=function(other,result){for(var index=0;index<16;index++)result.m[index]=this.m[index]+other.m[index];return result._markAsUpdated(),this},Matrix.prototype.addToSelf=function(other){for(var index=0;index<16;index++)this.m[index]+=other.m[index];return this._markAsUpdated(),this},Matrix.prototype.invertToRef=function(other){var l1=this.m[0],l2=this.m[1],l3=this.m[2],l4=this.m[3],l5=this.m[4],l6=this.m[5],l7=this.m[6],l8=this.m[7],l9=this.m[8],l10=this.m[9],l11=this.m[10],l12=this.m[11],l13=this.m[12],l14=this.m[13],l15=this.m[14],l16=this.m[15],l17=l11*l16-l12*l15,l18=l10*l16-l12*l14,l19=l10*l15-l11*l14,l20=l9*l16-l12*l13,l21=l9*l15-l11*l13,l22=l9*l14-l10*l13,l23=l6*l17-l7*l18+l8*l19,l24=-(l5*l17-l7*l20+l8*l21),l25=l5*l18-l6*l20+l8*l22,l26=-(l5*l19-l6*l21+l7*l22),l27=1/(l1*l23+l2*l24+l3*l25+l4*l26),l28=l7*l16-l8*l15,l29=l6*l16-l8*l14,l30=l6*l15-l7*l14,l31=l5*l16-l8*l13,l32=l5*l15-l7*l13,l33=l5*l14-l6*l13,l34=l7*l12-l8*l11,l35=l6*l12-l8*l10,l36=l6*l11-l7*l10,l37=l5*l12-l8*l9,l38=l5*l11-l7*l9,l39=l5*l10-l6*l9;return other.m[0]=l23*l27,other.m[4]=l24*l27,other.m[8]=l25*l27,other.m[12]=l26*l27,other.m[1]=-(l2*l17-l3*l18+l4*l19)*l27,other.m[5]=(l1*l17-l3*l20+l4*l21)*l27,other.m[9]=-(l1*l18-l2*l20+l4*l22)*l27,other.m[13]=(l1*l19-l2*l21+l3*l22)*l27,other.m[2]=(l2*l28-l3*l29+l4*l30)*l27,other.m[6]=-(l1*l28-l3*l31+l4*l32)*l27,other.m[10]=(l1*l29-l2*l31+l4*l33)*l27,other.m[14]=-(l1*l30-l2*l32+l3*l33)*l27,other.m[3]=-(l2*l34-l3*l35+l4*l36)*l27,other.m[7]=(l1*l34-l3*l37+l4*l38)*l27,other.m[11]=-(l1*l35-l2*l37+l4*l39)*l27,other.m[15]=(l1*l36-l2*l38+l3*l39)*l27,other._markAsUpdated(),this},Matrix.prototype.setTranslationFromFloats=function(x,y,z){return this.m[12]=x,this.m[13]=y,this.m[14]=z,this._markAsUpdated(),this},Matrix.prototype.setTranslation=function(vector3){return this.m[12]=vector3.x,this.m[13]=vector3.y,this.m[14]=vector3.z,this._markAsUpdated(),this},Matrix.prototype.getTranslation=function(){return new Vector3(this.m[12],this.m[13],this.m[14])},Matrix.prototype.getTranslationToRef=function(result){return result.x=this.m[12],result.y=this.m[13],result.z=this.m[14],this},Matrix.prototype.removeRotationAndScaling=function(){return this.setRowFromFloats(0,1,0,0,0),this.setRowFromFloats(1,0,1,0,0),this.setRowFromFloats(2,0,0,1,0),this},Matrix.prototype.multiply=function(other){var result=new Matrix;return this.multiplyToRef(other,result),result},Matrix.prototype.copyFrom=function(other){for(var index=0;index<16;index++)this.m[index]=other.m[index];return this._markAsUpdated(),this},Matrix.prototype.copyToArray=function(array,offset){void 0===offset&&(offset=0);for(var index=0;index<16;index++)array[offset+index]=this.m[index];return this},Matrix.prototype.multiplyToRef=function(other,result){return this.multiplyToArray(other,result.m,0),result._markAsUpdated(),this},Matrix.prototype.multiplyToArray=function(other,result,offset){var tm0=this.m[0],tm1=this.m[1],tm2=this.m[2],tm3=this.m[3],tm4=this.m[4],tm5=this.m[5],tm6=this.m[6],tm7=this.m[7],tm8=this.m[8],tm9=this.m[9],tm10=this.m[10],tm11=this.m[11],tm12=this.m[12],tm13=this.m[13],tm14=this.m[14],tm15=this.m[15],om0=other.m[0],om1=other.m[1],om2=other.m[2],om3=other.m[3],om4=other.m[4],om5=other.m[5],om6=other.m[6],om7=other.m[7],om8=other.m[8],om9=other.m[9],om10=other.m[10],om11=other.m[11],om12=other.m[12],om13=other.m[13],om14=other.m[14],om15=other.m[15];return result[offset]=tm0*om0+tm1*om4+tm2*om8+tm3*om12,result[offset+1]=tm0*om1+tm1*om5+tm2*om9+tm3*om13,result[offset+2]=tm0*om2+tm1*om6+tm2*om10+tm3*om14,result[offset+3]=tm0*om3+tm1*om7+tm2*om11+tm3*om15,result[offset+4]=tm4*om0+tm5*om4+tm6*om8+tm7*om12,result[offset+5]=tm4*om1+tm5*om5+tm6*om9+tm7*om13,result[offset+6]=tm4*om2+tm5*om6+tm6*om10+tm7*om14,result[offset+7]=tm4*om3+tm5*om7+tm6*om11+tm7*om15,result[offset+8]=tm8*om0+tm9*om4+tm10*om8+tm11*om12,result[offset+9]=tm8*om1+tm9*om5+tm10*om9+tm11*om13,result[offset+10]=tm8*om2+tm9*om6+tm10*om10+tm11*om14,result[offset+11]=tm8*om3+tm9*om7+tm10*om11+tm11*om15,result[offset+12]=tm12*om0+tm13*om4+tm14*om8+tm15*om12,result[offset+13]=tm12*om1+tm13*om5+tm14*om9+tm15*om13,result[offset+14]=tm12*om2+tm13*om6+tm14*om10+tm15*om14,result[offset+15]=tm12*om3+tm13*om7+tm14*om11+tm15*om15,this},Matrix.prototype.equals=function(value){return value&&this.m[0]===value.m[0]&&this.m[1]===value.m[1]&&this.m[2]===value.m[2]&&this.m[3]===value.m[3]&&this.m[4]===value.m[4]&&this.m[5]===value.m[5]&&this.m[6]===value.m[6]&&this.m[7]===value.m[7]&&this.m[8]===value.m[8]&&this.m[9]===value.m[9]&&this.m[10]===value.m[10]&&this.m[11]===value.m[11]&&this.m[12]===value.m[12]&&this.m[13]===value.m[13]&&this.m[14]===value.m[14]&&this.m[15]===value.m[15]},Matrix.prototype.clone=function(){return Matrix.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},Matrix.prototype.getClassName=function(){return"Matrix"},Matrix.prototype.getHashCode=function(){for(var hash=this.m[0]||0,i=1;i<16;i++)hash=397*hash^(this.m[i]||0);return hash},Matrix.prototype.decompose=function(scale,rotation,translation){return translation.x=this.m[12],translation.y=this.m[13],translation.z=this.m[14],scale.x=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),scale.y=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),scale.z=Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),this.determinant()<=0&&(scale.y*=-1),0===scale.x||0===scale.y||0===scale.z?(rotation.x=0,rotation.y=0,rotation.z=0,rotation.w=1,!1):(Matrix.FromValuesToRef(this.m[0]/scale.x,this.m[1]/scale.x,this.m[2]/scale.x,0,this.m[4]/scale.y,this.m[5]/scale.y,this.m[6]/scale.y,0,this.m[8]/scale.z,this.m[9]/scale.z,this.m[10]/scale.z,0,0,0,0,1,MathTmp.Matrix[0]),Quaternion.FromRotationMatrixToRef(MathTmp.Matrix[0],rotation),!0)},Matrix.prototype.getRotationMatrix=function(){var result=Matrix.Identity();return this.getRotationMatrixToRef(result),result},Matrix.prototype.getRotationMatrixToRef=function(result){var m=this.m,xs=m[0]*m[1]*m[2]*m[3]<0?-1:1,ys=m[4]*m[5]*m[6]*m[7]<0?-1:1,zs=m[8]*m[9]*m[10]*m[11]<0?-1:1,sx=xs*Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),sy=ys*Math.sqrt(m[4]*m[4]+m[5]*m[5]+m[6]*m[6]),sz=zs*Math.sqrt(m[8]*m[8]+m[9]*m[9]+m[10]*m[10]);return Matrix.FromValuesToRef(m[0]/sx,m[1]/sx,m[2]/sx,0,m[4]/sy,m[5]/sy,m[6]/sy,0,m[8]/sz,m[9]/sz,m[10]/sz,0,0,0,0,1,result),this},Matrix.FromArray=function(array,offset){var result=new Matrix;return offset||(offset=0),Matrix.FromArrayToRef(array,offset,result),result},Matrix.FromArrayToRef=function(array,offset,result){for(var index=0;index<16;index++)result.m[index]=array[index+offset];result._markAsUpdated()},Matrix.FromFloat32ArrayToRefScaled=function(array,offset,scale,result){for(var index=0;index<16;index++)result.m[index]=array[index+offset]*scale;result._markAsUpdated()},Matrix.FromValuesToRef=function(initialM11,initialM12,initialM13,initialM14,initialM21,initialM22,initialM23,initialM24,initialM31,initialM32,initialM33,initialM34,initialM41,initialM42,initialM43,initialM44,result){result.m[0]=initialM11,result.m[1]=initialM12,result.m[2]=initialM13,result.m[3]=initialM14,result.m[4]=initialM21,result.m[5]=initialM22,result.m[6]=initialM23,result.m[7]=initialM24,result.m[8]=initialM31,result.m[9]=initialM32,result.m[10]=initialM33,result.m[11]=initialM34,result.m[12]=initialM41,result.m[13]=initialM42,result.m[14]=initialM43,result.m[15]=initialM44,result._markAsUpdated()},Matrix.prototype.getRow=function(index){if(index<0||index>3)return null;var i=4*index;return new Vector4(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},Matrix.prototype.setRow=function(index,row){if(index<0||index>3)return this;var i=4*index;return this.m[i+0]=row.x,this.m[i+1]=row.y,this.m[i+2]=row.z,this.m[i+3]=row.w,this._markAsUpdated(),this},Matrix.prototype.transpose=function(){return Matrix.Transpose(this)},Matrix.prototype.transposeToRef=function(result){return Matrix.TransposeToRef(this,result),this},Matrix.prototype.setRowFromFloats=function(index,x,y,z,w){if(index<0||index>3)return this;var i=4*index;return this.m[i+0]=x,this.m[i+1]=y,this.m[i+2]=z,this.m[i+3]=w,this._markAsUpdated(),this},Object.defineProperty(Matrix,"IdentityReadOnly",{get:function(){return Matrix._identityReadOnly},enumerable:!0,configurable:!0}),Matrix.FromValues=function(initialM11,initialM12,initialM13,initialM14,initialM21,initialM22,initialM23,initialM24,initialM31,initialM32,initialM33,initialM34,initialM41,initialM42,initialM43,initialM44){var result=new Matrix;return result.m[0]=initialM11,result.m[1]=initialM12,result.m[2]=initialM13,result.m[3]=initialM14,result.m[4]=initialM21,result.m[5]=initialM22,result.m[6]=initialM23,result.m[7]=initialM24,result.m[8]=initialM31,result.m[9]=initialM32,result.m[10]=initialM33,result.m[11]=initialM34,result.m[12]=initialM41,result.m[13]=initialM42,result.m[14]=initialM43,result.m[15]=initialM44,result},Matrix.Compose=function(scale,rotation,translation){var result=Matrix.Identity();return Matrix.ComposeToRef(scale,rotation,translation,result),result},Matrix.ComposeToRef=function(scale,rotation,translation,result){Matrix.FromValuesToRef(scale.x,0,0,0,0,scale.y,0,0,0,0,scale.z,0,0,0,0,1,MathTmp.Matrix[1]),rotation.toRotationMatrix(MathTmp.Matrix[0]),MathTmp.Matrix[1].multiplyToRef(MathTmp.Matrix[0],result),result.setTranslation(translation)},Matrix.Identity=function(){return Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Matrix.IdentityToRef=function(result){Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,result)},Matrix.Zero=function(){return Matrix.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},Matrix.RotationX=function(angle){var result=new Matrix;return Matrix.RotationXToRef(angle,result),result},Matrix.Invert=function(source){var result=new Matrix;return source.invertToRef(result),result},Matrix.RotationXToRef=function(angle,result){var s=Math.sin(angle),c=Math.cos(angle);result.m[0]=1,result.m[15]=1,result.m[5]=c,result.m[10]=c,result.m[9]=-s,result.m[6]=s,result.m[1]=0,result.m[2]=0,result.m[3]=0,result.m[4]=0,result.m[7]=0,result.m[8]=0,result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result._markAsUpdated()},Matrix.RotationY=function(angle){var result=new Matrix;return Matrix.RotationYToRef(angle,result),result},Matrix.RotationYToRef=function(angle,result){var s=Math.sin(angle),c=Math.cos(angle);result.m[5]=1,result.m[15]=1,result.m[0]=c,result.m[2]=-s,result.m[8]=s,result.m[10]=c,result.m[1]=0,result.m[3]=0,result.m[4]=0,result.m[6]=0,result.m[7]=0,result.m[9]=0,result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result._markAsUpdated()},Matrix.RotationZ=function(angle){var result=new Matrix;return Matrix.RotationZToRef(angle,result),result},Matrix.RotationZToRef=function(angle,result){var s=Math.sin(angle),c=Math.cos(angle);result.m[10]=1,result.m[15]=1,result.m[0]=c,result.m[1]=s,result.m[4]=-s,result.m[5]=c,result.m[2]=0,result.m[3]=0,result.m[6]=0,result.m[7]=0,result.m[8]=0,result.m[9]=0,result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result._markAsUpdated()},Matrix.RotationAxis=function(axis,angle){var result=Matrix.Zero();return Matrix.RotationAxisToRef(axis,angle,result),result},Matrix.RotationAxisToRef=function(axis,angle,result){var s=Math.sin(-angle),c=Math.cos(-angle),c1=1-c;axis.normalize(),result.m[0]=axis.x*axis.x*c1+c,result.m[1]=axis.x*axis.y*c1-axis.z*s,result.m[2]=axis.x*axis.z*c1+axis.y*s,result.m[3]=0,result.m[4]=axis.y*axis.x*c1+axis.z*s,result.m[5]=axis.y*axis.y*c1+c,result.m[6]=axis.y*axis.z*c1-axis.x*s,result.m[7]=0,result.m[8]=axis.z*axis.x*c1-axis.y*s,result.m[9]=axis.z*axis.y*c1+axis.x*s,result.m[10]=axis.z*axis.z*c1+c,result.m[11]=0,result.m[15]=1,result._markAsUpdated()},Matrix.RotationYawPitchRoll=function(yaw,pitch,roll){var result=new Matrix;return Matrix.RotationYawPitchRollToRef(yaw,pitch,roll,result),result},Matrix.RotationYawPitchRollToRef=function(yaw,pitch,roll,result){Quaternion.RotationYawPitchRollToRef(yaw,pitch,roll,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(result)},Matrix.Scaling=function(x,y,z){var result=Matrix.Zero();return Matrix.ScalingToRef(x,y,z,result),result},Matrix.ScalingToRef=function(x,y,z,result){result.m[0]=x,result.m[1]=0,result.m[2]=0,result.m[3]=0,result.m[4]=0,result.m[5]=y,result.m[6]=0,result.m[7]=0,result.m[8]=0,result.m[9]=0,result.m[10]=z,result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result.m[15]=1,result._markAsUpdated()},Matrix.Translation=function(x,y,z){var result=Matrix.Identity();return Matrix.TranslationToRef(x,y,z,result),result},Matrix.TranslationToRef=function(x,y,z,result){Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,x,y,z,1,result)},Matrix.Lerp=function(startValue,endValue,gradient){for(var result=Matrix.Zero(),index=0;index<16;index++)result.m[index]=startValue.m[index]*(1-gradient)+endValue.m[index]*gradient;return result._markAsUpdated(),result},Matrix.DecomposeLerp=function(startValue,endValue,gradient){var startScale=new Vector3(0,0,0),startRotation=new Quaternion,startTranslation=new Vector3(0,0,0);startValue.decompose(startScale,startRotation,startTranslation);var endScale=new Vector3(0,0,0),endRotation=new Quaternion,endTranslation=new Vector3(0,0,0);endValue.decompose(endScale,endRotation,endTranslation);var resultScale=Vector3.Lerp(startScale,endScale,gradient),resultRotation=Quaternion.Slerp(startRotation,endRotation,gradient),resultTranslation=Vector3.Lerp(startTranslation,endTranslation,gradient);return Matrix.Compose(resultScale,resultRotation,resultTranslation)},Matrix.LookAtLH=function(eye,target,up){var result=Matrix.Zero();return Matrix.LookAtLHToRef(eye,target,up,result),result},Matrix.LookAtLHToRef=function(eye,target,up,result){target.subtractToRef(eye,this._zAxis),this._zAxis.normalize(),Vector3.CrossToRef(up,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),Vector3.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var ex=-Vector3.Dot(this._xAxis,eye),ey=-Vector3.Dot(this._yAxis,eye),ez=-Vector3.Dot(this._zAxis,eye);return Matrix.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,ex,ey,ez,1,result)},Matrix.LookAtRH=function(eye,target,up){var result=Matrix.Zero();return Matrix.LookAtRHToRef(eye,target,up,result),result},Matrix.LookAtRHToRef=function(eye,target,up,result){eye.subtractToRef(target,this._zAxis),this._zAxis.normalize(),Vector3.CrossToRef(up,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),Vector3.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var ex=-Vector3.Dot(this._xAxis,eye),ey=-Vector3.Dot(this._yAxis,eye),ez=-Vector3.Dot(this._zAxis,eye);return Matrix.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,ex,ey,ez,1,result)},Matrix.OrthoLH=function(width,height,znear,zfar){var matrix=Matrix.Zero();return Matrix.OrthoLHToRef(width,height,znear,zfar,matrix),matrix},Matrix.OrthoLHToRef=function(width,height,znear,zfar,result){var n=znear,f=zfar,a=2/width,b=2/height,c=2/(f-n),d=-(f+n)/(f-n);BABYLON.Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,0,0,0,d,1,result)},Matrix.OrthoOffCenterLH=function(left,right,bottom,top,znear,zfar){var matrix=Matrix.Zero();return Matrix.OrthoOffCenterLHToRef(left,right,bottom,top,znear,zfar,matrix),matrix},Matrix.OrthoOffCenterLHToRef=function(left,right,bottom,top,znear,zfar,result){var n=znear,f=zfar,a=2/(right-left),b=2/(top-bottom),c=2/(f-n),d=-(f+n)/(f-n),i0=(left+right)/(left-right),i1=(top+bottom)/(bottom-top);BABYLON.Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,0,i0,i1,d,1,result)},Matrix.OrthoOffCenterRH=function(left,right,bottom,top,znear,zfar){var matrix=Matrix.Zero();return Matrix.OrthoOffCenterRHToRef(left,right,bottom,top,znear,zfar,matrix),matrix},Matrix.OrthoOffCenterRHToRef=function(left,right,bottom,top,znear,zfar,result){Matrix.OrthoOffCenterLHToRef(left,right,bottom,top,znear,zfar,result),result.m[10]*=-1},Matrix.PerspectiveLH=function(width,height,znear,zfar){var matrix=Matrix.Zero(),n=znear,f=zfar,a=2*n/width,b=2*n/height,c=(f+n)/(f-n),d=-2*f*n/(f-n);return BABYLON.Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,1,0,0,d,0,matrix),matrix},Matrix.PerspectiveFovLH=function(fov,aspect,znear,zfar){var matrix=Matrix.Zero();return Matrix.PerspectiveFovLHToRef(fov,aspect,znear,zfar,matrix),matrix},Matrix.PerspectiveFovLHToRef=function(fov,aspect,znear,zfar,result,isVerticalFovFixed){void 0===isVerticalFovFixed&&(isVerticalFovFixed=!0);var n=znear,f=zfar,t=1/Math.tan(.5*fov),a=isVerticalFovFixed?t/aspect:t,b=isVerticalFovFixed?t:t*aspect,c=(f+n)/(f-n),d=-2*f*n/(f-n);BABYLON.Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,1,0,0,d,0,result)},Matrix.PerspectiveFovRH=function(fov,aspect,znear,zfar){var matrix=Matrix.Zero();return Matrix.PerspectiveFovRHToRef(fov,aspect,znear,zfar,matrix),matrix},Matrix.PerspectiveFovRHToRef=function(fov,aspect,znear,zfar,result,isVerticalFovFixed){void 0===isVerticalFovFixed&&(isVerticalFovFixed=!0);var n=znear,f=zfar,t=1/Math.tan(.5*fov),a=isVerticalFovFixed?t/aspect:t,b=isVerticalFovFixed?t:t*aspect,c=-(f+n)/(f-n),d=-2*f*n/(f-n);BABYLON.Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,-1,0,0,d,0,result)},Matrix.PerspectiveFovWebVRToRef=function(fov,znear,zfar,result,rightHanded){void 0===rightHanded&&(rightHanded=!1);var rightHandedFactor=rightHanded?-1:1,upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);result.m[0]=xScale,result.m[1]=result.m[2]=result.m[3]=result.m[4]=0,result.m[5]=yScale,result.m[6]=result.m[7]=0,result.m[8]=(leftTan-rightTan)*xScale*.5,result.m[9]=-(upTan-downTan)*yScale*.5,result.m[10]=-zfar/(znear-zfar),result.m[11]=1*rightHandedFactor,result.m[12]=result.m[13]=result.m[15]=0,result.m[14]=-2*zfar*znear/(zfar-znear),result._markAsUpdated()},Matrix.GetFinalMatrix=function(viewport,world,view,projection,zmin,zmax){var cw=viewport.width,ch=viewport.height,cx=viewport.x,cy=viewport.y,viewportMatrix=Matrix.FromValues(cw/2,0,0,0,0,-ch/2,0,0,0,0,zmax-zmin,0,cx+cw/2,ch/2+cy,zmin,1);return world.multiply(view).multiply(projection).multiply(viewportMatrix)},Matrix.GetAsMatrix2x2=function(matrix){return new Float32Array([matrix.m[0],matrix.m[1],matrix.m[4],matrix.m[5]])},Matrix.GetAsMatrix3x3=function(matrix){return new Float32Array([matrix.m[0],matrix.m[1],matrix.m[2],matrix.m[4],matrix.m[5],matrix.m[6],matrix.m[8],matrix.m[9],matrix.m[10]])},Matrix.Transpose=function(matrix){var result=new Matrix;return Matrix.TransposeToRef(matrix,result),result},Matrix.TransposeToRef=function(matrix,result){result.m[0]=matrix.m[0],result.m[1]=matrix.m[4],result.m[2]=matrix.m[8],result.m[3]=matrix.m[12],result.m[4]=matrix.m[1],result.m[5]=matrix.m[5],result.m[6]=matrix.m[9],result.m[7]=matrix.m[13],result.m[8]=matrix.m[2],result.m[9]=matrix.m[6],result.m[10]=matrix.m[10],result.m[11]=matrix.m[14],result.m[12]=matrix.m[3],result.m[13]=matrix.m[7],result.m[14]=matrix.m[11],result.m[15]=matrix.m[15]},Matrix.Reflection=function(plane){var matrix=new Matrix;return Matrix.ReflectionToRef(plane,matrix),matrix},Matrix.ReflectionToRef=function(plane,result){plane.normalize();var x=plane.normal.x,y=plane.normal.y,z=plane.normal.z,temp=-2*x,temp2=-2*y,temp3=-2*z;result.m[0]=temp*x+1,result.m[1]=temp2*x,result.m[2]=temp3*x,result.m[3]=0,result.m[4]=temp*y,result.m[5]=temp2*y+1,result.m[6]=temp3*y,result.m[7]=0,result.m[8]=temp*z,result.m[9]=temp2*z,result.m[10]=temp3*z+1,result.m[11]=0,result.m[12]=temp*plane.d,result.m[13]=temp2*plane.d,result.m[14]=temp3*plane.d,result.m[15]=1,result._markAsUpdated()},Matrix.FromXYZAxesToRef=function(xaxis,yaxis,zaxis,result){result.m[0]=xaxis.x,result.m[1]=xaxis.y,result.m[2]=xaxis.z,result.m[3]=0,result.m[4]=yaxis.x,result.m[5]=yaxis.y,result.m[6]=yaxis.z,result.m[7]=0,result.m[8]=zaxis.x,result.m[9]=zaxis.y,result.m[10]=zaxis.z,result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result.m[15]=1,result._markAsUpdated()},Matrix.FromQuaternionToRef=function(quat,result){var xx=quat.x*quat.x,yy=quat.y*quat.y,zz=quat.z*quat.z,xy=quat.x*quat.y,zw=quat.z*quat.w,zx=quat.z*quat.x,yw=quat.y*quat.w,yz=quat.y*quat.z,xw=quat.x*quat.w;result.m[0]=1-2*(yy+zz),result.m[1]=2*(xy+zw),result.m[2]=2*(zx-yw),result.m[3]=0,result.m[4]=2*(xy-zw),result.m[5]=1-2*(zz+xx),result.m[6]=2*(yz+xw),result.m[7]=0,result.m[8]=2*(zx+yw),result.m[9]=2*(yz-xw),result.m[10]=1-2*(yy+xx),result.m[11]=0,result.m[12]=0,result.m[13]=0,result.m[14]=0,result.m[15]=1,result._markAsUpdated()},Matrix._tempQuaternion=new Quaternion,Matrix._xAxis=Vector3.Zero(),Matrix._yAxis=Vector3.Zero(),Matrix._zAxis=Vector3.Zero(),Matrix._updateFlagSeed=0,Matrix._identityReadOnly=Matrix.Identity(),Matrix}();BABYLON.Matrix=Matrix;var Plane=function(){function Plane(a,b,c,d){this.normal=new Vector3(a,b,c),this.d=d}return Plane.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},Plane.prototype.clone=function(){return new Plane(this.normal.x,this.normal.y,this.normal.z,this.d)},Plane.prototype.getClassName=function(){return"Plane"},Plane.prototype.getHashCode=function(){var hash=this.normal.getHashCode();return hash=397*hash^(this.d||0)},Plane.prototype.normalize=function(){var norm=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),magnitude=0;return 0!==norm&&(magnitude=1/norm),this.normal.x*=magnitude,this.normal.y*=magnitude,this.normal.z*=magnitude,this.d*=magnitude,this},Plane.prototype.transform=function(transformation){var transposedMatrix=Matrix.Transpose(transformation),x=this.normal.x,y=this.normal.y,z=this.normal.z,d=this.d;return new Plane(x*transposedMatrix.m[0]+y*transposedMatrix.m[1]+z*transposedMatrix.m[2]+d*transposedMatrix.m[3],x*transposedMatrix.m[4]+y*transposedMatrix.m[5]+z*transposedMatrix.m[6]+d*transposedMatrix.m[7],x*transposedMatrix.m[8]+y*transposedMatrix.m[9]+z*transposedMatrix.m[10]+d*transposedMatrix.m[11],x*transposedMatrix.m[12]+y*transposedMatrix.m[13]+z*transposedMatrix.m[14]+d*transposedMatrix.m[15])},Plane.prototype.dotCoordinate=function(point){return this.normal.x*point.x+this.normal.y*point.y+this.normal.z*point.z+this.d},Plane.prototype.copyFromPoints=function(point1,point2,point3){var invPyth,x1=point2.x-point1.x,y1=point2.y-point1.y,z1=point2.z-point1.z,x2=point3.x-point1.x,y2=point3.y-point1.y,z2=point3.z-point1.z,yz=y1*z2-z1*y2,xz=z1*x2-x1*z2,xy=x1*y2-y1*x2,pyth=Math.sqrt(yz*yz+xz*xz+xy*xy);return invPyth=0!==pyth?1/pyth:0,this.normal.x=yz*invPyth,this.normal.y=xz*invPyth,this.normal.z=xy*invPyth,this.d=-(this.normal.x*point1.x+this.normal.y*point1.y+this.normal.z*point1.z),this},Plane.prototype.isFrontFacingTo=function(direction,epsilon){return Vector3.Dot(this.normal,direction)<=epsilon},Plane.prototype.signedDistanceTo=function(point){return Vector3.Dot(point,this.normal)+this.d},Plane.FromArray=function(array){return new Plane(array[0],array[1],array[2],array[3])},Plane.FromPoints=function(point1,point2,point3){var result=new Plane(0,0,0,0);return result.copyFromPoints(point1,point2,point3),result},Plane.FromPositionAndNormal=function(origin,normal){var result=new Plane(0,0,0,0);return normal.normalize(),result.normal=normal,result.d=-(normal.x*origin.x+normal.y*origin.y+normal.z*origin.z),result},Plane.SignedDistanceToPlaneFromPositionAndNormal=function(origin,normal,point){var d=-(normal.x*origin.x+normal.y*origin.y+normal.z*origin.z);return Vector3.Dot(point,normal)+d},Plane}();BABYLON.Plane=Plane;var Viewport=function(){function Viewport(x,y,width,height){this.x=x,this.y=y,this.width=width,this.height=height}return Viewport.prototype.toGlobal=function(renderWidthOrEngine,renderHeight){if(renderWidthOrEngine.getRenderWidth){var engine=renderWidthOrEngine;return this.toGlobal(engine.getRenderWidth(),engine.getRenderHeight())}var renderWidth=renderWidthOrEngine;return new Viewport(this.x*renderWidth,this.y*renderHeight,this.width*renderWidth,this.height*renderHeight)},Viewport.prototype.clone=function(){return new Viewport(this.x,this.y,this.width,this.height)},Viewport}();BABYLON.Viewport=Viewport;var Frustum=function(){function Frustum(){}return Frustum.GetPlanes=function(transform){for(var frustumPlanes=[],index=0;index<6;index++)frustumPlanes.push(new Plane(0,0,0,0));return Frustum.GetPlanesToRef(transform,frustumPlanes),frustumPlanes},Frustum.GetNearPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]+transform.m[2],frustumPlane.normal.y=transform.m[7]+transform.m[6],frustumPlane.normal.z=transform.m[11]+transform.m[10],frustumPlane.d=transform.m[15]+transform.m[14],frustumPlane.normalize()},Frustum.GetFarPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]-transform.m[2],frustumPlane.normal.y=transform.m[7]-transform.m[6],frustumPlane.normal.z=transform.m[11]-transform.m[10],frustumPlane.d=transform.m[15]-transform.m[14],frustumPlane.normalize()},Frustum.GetLeftPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]+transform.m[0],frustumPlane.normal.y=transform.m[7]+transform.m[4],frustumPlane.normal.z=transform.m[11]+transform.m[8],frustumPlane.d=transform.m[15]+transform.m[12],frustumPlane.normalize()},Frustum.GetRightPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]-transform.m[0],frustumPlane.normal.y=transform.m[7]-transform.m[4],frustumPlane.normal.z=transform.m[11]-transform.m[8],frustumPlane.d=transform.m[15]-transform.m[12],frustumPlane.normalize()},Frustum.GetTopPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]-transform.m[1],frustumPlane.normal.y=transform.m[7]-transform.m[5],frustumPlane.normal.z=transform.m[11]-transform.m[9],frustumPlane.d=transform.m[15]-transform.m[13],frustumPlane.normalize()},Frustum.GetBottomPlaneToRef=function(transform,frustumPlane){frustumPlane.normal.x=transform.m[3]+transform.m[1],frustumPlane.normal.y=transform.m[7]+transform.m[5],frustumPlane.normal.z=transform.m[11]+transform.m[9],frustumPlane.d=transform.m[15]+transform.m[13],frustumPlane.normalize()},Frustum.GetPlanesToRef=function(transform,frustumPlanes){Frustum.GetNearPlaneToRef(transform,frustumPlanes[0]),Frustum.GetFarPlaneToRef(transform,frustumPlanes[1]),Frustum.GetLeftPlaneToRef(transform,frustumPlanes[2]),Frustum.GetRightPlaneToRef(transform,frustumPlanes[3]),Frustum.GetTopPlaneToRef(transform,frustumPlanes[4]),Frustum.GetBottomPlaneToRef(transform,frustumPlanes[5])},Frustum}();BABYLON.Frustum=Frustum;!function(Space){Space[Space.LOCAL=0]="LOCAL",Space[Space.WORLD=1]="WORLD",Space[Space.BONE=2]="BONE"}(BABYLON.Space||(BABYLON.Space={}));var Axis=function(){function Axis(){}return Axis.X=new Vector3(1,0,0),Axis.Y=new Vector3(0,1,0),Axis.Z=new Vector3(0,0,1),Axis}();BABYLON.Axis=Axis;var BezierCurve=function(){function BezierCurve(){}return BezierCurve.interpolate=function(t,x1,y1,x2,y2){for(var f0=1-3*x2+3*x1,f1=3*x2-6*x1,f2=3*x1,refinedT=t,i=0;i<5;i++){var refinedT2=refinedT*refinedT;refinedT-=(f0*(refinedT2*refinedT)+f1*refinedT2+f2*refinedT-t)*(1/(3*f0*refinedT2+2*f1*refinedT+f2)),refinedT=Math.min(1,Math.max(0,refinedT))}return 3*Math.pow(1-refinedT,2)*refinedT*y1+3*(1-refinedT)*Math.pow(refinedT,2)*y2+Math.pow(refinedT,3)},BezierCurve}();BABYLON.BezierCurve=BezierCurve;var Orientation;!function(Orientation){Orientation[Orientation.CW=0]="CW",Orientation[Orientation.CCW=1]="CCW"}(Orientation=BABYLON.Orientation||(BABYLON.Orientation={}));var Angle=function(){function Angle(radians){var _this=this;this.degrees=function(){return 180*_this._radians/Math.PI},this.radians=function(){return _this._radians},this._radians=radians,this._radians<0&&(this._radians+=2*Math.PI)}return Angle.BetweenTwoPoints=function(a,b){var delta=b.subtract(a);return new Angle(Math.atan2(delta.y,delta.x))},Angle.FromRadians=function(radians){return new Angle(radians)},Angle.FromDegrees=function(degrees){return new Angle(degrees*Math.PI/180)},Angle}();BABYLON.Angle=Angle;var Arc2=function(){return function(startPoint,midPoint,endPoint){this.startPoint=startPoint,this.midPoint=midPoint,this.endPoint=endPoint;var temp=Math.pow(midPoint.x,2)+Math.pow(midPoint.y,2),startToMid=(Math.pow(startPoint.x,2)+Math.pow(startPoint.y,2)-temp)/2,midToEnd=(temp-Math.pow(endPoint.x,2)-Math.pow(endPoint.y,2))/2,det=(startPoint.x-midPoint.x)*(midPoint.y-endPoint.y)-(midPoint.x-endPoint.x)*(startPoint.y-midPoint.y);this.centerPoint=new Vector2((startToMid*(midPoint.y-endPoint.y)-midToEnd*(startPoint.y-midPoint.y))/det,((startPoint.x-midPoint.x)*midToEnd-(midPoint.x-endPoint.x)*startToMid)/det),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);var a1=this.startAngle.degrees(),a2=Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),a3=Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();a2-a1>180&&(a2-=360),a2-a1<-180&&(a2+=360),a3-a2>180&&(a3-=360),a3-a2<-180&&(a3+=360),this.orientation=a2-a1<0?Orientation.CW:Orientation.CCW,this.angle=Angle.FromDegrees(this.orientation===Orientation.CW?a1-a3:a3-a1)}}();BABYLON.Arc2=Arc2;var Path2=function(){function Path2(x,y){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new Vector2(x,y))}return Path2.prototype.addLineTo=function(x,y){if(this.closed)return this;var newPoint=new Vector2(x,y),previousPoint=this._points[this._points.length-1];return this._points.push(newPoint),this._length+=newPoint.subtract(previousPoint).length(),this},Path2.prototype.addArcTo=function(midX,midY,endX,endY,numberOfSegments){if(void 0===numberOfSegments&&(numberOfSegments=36),this.closed)return this;var startPoint=this._points[this._points.length-1],midPoint=new Vector2(midX,midY),endPoint=new Vector2(endX,endY),arc=new Arc2(startPoint,midPoint,endPoint),increment=arc.angle.radians()/numberOfSegments;arc.orientation===Orientation.CW&&(increment*=-1);for(var currentAngle=arc.startAngle.radians()+increment,i=0;i<numberOfSegments;i++){var x=Math.cos(currentAngle)*arc.radius+arc.centerPoint.x,y=Math.sin(currentAngle)*arc.radius+arc.centerPoint.y;this.addLineTo(x,y),currentAngle+=increment}return this},Path2.prototype.close=function(){return this.closed=!0,this},Path2.prototype.length=function(){var result=this._length;if(!this.closed){var lastPoint=this._points[this._points.length-1];result+=this._points[0].subtract(lastPoint).length()}return result},Path2.prototype.getPoints=function(){return this._points},Path2.prototype.getPointAtLengthPosition=function(normalizedLengthPosition){if(normalizedLengthPosition<0||normalizedLengthPosition>1)return Vector2.Zero();for(var lengthPosition=normalizedLengthPosition*this.length(),previousOffset=0,i=0;i<this._points.length;i++){var j=(i+1)%this._points.length,a=this._points[i],bToA=this._points[j].subtract(a),nextOffset=bToA.length()+previousOffset;if(lengthPosition>=previousOffset&&lengthPosition<=nextOffset){var dir=bToA.normalize(),localOffset=lengthPosition-previousOffset;return new Vector2(a.x+dir.x*localOffset,a.y+dir.y*localOffset)}previousOffset=nextOffset}return Vector2.Zero()},Path2.StartingAt=function(x,y){return new Path2(x,y)},Path2}();BABYLON.Path2=Path2;var Path3D=function(){function Path3D(path,firstNormal,raw){void 0===firstNormal&&(firstNormal=null),this.path=path,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var p=0;p<path.length;p++)this._curve[p]=path[p].clone();this._raw=raw||!1,this._compute(firstNormal)}return Path3D.prototype.getCurve=function(){return this._curve},Path3D.prototype.getTangents=function(){return this._tangents},Path3D.prototype.getNormals=function(){return this._normals},Path3D.prototype.getBinormals=function(){return this._binormals},Path3D.prototype.getDistances=function(){return this._distances},Path3D.prototype.update=function(path,firstNormal){void 0===firstNormal&&(firstNormal=null);for(var p=0;p<path.length;p++)this._curve[p].x=path[p].x,this._curve[p].y=path[p].y,this._curve[p].z=path[p].z;return this._compute(firstNormal),this},Path3D.prototype._compute=function(firstNormal){var l=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[l-1]=this._curve[l-1].subtract(this._curve[l-2]),this._raw||this._tangents[l-1].normalize();var tg0=this._tangents[0],pp0=this._normalVector(this._curve[0],tg0,firstNormal);this._normals[0]=pp0,this._raw||this._normals[0].normalize(),this._binormals[0]=Vector3.Cross(tg0,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var prev,cur,curTang,prevBinor,i=1;i<l;i++)prev=this._getLastNonNullVector(i),i<l-1&&(cur=this._getFirstNonNullVector(i),this._tangents[i]=prev.add(cur),this._tangents[i].normalize()),this._distances[i]=this._distances[i-1]+prev.length(),curTang=this._tangents[i],prevBinor=this._binormals[i-1],this._normals[i]=Vector3.Cross(prevBinor,curTang),this._raw||this._normals[i].normalize(),this._binormals[i]=Vector3.Cross(curTang,this._normals[i]),this._raw||this._binormals[i].normalize()},Path3D.prototype._getFirstNonNullVector=function(index){for(var i=1,nNVector=this._curve[index+i].subtract(this._curve[index]);0===nNVector.length()&&index+i+1<this._curve.length;)i++,nNVector=this._curve[index+i].subtract(this._curve[index]);return nNVector},Path3D.prototype._getLastNonNullVector=function(index){for(var i=1,nLVector=this._curve[index].subtract(this._curve[index-i]);0===nLVector.length()&&index>i+1;)i++,nLVector=this._curve[index].subtract(this._curve[index-i]);return nLVector},Path3D.prototype._normalVector=function(v0,vt,va){var normal0,tgl=vt.length();if(0===tgl&&(tgl=1),void 0===va||null===va){var point;point=BABYLON.Scalar.WithinEpsilon(Math.abs(vt.y)/tgl,1,BABYLON.Epsilon)?BABYLON.Scalar.WithinEpsilon(Math.abs(vt.x)/tgl,1,BABYLON.Epsilon)?BABYLON.Scalar.WithinEpsilon(Math.abs(vt.z)/tgl,1,BABYLON.Epsilon)?Vector3.Zero():new Vector3(0,0,1):new Vector3(1,0,0):new Vector3(0,-1,0),normal0=Vector3.Cross(vt,point)}else normal0=Vector3.Cross(vt,va),Vector3.CrossToRef(normal0,vt,normal0);return normal0.normalize(),normal0},Path3D}();BABYLON.Path3D=Path3D;var Curve3=function(){function Curve3(points){this._length=0,this._points=points,this._length=this._computeLength(points)}return Curve3.CreateQuadraticBezier=function(v0,v1,v2,nbPoints){nbPoints=nbPoints>2?nbPoints:3;for(var bez=new Array,equation=function(t,val0,val1,val2){return(1-t)*(1-t)*val0+2*t*(1-t)*val1+t*t*val2},i=0;i<=nbPoints;i++)bez.push(new Vector3(equation(i/nbPoints,v0.x,v1.x,v2.x),equation(i/nbPoints,v0.y,v1.y,v2.y),equation(i/nbPoints,v0.z,v1.z,v2.z)));return new Curve3(bez)},Curve3.CreateCubicBezier=function(v0,v1,v2,v3,nbPoints){nbPoints=nbPoints>3?nbPoints:4;for(var bez=new Array,equation=function(t,val0,val1,val2,val3){return(1-t)*(1-t)*(1-t)*val0+3*t*(1-t)*(1-t)*val1+3*t*t*(1-t)*val2+t*t*t*val3},i=0;i<=nbPoints;i++)bez.push(new Vector3(equation(i/nbPoints,v0.x,v1.x,v2.x,v3.x),equation(i/nbPoints,v0.y,v1.y,v2.y,v3.y),equation(i/nbPoints,v0.z,v1.z,v2.z,v3.z)));return new Curve3(bez)},Curve3.CreateHermiteSpline=function(p1,t1,p2,t2,nbPoints){for(var hermite=new Array,step=1/nbPoints,i=0;i<=nbPoints;i++)hermite.push(Vector3.Hermite(p1,t1,p2,t2,i*step));return new Curve3(hermite)},Curve3.CreateCatmullRomSpline=function(points,nbPoints){var totalPoints=new Array;totalPoints.push(points[0].clone()),Array.prototype.push.apply(totalPoints,points),totalPoints.push(points[points.length-1].clone());for(var catmullRom=new Array,step=1/nbPoints,amount=0,i=0;i<totalPoints.length-3;i++){amount=0;for(var c=0;c<nbPoints;c++)catmullRom.push(Vector3.CatmullRom(totalPoints[i],totalPoints[i+1],totalPoints[i+2],totalPoints[i+3],amount)),amount+=step}return i--,catmullRom.push(Vector3.CatmullRom(totalPoints[i],totalPoints[i+1],totalPoints[i+2],totalPoints[i+3],amount)),new Curve3(catmullRom)},Curve3.prototype.getPoints=function(){return this._points},Curve3.prototype.length=function(){return this._length},Curve3.prototype.continue=function(curve){for(var lastPoint=this._points[this._points.length-1],continuedPoints=this._points.slice(),curvePoints=curve.getPoints(),i=1;i<curvePoints.length;i++)continuedPoints.push(curvePoints[i].subtract(curvePoints[0]).add(lastPoint));return new Curve3(continuedPoints)},Curve3.prototype._computeLength=function(path){for(var l=0,i=1;i<path.length;i++)l+=path[i].subtract(path[i-1]).length();return l},Curve3}();BABYLON.Curve3=Curve3;var PositionNormalVertex=function(){function PositionNormalVertex(position,normal){void 0===position&&(position=Vector3.Zero()),void 0===normal&&(normal=Vector3.Up()),this.position=position,this.normal=normal}return PositionNormalVertex.prototype.clone=function(){return new PositionNormalVertex(this.position.clone(),this.normal.clone())},PositionNormalVertex}();BABYLON.PositionNormalVertex=PositionNormalVertex;var PositionNormalTextureVertex=function(){function PositionNormalTextureVertex(position,normal,uv){void 0===position&&(position=Vector3.Zero()),void 0===normal&&(normal=Vector3.Up()),void 0===uv&&(uv=Vector2.Zero()),this.position=position,this.normal=normal,this.uv=uv}return PositionNormalTextureVertex.prototype.clone=function(){return new PositionNormalTextureVertex(this.position.clone(),this.normal.clone(),this.uv.clone())},PositionNormalTextureVertex}();BABYLON.PositionNormalTextureVertex=PositionNormalTextureVertex;var Tmp=function(){function Tmp(){}return Tmp.Color3=[Color3.Black(),Color3.Black(),Color3.Black()],Tmp.Vector2=[Vector2.Zero(),Vector2.Zero(),Vector2.Zero()],Tmp.Vector3=[Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero(),Vector3.Zero()],Tmp.Vector4=[Vector4.Zero(),Vector4.Zero(),Vector4.Zero()],Tmp.Quaternion=[Quaternion.Zero(),Quaternion.Zero()],Tmp.Matrix=[Matrix.Zero(),Matrix.Zero(),Matrix.Zero(),Matrix.Zero(),Matrix.Zero(),Matrix.Zero(),Matrix.Zero(),Matrix.Zero()],Tmp}();BABYLON.Tmp=Tmp;var MathTmp=function(){function MathTmp(){}return MathTmp.Vector3=[Vector3.Zero()],MathTmp.Matrix=[Matrix.Zero(),Matrix.Zero()],MathTmp.Quaternion=[Quaternion.Zero()],MathTmp}()}(BABYLON||(BABYLON={}));!function(BABYLON){var Scalar=function(){function Scalar(){}return Scalar.WithinEpsilon=function(a,b,epsilon){void 0===epsilon&&(epsilon=1.401298e-45);var num=a-b;return-epsilon<=num&&num<=epsilon},Scalar.ToHex=function(i){var str=i.toString(16);return i<=15?("0"+str).toUpperCase():str.toUpperCase()},Scalar.Sign=function(value){return 0==(value=+value)||isNaN(value)?value:value>0?1:-1},Scalar.Clamp=function(value,min,max){return void 0===min&&(min=0),void 0===max&&(max=1),Math.min(max,Math.max(min,value))},Scalar.Log2=function(value){return Math.log(value)*Math.LOG2E},Scalar.Repeat=function(value,length){return value-Math.floor(value/length)*length},Scalar.Normalize=function(value,min,max){return(value-min)/(max-min)},Scalar.Denormalize=function(normalized,min,max){return normalized*(max-min)+min},Scalar.DeltaAngle=function(current,target){var num=Scalar.Repeat(target-current,360);return num>180&&(num-=360),num},Scalar.PingPong=function(tx,length){var t=Scalar.Repeat(tx,2*length);return length-Math.abs(t-length)},Scalar.SmoothStep=function(from,to,tx){var t=Scalar.Clamp(tx);return t=-2*t*t*t+3*t*t,to*t+from*(1-t)},Scalar.MoveTowards=function(current,target,maxDelta){return Math.abs(target-current)<=maxDelta?target:current+Scalar.Sign(target-current)*maxDelta},Scalar.MoveTowardsAngle=function(current,target,maxDelta){var num=Scalar.DeltaAngle(current,target),result=0;return-maxDelta<num&&num<maxDelta?result=target:(target=current+num,result=Scalar.MoveTowards(current,target,maxDelta)),result},Scalar.Lerp=function(start,end,amount){return start+(end-start)*amount},Scalar.LerpAngle=function(start,end,amount){var num=Scalar.Repeat(end-start,360);return num>180&&(num-=360),start+num*Scalar.Clamp(amount)},Scalar.InverseLerp=function(a,b,value){return a!=b?Scalar.Clamp((value-a)/(b-a)):0},Scalar.Hermite=function(value1,tangent1,value2,tangent2,amount){var squared=amount*amount,cubed=amount*squared;return value1*(2*cubed-3*squared+1)+value2*(-2*cubed+3*squared)+tangent1*(cubed-2*squared+amount)+tangent2*(cubed-squared)},Scalar.RandomRange=function(min,max){return min===max?min:Math.random()*(max-min)+min},Scalar.RangeToPercent=function(number,min,max){return(number-min)/(max-min)},Scalar.PercentToRange=function(percent,min,max){return(max-min)*percent+min},Scalar.NormalizeRadians=function(angle){return angle-=Scalar.TwoPi*Math.floor((angle+Math.PI)/Scalar.TwoPi)},Scalar.TwoPi=2*Math.PI,Scalar}();BABYLON.Scalar=Scalar}(BABYLON||(BABYLON={}));!function(BABYLON){function getDirectStore(target){var classKey=target.getClassName();return __decoratorInitialStore[classKey]||(__decoratorInitialStore[classKey]={}),__decoratorInitialStore[classKey]}function getMergedStore(target){var classKey=target.getClassName();if(__mergedStore[classKey])return __mergedStore[classKey];__mergedStore[classKey]={};for(var store=__mergedStore[classKey],currentTarget=target,currentKey=classKey;currentKey;){var initialStore=__decoratorInitialStore[currentKey];for(var property in initialStore)store[property]=initialStore[property];var parent_1=void 0,done=!1;do{if(!(parent_1=Object.getPrototypeOf(currentTarget)).getClassName){done=!0;break}if(parent_1.getClassName()!==currentKey)break;currentTarget=parent_1}while(parent_1);if(done)break;currentKey=parent_1.getClassName(),currentTarget=parent_1}return store}function generateSerializableMember(type,sourceName){return function(target,propertyKey){var classStore=getDirectStore(target);classStore[propertyKey]||(classStore[propertyKey]={type:type,sourceName:sourceName})}}function generateExpandMember(setCallback,targetKey){return void 0===targetKey&&(targetKey=null),function(target,propertyKey){var key=targetKey||"_"+propertyKey;Object.defineProperty(target,propertyKey,{get:function(){return this[key]},set:function(value){this[key]!==value&&(this[key]=value,target[setCallback].apply(this))},enumerable:!0,configurable:!0})}}var __decoratorInitialStore={},__mergedStore={},_copySource=function(creationFunction,source,instanciate){var destination=creationFunction();BABYLON.Tags&&BABYLON.Tags.AddTagsTo(destination,source.tags);var classStore=getMergedStore(destination);for(var property in classStore){var propertyDescriptor=classStore[property],sourceProperty=source[property],propertyType=propertyDescriptor.type;if(void 0!==sourceProperty&&null!==sourceProperty)switch(propertyType){case 0:case 6:destination[property]=sourceProperty;break;case 1:destination[property]=instanciate||sourceProperty.isRenderTarget?sourceProperty:sourceProperty.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:destination[property]=instanciate?sourceProperty:sourceProperty.clone()}}return destination};BABYLON.expandToProperty=function(callback,targetKey){return void 0===targetKey&&(targetKey=null),generateExpandMember(callback,targetKey)},BABYLON.serialize=function(sourceName){return generateSerializableMember(0,sourceName)},BABYLON.serializeAsTexture=function(sourceName){return generateSerializableMember(1,sourceName)},BABYLON.serializeAsColor3=function(sourceName){return generateSerializableMember(2,sourceName)},BABYLON.serializeAsFresnelParameters=function(sourceName){return generateSerializableMember(3,sourceName)},BABYLON.serializeAsVector2=function(sourceName){return generateSerializableMember(4,sourceName)},BABYLON.serializeAsVector3=function(sourceName){return generateSerializableMember(5,sourceName)},BABYLON.serializeAsMeshReference=function(sourceName){return generateSerializableMember(6,sourceName)},BABYLON.serializeAsColorCurves=function(sourceName){return generateSerializableMember(7,sourceName)},BABYLON.serializeAsColor4=function(sourceName){return generateSerializableMember(8,sourceName)},BABYLON.serializeAsImageProcessingConfiguration=function(sourceName){return generateSerializableMember(9,sourceName)},BABYLON.serializeAsQuaternion=function(sourceName){return generateSerializableMember(10,sourceName)};var SerializationHelper=function(){function SerializationHelper(){}return SerializationHelper.Serialize=function(entity,serializationObject){serializationObject||(serializationObject={}),BABYLON.Tags&&(serializationObject.tags=BABYLON.Tags.GetTags(entity));var serializedProperties=getMergedStore(entity);for(var property in serializedProperties){var propertyDescriptor=serializedProperties[property],targetPropertyName=propertyDescriptor.sourceName||property,propertyType=propertyDescriptor.type,sourceProperty=entity[property];if(void 0!==sourceProperty&&null!==sourceProperty)switch(propertyType){case 0:serializationObject[targetPropertyName]=sourceProperty;break;case 1:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 2:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 3:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 4:case 5:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 6:serializationObject[targetPropertyName]=sourceProperty.id;break;case 7:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 8:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 9:serializationObject[targetPropertyName]=sourceProperty.serialize()}}return serializationObject},SerializationHelper.Parse=function(creationFunction,source,scene,rootUrl){void 0===rootUrl&&(rootUrl=null);var destination=creationFunction();rootUrl||(rootUrl=""),BABYLON.Tags&&BABYLON.Tags.AddTagsTo(destination,source.tags);var classStore=getMergedStore(destination);for(var property in classStore){var propertyDescriptor=classStore[property],sourceProperty=source[propertyDescriptor.sourceName||property],propertyType=propertyDescriptor.type;if(void 0!==sourceProperty&&null!==sourceProperty){var dest=destination;switch(propertyType){case 0:dest[property]=sourceProperty;break;case 1:scene&&(dest[property]=BABYLON.Texture.Parse(sourceProperty,scene,rootUrl));break;case 2:dest[property]=BABYLON.Color3.FromArray(sourceProperty);break;case 3:dest[property]=BABYLON.FresnelParameters.Parse(sourceProperty);break;case 4:dest[property]=BABYLON.Vector2.FromArray(sourceProperty);break;case 5:dest[property]=BABYLON.Vector3.FromArray(sourceProperty);break;case 6:scene&&(dest[property]=scene.getLastMeshByID(sourceProperty));break;case 7:dest[property]=BABYLON.ColorCurves.Parse(sourceProperty);break;case 8:dest[property]=BABYLON.Color4.FromArray(sourceProperty);break;case 9:dest[property]=BABYLON.ImageProcessingConfiguration.Parse(sourceProperty)}}}return destination},SerializationHelper.Clone=function(creationFunction,source){return _copySource(creationFunction,source,!1)},SerializationHelper.Instanciate=function(creationFunction,source){return _copySource(creationFunction,source,!0)},SerializationHelper}();BABYLON.SerializationHelper=SerializationHelper}(BABYLON||(BABYLON={}));!function(BABYLON){var EventState=function(){function EventState(mask,skipNextObservers,target,currentTarget){void 0===skipNextObservers&&(skipNextObservers=!1),this.initalize(mask,skipNextObservers,target,currentTarget)}return EventState.prototype.initalize=function(mask,skipNextObservers,target,currentTarget){return void 0===skipNextObservers&&(skipNextObservers=!1),this.mask=mask,this.skipNextObservers=skipNextObservers,this.target=target,this.currentTarget=currentTarget,this},EventState}();BABYLON.EventState=EventState;var Observer=function(){return function(callback,mask,scope){void 0===scope&&(scope=null),this.callback=callback,this.mask=mask,this.scope=scope}}();BABYLON.Observer=Observer;var MultiObserver=function(){function MultiObserver(){}return MultiObserver.prototype.dispose=function(){if(this._observers&&this._observables)for(var index=0;index<this._observers.length;index++)this._observables[index].remove(this._observers[index]);this._observers=null,this._observables=null},MultiObserver.Watch=function(observables,callback,mask,scope){void 0===mask&&(mask=-1),void 0===scope&&(scope=null);var result=new MultiObserver;result._observers=new Array,result._observables=observables;for(var _i=0,observables_1=observables;_i<observables_1.length;_i++){var observer=observables_1[_i].add(callback,mask,!1,scope);observer&&result._observers.push(observer)}return result},MultiObserver}();BABYLON.MultiObserver=MultiObserver;var Observable=function(){function Observable(onObserverAdded){this._observers=new Array,this._eventState=new EventState(0),onObserverAdded&&(this._onObserverAdded=onObserverAdded)}return Observable.prototype.add=function(callback,mask,insertFirst,scope){if(void 0===mask&&(mask=-1),void 0===insertFirst&&(insertFirst=!1),void 0===scope&&(scope=null),!callback)return null;var observer=new Observer(callback,mask,scope);return insertFirst?this._observers.unshift(observer):this._observers.push(observer),this._onObserverAdded&&this._onObserverAdded(observer),observer},Observable.prototype.remove=function(observer){if(!observer)return!1;var index=this._observers.indexOf(observer);return-1!==index&&(this._observers.splice(index,1),!0)},Observable.prototype.removeCallback=function(callback){for(var index=0;index<this._observers.length;index++)if(this._observers[index].callback===callback)return this._observers.splice(index,1),!0;return!1},Observable.prototype.notifyObservers=function(eventData,mask,target,currentTarget){if(void 0===mask&&(mask=-1),!this._observers.length)return!0;var state=this._eventState;state.mask=mask,state.target=target,state.currentTarget=currentTarget,state.skipNextObservers=!1;for(var _i=0,_a=this._observers;_i<_a.length;_i++){var obs=_a[_i];if(obs.mask&mask&&(obs.scope?obs.callback.apply(obs.scope,[eventData,state]):obs.callback(eventData,state)),state.skipNextObservers)return!1}return!0},Observable.prototype.notifyObserver=function(observer,eventData,mask){void 0===mask&&(mask=-1);var state=this._eventState;state.mask=mask,state.skipNextObservers=!1,observer.callback(eventData,state)},Observable.prototype.hasObservers=function(){return this._observers.length>0},Observable.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},Observable.prototype.clone=function(){var result=new Observable;return result._observers=this._observers.slice(0),result},Observable.prototype.hasSpecificMask=function(mask){void 0===mask&&(mask=-1);for(var _i=0,_a=this._observers;_i<_a.length;_i++){var obs=_a[_i];if(obs.mask&mask||obs.mask===mask)return!0}return!1},Observable}();BABYLON.Observable=Observable}(BABYLON||(BABYLON={}));!function(BABYLON){var SmartArray=function(){function SmartArray(capacity){this.length=0,this.data=new Array(capacity),this._id=SmartArray._GlobalId++}return SmartArray.prototype.push=function(value){this.data[this.length++]=value,this.length>this.data.length&&(this.data.length*=2)},SmartArray.prototype.forEach=function(func){for(var index=0;index<this.length;index++)func(this.data[index])},SmartArray.prototype.sort=function(compareFn){this.data.sort(compareFn)},SmartArray.prototype.reset=function(){this.length=0},SmartArray.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},SmartArray.prototype.concat=function(array){if(0!==array.length){this.length+array.length>this.data.length&&(this.data.length=2*(this.length+array.length));for(var index=0;index<array.length;index++)this.data[this.length++]=(array.data||array)[index]}},SmartArray.prototype.indexOf=function(value){var position=this.data.indexOf(value);return position>=this.length?-1:position},SmartArray.prototype.contains=function(value){return-1!==this.data.indexOf(value)},SmartArray._GlobalId=0,SmartArray}();BABYLON.SmartArray=SmartArray;var SmartArrayNoDuplicate=function(_super){function SmartArrayNoDuplicate(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this._duplicateId=0,_this}return __extends(SmartArrayNoDuplicate,_super),SmartArrayNoDuplicate.prototype.push=function(value){_super.prototype.push.call(this,value),value.__smartArrayFlags||(value.__smartArrayFlags={}),value.__smartArrayFlags[this._id]=this._duplicateId},SmartArrayNoDuplicate.prototype.pushNoDuplicate=function(value){return(!value.__smartArrayFlags||value.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(value),!0)},SmartArrayNoDuplicate.prototype.reset=function(){_super.prototype.reset.call(this),this._duplicateId++},SmartArrayNoDuplicate.prototype.concatWithNoDuplicate=function(array){if(0!==array.length){this.length+array.length>this.data.length&&(this.data.length=2*(this.length+array.length));for(var index=0;index<array.length;index++){var item=(array.data||array)[index];this.pushNoDuplicate(item)}}},SmartArrayNoDuplicate}(SmartArray);BABYLON.SmartArrayNoDuplicate=SmartArrayNoDuplicate}(BABYLON||(BABYLON={}));!function(BABYLON){var screenshotCanvas,cloneValue=function(source,destinationObject){return source?source instanceof BABYLON.Mesh?null:source instanceof BABYLON.SubMesh?source.clone(destinationObject):source.clone?source.clone():null:null},Tools=function(){function Tools(){}return Tools.Mix=function(a,b,alpha){return a*(1-alpha)+b*alpha},Tools.Instantiate=function(className){if(Tools.RegisteredExternalClasses&&Tools.RegisteredExternalClasses[className])return Tools.RegisteredExternalClasses[className];for(var arr=className.split("."),fn=window||this,i=0,len=arr.length;i<len;i++)fn=fn[arr[i]];return"function"!=typeof fn?null:fn},Tools.SetImmediate=function(action){window.setImmediate?window.setImmediate(action):setTimeout(action,1)},Tools.IsExponentOfTwo=function(value){var count=1;do{count*=2}while(count<value);return count===value},Tools.CeilingPOT=function(x){return x--,x|=x>>1,x|=x>>2,x|=x>>4,x|=x>>8,x|=x>>16,++x},Tools.FloorPOT=function(x){return x|=x>>1,x|=x>>2,x|=x>>4,x|=x>>8,(x|=x>>16)-(x>>1)},Tools.NearestPOT=function(x){var c=Tools.CeilingPOT(x),f=Tools.FloorPOT(x);return c-x>x-f?f:c},Tools.GetExponentOfTwo=function(value,max,mode){void 0===mode&&(mode=BABYLON.Engine.SCALEMODE_NEAREST);var pot;switch(mode){case BABYLON.Engine.SCALEMODE_FLOOR:pot=Tools.FloorPOT(value);break;case BABYLON.Engine.SCALEMODE_NEAREST:pot=Tools.NearestPOT(value);break;case BABYLON.Engine.SCALEMODE_CEILING:default:pot=Tools.CeilingPOT(value)}return Math.min(pot,max)},Tools.GetFilename=function(path){var index=path.lastIndexOf("/");return index<0?path:path.substring(index+1)},Tools.GetFolderPath=function(uri){var index=uri.lastIndexOf("/");return index<0?"":uri.substring(0,index+1)},Tools.GetDOMTextContent=function(element){for(var result="",child=element.firstChild;child;)3===child.nodeType&&(result+=child.textContent),child=child.nextSibling;return result},Tools.ToDegrees=function(angle){return 180*angle/Math.PI},Tools.ToRadians=function(angle){return angle*Math.PI/180},Tools.EncodeArrayBufferTobase64=function(buffer){for(var chr1,chr2,chr3,enc1,enc2,enc3,enc4,keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",output="",i=0,bytes=new Uint8Array(buffer);i<bytes.length;)enc1=(chr1=bytes[i++])>>2,enc2=(3&chr1)<<4|(chr2=i<bytes.length?bytes[i++]:Number.NaN)>>4,enc3=(15&chr2)<<2|(chr3=i<bytes.length?bytes[i++]:Number.NaN)>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);return"data:image/png;base64,"+output},Tools.ExtractMinAndMaxIndexed=function(positions,indices,indexStart,indexCount,bias){void 0===bias&&(bias=null);for(var minimum=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),maximum=new BABYLON.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),index=indexStart;index<indexStart+indexCount;index++){var current=new BABYLON.Vector3(positions[3*indices[index]],positions[3*indices[index]+1],positions[3*indices[index]+2]);minimum=BABYLON.Vector3.Minimize(current,minimum),maximum=BABYLON.Vector3.Maximize(current,maximum)}return bias&&(minimum.x-=minimum.x*bias.x+bias.y,minimum.y-=minimum.y*bias.x+bias.y,minimum.z-=minimum.z*bias.x+bias.y,maximum.x+=maximum.x*bias.x+bias.y,maximum.y+=maximum.y*bias.x+bias.y,maximum.z+=maximum.z*bias.x+bias.y),{minimum:minimum,maximum:maximum}},Tools.ExtractMinAndMax=function(positions,start,count,bias,stride){void 0===bias&&(bias=null);var minimum=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),maximum=new BABYLON.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);stride||(stride=3);for(var index=start;index<start+count;index++){var current=new BABYLON.Vector3(positions[index*stride],positions[index*stride+1],positions[index*stride+2]);minimum=BABYLON.Vector3.Minimize(current,minimum),maximum=BABYLON.Vector3.Maximize(current,maximum)}return bias&&(minimum.x-=minimum.x*bias.x+bias.y,minimum.y-=minimum.y*bias.x+bias.y,minimum.z-=minimum.z*bias.x+bias.y,maximum.x+=maximum.x*bias.x+bias.y,maximum.y+=maximum.y*bias.x+bias.y,maximum.z+=maximum.z*bias.x+bias.y),{minimum:minimum,maximum:maximum}},Tools.Vector2ArrayFeeder=function(array){return function(index){var isFloatArray=void 0!==array.BYTES_PER_ELEMENT;if(index>=(isFloatArray?array.length/2:array.length))return null;if(isFloatArray){var fa=array;return new BABYLON.Vector2(fa[2*index+0],fa[2*index+1])}return array[index]}},Tools.ExtractMinAndMaxVector2=function(feeder,bias){void 0===bias&&(bias=null);for(var minimum=new BABYLON.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),maximum=new BABYLON.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),i=0,cur=feeder(i++);cur;)minimum=BABYLON.Vector2.Minimize(cur,minimum),maximum=BABYLON.Vector2.Maximize(cur,maximum),cur=feeder(i++);return bias&&(minimum.x-=minimum.x*bias.x+bias.y,minimum.y-=minimum.y*bias.x+bias.y,maximum.x+=maximum.x*bias.x+bias.y,maximum.y+=maximum.y*bias.x+bias.y),{minimum:minimum,maximum:maximum}},Tools.MakeArray=function(obj,allowsNullUndefined){return!0===allowsNullUndefined||void 0!==obj&&null!=obj?Array.isArray(obj)?obj:[obj]:null},Tools.GetPointerPrefix=function(){var eventPrefix="pointer";return!Tools.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(eventPrefix="mouse"),eventPrefix},Tools.QueueNewFrame=function(func,requester){return Tools.IsWindowObjectExist()?(requester||(requester=window),requester.requestAnimationFrame?requester.requestAnimationFrame(func):requester.msRequestAnimationFrame?requester.msRequestAnimationFrame(func):requester.webkitRequestAnimationFrame?requester.webkitRequestAnimationFrame(func):requester.mozRequestAnimationFrame?requester.mozRequestAnimationFrame(func):requester.oRequestAnimationFrame?requester.oRequestAnimationFrame(func):window.setTimeout(func,16)):setTimeout(func,16)},Tools.RequestFullscreen=function(element){var requestFunction=element.requestFullscreen||element.msRequestFullscreen||element.webkitRequestFullscreen||element.mozRequestFullScreen;requestFunction&&requestFunction.call(element)},Tools.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},Tools.SetCorsBehavior=function(url,element){if((!url||0!==url.indexOf("data:"))&&Tools.CorsBehavior)if("string"==typeof Tools.CorsBehavior||Tools.CorsBehavior instanceof String)element.crossOrigin=Tools.CorsBehavior;else{var result=Tools.CorsBehavior(url);result&&(element.crossOrigin=result)}},Tools.CleanUrl=function(url){return url=url.replace(/#/gm,"%23")},Tools.LoadImage=function(url,onLoad,onError,database){url instanceof ArrayBuffer&&(url=Tools.EncodeArrayBufferTobase64(url)),url=Tools.CleanUrl(url),url=Tools.PreprocessUrl(url);var img=new Image;Tools.SetCorsBehavior(url,img),img.onload=function(){onLoad(img)},img.onerror=function(err){Tools.Error("Error while trying to load image: "+url),onError&&onError("Error while trying to load image: "+url,err)};var noIndexedDB=function(){img.src=url};if("data:"!==url.substr(0,5)&&database&&database.enableTexturesOffline&&BABYLON.Database.IsUASupportingBlobStorage)database.openAsync(function(){database&&database.loadImageFromDB(url,img)},noIndexedDB);else{if(-1!==url.indexOf("file:")){var textureName=decodeURIComponent(url.substring(5).toLowerCase());if(BABYLON.FilesInput.FilesToLoad[textureName]){try{var blobURL;try{blobURL=URL.createObjectURL(BABYLON.FilesInput.FilesToLoad[textureName],{oneTimeOnly:!0})}catch(ex){blobURL=URL.createObjectURL(BABYLON.FilesInput.FilesToLoad[textureName])}img.src=blobURL}catch(e){img.src=""}return img}}noIndexedDB()}return img},Tools.LoadFile=function(url,callback,progressCallBack,database,useArrayBuffer,onError){url=Tools.CleanUrl(url);var request=null,noIndexedDB=function(){request=new XMLHttpRequest;var loadUrl=Tools.BaseUrl+url;request.open("GET",loadUrl,!0),useArrayBuffer&&(request.responseType="arraybuffer"),progressCallBack&&(request.onprogress=progressCallBack),request.onreadystatechange=function(){var req=request;if(req.readyState===(XMLHttpRequest.DONE||4))if(req.onreadystatechange=function(){},req.status>=200&&req.status<300||!Tools.IsWindowObjectExist()&&0===req.status)callback(useArrayBuffer?req.response:req.responseText,req.responseURL);else{var e=new Error("Error status: "+req.status+" - Unable to load "+loadUrl);if(!onError)throw e;onError(req,e)}},request.send(null)};if(-1!==(url=Tools.PreprocessUrl(url)).indexOf("file:")){var fileName=decodeURIComponent(url.substring(5).toLowerCase());if(BABYLON.FilesInput.FilesToLoad[fileName])return Tools.ReadFile(BABYLON.FilesInput.FilesToLoad[fileName],callback,progressCallBack,useArrayBuffer),request}return database&&database.enableSceneOffline?database.openAsync(function(){database&&database.loadFileFromDB(url,callback,progressCallBack,noIndexedDB,useArrayBuffer)},noIndexedDB):noIndexedDB(),request},Tools.LoadScript=function(scriptUrl,onSuccess,onError){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.type="text/javascript",script.src=scriptUrl,script.onload=function(){onSuccess&&onSuccess()},script.onerror=function(e){onError&&onError("Unable to load script",e)},head.appendChild(script)},Tools.ReadFileAsDataURL=function(fileToLoad,callback,progressCallback){var reader=new FileReader;reader.onload=function(e){callback(e.target.result)},reader.onprogress=progressCallback,reader.readAsDataURL(fileToLoad)},Tools.ReadFile=function(fileToLoad,callback,progressCallBack,useArrayBuffer){var reader=new FileReader;reader.onerror=function(e){Tools.Log("Error while reading file: "+fileToLoad.name),callback(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},reader.onload=function(e){callback(e.target.result)},progressCallBack&&(reader.onprogress=progressCallBack),useArrayBuffer?reader.readAsArrayBuffer(fileToLoad):reader.readAsText(fileToLoad)},Tools.FileAsURL=function(content){var fileBlob=new Blob([content]);return(window.URL||window.webkitURL).createObjectURL(fileBlob)},Tools.Format=function(value,decimals){return void 0===decimals&&(decimals=2),value.toFixed(decimals)},Tools.CheckExtends=function(v,min,max){v.x<min.x&&(min.x=v.x),v.y<min.y&&(min.y=v.y),v.z<min.z&&(min.z=v.z),v.x>max.x&&(max.x=v.x),v.y>max.y&&(max.y=v.y),v.z>max.z&&(max.z=v.z)},Tools.DeepCopy=function(source,destination,doNotCopyList,mustCopyList){for(var prop in source)if(("_"!==prop[0]||mustCopyList&&-1!==mustCopyList.indexOf(prop))&&(!doNotCopyList||-1===doNotCopyList.indexOf(prop))){var sourceValue=source[prop],typeOfSourceValue=typeof sourceValue;if("function"!==typeOfSourceValue)if("object"===typeOfSourceValue)if(sourceValue instanceof Array){if(destination[prop]=[],sourceValue.length>0)if("object"==typeof sourceValue[0])for(var index=0;index<sourceValue.length;index++){var clonedValue=cloneValue(sourceValue[index],destination);-1===destination[prop].indexOf(clonedValue)&&destination[prop].push(clonedValue)}else destination[prop]=sourceValue.slice(0)}else destination[prop]=cloneValue(sourceValue,destination);else destination[prop]=sourceValue}},Tools.IsEmpty=function(obj){for(var i in obj)if(obj.hasOwnProperty(i))return!1;return!0},Tools.RegisterTopRootEvents=function(events){for(var index=0;index<events.length;index++){var event=events[index];window.addEventListener(event.name,event.handler,!1);try{window.parent&&window.parent.addEventListener(event.name,event.handler,!1)}catch(e){}}},Tools.UnregisterTopRootEvents=function(events){for(var index=0;index<events.length;index++){var event=events[index];window.removeEventListener(event.name,event.handler);try{window.parent&&window.parent.removeEventListener(event.name,event.handler)}catch(e){}}},Tools.DumpFramebuffer=function(width,height,engine,successCallback,mimeType,fileName){void 0===mimeType&&(mimeType="image/png");for(var numberOfChannelsByLine=4*width,halfHeight=height/2,data=engine.readPixels(0,0,width,height),i=0;i<halfHeight;i++)for(var j=0;j<numberOfChannelsByLine;j++){var currentCell=j+i*numberOfChannelsByLine,targetCell=j+(height-i-1)*numberOfChannelsByLine,temp=data[currentCell];data[currentCell]=data[targetCell],data[targetCell]=temp}screenshotCanvas||(screenshotCanvas=document.createElement("canvas")),screenshotCanvas.width=width,screenshotCanvas.height=height;var context=screenshotCanvas.getContext("2d");if(context){var imageData=context.createImageData(width,height);imageData.data.set(data),context.putImageData(imageData,0,0),Tools.EncodeScreenshotCanvasData(successCallback,mimeType,fileName)}},Tools.EncodeScreenshotCanvasData=function(successCallback,mimeType,fileName){void 0===mimeType&&(mimeType="image/png");var base64Image=screenshotCanvas.toDataURL(mimeType);successCallback?successCallback(base64Image):(screenshotCanvas.toBlob||(screenshotCanvas.toBlob=function(callback,type,quality){var _this=this;setTimeout(function(){for(var binStr=atob(_this.toDataURL(type,quality).split(",")[1]),len=binStr.length,arr=new Uint8Array(len),i=0;i<len;i++)arr[i]=binStr.charCodeAt(i);callback(new Blob([arr],{type:type||"image/png"}))})}),screenshotCanvas.toBlob(function(blob){var url=URL.createObjectURL(blob);if("download"in document.createElement("a")){var a=window.document.createElement("a");if(a.href=url,fileName)a.setAttribute("download",fileName);else{var date=new Date,stringDate=(date.getFullYear()+"-"+(date.getMonth()+1)).slice(-2)+"-"+date.getDate()+"_"+date.getHours()+"-"+("0"+date.getMinutes()).slice(-2);a.setAttribute("download","screenshot_"+stringDate+".png")}window.document.body.appendChild(a),a.addEventListener("click",function(){a.parentElement&&a.parentElement.removeChild(a)}),a.click()}else{var newWindow=window.open("");if(!newWindow)return;var img=newWindow.document.createElement("img");img.onload=function(){URL.revokeObjectURL(url)},img.src=url,newWindow.document.body.appendChild(img)}}))},Tools.CreateScreenshot=function(engine,camera,size,successCallback,mimeType){void 0===mimeType&&(mimeType="image/png");var width,height;if(size.precision)width=Math.round(engine.getRenderWidth()*size.precision),height=Math.round(width/engine.getAspectRatio(camera));else if(size.width&&size.height)width=size.width,height=size.height;else if(size.width&&!size.height)width=size.width,height=Math.round(width/engine.getAspectRatio(camera));else if(size.height&&!size.width)height=size.height,width=Math.round(height*engine.getAspectRatio(camera));else{if(isNaN(size))return void Tools.Error("Invalid 'size' parameter !");height=size,width=size}screenshotCanvas||(screenshotCanvas=document.createElement("canvas")),screenshotCanvas.width=width,screenshotCanvas.height=height;var renderContext=screenshotCanvas.getContext("2d"),ratio=engine.getRenderWidth()/engine.getRenderHeight(),newWidth=width,newHeight=newWidth/ratio;newHeight>height&&(newWidth=(newHeight=height)*ratio);var offsetX=Math.max(0,width-newWidth)/2,offsetY=Math.max(0,height-newHeight)/2,renderingCanvas=engine.getRenderingCanvas();renderContext&&renderingCanvas&&renderContext.drawImage(renderingCanvas,offsetX,offsetY,newWidth,newHeight),Tools.EncodeScreenshotCanvasData(successCallback,mimeType)},Tools.CreateScreenshotUsingRenderTarget=function(engine,camera,size,successCallback,mimeType,samples,antialiasing,fileName){void 0===mimeType&&(mimeType="image/png"),void 0===samples&&(samples=1),void 0===antialiasing&&(antialiasing=!1);var width,height;if(size.precision)width=Math.round(engine.getRenderWidth()*size.precision),height=Math.round(width/engine.getAspectRatio(camera)),size={width:width,height:height};else if(size.width&&size.height)width=size.width,height=size.height;else if(size.width&&!size.height)width=size.width,height=Math.round(width/engine.getAspectRatio(camera)),size={width:width,height:height};else if(size.height&&!size.width)height=size.height,size={width:width=Math.round(height*engine.getAspectRatio(camera)),height:height};else{if(isNaN(size))return void Tools.Error("Invalid 'size' parameter !");height=size,width=size}var scene=camera.getScene(),previousCamera=null;scene.activeCamera!==camera&&(previousCamera=scene.activeCamera,scene.activeCamera=camera);var texture=new BABYLON.RenderTargetTexture("screenShot",size,scene,!1,!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE);texture.renderList=null,texture.samples=samples,antialiasing&&texture.addPostProcess(new BABYLON.FxaaPostProcess("antialiasing",1,scene.activeCamera)),texture.onAfterRenderObservable.add(function(){Tools.DumpFramebuffer(width,height,engine,successCallback,mimeType,fileName)}),scene.incrementRenderId(),scene.resetCachedMaterial(),texture.render(!0),texture.dispose(),previousCamera&&(scene.activeCamera=previousCamera),camera.getProjectionMatrix(!0)},Tools.ValidateXHRData=function(xhr,dataType){void 0===dataType&&(dataType=7);try{if(1&dataType){if(xhr.responseText&&xhr.responseText.length>0)return!0;if(1===dataType)return!1}if(2&dataType){var tgaHeader=BABYLON.Internals.TGATools.GetTGAHeader(xhr.response);if(tgaHeader.width&&tgaHeader.height&&tgaHeader.width>0&&tgaHeader.height>0)return!0;if(2===dataType)return!1}if(4&dataType){var ddsHeader=new Uint8Array(xhr.response,0,3);return 68===ddsHeader[0]&&68===ddsHeader[1]&&83===ddsHeader[2]}}catch(e){}return!1},Tools.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})},Object.defineProperty(Tools,"NoneLogLevel",{get:function(){return Tools._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"MessageLogLevel",{get:function(){return Tools._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"WarningLogLevel",{get:function(){return Tools._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"ErrorLogLevel",{get:function(){return Tools._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"AllLogLevel",{get:function(){return Tools._MessageLogLevel|Tools._WarningLogLevel|Tools._ErrorLogLevel},enumerable:!0,configurable:!0}),Tools._AddLogEntry=function(entry){Tools._LogCache=entry+Tools._LogCache,Tools.OnNewCacheEntry&&Tools.OnNewCacheEntry(entry)},Tools._FormatMessage=function(message){var padStr=function(i){return i<10?"0"+i:""+i},date=new Date;return"["+padStr(date.getHours())+":"+padStr(date.getMinutes())+":"+padStr(date.getSeconds())+"]: "+message},Tools._LogDisabled=function(message){},Tools._LogEnabled=function(message){var formattedMessage=Tools._FormatMessage(message);console.log("BJS - "+formattedMessage);var entry="<div style='color:white'>"+formattedMessage+"</div><br>";Tools._AddLogEntry(entry)},Tools._WarnDisabled=function(message){},Tools._WarnEnabled=function(message){var formattedMessage=Tools._FormatMessage(message);console.warn("BJS - "+formattedMessage);var entry="<div style='color:orange'>"+formattedMessage+"</div><br>";Tools._AddLogEntry(entry)},Tools._ErrorDisabled=function(message){},Tools._ErrorEnabled=function(message){Tools.errorsCount++;var formattedMessage=Tools._FormatMessage(message);console.error("BJS - "+formattedMessage);var entry="<div style='color:red'>"+formattedMessage+"</div><br>";Tools._AddLogEntry(entry)},Object.defineProperty(Tools,"LogCache",{get:function(){return Tools._LogCache},enumerable:!0,configurable:!0}),Tools.ClearLogCache=function(){Tools._LogCache="",Tools.errorsCount=0},Object.defineProperty(Tools,"LogLevels",{set:function(level){Tools.Log=(level&Tools.MessageLogLevel)===Tools.MessageLogLevel?Tools._LogEnabled:Tools._LogDisabled,Tools.Warn=(level&Tools.WarningLogLevel)===Tools.WarningLogLevel?Tools._WarnEnabled:Tools._WarnDisabled,Tools.Error=(level&Tools.ErrorLogLevel)===Tools.ErrorLogLevel?Tools._ErrorEnabled:Tools._ErrorDisabled},enumerable:!0,configurable:!0}),Tools.IsWindowObjectExist=function(){return"undefined"!=typeof window},Object.defineProperty(Tools,"PerformanceNoneLogLevel",{get:function(){return Tools._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"PerformanceUserMarkLogLevel",{get:function(){return Tools._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"PerformanceConsoleLogLevel",{get:function(){return Tools._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(Tools,"PerformanceLogLevel",{set:function(level){return(level&Tools.PerformanceUserMarkLogLevel)===Tools.PerformanceUserMarkLogLevel?(Tools.StartPerformanceCounter=Tools._StartUserMark,void(Tools.EndPerformanceCounter=Tools._EndUserMark)):(level&Tools.PerformanceConsoleLogLevel)===Tools.PerformanceConsoleLogLevel?(Tools.StartPerformanceCounter=Tools._StartPerformanceConsole,void(Tools.EndPerformanceCounter=Tools._EndPerformanceConsole)):(Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled,void(Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Tools._StartPerformanceCounterDisabled=function(counterName,condition){},Tools._EndPerformanceCounterDisabled=function(counterName,condition){},Tools._StartUserMark=function(counterName,condition){if(void 0===condition&&(condition=!0),!Tools._performance){if(!Tools.IsWindowObjectExist())return;Tools._performance=window.performance}condition&&Tools._performance.mark&&Tools._performance.mark(counterName+"-Begin")},Tools._EndUserMark=function(counterName,condition){void 0===condition&&(condition=!0),condition&&Tools._performance.mark&&(Tools._performance.mark(counterName+"-End"),Tools._performance.measure(counterName,counterName+"-Begin",counterName+"-End"))},Tools._StartPerformanceConsole=function(counterName,condition){void 0===condition&&(condition=!0),condition&&(Tools._StartUserMark(counterName,condition),console.time&&console.time(counterName))},Tools._EndPerformanceConsole=function(counterName,condition){void 0===condition&&(condition=!0),condition&&(Tools._EndUserMark(counterName,condition),console.time&&console.timeEnd(counterName))},Object.defineProperty(Tools,"Now",{get:function(){return Tools.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),Tools.GetClassName=function(object,isType){void 0===isType&&(isType=!1);var name=null;return!isType&&object.getClassName?name=object.getClassName():(object instanceof Object&&(name=(isType?object:Object.getPrototypeOf(object)).constructor.__bjsclassName__),name||(name=typeof object)),name},Tools.First=function(array,predicate){for(var _i=0,array_1=array;_i<array_1.length;_i++){var el=array_1[_i];if(predicate(el))return el}return null},Tools.getFullClassName=function(object,isType){void 0===isType&&(isType=!1);var className=null,moduleName=null;if(!isType&&object.getClassName)className=object.getClassName();else{if(object instanceof Object){var classObj=isType?object:Object.getPrototypeOf(object);className=classObj.constructor.__bjsclassName__,moduleName=classObj.constructor.__bjsmoduleName__}className||(className=typeof object)}return className?(null!=moduleName?moduleName+".":"")+className:null},Tools.arrayOrStringFeeder=function(array){return function(index){if(index>=array.length)return null;var val=array.charCodeAt?array.charCodeAt(index):array[index];return val&&val.getHashCode&&(val=val.getHashCode()),"string"==typeof val?Tools.hashCodeFromStream(Tools.arrayOrStringFeeder(val)):val}},Tools.hashCodeFromStream=function(feeder){for(var hash=0,index=0,chr=feeder(index++);null!=chr;)hash=(hash<<5)-hash+chr,hash|=0,chr=feeder(index++);return hash},Tools.BaseUrl="",Tools.CorsBehavior="anonymous",Tools.UseFallbackTexture=!0,Tools.RegisteredExternalClasses={},Tools.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",Tools.PreprocessUrl=function(url){return url},Tools._NoneLogLevel=0,Tools._MessageLogLevel=1,Tools._WarningLogLevel=2,Tools._ErrorLogLevel=4,Tools._LogCache="",Tools.errorsCount=0,Tools.Log=Tools._LogEnabled,Tools.Warn=Tools._WarnEnabled,Tools.Error=Tools._ErrorEnabled,Tools._PerformanceNoneLogLevel=0,Tools._PerformanceUserMarkLogLevel=1,Tools._PerformanceConsoleLogLevel=2,Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled,Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled,Tools}();BABYLON.Tools=Tools;var PerfCounter=function(){function PerfCounter(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(PerfCounter.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(PerfCounter.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),PerfCounter.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},PerfCounter.prototype.addCount=function(newCount,fetchResult){PerfCounter.Enabled&&(this._current+=newCount,fetchResult&&this._fetchResult())},PerfCounter.prototype.beginMonitoring=function(){PerfCounter.Enabled&&(this._startMonitoringTime=Tools.Now)},PerfCounter.prototype.endMonitoring=function(newFrame){if(void 0===newFrame&&(newFrame=!0),PerfCounter.Enabled){newFrame&&this.fetchNewFrame();var currentTime=Tools.Now;this._current=currentTime-this._startMonitoringTime,newFrame&&this._fetchResult()}},PerfCounter.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var now=Tools.Now;now-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=now,this._lastSecAccumulated=0,this._lastSecValueCount=0)},PerfCounter.Enabled=!0,PerfCounter}();BABYLON.PerfCounter=PerfCounter,BABYLON.className=function(name,module){return function(target){target.__bjsclassName__=name,target.__bjsmoduleName__=null!=module?module:null}};var AsyncLoop=function(){function AsyncLoop(iterations,_fn,_successCallback,offset){void 0===offset&&(offset=0),this.iterations=iterations,this._fn=_fn,this._successCallback=_successCallback,this.index=offset-1,this._done=!1}return AsyncLoop.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},AsyncLoop.prototype.breakLoop=function(){this._done=!0,this._successCallback()},AsyncLoop.Run=function(iterations,_fn,_successCallback,offset){void 0===offset&&(offset=0);var loop=new AsyncLoop(iterations,_fn,_successCallback,offset);return loop.executeNext(),loop},AsyncLoop.SyncAsyncForLoop=function(iterations,syncedIterations,fn,callback,breakFunction,timeout){void 0===timeout&&(timeout=0),AsyncLoop.Run(Math.ceil(iterations/syncedIterations),function(loop){breakFunction&&breakFunction()?loop.breakLoop():setTimeout(function(){for(var i=0;i<syncedIterations;++i){var iteration=loop.index*syncedIterations+i;if(iteration>=iterations)break;if(fn(iteration),breakFunction&&breakFunction()){loop.breakLoop();break}}loop.executeNext()},timeout)},callback)},AsyncLoop}();BABYLON.AsyncLoop=AsyncLoop}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var _AlphaState=function(){function _AlphaState(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(_AlphaState.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(_AlphaState.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(value){this._alphaBlend!==value&&(this._alphaBlend=value,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),_AlphaState.prototype.setAlphaBlendConstants=function(r,g,b,a){this._blendConstants[0]===r&&this._blendConstants[1]===g&&this._blendConstants[2]===b&&this._blendConstants[3]===a||(this._blendConstants[0]=r,this._blendConstants[1]=g,this._blendConstants[2]=b,this._blendConstants[3]=a,this._isBlendConstantsDirty=!0)},_AlphaState.prototype.setAlphaBlendFunctionParameters=function(value0,value1,value2,value3){this._blendFunctionParameters[0]===value0&&this._blendFunctionParameters[1]===value1&&this._blendFunctionParameters[2]===value2&&this._blendFunctionParameters[3]===value3||(this._blendFunctionParameters[0]=value0,this._blendFunctionParameters[1]=value1,this._blendFunctionParameters[2]=value2,this._blendFunctionParameters[3]=value3,this._isBlendFunctionParametersDirty=!0)},_AlphaState.prototype.setAlphaEquationParameters=function(rgb,alpha){this._blendEquationParameters[0]===rgb&&this._blendEquationParameters[1]===alpha||(this._blendEquationParameters[0]=rgb,this._blendEquationParameters[1]=alpha,this._isBlendEquationParametersDirty=!0)},_AlphaState.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},_AlphaState.prototype.apply=function(gl){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?gl.enable(gl.BLEND):gl.disable(gl.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(gl.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(gl.blendEquationSeparate(this._isBlendEquationParametersDirty[0],this._isBlendEquationParametersDirty[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(gl.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},_AlphaState}();Internals._AlphaState=_AlphaState}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var _DepthCullingState=function(){function _DepthCullingState(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this.reset()}return Object.defineProperty(_DepthCullingState.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"zOffset",{get:function(){return this._zOffset},set:function(value){this._zOffset!==value&&(this._zOffset=value,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"cullFace",{get:function(){return this._cullFace},set:function(value){this._cullFace!==value&&(this._cullFace=value,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"cull",{get:function(){return this._cull},set:function(value){this._cull!==value&&(this._cull=value,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(value){this._depthFunc!==value&&(this._depthFunc=value,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"depthMask",{get:function(){return this._depthMask},set:function(value){this._depthMask!==value&&(this._depthMask=value,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_DepthCullingState.prototype,"depthTest",{get:function(){return this._depthTest},set:function(value){this._depthTest!==value&&(this._depthTest=value,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),_DepthCullingState.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},_DepthCullingState.prototype.apply=function(gl){this.isDirty&&(this._isCullDirty&&(this.cull?gl.enable(gl.CULL_FACE):gl.disable(gl.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(gl.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(gl.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?gl.enable(gl.DEPTH_TEST):gl.disable(gl.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(gl.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(gl.enable(gl.POLYGON_OFFSET_FILL),gl.polygonOffset(this.zOffset,0)):gl.disable(gl.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},_DepthCullingState}();Internals._DepthCullingState=_DepthCullingState}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var _StencilState=function(){function _StencilState(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(_StencilState.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(value){this._stencilFunc!==value&&(this._stencilFunc=value,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(value){this._stencilFuncRef!==value&&(this._stencilFuncRef=value,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(value){this._stencilFuncMask!==value&&(this._stencilFuncMask=value,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(value){this._stencilOpStencilFail!==value&&(this._stencilOpStencilFail=value,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(value){this._stencilOpDepthFail!==value&&(this._stencilOpDepthFail=value,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(value){this._stencilOpStencilDepthPass!==value&&(this._stencilOpStencilDepthPass=value,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(value){this._stencilMask!==value&&(this._stencilMask=value,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(_StencilState.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(value){this._stencilTest!==value&&(this._stencilTest=value,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),_StencilState.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=BABYLON.Engine.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=BABYLON.Engine.KEEP,this._stencilOpDepthFail=BABYLON.Engine.KEEP,this._stencilOpStencilDepthPass=BABYLON.Engine.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},_StencilState.prototype.apply=function(gl){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?gl.enable(gl.STENCIL_TEST):gl.disable(gl.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(gl.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(gl.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(gl.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},_StencilState}();Internals._StencilState=_StencilState}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var compileShader=function(gl,source,type,defines,shaderVersion){return compileRawShader(gl,shaderVersion+(defines?defines+"\n":"")+source,type)},compileRawShader=function(gl,source,type){var shader=gl.createShader("vertex"===type?gl.VERTEX_SHADER:gl.FRAGMENT_SHADER);if(gl.shaderSource(shader,source),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var log=gl.getShaderInfoLog(shader);if(log)throw new Error(log)}if(!shader)throw new Error("Something went wrong while compile the shader.");return shader},getSamplingParameters=function(samplingMode,generateMipMaps,gl){var magFilter=gl.NEAREST,minFilter=gl.NEAREST;switch(samplingMode){case BABYLON.Texture.BILINEAR_SAMPLINGMODE:magFilter=gl.LINEAR,minFilter=generateMipMaps?gl.LINEAR_MIPMAP_NEAREST:gl.LINEAR;break;case BABYLON.Texture.TRILINEAR_SAMPLINGMODE:magFilter=gl.LINEAR,minFilter=generateMipMaps?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR;break;case BABYLON.Texture.NEAREST_SAMPLINGMODE:magFilter=gl.NEAREST,minFilter=generateMipMaps?gl.NEAREST_MIPMAP_LINEAR:gl.NEAREST;break;case BABYLON.Texture.NEAREST_NEAREST_MIPNEAREST:magFilter=gl.NEAREST,minFilter=generateMipMaps?gl.NEAREST_MIPMAP_NEAREST:gl.NEAREST;break;case BABYLON.Texture.NEAREST_LINEAR_MIPNEAREST:magFilter=gl.NEAREST,minFilter=generateMipMaps?gl.LINEAR_MIPMAP_NEAREST:gl.LINEAR;break;case BABYLON.Texture.NEAREST_LINEAR_MIPLINEAR:magFilter=gl.NEAREST,minFilter=generateMipMaps?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR;break;case BABYLON.Texture.NEAREST_LINEAR:magFilter=gl.NEAREST,minFilter=gl.LINEAR;break;case BABYLON.Texture.NEAREST_NEAREST:magFilter=gl.NEAREST,minFilter=gl.NEAREST;break;case BABYLON.Texture.LINEAR_NEAREST_MIPNEAREST:magFilter=gl.LINEAR,minFilter=generateMipMaps?gl.NEAREST_MIPMAP_NEAREST:gl.NEAREST;break;case BABYLON.Texture.LINEAR_NEAREST_MIPLINEAR:magFilter=gl.LINEAR,minFilter=generateMipMaps?gl.NEAREST_MIPMAP_LINEAR:gl.NEAREST;break;case BABYLON.Texture.LINEAR_LINEAR:magFilter=gl.LINEAR,minFilter=gl.LINEAR;break;case BABYLON.Texture.LINEAR_NEAREST:magFilter=gl.LINEAR,minFilter=gl.NEAREST}return{min:minFilter,mag:magFilter}},partialLoadImg=function(url,index,loadedImages,scene,onfinish,onErrorCallBack){void 0===onErrorCallBack&&(onErrorCallBack=null);var img;img=BABYLON.Tools.LoadImage(url,function(){loadedImages[index]=img,loadedImages._internalCount++,scene&&scene._removePendingData(img),6===loadedImages._internalCount&&onfinish(loadedImages)},function(message,exception){scene&&scene._removePendingData(img),onErrorCallBack&&onErrorCallBack(message,exception)},scene?scene.database:null),scene&&scene._addPendingData(img)},cascadeLoadImgs=function(rootUrl,scene,onfinish,files,onError){void 0===onError&&(onError=null);var loadedImages=[];loadedImages._internalCount=0;for(var index=0;index<6;index++)partialLoadImg(files[index],index,loadedImages,scene,onfinish,onError)},partialLoadFile=function(url,index,loadedFiles,scene,onfinish,onErrorCallBack){void 0===onErrorCallBack&&(onErrorCallBack=null);BABYLON.Tools.LoadFile(url,function(data){loadedFiles[index]=data,loadedFiles._internalCount++,6===loadedFiles._internalCount&&onfinish(loadedFiles)},void 0,void 0,!0,function(request,exception){onErrorCallBack&&request&&onErrorCallBack(request.status+" "+request.statusText,exception)})},cascadeLoadFiles=function(rootUrl,scene,onfinish,files,onError){void 0===onError&&(onError=null);var loadedFiles=[];loadedFiles._internalCount=0;for(var index=0;index<6;index++)partialLoadFile(files[index],index,loadedFiles,0,onfinish,onError)},BufferPointer=function(){return function(){}}(),InstancingAttributeInfo=function(){return function(){}}();BABYLON.InstancingAttributeInfo=InstancingAttributeInfo;var RenderTargetCreationOptions=function(){return function(){}}();BABYLON.RenderTargetCreationOptions=RenderTargetCreationOptions;var EngineCapabilities=function(){return function(){}}();BABYLON.EngineCapabilities=EngineCapabilities;var Engine=function(){function Engine(canvasOrContext,antialias,options,adaptToDeviceRatio){void 0===adaptToDeviceRatio&&(adaptToDeviceRatio=!1);var _this=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.scenes=new Array,this.postProcesses=new Array,this.onResizeObservable=new BABYLON.Observable,this.onCanvasBlurObservable=new BABYLON.Observable,this.onCanvasFocusObservable=new BABYLON.Observable,this.onCanvasPointerOutObservable=new BABYLON.Observable,this.onBeforeTextureInitObservable=new BABYLON.Observable,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new BABYLON.Observable,this.onEndFrameObservable=new BABYLON.Observable,this.onBeforeShaderCompilationObservable=new BABYLON.Observable,this.onAfterShaderCompilationObservable=new BABYLON.Observable,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.onVRDisplayChangedObservable=new BABYLON.Observable,this.onVRRequestPresentComplete=new BABYLON.Observable,this.onVRRequestPresentStart=new BABYLON.Observable,this._colorWrite=!0,this._drawCalls=new BABYLON.PerfCounter,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new BABYLON.Observable,this.onContextRestoredObservable=new BABYLON.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new BABYLON.PerformanceMonitor,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new BABYLON.Internals._DepthCullingState,this._stencilState=new BABYLON.Internals._StencilState,this._alphaState=new BABYLON.Internals._AlphaState,this._alphaMode=Engine.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._texturesSupported=new Array,this._onVRFullScreenTriggered=function(){if(_this._vrDisplay&&_this._vrDisplay.isPresenting){_this._oldSize=new BABYLON.Size(_this.getRenderWidth(),_this.getRenderHeight()),_this._oldHardwareScaleFactor=_this.getHardwareScalingLevel();var leftEye=_this._vrDisplay.getEyeParameters("left");_this.setHardwareScalingLevel(1),_this.setSize(2*leftEye.renderWidth,leftEye.renderHeight)}else _this.setHardwareScalingLevel(_this._oldHardwareScaleFactor),_this.setSize(_this._oldSize.width,_this._oldSize.height)};var canvas=null;if(Engine.Instances.push(this),canvasOrContext){if(options=options||{},canvasOrContext.getContext){if(canvas=canvasOrContext,this._renderingCanvas=canvas,null!=antialias&&(options.antialias=antialias),void 0===options.deterministicLockstep&&(options.deterministicLockstep=!1),void 0===options.lockstepMaxSteps&&(options.lockstepMaxSteps=4),void 0===options.preserveDrawingBuffer&&(options.preserveDrawingBuffer=!1),void 0===options.audioEngine&&(options.audioEngine=!0),void 0===options.stencil&&(options.stencil=!0),this._deterministicLockstep=options.deterministicLockstep,this._lockstepMaxSteps=options.lockstepMaxSteps,this._doNotHandleContextLost=!!options.doNotHandleContextLost,!options.disableWebGL2Support&&navigator&&navigator.userAgent)for(var ua=navigator.userAgent,_i=0,_a=Engine.WebGL2UniformBuffersExceptionList;_i<_a.length;_i++){var exception=_a[_i];if(ua.indexOf(exception)>-1){this.disableUniformBuffers=!0;break}}if(!options.disableWebGL2Support)try{this._gl=canvas.getContext("webgl2",options)||canvas.getContext("experimental-webgl2",options),this._gl&&(this._webGLVersion=2)}catch(e){}if(!this._gl){if(!canvas)throw new Error("The provided canvas is null or undefined.");try{this._gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){_this.onCanvasFocusObservable.notifyObservers(_this)},this._onCanvasBlur=function(){_this.onCanvasBlurObservable.notifyObservers(_this)},canvas.addEventListener("focus",this._onCanvasFocus),canvas.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){_this.disablePerformanceMonitorInBackground&&_this._performanceMonitor.disable(),_this._windowIsBackground=!0},this._onFocus=function(){_this.disablePerformanceMonitorInBackground&&_this._performanceMonitor.enable(),_this._windowIsBackground=!1},this._onCanvasPointerOut=function(){_this.onCanvasPointerOutObservable.notifyObservers(_this)},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),canvas.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(evt){evt.preventDefault(),_this._contextWasLost=!0,BABYLON.Tools.Warn("WebGL context lost."),_this.onContextLostObservable.notifyObservers(_this)},this._onContextRestored=function(evt){setTimeout(function(){_this._initGLContext(),_this._rebuildEffects(),_this._rebuildInternalTextures(),_this._rebuildBuffers(),_this.wipeCaches(!0),BABYLON.Tools.Warn("WebGL context successfully restored."),_this.onContextRestoredObservable.notifyObservers(_this),_this._contextWasLost=!1},0)},canvas.addEventListener("webglcontextlost",this._onContextLost,!1),canvas.addEventListener("webglcontextrestored",this._onContextRestored,!1))}else this._gl=canvasOrContext,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2),options.stencil=this._gl.getContextAttributes().stencil;var limitDeviceRatio=options.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=adaptToDeviceRatio?1/Math.min(limitDeviceRatio,window.devicePixelRatio||1):1,this.resize(),this._isStencilEnable=!!options.stencil,this._initGLContext(),canvas&&(this._onFullscreenChange=function(){void 0!==document.fullscreen?_this.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?_this.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?_this.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(_this.isFullscreen=document.msIsFullScreen),_this.isFullscreen&&_this._pointerLockRequested&&canvas&&(canvas.requestPointerLock=canvas.requestPointerLock||canvas.msRequestPointerLock||canvas.mozRequestPointerLock||canvas.webkitRequestPointerLock,canvas.requestPointerLock&&canvas.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){_this.isPointerLock=document.mozPointerLockElement===canvas||document.webkitPointerLockElement===canvas||document.msPointerLockElement===canvas||document.pointerLockElement===canvas},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){canvas&&canvas.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)),options.audioEngine&&BABYLON.AudioEngine&&!Engine.audioEngine&&(Engine.audioEngine=new BABYLON.AudioEngine);for(var i=0;i<this._caps.maxVertexAttribs;i++)this._currentBufferPointers[i]=new BufferPointer;options.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),BABYLON.Tools.Log("Babylon.js engine (v"+Engine.Version+") launched"),this.enableOfflineSupport=void 0!==BABYLON.Database}}return Object.defineProperty(Engine,"LastCreatedEngine",{get:function(){return 0===Engine.Instances.length?null:Engine.Instances[Engine.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"LastCreatedScene",{get:function(){var lastCreatedEngine=Engine.LastCreatedEngine;return lastCreatedEngine?0===lastCreatedEngine.scenes.length?null:lastCreatedEngine.scenes[lastCreatedEngine.scenes.length-1]:null},enumerable:!0,configurable:!0}),Engine.MarkAllMaterialsAsDirty=function(flag,predicate){for(var engineIndex=0;engineIndex<Engine.Instances.length;engineIndex++)for(var engine=Engine.Instances[engineIndex],sceneIndex=0;sceneIndex<engine.scenes.length;sceneIndex++)engine.scenes[sceneIndex].markAllMaterialsAsDirty(flag,predicate)},Object.defineProperty(Engine,"NEVER",{get:function(){return Engine._NEVER},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALWAYS",{get:function(){return Engine._ALWAYS},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"LESS",{get:function(){return Engine._LESS},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"EQUAL",{get:function(){return Engine._EQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"LEQUAL",{get:function(){return Engine._LEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"GREATER",{get:function(){return Engine._GREATER},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"GEQUAL",{get:function(){return Engine._GEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"NOTEQUAL",{get:function(){return Engine._NOTEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"KEEP",{get:function(){return Engine._KEEP},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"REPLACE",{get:function(){return Engine._REPLACE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"INCR",{get:function(){return Engine._INCR},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DECR",{get:function(){return Engine._DECR},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"INVERT",{get:function(){return Engine._INVERT},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"INCR_WRAP",{get:function(){return Engine._INCR_WRAP},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DECR_WRAP",{get:function(){return Engine._DECR_WRAP},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_DISABLE",{get:function(){return Engine._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_ONEONE",{get:function(){return Engine._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_ADD",{get:function(){return Engine._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_COMBINE",{get:function(){return Engine._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_SUBTRACT",{get:function(){return Engine._ALPHA_SUBTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_MULTIPLY",{get:function(){return Engine._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_MAXIMIZED",{get:function(){return Engine._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_PREMULTIPLIED",{get:function(){return Engine._ALPHA_PREMULTIPLIED},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_PREMULTIPLIED_PORTERDUFF",{get:function(){return Engine._ALPHA_PREMULTIPLIED_PORTERDUFF},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_INTERPOLATE",{get:function(){return Engine._ALPHA_INTERPOLATE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"ALPHA_SCREENMODE",{get:function(){return Engine._ALPHA_SCREENMODE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DELAYLOADSTATE_NONE",{get:function(){return Engine._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DELAYLOADSTATE_LOADED",{get:function(){return Engine._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DELAYLOADSTATE_LOADING",{get:function(){return Engine._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"DELAYLOADSTATE_NOTLOADED",{get:function(){return Engine._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTUREFORMAT_ALPHA",{get:function(){return Engine._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTUREFORMAT_LUMINANCE",{get:function(){return Engine._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return Engine._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTUREFORMAT_RGB",{get:function(){return Engine._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTUREFORMAT_RGBA",{get:function(){return Engine._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return Engine._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTURETYPE_FLOAT",{get:function(){return Engine._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"TEXTURETYPE_HALF_FLOAT",{get:function(){return Engine._TEXTURETYPE_HALF_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"SCALEMODE_FLOOR",{get:function(){return Engine._SCALEMODE_FLOOR},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"SCALEMODE_NEAREST",{get:function(){return Engine._SCALEMODE_NEAREST},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"SCALEMODE_CEILING",{get:function(){return Engine._SCALEMODE_CEILING},enumerable:!0,configurable:!0}),Object.defineProperty(Engine,"Version",{get:function(){return"3.1.1"},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"badOS",{get:function(){return this._badOS},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"badDesktopOS",{get:function(){return this._badDesktopOS},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var faceData=new Uint8Array(4),cubeData=[faceData,faceData,faceData,faceData,faceData,faceData];this._emptyCubeTexture=this.createRawCubeTexture(cubeData,1,BABYLON.Engine.TEXTUREFORMAT_RGBA,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,!1,!1,BABYLON.Texture.NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),Engine.prototype._rebuildInternalTextures=function(){for(var _i=0,currentState_1=this._internalTexturesCache.slice();_i<currentState_1.length;_i++)currentState_1[_i]._rebuild()},Engine.prototype._rebuildEffects=function(){for(var key in this._compiledEffects)this._compiledEffects[key]._prepareEffect();BABYLON.Effect.ResetCache()},Engine.prototype._rebuildBuffers=function(){for(var _i=0,_a=this.scenes;_i<_a.length;_i++){var scene=_a[_i];scene.resetCachedMaterial(),scene._rebuildGeometries(),scene._rebuildTextures()}for(var _b=0,_c=this._uniformBuffers;_b<_c.length;_b++)_c[_b]._rebuild()},Engine.prototype._initGLContext=function(){this._caps=new EngineCapabilities,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var rendererInfo=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=rendererInfo&&(this._glRenderer=this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=this._webGLVersion>1||this._gl.getExtension("OES_texture_float"),this._caps.textureFloatLinearFiltering=this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear"),this._caps.textureFloatRender=this._caps.textureFloat&&this._canRenderToFloatFramebuffer(),this._caps.textureHalfFloat=this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float"),this._caps.textureHalfFloatLinearFiltering=this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear"),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers");if(null!==drawBuffersExtension){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=drawBuffersExtension["COLOR_ATTACHMENT"+i+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._webGLVersion>1?this._caps.depthTextureExtension=!0:null!=this._gl.getExtension("WEBGL_depth_texture")&&(this._caps.depthTextureExtension=!0),this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var vertexArrayObjectExtension=this._gl.getExtension("OES_vertex_array_object");null!=vertexArrayObjectExtension?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension),this._gl.bindVertexArray=vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension),this._gl.deleteVertexArray=vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var instanceExtension=this._gl.getExtension("ANGLE_instanced_arrays");null!=instanceExtension?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension),this._gl.drawElementsInstanced=instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension),this._gl.vertexAttribDivisor=instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var highp=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);highp&&(this._caps.highPrecisionShaderSupported=0!==highp.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0)},Object.defineProperty(Engine.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),Engine.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var context=this._workingCanvas.getContext("2d");context&&(this._workingContext=context)}},Engine.prototype.resetTextureCache=function(){for(var key in this._boundTexturesCache)this._boundTexturesCache[key]=null},Engine.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},Engine.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},Engine.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},Engine.prototype.getAspectRatio=function(camera,useScreen){void 0===useScreen&&(useScreen=!1);var viewport=camera.viewport;return this.getRenderWidth(useScreen)*viewport.width/(this.getRenderHeight(useScreen)*viewport.height)},Engine.prototype.getRenderWidth=function(useScreen){return void 0===useScreen&&(useScreen=!1),!useScreen&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},Engine.prototype.getRenderHeight=function(useScreen){return void 0===useScreen&&(useScreen=!1),!useScreen&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},Engine.prototype.getRenderingCanvas=function(){return this._renderingCanvas},Engine.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},Engine.prototype.setHardwareScalingLevel=function(level){this._hardwareScalingLevel=level,this.resize()},Engine.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},Engine.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},Engine.prototype.getCaps=function(){return this._caps},Object.defineProperty(Engine.prototype,"drawCalls",{get:function(){return BABYLON.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"),0},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"drawCallsPerfCounter",{get:function(){return BABYLON.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Engine.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},Engine.prototype.setDepthFunction=function(depthFunc){this._depthCullingState.depthFunc=depthFunc},Engine.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},Engine.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},Engine.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},Engine.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},Engine.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},Engine.prototype.setStencilBuffer=function(enable){this._stencilState.stencilTest=enable},Engine.prototype.getStencilMask=function(){return this._stencilState.stencilMask},Engine.prototype.setStencilMask=function(mask){this._stencilState.stencilMask=mask},Engine.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},Engine.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},Engine.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},Engine.prototype.setStencilFunction=function(stencilFunc){this._stencilState.stencilFunc=stencilFunc},Engine.prototype.setStencilFunctionReference=function(reference){this._stencilState.stencilFuncRef=reference},Engine.prototype.setStencilFunctionMask=function(mask){this._stencilState.stencilFuncMask=mask},Engine.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},Engine.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},Engine.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},Engine.prototype.setStencilOperationFail=function(operation){this._stencilState.stencilOpStencilFail=operation},Engine.prototype.setStencilOperationDepthFail=function(operation){this._stencilState.stencilOpDepthFail=operation},Engine.prototype.setStencilOperationPass=function(operation){this._stencilState.stencilOpStencilDepthPass=operation},Engine.prototype.setDitheringState=function(value){value?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},Engine.prototype.setRasterizerState=function(value){value?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},Engine.prototype.stopRenderLoop=function(renderFunction){if(renderFunction){var index=this._activeRenderLoops.indexOf(renderFunction);index>=0&&this._activeRenderLoops.splice(index,1)}else this._activeRenderLoops=[]},Engine.prototype._renderLoop=function(){if(!this._contextWasLost){var shouldRender=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(shouldRender=!1),shouldRender){this.beginFrame();for(var index=0;index<this._activeRenderLoops.length;index++)(0,this._activeRenderLoops[index])();this.endFrame()}}if(this._activeRenderLoops.length>0){var requester=null;this._vrDisplay&&this._vrDisplay.isPresenting&&(requester=this._vrDisplay),this._frameHandler=BABYLON.Tools.QueueNewFrame(this._bindedRenderFunction,requester)}else this._renderingQueueLaunched=!1},Engine.prototype.runRenderLoop=function(renderFunction){-1===this._activeRenderLoops.indexOf(renderFunction)&&(this._activeRenderLoops.push(renderFunction),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=BABYLON.Tools.QueueNewFrame(this._bindedRenderFunction)))},Engine.prototype.switchFullscreen=function(requestPointerLock){this.isFullscreen?BABYLON.Tools.ExitFullscreen():(this._pointerLockRequested=requestPointerLock,this._renderingCanvas&&BABYLON.Tools.RequestFullscreen(this._renderingCanvas))},Engine.prototype.clear=function(color,backBuffer,depth,stencil){void 0===stencil&&(stencil=!1),this.applyStates();var mode=0;backBuffer&&color&&(this._gl.clearColor(color.r,color.g,color.b,void 0!==color.a?color.a:1),mode|=this._gl.COLOR_BUFFER_BIT),depth&&(this._gl.clearDepth(1),mode|=this._gl.DEPTH_BUFFER_BIT),stencil&&(this._gl.clearStencil(0),mode|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(mode)},Engine.prototype.scissorClear=function(x,y,width,height,clearColor){var gl=this._gl,curScissor=gl.getParameter(gl.SCISSOR_TEST),curScissorBox=gl.getParameter(gl.SCISSOR_BOX);gl.enable(gl.SCISSOR_TEST),gl.scissor(x,y,width,height),this.clear(clearColor,!0,!0,!0),gl.scissor(curScissorBox[0],curScissorBox[1],curScissorBox[2],curScissorBox[3]),!0===curScissor?gl.enable(gl.SCISSOR_TEST):gl.disable(gl.SCISSOR_TEST)},Engine.prototype.setViewport=function(viewport,requiredWidth,requiredHeight){var width=requiredWidth||this.getRenderWidth(),height=requiredHeight||this.getRenderHeight(),x=viewport.x||0,y=viewport.y||0;this._cachedViewport=viewport,this._gl.viewport(x*width,y*height,width*viewport.width,height*viewport.height)},Engine.prototype.setDirectViewport=function(x,y,width,height){var currentViewport=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(x,y,width,height),currentViewport},Engine.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},Engine.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},Engine.prototype.resize=function(){if(!this._vrDisplay||!this._vrDisplay.isPresenting){var width=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,height=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(width/this._hardwareScalingLevel,height/this._hardwareScalingLevel)}},Engine.prototype.setSize=function(width,height){if(this._renderingCanvas&&(this._renderingCanvas.width!==width||this._renderingCanvas.height!==height)){this._renderingCanvas.width=width,this._renderingCanvas.height=height;for(var index=0;index<this.scenes.length;index++)for(var scene=this.scenes[index],camIndex=0;camIndex<scene.cameras.length;camIndex++)scene.cameras[camIndex]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},Engine.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},Engine.prototype.getVRDevice=function(){return this._vrDisplay},Engine.prototype.initWebVR=function(){var _this=this,notifyObservers=function(){var eventArgs={vrDisplay:_this._vrDisplay,vrSupported:_this._vrSupported};_this.onVRDisplayChangedObservable.notifyObservers(eventArgs)};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(event){_this._vrDisplay=event.display,notifyObservers()},this._onVrDisplayDisconnect=function(){_this._vrDisplay.cancelAnimationFrame(_this._frameHandler),_this._vrDisplay=void 0,_this._frameHandler=BABYLON.Tools.QueueNewFrame(_this._bindedRenderFunction),notifyObservers()},this._onVrDisplayPresentChange=function(){_this._vrExclusivePointerMode=_this._vrDisplay&&_this._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._getVRDisplays(notifyObservers),this.onVRDisplayChangedObservable},Engine.prototype.enableVR=function(){var _this=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){_this.onVRRequestPresentComplete.notifyObservers(!0),_this._onVRFullScreenTriggered()}).catch(function(){_this.onVRRequestPresentComplete.notifyObservers(!1)})}},Engine.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},Engine.prototype._getVRDisplays=function(callback){var _this=this;navigator.getVRDisplays?navigator.getVRDisplays().then(function(devices){return _this._vrSupported=!0,_this._vrDisplay=devices[0]}).then(callback).catch(function(error){_this._vrSupported=!1,callback()}):(this._vrDisplay=void 0,this._vrSupported=!1,callback())},Engine.prototype.bindFramebuffer=function(texture,faceIndex,requiredWidth,requiredHeight,forceFullscreenViewport){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=texture,this.bindUnboundFramebuffer(texture._MSAAFramebuffer?texture._MSAAFramebuffer:texture._framebuffer);var gl=this._gl;texture.isCube&&(void 0===faceIndex&&(faceIndex=0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,texture._webGLTexture,0)),this._cachedViewport&&!forceFullscreenViewport?this.setViewport(this._cachedViewport,requiredWidth,requiredHeight):gl.viewport(0,0,requiredWidth||texture.width,requiredHeight||texture.height),this.wipeCaches()},Engine.prototype.bindUnboundFramebuffer=function(framebuffer){this._currentFramebuffer!==framebuffer&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,framebuffer),this._currentFramebuffer=framebuffer)},Engine.prototype.unBindFramebuffer=function(texture,disableGenerateMipMaps,onBeforeUnbind){void 0===disableGenerateMipMaps&&(disableGenerateMipMaps=!1),this._currentRenderTarget=null;var gl=this._gl;texture._MSAAFramebuffer&&(gl.bindFramebuffer(gl.READ_FRAMEBUFFER,texture._MSAAFramebuffer),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,texture._framebuffer),gl.blitFramebuffer(0,0,texture.width,texture.height,0,0,texture.width,texture.height,gl.COLOR_BUFFER_BIT,gl.NEAREST)),!texture.generateMipMaps||disableGenerateMipMaps||texture.isCube||(this._bindTextureDirectly(gl.TEXTURE_2D,texture),gl.generateMipmap(gl.TEXTURE_2D),this._bindTextureDirectly(gl.TEXTURE_2D,null)),onBeforeUnbind&&(texture._MSAAFramebuffer&&this.bindUnboundFramebuffer(texture._framebuffer),onBeforeUnbind()),this.bindUnboundFramebuffer(null)},Engine.prototype.generateMipMapsForCubemap=function(texture){if(texture.generateMipMaps){var gl=this._gl;this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.generateMipmap(gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null)}},Engine.prototype.flushFramebuffer=function(){this._gl.flush()},Engine.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},Engine.prototype.createUniformBuffer=function(elements){var ubo=this._gl.createBuffer();if(!ubo)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(ubo),elements instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,elements,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(elements),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),ubo.references=1,ubo},Engine.prototype.createDynamicUniformBuffer=function(elements){var ubo=this._gl.createBuffer();if(!ubo)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(ubo),elements instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,elements,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(elements),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),ubo.references=1,ubo},Engine.prototype.updateUniformBuffer=function(uniformBuffer,elements,offset,count){this.bindUniformBuffer(uniformBuffer),void 0===offset&&(offset=0),void 0===count?elements instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,offset,elements):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,offset,new Float32Array(elements)):elements instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,elements.subarray(offset,offset+count)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(elements).subarray(offset,offset+count)),this.bindUniformBuffer(null)},Engine.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},Engine.prototype.createVertexBuffer=function(vertices){var vbo=this._gl.createBuffer();if(!vbo)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(vbo),vertices instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,vertices,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(vertices),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),vbo.references=1,vbo},Engine.prototype.createDynamicVertexBuffer=function(vertices){var vbo=this._gl.createBuffer();if(!vbo)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(vbo),vertices instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,vertices,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(vertices),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),vbo.references=1,vbo},Engine.prototype.updateDynamicIndexBuffer=function(indexBuffer,indices,offset){void 0===offset&&(offset=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(indexBuffer);var arrayBuffer;arrayBuffer=indices instanceof Uint16Array||indices instanceof Uint32Array?indices:indexBuffer.is32Bits?new Uint32Array(indices):new Uint16Array(indices),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,arrayBuffer,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},Engine.prototype.updateDynamicVertexBuffer=function(vertexBuffer,vertices,offset,count){this.bindArrayBuffer(vertexBuffer),void 0===offset&&(offset=0),void 0===count?vertices instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,offset,vertices):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,offset,new Float32Array(vertices)):vertices instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,vertices.subarray(offset,offset+count)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(vertices).subarray(offset,offset+count)),this._resetVertexBufferBinding()},Engine.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},Engine.prototype.createIndexBuffer=function(indices,updatable){var vbo=this._gl.createBuffer();if(!vbo)throw new Error("Unable to create index buffer");this.bindIndexBuffer(vbo);var arrayBuffer,need32Bits=!1;if(indices instanceof Uint16Array)arrayBuffer=indices;else if(this._caps.uintIndices)if(indices instanceof Uint32Array)arrayBuffer=indices,need32Bits=!0;else{for(var index=0;index<indices.length;index++)if(indices[index]>65535){need32Bits=!0;break}arrayBuffer=need32Bits?new Uint32Array(indices):new Uint16Array(indices)}else arrayBuffer=new Uint16Array(indices);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,arrayBuffer,updatable?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),vbo.references=1,vbo.is32Bits=need32Bits,vbo},Engine.prototype.bindArrayBuffer=function(buffer){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(buffer,this._gl.ARRAY_BUFFER)},Engine.prototype.bindUniformBuffer=function(buffer){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,buffer)},Engine.prototype.bindUniformBufferBase=function(buffer,location){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,location,buffer)},Engine.prototype.bindUniformBlock=function(shaderProgram,blockName,index){var uniformLocation=this._gl.getUniformBlockIndex(shaderProgram,blockName);this._gl.uniformBlockBinding(shaderProgram,uniformLocation,index)},Engine.prototype.bindIndexBuffer=function(buffer){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(buffer,this._gl.ELEMENT_ARRAY_BUFFER)},Engine.prototype.bindBuffer=function(buffer,target){(this._vaoRecordInProgress||this._currentBoundBuffer[target]!==buffer)&&(this._gl.bindBuffer(target,buffer),this._currentBoundBuffer[target]=buffer)},Engine.prototype.updateArrayBuffer=function(data){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,data)},Engine.prototype.vertexAttribPointer=function(buffer,indx,size,type,normalized,stride,offset){var pointer=this._currentBufferPointers[indx],changed=!1;pointer.active?(pointer.buffer!==buffer&&(pointer.buffer=buffer,changed=!0),pointer.size!==size&&(pointer.size=size,changed=!0),pointer.type!==type&&(pointer.type=type,changed=!0),pointer.normalized!==normalized&&(pointer.normalized=normalized,changed=!0),pointer.stride!==stride&&(pointer.stride=stride,changed=!0),pointer.offset!==offset&&(pointer.offset=offset,changed=!0)):(changed=!0,pointer.active=!0,pointer.index=indx,pointer.size=size,pointer.type=type,pointer.normalized=normalized,pointer.stride=stride,pointer.offset=offset,pointer.buffer=buffer),(changed||this._vaoRecordInProgress)&&(this.bindArrayBuffer(buffer),this._gl.vertexAttribPointer(indx,size,type,normalized,stride,offset))},Engine.prototype._bindIndexBufferWithCache=function(indexBuffer){null!=indexBuffer&&this._cachedIndexBuffer!==indexBuffer&&(this._cachedIndexBuffer=indexBuffer,this.bindIndexBuffer(indexBuffer),this._uintIndicesCurrentlySet=indexBuffer.is32Bits)},Engine.prototype._bindVertexBuffersAttributes=function(vertexBuffers,effect){var attributes=effect.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var index=0;index<attributes.length;index++){var order=effect.getAttributeLocation(index);if(order>=0){var vertexBuffer=vertexBuffers[attributes[index]];if(!vertexBuffer)continue;this._gl.enableVertexAttribArray(order),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[order]=!0);var buffer=vertexBuffer.getBuffer();buffer&&(this.vertexAttribPointer(buffer,order,vertexBuffer.getSize(),this._gl.FLOAT,!1,4*vertexBuffer.getStrideSize(),4*vertexBuffer.getOffset()),vertexBuffer.getIsInstanced()&&(this._gl.vertexAttribDivisor(order,vertexBuffer.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(order),this._currentInstanceBuffers.push(buffer))))}}},Engine.prototype.recordVertexArrayObject=function(vertexBuffers,indexBuffer,effect){var vao=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(vao),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(vertexBuffers,effect),this.bindIndexBuffer(indexBuffer),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),vao},Engine.prototype.bindVertexArrayObject=function(vertexArrayObject,indexBuffer){this._cachedVertexArrayObject!==vertexArrayObject&&(this._cachedVertexArrayObject=vertexArrayObject,this._gl.bindVertexArray(vertexArrayObject),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=indexBuffer&&indexBuffer.is32Bits,this._mustWipeVertexAttributes=!0)},Engine.prototype.bindBuffersDirectly=function(vertexBuffer,indexBuffer,vertexDeclaration,vertexStrideSize,effect){if(this._cachedVertexBuffers!==vertexBuffer||this._cachedEffectForVertexBuffers!==effect){this._cachedVertexBuffers=vertexBuffer,this._cachedEffectForVertexBuffers=effect;var attributesCount=effect.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var offset=0,index=0;index<attributesCount;index++)if(index<vertexDeclaration.length){var order=effect.getAttributeLocation(index);order>=0&&(this._gl.enableVertexAttribArray(order),this._vertexAttribArraysEnabled[order]=!0,this.vertexAttribPointer(vertexBuffer,order,vertexDeclaration[index],this._gl.FLOAT,!1,vertexStrideSize,offset)),offset+=4*vertexDeclaration[index]}}this._bindIndexBufferWithCache(indexBuffer)},Engine.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},Engine.prototype.bindBuffers=function(vertexBuffers,indexBuffer,effect){this._cachedVertexBuffers===vertexBuffers&&this._cachedEffectForVertexBuffers===effect||(this._cachedVertexBuffers=vertexBuffers,this._cachedEffectForVertexBuffers=effect,this._bindVertexBuffersAttributes(vertexBuffers,effect)),this._bindIndexBufferWithCache(indexBuffer)},Engine.prototype.unbindInstanceAttributes=function(){for(var boundBuffer,i=0,ul=this._currentInstanceLocations.length;i<ul;i++){var instancesBuffer=this._currentInstanceBuffers[i];boundBuffer!=instancesBuffer&&instancesBuffer.references&&(boundBuffer=instancesBuffer,this.bindArrayBuffer(instancesBuffer));var offsetLocation=this._currentInstanceLocations[i];this._gl.vertexAttribDivisor(offsetLocation,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},Engine.prototype.releaseVertexArrayObject=function(vao){this._gl.deleteVertexArray(vao)},Engine.prototype._releaseBuffer=function(buffer){return buffer.references--,0===buffer.references&&(this._gl.deleteBuffer(buffer),!0)},Engine.prototype.createInstancesBuffer=function(capacity){var buffer=this._gl.createBuffer();if(!buffer)throw new Error("Unable to create instance buffer");return buffer.capacity=capacity,this.bindArrayBuffer(buffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,capacity,this._gl.DYNAMIC_DRAW),buffer},Engine.prototype.deleteInstancesBuffer=function(buffer){this._gl.deleteBuffer(buffer)},Engine.prototype.updateAndBindInstancesBuffer=function(instancesBuffer,data,offsetLocations){if(this.bindArrayBuffer(instancesBuffer),data&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,data),void 0!==offsetLocations[0].index){for(var stride=0,i=0;i<offsetLocations.length;i++)stride+=4*(ai=offsetLocations[i]).attributeSize;for(i=0;i<offsetLocations.length;i++){var ai=offsetLocations[i];this._vertexAttribArraysEnabled[ai.index]||(this._gl.enableVertexAttribArray(ai.index),this._vertexAttribArraysEnabled[ai.index]=!0),this.vertexAttribPointer(instancesBuffer,ai.index,ai.attributeSize,ai.attribyteType||this._gl.FLOAT,ai.normalized||!1,stride,ai.offset),this._gl.vertexAttribDivisor(ai.index,1),this._currentInstanceLocations.push(ai.index),this._currentInstanceBuffers.push(instancesBuffer)}}else for(var index=0;index<4;index++){var offsetLocation=offsetLocations[index];this._vertexAttribArraysEnabled[offsetLocation]||(this._gl.enableVertexAttribArray(offsetLocation),this._vertexAttribArraysEnabled[offsetLocation]=!0),this.vertexAttribPointer(instancesBuffer,offsetLocation,4,this._gl.FLOAT,!1,64,16*index),this._gl.vertexAttribDivisor(offsetLocation,1),this._currentInstanceLocations.push(offsetLocation),this._currentInstanceBuffers.push(instancesBuffer)}},Engine.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},Engine.prototype.draw=function(useTriangles,indexStart,indexCount,instancesCount){this.applyStates(),this._drawCalls.addCount(1,!1);var indexFormat=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,mult=this._uintIndicesCurrentlySet?4:2;instancesCount?this._gl.drawElementsInstanced(useTriangles?this._gl.TRIANGLES:this._gl.LINES,indexCount,indexFormat,indexStart*mult,instancesCount):this._gl.drawElements(useTriangles?this._gl.TRIANGLES:this._gl.LINES,indexCount,indexFormat,indexStart*mult)},Engine.prototype.drawPointClouds=function(verticesStart,verticesCount,instancesCount){this.applyStates(),this._drawCalls.addCount(1,!1),instancesCount?this._gl.drawArraysInstanced(this._gl.POINTS,verticesStart,verticesCount,instancesCount):this._gl.drawArrays(this._gl.POINTS,verticesStart,verticesCount)},Engine.prototype.drawUnIndexed=function(useTriangles,verticesStart,verticesCount,instancesCount){this.applyStates(),this._drawCalls.addCount(1,!1),instancesCount?this._gl.drawArraysInstanced(useTriangles?this._gl.TRIANGLES:this._gl.LINES,verticesStart,verticesCount,instancesCount):this._gl.drawArrays(useTriangles?this._gl.TRIANGLES:this._gl.LINES,verticesStart,verticesCount)},Engine.prototype._releaseEffect=function(effect){this._compiledEffects[effect._key]&&(delete this._compiledEffects[effect._key],this._deleteProgram(effect.getProgram()))},Engine.prototype._deleteProgram=function(program){program&&(program.__SPECTOR_rebuildProgram=null,program.transformFeedback&&(this.deleteTransformFeedback(program.transformFeedback),program.transformFeedback=null),this._gl.deleteProgram(program))},Engine.prototype.createEffect=function(baseName,attributesNamesOrOptions,uniformsNamesOrEngine,samplers,defines,fallbacks,onCompiled,onError,indexParameters){var name=(baseName.vertexElement||baseName.vertex||baseName)+"+"+(baseName.fragmentElement||baseName.fragment||baseName)+"@"+(defines||attributesNamesOrOptions.defines);if(this._compiledEffects[name]){var compiledEffect=this._compiledEffects[name];return onCompiled&&compiledEffect.isReady()&&onCompiled(compiledEffect),compiledEffect}var effect=new BABYLON.Effect(baseName,attributesNamesOrOptions,uniformsNamesOrEngine,samplers,this,defines,fallbacks,onCompiled,onError,indexParameters);return effect._key=name,this._compiledEffects[name]=effect,effect},Engine.prototype.createEffectForParticles=function(fragmentName,uniformsNames,samplers,defines,fallbacks,onCompiled,onError){return void 0===uniformsNames&&(uniformsNames=[]),void 0===samplers&&(samplers=[]),void 0===defines&&(defines=""),this.createEffect({vertex:"particles",fragmentElement:fragmentName},["position","color","options"],["view","projection"].concat(uniformsNames),["diffuseSampler"].concat(samplers),defines,fallbacks,onCompiled,onError)},Engine.prototype.createRawShaderProgram=function(vertexCode,fragmentCode,context,transformFeedbackVaryings){void 0===transformFeedbackVaryings&&(transformFeedbackVaryings=null),context=context||this._gl;var vertexShader=compileRawShader(context,vertexCode,"vertex"),fragmentShader=compileRawShader(context,fragmentCode,"fragment");return this._createShaderProgram(vertexShader,fragmentShader,context,transformFeedbackVaryings)},Engine.prototype.createShaderProgram=function(vertexCode,fragmentCode,defines,context,transformFeedbackVaryings){void 0===transformFeedbackVaryings&&(transformFeedbackVaryings=null),context=context||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var shaderVersion=this._webGLVersion>1?"#version 300 es\n":"",vertexShader=compileShader(context,vertexCode,"vertex",defines,shaderVersion),fragmentShader=compileShader(context,fragmentCode,"fragment",defines,shaderVersion),program=this._createShaderProgram(vertexShader,fragmentShader,context,transformFeedbackVaryings);return this.onAfterShaderCompilationObservable.notifyObservers(this),program},Engine.prototype._createShaderProgram=function(vertexShader,fragmentShader,context,transformFeedbackVaryings){void 0===transformFeedbackVaryings&&(transformFeedbackVaryings=null);var shaderProgram=context.createProgram();if(!shaderProgram)throw new Error("Unable to create program");if(context.attachShader(shaderProgram,vertexShader),context.attachShader(shaderProgram,fragmentShader),this.webGLVersion>1&&transformFeedbackVaryings){var transformFeedback=this.createTransformFeedback();this.bindTransformFeedback(transformFeedback),this.setTranformFeedbackVaryings(shaderProgram,transformFeedbackVaryings),shaderProgram.transformFeedback=transformFeedback}if(context.linkProgram(shaderProgram),this.webGLVersion>1&&transformFeedbackVaryings&&this.bindTransformFeedback(null),!context.getProgramParameter(shaderProgram,context.LINK_STATUS)){context.validateProgram(shaderProgram);var error=context.getProgramInfoLog(shaderProgram);if(error)throw new Error(error)}return context.deleteShader(vertexShader),context.deleteShader(fragmentShader),shaderProgram},Engine.prototype.getUniforms=function(shaderProgram,uniformsNames){for(var results=new Array,index=0;index<uniformsNames.length;index++)results.push(this._gl.getUniformLocation(shaderProgram,uniformsNames[index]));return results},Engine.prototype.getAttributes=function(shaderProgram,attributesNames){for(var results=[],index=0;index<attributesNames.length;index++)try{results.push(this._gl.getAttribLocation(shaderProgram,attributesNames[index]))}catch(e){results.push(-1)}return results},Engine.prototype.enableEffect=function(effect){effect&&(this.setProgram(effect.getProgram()),this._currentEffect=effect,effect.onBind&&effect.onBind(effect),effect.onBindObservable.notifyObservers(effect))},Engine.prototype.setIntArray=function(uniform,array){uniform&&this._gl.uniform1iv(uniform,array)},Engine.prototype.setIntArray2=function(uniform,array){uniform&&array.length%2==0&&this._gl.uniform2iv(uniform,array)},Engine.prototype.setIntArray3=function(uniform,array){uniform&&array.length%3==0&&this._gl.uniform3iv(uniform,array)},Engine.prototype.setIntArray4=function(uniform,array){uniform&&array.length%4==0&&this._gl.uniform4iv(uniform,array)},Engine.prototype.setFloatArray=function(uniform,array){uniform&&this._gl.uniform1fv(uniform,array)},Engine.prototype.setFloatArray2=function(uniform,array){uniform&&array.length%2==0&&this._gl.uniform2fv(uniform,array)},Engine.prototype.setFloatArray3=function(uniform,array){uniform&&array.length%3==0&&this._gl.uniform3fv(uniform,array)},Engine.prototype.setFloatArray4=function(uniform,array){uniform&&array.length%4==0&&this._gl.uniform4fv(uniform,array)},Engine.prototype.setArray=function(uniform,array){uniform&&this._gl.uniform1fv(uniform,array)},Engine.prototype.setArray2=function(uniform,array){uniform&&array.length%2==0&&this._gl.uniform2fv(uniform,array)},Engine.prototype.setArray3=function(uniform,array){uniform&&array.length%3==0&&this._gl.uniform3fv(uniform,array)},Engine.prototype.setArray4=function(uniform,array){uniform&&array.length%4==0&&this._gl.uniform4fv(uniform,array)},Engine.prototype.setMatrices=function(uniform,matrices){uniform&&this._gl.uniformMatrix4fv(uniform,!1,matrices)},Engine.prototype.setMatrix=function(uniform,matrix){uniform&&this._gl.uniformMatrix4fv(uniform,!1,matrix.toArray())},Engine.prototype.setMatrix3x3=function(uniform,matrix){uniform&&this._gl.uniformMatrix3fv(uniform,!1,matrix)},Engine.prototype.setMatrix2x2=function(uniform,matrix){uniform&&this._gl.uniformMatrix2fv(uniform,!1,matrix)},Engine.prototype.setFloat=function(uniform,value){uniform&&this._gl.uniform1f(uniform,value)},Engine.prototype.setFloat2=function(uniform,x,y){uniform&&this._gl.uniform2f(uniform,x,y)},Engine.prototype.setFloat3=function(uniform,x,y,z){uniform&&this._gl.uniform3f(uniform,x,y,z)},Engine.prototype.setBool=function(uniform,bool){uniform&&this._gl.uniform1i(uniform,bool)},Engine.prototype.setFloat4=function(uniform,x,y,z,w){uniform&&this._gl.uniform4f(uniform,x,y,z,w)},Engine.prototype.setColor3=function(uniform,color3){uniform&&this._gl.uniform3f(uniform,color3.r,color3.g,color3.b)},Engine.prototype.setColor4=function(uniform,color3,alpha){uniform&&this._gl.uniform4f(uniform,color3.r,color3.g,color3.b,alpha)},Engine.prototype.setState=function(culling,zOffset,force,reverseSide){void 0===zOffset&&(zOffset=0),void 0===reverseSide&&(reverseSide=!1);var showSide=reverseSide?this._gl.FRONT:this._gl.BACK,hideSide=reverseSide?this._gl.BACK:this._gl.FRONT,cullFace=this.cullBackFaces?showSide:hideSide;(this._depthCullingState.cull!==culling||force||this._depthCullingState.cullFace!==cullFace)&&(culling?(this._depthCullingState.cullFace=cullFace,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this.setZOffset(zOffset)},Engine.prototype.setZOffset=function(value){this._depthCullingState.zOffset=value},Engine.prototype.getZOffset=function(){return this._depthCullingState.zOffset},Engine.prototype.setDepthBuffer=function(enable){this._depthCullingState.depthTest=enable},Engine.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},Engine.prototype.setDepthWrite=function(enable){this._depthCullingState.depthMask=enable},Engine.prototype.setColorWrite=function(enable){this._gl.colorMask(enable,enable,enable,enable),this._colorWrite=enable},Engine.prototype.getColorWrite=function(){return this._colorWrite},Engine.prototype.setAlphaConstants=function(r,g,b,a){this._alphaState.setAlphaBlendConstants(r,g,b,a)},Engine.prototype.setAlphaMode=function(mode,noDepthWriteChange){if(void 0===noDepthWriteChange&&(noDepthWriteChange=!1),this._alphaMode!==mode){switch(mode){case Engine.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case Engine.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case Engine.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}noDepthWriteChange||this.setDepthWrite(mode===Engine.ALPHA_DISABLE),this._alphaMode=mode}},Engine.prototype.getAlphaMode=function(){return this._alphaMode},Engine.prototype.setAlphaTesting=function(enable){this._alphaTest=enable},Engine.prototype.getAlphaTesting=function(){return!!this._alphaTest},Engine.prototype.wipeCaches=function(bruteForce){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,bruteForce&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null),this.bindArrayBuffer(null))},Engine.prototype.setTextureFormatToUse=function(formatsAvailable){for(var i=0,len1=this.texturesSupported.length;i<len1;i++)for(var j=0,len2=formatsAvailable.length;j<len2;j++)if(this._texturesSupported[i]===formatsAvailable[j].toLowerCase())return this._textureFormatInUse=this._texturesSupported[i];return this._textureFormatInUse=null,null},Engine.prototype._createTexture=function(){var texture=this._gl.createTexture();if(!texture)throw new Error("Unable to create texture");return texture},Engine.prototype.createTexture=function(urlArg,noMipmap,invertY,scene,samplingMode,onLoad,onError,buffer,fallBack,format){var _this=this;void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===buffer&&(buffer=null),void 0===fallBack&&(fallBack=null),void 0===format&&(format=null);var url=String(urlArg),fromData="data:"===url.substr(0,5),fromBlob="blob:"===url.substr(0,5),isBase64=fromData&&-1!==url.indexOf("base64"),texture=fallBack||new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_URL),lastDot=url.lastIndexOf("."),extension=lastDot>0?url.substring(lastDot).toLowerCase():"",isDDS=this.getCaps().s3tc&&".dds"===extension,isTGA=".tga"===extension,isKTX=!1;!this._textureFormatInUse||isBase64||fallBack||(url=url.substring(0,lastDot)+this._textureFormatInUse,isKTX=!0),scene&&scene._addPendingData(texture),texture.url=url,texture.generateMipMaps=!noMipmap,texture.samplingMode=samplingMode,texture.invertY=invertY,this._doNotHandleContextLost||(texture._buffer=buffer);var onLoadObserver=null;onLoad&&!fallBack&&(onLoadObserver=texture.onLoadedObservable.add(onLoad)),fallBack||this._internalTexturesCache.push(texture);var onerror=function(message,exception){scene&&scene._removePendingData(texture),onLoadObserver&&texture.onLoadedObservable.remove(onLoadObserver),isKTX?_this.createTexture(urlArg,noMipmap,invertY,scene,samplingMode,null,onError,buffer,texture):BABYLON.Tools.UseFallbackTexture&&_this.createTexture(BABYLON.Tools.fallbackTexture,noMipmap,invertY,scene,samplingMode,null,onError,buffer,texture),onError&&onError(message||"Unknown error",exception)},callback=null;if(isKTX||isTGA||isDDS)isKTX?callback=function(data){var ktx=new BABYLON.Internals.KhronosTextureContainer(data,1);_this._prepareWebGLTexture(texture,scene,ktx.pixelWidth,ktx.pixelHeight,invertY,!1,!0,function(){return ktx.uploadLevels(_this._gl,!noMipmap),!1},samplingMode)}:isTGA?callback=function(arrayBuffer){var data=new Uint8Array(arrayBuffer),header=BABYLON.Internals.TGATools.GetTGAHeader(data);_this._prepareWebGLTexture(texture,scene,header.width,header.height,invertY,noMipmap,!1,function(){return BABYLON.Internals.TGATools.UploadContent(_this._gl,data),!1},samplingMode)}:isDDS&&(callback=function(data){var info=BABYLON.Internals.DDSTools.GetDDSInfo(data),loadMipmap=(info.isRGB||info.isLuminance||info.mipmapCount>1)&&!noMipmap&&info.width>>info.mipmapCount-1==1;_this._prepareWebGLTexture(texture,scene,info.width,info.height,invertY,!loadMipmap,info.isFourCC,function(){return BABYLON.Internals.DDSTools.UploadDDSLevels(_this,_this._gl,data,info,loadMipmap,1),!1},samplingMode)}),buffer?callback&&callback(buffer):BABYLON.Tools.LoadFile(url,function(data){callback&&callback(data)},void 0,scene?scene.database:void 0,!0,function(request,exception){onerror("Unable to load "+(request&&request.responseURL,exception))});else{var onload=function(img){fromBlob&&!_this._doNotHandleContextLost&&(texture._buffer=img),_this._prepareWebGLTexture(texture,scene,img.width,img.height,invertY,noMipmap,!1,function(potWidth,potHeight,continuationCallback){var gl=_this._gl,isPot=img.width===potWidth&&img.height===potHeight,internalFormat=format?_this._getInternalFormat(format):".jpg"===extension?gl.RGB:gl.RGBA;if(isPot)return gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,internalFormat,gl.UNSIGNED_BYTE,img),!1;var source=new BABYLON.InternalTexture(_this,BABYLON.InternalTexture.DATASOURCE_TEMP);return _this._bindTextureDirectly(gl.TEXTURE_2D,source),gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,internalFormat,gl.UNSIGNED_BYTE,img),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),_this._rescaleTexture(source,texture,scene,internalFormat,function(){_this._releaseTexture(source),_this._bindTextureDirectly(gl.TEXTURE_2D,texture),continuationCallback()}),!0},samplingMode)};!fromData||isBase64?buffer instanceof HTMLImageElement?onload(buffer):BABYLON.Tools.LoadImage(url,onload,onerror,scene?scene.database:null):buffer instanceof Array||"string"==typeof buffer||buffer instanceof ArrayBuffer?BABYLON.Tools.LoadImage(buffer,onload,onerror,scene?scene.database:null):onload(buffer)}return texture},Engine.prototype._rescaleTexture=function(source,destination,scene,internalFormat,onComplete){var _this=this,rtt=this.createRenderTargetTexture({width:destination.width,height:destination.height},{generateMipMaps:!1,type:Engine.TEXTURETYPE_UNSIGNED_INT,samplingMode:BABYLON.Texture.BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});this._rescalePostProcess||(this._rescalePostProcess=new BABYLON.PassPostProcess("rescale",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this,!1,Engine.TEXTURETYPE_UNSIGNED_INT)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){_this._rescalePostProcess.onApply=function(effect){effect._bindTexture("textureSampler",source)};var hostingScene=scene;hostingScene||(hostingScene=_this.scenes[_this.scenes.length-1]),hostingScene.postProcessManager.directRender([_this._rescalePostProcess],rtt,!0),_this._bindTextureDirectly(_this._gl.TEXTURE_2D,destination),_this._gl.copyTexImage2D(_this._gl.TEXTURE_2D,0,internalFormat,0,0,destination.width,destination.height,0),_this.unBindFramebuffer(rtt),_this._releaseTexture(rtt),onComplete&&onComplete()})},Engine.prototype._getInternalFormat=function(format){var internalFormat=this._gl.RGBA;switch(format){case Engine.TEXTUREFORMAT_ALPHA:internalFormat=this._gl.ALPHA;break;case Engine.TEXTUREFORMAT_LUMINANCE:internalFormat=this._gl.LUMINANCE;break;case Engine.TEXTUREFORMAT_LUMINANCE_ALPHA:internalFormat=this._gl.LUMINANCE_ALPHA;break;case Engine.TEXTUREFORMAT_RGB:internalFormat=this._gl.RGB;break;case Engine.TEXTUREFORMAT_RGBA:internalFormat=this._gl.RGBA}return internalFormat},Engine.prototype.updateRawTexture=function(texture,data,format,invertY,compression,type){if(void 0===compression&&(compression=null),void 0===type&&(type=Engine.TEXTURETYPE_UNSIGNED_INT),texture){var internalFormat=this._getInternalFormat(format),internalSizedFomat=this._getRGBABufferInternalSizedFormat(type),textureType=this._getWebGLTextureType(type);this._bindTextureDirectly(this._gl.TEXTURE_2D,texture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===invertY?1:invertY?1:0),this._doNotHandleContextLost||(texture._bufferView=data,texture.format=format,texture.type=type,texture.invertY=invertY,texture._compression=compression),texture.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),compression&&data?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[compression],texture.width,texture.height,0,data):this._gl.texImage2D(this._gl.TEXTURE_2D,0,internalSizedFomat,texture.width,texture.height,0,internalFormat,textureType,data),texture.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this.resetTextureCache(),texture.isReady=!0}},Engine.prototype.createRawTexture=function(data,width,height,format,generateMipMaps,invertY,samplingMode,compression,type){void 0===compression&&(compression=null),void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_RAW);texture.baseWidth=width,texture.baseHeight=height,texture.width=width,texture.height=height,texture.format=format,texture.generateMipMaps=generateMipMaps,texture.samplingMode=samplingMode,texture.invertY=invertY,texture._compression=compression,texture.type=type,this._doNotHandleContextLost||(texture._bufferView=data),this.updateRawTexture(texture,data,format,invertY,compression,type),this._bindTextureDirectly(this._gl.TEXTURE_2D,texture);var filters=getSamplingParameters(samplingMode,generateMipMaps,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,filters.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,filters.min),generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(texture),texture},Engine.prototype.createDynamicTexture=function(width,height,generateMipMaps,samplingMode){var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_DYNAMIC);return texture.baseWidth=width,texture.baseHeight=height,generateMipMaps&&(width=this.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(width,this._caps.maxTextureSize):width,height=this.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(height,this._caps.maxTextureSize):height),this.resetTextureCache(),texture.width=width,texture.height=height,texture.isReady=!1,texture.generateMipMaps=generateMipMaps,texture.samplingMode=samplingMode,this.updateTextureSamplingMode(samplingMode,texture),this._internalTexturesCache.push(texture),texture},Engine.prototype.updateTextureSamplingMode=function(samplingMode,texture){var filters=getSamplingParameters(samplingMode,texture.generateMipMaps,this._gl);texture.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,texture),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,filters.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,filters.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):texture.is3D?(this._bindTextureDirectly(this._gl.TEXTURE_3D,texture),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,filters.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,filters.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,texture),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,filters.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,filters.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),texture.samplingMode=samplingMode},Engine.prototype.updateDynamicTexture=function(texture,canvas,invertY,premulAlpha,format){if(void 0===premulAlpha&&(premulAlpha=!1),texture){this._bindTextureDirectly(this._gl.TEXTURE_2D,texture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,invertY?1:0),premulAlpha&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var internalFormat=format?this._getInternalFormat(format):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,internalFormat,internalFormat,this._gl.UNSIGNED_BYTE,canvas),texture.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),premulAlpha&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.resetTextureCache(),texture.isReady=!0}},Engine.prototype.updateVideoTexture=function(texture,video,invertY){if(texture&&!texture._isDisabled){this._bindTextureDirectly(this._gl.TEXTURE_2D,texture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,invertY?0:1);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,video),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,video);else{if(!texture._workingCanvas){texture._workingCanvas=document.createElement("canvas");var context=texture._workingCanvas.getContext("2d");if(!context)throw new Error("Unable to get 2d context");texture._workingContext=context,texture._workingCanvas.width=texture.width,texture._workingCanvas.height=texture.height}texture._workingContext.drawImage(video,0,0,video.videoWidth,video.videoHeight,0,0,texture.width,texture.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,texture._workingCanvas)}texture.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this.resetTextureCache(),texture.isReady=!0}catch(ex){texture._isDisabled=!0}}},Engine.prototype.createRenderTargetTexture=function(size,options){var fullOptions=new RenderTargetCreationOptions;void 0!==options&&"object"==typeof options?(fullOptions.generateMipMaps=options.generateMipMaps,fullOptions.generateDepthBuffer=void 0===options.generateDepthBuffer||options.generateDepthBuffer,fullOptions.generateStencilBuffer=fullOptions.generateDepthBuffer&&options.generateStencilBuffer,fullOptions.type=void 0===options.type?Engine.TEXTURETYPE_UNSIGNED_INT:options.type,fullOptions.samplingMode=void 0===options.samplingMode?BABYLON.Texture.TRILINEAR_SAMPLINGMODE:options.samplingMode):(fullOptions.generateMipMaps=options,fullOptions.generateDepthBuffer=!0,fullOptions.generateStencilBuffer=!1,fullOptions.type=Engine.TEXTURETYPE_UNSIGNED_INT,fullOptions.samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),fullOptions.type!==Engine.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering?fullOptions.type!==Engine.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering||(fullOptions.samplingMode=BABYLON.Texture.NEAREST_SAMPLINGMODE):fullOptions.samplingMode=BABYLON.Texture.NEAREST_SAMPLINGMODE;var gl=this._gl,texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(gl.TEXTURE_2D,texture);var width=size.width||size,height=size.height||size,filters=getSamplingParameters(fullOptions.samplingMode,!!fullOptions.generateMipMaps,gl);fullOptions.type!==Engine.TEXTURETYPE_FLOAT||this._caps.textureFloat||(fullOptions.type=Engine.TEXTURETYPE_UNSIGNED_INT,BABYLON.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filters.mag),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filters.min),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(fullOptions.type),width,height,0,gl.RGBA,this._getWebGLTextureType(fullOptions.type),null);var framebuffer=gl.createFramebuffer();return this.bindUnboundFramebuffer(framebuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture._webGLTexture,0),texture._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!fullOptions.generateStencilBuffer,fullOptions.generateDepthBuffer,width,height),fullOptions.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),texture._framebuffer=framebuffer,texture.baseWidth=width,texture.baseHeight=height,texture.width=width,texture.height=height,texture.isReady=!0,texture.samples=1,texture.generateMipMaps=!!fullOptions.generateMipMaps,texture.samplingMode=fullOptions.samplingMode,texture.type=fullOptions.type,texture._generateDepthBuffer=fullOptions.generateDepthBuffer,texture._generateStencilBuffer=!!fullOptions.generateStencilBuffer,this.resetTextureCache(),this._internalTexturesCache.push(texture),texture},Engine.prototype.createMultipleRenderTarget=function(size,options){var generateMipMaps=!1,generateDepthBuffer=!0,generateStencilBuffer=!1,generateDepthTexture=!1,textureCount=1,defaultType=Engine.TEXTURETYPE_UNSIGNED_INT,defaultSamplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE,types=[],samplingModes=[];void 0!==options&&(generateMipMaps=options.generateMipMaps,generateDepthBuffer=void 0===options.generateDepthBuffer||options.generateDepthBuffer,generateStencilBuffer=options.generateStencilBuffer,generateDepthTexture=options.generateDepthTexture,textureCount=options.textureCount||1,options.types&&(types=options.types),options.samplingModes&&(samplingModes=options.samplingModes));var gl=this._gl,framebuffer=gl.createFramebuffer();this.bindUnboundFramebuffer(framebuffer);for(var width=size.width||size,height=size.height||size,textures=[],attachments=[],depthStencilBuffer=this._setupFramebufferDepthAttachments(generateStencilBuffer,generateDepthBuffer,width,height),i=0;i<textureCount;i++){var samplingMode=samplingModes[i]||defaultSamplingMode,type=types[i]||defaultType;type!==Engine.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering?type!==Engine.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering||(samplingMode=BABYLON.Texture.NEAREST_SAMPLINGMODE):samplingMode=BABYLON.Texture.NEAREST_SAMPLINGMODE;var filters=getSamplingParameters(samplingMode,generateMipMaps,gl);type!==Engine.TEXTURETYPE_FLOAT||this._caps.textureFloat||(type=Engine.TEXTURETYPE_UNSIGNED_INT,BABYLON.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_MULTIRENDERTARGET),attachment=gl[this.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"];textures.push(texture),attachments.push(attachment),gl.activeTexture(gl["TEXTURE"+i]),gl.bindTexture(gl.TEXTURE_2D,texture._webGLTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filters.mag),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filters.min),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(type),width,height,0,gl.RGBA,this._getWebGLTextureType(type),null),gl.framebufferTexture2D(gl.DRAW_FRAMEBUFFER,attachment,gl.TEXTURE_2D,texture._webGLTexture,0),generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(gl.TEXTURE_2D,null),texture._framebuffer=framebuffer,texture._depthStencilBuffer=depthStencilBuffer,texture.baseWidth=width,texture.baseHeight=height,texture.width=width,texture.height=height,texture.isReady=!0,texture.samples=1,texture.generateMipMaps=generateMipMaps,texture.samplingMode=samplingMode,texture.type=type,texture._generateDepthBuffer=generateDepthBuffer,texture._generateStencilBuffer=generateStencilBuffer,this._internalTexturesCache.push(texture)}if(generateDepthTexture&&this._caps.depthTextureExtension){var depthTexture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_MULTIRENDERTARGET);gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,depthTexture._webGLTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,this.webGLVersion<2?gl.DEPTH_COMPONENT:gl.DEPTH_COMPONENT16,width,height,0,gl.DEPTH_COMPONENT,gl.UNSIGNED_SHORT,null),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._webGLTexture,0),depthTexture._framebuffer=framebuffer,depthTexture.baseWidth=width,depthTexture.baseHeight=height,depthTexture.width=width,depthTexture.height=height,depthTexture.isReady=!0,depthTexture.samples=1,depthTexture.generateMipMaps=generateMipMaps,depthTexture.samplingMode=gl.NEAREST,depthTexture._generateDepthBuffer=generateDepthBuffer,depthTexture._generateStencilBuffer=generateStencilBuffer,textures.push(depthTexture),this._internalTexturesCache.push(depthTexture)}return gl.drawBuffers(attachments),gl.bindRenderbuffer(gl.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),textures},Engine.prototype._setupFramebufferDepthAttachments=function(generateStencilBuffer,generateDepthBuffer,width,height,samples){void 0===samples&&(samples=1);var depthStencilBuffer=null,gl=this._gl;return generateStencilBuffer?(depthStencilBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,depthStencilBuffer),samples>1?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,samples,gl.DEPTH24_STENCIL8,width,height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,depthStencilBuffer)):generateDepthBuffer&&(depthStencilBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,depthStencilBuffer),samples>1?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,samples,gl.DEPTH_COMPONENT16,width,height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,width,height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthStencilBuffer)),depthStencilBuffer},Engine.prototype.updateRenderTargetTextureSampleCount=function(texture,samples){if(this.webGLVersion<2||!texture)return 1;if(texture.samples===samples)return samples;var gl=this._gl;if(samples=Math.min(samples,gl.getParameter(gl.MAX_SAMPLES)),texture._depthStencilBuffer&&gl.deleteRenderbuffer(texture._depthStencilBuffer),texture._MSAAFramebuffer&&gl.deleteFramebuffer(texture._MSAAFramebuffer),texture._MSAARenderBuffer&&gl.deleteRenderbuffer(texture._MSAARenderBuffer),samples>1){var framebuffer=gl.createFramebuffer();if(!framebuffer)throw new Error("Unable to create multi sampled framebuffer");texture._MSAAFramebuffer=framebuffer,this.bindUnboundFramebuffer(texture._MSAAFramebuffer);var colorRenderbuffer=gl.createRenderbuffer();if(!colorRenderbuffer)throw new Error("Unable to create multi sampled framebuffer");gl.bindRenderbuffer(gl.RENDERBUFFER,colorRenderbuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,samples,gl.RGBA8,texture.width,texture.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,colorRenderbuffer),texture._MSAARenderBuffer=colorRenderbuffer}else this.bindUnboundFramebuffer(texture._framebuffer);return texture.samples=samples,texture._depthStencilBuffer=this._setupFramebufferDepthAttachments(texture._generateStencilBuffer,texture._generateDepthBuffer,texture.width,texture.height,samples),gl.bindRenderbuffer(gl.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),samples},Engine.prototype._uploadDataToTexture=function(target,lod,internalFormat,width,height,format,type,data){this._gl.texImage2D(target,lod,internalFormat,width,height,0,format,type,data)},Engine.prototype._uploadCompressedDataToTexture=function(target,lod,internalFormat,width,height,data){this._gl.compressedTexImage2D(target,lod,internalFormat,width,height,0,data)},Engine.prototype.createRenderTargetCubeTexture=function(size,options){var gl=this._gl,texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_RENDERTARGET),generateMipMaps=!0,generateDepthBuffer=!0,generateStencilBuffer=!1,samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE;void 0!==options&&(generateMipMaps=void 0===options.generateMipMaps||options.generateMipMaps,generateStencilBuffer=!(!(generateDepthBuffer=void 0===options.generateDepthBuffer||options.generateDepthBuffer)||!options.generateStencilBuffer),void 0!==options.samplingMode&&(samplingMode=options.samplingMode)),texture.isCube=!0,texture.generateMipMaps=generateMipMaps,texture.samples=1,texture.samplingMode=samplingMode;var filters=getSamplingParameters(samplingMode,generateMipMaps,gl);this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture);for(var face=0;face<6;face++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+face,0,gl.RGBA,size,size,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,filters.mag),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,filters.min),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);var framebuffer=gl.createFramebuffer();return this.bindUnboundFramebuffer(framebuffer),texture._depthStencilBuffer=this._setupFramebufferDepthAttachments(generateStencilBuffer,generateDepthBuffer,size,size),texture.generateMipMaps&&(this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.generateMipmap(gl.TEXTURE_CUBE_MAP)),this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),texture._framebuffer=framebuffer,texture.width=size,texture.height=size,texture.isReady=!0,this.resetTextureCache(),this._internalTexturesCache.push(texture),texture},Engine.prototype.createPrefilteredCubeTexture=function(rootUrl,scene,scale,offset,onLoad,onError,format,forcedExtension){var _this=this;void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===forcedExtension&&(forcedExtension=null);return this.createCubeTexture(rootUrl,scene,null,!1,function(loadData){if(loadData){var texture=loadData.texture;if(texture._dataSource=BABYLON.InternalTexture.DATASOURCE_CUBEPREFILTERED,texture._lodGenerationScale=scale,texture._lodGenerationOffset=offset,_this._caps.textureLOD)onLoad&&onLoad(texture);else{var gl=_this._gl,width=loadData.width;if(width){for(var textures=[],i=0;i<3;i++){var roughness=1-i/2,minLODIndex=offset,maxLODIndex=BABYLON.Scalar.Log2(width)*scale+offset,lodIndex=minLODIndex+(maxLODIndex-minLODIndex)*roughness,mipmapIndex=Math.round(Math.min(Math.max(lodIndex,0),maxLODIndex)),glTextureFromLod=new BABYLON.InternalTexture(_this,BABYLON.InternalTexture.DATASOURCE_TEMP);if(glTextureFromLod.isCube=!0,_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,glTextureFromLod),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),loadData.isDDS){var info=loadData.info,data=loadData.data;gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,info.isCompressed?1:0),BABYLON.Internals.DDSTools.UploadDDSLevels(_this,_this._gl,data,info,!0,6,mipmapIndex)}else BABYLON.Tools.Warn("DDS is the only prefiltered cube map supported so far.");_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);var lodTexture=new BABYLON.BaseTexture(scene);lodTexture.isCube=!0,lodTexture._texture=glTextureFromLod,glTextureFromLod.isReady=!0,textures.push(lodTexture)}texture._lodTextureHigh=textures[2],texture._lodTextureMid=textures[1],texture._lodTextureLow=textures[0],onLoad&&onLoad(texture)}}}else onLoad&&onLoad(null)},onError,format,forcedExtension)},Engine.prototype.createCubeTexture=function(rootUrl,scene,files,noMipmap,onLoad,onError,format,forcedExtension){var _this=this;void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===forcedExtension&&(forcedExtension=null);var gl=this._gl,texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_CUBE);texture.isCube=!0,texture.url=rootUrl,texture.generateMipMaps=!noMipmap,this._doNotHandleContextLost||(texture._extension=forcedExtension,texture._files=files);var isKTX=!1,isDDS=!1,lastDot=rootUrl.lastIndexOf("."),extension=forcedExtension||(lastDot>-1?rootUrl.substring(lastDot).toLowerCase():"");this._textureFormatInUse?(extension=this._textureFormatInUse,rootUrl=(lastDot>-1?rootUrl.substring(0,lastDot):rootUrl)+this._textureFormatInUse,isKTX=!0):isDDS=".dds"===extension;var onerror=function(request,exception){onError&&request&&onError(request.status+" "+request.statusText,exception)};if(isKTX)BABYLON.Tools.LoadFile(rootUrl,function(data){var ktx=new BABYLON.Internals.KhronosTextureContainer(data,6),loadMipmap=ktx.numberOfMipmapLevels>1&&!noMipmap;_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1),ktx.uploadLevels(_this._gl,!noMipmap),_this.setCubeMapTextureParams(gl,loadMipmap),texture.width=ktx.pixelWidth,texture.height=ktx.pixelHeight,texture.isReady=!0},void 0,void 0,!0,onerror);else if(isDDS)files&&6===files.length?cascadeLoadFiles(0,0,function(imgs){for(var info,loadMipmap=!1,width=0,index=0;index<imgs.length;index++){var data=imgs[index];loadMipmap=((info=BABYLON.Internals.DDSTools.GetDDSInfo(data)).isRGB||info.isLuminance||info.mipmapCount>1)&&!noMipmap,_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,info.isCompressed?1:0),BABYLON.Internals.DDSTools.UploadDDSLevels(_this,_this._gl,data,info,loadMipmap,6,-1,index),noMipmap||info.isFourCC||1!==info.mipmapCount||gl.generateMipmap(gl.TEXTURE_CUBE_MAP),texture.width=info.width,texture.height=info.height,texture.type=info.textureType,width=info.width}_this.setCubeMapTextureParams(gl,loadMipmap),texture.isReady=!0,onLoad&&onLoad({isDDS:!0,width:width,info:info,imgs:imgs,texture:texture})},files,onError):BABYLON.Tools.LoadFile(rootUrl,function(data){var info=BABYLON.Internals.DDSTools.GetDDSInfo(data),loadMipmap=(info.isRGB||info.isLuminance||info.mipmapCount>1)&&!noMipmap;_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,info.isCompressed?1:0),BABYLON.Internals.DDSTools.UploadDDSLevels(_this,_this._gl,data,info,loadMipmap,6),noMipmap||info.isFourCC||1!==info.mipmapCount||gl.generateMipmap(gl.TEXTURE_CUBE_MAP),_this.setCubeMapTextureParams(gl,loadMipmap),texture.width=info.width,texture.height=info.height,texture.isReady=!0,texture.type=info.textureType,onLoad&&onLoad({isDDS:!0,width:info.width,info:info,data:data,texture:texture})},void 0,void 0,!0,onerror);else{if(!files)throw new Error("Cannot load cubemap because files were not defined");cascadeLoadImgs(0,scene,function(imgs){var width=_this.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(imgs[0].width,_this._caps.maxCubemapTextureSize):imgs[0].width,height=width;if(_this._prepareWorkingCanvas(),_this._workingCanvas&&_this._workingContext){_this._workingCanvas.width=width,_this._workingCanvas.height=height;var faces=[gl.TEXTURE_CUBE_MAP_POSITIVE_X,gl.TEXTURE_CUBE_MAP_POSITIVE_Y,gl.TEXTURE_CUBE_MAP_POSITIVE_Z,gl.TEXTURE_CUBE_MAP_NEGATIVE_X,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0);for(var internalFormat=format?_this._getInternalFormat(format):_this._gl.RGBA,index=0;index<faces.length;index++)_this._workingContext.drawImage(imgs[index],0,0,imgs[index].width,imgs[index].height,0,0,width,height),gl.texImage2D(faces[index],0,internalFormat,internalFormat,gl.UNSIGNED_BYTE,_this._workingCanvas);noMipmap||gl.generateMipmap(gl.TEXTURE_CUBE_MAP),_this.setCubeMapTextureParams(gl,!noMipmap),texture.width=width,texture.height=height,texture.isReady=!0,format&&(texture.format=format),texture.onLoadedObservable.notifyObservers(texture),texture.onLoadedObservable.clear(),onLoad&&onLoad()}},files,onError)}return this._internalTexturesCache.push(texture),texture},Engine.prototype.setCubeMapTextureParams=function(gl,loadMipmap){gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,loadMipmap?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null),this.resetTextureCache()},Engine.prototype.updateRawCubeTexture=function(texture,data,format,type,invertY,compression,level){void 0===compression&&(compression=null),void 0===level&&(level=0),texture._bufferViewArray=data,texture.format=format,texture.type=type,texture.invertY=invertY,texture._compression=compression;var gl=this._gl,textureType=this._getWebGLTextureType(type),internalFormat=this._getInternalFormat(format),internalSizedFomat=this._getRGBABufferInternalSizedFormat(type),needConversion=!1;internalFormat===gl.RGB&&(internalFormat=gl.RGBA,needConversion=!0),this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,void 0===invertY?1:invertY?1:0),texture.width%4!=0&&gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);for(var faceIndex=0;faceIndex<6;faceIndex++){var faceData=data[faceIndex];compression?gl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,this.getCaps().s3tc[compression],texture.width,texture.height,0,faceData):(needConversion&&(faceData=this._convertRGBtoRGBATextureData(faceData,texture.width,texture.height,type)),gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,internalSizedFomat,texture.width,texture.height,0,internalFormat,textureType,faceData))}(!this.needPOTTextures||BABYLON.Tools.IsExponentOfTwo(texture.width)&&BABYLON.Tools.IsExponentOfTwo(texture.height))&&texture.generateMipMaps&&0===level&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.resetTextureCache(),texture.isReady=!0},Engine.prototype.createRawCubeTexture=function(data,size,format,type,generateMipMaps,invertY,samplingMode,compression){void 0===compression&&(compression=null);var gl=this._gl,texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_CUBERAW);texture.isCube=!0,texture.generateMipMaps=generateMipMaps,texture.format=format,texture.type=type,this._doNotHandleContextLost||(texture._bufferViewArray=data);var textureType=this._getWebGLTextureType(type),internalFormat=this._getInternalFormat(format);internalFormat===gl.RGB&&(internalFormat=gl.RGBA);var width=size,height=width;if(texture.width=width,texture.height=height,!this.needPOTTextures||BABYLON.Tools.IsExponentOfTwo(texture.width)&&BABYLON.Tools.IsExponentOfTwo(texture.height)||(generateMipMaps=!1),data&&this.updateRawCubeTexture(texture,data,format,type,invertY,compression),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,texture),data&&generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),textureType!==gl.FLOAT||this._caps.textureFloatLinearFiltering)if(textureType!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering){var filters=getSamplingParameters(samplingMode,generateMipMaps,gl);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,filters.mag),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,filters.min)}else gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.NEAREST);else gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.NEAREST);return gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null),texture},Engine.prototype.createRawCubeTextureFromUrl=function(url,scene,size,format,type,noMipmap,callback,mipmmapGenerator,onLoad,onError,samplingMode,invertY){var _this=this;void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===invertY&&(invertY=!1);var gl=this._gl,texture=this.createRawCubeTexture(null,size,format,type,!noMipmap,invertY,samplingMode);scene._addPendingData(texture),texture.url=url,this._internalTexturesCache.push(texture);var internalCallback=function(data){var width=texture.width,faceDataArrays=callback(data);if(faceDataArrays){if(mipmmapGenerator){var textureType=_this._getWebGLTextureType(type),internalFormat=_this._getInternalFormat(format),internalSizedFomat=_this._getRGBABufferInternalSizedFormat(type),needConversion=!1;internalFormat===gl.RGB&&(internalFormat=gl.RGBA,needConversion=!0),_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0);for(var mipData=mipmmapGenerator(faceDataArrays),level=0;level<mipData.length;level++)for(var mipSize=width>>level,faceIndex=0;faceIndex<6;faceIndex++){var mipFaceData=mipData[level][faceIndex];needConversion&&(mipFaceData=_this._convertRGBtoRGBATextureData(mipFaceData,mipSize,mipSize,type)),gl.texImage2D(faceIndex,level,internalSizedFomat,mipSize,mipSize,0,internalFormat,textureType,mipFaceData)}_this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null)}else texture.generateMipMaps=!noMipmap,_this.updateRawCubeTexture(texture,faceDataArrays,format,type,invertY);texture.isReady=!0,_this.resetTextureCache(),scene._removePendingData(texture),onLoad&&onLoad()}};return BABYLON.Tools.LoadFile(url,function(data){internalCallback(data)},void 0,scene.database,!0,function(request,exception){scene._removePendingData(texture),onError&&request&&onError(request.status+" "+request.statusText,exception)}),texture},Engine.prototype.updateRawTexture3D=function(texture,data,format,invertY,compression){void 0===compression&&(compression=null);var internalFormat=this._getInternalFormat(format);this._bindTextureDirectly(this._gl.TEXTURE_3D,texture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===invertY?1:invertY?1:0),this._doNotHandleContextLost||(texture._bufferView=data,texture.format=format,texture.invertY=invertY,texture._compression=compression),texture.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),compression&&data?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[compression],texture.width,texture.height,texture.depth,0,data):this._gl.texImage3D(this._gl.TEXTURE_3D,0,internalFormat,texture.width,texture.height,texture.depth,0,internalFormat,this._gl.UNSIGNED_BYTE,data),texture.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this.resetTextureCache(),texture.isReady=!0},Engine.prototype.createRawTexture3D=function(data,width,height,depth,format,generateMipMaps,invertY,samplingMode,compression){void 0===compression&&(compression=null);var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_RAW3D);texture.baseWidth=width,texture.baseHeight=height,texture.baseDepth=depth,texture.width=width,texture.height=height,texture.depth=depth,texture.format=format,texture.generateMipMaps=generateMipMaps,texture.samplingMode=samplingMode,texture.is3D=!0,this._doNotHandleContextLost||(texture._bufferView=data),this.updateRawTexture3D(texture,data,format,invertY,compression),this._bindTextureDirectly(this._gl.TEXTURE_3D,texture);var filters=getSamplingParameters(samplingMode,generateMipMaps,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,filters.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,filters.min),generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(texture),texture},Engine.prototype._prepareWebGLTextureContinuation=function(texture,scene,noMipmap,isCompressed,samplingMode){var gl=this._gl;if(gl){var filters=getSamplingParameters(samplingMode,!noMipmap,gl);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filters.mag),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filters.min),noMipmap||isCompressed||gl.generateMipmap(gl.TEXTURE_2D),this._bindTextureDirectly(gl.TEXTURE_2D,null),this.resetTextureCache(),scene&&scene._removePendingData(texture),texture.onLoadedObservable.notifyObservers(texture),texture.onLoadedObservable.clear()}},Engine.prototype._prepareWebGLTexture=function(texture,scene,width,height,invertY,noMipmap,isCompressed,processFunction,samplingMode){var _this=this;void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);var potWidth=this.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(width,this.getCaps().maxTextureSize):width,potHeight=this.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(height,this.getCaps().maxTextureSize):height,gl=this._gl;if(gl){if(!texture._webGLTexture)return this.resetTextureCache(),void(scene&&scene._removePendingData(texture));this._bindTextureDirectly(gl.TEXTURE_2D,texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,void 0===invertY?1:invertY?1:0),texture.baseWidth=width,texture.baseHeight=height,texture.width=potWidth,texture.height=potHeight,texture.isReady=!0,processFunction(potWidth,potHeight,function(){_this._prepareWebGLTextureContinuation(texture,scene,noMipmap,isCompressed,samplingMode)})||this._prepareWebGLTextureContinuation(texture,scene,noMipmap,isCompressed,samplingMode)}},Engine.prototype._convertRGBtoRGBATextureData=function(rgbData,width,height,textureType){var rgbaData;rgbaData=textureType===Engine.TEXTURETYPE_FLOAT?new Float32Array(width*height*4):new Uint32Array(width*height*4);for(var x=0;x<width;x++)for(var y=0;y<height;y++){var index=3*(y*width+x),newIndex=4*(y*width+x);rgbaData[newIndex+0]=rgbData[index+0],rgbaData[newIndex+1]=rgbData[index+1],rgbaData[newIndex+2]=rgbData[index+2],rgbaData[newIndex+3]=1}return rgbaData},Engine.prototype._releaseFramebufferObjects=function(texture){var gl=this._gl;texture._framebuffer&&(gl.deleteFramebuffer(texture._framebuffer),texture._framebuffer=null),texture._depthStencilBuffer&&(gl.deleteRenderbuffer(texture._depthStencilBuffer),texture._depthStencilBuffer=null),texture._MSAAFramebuffer&&(gl.deleteFramebuffer(texture._MSAAFramebuffer),texture._MSAAFramebuffer=null),texture._MSAARenderBuffer&&(gl.deleteRenderbuffer(texture._MSAARenderBuffer),texture._MSAARenderBuffer=null)},Engine.prototype._releaseTexture=function(texture){var gl=this._gl;this._releaseFramebufferObjects(texture),gl.deleteTexture(texture._webGLTexture),this.unbindAllTextures();var index=this._internalTexturesCache.indexOf(texture);-1!==index&&this._internalTexturesCache.splice(index,1),texture._lodTextureHigh&&texture._lodTextureHigh.dispose(),texture._lodTextureMid&&texture._lodTextureMid.dispose(),texture._lodTextureLow&&texture._lodTextureLow.dispose()},Engine.prototype.setProgram=function(program){this._currentProgram!==program&&(this._gl.useProgram(program),this._currentProgram=program)},Engine.prototype.bindSamplers=function(effect){this.setProgram(effect.getProgram());for(var samplers=effect.getSamplers(),index=0;index<samplers.length;index++){var uniform=effect.getUniform(samplers[index]);this._gl.uniform1i(uniform,index)}this._currentEffect=null},Engine.prototype.activateTextureChannel=function(textureChannel){this._activeTextureChannel!==textureChannel&&(this._gl.activeTexture(textureChannel),this._activeTextureChannel=textureChannel)},Engine.prototype._bindTextureDirectly=function(target,texture){this._boundTexturesCache[this._activeTextureChannel]!==texture&&(this._gl.bindTexture(target,texture?texture._webGLTexture:null),this._boundTexturesCache[this._activeTextureChannel]=texture)},Engine.prototype._bindTexture=function(channel,texture){channel<0||(this.activateTextureChannel(this._gl.TEXTURE0+channel),this._bindTextureDirectly(this._gl.TEXTURE_2D,texture))},Engine.prototype.setTextureFromPostProcess=function(channel,postProcess){this._bindTexture(channel,postProcess?postProcess._textures.data[postProcess._currentRenderTextureInd]:null)},Engine.prototype.unbindAllTextures=function(){for(var channel=0;channel<this._caps.maxTexturesImageUnits;channel++)this.activateTextureChannel(this._gl.TEXTURE0+channel),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},Engine.prototype.setTexture=function(channel,uniform,texture){channel<0||this._setTexture(channel,texture)&&this._gl.uniform1i(uniform,channel)},Engine.prototype._setTexture=function(channel,texture){if(!texture)return null!=this._boundTexturesCache[channel]&&(this.activateTextureChannel(this._gl.TEXTURE0+channel),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;var alreadyActivated=!1;if(texture.video)this.activateTextureChannel(this._gl.TEXTURE0+channel),alreadyActivated=!0,texture.update();else if(texture.delayLoadState===Engine.DELAYLOADSTATE_NOTLOADED)return texture.delayLoad(),!1;var internalTexture;if(internalTexture=texture.isReady()?texture.getInternalTexture():texture.isCube?this.emptyCubeTexture:texture.is3D?this.emptyTexture3D:this.emptyTexture,alreadyActivated||this.activateTextureChannel(this._gl.TEXTURE0+channel),this._boundTexturesCache[this._activeTextureChannel]===internalTexture)return!1;if(internalTexture&&internalTexture.is3D){if(this._bindTextureDirectly(this._gl.TEXTURE_3D,internalTexture),internalTexture&&internalTexture._cachedWrapU!==texture.wrapU)switch(internalTexture._cachedWrapU=texture.wrapU,texture.wrapU){case BABYLON.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case BABYLON.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case BABYLON.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(internalTexture&&internalTexture._cachedWrapV!==texture.wrapV)switch(internalTexture._cachedWrapV=texture.wrapV,texture.wrapV){case BABYLON.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case BABYLON.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case BABYLON.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}if(internalTexture&&internalTexture._cachedWrapR!==texture.wrapR)switch(internalTexture._cachedWrapR=texture.wrapR,texture.wrapV){case BABYLON.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.REPEAT);break;case BABYLON.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE);break;case BABYLON.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_3D,texture)}else if(internalTexture&&internalTexture.isCube){if(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,internalTexture),internalTexture._cachedCoordinatesMode!==texture.coordinatesMode){internalTexture._cachedCoordinatesMode=texture.coordinatesMode;var textureWrapMode=texture.coordinatesMode!==BABYLON.Texture.CUBIC_MODE&&texture.coordinatesMode!==BABYLON.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,textureWrapMode),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,textureWrapMode)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,texture)}else{if(this._bindTextureDirectly(this._gl.TEXTURE_2D,internalTexture),internalTexture&&internalTexture._cachedWrapU!==texture.wrapU)switch(internalTexture._cachedWrapU=texture.wrapU,texture.wrapU){case BABYLON.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case BABYLON.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case BABYLON.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(internalTexture&&internalTexture._cachedWrapV!==texture.wrapV)switch(internalTexture._cachedWrapV=texture.wrapV,texture.wrapV){case BABYLON.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case BABYLON.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case BABYLON.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,texture)}return!0},Engine.prototype.setTextureArray=function(channel,uniform,textures){if(!(channel<0)&&uniform){this._textureUnits&&this._textureUnits.length===textures.length||(this._textureUnits=new Int32Array(textures.length));for(var i=0;i<textures.length;i++)this._textureUnits[i]=channel+i;this._gl.uniform1iv(uniform,this._textureUnits);for(var index=0;index<textures.length;index++)this._setTexture(channel+index,textures[index])}},Engine.prototype._setAnisotropicLevel=function(key,texture){var internalTexture=texture.getInternalTexture();if(internalTexture){var anisotropicFilterExtension=this._caps.textureAnisotropicFilterExtension,value=texture.anisotropicFilteringLevel;internalTexture.samplingMode!==BABYLON.Texture.LINEAR_LINEAR_MIPNEAREST&&internalTexture.samplingMode!==BABYLON.Texture.LINEAR_LINEAR_MIPLINEAR&&internalTexture.samplingMode!==BABYLON.Texture.LINEAR_LINEAR&&(value=1),anisotropicFilterExtension&&internalTexture._cachedAnisotropicFilteringLevel!==value&&(this._gl.texParameterf(key,anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(value,this._caps.maxAnisotropy)),internalTexture._cachedAnisotropicFilteringLevel=value)}},Engine.prototype.readPixels=function(x,y,width,height){var data=new Uint8Array(height*width*4);return this._gl.readPixels(x,y,width,height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,data),data},Engine.prototype.addExternalData=function(key,data){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.add(key,data)},Engine.prototype.getExternalData=function(key){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.get(key)},Engine.prototype.getOrAddExternalDataWithFactory=function(key,factory){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.getOrAddWithFactory(key,factory)},Engine.prototype.removeExternalData=function(key){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.remove(key)},Engine.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(i=0;i<this._caps.maxVertexAttribs;i++)this._gl.disableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!1,this._currentBufferPointers[i].active=!1}else for(var i=0,ul=this._vertexAttribArraysEnabled.length;i<ul;i++)i>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[i]||(this._gl.disableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!1,this._currentBufferPointers[i].active=!1)},Engine.prototype.releaseEffects=function(){for(var name in this._compiledEffects)this._deleteProgram(this._compiledEffects[name]._program);this._compiledEffects={}},Engine.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();Engine.audioEngine&&Engine.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),BABYLON.Tools.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasBlur),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var index=Engine.Instances.indexOf(this);index>=0&&Engine.Instances.splice(index,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),BABYLON.Effect.ResetCache()},Engine.prototype.displayLoadingUI=function(){if(BABYLON.Tools.IsWindowObjectExist()){var loadingScreen=this.loadingScreen;loadingScreen&&loadingScreen.displayLoadingUI()}},Engine.prototype.hideLoadingUI=function(){if(BABYLON.Tools.IsWindowObjectExist()){var loadingScreen=this.loadingScreen;loadingScreen&&loadingScreen.hideLoadingUI()}},Object.defineProperty(Engine.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&BABYLON.DefaultLoadingScreen&&this._renderingCanvas&&(this._loadingScreen=new BABYLON.DefaultLoadingScreen(this._renderingCanvas)),this._loadingScreen},set:function(loadingScreen){this._loadingScreen=loadingScreen},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"loadingUIText",{set:function(text){this.loadingScreen.loadingUIText=text},enumerable:!0,configurable:!0}),Object.defineProperty(Engine.prototype,"loadingUIBackgroundColor",{set:function(color){this.loadingScreen.loadingUIBackgroundColor=color},enumerable:!0,configurable:!0}),Engine.prototype.attachContextLostEvent=function(callback){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",callback,!1)},Engine.prototype.attachContextRestoredEvent=function(callback){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",callback,!1)},Engine.prototype.getVertexShaderSource=function(program){var shaders=this._gl.getAttachedShaders(program);return shaders?this._gl.getShaderSource(shaders[0]):null},Engine.prototype.getFragmentShaderSource=function(program){var shaders=this._gl.getAttachedShaders(program);return shaders?this._gl.getShaderSource(shaders[1]):null},Engine.prototype.getError=function(){return this._gl.getError()},Engine.prototype.getFps=function(){return this._fps},Engine.prototype.getDeltaTime=function(){return this._deltaTime},Engine.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},Engine.prototype._readTexturePixels=function(texture,width,height,faceIndex){void 0===faceIndex&&(faceIndex=-1);var gl=this._gl;if(!this._dummyFramebuffer){var dummy=gl.createFramebuffer();if(!dummy)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=dummy}gl.bindFramebuffer(gl.FRAMEBUFFER,this._dummyFramebuffer),faceIndex>-1?gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,texture._webGLTexture,0):gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture._webGLTexture,0);var buffer,readType=void 0!==texture.type?this._getWebGLTextureType(texture.type):gl.UNSIGNED_BYTE;switch(readType){case gl.UNSIGNED_BYTE:buffer=new Uint8Array(4*width*height),readType=gl.UNSIGNED_BYTE;break;default:buffer=new Float32Array(4*width*height),readType=gl.FLOAT}return gl.readPixels(0,0,width,height,gl.RGBA,readType,buffer),gl.bindFramebuffer(gl.FRAMEBUFFER,this._currentFramebuffer),buffer},Engine.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(BABYLON.Engine.TEXTURETYPE_FLOAT)},Engine.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(BABYLON.Engine.TEXTURETYPE_HALF_FLOAT)},Engine.prototype._canRenderToFramebuffer=function(type){for(var gl=this._gl;gl.getError()!==gl.NO_ERROR;);var successful=!0,texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture),gl.texImage2D(gl.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(type),1,1,0,gl.RGBA,this._getWebGLTextureType(type),null),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);var fb=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,fb),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(successful=successful&&status===gl.FRAMEBUFFER_COMPLETE,(successful=successful&&gl.getError()===gl.NO_ERROR)&&(gl.clear(gl.COLOR_BUFFER_BIT),successful=successful&&gl.getError()===gl.NO_ERROR),successful){gl.bindFramebuffer(gl.FRAMEBUFFER,null);var readFormat=gl.RGBA,readType=gl.UNSIGNED_BYTE,buffer=new Uint8Array(4);gl.readPixels(0,0,1,1,readFormat,readType,buffer),successful=successful&&gl.getError()===gl.NO_ERROR}for(gl.deleteTexture(texture),gl.deleteFramebuffer(fb),gl.bindFramebuffer(gl.FRAMEBUFFER,null);!successful&&gl.getError()!==gl.NO_ERROR;);return successful},Engine.prototype._getWebGLTextureType=function(type){return type===Engine.TEXTURETYPE_FLOAT?this._gl.FLOAT:type===Engine.TEXTURETYPE_HALF_FLOAT?this._gl.HALF_FLOAT_OES:this._gl.UNSIGNED_BYTE},Engine.prototype._getRGBABufferInternalSizedFormat=function(type){return 1===this._webGLVersion?this._gl.RGBA:type===Engine.TEXTURETYPE_FLOAT?this._gl.RGBA32F:type===Engine.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA},Engine.prototype.createQuery=function(){return this._gl.createQuery()},Engine.prototype.deleteQuery=function(query){return this._gl.deleteQuery(query),this},Engine.prototype.isQueryResultAvailable=function(query){return this._gl.getQueryParameter(query,this._gl.QUERY_RESULT_AVAILABLE)},Engine.prototype.getQueryResult=function(query){return this._gl.getQueryParameter(query,this._gl.QUERY_RESULT)},Engine.prototype.beginOcclusionQuery=function(algorithmType,query){var glAlgorithm=this.getGlAlgorithmType(algorithmType);return this._gl.beginQuery(glAlgorithm,query),this},Engine.prototype.endOcclusionQuery=function(algorithmType){var glAlgorithm=this.getGlAlgorithmType(algorithmType);return this._gl.endQuery(glAlgorithm),this},Engine.prototype._createTimeQuery=function(){var timerQuery=this._caps.timerQuery;return timerQuery.createQueryEXT?timerQuery.createQueryEXT():this.createQuery()},Engine.prototype._deleteTimeQuery=function(query){var timerQuery=this._caps.timerQuery;timerQuery.deleteQueryEXT?timerQuery.deleteQueryEXT(query):this.deleteQuery(query)},Engine.prototype._getTimeQueryResult=function(query){var timerQuery=this._caps.timerQuery;return timerQuery.getQueryObjectEXT?timerQuery.getQueryObjectEXT(query,timerQuery.QUERY_RESULT_EXT):this.getQueryResult(query)},Engine.prototype._getTimeQueryAvailability=function(query){var timerQuery=this._caps.timerQuery;return timerQuery.getQueryObjectEXT?timerQuery.getQueryObjectEXT(query,timerQuery.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(query)},Engine.prototype.startTimeQuery=function(){var timerQuery=this._caps.timerQuery;if(!timerQuery)return null;var token=new BABYLON._TimeToken;if(this._gl.getParameter(timerQuery.GPU_DISJOINT_EXT),this._caps.canUseTimestampForTimerQuery)token._startTimeQuery=this._createTimeQuery(),timerQuery.queryCounterEXT(token._startTimeQuery,timerQuery.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;token._timeElapsedQuery=this._createTimeQuery(),timerQuery.beginQueryEXT?timerQuery.beginQueryEXT(timerQuery.TIME_ELAPSED_EXT,token._timeElapsedQuery):this._gl.beginQuery(timerQuery.TIME_ELAPSED_EXT,token._timeElapsedQuery),this._currentNonTimestampToken=token}return token},Engine.prototype.endTimeQuery=function(token){var timerQuery=this._caps.timerQuery;if(!timerQuery||!token)return-1;if(this._caps.canUseTimestampForTimerQuery){if(!token._startTimeQuery)return-1;token._endTimeQuery||(token._endTimeQuery=this._createTimeQuery(),timerQuery.queryCounterEXT(token._endTimeQuery,timerQuery.TIMESTAMP_EXT))}else if(!token._timeElapsedQueryEnded){if(!token._timeElapsedQuery)return-1;timerQuery.endQueryEXT?timerQuery.endQueryEXT(timerQuery.TIME_ELAPSED_EXT):this._gl.endQuery(timerQuery.TIME_ELAPSED_EXT),token._timeElapsedQueryEnded=!0}var disjoint=this._gl.getParameter(timerQuery.GPU_DISJOINT_EXT),available=!1;if(token._endTimeQuery?available=this._getTimeQueryAvailability(token._endTimeQuery):token._timeElapsedQuery&&(available=this._getTimeQueryAvailability(token._timeElapsedQuery)),available&&!disjoint){var result=0;if(this._caps.canUseTimestampForTimerQuery){if(!token._startTimeQuery||!token._endTimeQuery)return-1;var timeStart=this._getTimeQueryResult(token._startTimeQuery);result=this._getTimeQueryResult(token._endTimeQuery)-timeStart,this._deleteTimeQuery(token._startTimeQuery),this._deleteTimeQuery(token._endTimeQuery),token._startTimeQuery=null,token._endTimeQuery=null}else{if(!token._timeElapsedQuery)return-1;result=this._getTimeQueryResult(token._timeElapsedQuery),this._deleteTimeQuery(token._timeElapsedQuery),token._timeElapsedQuery=null,token._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return result}return-1},Engine.prototype.getGlAlgorithmType=function(algorithmType){return algorithmType===BABYLON.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Engine.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},Engine.prototype.deleteTransformFeedback=function(value){this._gl.deleteTransformFeedback(value)},Engine.prototype.bindTransformFeedback=function(value){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,value)},Engine.prototype.beginTransformFeedback=function(usePoints){void 0===usePoints&&(usePoints=!0),this._gl.beginTransformFeedback(usePoints?this._gl.POINTS:this._gl.TRIANGLES)},Engine.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Engine.prototype.setTranformFeedbackVaryings=function(program,value){this._gl.transformFeedbackVaryings(program,value,this._gl.INTERLEAVED_ATTRIBS)},Engine.prototype.bindTransformFeedbackBuffer=function(value){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,value)},Engine.isSupported=function(){try{var tempcanvas=document.createElement("canvas");return null!=(tempcanvas.getContext("webgl")||tempcanvas.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},Engine.WebGL2UniformBuffersExceptionList=["Chrome/63"],Engine.Instances=new Array,Engine._ALPHA_DISABLE=0,Engine._ALPHA_ADD=1,Engine._ALPHA_COMBINE=2,Engine._ALPHA_SUBTRACT=3,Engine._ALPHA_MULTIPLY=4,Engine._ALPHA_MAXIMIZED=5,Engine._ALPHA_ONEONE=6,Engine._ALPHA_PREMULTIPLIED=7,Engine._ALPHA_PREMULTIPLIED_PORTERDUFF=8,Engine._ALPHA_INTERPOLATE=9,Engine._ALPHA_SCREENMODE=10,Engine._DELAYLOADSTATE_NONE=0,Engine._DELAYLOADSTATE_LOADED=1,Engine._DELAYLOADSTATE_LOADING=2,Engine._DELAYLOADSTATE_NOTLOADED=4,Engine._TEXTUREFORMAT_ALPHA=0,Engine._TEXTUREFORMAT_LUMINANCE=1,Engine._TEXTUREFORMAT_LUMINANCE_ALPHA=2,Engine._TEXTUREFORMAT_RGB=4,Engine._TEXTUREFORMAT_RGBA=5,Engine._TEXTURETYPE_UNSIGNED_INT=0,Engine._TEXTURETYPE_FLOAT=1,Engine._TEXTURETYPE_HALF_FLOAT=2,Engine._NEVER=512,Engine._ALWAYS=519,Engine._LESS=513,Engine._EQUAL=514,Engine._LEQUAL=515,Engine._GREATER=516,Engine._GEQUAL=518,Engine._NOTEQUAL=517,Engine._KEEP=7680,Engine._REPLACE=7681,Engine._INCR=7682,Engine._DECR=7683,Engine._INVERT=5386,Engine._INCR_WRAP=34055,Engine._DECR_WRAP=34056,Engine._SCALEMODE_FLOOR=1,Engine._SCALEMODE_NEAREST=2,Engine._SCALEMODE_CEILING=3,Engine.CollisionsEpsilon=.001,Engine.CodeRepository="src/",Engine.ShadersRepository="src/Shaders/",Engine}();BABYLON.Engine=Engine}(BABYLON||(BABYLON={}));!function(BABYLON){var Node=function(){function Node(name,scene){void 0===scene&&(scene=null),this.state="",this.metadata=null,this.doNotSerialize=!1,this.animations=new Array,this._ranges={},this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.onDisposeObservable=new BABYLON.Observable,this._behaviors=new Array,this.name=name,this.id=name,this._scene=scene||BABYLON.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return Object.defineProperty(Node.prototype,"parent",{get:function(){return this._parentNode},set:function(parent){if(this._parentNode!==parent){if(this._parentNode){var index=this._parentNode._children.indexOf(this);-1!==index&&this._parentNode._children.splice(index,1)}this._parentNode=parent,this._parentNode&&(this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),Node.prototype.getClassName=function(){return"Node"},Object.defineProperty(Node.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Node.prototype.getScene=function(){return this._scene},Node.prototype.getEngine=function(){return this._scene.getEngine()},Node.prototype.addBehavior=function(behavior){var _this=this;if(-1!==this._behaviors.indexOf(behavior))return this;if(behavior.init(),this._scene.isLoading)var observer=this._scene.onDataLoadedObservable.add(function(){behavior.attach(_this),setTimeout(function(){_this._scene.onDataLoadedObservable.remove(observer)},0)});else behavior.attach(this);return this._behaviors.push(behavior),this},Node.prototype.removeBehavior=function(behavior){var index=this._behaviors.indexOf(behavior);return-1===index?this:(this._behaviors[index].detach(),this._behaviors.splice(index,1),this)},Object.defineProperty(Node.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),Node.prototype.getBehaviorByName=function(name){for(var _i=0,_a=this._behaviors;_i<_a.length;_i++){var behavior=_a[_i];if(behavior.name===name)return behavior}return null},Node.prototype.getWorldMatrix=function(){return BABYLON.Matrix.Identity()},Node.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},Node.prototype.updateCache=function(force){!force&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},Node.prototype._updateCache=function(ignoreParentClass){},Node.prototype._isSynchronized=function(){return!0},Node.prototype._markSyncedWithParent=function(){this.parent&&(this._parentRenderId=this.parent._currentRenderId)},Node.prototype.isSynchronizedWithParent=function(){return!this.parent||this._parentRenderId===this.parent._currentRenderId&&this.parent.isSynchronized()},Node.prototype.isSynchronized=function(updateCache){var check=this.hasNewParent();return check=check||!this.isSynchronizedWithParent(),check=check||!this._isSynchronized(),updateCache&&this.updateCache(!0),!check},Node.prototype.hasNewParent=function(update){return this._cache.parent!==this.parent&&(update&&(this._cache.parent=this.parent),!0)},Node.prototype.isReady=function(){return this._isReady},Node.prototype.isEnabled=function(){return!!this._isEnabled&&(!this.parent||this.parent.isEnabled())},Node.prototype.setEnabled=function(value){this._isEnabled=value},Node.prototype.isDescendantOf=function(ancestor){return!!this.parent&&(this.parent===ancestor||this.parent.isDescendantOf(ancestor))},Node.prototype._getDescendants=function(results,directDescendantsOnly,predicate){if(void 0===directDescendantsOnly&&(directDescendantsOnly=!1),this._children)for(var index=0;index<this._children.length;index++){var item=this._children[index];predicate&&!predicate(item)||results.push(item),directDescendantsOnly||item._getDescendants(results,!1,predicate)}},Node.prototype.getDescendants=function(directDescendantsOnly,predicate){var results=new Array;return this._getDescendants(results,directDescendantsOnly,predicate),results},Node.prototype.getChildMeshes=function(directDescendantsOnly,predicate){var results=[];return this._getDescendants(results,directDescendantsOnly,function(node){return(!predicate||predicate(node))&&node instanceof BABYLON.AbstractMesh}),results},Node.prototype.getChildTransformNodes=function(directDescendantsOnly,predicate){var results=[];return this._getDescendants(results,directDescendantsOnly,function(node){return(!predicate||predicate(node))&&node instanceof BABYLON.TransformNode}),results},Node.prototype.getChildren=function(predicate){return this.getDescendants(!0,predicate)},Node.prototype._setReady=function(state){state!==this._isReady&&(state?(this._isReady=!0,this.onReady&&this.onReady(this)):this._isReady=!1)},Node.prototype.getAnimationByName=function(name){for(var i=0;i<this.animations.length;i++){var animation=this.animations[i];if(animation.name===name)return animation}return null},Node.prototype.createAnimationRange=function(name,from,to){if(!this._ranges[name]){this._ranges[name]=new BABYLON.AnimationRange(name,from,to);for(var i=0,nAnimations=this.animations.length;i<nAnimations;i++)this.animations[i]&&this.animations[i].createRange(name,from,to)}},Node.prototype.deleteAnimationRange=function(name,deleteFrames){void 0===deleteFrames&&(deleteFrames=!0);for(var i=0,nAnimations=this.animations.length;i<nAnimations;i++)this.animations[i]&&this.animations[i].deleteRange(name,deleteFrames);this._ranges[name]=null},Node.prototype.getAnimationRange=function(name){return this._ranges[name]},Node.prototype.beginAnimation=function(name,loop,speedRatio,onAnimationEnd){var range=this.getAnimationRange(name);range&&this._scene.beginAnimation(this,range.from,range.to,loop,speedRatio,onAnimationEnd)},Node.prototype.serializeAnimationRanges=function(){var serializationRanges=[];for(var name in this._ranges){var localRange=this._ranges[name];if(localRange){var range={};range.name=name,range.from=localRange.from,range.to=localRange.to,serializationRanges.push(range)}}return serializationRanges},Node.prototype.computeWorldMatrix=function(force){return BABYLON.Matrix.Identity()},Node.prototype.dispose=function(){this.parent=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var _i=0,_a=this._behaviors;_i<_a.length;_i++)_a[_i].detach();this._behaviors=[]},Node.ParseAnimationRanges=function(node,parsedNode,scene){if(parsedNode.ranges)for(var index=0;index<parsedNode.ranges.length;index++){var data=parsedNode.ranges[index];node.createAnimationRange(data.name,data.from,data.to)}},__decorate([BABYLON.serialize()],Node.prototype,"name",void 0),__decorate([BABYLON.serialize()],Node.prototype,"id",void 0),__decorate([BABYLON.serialize()],Node.prototype,"uniqueId",void 0),__decorate([BABYLON.serialize()],Node.prototype,"state",void 0),__decorate([BABYLON.serialize()],Node.prototype,"metadata",void 0),Node}();BABYLON.Node=Node}(BABYLON||(BABYLON={}));!function(BABYLON){var BoundingSphere=function(){function BoundingSphere(minimum,maximum){this.minimum=minimum,this.maximum=maximum,this._tempRadiusVector=BABYLON.Vector3.Zero();var distance=BABYLON.Vector3.Distance(minimum,maximum);this.center=BABYLON.Vector3.Lerp(minimum,maximum,.5),this.radius=.5*distance,this.centerWorld=BABYLON.Vector3.Zero(),this._update(BABYLON.Matrix.Identity())}return BoundingSphere.prototype._update=function(world){BABYLON.Vector3.TransformCoordinatesToRef(this.center,world,this.centerWorld),BABYLON.Vector3.TransformNormalFromFloatsToRef(1,1,1,world,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},BoundingSphere.prototype.isInFrustum=function(frustumPlanes){for(var i=0;i<6;i++)if(frustumPlanes[i].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},BoundingSphere.prototype.intersectsPoint=function(point){var x=this.centerWorld.x-point.x,y=this.centerWorld.y-point.y,z=this.centerWorld.z-point.z,distance=Math.sqrt(x*x+y*y+z*z);return!(Math.abs(this.radiusWorld-distance)<BABYLON.Epsilon)},BoundingSphere.Intersects=function(sphere0,sphere1){var x=sphere0.centerWorld.x-sphere1.centerWorld.x,y=sphere0.centerWorld.y-sphere1.centerWorld.y,z=sphere0.centerWorld.z-sphere1.centerWorld.z,distance=Math.sqrt(x*x+y*y+z*z);return!(sphere0.radiusWorld+sphere1.radiusWorld<distance)},BoundingSphere}();BABYLON.BoundingSphere=BoundingSphere}(BABYLON||(BABYLON={}));!function(BABYLON){var BoundingBox=function(){function BoundingBox(minimum,maximum){this.minimum=minimum,this.maximum=maximum,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()];for(var index=0;index<this.vectors.length;index++)this.vectorsWorld[index]=BABYLON.Vector3.Zero();this.minimumWorld=BABYLON.Vector3.Zero(),this.maximumWorld=BABYLON.Vector3.Zero(),this.centerWorld=BABYLON.Vector3.Zero(),this.extendSizeWorld=BABYLON.Vector3.Zero(),this._update(BABYLON.Matrix.Identity())}return BoundingBox.prototype.getWorldMatrix=function(){return this._worldMatrix},BoundingBox.prototype.setWorldMatrix=function(matrix){return this._worldMatrix.copyFrom(matrix),this},BoundingBox.prototype._update=function(world){BABYLON.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),BABYLON.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var index=0;index<this.vectors.length;index++){var v=this.vectorsWorld[index];BABYLON.Vector3.TransformCoordinatesToRef(this.vectors[index],world,v),v.x<this.minimumWorld.x&&(this.minimumWorld.x=v.x),v.y<this.minimumWorld.y&&(this.minimumWorld.y=v.y),v.z<this.minimumWorld.z&&(this.minimumWorld.z=v.z),v.x>this.maximumWorld.x&&(this.maximumWorld.x=v.x),v.y>this.maximumWorld.y&&(this.maximumWorld.y=v.y),v.z>this.maximumWorld.z&&(this.maximumWorld.z=v.z)}this.maximumWorld.subtractToRef(this.minimumWorld,this.extendSizeWorld),this.extendSizeWorld.scaleInPlace(.5),this.maximumWorld.addToRef(this.minimumWorld,this.centerWorld),this.centerWorld.scaleInPlace(.5),BABYLON.Vector3.FromFloatArrayToRef(world.m,0,this.directions[0]),BABYLON.Vector3.FromFloatArrayToRef(world.m,4,this.directions[1]),BABYLON.Vector3.FromFloatArrayToRef(world.m,8,this.directions[2]),this._worldMatrix=world},BoundingBox.prototype.isInFrustum=function(frustumPlanes){return BoundingBox.IsInFrustum(this.vectorsWorld,frustumPlanes)},BoundingBox.prototype.isCompletelyInFrustum=function(frustumPlanes){return BoundingBox.IsCompletelyInFrustum(this.vectorsWorld,frustumPlanes)},BoundingBox.prototype.intersectsPoint=function(point){var delta=-BABYLON.Epsilon;return!(this.maximumWorld.x-point.x<delta||delta>point.x-this.minimumWorld.x)&&(!(this.maximumWorld.y-point.y<delta||delta>point.y-this.minimumWorld.y)&&!(this.maximumWorld.z-point.z<delta||delta>point.z-this.minimumWorld.z))},BoundingBox.prototype.intersectsSphere=function(sphere){return BoundingBox.IntersectsSphere(this.minimumWorld,this.maximumWorld,sphere.centerWorld,sphere.radiusWorld)},BoundingBox.prototype.intersectsMinMax=function(min,max){return!(this.maximumWorld.x<min.x||this.minimumWorld.x>max.x)&&(!(this.maximumWorld.y<min.y||this.minimumWorld.y>max.y)&&!(this.maximumWorld.z<min.z||this.minimumWorld.z>max.z))},BoundingBox.Intersects=function(box0,box1){return!(box0.maximumWorld.x<box1.minimumWorld.x||box0.minimumWorld.x>box1.maximumWorld.x)&&(!(box0.maximumWorld.y<box1.minimumWorld.y||box0.minimumWorld.y>box1.maximumWorld.y)&&!(box0.maximumWorld.z<box1.minimumWorld.z||box0.minimumWorld.z>box1.maximumWorld.z))},BoundingBox.IntersectsSphere=function(minPoint,maxPoint,sphereCenter,sphereRadius){var vector=BABYLON.Vector3.Clamp(sphereCenter,minPoint,maxPoint);return BABYLON.Vector3.DistanceSquared(sphereCenter,vector)<=sphereRadius*sphereRadius},BoundingBox.IsCompletelyInFrustum=function(boundingVectors,frustumPlanes){for(var p=0;p<6;p++)for(var i=0;i<8;i++)if(frustumPlanes[p].dotCoordinate(boundingVectors[i])<0)return!1;return!0},BoundingBox.IsInFrustum=function(boundingVectors,frustumPlanes){for(var p=0;p<6;p++){for(var inCount=8,i=0;i<8&&frustumPlanes[p].dotCoordinate(boundingVectors[i])<0;i++)--inCount;if(0===inCount)return!1}return!0},BoundingBox}();BABYLON.BoundingBox=BoundingBox}(BABYLON||(BABYLON={}));!function(BABYLON){var computeBoxExtents=function(axis,box){var p=BABYLON.Vector3.Dot(box.centerWorld,axis),r=Math.abs(BABYLON.Vector3.Dot(box.directions[0],axis))*box.extendSize.x+Math.abs(BABYLON.Vector3.Dot(box.directions[1],axis))*box.extendSize.y+Math.abs(BABYLON.Vector3.Dot(box.directions[2],axis))*box.extendSize.z;return{min:p-r,max:p+r}},extentsOverlap=function(min0,max0,min1,max1){return!(min0>max1||min1>max0)},axisOverlap=function(axis,box0,box1){var result0=computeBoxExtents(axis,box0),result1=computeBoxExtents(axis,box1);return extentsOverlap(result0.min,result0.max,result1.min,result1.max)},BoundingInfo=function(){function BoundingInfo(minimum,maximum){this.minimum=minimum,this.maximum=maximum,this._isLocked=!1,this.boundingBox=new BABYLON.BoundingBox(minimum,maximum),this.boundingSphere=new BABYLON.BoundingSphere(minimum,maximum)}return Object.defineProperty(BoundingInfo.prototype,"isLocked",{get:function(){return this._isLocked},set:function(value){this._isLocked=value},enumerable:!0,configurable:!0}),BoundingInfo.prototype.update=function(world){this._isLocked||(this.boundingBox._update(world),this.boundingSphere._update(world))},BoundingInfo.prototype.centerOn=function(center,extend){return this.minimum=center.subtract(extend),this.maximum=center.add(extend),this.boundingBox=new BABYLON.BoundingBox(this.minimum,this.maximum),this.boundingSphere=new BABYLON.BoundingSphere(this.minimum,this.maximum),this},BoundingInfo.prototype.isInFrustum=function(frustumPlanes){return!!this.boundingSphere.isInFrustum(frustumPlanes)&&this.boundingBox.isInFrustum(frustumPlanes)},Object.defineProperty(BoundingInfo.prototype,"diagonalLength",{get:function(){var boundingBox=this.boundingBox;return boundingBox.maximumWorld.subtract(boundingBox.minimumWorld).length()},enumerable:!0,configurable:!0}),BoundingInfo.prototype.isCompletelyInFrustum=function(frustumPlanes){return this.boundingBox.isCompletelyInFrustum(frustumPlanes)},BoundingInfo.prototype._checkCollision=function(collider){return collider._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},BoundingInfo.prototype.intersectsPoint=function(point){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(point)&&!!this.boundingBox.intersectsPoint(point))},BoundingInfo.prototype.intersects=function(boundingInfo,precise){if(!this.boundingSphere.centerWorld||!boundingInfo.boundingSphere.centerWorld)return!1;if(!BABYLON.BoundingSphere.Intersects(this.boundingSphere,boundingInfo.boundingSphere))return!1;if(!BABYLON.BoundingBox.Intersects(this.boundingBox,boundingInfo.boundingBox))return!1;if(!precise)return!0;var box0=this.boundingBox,box1=boundingInfo.boundingBox;return!!axisOverlap(box0.directions[0],box0,box1)&&(!!axisOverlap(box0.directions[1],box0,box1)&&(!!axisOverlap(box0.directions[2],box0,box1)&&(!!axisOverlap(box1.directions[0],box0,box1)&&(!!axisOverlap(box1.directions[1],box0,box1)&&(!!axisOverlap(box1.directions[2],box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[0],box1.directions[0]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[0],box1.directions[1]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[0],box1.directions[2]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[1],box1.directions[0]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[1],box1.directions[1]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[1],box1.directions[2]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[2],box1.directions[0]),box0,box1)&&(!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[2],box1.directions[1]),box0,box1)&&!!axisOverlap(BABYLON.Vector3.Cross(box0.directions[2],box1.directions[2]),box0,box1))))))))))))))},BoundingInfo}();BABYLON.BoundingInfo=BoundingInfo}(BABYLON||(BABYLON={}));!function(BABYLON){var TransformNode=function(_super){function TransformNode(name,scene,isPure){void 0===scene&&(scene=null),void 0===isPure&&(isPure=!0);var _this=_super.call(this,name,scene)||this;return _this._rotation=BABYLON.Vector3.Zero(),_this._scaling=BABYLON.Vector3.One(),_this._isDirty=!1,_this.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_NONE,_this.scalingDeterminant=1,_this.infiniteDistance=!1,_this.position=BABYLON.Vector3.Zero(),_this._localWorld=BABYLON.Matrix.Zero(),_this._worldMatrix=BABYLON.Matrix.Zero(),_this._absolutePosition=BABYLON.Vector3.Zero(),_this._pivotMatrix=BABYLON.Matrix.Identity(),_this._postMultiplyPivotMatrix=!1,_this._isWorldMatrixFrozen=!1,_this.onAfterWorldMatrixUpdateObservable=new BABYLON.Observable,_this._nonUniformScaling=!1,isPure&&_this.getScene().addTransformNode(_this),_this}return __extends(TransformNode,_super),Object.defineProperty(TransformNode.prototype,"rotation",{get:function(){return this._rotation},set:function(newRotation){this._rotation=newRotation},enumerable:!0,configurable:!0}),Object.defineProperty(TransformNode.prototype,"scaling",{get:function(){return this._scaling},set:function(newScaling){this._scaling=newScaling},enumerable:!0,configurable:!0}),Object.defineProperty(TransformNode.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(quaternion){this._rotationQuaternion=quaternion,quaternion&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),TransformNode.prototype.getWorldMatrix=function(){return this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},Object.defineProperty(TransformNode.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),TransformNode.prototype.updatePoseMatrix=function(matrix){return this._poseMatrix.copyFrom(matrix),this},TransformNode.prototype.getPoseMatrix=function(){return this._poseMatrix},TransformNode.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===BABYLON.AbstractMesh.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this.position)&&(!(this.rotationQuaternion&&!this._cache.rotationQuaternion.equals(this.rotationQuaternion))&&(!!this._cache.rotation.equals(this.rotation)&&!!this._cache.scaling.equals(this.scaling)))))))},TransformNode.prototype._initCache=function(){_super.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=BABYLON.Vector3.Zero(),this._cache.scaling=BABYLON.Vector3.Zero(),this._cache.rotation=BABYLON.Vector3.Zero(),this._cache.rotationQuaternion=new BABYLON.Quaternion(0,0,0,0),this._cache.billboardMode=-1},TransformNode.prototype.markAsDirty=function(property){return"rotation"===property&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(TransformNode.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),TransformNode.prototype.setPivotMatrix=function(matrix,postMultiplyPivotMatrix){return void 0===postMultiplyPivotMatrix&&(postMultiplyPivotMatrix=!0),this._pivotMatrix=matrix.clone(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=postMultiplyPivotMatrix,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=BABYLON.Matrix.Invert(this._pivotMatrix)),this},TransformNode.prototype.getPivotMatrix=function(){return this._pivotMatrix},TransformNode.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},TransformNode.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(TransformNode.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),TransformNode.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},TransformNode.prototype.setAbsolutePosition=function(absolutePosition){if(!absolutePosition)return this;var absolutePositionX,absolutePositionY,absolutePositionZ;if(void 0===absolutePosition.x){if(arguments.length<3)return this;absolutePositionX=arguments[0],absolutePositionY=arguments[1],absolutePositionZ=arguments[2]}else absolutePositionX=absolutePosition.x,absolutePositionY=absolutePosition.y,absolutePositionZ=absolutePosition.z;if(this.parent){var invertParentWorldMatrix=this.parent.getWorldMatrix().clone();invertParentWorldMatrix.invert();var worldPosition=new BABYLON.Vector3(absolutePositionX,absolutePositionY,absolutePositionZ);this.position=BABYLON.Vector3.TransformCoordinates(worldPosition,invertParentWorldMatrix)}else this.position.x=absolutePositionX,this.position.y=absolutePositionY,this.position.z=absolutePositionZ;return this},TransformNode.prototype.setPositionWithLocalVector=function(vector3){return this.computeWorldMatrix(),this.position=BABYLON.Vector3.TransformNormal(vector3,this._localWorld),this},TransformNode.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var invLocalWorldMatrix=this._localWorld.clone();return invLocalWorldMatrix.invert(),BABYLON.Vector3.TransformNormal(this.position,invLocalWorldMatrix)},TransformNode.prototype.locallyTranslate=function(vector3){return this.computeWorldMatrix(!0),this.position=BABYLON.Vector3.TransformCoordinates(vector3,this._localWorld),this},TransformNode.prototype.lookAt=function(targetPoint,yawCor,pitchCor,rollCor,space){void 0===yawCor&&(yawCor=0),void 0===pitchCor&&(pitchCor=0),void 0===rollCor&&(rollCor=0),void 0===space&&(space=BABYLON.Space.LOCAL);var dv=BABYLON.AbstractMesh._lookAtVectorCache,pos=space===BABYLON.Space.LOCAL?this.position:this.getAbsolutePosition();targetPoint.subtractToRef(pos,dv);var yaw=-Math.atan2(dv.z,dv.x)-Math.PI/2,len=Math.sqrt(dv.x*dv.x+dv.z*dv.z),pitch=Math.atan2(dv.y,len);return this.rotationQuaternion?BABYLON.Quaternion.RotationYawPitchRollToRef(yaw+yawCor,pitch+pitchCor,rollCor,this.rotationQuaternion):(this.rotation.x=pitch+pitchCor,this.rotation.y=yaw+yawCor,this.rotation.z=rollCor),this},TransformNode.prototype.getDirection=function(localAxis){var result=BABYLON.Vector3.Zero();return this.getDirectionToRef(localAxis,result),result},TransformNode.prototype.getDirectionToRef=function(localAxis,result){return BABYLON.Vector3.TransformNormalToRef(localAxis,this.getWorldMatrix(),result),this},TransformNode.prototype.setPivotPoint=function(point,space){void 0===space&&(space=BABYLON.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var wm=this.getWorldMatrix();if(space==BABYLON.Space.WORLD){var tmat=BABYLON.Tmp.Matrix[0];wm.invertToRef(tmat),point=BABYLON.Vector3.TransformCoordinates(point,tmat)}return this.setPivotMatrix(BABYLON.Matrix.Translation(-point.x,-point.y,-point.z),!0)},TransformNode.prototype.getPivotPoint=function(){var point=BABYLON.Vector3.Zero();return this.getPivotPointToRef(point),point},TransformNode.prototype.getPivotPointToRef=function(result){return result.x=-this._pivotMatrix.m[12],result.y=-this._pivotMatrix.m[13],result.z=-this._pivotMatrix.m[14],this},TransformNode.prototype.getAbsolutePivotPoint=function(){var point=BABYLON.Vector3.Zero();return this.getAbsolutePivotPointToRef(point),point},TransformNode.prototype.getAbsolutePivotPointToRef=function(result){return result.x=this._pivotMatrix.m[12],result.y=this._pivotMatrix.m[13],result.z=this._pivotMatrix.m[14],this.getPivotPointToRef(result),BABYLON.Vector3.TransformCoordinatesToRef(result,this.getWorldMatrix(),result),this},TransformNode.prototype.setParent=function(node){if(null==node){var rotation=BABYLON.Tmp.Quaternion[0],position=BABYLON.Tmp.Vector3[0],scale=BABYLON.Tmp.Vector3[1];this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(scale,rotation,position),this.rotationQuaternion?this.rotationQuaternion.copyFrom(rotation):rotation.toEulerAnglesToRef(this.rotation),this.scaling.x=scale.x,this.scaling.y=scale.y,this.scaling.z=scale.z,this.position.x=position.x,this.position.y=position.y,this.position.z=position.z}else{var rotation=BABYLON.Tmp.Quaternion[0],position=BABYLON.Tmp.Vector3[0],scale=BABYLON.Tmp.Vector3[1],diffMatrix=BABYLON.Tmp.Matrix[0],invParentMatrix=BABYLON.Tmp.Matrix[1];this.computeWorldMatrix(!0),node.computeWorldMatrix(!0),node.getWorldMatrix().invertToRef(invParentMatrix),this.getWorldMatrix().multiplyToRef(invParentMatrix,diffMatrix),diffMatrix.decompose(scale,rotation,position),this.rotationQuaternion?this.rotationQuaternion.copyFrom(rotation):rotation.toEulerAnglesToRef(this.rotation),this.position.x=position.x,this.position.y=position.y,this.position.z=position.z,this.scaling.x=scale.x,this.scaling.y=scale.y,this.scaling.z=scale.z}return this.parent=node,this},Object.defineProperty(TransformNode.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),TransformNode.prototype._updateNonUniformScalingState=function(value){return this._nonUniformScaling!==value&&(this._nonUniformScaling=!0,!0)},TransformNode.prototype.attachToBone=function(bone,affectedTransformNode){return this._transformToBoneReferal=affectedTransformNode,this.parent=bone,bone.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},TransformNode.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},TransformNode.prototype.rotate=function(axis,amount,space){axis.normalize(),this.rotationQuaternion||(this.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=BABYLON.Vector3.Zero());var rotationQuaternion;if(space&&space!==BABYLON.Space.LOCAL){if(this.parent){var invertParentWorldMatrix=this.parent.getWorldMatrix().clone();invertParentWorldMatrix.invert(),axis=BABYLON.Vector3.TransformNormal(axis,invertParentWorldMatrix)}(rotationQuaternion=BABYLON.Quaternion.RotationAxisToRef(axis,amount,BABYLON.AbstractMesh._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else rotationQuaternion=BABYLON.Quaternion.RotationAxisToRef(axis,amount,BABYLON.AbstractMesh._rotationAxisCache),this.rotationQuaternion.multiplyToRef(rotationQuaternion,this.rotationQuaternion);return this},TransformNode.prototype.rotateAround=function(point,axis,amount){return axis.normalize(),this.rotationQuaternion||(this.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.copyFromFloats(0,0,0)),point.subtractToRef(this.position,BABYLON.Tmp.Vector3[0]),BABYLON.Matrix.TranslationToRef(BABYLON.Tmp.Vector3[0].x,BABYLON.Tmp.Vector3[0].y,BABYLON.Tmp.Vector3[0].z,BABYLON.Tmp.Matrix[0]),BABYLON.Tmp.Matrix[0].invertToRef(BABYLON.Tmp.Matrix[2]),BABYLON.Matrix.RotationAxisToRef(axis,amount,BABYLON.Tmp.Matrix[1]),BABYLON.Tmp.Matrix[2].multiplyToRef(BABYLON.Tmp.Matrix[1],BABYLON.Tmp.Matrix[2]),BABYLON.Tmp.Matrix[2].multiplyToRef(BABYLON.Tmp.Matrix[0],BABYLON.Tmp.Matrix[2]),BABYLON.Tmp.Matrix[2].decompose(BABYLON.Tmp.Vector3[0],BABYLON.Tmp.Quaternion[0],BABYLON.Tmp.Vector3[1]),this.position.addInPlace(BABYLON.Tmp.Vector3[1]),BABYLON.Tmp.Quaternion[0].multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},TransformNode.prototype.translate=function(axis,distance,space){var displacementVector=axis.scale(distance);if(space&&space!==BABYLON.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(displacementVector));else{var tempV3=this.getPositionExpressedInLocalSpace().add(displacementVector);this.setPositionWithLocalVector(tempV3)}return this},TransformNode.prototype.addRotation=function(x,y,z){var rotationQuaternion;this.rotationQuaternion?rotationQuaternion=this.rotationQuaternion:(rotationQuaternion=BABYLON.Tmp.Quaternion[1],BABYLON.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,rotationQuaternion));var accumulation=BABYLON.Tmp.Quaternion[0];return BABYLON.Quaternion.RotationYawPitchRollToRef(y,x,z,accumulation),rotationQuaternion.multiplyInPlace(accumulation),this.rotationQuaternion||rotationQuaternion.toEulerAnglesToRef(this.rotation),this},TransformNode.prototype.computeWorldMatrix=function(force){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!force&&this.isSynchronized(!0))return this._worldMatrix;this._cache.position||this._initCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,BABYLON.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,BABYLON.Tmp.Matrix[1]),this.rotationQuaternion&&this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(BABYLON.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0)),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(BABYLON.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(BABYLON.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,BABYLON.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var camera=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&camera){var cameraWorldMatrix=camera.getWorldMatrix(),cameraGlobalPosition=new BABYLON.Vector3(cameraWorldMatrix.m[12],cameraWorldMatrix.m[13],cameraWorldMatrix.m[14]);BABYLON.Matrix.TranslationToRef(this.position.x+cameraGlobalPosition.x,this.position.y+cameraGlobalPosition.y,this.position.z+cameraGlobalPosition.z,BABYLON.Tmp.Matrix[2])}else BABYLON.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,BABYLON.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(BABYLON.Tmp.Matrix[1],BABYLON.Tmp.Matrix[4]),BABYLON.Tmp.Matrix[4].multiplyToRef(BABYLON.Tmp.Matrix[0],BABYLON.Tmp.Matrix[5]),this.billboardMode!==BABYLON.AbstractMesh.BILLBOARDMODE_NONE&&camera){if((this.billboardMode&BABYLON.AbstractMesh.BILLBOARDMODE_ALL)!==BABYLON.AbstractMesh.BILLBOARDMODE_ALL){var currentPosition=BABYLON.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),BABYLON.Tmp.Matrix[6]),BABYLON.Vector3.TransformCoordinatesToRef(this.position,BABYLON.Tmp.Matrix[6],currentPosition)):BABYLON.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),currentPosition):currentPosition.copyFrom(this.position),currentPosition.subtractInPlace(camera.globalPosition);var finalEuler=BABYLON.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&BABYLON.AbstractMesh.BILLBOARDMODE_X)===BABYLON.AbstractMesh.BILLBOARDMODE_X&&(finalEuler.x=Math.atan2(-currentPosition.y,currentPosition.z)),(this.billboardMode&BABYLON.AbstractMesh.BILLBOARDMODE_Y)===BABYLON.AbstractMesh.BILLBOARDMODE_Y&&(finalEuler.y=Math.atan2(currentPosition.x,currentPosition.z)),(this.billboardMode&BABYLON.AbstractMesh.BILLBOARDMODE_Z)===BABYLON.AbstractMesh.BILLBOARDMODE_Z&&(finalEuler.z=Math.atan2(currentPosition.y,currentPosition.x)),BABYLON.Matrix.RotationYawPitchRollToRef(finalEuler.y,finalEuler.x,finalEuler.z,BABYLON.Tmp.Matrix[0])}else BABYLON.Tmp.Matrix[1].copyFrom(camera.getViewMatrix()),BABYLON.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),BABYLON.Tmp.Matrix[1].invertToRef(BABYLON.Tmp.Matrix[0]);BABYLON.Tmp.Matrix[1].copyFrom(BABYLON.Tmp.Matrix[5]),BABYLON.Tmp.Matrix[1].multiplyToRef(BABYLON.Tmp.Matrix[0],BABYLON.Tmp.Matrix[5])}return BABYLON.Tmp.Matrix[5].multiplyToRef(BABYLON.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==BABYLON.AbstractMesh.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),BABYLON.Tmp.Matrix[6]),BABYLON.Tmp.Matrix[5].copyFrom(BABYLON.Tmp.Matrix[6])):BABYLON.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localWorld.getTranslationToRef(BABYLON.Tmp.Vector3[5]),BABYLON.Vector3.TransformCoordinatesToRef(BABYLON.Tmp.Vector3[5],BABYLON.Tmp.Matrix[5],BABYLON.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localWorld),this._worldMatrix.setTranslation(BABYLON.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),BABYLON.Tmp.Matrix[6]),BABYLON.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localWorld),this._postMultiplyPivotMatrix&&this._worldMatrix.multiplyToRef(this._pivotMatrixInverse,this._worldMatrix),this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=BABYLON.Matrix.Invert(this._worldMatrix)),this._worldMatrix},TransformNode.prototype._afterComputeWorldMatrix=function(){},TransformNode.prototype.registerAfterWorldMatrixUpdate=function(func){return this.onAfterWorldMatrixUpdateObservable.add(func),this},TransformNode.prototype.unregisterAfterWorldMatrixUpdate=function(func){return this.onAfterWorldMatrixUpdateObservable.removeCallback(func),this},TransformNode.prototype.clone=function(name,newParent,doNotCloneChildren){var _this=this,result=BABYLON.SerializationHelper.Clone(function(){return new TransformNode(name,_this.getScene())},this);if(result.name=name,result.id=name,newParent&&(result.parent=newParent),!doNotCloneChildren)for(var directDescendants=this.getDescendants(!0),index=0;index<directDescendants.length;index++){var child=directDescendants[index];child.clone&&child.clone(name+"."+child.name,result)}return result},TransformNode.prototype.serialize=function(currentSerializationObject){var serializationObject=BABYLON.SerializationHelper.Serialize(this,currentSerializationObject);return serializationObject.type=this.getClassName(),this.parent&&(serializationObject.parentId=this.parent.id),BABYLON.Tags&&BABYLON.Tags.HasTags(this)&&(serializationObject.tags=BABYLON.Tags.GetTags(this)),serializationObject.localMatrix=this.getPivotMatrix().asArray(),serializationObject.isEnabled=this.isEnabled(),this.parent&&(serializationObject.parentId=this.parent.id),serializationObject},TransformNode.Parse=function(parsedTransformNode,scene,rootUrl){var transformNode=BABYLON.SerializationHelper.Parse(function(){return new TransformNode(parsedTransformNode.name,scene)},parsedTransformNode,scene,rootUrl);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(transformNode,parsedTransformNode.tags),parsedTransformNode.localMatrix?transformNode.setPivotMatrix(BABYLON.Matrix.FromArray(parsedTransformNode.localMatrix)):parsedTransformNode.pivotMatrix&&transformNode.setPivotMatrix(BABYLON.Matrix.FromArray(parsedTransformNode.pivotMatrix)),transformNode.setEnabled(parsedTransformNode.isEnabled),parsedTransformNode.parentId&&(transformNode._waitingParentId=parsedTransformNode.parentId),transformNode},TransformNode.prototype.dispose=function(doNotRecurse){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._cache={},doNotRecurse){var childMeshes=this.getChildMeshes(!0);for(index=0;index<childMeshes.length;index++){var child=childMeshes[index];child.parent=null,child.computeWorldMatrix(!0)}}else for(var objects=this.getDescendants(!0),index=0;index<objects.length;index++)objects[index].dispose();this.onAfterWorldMatrixUpdateObservable.clear(),_super.prototype.dispose.call(this)},TransformNode.BILLBOARDMODE_NONE=0,TransformNode.BILLBOARDMODE_X=1,TransformNode.BILLBOARDMODE_Y=2,TransformNode.BILLBOARDMODE_Z=4,TransformNode.BILLBOARDMODE_ALL=7,TransformNode._lookAtVectorCache=new BABYLON.Vector3(0,0,0),TransformNode._rotationAxisCache=new BABYLON.Quaternion,__decorate([BABYLON.serializeAsVector3()],TransformNode.prototype,"_rotation",void 0),__decorate([BABYLON.serializeAsQuaternion()],TransformNode.prototype,"_rotationQuaternion",void 0),__decorate([BABYLON.serializeAsVector3()],TransformNode.prototype,"_scaling",void 0),__decorate([BABYLON.serialize()],TransformNode.prototype,"billboardMode",void 0),__decorate([BABYLON.serialize()],TransformNode.prototype,"scalingDeterminant",void 0),__decorate([BABYLON.serialize()],TransformNode.prototype,"infiniteDistance",void 0),__decorate([BABYLON.serializeAsVector3()],TransformNode.prototype,"position",void 0),TransformNode}(BABYLON.Node);BABYLON.TransformNode=TransformNode}(BABYLON||(BABYLON={}));!function(BABYLON){var AbstractMesh=function(_super){function AbstractMesh(name,scene){void 0===scene&&(scene=null);var _this=_super.call(this,name,scene,!1)||this;return _this._facetNb=0,_this._partitioningSubdivisions=10,_this._partitioningBBoxRatio=1.01,_this._facetDataEnabled=!1,_this._facetParameters={},_this._bbSize=BABYLON.Vector3.Zero(),_this._subDiv={max:1,X:1,Y:1,Z:1},_this._facetDepthSort=!1,_this._facetDepthSortEnabled=!1,_this.onCollideObservable=new BABYLON.Observable,_this.onCollisionPositionChangeObservable=new BABYLON.Observable,_this.onMaterialChangedObservable=new BABYLON.Observable,_this.definedFacingForward=!0,_this.occlusionQueryAlgorithmType=AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,_this.occlusionType=AbstractMesh.OCCLUSION_TYPE_NONE,_this.occlusionRetryCount=-1,_this._occlusionInternalRetryCounter=0,_this._isOccluded=!1,_this._isOcclusionQueryInProgress=!1,_this.visibility=1,_this.alphaIndex=Number.MAX_VALUE,_this.isVisible=!0,_this.isPickable=!0,_this.showBoundingBox=!1,_this.showSubMeshesBoundingBox=!1,_this.isBlocker=!1,_this.enablePointerMoveEvents=!1,_this.renderingGroupId=0,_this._receiveShadows=!1,_this.renderOutline=!1,_this.outlineColor=BABYLON.Color3.Red(),_this.outlineWidth=.02,_this.renderOverlay=!1,_this.overlayColor=BABYLON.Color3.Red(),_this.overlayAlpha=.5,_this._hasVertexAlpha=!1,_this._useVertexColors=!0,_this._computeBonesUsingShaders=!0,_this._numBoneInfluencers=4,_this._applyFog=!0,_this.useOctreeForRenderingSelection=!0,_this.useOctreeForPicking=!0,_this.useOctreeForCollisions=!0,_this._layerMask=268435455,_this.alwaysSelectAsActiveMesh=!1,_this.actionManager=null,_this.physicsImpostor=null,_this._checkCollisions=!1,_this._collisionMask=-1,_this._collisionGroup=-1,_this.ellipsoid=new BABYLON.Vector3(.5,1,.5),_this.ellipsoidOffset=new BABYLON.Vector3(0,0,0),_this._oldPositionForCollisions=new BABYLON.Vector3(0,0,0),_this._diffPositionForCollisions=new BABYLON.Vector3(0,0,0),_this.edgesWidth=1,_this.edgesColor=new BABYLON.Color4(1,0,0,1),_this._collisionsTransformMatrix=BABYLON.Matrix.Zero(),_this._collisionsScalingMatrix=BABYLON.Matrix.Zero(),_this._isDisposed=!1,_this._renderId=0,_this._intersectionsInProgress=new Array,_this._unIndexed=!1,_this._lightSources=new Array,_this._onCollisionPositionChange=function(collisionId,newPosition,collidedMesh){void 0===collidedMesh&&(collidedMesh=null),_this.getScene().workerCollisions&&newPosition.multiplyInPlace(_this._collider._radius),newPosition.subtractToRef(_this._oldPositionForCollisions,_this._diffPositionForCollisions),_this._diffPositionForCollisions.length()>BABYLON.Engine.CollisionsEpsilon&&_this.position.addInPlace(_this._diffPositionForCollisions),collidedMesh&&_this.onCollideObservable.notifyObservers(collidedMesh),_this.onCollisionPositionChangeObservable.notifyObservers(_this.position)},_this.getScene().addMesh(_this),_this._resyncLightSources(),_this}return __extends(AbstractMesh,_super),Object.defineProperty(AbstractMesh,"BILLBOARDMODE_NONE",{get:function(){return BABYLON.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh,"BILLBOARDMODE_X",{get:function(){return BABYLON.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh,"BILLBOARDMODE_Y",{get:function(){return BABYLON.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh,"BILLBOARDMODE_Z",{get:function(){return BABYLON.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh,"BILLBOARDMODE_ALL",{get:function(){return BABYLON.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"facetNb",{get:function(){return this._facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"partitioningSubdivisions",{get:function(){return this._partitioningSubdivisions},set:function(nb){this._partitioningSubdivisions=nb},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"partitioningBBoxRatio",{get:function(){return this._partitioningBBoxRatio},set:function(ratio){this._partitioningBBoxRatio=ratio},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"mustDepthSortFacets",{get:function(){return this._facetDepthSort},set:function(sort){this._facetDepthSort=sort},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"facetDepthSortFrom",{get:function(){return this._facetDepthSortFrom},set:function(location){this._facetDepthSortFrom=location},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"isFacetDataEnabled",{get:function(){return this._facetDataEnabled},enumerable:!0,configurable:!0}),AbstractMesh.prototype._updateNonUniformScalingState=function(value){return!!_super.prototype._updateNonUniformScalingState.call(this,value)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(AbstractMesh.prototype,"onCollide",{set:function(callback){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"onCollisionPositionChange",{set:function(callback){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"isOccluded",{get:function(){return this._isOccluded},set:function(value){this._isOccluded=value},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"isOcclusionQueryInProgress",{get:function(){return this._isOcclusionQueryInProgress},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"material",{get:function(){return this._material},set:function(value){if(this._material!==value&&(this._material=value,this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes))for(var _i=0,_a=this.subMeshes;_i<_a.length;_i++)_a[_i].setEffect(null)},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(value){this._receiveShadows!==value&&(this._receiveShadows=value,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"hasVertexAlpha",{get:function(){return this._hasVertexAlpha},set:function(value){this._hasVertexAlpha!==value&&(this._hasVertexAlpha=value,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"useVertexColors",{get:function(){return this._useVertexColors},set:function(value){this._useVertexColors!==value&&(this._useVertexColors=value,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"computeBonesUsingShaders",{get:function(){return this._computeBonesUsingShaders},set:function(value){this._computeBonesUsingShaders!==value&&(this._computeBonesUsingShaders=value,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"numBoneInfluencers",{get:function(){return this._numBoneInfluencers},set:function(value){this._numBoneInfluencers!==value&&(this._numBoneInfluencers=value,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"applyFog",{get:function(){return this._applyFog},set:function(value){this._applyFog!==value&&(this._applyFog=value,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"layerMask",{get:function(){return this._layerMask},set:function(value){value!==this._layerMask&&(this._layerMask=value,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(mask){this._collisionMask=isNaN(mask)?-1:mask},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(mask){this._collisionGroup=isNaN(mask)?-1:mask},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"skeleton",{get:function(){return this._skeleton},set:function(value){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),value&&value.needInitialSkinMatrix&&value._registerMeshWithPoseMatrix(this),this._skeleton=value,this._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),AbstractMesh.prototype.isDisposed=function(){return this._isDisposed},AbstractMesh.prototype.getClassName=function(){return"AbstractMesh"},AbstractMesh.prototype.toString=function(fullDetails){var ret="Name: "+this.name+", isInstance: "+(this instanceof BABYLON.InstancedMesh?"YES":"NO");return ret+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(ret+=", skeleton: "+this._skeleton.name),fullDetails&&(ret+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],ret+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),ret},AbstractMesh.prototype._rebuild=function(){if(this._occlusionQuery&&(this._occlusionQuery=null),this._edgesRenderer&&this._edgesRenderer._rebuild(),this.subMeshes)for(var _i=0,_a=this.subMeshes;_i<_a.length;_i++)_a[_i]._rebuild()},AbstractMesh.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var _i=0,_a=this.getScene().lights;_i<_a.length;_i++){var light=_a[_i];light.isEnabled()&&(light.canAffectMesh(this)&&this._lightSources.push(light))}this._markSubMeshesAsLightDirty()},AbstractMesh.prototype._resyncLighSource=function(light){var isIn=light.isEnabled()&&light.canAffectMesh(this),index=this._lightSources.indexOf(light);if(-1===index){if(!isIn)return;this._lightSources.push(light)}else{if(isIn)return;this._lightSources.splice(index,1)}this._markSubMeshesAsLightDirty()},AbstractMesh.prototype._removeLightSource=function(light){var index=this._lightSources.indexOf(light);-1!==index&&this._lightSources.splice(index,1)},AbstractMesh.prototype._markSubMeshesAsDirty=function(func){if(this.subMeshes)for(var _i=0,_a=this.subMeshes;_i<_a.length;_i++){var subMesh=_a[_i];subMesh._materialDefines&&func(subMesh._materialDefines)}},AbstractMesh.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(defines){return defines.markAsLightDirty()})},AbstractMesh.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(defines){return defines.markAsAttributesDirty()})},AbstractMesh.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var _i=0,_a=this.subMeshes;_i<_a.length;_i++){var material=_a[_i].getMaterial();material&&material.markAsDirty(BABYLON.Material.MiscDirtyFlag)}},Object.defineProperty(AbstractMesh.prototype,"scaling",{get:function(){return this._scaling},set:function(newScaling){this._scaling=newScaling,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),AbstractMesh.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},AbstractMesh.prototype.enableEdgesRendering=function(epsilon,checkVerticesInsteadOfIndices){return void 0===epsilon&&(epsilon=.95),void 0===checkVerticesInsteadOfIndices&&(checkVerticesInsteadOfIndices=!1),this.disableEdgesRendering(),this._edgesRenderer=new BABYLON.EdgesRenderer(this,epsilon,checkVerticesInsteadOfIndices),this},Object.defineProperty(AbstractMesh.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),AbstractMesh.prototype.getLOD=function(camera){return this},AbstractMesh.prototype.getTotalVertices=function(){return 0},AbstractMesh.prototype.getIndices=function(){return null},AbstractMesh.prototype.getVerticesData=function(kind){return null},AbstractMesh.prototype.setVerticesData=function(kind,data,updatable,stride){return this},AbstractMesh.prototype.updateVerticesData=function(kind,data,updateExtends,makeItUnique){return this},AbstractMesh.prototype.setIndices=function(indices,totalVertices){return this},AbstractMesh.prototype.isVerticesDataPresent=function(kind){return!1},AbstractMesh.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},AbstractMesh.prototype.normalizeToUnitCube=function(includeDescendants){void 0===includeDescendants&&(includeDescendants=!0);var boundingVectors=this.getHierarchyBoundingVectors(includeDescendants),sizeVec=boundingVectors.max.subtract(boundingVectors.min),maxDimension=Math.max(sizeVec.x,sizeVec.y,sizeVec.z);if(0===maxDimension)return this;var scale=1/maxDimension;return this.scaling.scaleInPlace(scale),this},AbstractMesh.prototype.setBoundingInfo=function(boundingInfo){return this._boundingInfo=boundingInfo,this},Object.defineProperty(AbstractMesh.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),AbstractMesh.prototype._preActivate=function(){},AbstractMesh.prototype._preActivateForIntermediateRendering=function(renderId){},AbstractMesh.prototype._activate=function(renderId){this._renderId=renderId},AbstractMesh.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():_super.prototype.getWorldMatrix.call(this)},AbstractMesh.prototype.movePOV=function(amountRight,amountUp,amountForward){return this.position.addInPlace(this.calcMovePOV(amountRight,amountUp,amountForward)),this},AbstractMesh.prototype.calcMovePOV=function(amountRight,amountUp,amountForward){var rotMatrix=new BABYLON.Matrix;(this.rotationQuaternion?this.rotationQuaternion:BABYLON.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(rotMatrix);var translationDelta=BABYLON.Vector3.Zero(),defForwardMult=this.definedFacingForward?-1:1;return BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(amountRight*defForwardMult,amountUp,amountForward*defForwardMult,rotMatrix,translationDelta),translationDelta},AbstractMesh.prototype.rotatePOV=function(flipBack,twirlClockwise,tiltRight){return this.rotation.addInPlace(this.calcRotatePOV(flipBack,twirlClockwise,tiltRight)),this},AbstractMesh.prototype.calcRotatePOV=function(flipBack,twirlClockwise,tiltRight){var defForwardMult=this.definedFacingForward?1:-1;return new BABYLON.Vector3(flipBack*defForwardMult,twirlClockwise,tiltRight*defForwardMult)},AbstractMesh.prototype.getHierarchyBoundingVectors=function(includeDescendants){void 0===includeDescendants&&(includeDescendants=!0),this.computeWorldMatrix(!0);var min,max,boundingInfo=this.getBoundingInfo();if(this.subMeshes?(min=boundingInfo.boundingBox.minimumWorld,max=boundingInfo.boundingBox.maximumWorld):(min=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max=new BABYLON.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),includeDescendants)for(var _i=0,descendants_1=this.getDescendants(!1);_i<descendants_1.length;_i++){var childMesh=descendants_1[_i];childMesh.computeWorldMatrix(!0);var childBoundingInfo=childMesh.getBoundingInfo();if(0!==childMesh.getTotalVertices()){var boundingBox=childBoundingInfo.boundingBox,minBox=boundingBox.minimumWorld,maxBox=boundingBox.maximumWorld;BABYLON.Tools.CheckExtends(minBox,min,max),BABYLON.Tools.CheckExtends(maxBox,min,max)}}return{min:min,max:max}},AbstractMesh.prototype._updateBoundingInfo=function(){return this._boundingInfo=this._boundingInfo||new BABYLON.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},AbstractMesh.prototype._updateSubMeshesBoundingInfo=function(matrix){if(!this.subMeshes)return this;for(var subIndex=0;subIndex<this.subMeshes.length;subIndex++){var subMesh=this.subMeshes[subIndex];subMesh.IsGlobal||subMesh.updateBoundingInfo(matrix)}return this},AbstractMesh.prototype._afterComputeWorldMatrix=function(){this._updateBoundingInfo()},AbstractMesh.prototype.isInFrustum=function(frustumPlanes){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(frustumPlanes)},AbstractMesh.prototype.isCompletelyInFrustum=function(frustumPlanes){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(frustumPlanes)},AbstractMesh.prototype.intersectsMesh=function(mesh,precise,includeDescendants){if(void 0===precise&&(precise=!1),!this._boundingInfo||!mesh._boundingInfo)return!1;if(this._boundingInfo.intersects(mesh._boundingInfo,precise))return!0;if(includeDescendants)for(var _i=0,_a=this.getChildMeshes();_i<_a.length;_i++)if(_a[_i].intersectsMesh(mesh,precise,!0))return!0;return!1},AbstractMesh.prototype.intersectsPoint=function(point){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(point)},AbstractMesh.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},AbstractMesh.prototype.getPositionInCameraSpace=function(camera){return void 0===camera&&(camera=null),camera||(camera=this.getScene().activeCamera),BABYLON.Vector3.TransformCoordinates(this.absolutePosition,camera.getViewMatrix())},AbstractMesh.prototype.getDistanceToCamera=function(camera){return void 0===camera&&(camera=null),camera||(camera=this.getScene().activeCamera),this.absolutePosition.subtract(camera.position).length()},AbstractMesh.prototype.applyImpulse=function(force,contactPoint){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(force,contactPoint),this):this},AbstractMesh.prototype.setPhysicsLinkWith=function(otherMesh,pivot1,pivot2,options){return this.physicsImpostor&&otherMesh.physicsImpostor?(this.physicsImpostor.createJoint(otherMesh.physicsImpostor,BABYLON.PhysicsJoint.HingeJoint,{mainPivot:pivot1,connectedPivot:pivot2,nativeParams:options}),this):this},Object.defineProperty(AbstractMesh.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(collisionEnabled){this._checkCollisions=collisionEnabled,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),Object.defineProperty(AbstractMesh.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),AbstractMesh.prototype.moveWithCollisions=function(displacement){return this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._oldPositionForCollisions),this._collider||(this._collider=new BABYLON.Collider),this._collider._radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,displacement,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},AbstractMesh.prototype.createOrUpdateSubmeshesOctree=function(maxCapacity,maxDepth){void 0===maxCapacity&&(maxCapacity=64),void 0===maxDepth&&(maxDepth=2),this._submeshesOctree||(this._submeshesOctree=new BABYLON.Octree(BABYLON.Octree.CreationFuncForSubMeshes,maxCapacity,maxDepth)),this.computeWorldMatrix(!0);var bbox=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(bbox.minimumWorld,bbox.maximumWorld,this.subMeshes),this._submeshesOctree},AbstractMesh.prototype._collideForSubMesh=function(subMesh,transformMatrix,collider){if(this._generatePointsArray(),!this._positions)return this;if(!subMesh._lastColliderWorldVertices||!subMesh._lastColliderTransformMatrix.equals(transformMatrix)){subMesh._lastColliderTransformMatrix=transformMatrix.clone(),subMesh._lastColliderWorldVertices=[],subMesh._trianglePlanes=[];for(var start=subMesh.verticesStart,end=subMesh.verticesStart+subMesh.verticesCount,i=start;i<end;i++)subMesh._lastColliderWorldVertices.push(BABYLON.Vector3.TransformCoordinates(this._positions[i],transformMatrix))}return collider._collide(subMesh._trianglePlanes,subMesh._lastColliderWorldVertices,this.getIndices(),subMesh.indexStart,subMesh.indexStart+subMesh.indexCount,subMesh.verticesStart,!!subMesh.getMaterial()),collider.collisionFound&&(collider.collidedMesh=this),this},AbstractMesh.prototype._processCollisionsForSubMeshes=function(collider,transformMatrix){var subMeshes,len;if(this._submeshesOctree&&this.useOctreeForCollisions){var radius=collider._velocityWorldLength+Math.max(collider._radius.x,collider._radius.y,collider._radius.z),intersections=this._submeshesOctree.intersects(collider._basePointWorld,radius);len=intersections.length,subMeshes=intersections.data}else len=(subMeshes=this.subMeshes).length;for(var index=0;index<len;index++){var subMesh=subMeshes[index];len>1&&!subMesh._checkCollision(collider)||this._collideForSubMesh(subMesh,transformMatrix,collider)}return this},AbstractMesh.prototype._checkCollision=function(collider){return this._boundingInfo&&this._boundingInfo._checkCollision(collider)?(BABYLON.Matrix.ScalingToRef(1/collider._radius.x,1/collider._radius.y,1/collider._radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(collider,this._collisionsTransformMatrix),this):this},AbstractMesh.prototype._generatePointsArray=function(){return!1},AbstractMesh.prototype.intersects=function(ray,fastCheck){var pickingInfo=new BABYLON.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&ray.intersectsSphere(this._boundingInfo.boundingSphere)&&ray.intersectsBox(this._boundingInfo.boundingBox)))return pickingInfo;if(!this._generatePointsArray())return pickingInfo;var subMeshes,len,intersectInfo=null;if(this._submeshesOctree&&this.useOctreeForPicking){var worldRay=BABYLON.Ray.Transform(ray,this.getWorldMatrix()),intersections=this._submeshesOctree.intersectsRay(worldRay);len=intersections.length,subMeshes=intersections.data}else len=(subMeshes=this.subMeshes).length;for(var index=0;index<len;index++){var subMesh=subMeshes[index];if(!(len>1)||subMesh.canIntersects(ray)){var currentIntersectInfo=subMesh.intersects(ray,this._positions,this.getIndices(),fastCheck);if(currentIntersectInfo&&(fastCheck||!intersectInfo||currentIntersectInfo.distance<intersectInfo.distance)&&(intersectInfo=currentIntersectInfo,intersectInfo.subMeshId=index,fastCheck))break}}if(intersectInfo){var world=this.getWorldMatrix(),worldOrigin=BABYLON.Vector3.TransformCoordinates(ray.origin,world),direction=ray.direction.clone();direction=direction.scale(intersectInfo.distance);var worldDirection=BABYLON.Vector3.TransformNormal(direction,world),pickedPoint=worldOrigin.add(worldDirection);return pickingInfo.hit=!0,pickingInfo.distance=BABYLON.Vector3.Distance(worldOrigin,pickedPoint),pickingInfo.pickedPoint=pickedPoint,pickingInfo.pickedMesh=this,pickingInfo.bu=intersectInfo.bu||0,pickingInfo.bv=intersectInfo.bv||0,pickingInfo.faceId=intersectInfo.faceId,pickingInfo.subMeshId=intersectInfo.subMeshId,pickingInfo}return pickingInfo},AbstractMesh.prototype.clone=function(name,newParent,doNotCloneChildren){return null},AbstractMesh.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},AbstractMesh.prototype.dispose=function(doNotRecurse,disposeMaterialAndTextures){var _this=this;void 0===disposeMaterialAndTextures&&(disposeMaterialAndTextures=!1);var index;for(this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this.skeleton=null,this.physicsImpostor&&this.physicsImpostor.dispose(),index=0;index<this._intersectionsInProgress.length;index++){var other=this._intersectionsInProgress[index],pos=other._intersectionsInProgress.indexOf(this);other._intersectionsInProgress.splice(pos,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(light){var meshIndex=light.includedOnlyMeshes.indexOf(_this);-1!==meshIndex&&light.includedOnlyMeshes.splice(meshIndex,1),-1!==(meshIndex=light.excludedMeshes.indexOf(_this))&&light.excludedMeshes.splice(meshIndex,1);var generator=light.getShadowGenerator();if(generator){var shadowMap=generator.getShadowMap();shadowMap&&shadowMap.renderList&&-1!==(meshIndex=shadowMap.renderList.indexOf(_this))&&shadowMap.renderList.splice(meshIndex,1)}}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),"InstancedMesh"!==this.getClassName()&&this.releaseSubMeshes();var sceneOctree=this.getScene().selectionOctree;sceneOctree&&-1!==(index=sceneOctree.dynamicContent.indexOf(this))&&sceneOctree.dynamicContent.splice(index,1);var engine=this.getScene().getEngine();if(this._occlusionQuery&&(this._isOcclusionQueryInProgress=!1,engine.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),engine.wipeCaches(),this.getScene().removeMesh(this),disposeMaterialAndTextures&&this.material&&this.material.dispose(!1,!0),!doNotRecurse)for(index=0;index<this.getScene().particleSystems.length;index++)this.getScene().particleSystems[index].emitter===this&&(this.getScene().particleSystems[index].dispose(),index--);this._facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this._isDisposed=!0,_super.prototype.dispose.call(this,doNotRecurse)},AbstractMesh.prototype.addChild=function(mesh){return mesh.setParent(this),this},AbstractMesh.prototype.removeChild=function(mesh){return mesh.setParent(null),this},AbstractMesh.prototype._initFacetData=function(){this._facetNormals||(this._facetNormals=new Array),this._facetPositions||(this._facetPositions=new Array),this._facetPartitioning||(this._facetPartitioning=new Array),this._facetNb=this.getIndices().length/3|0,this._partitioningSubdivisions=this._partitioningSubdivisions?this._partitioningSubdivisions:10,this._partitioningBBoxRatio=this._partitioningBBoxRatio?this._partitioningBBoxRatio:1.01;for(var f=0;f<this._facetNb;f++)this._facetNormals[f]=BABYLON.Vector3.Zero(),this._facetPositions[f]=BABYLON.Vector3.Zero();return this._facetDataEnabled=!0,this},AbstractMesh.prototype.updateFacetData=function(){this._facetDataEnabled||this._initFacetData();var positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind),indices=this.getIndices(),normals=this.getVerticesData(BABYLON.VertexBuffer.NormalKind),bInfo=this.getBoundingInfo();if(this._facetDepthSort&&!this._facetDepthSortEnabled){if(this._facetDepthSortEnabled=!0,indices instanceof Uint16Array)this._depthSortedIndices=new Uint16Array(indices);else if(indices instanceof Uint32Array)this._depthSortedIndices=new Uint32Array(indices);else{for(var needs32bits=!1,i=0;i<indices.length;i++)if(indices[i]>65535){needs32bits=!0;break}this._depthSortedIndices=needs32bits?new Uint32Array(indices):new Uint16Array(indices)}if(this._facetDepthSortFunction=function(f1,f2){return f2.sqDistance-f1.sqDistance},!this._facetDepthSortFrom){var camera=this.getScene().activeCamera;this._facetDepthSortFrom=camera?camera.position:BABYLON.Vector3.Zero()}this._depthSortedFacets=[];for(f=0;f<this._facetNb;f++){var depthSortedFacet={ind:3*f,sqDistance:0};this._depthSortedFacets.push(depthSortedFacet)}this._invertedMatrix=BABYLON.Matrix.Identity(),this._facetDepthSortOrigin=BABYLON.Vector3.Zero()}this._bbSize.x=bInfo.maximum.x-bInfo.minimum.x>BABYLON.Epsilon?bInfo.maximum.x-bInfo.minimum.x:BABYLON.Epsilon,this._bbSize.y=bInfo.maximum.y-bInfo.minimum.y>BABYLON.Epsilon?bInfo.maximum.y-bInfo.minimum.y:BABYLON.Epsilon,this._bbSize.z=bInfo.maximum.z-bInfo.minimum.z>BABYLON.Epsilon?bInfo.maximum.z-bInfo.minimum.z:BABYLON.Epsilon;var bbSizeMax=this._bbSize.x>this._bbSize.y?this._bbSize.x:this._bbSize.y;if(bbSizeMax=bbSizeMax>this._bbSize.z?bbSizeMax:this._bbSize.z,this._subDiv.max=this._partitioningSubdivisions,this._subDiv.X=Math.floor(this._subDiv.max*this._bbSize.x/bbSizeMax),this._subDiv.Y=Math.floor(this._subDiv.max*this._bbSize.y/bbSizeMax),this._subDiv.Z=Math.floor(this._subDiv.max*this._bbSize.z/bbSizeMax),this._subDiv.X=this._subDiv.X<1?1:this._subDiv.X,this._subDiv.Y=this._subDiv.Y<1?1:this._subDiv.Y,this._subDiv.Z=this._subDiv.Z<1?1:this._subDiv.Z,this._facetParameters.facetNormals=this.getFacetLocalNormals(),this._facetParameters.facetPositions=this.getFacetLocalPositions(),this._facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),this._facetParameters.bInfo=bInfo,this._facetParameters.bbSize=this._bbSize,this._facetParameters.subDiv=this._subDiv,this._facetParameters.ratio=this.partitioningBBoxRatio,this._facetParameters.depthSort=this._facetDepthSort,this._facetDepthSort&&this._facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(this._invertedMatrix),BABYLON.Vector3.TransformCoordinatesToRef(this._facetDepthSortFrom,this._invertedMatrix,this._facetDepthSortOrigin),this._facetParameters.distanceTo=this._facetDepthSortOrigin),this._facetParameters.depthSortedFacets=this._depthSortedFacets,BABYLON.VertexData.ComputeNormals(positions,indices,normals,this._facetParameters),this._facetDepthSort&&this._facetDepthSortEnabled){this._depthSortedFacets.sort(this._facetDepthSortFunction);for(var l=this._depthSortedIndices.length/3|0,f=0;f<l;f++){var sind=this._depthSortedFacets[f].ind;this._depthSortedIndices[3*f]=indices[sind],this._depthSortedIndices[3*f+1]=indices[sind+1],this._depthSortedIndices[3*f+2]=indices[sind+2]}this.updateIndices(this._depthSortedIndices)}return this},AbstractMesh.prototype.getFacetLocalNormals=function(){return this._facetNormals||this.updateFacetData(),this._facetNormals},AbstractMesh.prototype.getFacetLocalPositions=function(){return this._facetPositions||this.updateFacetData(),this._facetPositions},AbstractMesh.prototype.getFacetLocalPartitioning=function(){return this._facetPartitioning||this.updateFacetData(),this._facetPartitioning},AbstractMesh.prototype.getFacetPosition=function(i){var pos=BABYLON.Vector3.Zero();return this.getFacetPositionToRef(i,pos),pos},AbstractMesh.prototype.getFacetPositionToRef=function(i,ref){var localPos=this.getFacetLocalPositions()[i],world=this.getWorldMatrix();return BABYLON.Vector3.TransformCoordinatesToRef(localPos,world,ref),this},AbstractMesh.prototype.getFacetNormal=function(i){var norm=BABYLON.Vector3.Zero();return this.getFacetNormalToRef(i,norm),norm},AbstractMesh.prototype.getFacetNormalToRef=function(i,ref){var localNorm=this.getFacetLocalNormals()[i];return BABYLON.Vector3.TransformNormalToRef(localNorm,this.getWorldMatrix(),ref),this},AbstractMesh.prototype.getFacetsAtLocalCoordinates=function(x,y,z){var bInfo=this.getBoundingInfo(),ox=Math.floor((x-bInfo.minimum.x*this._partitioningBBoxRatio)*this._subDiv.X*this._partitioningBBoxRatio/this._bbSize.x),oy=Math.floor((y-bInfo.minimum.y*this._partitioningBBoxRatio)*this._subDiv.Y*this._partitioningBBoxRatio/this._bbSize.y),oz=Math.floor((z-bInfo.minimum.z*this._partitioningBBoxRatio)*this._subDiv.Z*this._partitioningBBoxRatio/this._bbSize.z);return ox<0||ox>this._subDiv.max||oy<0||oy>this._subDiv.max||oz<0||oz>this._subDiv.max?null:this._facetPartitioning[ox+this._subDiv.max*oy+this._subDiv.max*this._subDiv.max*oz]},AbstractMesh.prototype.getClosestFacetAtCoordinates=function(x,y,z,projected,checkFace,facing){void 0===checkFace&&(checkFace=!1),void 0===facing&&(facing=!0);var world=this.getWorldMatrix(),invMat=BABYLON.Tmp.Matrix[5];world.invertToRef(invMat);var invVect=BABYLON.Tmp.Vector3[8];BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(x,y,z,invMat,invVect);var closest=this.getClosestFacetAtLocalCoordinates(invVect.x,invVect.y,invVect.z,projected,checkFace,facing);return projected&&BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(projected.x,projected.y,projected.z,world,projected),closest},AbstractMesh.prototype.getClosestFacetAtLocalCoordinates=function(x,y,z,projected,checkFace,facing){void 0===checkFace&&(checkFace=!1),void 0===facing&&(facing=!0);var closest=null,tmpx=0,tmpy=0,tmpz=0,d=0,t0=0,projx=0,projy=0,projz=0,facetPositions=this.getFacetLocalPositions(),facetNormals=this.getFacetLocalNormals(),facetsInBlock=this.getFacetsAtLocalCoordinates(x,y,z);if(!facetsInBlock)return null;for(var fib,norm,p0,shortest=Number.MAX_VALUE,tmpDistance=shortest,idx=0;idx<facetsInBlock.length;idx++)norm=facetNormals[fib=facetsInBlock[idx]],d=(x-(p0=facetPositions[fib]).x)*norm.x+(y-p0.y)*norm.y+(z-p0.z)*norm.z,(!checkFace||checkFace&&facing&&d>=0||checkFace&&!facing&&d<=0)&&(d=norm.x*p0.x+norm.y*p0.y+norm.z*p0.z,t0=-(norm.x*x+norm.y*y+norm.z*z-d)/(norm.x*norm.x+norm.y*norm.y+norm.z*norm.z),(tmpDistance=(tmpx=(projx=x+norm.x*t0)-x)*tmpx+(tmpy=(projy=y+norm.y*t0)-y)*tmpy+(tmpz=(projz=z+norm.z*t0)-z)*tmpz)<shortest&&(shortest=tmpDistance,closest=fib,projected&&(projected.x=projx,projected.y=projy,projected.z=projz)));return closest},AbstractMesh.prototype.getFacetDataParameters=function(){return this._facetParameters},AbstractMesh.prototype.disableFacetData=function(){return this._facetDataEnabled&&(this._facetDataEnabled=!1,this._facetPositions=new Array,this._facetNormals=new Array,this._facetPartitioning=new Array,this._facetParameters=null,this._depthSortedIndices=new Uint32Array(0)),this},AbstractMesh.prototype.updateIndices=function(indices){return this},AbstractMesh.prototype.createNormals=function(updatable){var normals,positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind),indices=this.getIndices();normals=this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)?this.getVerticesData(BABYLON.VertexBuffer.NormalKind):[],BABYLON.VertexData.ComputeNormals(positions,indices,normals,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(BABYLON.VertexBuffer.NormalKind,normals,updatable)},AbstractMesh.prototype.alignWithNormal=function(normal,upDirection){upDirection||(upDirection=BABYLON.Axis.Y);var axisX=BABYLON.Tmp.Vector3[0],axisZ=BABYLON.Tmp.Vector3[1];return BABYLON.Vector3.CrossToRef(upDirection,normal,axisZ),BABYLON.Vector3.CrossToRef(normal,axisZ,axisX),this.rotationQuaternion?BABYLON.Quaternion.RotationQuaternionFromAxisToRef(axisX,normal,axisZ,this.rotationQuaternion):BABYLON.Vector3.RotationFromAxisToRef(axisX,normal,axisZ,this.rotation),this},AbstractMesh.prototype.checkOcclusionQuery=function(){var engine=this.getEngine();if(engine.webGLVersion<2||this.occlusionType===AbstractMesh.OCCLUSION_TYPE_NONE)this._isOccluded=!1;else{if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(engine.isQueryResultAvailable(this._occlusionQuery)){var occlusionQueryResult=engine.getQueryResult(this._occlusionQuery);this._isOcclusionQueryInProgress=!1,this._occlusionInternalRetryCounter=0,this._isOccluded=1!==occlusionQueryResult}else{if(this._occlusionInternalRetryCounter++,!(-1!==this.occlusionRetryCount&&this._occlusionInternalRetryCounter>this.occlusionRetryCount))return;this._isOcclusionQueryInProgress=!1,this._occlusionInternalRetryCounter=0,this._isOccluded=this.occlusionType!==AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC&&this._isOccluded}var occlusionBoundingBoxRenderer=this.getScene().getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=engine.createQuery()),engine.beginOcclusionQuery(this.occlusionQueryAlgorithmType,this._occlusionQuery),occlusionBoundingBoxRenderer.renderOcclusionBoundingBox(this),engine.endOcclusionQuery(this.occlusionQueryAlgorithmType),this._isOcclusionQueryInProgress=!0}},AbstractMesh.OCCLUSION_TYPE_NONE=0,AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC=1,AbstractMesh.OCCLUSION_TYPE_STRICT=2,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,AbstractMesh}(BABYLON.TransformNode);BABYLON.AbstractMesh=AbstractMesh}(BABYLON||(BABYLON={}));!function(BABYLON){var Light=function(_super){function Light(name,scene){var _this=_super.call(this,name,scene)||this;return _this.diffuse=new BABYLON.Color3(1,1,1),_this.specular=new BABYLON.Color3(1,1,1),_this.intensity=1,_this.range=Number.MAX_VALUE,_this._photometricScale=1,_this._intensityMode=Light.INTENSITYMODE_AUTOMATIC,_this._radius=1e-5,_this.renderPriority=0,_this.shadowEnabled=!0,_this._excludeWithLayerMask=0,_this._includeOnlyWithLayerMask=0,_this._lightmapMode=0,_this._excludedMeshesIds=new Array,_this._includedOnlyMeshesIds=new Array,_this.getScene().addLight(_this),_this._uniformBuffer=new BABYLON.UniformBuffer(_this.getScene().getEngine()),_this._buildUniformLayout(),_this.includedOnlyMeshes=new Array,_this.excludedMeshes=new Array,_this._resyncMeshes(),_this}return __extends(Light,_super),Object.defineProperty(Light,"LIGHTMAP_DEFAULT",{get:function(){return Light._LIGHTMAP_DEFAULT},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTMAP_SPECULAR",{get:function(){return Light._LIGHTMAP_SPECULAR},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTMAP_SHADOWSONLY",{get:function(){return Light._LIGHTMAP_SHADOWSONLY},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"INTENSITYMODE_AUTOMATIC",{get:function(){return Light._INTENSITYMODE_AUTOMATIC},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"INTENSITYMODE_LUMINOUSPOWER",{get:function(){return Light._INTENSITYMODE_LUMINOUSPOWER},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"INTENSITYMODE_LUMINOUSINTENSITY",{get:function(){return Light._INTENSITYMODE_LUMINOUSINTENSITY},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"INTENSITYMODE_ILLUMINANCE",{get:function(){return Light._INTENSITYMODE_ILLUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"INTENSITYMODE_LUMINANCE",{get:function(){return Light._INTENSITYMODE_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTTYPEID_POINTLIGHT",{get:function(){return Light._LIGHTTYPEID_POINTLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTTYPEID_DIRECTIONALLIGHT",{get:function(){return Light._LIGHTTYPEID_DIRECTIONALLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTTYPEID_SPOTLIGHT",{get:function(){return Light._LIGHTTYPEID_SPOTLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(Light,"LIGHTTYPEID_HEMISPHERICLIGHT",{get:function(){return Light._LIGHTTYPEID_HEMISPHERICLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(value){this._intensityMode=value,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"radius",{get:function(){return this._radius},set:function(value){this._radius=value,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(value){this._includedOnlyMeshes=value,this._hookArrayForIncludedOnly(value)},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(value){this._excludedMeshes=value,this._hookArrayForExcluded(value)},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(value){this._excludeWithLayerMask=value,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(value){this._includeOnlyWithLayerMask=value,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(value){this._lightmapMode!==value&&(this._lightmapMode=value,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Light.prototype._buildUniformLayout=function(){},Light.prototype.getClassName=function(){return"Light"},Light.prototype.toString=function(fullDetails){var ret="Name: "+this.name;if(ret+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)ret+=", animation[0]: "+this.animations[i].toString(fullDetails);return ret},Light.prototype.setEnabled=function(value){_super.prototype.setEnabled.call(this,value),this._resyncMeshes()},Light.prototype.getShadowGenerator=function(){return this._shadowGenerator},Light.prototype.getAbsolutePosition=function(){return BABYLON.Vector3.Zero()},Light.prototype.transferToEffect=function(effect,lightIndex){},Light.prototype._getWorldMatrix=function(){return BABYLON.Matrix.Identity()},Light.prototype.canAffectMesh=function(mesh){return!mesh||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(mesh))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(mesh))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&mesh.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&mesh.layerMask)))},Light.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var worldMatrix=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=BABYLON.Matrix.Identity()),worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):worldMatrix},Light.compareLightsPriority=function(a,b){return a.shadowEnabled!==b.shadowEnabled?(b.shadowEnabled?1:0)-(a.shadowEnabled?1:0):b.renderPriority-a.renderPriority},Light.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var _i=0,_a=this.getScene().meshes;_i<_a.length;_i++)_a[_i]._removeLightSource(this);this._uniformBuffer.dispose(),this.getScene().removeLight(this),_super.prototype.dispose.call(this)},Light.prototype.getTypeID=function(){return 0},Light.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},Light.prototype.clone=function(name){var constructor=Light.GetConstructorFromName(this.getTypeID(),name,this.getScene());return constructor?BABYLON.SerializationHelper.Clone(constructor,this):null},Light.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.type=this.getTypeID(),this.parent&&(serializationObject.parentId=this.parent.id),this.excludedMeshes.length>0&&(serializationObject.excludedMeshesIds=[],this.excludedMeshes.forEach(function(mesh){serializationObject.excludedMeshesIds.push(mesh.id)})),this.includedOnlyMeshes.length>0&&(serializationObject.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(mesh){serializationObject.includedOnlyMeshesIds.push(mesh.id)})),BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject.ranges=this.serializeAnimationRanges(),serializationObject},Light.GetConstructorFromName=function(type,name,scene){switch(type){case 0:return function(){return new BABYLON.PointLight(name,BABYLON.Vector3.Zero(),scene)};case 1:return function(){return new BABYLON.DirectionalLight(name,BABYLON.Vector3.Zero(),scene)};case 2:return function(){return new BABYLON.SpotLight(name,BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),0,0,scene)};case 3:return function(){return new BABYLON.HemisphericLight(name,BABYLON.Vector3.Zero(),scene)}}return null},Light.Parse=function(parsedLight,scene){var constructor=Light.GetConstructorFromName(parsedLight.type,parsedLight.name,scene);if(!constructor)return null;var light=BABYLON.SerializationHelper.Parse(constructor,parsedLight,scene);if(parsedLight.excludedMeshesIds&&(light._excludedMeshesIds=parsedLight.excludedMeshesIds),parsedLight.includedOnlyMeshesIds&&(light._includedOnlyMeshesIds=parsedLight.includedOnlyMeshesIds),parsedLight.parentId&&(light._waitingParentId=parsedLight.parentId),parsedLight.animations){for(var animationIndex=0;animationIndex<parsedLight.animations.length;animationIndex++){var parsedAnimation=parsedLight.animations[animationIndex];light.animations.push(BABYLON.Animation.Parse(parsedAnimation))}BABYLON.Node.ParseAnimationRanges(light,parsedLight,scene)}return parsedLight.autoAnimate&&scene.beginAnimation(light,parsedLight.autoAnimateFrom,parsedLight.autoAnimateTo,parsedLight.autoAnimateLoop,parsedLight.autoAnimateSpeed||1),light},Light.prototype._hookArrayForExcluded=function(array){var _this=this,oldPush=array.push;array.push=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];for(var result=oldPush.apply(array,items),_a=0,items_1=items;_a<items_1.length;_a++)items_1[_a]._resyncLighSource(_this);return result};var oldSplice=array.splice;array.splice=function(index,deleteCount){for(var deleted=oldSplice.apply(array,[index,deleteCount]),_i=0,deleted_1=deleted;_i<deleted_1.length;_i++)deleted_1[_i]._resyncLighSource(_this);return deleted};for(var _i=0,array_1=array;_i<array_1.length;_i++)array_1[_i]._resyncLighSource(this)},Light.prototype._hookArrayForIncludedOnly=function(array){var _this=this,oldPush=array.push;array.push=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var result=oldPush.apply(array,items);return _this._resyncMeshes(),result};var oldSplice=array.splice;array.splice=function(index,deleteCount){var deleted=oldSplice.apply(array,[index,deleteCount]);return _this._resyncMeshes(),deleted},this._resyncMeshes()},Light.prototype._resyncMeshes=function(){for(var _i=0,_a=this.getScene().meshes;_i<_a.length;_i++)_a[_i]._resyncLighSource(this)},Light.prototype._markMeshesAsLightDirty=function(){for(var _i=0,_a=this.getScene().meshes;_i<_a.length;_i++){var mesh=_a[_i];-1!==mesh._lightSources.indexOf(this)&&mesh._markSubMeshesAsLightDirty()}},Light.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},Light.prototype._getPhotometricScale=function(){var photometricScale=0,lightTypeID=this.getTypeID(),photometricMode=this.intensityMode;switch(photometricMode===Light.INTENSITYMODE_AUTOMATIC&&(photometricMode=lightTypeID===Light.LIGHTTYPEID_DIRECTIONALLIGHT?Light.INTENSITYMODE_ILLUMINANCE:Light.INTENSITYMODE_LUMINOUSINTENSITY),lightTypeID){case Light.LIGHTTYPEID_POINTLIGHT:case Light.LIGHTTYPEID_SPOTLIGHT:switch(photometricMode){case Light.INTENSITYMODE_LUMINOUSPOWER:photometricScale=1/(4*Math.PI);break;case Light.INTENSITYMODE_LUMINOUSINTENSITY:photometricScale=1;break;case Light.INTENSITYMODE_LUMINANCE:photometricScale=this.radius*this.radius}break;case Light.LIGHTTYPEID_DIRECTIONALLIGHT:switch(photometricMode){case Light.INTENSITYMODE_ILLUMINANCE:photometricScale=1;break;case Light.INTENSITYMODE_LUMINANCE:var apexAngleRadians=this.radius;apexAngleRadians=Math.max(apexAngleRadians,.001),photometricScale=2*Math.PI*(1-Math.cos(apexAngleRadians))}break;case Light.LIGHTTYPEID_HEMISPHERICLIGHT:photometricScale=1}return photometricScale},Light.prototype._reorderLightsInScene=function(){var scene=this.getScene();0!=this._renderPriority&&(scene.requireLightSorting=!0),this.getScene().sortLightsByPriority()},Light._LIGHTMAP_DEFAULT=0,Light._LIGHTMAP_SPECULAR=1,Light._LIGHTMAP_SHADOWSONLY=2,Light._INTENSITYMODE_AUTOMATIC=0,Light._INTENSITYMODE_LUMINOUSPOWER=1,Light._INTENSITYMODE_LUMINOUSINTENSITY=2,Light._INTENSITYMODE_ILLUMINANCE=3,Light._INTENSITYMODE_LUMINANCE=4,Light._LIGHTTYPEID_POINTLIGHT=0,Light._LIGHTTYPEID_DIRECTIONALLIGHT=1,Light._LIGHTTYPEID_SPOTLIGHT=2,Light._LIGHTTYPEID_HEMISPHERICLIGHT=3,__decorate([BABYLON.serializeAsColor3()],Light.prototype,"diffuse",void 0),__decorate([BABYLON.serializeAsColor3()],Light.prototype,"specular",void 0),__decorate([BABYLON.serialize()],Light.prototype,"intensity",void 0),__decorate([BABYLON.serialize()],Light.prototype,"range",void 0),__decorate([BABYLON.serialize()],Light.prototype,"intensityMode",null),__decorate([BABYLON.serialize()],Light.prototype,"radius",null),__decorate([BABYLON.serialize()],Light.prototype,"_renderPriority",void 0),__decorate([BABYLON.expandToProperty("_reorderLightsInScene")],Light.prototype,"renderPriority",void 0),__decorate([BABYLON.serialize()],Light.prototype,"shadowEnabled",void 0),__decorate([BABYLON.serialize("excludeWithLayerMask")],Light.prototype,"_excludeWithLayerMask",void 0),__decorate([BABYLON.serialize("includeOnlyWithLayerMask")],Light.prototype,"_includeOnlyWithLayerMask",void 0),__decorate([BABYLON.serialize("lightmapMode")],Light.prototype,"_lightmapMode",void 0),Light}(BABYLON.Node);BABYLON.Light=Light}(BABYLON||(BABYLON={}));!function(BABYLON){var Camera=function(_super){function Camera(name,position,scene){var _this=_super.call(this,name,scene)||this;return _this.upVector=BABYLON.Vector3.Up(),_this.orthoLeft=null,_this.orthoRight=null,_this.orthoBottom=null,_this.orthoTop=null,_this.fov=.8,_this.minZ=1,_this.maxZ=1e4,_this.inertia=.9,_this.mode=Camera.PERSPECTIVE_CAMERA,_this.isIntermediate=!1,_this.viewport=new BABYLON.Viewport(0,0,1,1),_this.layerMask=268435455,_this.fovMode=Camera.FOVMODE_VERTICAL_FIXED,_this.autoClear=!0,_this.cameraRigMode=Camera.RIG_MODE_NONE,_this._rigCameras=new Array,_this._webvrViewMatrix=BABYLON.Matrix.Identity(),_this._skipRendering=!1,_this.customRenderTargets=new Array,_this.onViewMatrixChangedObservable=new BABYLON.Observable,_this.onProjectionMatrixChangedObservable=new BABYLON.Observable,_this.onAfterCheckInputsObservable=new BABYLON.Observable,_this.onRestoreStateObservable=new BABYLON.Observable,_this._computedViewMatrix=BABYLON.Matrix.Identity(),_this._projectionMatrix=new BABYLON.Matrix,_this._doNotComputeProjectionMatrix=!1,_this._postProcesses=new Array,_this._transformMatrix=BABYLON.Matrix.Zero(),_this._activeMeshes=new BABYLON.SmartArray(256),_this._globalPosition=BABYLON.Vector3.Zero(),_this._refreshFrustumPlanes=!0,_this.getScene().addCamera(_this),_this.getScene().activeCamera||(_this.getScene().activeCamera=_this),_this.position=position,_this}return __extends(Camera,_super),Object.defineProperty(Camera,"PERSPECTIVE_CAMERA",{get:function(){return Camera._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"ORTHOGRAPHIC_CAMERA",{get:function(){return Camera._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"FOVMODE_VERTICAL_FIXED",{get:function(){return Camera._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return Camera._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_NONE",{get:function(){return Camera._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return Camera._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return Camera._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return Camera._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return Camera._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_VR",{get:function(){return Camera._RIG_MODE_VR},enumerable:!0,configurable:!0}),Object.defineProperty(Camera,"RIG_MODE_WEBVR",{get:function(){return Camera._RIG_MODE_WEBVR},enumerable:!0,configurable:!0}),Camera.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},Camera.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},Camera.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},Camera.prototype.getClassName=function(){return"Camera"},Camera.prototype.toString=function(fullDetails){var ret="Name: "+this.name;if(ret+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)ret+=", animation[0]: "+this.animations[i].toString(fullDetails);return ret},Object.defineProperty(Camera.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),Camera.prototype.getActiveMeshes=function(){return this._activeMeshes},Camera.prototype.isActiveMesh=function(mesh){return-1!==this._activeMeshes.indexOf(mesh)},Camera.prototype._initCache=function(){_super.prototype._initCache.call(this),this._cache.position=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},Camera.prototype._updateCache=function(ignoreParentClass){ignoreParentClass||_super.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},Camera.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},Camera.prototype._isSynchronizedViewMatrix=function(){return!!_super.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},Camera.prototype._isSynchronizedProjectionMatrix=function(){var check=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!check)return!1;var engine=this.getEngine();return check=this.mode===Camera.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===engine.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===engine.getRenderWidth()&&this._cache.renderHeight===engine.getRenderHeight()},Camera.prototype.attachControl=function(element,noPreventDefault){},Camera.prototype.detachControl=function(element){},Camera.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==Camera.RIG_MODE_NONE&&this._updateRigCameras()},Camera.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(Camera.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),Camera.prototype._cascadePostProcessesToRigCams=function(){this._postProcesses.length>0&&this._postProcesses[0].markTextureDirty();for(var i=0,len=this._rigCameras.length;i<len;i++){var cam=this._rigCameras[i],rigPostProcess=cam._rigPostProcess;rigPostProcess?(rigPostProcess instanceof BABYLON.PassPostProcess&&(cam.isIntermediate=0===this._postProcesses.length),cam._postProcesses=this._postProcesses.slice(0).concat(rigPostProcess),rigPostProcess.markTextureDirty()):cam._postProcesses=this._postProcesses.slice(0)}},Camera.prototype.attachPostProcess=function(postProcess,insertAt){return void 0===insertAt&&(insertAt=null),!postProcess.isReusable()&&this._postProcesses.indexOf(postProcess)>-1?(BABYLON.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==insertAt||insertAt<0?this._postProcesses.push(postProcess):this._postProcesses.splice(insertAt,0,postProcess),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(postProcess))},Camera.prototype.detachPostProcess=function(postProcess){var idx=this._postProcesses.indexOf(postProcess);-1!==idx&&this._postProcesses.splice(idx,1),this._cascadePostProcessesToRigCams()},Camera.prototype.getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=BABYLON.Matrix.Identity()),this.getViewMatrix().invertToRef(this._worldMatrix),this._worldMatrix},Camera.prototype._getViewMatrix=function(){return BABYLON.Matrix.Identity()},Camera.prototype.getViewMatrix=function(force){return!force&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._refreshFrustumPlanes=!0,this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=BABYLON.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix)},Camera.prototype.freezeProjectionMatrix=function(projection){this._doNotComputeProjectionMatrix=!0,void 0!==projection&&(this._projectionMatrix=projection)},Camera.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},Camera.prototype.getProjectionMatrix=function(force){if(this._doNotComputeProjectionMatrix||!force&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var engine=this.getEngine(),scene=this.getScene();if(this.mode===Camera.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=engine.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),scene.useRightHandedSystem?BABYLON.Matrix.PerspectiveFovRHToRef(this.fov,engine.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===Camera.FOVMODE_VERTICAL_FIXED):BABYLON.Matrix.PerspectiveFovLHToRef(this.fov,engine.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===Camera.FOVMODE_VERTICAL_FIXED);else{var halfWidth=engine.getRenderWidth()/2,halfHeight=engine.getRenderHeight()/2;scene.useRightHandedSystem?BABYLON.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-halfWidth,this.orthoRight||halfWidth,this.orthoBottom||-halfHeight,this.orthoTop||halfHeight,this.minZ,this.maxZ,this._projectionMatrix):BABYLON.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-halfWidth,this.orthoRight||halfWidth,this.orthoBottom||-halfHeight,this.orthoTop||halfHeight,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=engine.getRenderWidth(),this._cache.renderHeight=engine.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},Camera.prototype.getTranformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},Camera.prototype.updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTranformationMatrix(),this._frustumPlanes?BABYLON.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=BABYLON.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},Camera.prototype.isInFrustum=function(target){return this.updateFrustumPlanes(),target.isInFrustum(this._frustumPlanes)},Camera.prototype.isCompletelyInFrustum=function(target){return this.updateFrustumPlanes(),target.isCompletelyInFrustum(this._frustumPlanes)},Camera.prototype.getForwardRay=function(length,transform,origin){void 0===length&&(length=100),transform||(transform=this.getWorldMatrix()),origin||(origin=this.position);var forward=new BABYLON.Vector3(0,0,1),forwardWorld=BABYLON.Vector3.TransformNormal(forward,transform),direction=BABYLON.Vector3.Normalize(forwardWorld);return new BABYLON.Ray(origin,direction,length)},Camera.prototype.dispose=function(){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var camera=this._rigCameras.pop();camera&&camera.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==Camera.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(i=this._postProcesses.length;--i>=0;)this._postProcesses[i].dispose(this);for(var i=this.customRenderTargets.length;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),_super.prototype.dispose.call(this)},Object.defineProperty(Camera.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),Camera.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},Camera.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},Camera.prototype.setCameraRigMode=function(mode,rigParams){if(this.cameraRigMode!==mode){for(;this._rigCameras.length>0;){var camera=this._rigCameras.pop();camera&&camera.dispose()}if(this.cameraRigMode=mode,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=rigParams.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=BABYLON.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==Camera.RIG_MODE_NONE){var leftCamera=this.createRigCamera(this.name+"_L",0),rightCamera=this.createRigCamera(this.name+"_R",1);leftCamera&&rightCamera&&(this._rigCameras.push(leftCamera),this._rigCameras.push(rightCamera))}switch(this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new BABYLON.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new BABYLON.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var isStereoscopicHoriz=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new BABYLON.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new BABYLON.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,isStereoscopicHoriz);break;case Camera.RIG_MODE_VR:var metrics=rigParams.vrCameraMetrics||BABYLON.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=metrics,this._rigCameras[0].viewport=new BABYLON.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new BABYLON.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=metrics.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=metrics.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=metrics,this._rigCameras[1].viewport=new BABYLON.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new BABYLON.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=metrics.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=metrics.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,metrics.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new BABYLON.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,metrics),this._rigCameras[1]._rigPostProcess=new BABYLON.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,metrics));break;case Camera.RIG_MODE_WEBVR:if(rigParams.vrDisplay){var leftEye=rigParams.vrDisplay.getEyeParameters("left"),rightEye=rigParams.vrDisplay.getEyeParameters("right");this._rigCameras[0].viewport=new BABYLON.Viewport(0,0,.5,1),this._rigCameras[0].setCameraRigParameter("left",!0),this._rigCameras[0].setCameraRigParameter("specs",rigParams.specs),this._rigCameras[0].setCameraRigParameter("eyeParameters",leftEye),this._rigCameras[0].setCameraRigParameter("frameData",rigParams.frameData),this._rigCameras[0].setCameraRigParameter("parentCamera",rigParams.parentCamera),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new BABYLON.Matrix,this._rigCameras[0].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[0].parent=this,this._rigCameras[0]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[1].viewport=new BABYLON.Viewport(.5,0,.5,1),this._rigCameras[1].setCameraRigParameter("eyeParameters",rightEye),this._rigCameras[1].setCameraRigParameter("specs",rigParams.specs),this._rigCameras[1].setCameraRigParameter("frameData",rigParams.frameData),this._rigCameras[1].setCameraRigParameter("parentCamera",rigParams.parentCamera),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new BABYLON.Matrix,this._rigCameras[1].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[1].parent=this,this._rigCameras[1]._getViewMatrix=this._getWebVRViewMatrix,Camera.UseAlternateWebVRRendering&&(this._rigCameras[1]._skipRendering=!0,this._rigCameras[0]._alternateCamera=this._rigCameras[1])}}this._cascadePostProcessesToRigCams(),this.update()}},Camera.prototype._getVRProjectionMatrix=function(){return BABYLON.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},Camera.prototype._updateCameraRotationMatrix=function(){},Camera.prototype._updateWebVRCameraRotationMatrix=function(){},Camera.prototype._getWebVRProjectionMatrix=function(){return BABYLON.Matrix.Identity()},Camera.prototype._getWebVRViewMatrix=function(){return BABYLON.Matrix.Identity()},Camera.prototype.setCameraRigParameter=function(name,value){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[name]=value,"interaxialDistance"===name&&(this._cameraRigParams.stereoHalfAngle=BABYLON.Tools.ToRadians(value/.0637))},Camera.prototype.createRigCamera=function(name,cameraIndex){return null},Camera.prototype._updateRigCameras=function(){for(var i=0;i<this._rigCameras.length;i++)this._rigCameras[i].minZ=this.minZ,this._rigCameras[i].maxZ=this.maxZ,this._rigCameras[i].fov=this.fov;this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},Camera.prototype._setupInputs=function(){},Camera.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.type=this.getClassName(),this.parent&&(serializationObject.parentId=this.parent.id),this.inputs&&this.inputs.serialize(serializationObject),BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject.ranges=this.serializeAnimationRanges(),serializationObject},Camera.prototype.clone=function(name){return BABYLON.SerializationHelper.Clone(Camera.GetConstructorFromName(this.getClassName(),name,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},Camera.prototype.getDirection=function(localAxis){var result=BABYLON.Vector3.Zero();return this.getDirectionToRef(localAxis,result),result},Camera.prototype.getDirectionToRef=function(localAxis,result){BABYLON.Vector3.TransformNormalToRef(localAxis,this.getWorldMatrix(),result)},Camera.GetConstructorFromName=function(type,name,scene,interaxial_distance,isStereoscopicSideBySide){switch(void 0===interaxial_distance&&(interaxial_distance=0),void 0===isStereoscopicSideBySide&&(isStereoscopicSideBySide=!0),type){case"ArcRotateCamera":return function(){return new BABYLON.ArcRotateCamera(name,0,0,1,BABYLON.Vector3.Zero(),scene)};case"DeviceOrientationCamera":return function(){return new BABYLON.DeviceOrientationCamera(name,BABYLON.Vector3.Zero(),scene)};case"FollowCamera":return function(){return new BABYLON.FollowCamera(name,BABYLON.Vector3.Zero(),scene)};case"ArcFollowCamera":return function(){return new BABYLON.ArcFollowCamera(name,0,0,1,null,scene)};case"GamepadCamera":return function(){return new BABYLON.GamepadCamera(name,BABYLON.Vector3.Zero(),scene)};case"TouchCamera":return function(){return new BABYLON.TouchCamera(name,BABYLON.Vector3.Zero(),scene)};case"VirtualJoysticksCamera":return function(){return new BABYLON.VirtualJoysticksCamera(name,BABYLON.Vector3.Zero(),scene)};case"WebVRFreeCamera":case"WebVRGamepadCamera":return function(){return new BABYLON.WebVRFreeCamera(name,BABYLON.Vector3.Zero(),scene)};case"VRDeviceOrientationFreeCamera":return function(){return new BABYLON.VRDeviceOrientationFreeCamera(name,BABYLON.Vector3.Zero(),scene)};case"VRDeviceOrientationGamepadCamera":return function(){return new BABYLON.VRDeviceOrientationGamepadCamera(name,BABYLON.Vector3.Zero(),scene)};case"AnaglyphArcRotateCamera":return function(){return new BABYLON.AnaglyphArcRotateCamera(name,0,0,1,BABYLON.Vector3.Zero(),interaxial_distance,scene)};case"AnaglyphFreeCamera":return function(){return new BABYLON.AnaglyphFreeCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,scene)};case"AnaglyphGamepadCamera":return function(){return new BABYLON.AnaglyphGamepadCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,scene)};case"AnaglyphUniversalCamera":return function(){return new BABYLON.AnaglyphUniversalCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,scene)};case"StereoscopicArcRotateCamera":return function(){return new BABYLON.StereoscopicArcRotateCamera(name,0,0,1,BABYLON.Vector3.Zero(),interaxial_distance,isStereoscopicSideBySide,scene)};case"StereoscopicFreeCamera":return function(){return new BABYLON.StereoscopicFreeCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,isStereoscopicSideBySide,scene)};case"StereoscopicGamepadCamera":return function(){return new BABYLON.StereoscopicGamepadCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,isStereoscopicSideBySide,scene)};case"StereoscopicUniversalCamera":return function(){return new BABYLON.StereoscopicUniversalCamera(name,BABYLON.Vector3.Zero(),interaxial_distance,isStereoscopicSideBySide,scene)};case"FreeCamera":default:return function(){return new BABYLON.UniversalCamera(name,BABYLON.Vector3.Zero(),scene)}}},Camera.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},Camera.Parse=function(parsedCamera,scene){var type=parsedCamera.type,construct=Camera.GetConstructorFromName(type,parsedCamera.name,scene,parsedCamera.interaxial_distance,parsedCamera.isStereoscopicSideBySide),camera=BABYLON.SerializationHelper.Parse(construct,parsedCamera,scene);if(parsedCamera.parentId&&(camera._waitingParentId=parsedCamera.parentId),camera.inputs&&(camera.inputs.parse(parsedCamera),camera._setupInputs()),camera.setPosition&&(camera.position.copyFromFloats(0,0,0),camera.setPosition(BABYLON.Vector3.FromArray(parsedCamera.position))),parsedCamera.target&&camera.setTarget&&camera.setTarget(BABYLON.Vector3.FromArray(parsedCamera.target)),parsedCamera.cameraRigMode){var rigParams=parsedCamera.interaxial_distance?{interaxialDistance:parsedCamera.interaxial_distance}:{};camera.setCameraRigMode(parsedCamera.cameraRigMode,rigParams)}if(parsedCamera.animations){for(var animationIndex=0;animationIndex<parsedCamera.animations.length;animationIndex++){var parsedAnimation=parsedCamera.animations[animationIndex];camera.animations.push(BABYLON.Animation.Parse(parsedAnimation))}BABYLON.Node.ParseAnimationRanges(camera,parsedCamera,scene)}return parsedCamera.autoAnimate&&scene.beginAnimation(camera,parsedCamera.autoAnimateFrom,parsedCamera.autoAnimateTo,parsedCamera.autoAnimateLoop,parsedCamera.autoAnimateSpeed||1),camera},Camera._PERSPECTIVE_CAMERA=0,Camera._ORTHOGRAPHIC_CAMERA=1,Camera._FOVMODE_VERTICAL_FIXED=0,Camera._FOVMODE_HORIZONTAL_FIXED=1,Camera._RIG_MODE_NONE=0,Camera._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Camera._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Camera._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Camera._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Camera._RIG_MODE_VR=20,Camera._RIG_MODE_WEBVR=21,Camera.ForceAttachControlToAlwaysPreventDefault=!1,Camera.UseAlternateWebVRRendering=!1,__decorate([BABYLON.serializeAsVector3()],Camera.prototype,"position",void 0),__decorate([BABYLON.serializeAsVector3()],Camera.prototype,"upVector",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"orthoLeft",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"orthoRight",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"orthoBottom",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"orthoTop",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"fov",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"minZ",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"maxZ",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"inertia",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"mode",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"layerMask",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"fovMode",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"cameraRigMode",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"interaxialDistance",void 0),__decorate([BABYLON.serialize()],Camera.prototype,"isStereoscopicSideBySide",void 0),Camera}(BABYLON.Node);BABYLON.Camera=Camera}(BABYLON||(BABYLON={}));!function(BABYLON){var RenderingManager=function(){function RenderingManager(scene){this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderinGroupInfo=null,this._scene=scene;for(var i=RenderingManager.MIN_RENDERINGGROUPS;i<RenderingManager.MAX_RENDERINGGROUPS;i++)this._autoClearDepthStencil[i]={autoClear:!0,depth:!0,stencil:!0}}return RenderingManager.prototype._clearDepthStencilBuffer=function(depth,stencil){void 0===depth&&(depth=!0),void 0===stencil&&(stencil=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,depth,stencil),this._depthStencilBufferAlreadyCleaned=!0)},RenderingManager.prototype.render=function(customRenderFunction,activeMeshes,renderParticles,renderSprites){var observable=this._scene.onRenderingGroupObservable.hasObservers()?this._scene.onRenderingGroupObservable:null,info=null;if(observable&&(this._renderinGroupInfo||(this._renderinGroupInfo=new BABYLON.RenderingGroupInfo),(info=this._renderinGroupInfo).scene=this._scene,info.camera=this._scene.activeCamera),renderSprites)for(index=0;index<this._scene.spriteManagers.length;index++){var manager=this._scene.spriteManagers[index];this.dispatchSprites(manager)}for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){this._depthStencilBufferAlreadyCleaned=index===RenderingManager.MIN_RENDERINGGROUPS;var renderingGroup=this._renderingGroups[index];if(renderingGroup||observable){var renderingGroupMask=0;if(observable&&info&&(renderingGroupMask=Math.pow(2,index),info.renderStage=BABYLON.RenderingGroupInfo.STAGE_PRECLEAR,info.renderingGroupId=index,observable.notifyObservers(info,renderingGroupMask)),RenderingManager.AUTOCLEAR){var autoClear=this._autoClearDepthStencil[index];autoClear&&autoClear.autoClear&&this._clearDepthStencilBuffer(autoClear.depth,autoClear.stencil)}observable&&info&&(info.renderStage=BABYLON.RenderingGroupInfo.STAGE_PREOPAQUE,observable.notifyObservers(info,renderingGroupMask),info.renderStage=BABYLON.RenderingGroupInfo.STAGE_PRETRANSPARENT,observable.notifyObservers(info,renderingGroupMask)),renderingGroup&&renderingGroup.render(customRenderFunction,renderSprites,renderParticles,activeMeshes),observable&&info&&(info.renderStage=BABYLON.RenderingGroupInfo.STAGE_POSTTRANSPARENT,observable.notifyObservers(info,renderingGroupMask))}}},RenderingManager.prototype.reset=function(){for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){var renderingGroup=this._renderingGroups[index];renderingGroup&&renderingGroup.prepare()}},RenderingManager.prototype.dispose=function(){for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){var renderingGroup=this._renderingGroups[index];renderingGroup&&renderingGroup.dispose()}this._renderingGroups.length=0},RenderingManager.prototype._prepareRenderingGroup=function(renderingGroupId){this._renderingGroups[renderingGroupId]||(this._renderingGroups[renderingGroupId]=new BABYLON.RenderingGroup(renderingGroupId,this._scene,this._customOpaqueSortCompareFn[renderingGroupId],this._customAlphaTestSortCompareFn[renderingGroupId],this._customTransparentSortCompareFn[renderingGroupId]))},RenderingManager.prototype.dispatchSprites=function(spriteManager){var renderingGroupId=spriteManager.renderingGroupId||0;this._prepareRenderingGroup(renderingGroupId),this._renderingGroups[renderingGroupId].dispatchSprites(spriteManager)},RenderingManager.prototype.dispatchParticles=function(particleSystem){var renderingGroupId=particleSystem.renderingGroupId||0;this._prepareRenderingGroup(renderingGroupId),this._renderingGroups[renderingGroupId].dispatchParticles(particleSystem)},RenderingManager.prototype.dispatch=function(subMesh){var renderingGroupId=subMesh.getMesh().renderingGroupId||0;this._prepareRenderingGroup(renderingGroupId),this._renderingGroups[renderingGroupId].dispatch(subMesh)},RenderingManager.prototype.setRenderingOrder=function(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn){if(void 0===opaqueSortCompareFn&&(opaqueSortCompareFn=null),void 0===alphaTestSortCompareFn&&(alphaTestSortCompareFn=null),void 0===transparentSortCompareFn&&(transparentSortCompareFn=null),this._customOpaqueSortCompareFn[renderingGroupId]=opaqueSortCompareFn,this._customAlphaTestSortCompareFn[renderingGroupId]=alphaTestSortCompareFn,this._customTransparentSortCompareFn[renderingGroupId]=transparentSortCompareFn,this._renderingGroups[renderingGroupId]){var group=this._renderingGroups[renderingGroupId];group.opaqueSortCompareFn=this._customOpaqueSortCompareFn[renderingGroupId],group.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[renderingGroupId],group.transparentSortCompareFn=this._customTransparentSortCompareFn[renderingGroupId]}},RenderingManager.prototype.setRenderingAutoClearDepthStencil=function(renderingGroupId,autoClearDepthStencil,depth,stencil){void 0===depth&&(depth=!0),void 0===stencil&&(stencil=!0),this._autoClearDepthStencil[renderingGroupId]={autoClear:autoClearDepthStencil,depth:depth,stencil:stencil}},RenderingManager.MAX_RENDERINGGROUPS=4,RenderingManager.MIN_RENDERINGGROUPS=0,RenderingManager.AUTOCLEAR=!0,RenderingManager}();BABYLON.RenderingManager=RenderingManager}(BABYLON||(BABYLON={}));!function(BABYLON){var RenderingGroup=function(){function RenderingGroup(index,scene,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn){void 0===opaqueSortCompareFn&&(opaqueSortCompareFn=null),void 0===alphaTestSortCompareFn&&(alphaTestSortCompareFn=null),void 0===transparentSortCompareFn&&(transparentSortCompareFn=null),this.index=index,this._opaqueSubMeshes=new BABYLON.SmartArray(256),this._transparentSubMeshes=new BABYLON.SmartArray(256),this._alphaTestSubMeshes=new BABYLON.SmartArray(256),this._depthOnlySubMeshes=new BABYLON.SmartArray(256),this._particleSystems=new BABYLON.SmartArray(256),this._spriteManagers=new BABYLON.SmartArray(256),this._edgesRenderers=new BABYLON.SmartArray(16),this._scene=scene,this.opaqueSortCompareFn=opaqueSortCompareFn,this.alphaTestSortCompareFn=alphaTestSortCompareFn,this.transparentSortCompareFn=transparentSortCompareFn}return Object.defineProperty(RenderingGroup.prototype,"opaqueSortCompareFn",{set:function(value){this._opaqueSortCompareFn=value,this._renderOpaque=value?this.renderOpaqueSorted:RenderingGroup.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(RenderingGroup.prototype,"alphaTestSortCompareFn",{set:function(value){this._alphaTestSortCompareFn=value,this._renderAlphaTest=value?this.renderAlphaTestSorted:RenderingGroup.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(RenderingGroup.prototype,"transparentSortCompareFn",{set:function(value){this._transparentSortCompareFn=value||RenderingGroup.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),RenderingGroup.prototype.render=function(customRenderFunction,renderSprites,renderParticles,activeMeshes){if(customRenderFunction)customRenderFunction(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var engine=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(engine.setAlphaTesting(!0),engine.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),engine.setAlphaTesting(!1),engine.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&(engine.setAlphaTesting(!0),this._renderAlphaTest(this._alphaTestSubMeshes),engine.setAlphaTesting(!1));var stencilState=engine.getStencilBuffer();engine.setStencilBuffer(!1),renderSprites&&this._renderSprites(),renderParticles&&this._renderParticles(activeMeshes),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE)),engine.setStencilBuffer(!1);for(var edgesRendererIndex=0;edgesRendererIndex<this._edgesRenderers.length;edgesRendererIndex++)this._edgesRenderers.data[edgesRendererIndex].render();engine.setStencilBuffer(stencilState)}},RenderingGroup.prototype.renderOpaqueSorted=function(subMeshes){return RenderingGroup.renderSorted(subMeshes,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},RenderingGroup.prototype.renderAlphaTestSorted=function(subMeshes){return RenderingGroup.renderSorted(subMeshes,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},RenderingGroup.prototype.renderTransparentSorted=function(subMeshes){return RenderingGroup.renderSorted(subMeshes,this._transparentSortCompareFn,this._scene.activeCamera,!0)},RenderingGroup.renderSorted=function(subMeshes,sortCompareFn,camera,transparent){for(var subMesh,subIndex=0,cameraPosition=camera?camera.globalPosition:BABYLON.Vector3.Zero();subIndex<subMeshes.length;subIndex++)(subMesh=subMeshes.data[subIndex])._alphaIndex=subMesh.getMesh().alphaIndex,subMesh._distanceToCamera=subMesh.getBoundingInfo().boundingSphere.centerWorld.subtract(cameraPosition).length();var sortedArray=subMeshes.data.slice(0,subMeshes.length);for(sortCompareFn&&sortedArray.sort(sortCompareFn),subIndex=0;subIndex<sortedArray.length;subIndex++){if(subMesh=sortedArray[subIndex],transparent){var material=subMesh.getMaterial();if(material&&material.needDepthPrePass){var engine=material.getScene().getEngine();engine.setColorWrite(!1),engine.setAlphaTesting(!0),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE),subMesh.render(!1),engine.setAlphaTesting(!1),engine.setColorWrite(!0)}}subMesh.render(transparent)}},RenderingGroup.renderUnsorted=function(subMeshes){for(var subIndex=0;subIndex<subMeshes.length;subIndex++)subMeshes.data[subIndex].render(!1)},RenderingGroup.defaultTransparentSortCompare=function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<b._alphaIndex?-1:RenderingGroup.backToFrontSortCompare(a,b)},RenderingGroup.backToFrontSortCompare=function(a,b){return a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0},RenderingGroup.frontToBackSortCompare=function(a,b){return a._distanceToCamera<b._distanceToCamera?-1:a._distanceToCamera>b._distanceToCamera?1:0},RenderingGroup.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},RenderingGroup.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},RenderingGroup.prototype.dispatch=function(subMesh){var material=subMesh.getMaterial(),mesh=subMesh.getMesh();material&&(material.needAlphaBlendingForMesh(mesh)?this._transparentSubMeshes.push(subMesh):material.needAlphaTesting()?(material.needDepthPrePass&&this._depthOnlySubMeshes.push(subMesh),this._alphaTestSubMeshes.push(subMesh)):(material.needDepthPrePass&&this._depthOnlySubMeshes.push(subMesh),this._opaqueSubMeshes.push(subMesh)),mesh._edgesRenderer&&this._edgesRenderers.push(mesh._edgesRenderer))},RenderingGroup.prototype.dispatchSprites=function(spriteManager){this._spriteManagers.push(spriteManager)},RenderingGroup.prototype.dispatchParticles=function(particleSystem){this._particleSystems.push(particleSystem)},RenderingGroup.prototype._renderParticles=function(activeMeshes){if(0!==this._particleSystems.length){var activeCamera=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var particleIndex=0;particleIndex<this._scene._activeParticleSystems.length;particleIndex++){var particleSystem=this._scene._activeParticleSystems.data[particleIndex];if(0!==(activeCamera&&activeCamera.layerMask&particleSystem.layerMask)){var emitter=particleSystem.emitter;emitter.position&&activeMeshes&&-1===activeMeshes.indexOf(emitter)||this._scene._activeParticles.addCount(particleSystem.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},RenderingGroup.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var activeCamera=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var id=0;id<this._spriteManagers.length;id++){var spriteManager=this._spriteManagers.data[id];0!==(activeCamera&&activeCamera.layerMask&spriteManager.layerMask)&&spriteManager.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},RenderingGroup}();BABYLON.RenderingGroup=RenderingGroup}(BABYLON||(BABYLON={}));!function(BABYLON){var ClickInfo=function(){function ClickInfo(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(ClickInfo.prototype,"singleClick",{get:function(){return this._singleClick},set:function(b){this._singleClick=b},enumerable:!0,configurable:!0}),Object.defineProperty(ClickInfo.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(b){this._doubleClick=b},enumerable:!0,configurable:!0}),Object.defineProperty(ClickInfo.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(b){this._hasSwiped=b},enumerable:!0,configurable:!0}),Object.defineProperty(ClickInfo.prototype,"ignore",{get:function(){return this._ignore},set:function(b){this._ignore=b},enumerable:!0,configurable:!0}),ClickInfo}(),RenderingGroupInfo=function(){function RenderingGroupInfo(){}return RenderingGroupInfo.STAGE_PRECLEAR=1,RenderingGroupInfo.STAGE_PREOPAQUE=2,RenderingGroupInfo.STAGE_PRETRANSPARENT=3,RenderingGroupInfo.STAGE_POSTTRANSPARENT=4,RenderingGroupInfo}();BABYLON.RenderingGroupInfo=RenderingGroupInfo;var Scene=function(){function Scene(engine){this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new BABYLON.Color4(.2,.2,.3,1),this.ambientColor=new BABYLON.Color3(0,0,0),this.forceWireframe=!1,this._forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.preventDefaultOnPointerDown=!0,this.metadata=null,this.onDisposeObservable=new BABYLON.Observable,this.onBeforeRenderObservable=new BABYLON.Observable,this.onAfterRenderObservable=new BABYLON.Observable,this.onBeforeAnimationsObservable=new BABYLON.Observable,this.onAfterAnimationsObservable=new BABYLON.Observable,this.onBeforeDrawPhaseObservable=new BABYLON.Observable,this.onAfterDrawPhaseObservable=new BABYLON.Observable,this.onBeforePhysicsObservable=new BABYLON.Observable,this.onAfterPhysicsObservable=new BABYLON.Observable,this.onReadyObservable=new BABYLON.Observable,this.onBeforeCameraRenderObservable=new BABYLON.Observable,this.onAfterCameraRenderObservable=new BABYLON.Observable,this.onBeforeActiveMeshesEvaluationObservable=new BABYLON.Observable,this.onAfterActiveMeshesEvaluationObservable=new BABYLON.Observable,this.onBeforeParticlesRenderingObservable=new BABYLON.Observable,this.onAfterParticlesRenderingObservable=new BABYLON.Observable,this.onBeforeSpritesRenderingObservable=new BABYLON.Observable,this.onAfterSpritesRenderingObservable=new BABYLON.Observable,this.onDataLoadedObservable=new BABYLON.Observable,this.onNewCameraAddedObservable=new BABYLON.Observable,this.onCameraRemovedObservable=new BABYLON.Observable,this.onNewLightAddedObservable=new BABYLON.Observable,this.onLightRemovedObservable=new BABYLON.Observable,this.onNewGeometryAddedObservable=new BABYLON.Observable,this.onGeometryRemovedObservable=new BABYLON.Observable,this.onNewTransformNodeAddedObservable=new BABYLON.Observable,this.onTransformNodeRemovedObservable=new BABYLON.Observable,this.onNewMeshAddedObservable=new BABYLON.Observable,this.onMeshRemovedObservable=new BABYLON.Observable,this.OnBeforeRenderTargetsRenderObservable=new BABYLON.Observable,this.OnAfterRenderTargetsRenderObservable=new BABYLON.Observable,this.onBeforeStepObservable=new BABYLON.Observable,this.onAfterStepObservable=new BABYLON.Observable,this.onRenderingGroupObservable=new BABYLON.Observable,this.animations=[],this.onPrePointerObservable=new BABYLON.Observable,this.onPointerObservable=new BABYLON.Observable,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this.cameraToUseForPointers=null,this._startingPointerPosition=new BABYLON.Vector2(0,0),this._previousStartingPointerPosition=new BABYLON.Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this.onPreKeyboardObservable=new BABYLON.Observable,this.onKeyboardObservable=new BABYLON.Observable,this._useRightHandedSystem=!1,this._fogEnabled=!0,this._fogMode=Scene.FOGMODE_NONE,this.fogColor=new BABYLON.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this._shadowsEnabled=!0,this._lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.transformNodes=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this._texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.highlightLayers=new Array,this._skeletonsEnabled=!0,this.skeletons=new Array,this.morphTargetManagers=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new BABYLON.Vector3(0,-9.807,0),this.postProcesses=new Array,this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this.probesEnabled=!0,this.reflectionProbes=new Array,this._actionManagers=new Array,this._meshesForIntersections=new BABYLON.SmartArrayNoDuplicate(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=new BABYLON.PerfCounter,this._activeIndices=new BABYLON.PerfCounter,this._activeParticles=new BABYLON.PerfCounter,this._activeBones=new BABYLON.PerfCounter,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._intermediateRendering=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._alternateViewUpdateFlag=-1,this._alternateProjectionUpdateFlag=-1,this._toBeDisposed=new BABYLON.SmartArray(256),this._pendingData=new Array,this._isDisposed=!1,this._activeMeshes=new BABYLON.SmartArray(256),this._processedMaterials=new BABYLON.SmartArray(256),this._renderTargets=new BABYLON.SmartArrayNoDuplicate(256),this._activeParticleSystems=new BABYLON.SmartArray(256),this._activeSkeletons=new BABYLON.SmartArrayNoDuplicate(32),this._softwareSkinnedMeshes=new BABYLON.SmartArrayNoDuplicate(32),this._activeAnimatables=new Array,this._transformMatrix=BABYLON.Matrix.Zero(),this._useAlternateCameraConfiguration=!1,this._alternateRendering=!1,this.requireLightSorting=!1,this._activeMeshesFrozen=!1,this._tempPickingRay=BABYLON.Ray?BABYLON.Ray.Zero():null,this._engine=engine||BABYLON.Engine.LastCreatedEngine,this._engine.scenes.push(this),this._uid=null,this._renderingManager=new BABYLON.RenderingManager(this),this.postProcessManager=new BABYLON.PostProcessManager(this),BABYLON.OutlineRenderer&&(this._outlineRenderer=new BABYLON.OutlineRenderer(this)),BABYLON.Tools.IsWindowObjectExist(),BABYLON.SimplificationQueue&&(this.simplificationQueue=new BABYLON.SimplificationQueue),this.workerCollisions=!1,this._createUbo(),this._imageProcessingConfiguration=new BABYLON.ImageProcessingConfiguration}return Object.defineProperty(Scene,"FOGMODE_NONE",{get:function(){return Scene._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Scene,"FOGMODE_EXP",{get:function(){return Scene._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(Scene,"FOGMODE_EXP2",{get:function(){return Scene._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(Scene,"FOGMODE_LINEAR",{get:function(){return Scene._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(value){this._environmentTexture!==value&&(this._environmentTexture=value,this.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(value){this._forcePointsCloud!==value&&(this._forcePointsCloud=value,this.markAllMaterialsAsDirty(BABYLON.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"beforeRender",{set:function(callback){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),callback&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"afterRender",{set:function(callback){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),callback&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"beforeCameraRender",{set:function(callback){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"afterCameraRender",{set:function(callback){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"gamepadManager",{get:function(){return this._gamepadManager||(this._gamepadManager=new BABYLON.GamepadManager(this)),this._gamepadManager},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"unTranslatedPointer",{get:function(){return new BABYLON.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(value){this._useRightHandedSystem!==value&&(this._useRightHandedSystem=value,this.markAllMaterialsAsDirty(BABYLON.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Scene.prototype.setStepId=function(newStepId){this._currentStepId=newStepId},Scene.prototype.getStepId=function(){return this._currentStepId},Scene.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(Scene.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(value){this._fogEnabled!==value&&(this._fogEnabled=value,this.markAllMaterialsAsDirty(BABYLON.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"fogMode",{get:function(){return this._fogMode},set:function(value){this._fogMode!==value&&(this._fogMode=value,this.markAllMaterialsAsDirty(BABYLON.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(value){this._shadowsEnabled!==value&&(this._shadowsEnabled=value,this.markAllMaterialsAsDirty(BABYLON.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(value){this._lightsEnabled!==value&&(this._lightsEnabled=value,this.markAllMaterialsAsDirty(BABYLON.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=new BABYLON.StandardMaterial("default material",this)),this._defaultMaterial},set:function(value){this._defaultMaterial=value},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(value){this._texturesEnabled!==value&&(this._texturesEnabled=value,this.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(value){this._skeletonsEnabled!==value&&(this._skeletonsEnabled=value,this.markAllMaterialsAsDirty(BABYLON.Material.AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"postProcessRenderPipelineManager",{get:function(){return this._postProcessRenderPipelineManager||(this._postProcessRenderPipelineManager=new BABYLON.PostProcessRenderPipelineManager),this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"mainSoundTrack",{get:function(){return this._mainSoundTrack||(this._mainSoundTrack=new BABYLON.SoundTrack(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"_isAlternateRenderingEnabled",{get:function(){return this._alternateRendering},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new BABYLON.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(enabled){BABYLON.CollisionCoordinatorLegacy&&(enabled=enabled&&!!Worker,this._workerCollisions=enabled,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=enabled?new BABYLON.CollisionCoordinatorWorker:new BABYLON.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this))},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),Scene.prototype.getCachedMaterial=function(){return this._cachedMaterial},Scene.prototype.getCachedEffect=function(){return this._cachedEffect},Scene.prototype.getCachedVisibility=function(){return this._cachedVisibility},Scene.prototype.isCachedMaterialInvalid=function(material,effect,visibility){return void 0===visibility&&(visibility=1),this._cachedEffect!==effect||this._cachedMaterial!==material||this._cachedVisibility!==visibility},Scene.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new BABYLON.BoundingBoxRenderer(this)),this._boundingBoxRenderer},Scene.prototype.getOutlineRenderer=function(){return this._outlineRenderer},Scene.prototype.getEngine=function(){return this._engine},Scene.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(Scene.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),Scene.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(Scene.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),Scene.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(Scene.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),Scene.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(Scene.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),Scene.prototype.getInterFramePerfCounter=function(){return BABYLON.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"interFramePerfCounter",{get:function(){return BABYLON.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getLastFrameDuration=function(){return BABYLON.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"lastFramePerfCounter",{get:function(){return BABYLON.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getEvaluateActiveMeshesDuration=function(){return BABYLON.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"evaluateActiveMeshesDurationPerfCounter",{get:function(){return BABYLON.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getActiveMeshes=function(){return this._activeMeshes},Scene.prototype.getRenderTargetsDuration=function(){return BABYLON.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"),0},Scene.prototype.getRenderDuration=function(){return BABYLON.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"renderDurationPerfCounter",{get:function(){return BABYLON.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getParticlesDuration=function(){return BABYLON.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"particlesDurationPerfCounter",{get:function(){return BABYLON.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getSpritesDuration=function(){return BABYLON.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(Scene.prototype,"spriteDuractionPerfCounter",{get:function(){return BABYLON.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),Scene.prototype.getAnimationRatio=function(){return this._animationRatio},Scene.prototype.getRenderId=function(){return this._renderId},Scene.prototype.incrementRenderId=function(){this._renderId++},Scene.prototype._updatePointerPosition=function(evt){var canvasRect=this._engine.getRenderingCanvasClientRect();canvasRect&&(this._pointerX=evt.clientX-canvasRect.left,this._pointerY=evt.clientY-canvasRect.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},Scene.prototype._createUbo=function(){this._sceneUbo=new BABYLON.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},Scene.prototype._createAlternateUbo=function(){this._alternateSceneUbo=new BABYLON.UniformBuffer(this._engine,void 0,!0),this._alternateSceneUbo.addUniform("viewProjection",16),this._alternateSceneUbo.addUniform("view",16)},Scene.prototype.simulatePointerMove=function(pickResult){var evt=new PointerEvent("pointermove");return this._processPointerMove(pickResult,evt)},Scene.prototype._processPointerMove=function(pickResult,evt){var canvas=this._engine.getRenderingCanvas();if(!canvas)return this;if(pickResult&&pickResult.hit&&pickResult.pickedMesh?(this.setPointerOverSprite(null),this.setPointerOverMesh(pickResult.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers?this._pointerOverMesh.actionManager.hoverCursor?canvas.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:canvas.style.cursor=this.hoverCursor:canvas.style.cursor=this.defaultCursor):(this.setPointerOverMesh(null),(pickResult=this.pickSprite(this._unTranslatedPointerX,this._unTranslatedPointerY,this._spritePredicate,!1,this.cameraToUseForPointers||void 0))&&pickResult.hit&&pickResult.pickedSprite?(this.setPointerOverSprite(pickResult.pickedSprite),this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.hoverCursor?canvas.style.cursor=this._pointerOverSprite.actionManager.hoverCursor:canvas.style.cursor=this.hoverCursor):(this.setPointerOverSprite(null),canvas.style.cursor=this.defaultCursor)),pickResult&&(this.onPointerMove&&this.onPointerMove(evt,pickResult),this.onPointerObservable.hasObservers())){var type="mousewheel"===evt.type||"DOMMouseScroll"===evt.type?BABYLON.PointerEventTypes.POINTERWHEEL:BABYLON.PointerEventTypes.POINTERMOVE,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}return this},Scene.prototype.simulatePointerDown=function(pickResult){var evt=new PointerEvent("pointerdown");return this._processPointerDown(pickResult,evt)},Scene.prototype._processPointerDown=function(pickResult,evt){var _this=this;if(pickResult&&pickResult.hit&&pickResult.pickedMesh){this._pickedDownMesh=pickResult.pickedMesh;var actionManager=pickResult.pickedMesh.actionManager;if(actionManager){if(actionManager.hasPickTriggers)switch(actionManager.processTrigger(BABYLON.ActionManager.OnPickDownTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt)),evt.button){case 0:actionManager.processTrigger(BABYLON.ActionManager.OnLeftPickTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt));break;case 1:actionManager.processTrigger(BABYLON.ActionManager.OnCenterPickTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt));break;case 2:actionManager.processTrigger(BABYLON.ActionManager.OnRightPickTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt))}actionManager.hasSpecificTrigger(BABYLON.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var pickResult=_this.pick(_this._unTranslatedPointerX,_this._unTranslatedPointerY,function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.actionManager&&mesh.actionManager.hasSpecificTrigger(BABYLON.ActionManager.OnLongPressTrigger)&&mesh==_this._pickedDownMesh},!1,_this.cameraToUseForPointers);pickResult&&pickResult.hit&&pickResult.pickedMesh&&actionManager&&0!==_this._totalPointersPressed&&(new Date).getTime()-_this._startingPointerTime>Scene.LongPressDelay&&Math.abs(_this._startingPointerPosition.x-_this._pointerX)<Scene.DragMovementThreshold&&Math.abs(_this._startingPointerPosition.y-_this._pointerY)<Scene.DragMovementThreshold&&(_this._startingPointerTime=0,actionManager.processTrigger(BABYLON.ActionManager.OnLongPressTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt)))},Scene.LongPressDelay)}}if(pickResult&&(this.onPointerDown&&this.onPointerDown(evt,pickResult),this.onPointerObservable.hasObservers())){var type=BABYLON.PointerEventTypes.POINTERDOWN,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}return this},Scene.prototype.simulatePointerUp=function(pickResult){var evt=new PointerEvent("pointerup"),clickInfo=new ClickInfo;return clickInfo.singleClick=!0,clickInfo.ignore=!0,this._processPointerUp(pickResult,evt,clickInfo)},Scene.prototype._processPointerUp=function(pickResult,evt,clickInfo){if(pickResult&&pickResult&&pickResult.pickedMesh){if(this._pickedUpMesh=pickResult.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(this.onPointerPick&&this.onPointerPick(evt,pickResult),clickInfo.singleClick&&!clickInfo.ignore&&this.onPointerObservable.hasObservers())){var type=BABYLON.PointerEventTypes.POINTERPICK,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}pickResult.pickedMesh.actionManager&&(clickInfo.ignore&&pickResult.pickedMesh.actionManager.processTrigger(BABYLON.ActionManager.OnPickUpTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt)),clickInfo.hasSwiped||clickInfo.ignore||!clickInfo.singleClick||pickResult.pickedMesh.actionManager.processTrigger(BABYLON.ActionManager.OnPickTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt)),clickInfo.doubleClick&&!clickInfo.ignore&&pickResult.pickedMesh.actionManager.hasSpecificTrigger(BABYLON.ActionManager.OnDoublePickTrigger)&&pickResult.pickedMesh.actionManager.processTrigger(BABYLON.ActionManager.OnDoublePickTrigger,BABYLON.ActionEvent.CreateNew(pickResult.pickedMesh,evt)))}if(this._pickedDownMesh&&this._pickedDownMesh.actionManager&&this._pickedDownMesh.actionManager.hasSpecificTrigger(BABYLON.ActionManager.OnPickOutTrigger)&&this._pickedDownMesh!==this._pickedUpMesh&&this._pickedDownMesh.actionManager.processTrigger(BABYLON.ActionManager.OnPickOutTrigger,BABYLON.ActionEvent.CreateNew(this._pickedDownMesh,evt)),this.onPointerUp&&this.onPointerUp(evt,pickResult),this.onPointerObservable.hasObservers())if(clickInfo.ignore){var type=BABYLON.PointerEventTypes.POINTERUP,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}else if(!clickInfo.hasSwiped){if(clickInfo.singleClick&&this.onPointerObservable.hasSpecificMask(BABYLON.PointerEventTypes.POINTERTAP)){var type=BABYLON.PointerEventTypes.POINTERTAP,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}if(clickInfo.doubleClick&&this.onPointerObservable.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP)){var type=BABYLON.PointerEventTypes.POINTERDOUBLETAP,pi=new BABYLON.PointerInfo(type,evt,pickResult);this.onPointerObservable.notifyObservers(pi,type)}}return this},Scene.prototype.attachControl=function(attachUp,attachDown,attachMove){var _this=this;void 0===attachUp&&(attachUp=!0),void 0===attachDown&&(attachDown=!0),void 0===attachMove&&(attachMove=!0),this._initActionManager=function(act,clickInfo){if(!_this._meshPickProceed){var pickResult=_this.pick(_this._unTranslatedPointerX,_this._unTranslatedPointerY,_this.pointerDownPredicate,!1,_this.cameraToUseForPointers);_this._currentPickResult=pickResult,pickResult&&(act=pickResult.hit&&pickResult.pickedMesh?pickResult.pickedMesh.actionManager:null),_this._meshPickProceed=!0}return act},this._delayedSimpleClick=function(btn,clickInfo,cb){((new Date).getTime()-_this._previousStartingPointerTime>Scene.DoubleClickDelay&&!_this._doubleClickOccured||btn!==_this._previousButtonPressed)&&(_this._doubleClickOccured=!1,clickInfo.singleClick=!0,clickInfo.ignore=!1,cb(clickInfo,_this._currentPickResult))},this._initClickEvent=function(obs1,obs2,evt,cb){var clickInfo=new ClickInfo;_this._currentPickResult=null;var act=null,checkPicking=obs1.hasSpecificMask(BABYLON.PointerEventTypes.POINTERPICK)||obs2.hasSpecificMask(BABYLON.PointerEventTypes.POINTERPICK)||obs1.hasSpecificMask(BABYLON.PointerEventTypes.POINTERTAP)||obs2.hasSpecificMask(BABYLON.PointerEventTypes.POINTERTAP)||obs1.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP)||obs2.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP);if(!checkPicking&&BABYLON.ActionManager&&BABYLON.ActionManager.HasPickTriggers&&(act=_this._initActionManager(act,clickInfo))&&(checkPicking=act.hasPickTriggers),checkPicking){var btn=evt.button;if(clickInfo.hasSwiped=Math.abs(_this._startingPointerPosition.x-_this._pointerX)>Scene.DragMovementThreshold||Math.abs(_this._startingPointerPosition.y-_this._pointerY)>Scene.DragMovementThreshold,!clickInfo.hasSwiped){var checkSingleClickImmediately=!Scene.ExclusiveDoubleClickMode;checkSingleClickImmediately||(checkSingleClickImmediately=!obs1.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP)&&!obs2.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP))&&!BABYLON.ActionManager.HasSpecificTrigger(BABYLON.ActionManager.OnDoublePickTrigger)&&(act=_this._initActionManager(act,clickInfo))&&(checkSingleClickImmediately=!act.hasSpecificTrigger(BABYLON.ActionManager.OnDoublePickTrigger)),checkSingleClickImmediately?((new Date).getTime()-_this._previousStartingPointerTime>Scene.DoubleClickDelay||btn!==_this._previousButtonPressed)&&(clickInfo.singleClick=!0,cb(clickInfo,_this._currentPickResult)):(_this._previousDelayedSimpleClickTimeout=_this._delayedSimpleClickTimeout,_this._delayedSimpleClickTimeout=window.setTimeout(_this._delayedSimpleClick.bind(_this,btn,clickInfo,cb),Scene.DoubleClickDelay));var checkDoubleClick=obs1.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP)||obs2.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP);!checkDoubleClick&&BABYLON.ActionManager.HasSpecificTrigger(BABYLON.ActionManager.OnDoublePickTrigger)&&(act=_this._initActionManager(act,clickInfo))&&(checkDoubleClick=act.hasSpecificTrigger(BABYLON.ActionManager.OnDoublePickTrigger)),checkDoubleClick&&(btn===_this._previousButtonPressed&&(new Date).getTime()-_this._previousStartingPointerTime<Scene.DoubleClickDelay&&!_this._doubleClickOccured?!clickInfo.hasSwiped&&Math.abs(_this._previousStartingPointerPosition.x-_this._startingPointerPosition.x)<Scene.DragMovementThreshold&&Math.abs(_this._previousStartingPointerPosition.y-_this._startingPointerPosition.y)<Scene.DragMovementThreshold?(_this._previousStartingPointerTime=0,_this._doubleClickOccured=!0,clickInfo.doubleClick=!0,clickInfo.ignore=!1,Scene.ExclusiveDoubleClickMode&&_this._previousDelayedSimpleClickTimeout&&clearTimeout(_this._previousDelayedSimpleClickTimeout),_this._previousDelayedSimpleClickTimeout=_this._delayedSimpleClickTimeout,cb(clickInfo,_this._currentPickResult)):(_this._doubleClickOccured=!1,_this._previousStartingPointerTime=_this._startingPointerTime,_this._previousStartingPointerPosition.x=_this._startingPointerPosition.x,_this._previousStartingPointerPosition.y=_this._startingPointerPosition.y,_this._previousButtonPressed=btn,Scene.ExclusiveDoubleClickMode?(_this._previousDelayedSimpleClickTimeout&&clearTimeout(_this._previousDelayedSimpleClickTimeout),_this._previousDelayedSimpleClickTimeout=_this._delayedSimpleClickTimeout,cb(clickInfo,_this._previousPickResult)):cb(clickInfo,_this._currentPickResult)):(_this._doubleClickOccured=!1,_this._previousStartingPointerTime=_this._startingPointerTime,_this._previousStartingPointerPosition.x=_this._startingPointerPosition.x,_this._previousStartingPointerPosition.y=_this._startingPointerPosition.y,_this._previousButtonPressed=btn))}}clickInfo.ignore=!0,cb(clickInfo,_this._currentPickResult)},this._spritePredicate=function(sprite){return sprite.isPickable&&sprite.actionManager&&sprite.actionManager.hasPointerTriggers},this._onPointerMove=function(evt){if(_this._updatePointerPosition(evt),_this.onPrePointerObservable.hasObservers()){var type="mousewheel"===evt.type||"DOMMouseScroll"===evt.type?BABYLON.PointerEventTypes.POINTERWHEEL:BABYLON.PointerEventTypes.POINTERMOVE,pi=new BABYLON.PointerInfoPre(type,evt,_this._unTranslatedPointerX,_this._unTranslatedPointerY);if(_this.onPrePointerObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}if(_this.cameraToUseForPointers||_this.activeCamera){_this.pointerMovePredicate||(_this.pointerMovePredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()&&(mesh.enablePointerMoveEvents||_this.constantlyUpdateMeshUnderPointer||null!==mesh.actionManager&&void 0!==mesh.actionManager)});var pickResult=_this.pick(_this._unTranslatedPointerX,_this._unTranslatedPointerY,_this.pointerMovePredicate,!1,_this.cameraToUseForPointers);_this._processPointerMove(pickResult,evt)}},this._onPointerDown=function(evt){if(_this._totalPointersPressed++,_this._pickedDownMesh=null,_this._meshPickProceed=!1,_this._updatePointerPosition(evt),_this.preventDefaultOnPointerDown&&canvas&&(evt.preventDefault(),canvas.focus()),_this.onPrePointerObservable.hasObservers()){var type=BABYLON.PointerEventTypes.POINTERDOWN,pi=new BABYLON.PointerInfoPre(type,evt,_this._unTranslatedPointerX,_this._unTranslatedPointerY);if(_this.onPrePointerObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}if(_this.cameraToUseForPointers||_this.activeCamera){_this._startingPointerPosition.x=_this._pointerX,_this._startingPointerPosition.y=_this._pointerY,_this._startingPointerTime=(new Date).getTime(),_this.pointerDownPredicate||(_this.pointerDownPredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()}),_this._pickedDownMesh=null;var pickResult=_this.pick(_this._unTranslatedPointerX,_this._unTranslatedPointerY,_this.pointerDownPredicate,!1,_this.cameraToUseForPointers);if(_this._processPointerDown(pickResult,evt),_this._pickedDownSprite=null,_this.spriteManagers.length>0&&(pickResult=_this.pickSprite(_this._unTranslatedPointerX,_this._unTranslatedPointerY,_this._spritePredicate,!1,_this.cameraToUseForPointers||void 0))&&pickResult.hit&&pickResult.pickedSprite&&pickResult.pickedSprite.actionManager){switch(_this._pickedDownSprite=pickResult.pickedSprite,evt.button){case 0:pickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnLeftPickTrigger,BABYLON.ActionEvent.CreateNewFromSprite(pickResult.pickedSprite,_this,evt));break;case 1:pickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnCenterPickTrigger,BABYLON.ActionEvent.CreateNewFromSprite(pickResult.pickedSprite,_this,evt));break;case 2:pickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnRightPickTrigger,BABYLON.ActionEvent.CreateNewFromSprite(pickResult.pickedSprite,_this,evt))}pickResult.pickedSprite.actionManager&&pickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPickDownTrigger,BABYLON.ActionEvent.CreateNewFromSprite(pickResult.pickedSprite,_this,evt))}}},this._onPointerUp=function(evt){0!==_this._totalPointersPressed&&(_this._totalPointersPressed--,_this._pickedUpMesh=null,_this._meshPickProceed=!1,_this._updatePointerPosition(evt),_this._initClickEvent(_this.onPrePointerObservable,_this.onPointerObservable,evt,function(clickInfo,pickResult){if(_this.onPrePointerObservable.hasObservers())if(clickInfo.ignore){var type=BABYLON.PointerEventTypes.POINTERUP,pi=new BABYLON.PointerInfoPre(type,evt,_this._unTranslatedPointerX,_this._unTranslatedPointerY);if(_this.onPrePointerObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}else if(!clickInfo.hasSwiped){if(clickInfo.singleClick&&_this.onPrePointerObservable.hasSpecificMask(BABYLON.PointerEventTypes.POINTERTAP)){var type=BABYLON.PointerEventTypes.POINTERTAP,pi=new BABYLON.PointerInfoPre(type,evt,_this._unTranslatedPointerX,_this._unTranslatedPointerY);if(_this.onPrePointerObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}if(clickInfo.doubleClick&&_this.onPrePointerObservable.hasSpecificMask(BABYLON.PointerEventTypes.POINTERDOUBLETAP)){var type=BABYLON.PointerEventTypes.POINTERDOUBLETAP,pi=new BABYLON.PointerInfoPre(type,evt,_this._unTranslatedPointerX,_this._unTranslatedPointerY);if(_this.onPrePointerObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}}if(_this.cameraToUseForPointers||_this.activeCamera){if(_this.pointerUpPredicate||(_this.pointerUpPredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()}),!_this._meshPickProceed&&(BABYLON.ActionManager&&BABYLON.ActionManager.HasTriggers||_this.onPointerObservable.hasObservers())&&_this._initActionManager(null,clickInfo),pickResult||(pickResult=_this._currentPickResult),_this._processPointerUp(pickResult,evt,clickInfo),_this.spriteManagers.length>0){var spritePickResult=_this.pickSprite(_this._unTranslatedPointerX,_this._unTranslatedPointerY,_this._spritePredicate,!1,_this.cameraToUseForPointers||void 0);spritePickResult&&(spritePickResult.hit&&spritePickResult.pickedSprite&&spritePickResult.pickedSprite.actionManager&&(spritePickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPickUpTrigger,BABYLON.ActionEvent.CreateNewFromSprite(spritePickResult.pickedSprite,_this,evt)),spritePickResult.pickedSprite.actionManager&&Math.abs(_this._startingPointerPosition.x-_this._pointerX)<Scene.DragMovementThreshold&&Math.abs(_this._startingPointerPosition.y-_this._pointerY)<Scene.DragMovementThreshold&&spritePickResult.pickedSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPickTrigger,BABYLON.ActionEvent.CreateNewFromSprite(spritePickResult.pickedSprite,_this,evt))),_this._pickedDownSprite&&_this._pickedDownSprite.actionManager&&_this._pickedDownSprite!==spritePickResult.pickedSprite&&_this._pickedDownSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPickOutTrigger,BABYLON.ActionEvent.CreateNewFromSprite(_this._pickedDownSprite,_this,evt)))}_this._previousPickResult=_this._currentPickResult}}))},this._onKeyDown=function(evt){var type=BABYLON.KeyboardEventTypes.KEYDOWN;if(_this.onPreKeyboardObservable.hasObservers()){pi=new BABYLON.KeyboardInfoPre(type,evt);if(_this.onPreKeyboardObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}if(_this.onKeyboardObservable.hasObservers()){var pi=new BABYLON.KeyboardInfo(type,evt);_this.onKeyboardObservable.notifyObservers(pi,type)}_this.actionManager&&_this.actionManager.processTrigger(BABYLON.ActionManager.OnKeyDownTrigger,BABYLON.ActionEvent.CreateNewFromScene(_this,evt))},this._onKeyUp=function(evt){var type=BABYLON.KeyboardEventTypes.KEYUP;if(_this.onPreKeyboardObservable.hasObservers()){pi=new BABYLON.KeyboardInfoPre(type,evt);if(_this.onPreKeyboardObservable.notifyObservers(pi,type),pi.skipOnPointerObservable)return}if(_this.onKeyboardObservable.hasObservers()){var pi=new BABYLON.KeyboardInfo(type,evt);_this.onKeyboardObservable.notifyObservers(pi,type)}_this.actionManager&&_this.actionManager.processTrigger(BABYLON.ActionManager.OnKeyUpTrigger,BABYLON.ActionEvent.CreateNewFromScene(_this,evt))};var engine=this.getEngine();this._onCanvasFocusObserver=engine.onCanvasFocusObservable.add(function(){canvas&&(canvas.addEventListener("keydown",_this._onKeyDown,!1),canvas.addEventListener("keyup",_this._onKeyUp,!1))}),this._onCanvasBlurObserver=engine.onCanvasBlurObservable.add(function(){canvas&&(canvas.removeEventListener("keydown",_this._onKeyDown),canvas.removeEventListener("keyup",_this._onKeyUp))});var eventPrefix=BABYLON.Tools.GetPointerPrefix(),canvas=this._engine.getRenderingCanvas();canvas&&(attachMove&&(canvas.addEventListener(eventPrefix+"move",this._onPointerMove,!1),canvas.addEventListener("mousewheel",this._onPointerMove,!1),canvas.addEventListener("DOMMouseScroll",this._onPointerMove,!1)),attachDown&&canvas.addEventListener(eventPrefix+"down",this._onPointerDown,!1),attachUp&&window.addEventListener(eventPrefix+"up",this._onPointerUp,!1),canvas.tabIndex=1)},Scene.prototype.detachControl=function(){var engine=this.getEngine(),eventPrefix=BABYLON.Tools.GetPointerPrefix(),canvas=engine.getRenderingCanvas();canvas&&(canvas.removeEventListener(eventPrefix+"move",this._onPointerMove),canvas.removeEventListener(eventPrefix+"down",this._onPointerDown),window.removeEventListener(eventPrefix+"up",this._onPointerUp),this._onCanvasBlurObserver&&engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&engine.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),canvas.removeEventListener("mousewheel",this._onPointerMove),canvas.removeEventListener("DOMMouseScroll",this._onPointerMove),canvas.removeEventListener("keydown",this._onKeyDown),canvas.removeEventListener("keyup",this._onKeyUp),this.onKeyboardObservable.clear(),this.onPreKeyboardObservable.clear(),this.onPointerObservable.clear(),this.onPrePointerObservable.clear())},Scene.prototype.isReady=function(){if(this._isDisposed)return!1;if(this._pendingData.length>0)return!1;var index;for(index=0;index<this._geometries.length;index++)if(this._geometries[index].delayLoadState===BABYLON.Engine.DELAYLOADSTATE_LOADING)return!1;for(index=0;index<this.meshes.length;index++){var mesh=this.meshes[index];if(mesh.isEnabled()&&(mesh.subMeshes&&0!==mesh.subMeshes.length)){if(!mesh.isReady())return!1;var mat=mesh.material;if(mat&&!mat.isReady(mesh))return!1}}return!0},Scene.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},Scene.prototype.registerBeforeRender=function(func){this.onBeforeRenderObservable.add(func)},Scene.prototype.unregisterBeforeRender=function(func){this.onBeforeRenderObservable.removeCallback(func)},Scene.prototype.registerAfterRender=function(func){this.onAfterRenderObservable.add(func)},Scene.prototype.unregisterAfterRender=function(func){this.onAfterRenderObservable.removeCallback(func)},Scene.prototype._addPendingData=function(data){this._pendingData.push(data)},Scene.prototype._removePendingData=function(data){var wasLoading=this.isLoading,index=this._pendingData.indexOf(data);-1!==index&&this._pendingData.splice(index,1),wasLoading&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},Scene.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(Scene.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),Scene.prototype.executeWhenReady=function(func){var _this=this;this.onReadyObservable.add(func),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){_this._checkIsReady()},150))},Scene.prototype._checkIsReady=function(){var _this=this;if(this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){_this._checkIsReady()},150)},Scene.prototype.beginAnimation=function(target,from,to,loop,speedRatio,onAnimationEnd,animatable){if(void 0===speedRatio&&(speedRatio=1),from>to&&speedRatio>0&&(speedRatio*=-1),this.stopAnimation(target),animatable||(animatable=new BABYLON.Animatable(this,target,from,to,loop,speedRatio,onAnimationEnd)),target.animations&&animatable.appendAnimations(target,target.animations),target.getAnimatables)for(var animatables=target.getAnimatables(),index=0;index<animatables.length;index++)this.beginAnimation(animatables[index],from,to,loop,speedRatio,onAnimationEnd,animatable);return animatable.reset(),animatable},Scene.prototype.beginDirectAnimation=function(target,animations,from,to,loop,speedRatio,onAnimationEnd){return void 0===speedRatio&&(speedRatio=1),new BABYLON.Animatable(this,target,from,to,loop,speedRatio,onAnimationEnd,animations)},Scene.prototype.getAnimatableByTarget=function(target){for(var index=0;index<this._activeAnimatables.length;index++)if(this._activeAnimatables[index].target===target)return this._activeAnimatables[index];return null},Object.defineProperty(Scene.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),Scene.prototype.stopAnimation=function(target,animationName){var animatable=this.getAnimatableByTarget(target);animatable&&animatable.stop(animationName)},Scene.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].stop();this._activeAnimatables=[]}},Scene.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){var now=BABYLON.Tools.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=now}var deltaTime=this.useConstantAnimationDeltaTime?16:(now-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=deltaTime,this._animationTimeLast=now;for(var index=0;index<this._activeAnimatables.length;index++)this._activeAnimatables[index]._animate(this._animationTime)}},Scene.prototype._switchToAlternateCameraConfiguration=function(active){this._useAlternateCameraConfiguration=active},Scene.prototype.getViewMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateViewMatrix:this._viewMatrix},Scene.prototype.getProjectionMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateProjectionMatrix:this._projectionMatrix},Scene.prototype.getTransformMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateTransformMatrix:this._transformMatrix},Scene.prototype.setTransformMatrix=function(view,projection){if(this._viewUpdateFlag!==view.updateFlag||this._projectionUpdateFlag!==projection.updateFlag){if(this._viewUpdateFlag=view.updateFlag,this._projectionUpdateFlag=projection.updateFlag,this._viewMatrix=view,this._projectionMatrix=projection,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?BABYLON.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=BABYLON.Frustum.GetPlanes(this._transformMatrix),this.activeCamera&&this.activeCamera._alternateCamera){var otherCamera=this.activeCamera._alternateCamera;otherCamera.getViewMatrix().multiplyToRef(otherCamera.getProjectionMatrix(),BABYLON.Tmp.Matrix[0]),BABYLON.Frustum.GetRightPlaneToRef(BABYLON.Tmp.Matrix[0],this._frustumPlanes[3])}this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update())}},Scene.prototype._setAlternateTransformMatrix=function(view,projection){this._alternateViewUpdateFlag===view.updateFlag&&this._alternateProjectionUpdateFlag===projection.updateFlag||(this._alternateViewUpdateFlag=view.updateFlag,this._alternateProjectionUpdateFlag=projection.updateFlag,this._alternateViewMatrix=view,this._alternateProjectionMatrix=projection,this._alternateTransformMatrix||(this._alternateTransformMatrix=BABYLON.Matrix.Zero()),this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix,this._alternateTransformMatrix),this._alternateSceneUbo||this._createAlternateUbo(),this._alternateSceneUbo.useUbo&&(this._alternateSceneUbo.updateMatrix("viewProjection",this._alternateTransformMatrix),this._alternateSceneUbo.updateMatrix("view",this._alternateViewMatrix),this._alternateSceneUbo.update()))},Scene.prototype.getSceneUniformBuffer=function(){return this._useAlternateCameraConfiguration?this._alternateSceneUbo:this._sceneUbo},Scene.prototype.getUniqueId=function(){var result=Scene._uniqueIdCounter;return Scene._uniqueIdCounter++,result},Scene.prototype.addMesh=function(newMesh){this.meshes.push(newMesh),this.collisionCoordinator&&this.collisionCoordinator.onMeshAdded(newMesh),this.onNewMeshAddedObservable.notifyObservers(newMesh)},Scene.prototype.removeMesh=function(toRemove){var index=this.meshes.indexOf(toRemove);return-1!==index&&this.meshes.splice(index,1),this.onMeshRemovedObservable.notifyObservers(toRemove),index},Scene.prototype.addTransformNode=function(newTransformNode){this.transformNodes.push(newTransformNode),this.onNewTransformNodeAddedObservable.notifyObservers(newTransformNode)},Scene.prototype.removeTransformNode=function(toRemove){var index=this.transformNodes.indexOf(toRemove);return-1!==index&&this.transformNodes.splice(index,1),this.onTransformNodeRemovedObservable.notifyObservers(toRemove),index},Scene.prototype.removeSkeleton=function(toRemove){var index=this.skeletons.indexOf(toRemove);return-1!==index&&this.skeletons.splice(index,1),index},Scene.prototype.removeMorphTargetManager=function(toRemove){var index=this.morphTargetManagers.indexOf(toRemove);return-1!==index&&this.morphTargetManagers.splice(index,1),index},Scene.prototype.removeLight=function(toRemove){var index=this.lights.indexOf(toRemove);return-1!==index&&(this.lights.splice(index,1),this.sortLightsByPriority()),this.onLightRemovedObservable.notifyObservers(toRemove),index},Scene.prototype.removeCamera=function(toRemove){var index=this.cameras.indexOf(toRemove);-1!==index&&this.cameras.splice(index,1);var index2=this.activeCameras.indexOf(toRemove);return-1!==index2&&this.activeCameras.splice(index2,1),this.activeCamera===toRemove&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(toRemove),index},Scene.prototype.addLight=function(newLight){this.lights.push(newLight),this.sortLightsByPriority(),this.onNewLightAddedObservable.notifyObservers(newLight)},Scene.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(BABYLON.Light.compareLightsPriority)},Scene.prototype.addCamera=function(newCamera){this.cameras.push(newCamera),this.onNewCameraAddedObservable.notifyObservers(newCamera)},Scene.prototype.switchActiveCamera=function(newCamera,attachControl){void 0===attachControl&&(attachControl=!0);var canvas=this._engine.getRenderingCanvas();canvas&&(this.activeCamera&&this.activeCamera.detachControl(canvas),this.activeCamera=newCamera,attachControl&&newCamera.attachControl(canvas))},Scene.prototype.setActiveCameraByID=function(id){var camera=this.getCameraByID(id);return camera?(this.activeCamera=camera,camera):null},Scene.prototype.setActiveCameraByName=function(name){var camera=this.getCameraByName(name);return camera?(this.activeCamera=camera,camera):null},Scene.prototype.getMaterialByID=function(id){for(var index=0;index<this.materials.length;index++)if(this.materials[index].id===id)return this.materials[index];return null},Scene.prototype.getMaterialByName=function(name){for(var index=0;index<this.materials.length;index++)if(this.materials[index].name===name)return this.materials[index];return null},Scene.prototype.getLensFlareSystemByName=function(name){for(var index=0;index<this.lensFlareSystems.length;index++)if(this.lensFlareSystems[index].name===name)return this.lensFlareSystems[index];return null},Scene.prototype.getLensFlareSystemByID=function(id){for(var index=0;index<this.lensFlareSystems.length;index++)if(this.lensFlareSystems[index].id===id)return this.lensFlareSystems[index];return null},Scene.prototype.getCameraByID=function(id){for(var index=0;index<this.cameras.length;index++)if(this.cameras[index].id===id)return this.cameras[index];return null},Scene.prototype.getCameraByUniqueID=function(uniqueId){for(var index=0;index<this.cameras.length;index++)if(this.cameras[index].uniqueId===uniqueId)return this.cameras[index];return null},Scene.prototype.getCameraByName=function(name){for(var index=0;index<this.cameras.length;index++)if(this.cameras[index].name===name)return this.cameras[index];return null},Scene.prototype.getBoneByID=function(id){for(var skeletonIndex=0;skeletonIndex<this.skeletons.length;skeletonIndex++)for(var skeleton=this.skeletons[skeletonIndex],boneIndex=0;boneIndex<skeleton.bones.length;boneIndex++)if(skeleton.bones[boneIndex].id===id)return skeleton.bones[boneIndex];return null},Scene.prototype.getBoneByName=function(name){for(var skeletonIndex=0;skeletonIndex<this.skeletons.length;skeletonIndex++)for(var skeleton=this.skeletons[skeletonIndex],boneIndex=0;boneIndex<skeleton.bones.length;boneIndex++)if(skeleton.bones[boneIndex].name===name)return skeleton.bones[boneIndex];return null},Scene.prototype.getLightByName=function(name){for(var index=0;index<this.lights.length;index++)if(this.lights[index].name===name)return this.lights[index];return null},Scene.prototype.getLightByID=function(id){for(var index=0;index<this.lights.length;index++)if(this.lights[index].id===id)return this.lights[index];return null},Scene.prototype.getLightByUniqueID=function(uniqueId){for(var index=0;index<this.lights.length;index++)if(this.lights[index].uniqueId===uniqueId)return this.lights[index];return null},Scene.prototype.getParticleSystemByID=function(id){for(var index=0;index<this.particleSystems.length;index++)if(this.particleSystems[index].id===id)return this.particleSystems[index];return null},Scene.prototype.getGeometryByID=function(id){for(var index=0;index<this._geometries.length;index++)if(this._geometries[index].id===id)return this._geometries[index];return null},Scene.prototype.pushGeometry=function(geometry,force){return!(!force&&this.getGeometryByID(geometry.id))&&(this._geometries.push(geometry),this.collisionCoordinator&&this.collisionCoordinator.onGeometryAdded(geometry),this.onNewGeometryAddedObservable.notifyObservers(geometry),!0)},Scene.prototype.removeGeometry=function(geometry){var index=this._geometries.indexOf(geometry);return index>-1&&(this._geometries.splice(index,1),this.collisionCoordinator&&this.collisionCoordinator.onGeometryDeleted(geometry),this.onGeometryRemovedObservable.notifyObservers(geometry),!0)},Scene.prototype.getGeometries=function(){return this._geometries},Scene.prototype.getMeshByID=function(id){for(var index=0;index<this.meshes.length;index++)if(this.meshes[index].id===id)return this.meshes[index];return null},Scene.prototype.getMeshesByID=function(id){return this.meshes.filter(function(m){return m.id===id})},Scene.prototype.getTransformNodeByID=function(id){for(var index=0;index<this.transformNodes.length;index++)if(this.transformNodes[index].id===id)return this.transformNodes[index];return null},Scene.prototype.getTransformNodesByID=function(id){return this.transformNodes.filter(function(m){return m.id===id})},Scene.prototype.getMeshByUniqueID=function(uniqueId){for(var index=0;index<this.meshes.length;index++)if(this.meshes[index].uniqueId===uniqueId)return this.meshes[index];return null},Scene.prototype.getLastMeshByID=function(id){for(var index=this.meshes.length-1;index>=0;index--)if(this.meshes[index].id===id)return this.meshes[index];return null},Scene.prototype.getLastEntryByID=function(id){var index;for(index=this.meshes.length-1;index>=0;index--)if(this.meshes[index].id===id)return this.meshes[index];for(index=this.transformNodes.length-1;index>=0;index--)if(this.transformNodes[index].id===id)return this.transformNodes[index];for(index=this.cameras.length-1;index>=0;index--)if(this.cameras[index].id===id)return this.cameras[index];for(index=this.lights.length-1;index>=0;index--)if(this.lights[index].id===id)return this.lights[index];return null},Scene.prototype.getNodeByID=function(id){var mesh=this.getMeshByID(id);if(mesh)return mesh;var light=this.getLightByID(id);if(light)return light;var camera=this.getCameraByID(id);return camera||this.getBoneByID(id)},Scene.prototype.getNodeByName=function(name){var mesh=this.getMeshByName(name);if(mesh)return mesh;var light=this.getLightByName(name);if(light)return light;var camera=this.getCameraByName(name);return camera||this.getBoneByName(name)},Scene.prototype.getMeshByName=function(name){for(var index=0;index<this.meshes.length;index++)if(this.meshes[index].name===name)return this.meshes[index];return null},Scene.prototype.getTransformNodeByName=function(name){for(var index=0;index<this.transformNodes.length;index++)if(this.transformNodes[index].name===name)return this.transformNodes[index];return null},Scene.prototype.getSoundByName=function(name){var index;if(BABYLON.AudioEngine){for(index=0;index<this.mainSoundTrack.soundCollection.length;index++)if(this.mainSoundTrack.soundCollection[index].name===name)return this.mainSoundTrack.soundCollection[index];for(var sdIndex=0;sdIndex<this.soundTracks.length;sdIndex++)for(index=0;index<this.soundTracks[sdIndex].soundCollection.length;index++)if(this.soundTracks[sdIndex].soundCollection[index].name===name)return this.soundTracks[sdIndex].soundCollection[index]}return null},Scene.prototype.getLastSkeletonByID=function(id){for(var index=this.skeletons.length-1;index>=0;index--)if(this.skeletons[index].id===id)return this.skeletons[index];return null},Scene.prototype.getSkeletonById=function(id){for(var index=0;index<this.skeletons.length;index++)if(this.skeletons[index].id===id)return this.skeletons[index];return null},Scene.prototype.getSkeletonByName=function(name){for(var index=0;index<this.skeletons.length;index++)if(this.skeletons[index].name===name)return this.skeletons[index];return null},Scene.prototype.getMorphTargetManagerById=function(id){for(var index=0;index<this.morphTargetManagers.length;index++)if(this.morphTargetManagers[index].uniqueId===id)return this.morphTargetManagers[index];return null},Scene.prototype.isActiveMesh=function(mesh){return-1!==this._activeMeshes.indexOf(mesh)},Scene.prototype.getHighlightLayerByName=function(name){for(var index=0;index<this.highlightLayers.length;index++)if(this.highlightLayers[index].name===name)return this.highlightLayers[index];return null},Object.defineProperty(Scene.prototype,"uid",{get:function(){return this._uid||(this._uid=BABYLON.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),Scene.prototype.addExternalData=function(key,data){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.add(key,data)},Scene.prototype.getExternalData=function(key){return this._externalData?this._externalData.get(key):null},Scene.prototype.getOrAddExternalDataWithFactory=function(key,factory){return this._externalData||(this._externalData=new BABYLON.StringDictionary),this._externalData.getOrAddWithFactory(key,factory)},Scene.prototype.removeExternalData=function(key){return this._externalData.remove(key)},Scene.prototype._evaluateSubMesh=function(subMesh,mesh){if(mesh.alwaysSelectAsActiveMesh||1===mesh.subMeshes.length||subMesh.isInFrustum(this._frustumPlanes)){var material=subMesh.getMaterial();if(mesh.showSubMeshesBoundingBox){var boundingInfo=subMesh.getBoundingInfo();this.getBoundingBoxRenderer().renderList.push(boundingInfo.boundingBox)}material&&(material.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(material)&&(this._processedMaterials.push(material),this._renderTargets.concatWithNoDuplicate(material.getRenderTargetTextures())),this._activeIndices.addCount(subMesh.indexCount,!1),this._renderingManager.dispatch(subMesh))}},Scene.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},Scene.prototype.freezeActiveMeshes=function(){return this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this},Scene.prototype.unfreezeActiveMeshes=function(){return this._activeMeshesFrozen=!1,this},Scene.prototype._evaluateActiveMeshes=function(){if((!this._activeMeshesFrozen||!this._activeMeshes.length)&&this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._boundingBoxRenderer&&this._boundingBoxRenderer.reset();var meshes,len;if(this._selectionOctree){var selection=this._selectionOctree.select(this._frustumPlanes);meshes=selection.data,len=selection.length}else len=this.meshes.length,meshes=this.meshes;for(var meshIndex=0;meshIndex<len;meshIndex++){var mesh=meshes[meshIndex];if(!mesh.isBlocked&&(this._totalVertices.addCount(mesh.getTotalVertices(),!1),mesh.isReady()&&mesh.isEnabled())){mesh.computeWorldMatrix(),mesh.actionManager&&mesh.actionManager.hasSpecificTriggers([BABYLON.ActionManager.OnIntersectionEnterTrigger,BABYLON.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(mesh);var meshLOD=mesh.getLOD(this.activeCamera);meshLOD&&(mesh._preActivate(),(mesh.alwaysSelectAsActiveMesh||mesh.isVisible&&mesh.visibility>0&&0!=(mesh.layerMask&this.activeCamera.layerMask)&&mesh.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(mesh),this.activeCamera._activeMeshes.push(mesh),mesh._activate(this._renderId),meshLOD!==mesh&&meshLOD._activate(this._renderId),this._activeMesh(mesh,meshLOD)))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var particleIndex=0;particleIndex<this.particleSystems.length;particleIndex++){var particleSystem=this.particleSystems[particleIndex];if(particleSystem.isStarted()&&particleSystem.emitter){var emitter=particleSystem.emitter;emitter.position&&!emitter.isEnabled()||(this._activeParticleSystems.push(particleSystem),particleSystem.animate(),this._renderingManager.dispatchParticles(particleSystem))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},Scene.prototype._activeMesh=function(sourceMesh,mesh){if(mesh.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(mesh.skeleton)&&mesh.skeleton.prepare(),mesh.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(mesh)),sourceMesh.showBoundingBox||this.forceShowBoundingBoxes){var boundingInfo=sourceMesh.getBoundingInfo();this.getBoundingBoxRenderer().renderList.push(boundingInfo.boundingBox)}if(mesh&&mesh.subMeshes){var len,subMeshes;if(mesh._submeshesOctree&&mesh.useOctreeForRenderingSelection){var intersections=mesh._submeshesOctree.select(this._frustumPlanes);len=intersections.length,subMeshes=intersections.data}else len=(subMeshes=mesh.subMeshes).length;for(var subIndex=0;subIndex<len;subIndex++){var subMesh=subMeshes[subIndex];this._evaluateSubMesh(subMesh,mesh)}}},Scene.prototype.updateTransformMatrix=function(force){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(force))},Scene.prototype.updateAlternateTransformMatrix=function(alternateCamera){this._setAlternateTransformMatrix(alternateCamera.getViewMatrix(),alternateCamera.getProjectionMatrix())},Scene.prototype._renderForCamera=function(camera){if(!camera||!camera._skipRendering){var engine=this._engine;if(this.activeCamera=camera,!this.activeCamera)throw new Error("Active camera not set");BABYLON.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name),engine.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.activeCamera.update(),this.updateTransformMatrix(),camera._alternateCamera&&(this.updateAlternateTransformMatrix(camera._alternateCamera),this._alternateRendering=!0),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var softwareSkinnedMeshIndex=0;softwareSkinnedMeshIndex<this._softwareSkinnedMeshes.length;softwareSkinnedMeshIndex++){var mesh=this._softwareSkinnedMeshes.data[softwareSkinnedMeshIndex];mesh.applySkeleton(mesh.skeleton)}this.OnBeforeRenderTargetsRenderObservable.notifyObservers(this);var needsRestoreFrameBuffer=!1;if(camera.customRenderTargets&&camera.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(camera.customRenderTargets),this.renderTargetsEnabled&&this._renderTargets.length>0){this._intermediateRendering=!0,BABYLON.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var renderIndex=0;renderIndex<this._renderTargets.length;renderIndex++)if((renderTarget=this._renderTargets.data[renderIndex])._shouldRender()){this._renderId++;var hasSpecialRenderTargetCamera=renderTarget.activeCamera&&renderTarget.activeCamera!==this.activeCamera;renderTarget.render(hasSpecialRenderTargetCamera,this.dumpNextRenderTargets)}BABYLON.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._intermediateRendering=!1,this._renderId++,needsRestoreFrameBuffer=!0}var stencilState=this._engine.getStencilBuffer(),renderhighlights=!1;if(this.renderTargetsEnabled&&this.highlightLayers&&this.highlightLayers.length>0){this._intermediateRendering=!0;for(i=0;i<this.highlightLayers.length;i++){var highlightLayer=this.highlightLayers[i];if(highlightLayer.shouldRender()&&(!highlightLayer.camera||highlightLayer.camera.cameraRigMode===BABYLON.Camera.RIG_MODE_NONE&&camera===highlightLayer.camera||highlightLayer.camera.cameraRigMode!==BABYLON.Camera.RIG_MODE_NONE&&highlightLayer.camera._rigCameras.indexOf(camera)>-1)){renderhighlights=!0;var renderTarget=highlightLayer._mainTexture;renderTarget._shouldRender()&&(this._renderId++,renderTarget.render(!1,!1),needsRestoreFrameBuffer=!0)}}this._intermediateRendering=!1,this._renderId++}needsRestoreFrameBuffer&&engine.restoreDefaultFramebuffer(),this.OnAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager._prepareFrame();var layerIndex,layer;if(this.layers.length){for(engine.setDepthBuffer(!1),layerIndex=0;layerIndex<this.layers.length;layerIndex++)(layer=this.layers[layerIndex]).isBackground&&0!=(layer.layerMask&this.activeCamera.layerMask)&&layer.render();engine.setDepthBuffer(!0)}if(renderhighlights&&this._engine.setStencilBuffer(!0),this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this),renderhighlights&&this._engine.setStencilBuffer(stencilState),this._boundingBoxRenderer&&this._boundingBoxRenderer.render(),this.lensFlaresEnabled){BABYLON.Tools.StartPerformanceCounter("Lens flares",this.lensFlareSystems.length>0);for(var lensFlareSystemIndex=0;lensFlareSystemIndex<this.lensFlareSystems.length;lensFlareSystemIndex++){var lensFlareSystem=this.lensFlareSystems[lensFlareSystemIndex];0!=(camera.layerMask&lensFlareSystem.layerMask)&&lensFlareSystem.render()}BABYLON.Tools.EndPerformanceCounter("Lens flares",this.lensFlareSystems.length>0)}if(this.layers.length){for(engine.setDepthBuffer(!1),layerIndex=0;layerIndex<this.layers.length;layerIndex++)(layer=this.layers[layerIndex]).isBackground||0==(layer.layerMask&this.activeCamera.layerMask)||layer.render();engine.setDepthBuffer(!0)}if(renderhighlights){engine.setDepthBuffer(!1);for(var i=0;i<this.highlightLayers.length;i++)this.highlightLayers[i].shouldRender()&&this.highlightLayers[i].render();engine.setDepthBuffer(!0)}this.postProcessManager._finalizeFrame(camera.isIntermediate),this._renderTargets.reset(),this._alternateRendering=!1,this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera),BABYLON.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)}},Scene.prototype._processSubCameras=function(camera){if(camera.cameraRigMode!==BABYLON.Camera.RIG_MODE_NONE){this.activeCamera&&this.activeCamera.update();for(var index=0;index<camera._rigCameras.length;index++)this._renderForCamera(camera._rigCameras[index]);this.activeCamera=camera,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix())}else this._renderForCamera(camera)},Scene.prototype._checkIntersections=function(){for(var index=0;index<this._meshesForIntersections.length;index++){var sourceMesh=this._meshesForIntersections.data[index];if(sourceMesh.actionManager)for(var actionIndex=0;actionIndex<sourceMesh.actionManager.actions.length;actionIndex++){var action=sourceMesh.actionManager.actions[actionIndex];if(action.trigger===BABYLON.ActionManager.OnIntersectionEnterTrigger||action.trigger===BABYLON.ActionManager.OnIntersectionExitTrigger){var parameters=action.getTriggerParameter(),otherMesh=parameters instanceof BABYLON.AbstractMesh?parameters:parameters.mesh,areIntersecting=otherMesh.intersectsMesh(sourceMesh,parameters.usePreciseIntersection),currentIntersectionInProgress=sourceMesh._intersectionsInProgress.indexOf(otherMesh);areIntersecting&&-1===currentIntersectionInProgress?action.trigger===BABYLON.ActionManager.OnIntersectionEnterTrigger?(action._executeCurrent(BABYLON.ActionEvent.CreateNew(sourceMesh,void 0,otherMesh)),sourceMesh._intersectionsInProgress.push(otherMesh)):action.trigger===BABYLON.ActionManager.OnIntersectionExitTrigger&&sourceMesh._intersectionsInProgress.push(otherMesh):!areIntersecting&&currentIntersectionInProgress>-1&&(action.trigger===BABYLON.ActionManager.OnIntersectionExitTrigger&&action._executeCurrent(BABYLON.ActionEvent.CreateNew(sourceMesh,void 0,otherMesh)),sourceMesh.actionManager.hasSpecificTrigger(BABYLON.ActionManager.OnIntersectionExitTrigger)&&action.trigger!==BABYLON.ActionManager.OnIntersectionExitTrigger||sourceMesh._intersectionsInProgress.splice(currentIntersectionInProgress,1))}}}},Scene.prototype.render=function(){if(!this.isDisposed){if(this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(BABYLON.ActionManager.OnEveryFrameTrigger),this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext(),this._engine.isDeterministicLockStep()){var deltaTime=Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime))+this._timeAccumulator,defaultFrameTime=1e3/60;this._physicsEngine&&(defaultFrameTime=1e3*this._physicsEngine.getTimeStep());var stepsTaken=0,maxSubSteps=this._engine.getLockstepMaxSteps(),internalSteps=Math.floor(deltaTime/60);internalSteps=Math.min(internalSteps,maxSubSteps);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*defaultFrameTime,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(defaultFrameTime/1e3),this.onAfterPhysicsObservable.notifyObservers(this)),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,stepsTaken++,deltaTime-=defaultFrameTime}while(deltaTime>0&&stepsTaken<internalSteps);this._timeAccumulator=deltaTime<0?0:deltaTime}else{deltaTime=this.useConstantAnimationDeltaTime?16:Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime));this._animationRatio=.06*deltaTime,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(deltaTime/1e3),this.onAfterPhysicsObservable.notifyObservers(this))}this._gamepadManager&&this._gamepadManager._isMonitoring&&this._gamepadManager._checkGamepadsStatus(),this.onBeforeRenderObservable.notifyObservers(this),this.OnBeforeRenderTargetsRenderObservable.notifyObservers(this);var engine=this.getEngine(),currentActiveCamera=this.activeCamera;if(this.renderTargetsEnabled){BABYLON.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var customIndex=0;customIndex<this.customRenderTargets.length;customIndex++){var renderTarget=this.customRenderTargets[customIndex];if(renderTarget._shouldRender()){if(this._renderId++,this.activeCamera=renderTarget.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),renderTarget.render(currentActiveCamera!==this.activeCamera,this.dumpNextRenderTargets)}}BABYLON.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}if(this.customRenderTargets.length>0&&engine.restoreDefaultFramebuffer(),this.OnAfterRenderTargetsRenderObservable.notifyObservers(this),this.activeCamera=currentActiveCamera,this.proceduralTexturesEnabled){BABYLON.Tools.StartPerformanceCounter("Procedural textures",this._proceduralTextures.length>0);for(var proceduralIndex=0;proceduralIndex<this._proceduralTextures.length;proceduralIndex++){var proceduralTexture=this._proceduralTextures[proceduralIndex];proceduralTexture._shouldRender()&&proceduralTexture.render()}BABYLON.Tools.EndPerformanceCounter("Procedural textures",this._proceduralTextures.length>0)}if((this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil),this.shadowsEnabled)for(var lightIndex=0;lightIndex<this.lights.length;lightIndex++){var light=this.lights[lightIndex],shadowGenerator=light.getShadowGenerator();if(light.isEnabled()&&light.shadowEnabled&&shadowGenerator){var shadowMap=shadowGenerator.getShadowMap();-1!==this.textures.indexOf(shadowMap)&&this._renderTargets.push(shadowMap)}}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this._geometryBufferRenderer&&this._renderTargets.push(this._geometryBufferRenderer.getGBuffer()),this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var cameraIndex=0;cameraIndex<this.activeCameras.length;cameraIndex++)cameraIndex>0&&this.activeCameras[cameraIndex].autoClear&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[cameraIndex]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections(),BABYLON.AudioEngine&&this._updateAudioParameters(),this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this);for(var index=0;index<this._toBeDisposed.length;index++){var data=this._toBeDisposed.data[index];data&&data.dispose(),this._toBeDisposed[index]=null}this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},Scene.prototype._updateAudioParameters=function(){if(this.audioEnabled&&this._mainSoundTrack&&(0!==this._mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var listeningCamera,audioEngine=BABYLON.Engine.audioEngine;if((listeningCamera=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera)&&audioEngine.canUseWebAudio&&audioEngine.audioContext){audioEngine.audioContext.listener.setPosition(listeningCamera.globalPosition.x,listeningCamera.globalPosition.y,listeningCamera.globalPosition.z),listeningCamera.rigCameras&&listeningCamera.rigCameras.length>0&&(listeningCamera=listeningCamera.rigCameras[0]);var mat=BABYLON.Matrix.Invert(listeningCamera.getViewMatrix()),cameraDirection=BABYLON.Vector3.TransformNormal(new BABYLON.Vector3(0,0,-1),mat);cameraDirection.normalize(),isNaN(cameraDirection.x)||isNaN(cameraDirection.y)||isNaN(cameraDirection.z)||audioEngine.audioContext.listener.setOrientation(cameraDirection.x,cameraDirection.y,cameraDirection.z,0,1,0);var i;for(i=0;i<this.mainSoundTrack.soundCollection.length;i++){var sound=this.mainSoundTrack.soundCollection[i];sound.useCustomAttenuation&&sound.updateDistanceFromListener()}for(i=0;i<this.soundTracks.length;i++)for(var j=0;j<this.soundTracks[i].soundCollection.length;j++)(sound=this.soundTracks[i].soundCollection[j]).useCustomAttenuation&&sound.updateDistanceFromListener()}}},Object.defineProperty(Scene.prototype,"audioEnabled",{get:function(){return this._audioEnabled},set:function(value){this._audioEnabled=value,BABYLON.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),Scene.prototype._disableAudio=function(){var i;for(i=0;i<this.mainSoundTrack.soundCollection.length;i++)this.mainSoundTrack.soundCollection[i].pause();for(i=0;i<this.soundTracks.length;i++)for(var j=0;j<this.soundTracks[i].soundCollection.length;j++)this.soundTracks[i].soundCollection[j].pause()},Scene.prototype._enableAudio=function(){var i;for(i=0;i<this.mainSoundTrack.soundCollection.length;i++)this.mainSoundTrack.soundCollection[i].isPaused&&this.mainSoundTrack.soundCollection[i].play();for(i=0;i<this.soundTracks.length;i++)for(var j=0;j<this.soundTracks[i].soundCollection.length;j++)this.soundTracks[i].soundCollection[j].isPaused&&this.soundTracks[i].soundCollection[j].play()},Object.defineProperty(Scene.prototype,"headphone",{get:function(){return this._headphone},set:function(value){this._headphone=value,BABYLON.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),Scene.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var i=0;i<this.soundTracks.length;i++)this.soundTracks[i].switchPanningModelToHRTF()},Scene.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var i=0;i<this.soundTracks.length;i++)this.soundTracks[i].switchPanningModelToEqualPower()},Scene.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new BABYLON.DepthRenderer(this),this._depthRenderer)},Scene.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},Scene.prototype.enableGeometryBufferRenderer=function(ratio){return void 0===ratio&&(ratio=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new BABYLON.GeometryBufferRenderer(this,ratio),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},Scene.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)},Scene.prototype.freezeMaterials=function(){for(var i=0;i<this.materials.length;i++)this.materials[i].freeze()},Scene.prototype.unfreezeMaterials=function(){for(var i=0;i<this.materials.length;i++)this.materials[i].unfreeze()},Scene.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this.importedMeshesFiles=new Array,this.stopAllAnimations(),this.resetCachedMaterial(),this._depthRenderer&&this._depthRenderer.dispose(),this._gamepadManager&&(this._gamepadManager.dispose(),this._gamepadManager=null),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._boundingBoxRenderer&&this._boundingBoxRenderer.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.dispose(),this._debugLayer&&this._debugLayer.hide(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.OnBeforeRenderTargetsRenderObservable.clear(),this.OnAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeSpritesRenderingObservable.clear(),this.onAfterSpritesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforePhysicsObservable.clear(),this.onAfterPhysicsObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.detachControl(),BABYLON.AudioEngine&&this.disposeSounds(),this.VRHelper&&this.VRHelper.dispose();var canvas=this._engine.getRenderingCanvas();if(canvas){var index;for(index=0;index<this.cameras.length;index++)this.cameras[index].detachControl(canvas)}for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.removeTransformNode(this.transformNodes[0]);for(;this.cameras.length;)this.cameras[0].dispose();for(this.defaultMaterial&&this.defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.highlightLayers.length;)this.highlightLayers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._alternateSceneUbo&&this._alternateSceneUbo.dispose(),this.postProcessManager.dispose(),this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),(index=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(index,1),this._engine.wipeCaches(),this._isDisposed=!0},Object.defineProperty(Scene.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Scene.prototype.disposeSounds=function(){if(this._mainSoundTrack){this.mainSoundTrack.dispose();for(var scIndex=0;scIndex<this.soundTracks.length;scIndex++)this.soundTracks[scIndex].dispose()}},Scene.prototype.getWorldExtends=function(){for(var min=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max=new BABYLON.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),index=0;index<this.meshes.length;index++){var mesh=this.meshes[index];if(mesh.subMeshes&&0!==mesh.subMeshes.length&&!mesh.infiniteDistance){mesh.computeWorldMatrix(!0);var boundingInfo=mesh.getBoundingInfo(),minBox=boundingInfo.boundingBox.minimumWorld,maxBox=boundingInfo.boundingBox.maximumWorld;BABYLON.Tools.CheckExtends(minBox,min,max),BABYLON.Tools.CheckExtends(maxBox,min,max)}}return{min:min,max:max}},Scene.prototype.createOrUpdateSelectionOctree=function(maxCapacity,maxDepth){void 0===maxCapacity&&(maxCapacity=64),void 0===maxDepth&&(maxDepth=2),this._selectionOctree||(this._selectionOctree=new BABYLON.Octree(BABYLON.Octree.CreationFuncForMeshes,maxCapacity,maxDepth));var worldExtends=this.getWorldExtends();return this._selectionOctree.update(worldExtends.min,worldExtends.max,this.meshes),this._selectionOctree},Scene.prototype.createPickingRay=function(x,y,world,camera,cameraViewSpace){void 0===cameraViewSpace&&(cameraViewSpace=!1);var result=BABYLON.Ray.Zero();return this.createPickingRayToRef(x,y,world,result,camera,cameraViewSpace),result},Scene.prototype.createPickingRayToRef=function(x,y,world,result,camera,cameraViewSpace){void 0===cameraViewSpace&&(cameraViewSpace=!1);var engine=this._engine;if(!camera){if(!this.activeCamera)throw new Error("Active camera not set");camera=this.activeCamera}var viewport=camera.viewport.toGlobal(engine.getRenderWidth(),engine.getRenderHeight());return x=x/this._engine.getHardwareScalingLevel()-viewport.x,y=y/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-viewport.y-viewport.height),result.update(x,y,viewport.width,viewport.height,world||BABYLON.Matrix.Identity(),cameraViewSpace?BABYLON.Matrix.Identity():camera.getViewMatrix(),camera.getProjectionMatrix()),this},Scene.prototype.createPickingRayInCameraSpace=function(x,y,camera){var result=BABYLON.Ray.Zero();return this.createPickingRayInCameraSpaceToRef(x,y,result,camera),result},Scene.prototype.createPickingRayInCameraSpaceToRef=function(x,y,result,camera){if(!BABYLON.PickingInfo)return this;var engine=this._engine;if(!camera){if(!this.activeCamera)throw new Error("Active camera not set");camera=this.activeCamera}var viewport=camera.viewport.toGlobal(engine.getRenderWidth(),engine.getRenderHeight()),identity=BABYLON.Matrix.Identity();return x=x/this._engine.getHardwareScalingLevel()-viewport.x,y=y/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-viewport.y-viewport.height),result.update(x,y,viewport.width,viewport.height,identity,identity,camera.getProjectionMatrix()),this},Scene.prototype._internalPick=function(rayFunction,predicate,fastCheck){if(!BABYLON.PickingInfo)return null;for(var pickingInfo=null,meshIndex=0;meshIndex<this.meshes.length;meshIndex++){var mesh=this.meshes[meshIndex];if(predicate){if(!predicate(mesh))continue}else if(!mesh.isEnabled()||!mesh.isVisible||!mesh.isPickable)continue;var ray=rayFunction(mesh.getWorldMatrix()),result=mesh.intersects(ray,fastCheck);if(result&&result.hit&&((fastCheck||null==pickingInfo||!(result.distance>=pickingInfo.distance))&&(pickingInfo=result,fastCheck)))break}return pickingInfo||new BABYLON.PickingInfo},Scene.prototype._internalMultiPick=function(rayFunction,predicate){if(!BABYLON.PickingInfo)return null;for(var pickingInfos=new Array,meshIndex=0;meshIndex<this.meshes.length;meshIndex++){var mesh=this.meshes[meshIndex];if(predicate){if(!predicate(mesh))continue}else if(!mesh.isEnabled()||!mesh.isVisible||!mesh.isPickable)continue;var ray=rayFunction(mesh.getWorldMatrix()),result=mesh.intersects(ray,!1);result&&result.hit&&pickingInfos.push(result)}return pickingInfos},Scene.prototype._internalPickSprites=function(ray,predicate,fastCheck,camera){if(!BABYLON.PickingInfo)return null;var pickingInfo=null;if(!camera){if(!this.activeCamera)return null;camera=this.activeCamera}if(this.spriteManagers.length>0)for(var spriteIndex=0;spriteIndex<this.spriteManagers.length;spriteIndex++){var spriteManager=this.spriteManagers[spriteIndex];if(spriteManager.isPickable){var result=spriteManager.intersects(ray,camera,predicate,fastCheck);if(result&&result.hit&&(fastCheck||null==pickingInfo||!(result.distance>=pickingInfo.distance))&&(pickingInfo=result,fastCheck))break}}return pickingInfo||new BABYLON.PickingInfo},Scene.prototype.pick=function(x,y,predicate,fastCheck,camera){var _this=this;return BABYLON.PickingInfo?this._internalPick(function(world){return _this.createPickingRayToRef(x,y,world,_this._tempPickingRay,camera||null),_this._tempPickingRay},predicate,fastCheck):null},Scene.prototype.pickSprite=function(x,y,predicate,fastCheck,camera){return this.createPickingRayInCameraSpaceToRef(x,y,this._tempPickingRay,camera),this._internalPickSprites(this._tempPickingRay,predicate,fastCheck,camera)},Scene.prototype.pickWithRay=function(ray,predicate,fastCheck){var _this=this;return this._internalPick(function(world){return _this._pickWithRayInverseMatrix||(_this._pickWithRayInverseMatrix=BABYLON.Matrix.Identity()),world.invertToRef(_this._pickWithRayInverseMatrix),_this._cachedRayForTransform||(_this._cachedRayForTransform=BABYLON.Ray.Zero()),BABYLON.Ray.TransformToRef(ray,_this._pickWithRayInverseMatrix,_this._cachedRayForTransform),_this._cachedRayForTransform},predicate,fastCheck)},Scene.prototype.multiPick=function(x,y,predicate,camera){var _this=this;return this._internalMultiPick(function(world){return _this.createPickingRay(x,y,world,camera||null)},predicate)},Scene.prototype.multiPickWithRay=function(ray,predicate){var _this=this;return this._internalMultiPick(function(world){return _this._pickWithRayInverseMatrix||(_this._pickWithRayInverseMatrix=BABYLON.Matrix.Identity()),world.invertToRef(_this._pickWithRayInverseMatrix),_this._cachedRayForTransform||(_this._cachedRayForTransform=BABYLON.Ray.Zero()),BABYLON.Ray.TransformToRef(ray,_this._pickWithRayInverseMatrix,_this._cachedRayForTransform),_this._cachedRayForTransform},predicate)},Scene.prototype.setPointerOverMesh=function(mesh){this._pointerOverMesh!==mesh&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(BABYLON.ActionManager.OnPointerOutTrigger,BABYLON.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=mesh,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(BABYLON.ActionManager.OnPointerOverTrigger,BABYLON.ActionEvent.CreateNew(this._pointerOverMesh)))},Scene.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},Scene.prototype.setPointerOverSprite=function(sprite){this._pointerOverSprite!==sprite&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPointerOutTrigger,BABYLON.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=sprite,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(BABYLON.ActionManager.OnPointerOverTrigger,BABYLON.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},Scene.prototype.getPointerOverSprite=function(){return this._pointerOverSprite},Scene.prototype.getPhysicsEngine=function(){return this._physicsEngine},Scene.prototype.enablePhysics=function(gravity,plugin){if(void 0===gravity&&(gravity=null),this._physicsEngine)return!0;try{return this._physicsEngine=new BABYLON.PhysicsEngine(gravity,plugin),!0}catch(e){return BABYLON.Tools.Error(e.message),!1}},Scene.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},Scene.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},Scene.prototype.deleteCompoundImpostor=function(compound){var mesh=compound.parts[0].mesh;mesh.physicsImpostor&&(mesh.physicsImpostor.dispose(),mesh.physicsImpostor=null)},Scene.prototype._rebuildGeometries=function(){for(var _i=0,_a=this._geometries;_i<_a.length;_i++)_a[_i]._rebuild();for(var _b=0,_c=this.meshes;_b<_c.length;_b++)_c[_b]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var _d=0,_e=this.layers;_d<_e.length;_d++)_e[_d]._rebuild();for(var _f=0,_g=this.highlightLayers;_f<_g.length;_f++)_g[_f]._rebuild();this._boundingBoxRenderer&&this._boundingBoxRenderer._rebuild();for(var _h=0,_j=this.particleSystems;_h<_j.length;_h++)_j[_h].rebuild();this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager._rebuild()},Scene.prototype._rebuildTextures=function(){for(var _i=0,_a=this.textures;_i<_a.length;_i++)_a[_i]._rebuild();this.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag)},Scene.prototype.createDefaultCameraOrLight=function(createArcRotateCamera,replace,attachCameraControls){if(void 0===createArcRotateCamera&&(createArcRotateCamera=!1),void 0===replace&&(replace=!1),void 0===attachCameraControls&&(attachCameraControls=!1),replace&&(this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),this.lights))for(var i=0;i<this.lights.length;i++)this.lights[i].dispose();if(0===this.lights.length&&new BABYLON.HemisphericLight("default light",BABYLON.Vector3.Up(),this),!this.activeCamera){var camera,worldExtends=this.getWorldExtends(),worldSize=worldExtends.max.subtract(worldExtends.min),worldCenter=worldExtends.min.add(worldSize.scale(.5)),radius=1.5*worldSize.length();if(createArcRotateCamera){var arcRotateCamera=new BABYLON.ArcRotateCamera("default camera",-Math.PI/2,Math.PI/2,radius,worldCenter,this);arcRotateCamera.lowerRadiusLimit=.01*radius,arcRotateCamera.wheelPrecision=100/radius,camera=arcRotateCamera}else{var freeCamera=new BABYLON.FreeCamera("default camera",new BABYLON.Vector3(worldCenter.x,worldCenter.y,-radius),this);freeCamera.setTarget(worldCenter),camera=freeCamera}camera.minZ=.01*radius,camera.maxZ=100*radius,camera.speed=.2*radius,this.activeCamera=camera;var canvas=this.getEngine().getRenderingCanvas();attachCameraControls&&canvas&&camera.attachControl(canvas)}},Scene.prototype.createDefaultSkybox=function(environmentTexture,pbr,scale,blur){if(void 0===pbr&&(pbr=!1),void 0===scale&&(scale=1e3),void 0===blur&&(blur=0),environmentTexture&&(this.environmentTexture=environmentTexture),!this.environmentTexture)return BABYLON.Tools.Warn("Can not create default skybox without environment texture."),null;var hdrSkybox=BABYLON.Mesh.CreateBox("hdrSkyBox",scale,this);if(pbr){var hdrSkyboxMaterial=new BABYLON.PBRMaterial("skyBox",this);hdrSkyboxMaterial.backFaceCulling=!1,hdrSkyboxMaterial.reflectionTexture=this.environmentTexture.clone(),hdrSkyboxMaterial.reflectionTexture&&(hdrSkyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE),hdrSkyboxMaterial.microSurface=1-blur,hdrSkyboxMaterial.disableLighting=!0,hdrSkyboxMaterial.twoSidedLighting=!0,hdrSkybox.infiniteDistance=!0,hdrSkybox.material=hdrSkyboxMaterial}else{var skyboxMaterial=new BABYLON.StandardMaterial("skyBox",this);skyboxMaterial.backFaceCulling=!1,skyboxMaterial.reflectionTexture=this.environmentTexture.clone(),skyboxMaterial.reflectionTexture&&(skyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE),skyboxMaterial.disableLighting=!0,hdrSkybox.infiniteDistance=!0,hdrSkybox.material=skyboxMaterial}return hdrSkybox},Scene.prototype.createDefaultEnvironment=function(options){return BABYLON.EnvironmentHelper?new BABYLON.EnvironmentHelper(options,this):null},Scene.prototype.createDefaultVRExperience=function(webVROptions){return void 0===webVROptions&&(webVROptions={}),new BABYLON.VRExperienceHelper(this,webVROptions)},Scene.prototype._getByTags=function(list,tagsQuery,forEach){if(void 0===tagsQuery)return list;var listByTags=[];forEach=forEach||function(item){};for(var i in list){var item=list[i];BABYLON.Tags&&BABYLON.Tags.MatchesQuery(item,tagsQuery)&&(listByTags.push(item),forEach(item))}return listByTags},Scene.prototype.getMeshesByTags=function(tagsQuery,forEach){return this._getByTags(this.meshes,tagsQuery,forEach)},Scene.prototype.getCamerasByTags=function(tagsQuery,forEach){return this._getByTags(this.cameras,tagsQuery,forEach)},Scene.prototype.getLightsByTags=function(tagsQuery,forEach){return this._getByTags(this.lights,tagsQuery,forEach)},Scene.prototype.getMaterialByTags=function(tagsQuery,forEach){return this._getByTags(this.materials,tagsQuery,forEach).concat(this._getByTags(this.multiMaterials,tagsQuery,forEach))},Scene.prototype.setRenderingOrder=function(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn){void 0===opaqueSortCompareFn&&(opaqueSortCompareFn=null),void 0===alphaTestSortCompareFn&&(alphaTestSortCompareFn=null),void 0===transparentSortCompareFn&&(transparentSortCompareFn=null),this._renderingManager.setRenderingOrder(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn)},Scene.prototype.setRenderingAutoClearDepthStencil=function(renderingGroupId,autoClearDepthStencil,depth,stencil){void 0===depth&&(depth=!0),void 0===stencil&&(stencil=!0),this._renderingManager.setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil,depth,stencil)},Scene.prototype.markAllMaterialsAsDirty=function(flag,predicate){for(var _i=0,_a=this.materials;_i<_a.length;_i++){var material=_a[_i];predicate&&!predicate(material)||material.markAsDirty(flag)}},Scene._FOGMODE_NONE=0,Scene._FOGMODE_EXP=1,Scene._FOGMODE_EXP2=2,Scene._FOGMODE_LINEAR=3,Scene._uniqueIdCounter=0,Scene.MinDeltaTime=1,Scene.MaxDeltaTime=1e3,Scene.DragMovementThreshold=10,Scene.LongPressDelay=500,Scene.DoubleClickDelay=300,Scene.ExclusiveDoubleClickMode=!1,Scene}();BABYLON.Scene=Scene}(BABYLON||(BABYLON={}));!function(BABYLON){var Buffer=function(){function Buffer(engine,data,updatable,stride,postponeInternalCreation,instanced){void 0===instanced&&(instanced=!1),engine instanceof BABYLON.Mesh?this._engine=engine.getScene().getEngine():this._engine=engine,this._updatable=updatable,this._data=data,this._strideSize=stride,postponeInternalCreation||this.create(),this._instanced=instanced,this._instanceDivisor=instanced?1:0}return Buffer.prototype.createVertexBuffer=function(kind,offset,size,stride){return new BABYLON.VertexBuffer(this._engine,this,kind,this._updatable,!0,stride||this._strideSize,this._instanced,offset,size)},Buffer.prototype.isUpdatable=function(){return this._updatable},Buffer.prototype.getData=function(){return this._data},Buffer.prototype.getBuffer=function(){return this._buffer},Buffer.prototype.getStrideSize=function(){return this._strideSize},Buffer.prototype.getIsInstanced=function(){return this._instanced},Object.defineProperty(Buffer.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(value){this._instanceDivisor=value,this._instanced=0!=value},enumerable:!0,configurable:!0}),Buffer.prototype.create=function(data){void 0===data&&(data=null),!data&&this._buffer||(data=data||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,data),this._data=data):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(data),this._data=data):this._buffer=this._engine.createVertexBuffer(data))},Buffer.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},Buffer.prototype.update=function(data){this.create(data)},Buffer.prototype.updateDirectly=function(data,offset,vertexCount){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,data,offset,vertexCount?vertexCount*this.getStrideSize():void 0),this._data=null)},Buffer.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Buffer}();BABYLON.Buffer=Buffer}(BABYLON||(BABYLON={}));!function(BABYLON){var VertexBuffer=function(){function VertexBuffer(engine,data,kind,updatable,postponeInternalCreation,stride,instanced,offset,size){if(!stride)switch(kind){case VertexBuffer.PositionKind:case VertexBuffer.NormalKind:stride=3;break;case VertexBuffer.UVKind:case VertexBuffer.UV2Kind:case VertexBuffer.UV3Kind:case VertexBuffer.UV4Kind:case VertexBuffer.UV5Kind:case VertexBuffer.UV6Kind:stride=2;break;case VertexBuffer.TangentKind:case VertexBuffer.ColorKind:stride=4;break;case VertexBuffer.MatricesIndicesKind:case VertexBuffer.MatricesIndicesExtraKind:stride=4;break;case VertexBuffer.MatricesWeightsKind:case VertexBuffer.MatricesWeightsExtraKind:default:stride=4}data instanceof BABYLON.Buffer?(stride||(stride=data.getStrideSize()),this._buffer=data,this._ownsBuffer=!1):(this._buffer=new BABYLON.Buffer(engine,data,updatable,stride,postponeInternalCreation,instanced),this._ownsBuffer=!0),this._stride=stride,this._offset=offset||0,this._size=size||stride,this._kind=kind}return VertexBuffer.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},VertexBuffer.prototype.getKind=function(){return this._kind},VertexBuffer.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},VertexBuffer.prototype.getData=function(){return this._buffer.getData()},VertexBuffer.prototype.getBuffer=function(){return this._buffer.getBuffer()},VertexBuffer.prototype.getStrideSize=function(){return this._stride},VertexBuffer.prototype.getOffset=function(){return this._offset},VertexBuffer.prototype.getSize=function(){return this._size},VertexBuffer.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},VertexBuffer.prototype.getInstanceDivisor=function(){return this._buffer.instanceDivisor},VertexBuffer.prototype.create=function(data){return this._buffer.create(data)},VertexBuffer.prototype.update=function(data){return this._buffer.update(data)},VertexBuffer.prototype.updateDirectly=function(data,offset){return this._buffer.updateDirectly(data,offset)},VertexBuffer.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(VertexBuffer,"PositionKind",{get:function(){return VertexBuffer._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"NormalKind",{get:function(){return VertexBuffer._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"TangentKind",{get:function(){return VertexBuffer._TangentKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UVKind",{get:function(){return VertexBuffer._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UV2Kind",{get:function(){return VertexBuffer._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UV3Kind",{get:function(){return VertexBuffer._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UV4Kind",{get:function(){return VertexBuffer._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UV5Kind",{get:function(){return VertexBuffer._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"UV6Kind",{get:function(){return VertexBuffer._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"ColorKind",{get:function(){return VertexBuffer._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"MatricesIndicesKind",{get:function(){return VertexBuffer._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"MatricesWeightsKind",{get:function(){return VertexBuffer._MatricesWeightsKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"MatricesIndicesExtraKind",{get:function(){return VertexBuffer._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer,"MatricesWeightsExtraKind",{get:function(){return VertexBuffer._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),VertexBuffer._PositionKind="position",VertexBuffer._NormalKind="normal",VertexBuffer._TangentKind="tangent",VertexBuffer._UVKind="uv",VertexBuffer._UV2Kind="uv2",VertexBuffer._UV3Kind="uv3",VertexBuffer._UV4Kind="uv4",VertexBuffer._UV5Kind="uv5",VertexBuffer._UV6Kind="uv6",VertexBuffer._ColorKind="color",VertexBuffer._MatricesIndicesKind="matricesIndices",VertexBuffer._MatricesWeightsKind="matricesWeights",VertexBuffer._MatricesIndicesExtraKind="matricesIndicesExtra",VertexBuffer._MatricesWeightsExtraKind="matricesWeightsExtra",VertexBuffer}();BABYLON.VertexBuffer=VertexBuffer}(BABYLON||(BABYLON={}));!function(BABYLON){var InternalTexture=function(){function InternalTexture(engine,dataSource){this.onLoadedObservable=new BABYLON.Observable,this._dataSource=InternalTexture.DATASOURCE_UNKNOWN,this._references=1,this._engine=engine,this._dataSource=dataSource,this._webGLTexture=engine._createTexture()}return Object.defineProperty(InternalTexture.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),InternalTexture.prototype.incrementReferences=function(){this._references++},InternalTexture.prototype.updateSize=function(width,height,depth){void 0===depth&&(depth=1),this.width=width,this.height=height,this.depth=depth,this.baseWidth=width,this.baseHeight=height,this.baseDepth=depth,this._size=width*height*depth},InternalTexture.prototype._rebuild=function(){var proxy,_this=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case InternalTexture.DATASOURCE_TEMP:return;case InternalTexture.DATASOURCE_URL:return void(proxy=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){_this.isReady=!0},null,this._buffer,void 0,this.format))._swapAndDie(this);case InternalTexture.DATASOURCE_RAW:return(proxy=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this),void(this.isReady=!0);case InternalTexture.DATASOURCE_RAW3D:return(proxy=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case InternalTexture.DATASOURCE_DYNAMIC:return void(proxy=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this);case InternalTexture.DATASOURCE_RENDERTARGET:var options=new BABYLON.RenderTargetCreationOptions;if(options.generateDepthBuffer=this._generateDepthBuffer,options.generateMipMaps=this.generateMipMaps,options.generateStencilBuffer=this._generateStencilBuffer,options.samplingMode=this.samplingMode,options.type=this.type,this.isCube)proxy=this._engine.createRenderTargetCubeTexture(this.width,options);else{var size={width:this.width,height:this.height};proxy=this._engine.createRenderTargetTexture(size,options)}return proxy._swapAndDie(this),void(this.isReady=!0);case InternalTexture.DATASOURCE_CUBE:return void(proxy=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){_this.isReady=!0},null,this.format,this._extension))._swapAndDie(this);case InternalTexture.DATASOURCE_CUBERAW:return(proxy=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case InternalTexture.DATASOURCE_CUBEPREFILTERED:return void(proxy=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(proxy){proxy&&proxy._swapAndDie(_this),_this.isReady=!0},null,this.format,this._extension))}},InternalTexture.prototype._swapAndDie=function(target){target._webGLTexture=this._webGLTexture,this._framebuffer&&(target._framebuffer=this._framebuffer),this._depthStencilBuffer&&(target._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(target._lodTextureHigh&&target._lodTextureHigh.dispose(),target._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(target._lodTextureMid&&target._lodTextureMid.dispose(),target._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(target._lodTextureLow&&target._lodTextureLow.dispose(),target._lodTextureLow=this._lodTextureLow);var cache=this._engine.getLoadedTexturesCache(),index=cache.indexOf(this);-1!==index&&cache.splice(index,1)},InternalTexture.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},InternalTexture.DATASOURCE_UNKNOWN=0,InternalTexture.DATASOURCE_URL=1,InternalTexture.DATASOURCE_TEMP=2,InternalTexture.DATASOURCE_RAW=3,InternalTexture.DATASOURCE_DYNAMIC=4,InternalTexture.DATASOURCE_RENDERTARGET=5,InternalTexture.DATASOURCE_MULTIRENDERTARGET=6,InternalTexture.DATASOURCE_CUBE=7,InternalTexture.DATASOURCE_CUBERAW=8,InternalTexture.DATASOURCE_CUBEPREFILTERED=9,InternalTexture.DATASOURCE_RAW3D=10,InternalTexture}();BABYLON.InternalTexture=InternalTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var BaseTexture=function(){function BaseTexture(scene){this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=BABYLON.Texture.EXPLICIT_MODE,this.wrapU=BABYLON.Texture.WRAP_ADDRESSMODE,this.wrapV=BABYLON.Texture.WRAP_ADDRESSMODE,this.wrapR=BABYLON.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.isCube=!1,this.is3D=!1,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.lodGenerationOffset=0,this.lodGenerationScale=.8,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new BABYLON.Observable,this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NONE,this._scene=scene||BABYLON.Engine.LastCreatedScene,this._scene&&this._scene.textures.push(this),this._uid=null}return Object.defineProperty(BaseTexture.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(value){this._hasAlpha!==value&&(this._hasAlpha=value,this._scene&&this._scene.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(value){this._coordinatesMode!==value&&(this._coordinatesMode=value,this._scene&&this._scene.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"uid",{get:function(){return this._uid||(this._uid=BABYLON.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),BaseTexture.prototype.toString=function(){return this.name},BaseTexture.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(BaseTexture.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),BaseTexture.prototype.getScene=function(){return this._scene},BaseTexture.prototype.getTextureMatrix=function(){return BABYLON.Matrix.IdentityReadOnly},BaseTexture.prototype.getReflectionTextureMatrix=function(){return BABYLON.Matrix.IdentityReadOnly},BaseTexture.prototype.getInternalTexture=function(){return this._texture},BaseTexture.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},BaseTexture.prototype.isReady=function(){return this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},BaseTexture.prototype.getSize=function(){return this._texture&&this._texture.width?new BABYLON.Size(this._texture.width,this._texture.height):this._texture&&this._texture._size?new BABYLON.Size(this._texture._size,this._texture._size):BABYLON.Size.Zero()},BaseTexture.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new BABYLON.Size(this._texture._size,this._texture._size):new BABYLON.Size(this._texture.baseWidth,this._texture.baseHeight):BABYLON.Size.Zero()},BaseTexture.prototype.scale=function(ratio){},Object.defineProperty(BaseTexture.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),BaseTexture.prototype._getFromCache=function(url,noMipmap,sampling){if(!this._scene)return null;for(var texturesCache=this._scene.getEngine().getLoadedTexturesCache(),index=0;index<texturesCache.length;index++){var texturesCacheEntry=texturesCache[index];if(texturesCacheEntry.url===url&&texturesCacheEntry.generateMipMaps===!noMipmap&&(!sampling||sampling===texturesCacheEntry.samplingMode))return texturesCacheEntry.incrementReferences(),texturesCacheEntry}return null},BaseTexture.prototype._rebuild=function(){},BaseTexture.prototype.delayLoad=function(){},BaseTexture.prototype.clone=function(){return null},Object.defineProperty(BaseTexture.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:BABYLON.Engine.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),BaseTexture.prototype.readPixels=function(faceIndex){if(void 0===faceIndex&&(faceIndex=0),!this._texture)return null;var size=this.getSize(),scene=this.getScene();if(!scene)return null;var engine=scene.getEngine();return this._texture.isCube?engine._readTexturePixels(this._texture,size.width,size.height,faceIndex):engine._readTexturePixels(this._texture,size.width,size.height,-1)},BaseTexture.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(BaseTexture.prototype,"sphericalPolynomial",{get:function(){return this._texture&&BABYLON.Internals.CubeMapToSphericalPolynomialTools&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=BABYLON.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(value){this._texture&&(this._texture._sphericalPolynomial=value)},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),BaseTexture.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation(this),this._scene._removePendingData(this);var index=this._scene.textures.indexOf(this);index>=0&&this._scene.textures.splice(index,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},BaseTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject=BABYLON.SerializationHelper.Serialize(this);return BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject},BaseTexture.WhenAllReady=function(textures,callback){var numRemaining=textures.length;if(0!==numRemaining)for(var texture,onLoadObservable,i=0;i<textures.length;i++)!function(){if((texture=textures[i]).isReady())0==--numRemaining&&callback();else{var onLoadCallback_1=function(){onLoadObservable.removeCallback(onLoadCallback_1),0==--numRemaining&&callback()};(onLoadObservable=texture.onLoadObservable).add(onLoadCallback_1)}}();else callback()},BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,__decorate([BABYLON.serialize()],BaseTexture.prototype,"name",void 0),__decorate([BABYLON.serialize("hasAlpha")],BaseTexture.prototype,"_hasAlpha",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"getAlphaFromRGB",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"level",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"coordinatesIndex",void 0),__decorate([BABYLON.serialize("coordinatesMode")],BaseTexture.prototype,"_coordinatesMode",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"wrapU",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"wrapV",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"wrapR",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"anisotropicFilteringLevel",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"isCube",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"is3D",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"gammaSpace",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"invertZ",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"lodLevelInAlpha",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"lodGenerationOffset",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"lodGenerationScale",void 0),__decorate([BABYLON.serialize()],BaseTexture.prototype,"isRenderTarget",void 0),BaseTexture}();BABYLON.BaseTexture=BaseTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var Texture=function(_super){function Texture(url,scene,noMipmap,invertY,samplingMode,onLoad,onError,buffer,deleteBuffer,format){void 0===noMipmap&&(noMipmap=!1),void 0===invertY&&(invertY=!0),void 0===samplingMode&&(samplingMode=Texture.TRILINEAR_SAMPLINGMODE),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===buffer&&(buffer=null),void 0===deleteBuffer&&(deleteBuffer=!1);var _this=_super.call(this,scene)||this;if(_this.uOffset=0,_this.vOffset=0,_this.uScale=1,_this.vScale=1,_this.uAng=0,_this.vAng=0,_this.wAng=0,_this._isBlocking=!0,_this.name=url||"",_this.url=url,_this._noMipmap=noMipmap,_this._invertY=invertY,_this._samplingMode=samplingMode,_this._buffer=buffer,_this._deleteBuffer=deleteBuffer,format&&(_this._format=format),!(scene=_this.getScene()))return _this;scene.getEngine().onBeforeTextureInitObservable.notifyObservers(_this);var load=function(){_this._onLoadObservable&&_this._onLoadObservable.hasObservers()&&_this.onLoadObservable.notifyObservers(_this),onLoad&&onLoad(),!_this.isBlocking&&scene&&scene.resetCachedMaterial()};return _this.url?(_this._texture=_this._getFromCache(_this.url,noMipmap,samplingMode),_this._texture?_this._texture.isReady?BABYLON.Tools.SetImmediate(function(){return load()}):_this._texture.onLoadedObservable.add(load):scene.useDelayedTextureLoading?(_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED,_this._delayedOnLoad=load,_this._delayedOnError=onError):(_this._texture=scene.getEngine().createTexture(_this.url,noMipmap,invertY,scene,_this._samplingMode,load,onError,_this._buffer,void 0,_this._format),deleteBuffer&&delete _this._buffer),_this):(_this._delayedOnLoad=load,_this._delayedOnError=onError,_this)}return __extends(Texture,_super),Object.defineProperty(Texture.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(Texture.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(value){this._isBlocking=value},enumerable:!0,configurable:!0}),Object.defineProperty(Texture.prototype,"samplingMode",{get:function(){return this._samplingMode},enumerable:!0,configurable:!0}),Texture.prototype.updateURL=function(url){this.url=url,this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED,this.delayLoad()},Texture.prototype.delayLoad=function(){var _this=this;if(this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED){var scene=this.getScene();scene&&(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture?this._texture.isReady?BABYLON.Tools.SetImmediate(function(){_this._delayedOnLoad&&_this._delayedOnLoad()}):this._delayedOnLoad&&this._texture.onLoadedObservable.add(this._delayedOnLoad):(this._texture=scene.getEngine().createTexture(this.url,this._noMipmap,this._invertY,scene,this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer))}},Texture.prototype.updateSamplingMode=function(samplingMode){if(this._texture){var scene=this.getScene();scene&&(this._samplingMode=samplingMode,scene.getEngine().updateTextureSamplingMode(samplingMode,this._texture))}},Texture.prototype._prepareRowForTextureGeneration=function(x,y,z,t){x*=this.uScale,y*=this.vScale,x-=.5*this.uScale,y-=.5*this.vScale,z-=.5,BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(x,y,z,this._rowGenerationMatrix,t),t.x+=.5*this.uScale+this.uOffset,t.y+=.5*this.vScale+this.vOffset,t.z+=.5},Texture.prototype.getTextureMatrix=function(){var _this=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=BABYLON.Matrix.Zero(),this._rowGenerationMatrix=new BABYLON.Matrix,this._t0=BABYLON.Vector3.Zero(),this._t1=BABYLON.Vector3.Zero(),this._t2=BABYLON.Vector3.Zero()),BABYLON.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),BABYLON.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z;var scene=this.getScene();return scene?(scene.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag,function(mat){return mat.hasTexture(_this)}),this._cachedTextureMatrix):this._cachedTextureMatrix},Texture.prototype.getReflectionTextureMatrix=function(){var _this=this,scene=this.getScene();if(!scene)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==Texture.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===scene.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=BABYLON.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=BABYLON.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case Texture.PLANAR_MODE:BABYLON.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case Texture.PROJECTION_MODE:BABYLON.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1;var projectionMatrix=scene.getProjectionMatrix();this._cachedProjectionMatrixId=projectionMatrix.updateFlag,projectionMatrix.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:BABYLON.Matrix.IdentityToRef(this._cachedTextureMatrix)}return scene.markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag,function(mat){return-1!==mat.getActiveTextures().indexOf(_this)}),this._cachedTextureMatrix},Texture.prototype.clone=function(){var _this=this;return BABYLON.SerializationHelper.Clone(function(){return new Texture(_this._texture?_this._texture.url:null,_this.getScene(),_this._noMipmap,_this._invertY,_this._samplingMode)},this)},Object.defineProperty(Texture.prototype,"onLoadObservable",{get:function(){return this._onLoadObservable||(this._onLoadObservable=new BABYLON.Observable),this._onLoadObservable},enumerable:!0,configurable:!0}),Texture.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(serializationObject.base64String=this._buffer,serializationObject.name=serializationObject.name.replace("data:","")),serializationObject},Texture.prototype.getClassName=function(){return"Texture"},Texture.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onLoadObservable&&(this.onLoadObservable.clear(),this._onLoadObservable=null),this._delayedOnLoad=null,this._delayedOnError=null},Texture.CreateFromBase64String=function(data,name,scene,noMipmap,invertY,samplingMode,onLoad,onError,format){return void 0===samplingMode&&(samplingMode=Texture.TRILINEAR_SAMPLINGMODE),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===format&&(format=BABYLON.Engine.TEXTUREFORMAT_RGBA),new Texture("data:"+name,scene,noMipmap,invertY,samplingMode,onLoad,onError,data,!1,format)},Texture.Parse=function(parsedTexture,scene,rootUrl){if(parsedTexture.customType){var parsedCustomTexture=BABYLON.Tools.Instantiate(parsedTexture.customType).Parse(parsedTexture,scene,rootUrl);return parsedTexture.samplingMode&&parsedCustomTexture.updateSamplingMode&&parsedCustomTexture._samplingMode&&parsedCustomTexture._samplingMode!==parsedTexture.samplingMode&&parsedCustomTexture.updateSamplingMode(parsedTexture.samplingMode),parsedCustomTexture}if(parsedTexture.isCube)return BABYLON.CubeTexture.Parse(parsedTexture,scene,rootUrl);if(!parsedTexture.name&&!parsedTexture.isRenderTarget)return null;var texture=BABYLON.SerializationHelper.Parse(function(){var generateMipMaps=!0;if(parsedTexture.noMipmap&&(generateMipMaps=!1),parsedTexture.mirrorPlane){var mirrorTexture=new BABYLON.MirrorTexture(parsedTexture.name,parsedTexture.renderTargetSize,scene,generateMipMaps);return mirrorTexture._waitingRenderList=parsedTexture.renderList,mirrorTexture.mirrorPlane=BABYLON.Plane.FromArray(parsedTexture.mirrorPlane),mirrorTexture}if(parsedTexture.isRenderTarget){var renderTargetTexture=new BABYLON.RenderTargetTexture(parsedTexture.name,parsedTexture.renderTargetSize,scene,generateMipMaps);return renderTargetTexture._waitingRenderList=parsedTexture.renderList,renderTargetTexture}return parsedTexture.base64String?Texture.CreateFromBase64String(parsedTexture.base64String,parsedTexture.name,scene,!generateMipMaps):new Texture(rootUrl+parsedTexture.name,scene,!generateMipMaps)},parsedTexture,scene);if(parsedTexture.samplingMode){var sampling=parsedTexture.samplingMode;texture._samplingMode!==sampling&&texture.updateSamplingMode(sampling)}if(parsedTexture.animations)for(var animationIndex=0;animationIndex<parsedTexture.animations.length;animationIndex++){var parsedAnimation=parsedTexture.animations[animationIndex];texture.animations.push(BABYLON.Animation.Parse(parsedAnimation))}return texture},Texture.LoadFromDataString=function(name,buffer,scene,deleteBuffer,noMipmap,invertY,samplingMode,onLoad,onError,format){return void 0===deleteBuffer&&(deleteBuffer=!1),void 0===noMipmap&&(noMipmap=!1),void 0===invertY&&(invertY=!0),void 0===samplingMode&&(samplingMode=Texture.TRILINEAR_SAMPLINGMODE),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===format&&(format=BABYLON.Engine.TEXTUREFORMAT_RGBA),"data:"!==name.substr(0,5)&&(name="data:"+name),new Texture(name,scene,noMipmap,invertY,samplingMode,onLoad,onError,buffer,deleteBuffer,format)},Texture.NEAREST_SAMPLINGMODE=1,Texture.NEAREST_NEAREST_MIPLINEAR=1,Texture.BILINEAR_SAMPLINGMODE=2,Texture.LINEAR_LINEAR_MIPNEAREST=2,Texture.TRILINEAR_SAMPLINGMODE=3,Texture.LINEAR_LINEAR_MIPLINEAR=3,Texture.NEAREST_NEAREST_MIPNEAREST=4,Texture.NEAREST_LINEAR_MIPNEAREST=5,Texture.NEAREST_LINEAR_MIPLINEAR=6,Texture.NEAREST_LINEAR=7,Texture.NEAREST_NEAREST=8,Texture.LINEAR_NEAREST_MIPNEAREST=9,Texture.LINEAR_NEAREST_MIPLINEAR=10,Texture.LINEAR_LINEAR=11,Texture.LINEAR_NEAREST=12,Texture.EXPLICIT_MODE=0,Texture.SPHERICAL_MODE=1,Texture.PLANAR_MODE=2,Texture.CUBIC_MODE=3,Texture.PROJECTION_MODE=4,Texture.SKYBOX_MODE=5,Texture.INVCUBIC_MODE=6,Texture.EQUIRECTANGULAR_MODE=7,Texture.FIXED_EQUIRECTANGULAR_MODE=8,Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Texture.CLAMP_ADDRESSMODE=0,Texture.WRAP_ADDRESSMODE=1,Texture.MIRROR_ADDRESSMODE=2,__decorate([BABYLON.serialize()],Texture.prototype,"url",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"uOffset",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"vOffset",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"uScale",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"vScale",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"uAng",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"vAng",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"wAng",void 0),__decorate([BABYLON.serialize()],Texture.prototype,"isBlocking",null),Texture}(BABYLON.BaseTexture);BABYLON.Texture=Texture}(BABYLON||(BABYLON={}));!function(BABYLON){var _InstancesBatch=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}}();BABYLON._InstancesBatch=_InstancesBatch;var Mesh=function(_super){function Mesh(name,scene,parent,source,doNotCloneChildren,clonePhysicsImpostor){void 0===scene&&(scene=null),void 0===parent&&(parent=null),void 0===source&&(source=null),void 0===clonePhysicsImpostor&&(clonePhysicsImpostor=!0);var _this=_super.call(this,name,scene)||this;if(_this.onBeforeRenderObservable=new BABYLON.Observable,_this.onAfterRenderObservable=new BABYLON.Observable,_this.onBeforeDrawObservable=new BABYLON.Observable,_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NONE,_this.instances=new Array,_this._LODLevels=new Array,_this._visibleInstances={},_this._renderIdForInstances=new Array,_this._batchCache=new _InstancesBatch,_this._instancesBufferSize=2048,_this._originalBuilderSideOrientation=Mesh._DEFAULTSIDE,_this.overrideMaterialSideOrientation=null,_this._areNormalsFrozen=!1,_this._source=null,scene=_this.getScene(),source){_this._source=source,source._geometry&&source._geometry.applyToMesh(_this),BABYLON.Tools.DeepCopy(source,_this,["name","material","skeleton","instances","parent","uniqueId","source"],["_poseMatrix","_source"]),BABYLON.Tags&&BABYLON.Tags.HasTags(source)&&BABYLON.Tags.AddTagsTo(_this,BABYLON.Tags.GetTags(source,!0)),_this.metadata=source.metadata,_this.parent=source.parent,_this.setPivotMatrix(source.getPivotMatrix()),_this.id=name+"."+source.id,_this.material=source.material;var index;if(!doNotCloneChildren)for(var directDescendants=source.getDescendants(!0),index_1=0;index_1<directDescendants.length;index_1++){var child=directDescendants[index_1];child.clone&&child.clone(name+"."+child.name,_this)}var physicsEngine=_this.getScene().getPhysicsEngine();if(clonePhysicsImpostor&&physicsEngine){var impostor=physicsEngine.getImpostorForPhysicsObject(source);impostor&&(_this.physicsImpostor=impostor.clone(_this))}for(index=0;index<scene.particleSystems.length;index++){var system=scene.particleSystems[index];system.emitter===source&&system.clone(system.name,_this)}_this.computeWorldMatrix(!0)}return null!==parent&&(_this.parent=parent),_this}return __extends(Mesh,_super),Object.defineProperty(Mesh,"FRONTSIDE",{get:function(){return Mesh._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"BACKSIDE",{get:function(){return Mesh._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"DOUBLESIDE",{get:function(){return Mesh._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"DEFAULTSIDE",{get:function(){return Mesh._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"NO_CAP",{get:function(){return Mesh._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"CAP_START",{get:function(){return Mesh._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"CAP_END",{get:function(){return Mesh._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh,"CAP_ALL",{get:function(){return Mesh._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh.prototype,"onBeforeDraw",{set:function(callback){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(value){this._morphTargetManager!==value&&(this._morphTargetManager=value,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(Mesh.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Mesh.prototype.getClassName=function(){return"Mesh"},Mesh.prototype.toString=function(fullDetails){var ret=_super.prototype.toString.call(this,fullDetails);if(ret+=", n vertices: "+this.getTotalVertices(),ret+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)ret+=", animation[0]: "+this.animations[i].toString(fullDetails);if(fullDetails)if(this._geometry){var ib=this.getIndices(),vb=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);vb&&ib&&(ret+=", flat shading: "+(vb.length/3===ib.length?"YES":"NO"))}else ret+=", flat shading: UNKNOWN";return ret},Object.defineProperty(Mesh.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),Mesh.prototype._sortLODLevels=function(){this._LODLevels.sort(function(a,b){return a.distance<b.distance?1:a.distance>b.distance?-1:0})},Mesh.prototype.addLODLevel=function(distance,mesh){if(mesh&&mesh._masterMesh)return BABYLON.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var level=new BABYLON.Internals.MeshLODLevel(distance,mesh);return this._LODLevels.push(level),mesh&&(mesh._masterMesh=this),this._sortLODLevels(),this},Mesh.prototype.getLODLevelAtDistance=function(distance){for(var index=0;index<this._LODLevels.length;index++){var level=this._LODLevels[index];if(level.distance===distance)return level.mesh}return null},Mesh.prototype.removeLODLevel=function(mesh){for(var index=0;index<this._LODLevels.length;index++)this._LODLevels[index].mesh===mesh&&(this._LODLevels.splice(index,1),mesh&&(mesh._masterMesh=null));return this._sortLODLevels(),this},Mesh.prototype.getLOD=function(camera,boundingSphere){if(!this._LODLevels||0===this._LODLevels.length)return this;var bSphere,distanceToCamera=(bSphere=boundingSphere||this.getBoundingInfo().boundingSphere).centerWorld.subtract(camera.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>distanceToCamera)return this.onLODLevelSelection&&this.onLODLevelSelection(distanceToCamera,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var index=0;index<this._LODLevels.length;index++){var level=this._LODLevels[index];if(level.distance<distanceToCamera)return level.mesh&&(level.mesh._preActivate(),level.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(distanceToCamera,this,level.mesh),level.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(distanceToCamera,this,this),this},Object.defineProperty(Mesh.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Mesh.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},Mesh.prototype.getVerticesData=function(kind,copyWhenShared,forceCopy){return this._geometry?this._geometry.getVerticesData(kind,copyWhenShared,forceCopy):null},Mesh.prototype.getVertexBuffer=function(kind){return this._geometry?this._geometry.getVertexBuffer(kind):null},Mesh.prototype.isVerticesDataPresent=function(kind){return this._geometry?this._geometry.isVerticesDataPresent(kind):!!this._delayInfo&&-1!==this._delayInfo.indexOf(kind)},Mesh.prototype.isVertexBufferUpdatable=function(kind){return this._geometry?this._geometry.isVertexBufferUpdatable(kind):!!this._delayInfo&&-1!==this._delayInfo.indexOf(kind)},Mesh.prototype.getVerticesDataKinds=function(){if(!this._geometry){var result=new Array;return this._delayInfo&&this._delayInfo.forEach(function(kind,index,array){result.push(kind)}),result}return this._geometry.getVerticesDataKinds()},Mesh.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},Mesh.prototype.getIndices=function(copyWhenShared){return this._geometry?this._geometry.getIndices(copyWhenShared):[]},Object.defineProperty(Mesh.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),Mesh.prototype.isReady=function(){return this.delayLoadState!==BABYLON.Engine.DELAYLOADSTATE_LOADING&&_super.prototype.isReady.call(this)},Object.defineProperty(Mesh.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),Mesh.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},Mesh.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(Mesh.prototype,"overridenInstanceCount",{set:function(count){this._overridenInstanceCount=count},enumerable:!0,configurable:!0}),Mesh.prototype._preActivate=function(){var sceneRenderId=this.getScene().getRenderId();return this._preActivateId===sceneRenderId?this:(this._preActivateId=sceneRenderId,this._visibleInstances=null,this)},Mesh.prototype._preActivateForIntermediateRendering=function(renderId){return this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=renderId),this},Mesh.prototype._registerInstanceForRenderId=function(instance,renderId){return this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=renderId,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[renderId]||(this._visibleInstances[renderId]=new Array),this._visibleInstances[renderId].push(instance),this},Mesh.prototype.refreshBoundingInfo=function(){return this._refreshBoundingInfo(!1)},Mesh.prototype._refreshBoundingInfo=function(applySkeleton){if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var data=this._getPositionData(applySkeleton);if(data){var extend=BABYLON.Tools.ExtractMinAndMax(data,0,this.getTotalVertices());this._boundingInfo=new BABYLON.BoundingInfo(extend.minimum,extend.maximum)}if(this.subMeshes)for(var index=0;index<this.subMeshes.length;index++)this.subMeshes[index].refreshBoundingInfo();return this._updateBoundingInfo(),this},Mesh.prototype._getPositionData=function(applySkeleton){var data=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(data&&applySkeleton&&this.skeleton){data=data.slice();var matricesIndicesData=this.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind),matricesWeightsData=this.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind);if(matricesWeightsData&&matricesIndicesData)for(var needExtras=this.numBoneInfluencers>4,matricesIndicesExtraData=needExtras?this.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind):null,matricesWeightsExtraData=needExtras?this.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind):null,skeletonMatrices=this.skeleton.getTransformMatrices(this),tempVector=BABYLON.Tmp.Vector3[0],finalMatrix=BABYLON.Tmp.Matrix[0],tempMatrix=BABYLON.Tmp.Matrix[1],matWeightIdx=0,index=0;index<data.length;index+=3,matWeightIdx+=4){finalMatrix.reset();var inf,weight;for(inf=0;inf<4&&!((weight=matricesWeightsData[matWeightIdx+inf])<=0);inf++)BABYLON.Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,16*matricesIndicesData[matWeightIdx+inf],weight,tempMatrix),finalMatrix.addToSelf(tempMatrix);if(needExtras)for(inf=0;inf<4&&!((weight=matricesWeightsExtraData[matWeightIdx+inf])<=0);inf++)BABYLON.Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,16*matricesIndicesExtraData[matWeightIdx+inf],weight,tempMatrix),finalMatrix.addToSelf(tempMatrix);BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(data[index],data[index+1],data[index+2],finalMatrix,tempVector),tempVector.toArray(data,index)}}return data},Mesh.prototype._createGlobalSubMesh=function(force){var totalVertices=this.getTotalVertices();if(!totalVertices||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var ib=this.getIndices();if(!ib)return null;var totalIndices=ib.length,needToRecreate=!1;if(force)needToRecreate=!0;else for(var _i=0,_a=this.subMeshes;_i<_a.length;_i++){var submesh=_a[_i];if(submesh.indexStart+submesh.indexCount>=totalIndices){needToRecreate=!0;break}if(submesh.verticesStart+submesh.verticesCount>=totalVertices){needToRecreate=!0;break}}if(!needToRecreate)return this.subMeshes[0]}return this.releaseSubMeshes(),new BABYLON.SubMesh(0,0,totalVertices,0,this.getTotalIndices(),this)},Mesh.prototype.subdivide=function(count){if(!(count<1)){for(var totalIndices=this.getTotalIndices(),subdivisionSize=totalIndices/count|0,offset=0;subdivisionSize%3!=0;)subdivisionSize++;this.releaseSubMeshes();for(var index=0;index<count&&!(offset>=totalIndices);index++)BABYLON.SubMesh.CreateFromIndices(0,offset,Math.min(subdivisionSize,totalIndices-offset),this),offset+=subdivisionSize;this.synchronizeInstances()}},Mesh.prototype.setVerticesData=function(kind,data,updatable,stride){if(void 0===updatable&&(updatable=!1),this._geometry)this._geometry.setVerticesData(kind,data,updatable,stride);else{var vertexData=new BABYLON.VertexData;vertexData.set(data,kind);var scene=this.getScene();new BABYLON.Geometry(BABYLON.Geometry.RandomId(),scene,vertexData,updatable,this)}return this},Mesh.prototype.markVerticesDataAsUpdatable=function(kind,updatable){void 0===updatable&&(updatable=!0);var vb=this.getVertexBuffer(kind);vb&&vb.isUpdatable()!==updatable&&this.setVerticesData(kind,this.getVerticesData(kind),updatable)},Mesh.prototype.setVerticesBuffer=function(buffer){return this._geometry||(this._geometry=BABYLON.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(buffer),this},Mesh.prototype.updateVerticesData=function(kind,data,updateExtends,makeItUnique){return this._geometry?(makeItUnique?(this.makeGeometryUnique(),this.updateVerticesData(kind,data,updateExtends,!1)):this._geometry.updateVerticesData(kind,data,updateExtends),this):this},Mesh.prototype.updateMeshPositions=function(positionFunction,computeNormals){void 0===computeNormals&&(computeNormals=!0);var positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!positions)return this;if(positionFunction(positions),this.updateVerticesData(BABYLON.VertexBuffer.PositionKind,positions,!1,!1),computeNormals){var indices=this.getIndices(),normals=this.getVerticesData(BABYLON.VertexBuffer.NormalKind);if(!normals)return this;BABYLON.VertexData.ComputeNormals(positions,indices,normals),this.updateVerticesData(BABYLON.VertexBuffer.NormalKind,normals,!1,!1)}return this},Mesh.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var oldGeometry=this._geometry,geometry=this._geometry.copy(BABYLON.Geometry.RandomId());return oldGeometry.releaseForMesh(this,!0),geometry.applyToMesh(this),this},Mesh.prototype.setIndices=function(indices,totalVertices,updatable){if(void 0===totalVertices&&(totalVertices=null),void 0===updatable&&(updatable=!1),this._geometry)this._geometry.setIndices(indices,totalVertices,updatable);else{var vertexData=new BABYLON.VertexData;vertexData.indices=indices;var scene=this.getScene();new BABYLON.Geometry(BABYLON.Geometry.RandomId(),scene,vertexData,updatable,this)}return this},Mesh.prototype.updateIndices=function(indices,offset){return this._geometry?(this._geometry.updateIndices(indices,offset),this):this},Mesh.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},Mesh.prototype._bind=function(subMesh,effect,fillMode){if(!this._geometry)return this;var indexToBind,engine=this.getScene().getEngine();if(this._unIndexed)indexToBind=null;else switch(fillMode){case BABYLON.Material.PointFillMode:indexToBind=null;break;case BABYLON.Material.WireFrameFillMode:indexToBind=subMesh.getLinesIndexBuffer(this.getIndices(),engine);break;default:case BABYLON.Material.TriangleFillMode:indexToBind=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(effect,indexToBind),this},Mesh.prototype._draw=function(subMesh,fillMode,instancesCount,alternate){if(void 0===alternate&&(alternate=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._geometry.getIndexBuffer())return this;this.onBeforeDrawObservable.notifyObservers(this);var scene=this.getScene(),engine=scene.getEngine();switch(fillMode){case BABYLON.Material.PointFillMode:engine.drawPointClouds(subMesh.verticesStart,subMesh.verticesCount,instancesCount);break;case BABYLON.Material.WireFrameFillMode:this._unIndexed?engine.drawUnIndexed(!1,subMesh.verticesStart,subMesh.verticesCount,instancesCount):engine.draw(!1,0,subMesh.linesIndexCount,instancesCount);break;default:this._unIndexed?engine.drawUnIndexed(!0,subMesh.verticesStart,subMesh.verticesCount,instancesCount):engine.draw(!0,subMesh.indexStart,subMesh.indexCount,instancesCount)}if(scene._isAlternateRenderingEnabled&&!alternate){var effect=subMesh.effect||this._effectiveMaterial.getEffect();if(!effect||!scene.activeCamera)return this;scene._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(effect),this._effectiveMaterial.bindViewProjection(effect),engine.setViewport(scene.activeCamera._alternateCamera.viewport),this._draw(subMesh,fillMode,instancesCount,!0),engine.setViewport(scene.activeCamera.viewport),scene._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(effect),this._effectiveMaterial.bindViewProjection(effect)}return this},Mesh.prototype.registerBeforeRender=function(func){return this.onBeforeRenderObservable.add(func),this},Mesh.prototype.unregisterBeforeRender=function(func){return this.onBeforeRenderObservable.removeCallback(func),this},Mesh.prototype.registerAfterRender=function(func){return this.onAfterRenderObservable.add(func),this},Mesh.prototype.unregisterAfterRender=function(func){return this.onAfterRenderObservable.removeCallback(func),this},Mesh.prototype._getInstancesRenderList=function(subMeshId){var scene=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[subMeshId]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[subMeshId]=null,this._visibleInstances){var currentRenderId=scene.getRenderId(),defaultRenderId=scene._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[subMeshId]=this._visibleInstances[currentRenderId];var selfRenderId=this._renderId;!this._batchCache.visibleInstances[subMeshId]&&defaultRenderId&&(this._batchCache.visibleInstances[subMeshId]=this._visibleInstances[defaultRenderId],currentRenderId=Math.max(defaultRenderId,currentRenderId),selfRenderId=Math.max(this._visibleInstances.selfDefaultRenderId,currentRenderId));var visibleInstancesForSubMesh=this._batchCache.visibleInstances[subMeshId];if(visibleInstancesForSubMesh&&visibleInstancesForSubMesh.length){if(this._renderIdForInstances[subMeshId]===currentRenderId)return this._batchCache.mustReturn=!0,this._batchCache;currentRenderId!==selfRenderId&&(this._batchCache.renderSelf[subMeshId]=!1)}this._renderIdForInstances[subMeshId]=currentRenderId}return this._batchCache},Mesh.prototype._renderWithInstances=function(subMesh,fillMode,batch,effect,engine){var visibleInstances=batch.visibleInstances[subMesh._id];if(!visibleInstances)return this;for(var bufferSize=16*(visibleInstances.length+1)*4,currentInstancesBufferSize=this._instancesBufferSize,instancesBuffer=this._instancesBuffer;this._instancesBufferSize<bufferSize;)this._instancesBufferSize*=2;this._instancesData&&currentInstancesBufferSize==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var offset=0,instancesCount=0,world=this.getWorldMatrix();if(batch.renderSelf[subMesh._id]&&(world.copyToArray(this._instancesData,offset),offset+=16,instancesCount++),visibleInstances)for(var instanceIndex=0;instanceIndex<visibleInstances.length;instanceIndex++)visibleInstances[instanceIndex].getWorldMatrix().copyToArray(this._instancesData,offset),offset+=16,instancesCount++;return instancesBuffer&&currentInstancesBufferSize==this._instancesBufferSize?instancesBuffer.updateDirectly(this._instancesData,0,instancesCount):(instancesBuffer&&instancesBuffer.dispose(),instancesBuffer=new BABYLON.Buffer(engine,this._instancesData,!0,16,!1,!0),this._instancesBuffer=instancesBuffer,this.setVerticesBuffer(instancesBuffer.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(instancesBuffer.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(instancesBuffer.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(instancesBuffer.createVertexBuffer("world3",12,4))),this._bind(subMesh,effect,fillMode),this._draw(subMesh,fillMode,instancesCount),engine.unbindInstanceAttributes(),this},Mesh.prototype._processRendering=function(subMesh,effect,fillMode,batch,hardwareInstancedRendering,onBeforeDraw,effectiveMaterial){var engine=this.getScene().getEngine();if(hardwareInstancedRendering)this._renderWithInstances(subMesh,fillMode,batch,effect,engine);else{batch.renderSelf[subMesh._id]&&(onBeforeDraw&&onBeforeDraw(!1,this.getWorldMatrix(),effectiveMaterial),this._draw(subMesh,fillMode,this._overridenInstanceCount));var visibleInstancesForSubMesh=batch.visibleInstances[subMesh._id];if(visibleInstancesForSubMesh)for(var instanceIndex=0;instanceIndex<visibleInstancesForSubMesh.length;instanceIndex++){var world=visibleInstancesForSubMesh[instanceIndex].getWorldMatrix();onBeforeDraw&&onBeforeDraw(!0,world,effectiveMaterial),this._draw(subMesh,fillMode)}}return this},Mesh.prototype.render=function(subMesh,enableAlphaMode){if(this.checkOcclusionQuery(),this._isOccluded)return this;var scene=this.getScene(),batch=this._getInstancesRenderList(subMesh._id);if(batch.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._geometry.getIndexBuffer())return this;this.onBeforeRenderObservable.notifyObservers(this);var engine=scene.getEngine(),hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id]&&void 0!==batch.visibleInstances[subMesh._id],material=subMesh.getMaterial();if(!material)return this;if(this._effectiveMaterial=material,this._effectiveMaterial.storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,subMesh,hardwareInstancedRendering))return this}else if(!this._effectiveMaterial.isReady(this,hardwareInstancedRendering))return this;enableAlphaMode&&engine.setAlphaMode(this._effectiveMaterial.alphaMode);var savedDepthWrite=engine.getDepthWrite();this.renderOutline&&(engine.setDepthWrite(!1),scene.getOutlineRenderer().render(subMesh,batch),engine.setDepthWrite(savedDepthWrite));var effect;if(!(effect=this._effectiveMaterial.storeEffectOnSubMeshes?subMesh.effect:this._effectiveMaterial.getEffect()))return this;var reverse=this._effectiveMaterial._preBind(effect,this.overrideMaterialSideOrientation);this._effectiveMaterial.forceDepthWrite&&engine.setDepthWrite(!0);var fillMode=scene.forcePointsCloud?BABYLON.Material.PointFillMode:scene.forceWireframe?BABYLON.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;hardwareInstancedRendering||this._bind(subMesh,effect,fillMode);var world=this.getWorldMatrix();if(this._effectiveMaterial.storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(world,this,subMesh):this._effectiveMaterial.bind(world,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(engine.setState(!0,this._effectiveMaterial.zOffset,!1,!reverse),this._processRendering(subMesh,effect,fillMode,batch,hardwareInstancedRendering,this._onBeforeDraw,this._effectiveMaterial),engine.setState(!0,this._effectiveMaterial.zOffset,!1,reverse)),this._processRendering(subMesh,effect,fillMode,batch,hardwareInstancedRendering,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind(),this.renderOutline&&savedDepthWrite&&(engine.setDepthWrite(!0),engine.setColorWrite(!1),scene.getOutlineRenderer().render(subMesh,batch),engine.setColorWrite(!0)),this.renderOverlay){var currentMode=engine.getAlphaMode();engine.setAlphaMode(BABYLON.Engine.ALPHA_COMBINE),scene.getOutlineRenderer().render(subMesh,batch,!0),engine.setAlphaMode(currentMode)}return this.onAfterRenderObservable.notifyObservers(this),this},Mesh.prototype._onBeforeDraw=function(isInstance,world,effectiveMaterial){isInstance&&effectiveMaterial&&effectiveMaterial.bindOnlyWorldMatrix(world)},Mesh.prototype.getEmittedParticleSystems=function(){for(var results=new Array,index=0;index<this.getScene().particleSystems.length;index++){var particleSystem=this.getScene().particleSystems[index];particleSystem.emitter===this&&results.push(particleSystem)}return results},Mesh.prototype.getHierarchyEmittedParticleSystems=function(){var results=new Array,descendants=this.getDescendants();descendants.push(this);for(var index=0;index<this.getScene().particleSystems.length;index++){var particleSystem=this.getScene().particleSystems[index],emitter=particleSystem.emitter;emitter.position&&-1!==descendants.indexOf(emitter)&&results.push(particleSystem)}return results},Mesh.prototype._checkDelayState=function(){var scene=this.getScene();return this._geometry?this._geometry.load(scene):this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(scene)),this},Mesh.prototype._queueLoad=function(scene){var _this=this;scene._addPendingData(this);var getBinaryData=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return BABYLON.Tools.LoadFile(this.delayLoadingFile,function(data){data instanceof ArrayBuffer?_this._delayLoadingFunction(data,_this):_this._delayLoadingFunction(JSON.parse(data),_this),_this.instances.forEach(function(instance){instance._syncSubMeshes()}),_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,scene._removePendingData(_this)},function(){},scene.database,getBinaryData),this},Mesh.prototype.isInFrustum=function(frustumPlanes){return this.delayLoadState!==BABYLON.Engine.DELAYLOADSTATE_LOADING&&(!!_super.prototype.isInFrustum.call(this,frustumPlanes)&&(this._checkDelayState(),!0))},Mesh.prototype.setMaterialByID=function(id){var index,materials=this.getScene().materials;for(index=materials.length-1;index>-1;index--)if(materials[index].id===id)return this.material=materials[index],this;var multiMaterials=this.getScene().multiMaterials;for(index=multiMaterials.length-1;index>-1;index--)if(multiMaterials[index].id===id)return this.material=multiMaterials[index],this;return this},Mesh.prototype.getAnimatables=function(){var results=new Array;return this.material&&results.push(this.material),this.skeleton&&results.push(this.skeleton),results},Mesh.prototype.bakeTransformIntoVertices=function(transform){if(!this.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind))return this;var submeshes=this.subMeshes.splice(0);this._resetPointsArrayCache();var index,data=this.getVerticesData(BABYLON.VertexBuffer.PositionKind),temp=new Array;for(index=0;index<data.length;index+=3)BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.FromArray(data,index),transform).toArray(temp,index);if(this.setVerticesData(BABYLON.VertexBuffer.PositionKind,temp,this.getVertexBuffer(BABYLON.VertexBuffer.PositionKind).isUpdatable()),!this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind))return this;for(data=this.getVerticesData(BABYLON.VertexBuffer.NormalKind),temp=[],index=0;index<data.length;index+=3)BABYLON.Vector3.TransformNormal(BABYLON.Vector3.FromArray(data,index),transform).normalize().toArray(temp,index);return this.setVerticesData(BABYLON.VertexBuffer.NormalKind,temp,this.getVertexBuffer(BABYLON.VertexBuffer.NormalKind).isUpdatable()),transform.m[0]*transform.m[5]*transform.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=submeshes,this},Mesh.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=BABYLON.Quaternion.Identity()),this._worldMatrix=BABYLON.Matrix.Identity(),this},Object.defineProperty(Mesh.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),Mesh.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},Mesh.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},Mesh.prototype.clone=function(name,newParent,doNotCloneChildren,clonePhysicsImpostor){return void 0===clonePhysicsImpostor&&(clonePhysicsImpostor=!0),new Mesh(name,this.getScene(),newParent,this,doNotCloneChildren,clonePhysicsImpostor)},Mesh.prototype.dispose=function(doNotRecurse,disposeMaterialAndTextures){var _this=this;for(void 0===disposeMaterialAndTextures&&(disposeMaterialAndTextures=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this.getScene().meshes.forEach(function(abstractMesh){var mesh=abstractMesh;mesh._source&&mesh._source===_this&&(mesh._source=null)}),this._source=null,this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var highlightLayers=this.getScene().highlightLayers,i=0;i<highlightLayers.length;i++){var highlightLayer=highlightLayers[i];highlightLayer&&(highlightLayer.removeMesh(this),highlightLayer.removeExcludedMesh(this))}_super.prototype.dispose.call(this,doNotRecurse,disposeMaterialAndTextures)},Mesh.prototype.applyDisplacementMap=function(url,minHeight,maxHeight,onSuccess,uvOffset,uvScale){var _this=this,scene=this.getScene();return BABYLON.Tools.LoadImage(url,function(img){var canvas=document.createElement("canvas"),context=canvas.getContext("2d"),heightMapWidth=img.width,heightMapHeight=img.height;canvas.width=heightMapWidth,canvas.height=heightMapHeight,context.drawImage(img,0,0);var buffer=context.getImageData(0,0,heightMapWidth,heightMapHeight).data;_this.applyDisplacementMapFromBuffer(buffer,heightMapWidth,heightMapHeight,minHeight,maxHeight,uvOffset,uvScale),onSuccess&&onSuccess(_this)},function(){},scene.database),this},Mesh.prototype.applyDisplacementMapFromBuffer=function(buffer,heightMapWidth,heightMapHeight,minHeight,maxHeight,uvOffset,uvScale){if(!this.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind))return BABYLON.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind),normals=this.getVerticesData(BABYLON.VertexBuffer.NormalKind),uvs=this.getVerticesData(BABYLON.VertexBuffer.UVKind),position=BABYLON.Vector3.Zero(),normal=BABYLON.Vector3.Zero(),uv=BABYLON.Vector2.Zero();uvOffset=uvOffset||BABYLON.Vector2.Zero(),uvScale=uvScale||new BABYLON.Vector2(1,1);for(var index=0;index<positions.length;index+=3){BABYLON.Vector3.FromArrayToRef(positions,index,position),BABYLON.Vector3.FromArrayToRef(normals,index,normal),BABYLON.Vector2.FromArrayToRef(uvs,index/3*2,uv);var pos=4*((Math.abs(uv.x*uvScale.x+uvOffset.x)*heightMapWidth%heightMapWidth|0)+(Math.abs(uv.y*uvScale.y+uvOffset.y)*heightMapHeight%heightMapHeight|0)*heightMapWidth),gradient=.3*(buffer[pos]/255)+.59*(buffer[pos+1]/255)+.11*(buffer[pos+2]/255);normal.normalize(),normal.scaleInPlace(minHeight+(maxHeight-minHeight)*gradient),(position=position.add(normal)).toArray(positions,index)}return BABYLON.VertexData.ComputeNormals(positions,this.getIndices(),normals),this.updateVerticesData(BABYLON.VertexBuffer.PositionKind,positions),this.updateVerticesData(BABYLON.VertexBuffer.NormalKind,normals),this},Mesh.prototype.convertToFlatShadedMesh=function(){var kindIndex,kind,kinds=this.getVerticesDataKinds(),vbs={},data={},newdata={},updatableNormals=!1;for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];var vertexBuffer=this.getVertexBuffer(kind);kind!==BABYLON.VertexBuffer.NormalKind?(vbs[kind]=vertexBuffer,data[kind]=vbs[kind].getData(),newdata[kind]=[]):(updatableNormals=vertexBuffer.isUpdatable(),kinds.splice(kindIndex,1),kindIndex--)}var index,previousSubmeshes=this.subMeshes.slice(0),indices=this.getIndices(),totalIndices=this.getTotalIndices();for(index=0;index<totalIndices;index++){var vertexIndex=indices[index];for(kindIndex=0;kindIndex<kinds.length;kindIndex++)for(var stride=vbs[kind=kinds[kindIndex]].getStrideSize(),offset=0;offset<stride;offset++)newdata[kind].push(data[kind][vertexIndex*stride+offset])}var normals=[],positions=newdata[BABYLON.VertexBuffer.PositionKind];for(index=0;index<totalIndices;index+=3){indices[index]=index,indices[index+1]=index+1,indices[index+2]=index+2;for(var p1=BABYLON.Vector3.FromArray(positions,3*index),p2=BABYLON.Vector3.FromArray(positions,3*(index+1)),p3=BABYLON.Vector3.FromArray(positions,3*(index+2)),p1p2=p1.subtract(p2),p3p2=p3.subtract(p2),normal=BABYLON.Vector3.Normalize(BABYLON.Vector3.Cross(p1p2,p3p2)),localIndex=0;localIndex<3;localIndex++)normals.push(normal.x),normals.push(normal.y),normals.push(normal.z)}for(this.setIndices(indices),this.setVerticesData(BABYLON.VertexBuffer.NormalKind,normals,updatableNormals),kindIndex=0;kindIndex<kinds.length;kindIndex++)kind=kinds[kindIndex],this.setVerticesData(kind,newdata[kind],vbs[kind].isUpdatable());this.releaseSubMeshes();for(var submeshIndex=0;submeshIndex<previousSubmeshes.length;submeshIndex++){var previousOne=previousSubmeshes[submeshIndex];BABYLON.SubMesh.AddToMesh(previousOne.materialIndex,previousOne.indexStart,previousOne.indexCount,previousOne.indexStart,previousOne.indexCount,this)}return this.synchronizeInstances(),this},Mesh.prototype.convertToUnIndexedMesh=function(){var kindIndex,kind,kinds=this.getVerticesDataKinds(),vbs={},data={},newdata={};for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];var vertexBuffer=this.getVertexBuffer(kind);vbs[kind]=vertexBuffer,data[kind]=vbs[kind].getData(),newdata[kind]=[]}var index,previousSubmeshes=this.subMeshes.slice(0),indices=this.getIndices(),totalIndices=this.getTotalIndices();for(index=0;index<totalIndices;index++){var vertexIndex=indices[index];for(kindIndex=0;kindIndex<kinds.length;kindIndex++)for(var stride=vbs[kind=kinds[kindIndex]].getStrideSize(),offset=0;offset<stride;offset++)newdata[kind].push(data[kind][vertexIndex*stride+offset])}for(index=0;index<totalIndices;index+=3)indices[index]=index,indices[index+1]=index+1,indices[index+2]=index+2;for(this.setIndices(indices),kindIndex=0;kindIndex<kinds.length;kindIndex++)kind=kinds[kindIndex],this.setVerticesData(kind,newdata[kind],vbs[kind].isUpdatable());this.releaseSubMeshes();for(var submeshIndex=0;submeshIndex<previousSubmeshes.length;submeshIndex++){var previousOne=previousSubmeshes[submeshIndex];BABYLON.SubMesh.AddToMesh(previousOne.materialIndex,previousOne.indexStart,previousOne.indexCount,previousOne.indexStart,previousOne.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},Mesh.prototype.flipFaces=function(flipNormals){void 0===flipNormals&&(flipNormals=!1);var i,vertex_data=BABYLON.VertexData.ExtractFromMesh(this);if(flipNormals&&this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)&&vertex_data.normals)for(i=0;i<vertex_data.normals.length;i++)vertex_data.normals[i]*=-1;if(vertex_data.indices){var temp;for(i=0;i<vertex_data.indices.length;i+=3)temp=vertex_data.indices[i+1],vertex_data.indices[i+1]=vertex_data.indices[i+2],vertex_data.indices[i+2]=temp}return vertex_data.applyToMesh(this),this},Mesh.prototype.createInstance=function(name){return new BABYLON.InstancedMesh(name,this)},Mesh.prototype.synchronizeInstances=function(){for(var instanceIndex=0;instanceIndex<this.instances.length;instanceIndex++)this.instances[instanceIndex]._syncSubMeshes();return this},Mesh.prototype.simplify=function(settings,parallelProcessing,simplificationType,successCallback){return void 0===parallelProcessing&&(parallelProcessing=!0),void 0===simplificationType&&(simplificationType=BABYLON.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:settings,parallelProcessing:parallelProcessing,mesh:this,simplificationType:simplificationType,successCallback:successCallback}),this},Mesh.prototype.optimizeIndices=function(successCallback){var _this=this,indices=this.getIndices(),positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!positions||!indices)return this;for(var vectorPositions=new Array,pos=0;pos<positions.length;pos+=3)vectorPositions.push(BABYLON.Vector3.FromArray(positions,pos));var dupes=new Array;return BABYLON.AsyncLoop.SyncAsyncForLoop(vectorPositions.length,40,function(iteration){for(var realPos=vectorPositions.length-1-iteration,testedPosition=vectorPositions[realPos],j=0;j<realPos;++j){var againstPosition=vectorPositions[j];if(testedPosition.equals(againstPosition)){dupes[realPos]=j;break}}},function(){for(var i=0;i<indices.length;++i)indices[i]=dupes[indices[i]]||indices[i];var originalSubMeshes=_this.subMeshes.slice(0);_this.setIndices(indices),_this.subMeshes=originalSubMeshes,successCallback&&successCallback(_this)}),this},Mesh.prototype.serialize=function(serializationObject){serializationObject.name=this.name,serializationObject.id=this.id,serializationObject.type=this.getClassName(),BABYLON.Tags&&BABYLON.Tags.HasTags(this)&&(serializationObject.tags=BABYLON.Tags.GetTags(this)),serializationObject.position=this.position.asArray(),this.rotationQuaternion?serializationObject.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(serializationObject.rotation=this.rotation.asArray()),serializationObject.scaling=this.scaling.asArray(),serializationObject.localMatrix=this.getPivotMatrix().asArray(),serializationObject.isEnabled=this.isEnabled(),serializationObject.isVisible=this.isVisible,serializationObject.infiniteDistance=this.infiniteDistance,serializationObject.pickable=this.isPickable,serializationObject.receiveShadows=this.receiveShadows,serializationObject.billboardMode=this.billboardMode,serializationObject.visibility=this.visibility,serializationObject.checkCollisions=this.checkCollisions,serializationObject.isBlocker=this.isBlocker,this.parent&&(serializationObject.parentId=this.parent.id);var geometry=this._geometry;if(geometry){var geometryId=geometry.id;serializationObject.geometryId=geometryId,serializationObject.subMeshes=[];for(var subIndex=0;subIndex<this.subMeshes.length;subIndex++){var subMesh=this.subMeshes[subIndex];serializationObject.subMeshes.push({materialIndex:subMesh.materialIndex,verticesStart:subMesh.verticesStart,verticesCount:subMesh.verticesCount,indexStart:subMesh.indexStart,indexCount:subMesh.indexCount})}}this.material?serializationObject.materialId=this.material.id:this.material=null,this.morphTargetManager&&(serializationObject.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(serializationObject.skeletonId=this.skeleton.id);var impostor=this.getPhysicsImpostor();impostor&&(serializationObject.physicsMass=impostor.getParam("mass"),serializationObject.physicsFriction=impostor.getParam("friction"),serializationObject.physicsRestitution=impostor.getParam("mass"),serializationObject.physicsImpostor=impostor.type),this.metadata&&(serializationObject.metadata=this.metadata),serializationObject.instances=[];for(var index=0;index<this.instances.length;index++){var instance=this.instances[index],serializationInstance={name:instance.name,id:instance.id,position:instance.position.asArray(),scaling:instance.scaling.asArray()};instance.rotationQuaternion?serializationInstance.rotationQuaternion=instance.rotationQuaternion.asArray():instance.rotation&&(serializationInstance.rotation=instance.rotation.asArray()),serializationObject.instances.push(serializationInstance),BABYLON.Animation.AppendSerializedAnimations(instance,serializationInstance),serializationInstance.ranges=instance.serializeAnimationRanges()}BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject.ranges=this.serializeAnimationRanges(),serializationObject.layerMask=this.layerMask,serializationObject.alphaIndex=this.alphaIndex,serializationObject.hasVertexAlpha=this.hasVertexAlpha,serializationObject.overlayAlpha=this.overlayAlpha,serializationObject.overlayColor=this.overlayColor.asArray(),serializationObject.renderOverlay=this.renderOverlay,serializationObject.applyFog=this.applyFog,this.actionManager&&(serializationObject.actions=this.actionManager.serialize(this.name))},Mesh.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var morphTargetManager=this._morphTargetManager;if(morphTargetManager&&morphTargetManager.vertexCount){if(morphTargetManager.vertexCount!==this.getTotalVertices())return BABYLON.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(index=0;index<morphTargetManager.numInfluencers;index++){var morphTarget=morphTargetManager.getActiveTarget(index),positions=morphTarget.getPositions();if(!positions)return void BABYLON.Tools.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(BABYLON.VertexBuffer.PositionKind+index,positions,!1,3);var normals=morphTarget.getNormals();normals&&this.geometry.setVerticesData(BABYLON.VertexBuffer.NormalKind+index,normals,!1,3);var tangents=morphTarget.getTangents();tangents&&this.geometry.setVerticesData(BABYLON.VertexBuffer.TangentKind+index,tangents,!1,3)}}else for(var index=0;this.geometry.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind+index);)this.geometry.removeVerticesData(BABYLON.VertexBuffer.PositionKind+index),this.geometry.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind+index)&&this.geometry.removeVerticesData(BABYLON.VertexBuffer.NormalKind+index),this.geometry.isVerticesDataPresent(BABYLON.VertexBuffer.TangentKind+index)&&this.geometry.removeVerticesData(BABYLON.VertexBuffer.TangentKind+index),index++}},Mesh.Parse=function(parsedMesh,scene,rootUrl){var mesh;if(mesh=parsedMesh.type&&"GroundMesh"===parsedMesh.type?BABYLON.GroundMesh.Parse(parsedMesh,scene):new Mesh(parsedMesh.name,scene),mesh.id=parsedMesh.id,BABYLON.Tags&&BABYLON.Tags.AddTagsTo(mesh,parsedMesh.tags),mesh.position=BABYLON.Vector3.FromArray(parsedMesh.position),void 0!==parsedMesh.metadata&&(mesh.metadata=parsedMesh.metadata),parsedMesh.rotationQuaternion?mesh.rotationQuaternion=BABYLON.Quaternion.FromArray(parsedMesh.rotationQuaternion):parsedMesh.rotation&&(mesh.rotation=BABYLON.Vector3.FromArray(parsedMesh.rotation)),mesh.scaling=BABYLON.Vector3.FromArray(parsedMesh.scaling),parsedMesh.localMatrix?mesh.setPivotMatrix(BABYLON.Matrix.FromArray(parsedMesh.localMatrix)):parsedMesh.pivotMatrix&&mesh.setPivotMatrix(BABYLON.Matrix.FromArray(parsedMesh.pivotMatrix)),mesh.setEnabled(parsedMesh.isEnabled),mesh.isVisible=parsedMesh.isVisible,mesh.infiniteDistance=parsedMesh.infiniteDistance,mesh.showBoundingBox=parsedMesh.showBoundingBox,mesh.showSubMeshesBoundingBox=parsedMesh.showSubMeshesBoundingBox,void 0!==parsedMesh.applyFog&&(mesh.applyFog=parsedMesh.applyFog),void 0!==parsedMesh.pickable&&(mesh.isPickable=parsedMesh.pickable),void 0!==parsedMesh.alphaIndex&&(mesh.alphaIndex=parsedMesh.alphaIndex),mesh.receiveShadows=parsedMesh.receiveShadows,mesh.billboardMode=parsedMesh.billboardMode,void 0!==parsedMesh.visibility&&(mesh.visibility=parsedMesh.visibility),mesh.checkCollisions=parsedMesh.checkCollisions,void 0!==parsedMesh.isBlocker&&(mesh.isBlocker=parsedMesh.isBlocker),mesh._shouldGenerateFlatShading=parsedMesh.useFlatShading,parsedMesh.freezeWorldMatrix&&(mesh._waitingFreezeWorldMatrix=parsedMesh.freezeWorldMatrix),parsedMesh.parentId&&(mesh._waitingParentId=parsedMesh.parentId),void 0!==parsedMesh.actions&&(mesh._waitingActions=parsedMesh.actions),void 0!==parsedMesh.overlayAlpha&&(mesh.overlayAlpha=parsedMesh.overlayAlpha),void 0!==parsedMesh.overlayColor&&(mesh.overlayColor=BABYLON.Color3.FromArray(parsedMesh.overlayColor)),void 0!==parsedMesh.renderOverlay&&(mesh.renderOverlay=parsedMesh.renderOverlay),mesh.hasVertexAlpha=parsedMesh.hasVertexAlpha,parsedMesh.delayLoadingFile?(mesh.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED,mesh.delayLoadingFile=rootUrl+parsedMesh.delayLoadingFile,mesh._boundingInfo=new BABYLON.BoundingInfo(BABYLON.Vector3.FromArray(parsedMesh.boundingBoxMinimum),BABYLON.Vector3.FromArray(parsedMesh.boundingBoxMaximum)),parsedMesh._binaryInfo&&(mesh._binaryInfo=parsedMesh._binaryInfo),mesh._delayInfo=[],parsedMesh.hasUVs&&mesh._delayInfo.push(BABYLON.VertexBuffer.UVKind),parsedMesh.hasUVs2&&mesh._delayInfo.push(BABYLON.VertexBuffer.UV2Kind),parsedMesh.hasUVs3&&mesh._delayInfo.push(BABYLON.VertexBuffer.UV3Kind),parsedMesh.hasUVs4&&mesh._delayInfo.push(BABYLON.VertexBuffer.UV4Kind),parsedMesh.hasUVs5&&mesh._delayInfo.push(BABYLON.VertexBuffer.UV5Kind),parsedMesh.hasUVs6&&mesh._delayInfo.push(BABYLON.VertexBuffer.UV6Kind),parsedMesh.hasColors&&mesh._delayInfo.push(BABYLON.VertexBuffer.ColorKind),parsedMesh.hasMatricesIndices&&mesh._delayInfo.push(BABYLON.VertexBuffer.MatricesIndicesKind),parsedMesh.hasMatricesWeights&&mesh._delayInfo.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh._delayLoadingFunction=BABYLON.Geometry.ImportGeometry,BABYLON.SceneLoader.ForceFullSceneLoadingForIncremental&&mesh._checkDelayState()):BABYLON.Geometry.ImportGeometry(parsedMesh,mesh),parsedMesh.materialId?mesh.setMaterialByID(parsedMesh.materialId):mesh.material=null,parsedMesh.morphTargetManagerId>-1&&(mesh.morphTargetManager=scene.getMorphTargetManagerById(parsedMesh.morphTargetManagerId)),parsedMesh.skeletonId>-1&&(mesh.skeleton=scene.getLastSkeletonByID(parsedMesh.skeletonId),parsedMesh.numBoneInfluencers&&(mesh.numBoneInfluencers=parsedMesh.numBoneInfluencers)),parsedMesh.animations){for(var animationIndex=0;animationIndex<parsedMesh.animations.length;animationIndex++){var parsedAnimation=parsedMesh.animations[animationIndex];mesh.animations.push(BABYLON.Animation.Parse(parsedAnimation))}BABYLON.Node.ParseAnimationRanges(mesh,parsedMesh,scene)}if(parsedMesh.autoAnimate&&scene.beginAnimation(mesh,parsedMesh.autoAnimateFrom,parsedMesh.autoAnimateTo,parsedMesh.autoAnimateLoop,parsedMesh.autoAnimateSpeed||1),parsedMesh.layerMask&&!isNaN(parsedMesh.layerMask)?mesh.layerMask=Math.abs(parseInt(parsedMesh.layerMask)):mesh.layerMask=268435455,parsedMesh.physicsImpostor&&(mesh.physicsImpostor=new BABYLON.PhysicsImpostor(mesh,parsedMesh.physicsImpostor,{mass:parsedMesh.physicsMass,friction:parsedMesh.physicsFriction,restitution:parsedMesh.physicsRestitution},scene)),parsedMesh.instances)for(var index=0;index<parsedMesh.instances.length;index++){var parsedInstance=parsedMesh.instances[index],instance=mesh.createInstance(parsedInstance.name);if(parsedInstance.id&&(instance.id=parsedInstance.id),BABYLON.Tags&&BABYLON.Tags.AddTagsTo(instance,parsedInstance.tags),instance.position=BABYLON.Vector3.FromArray(parsedInstance.position),parsedInstance.parentId&&(instance._waitingParentId=parsedInstance.parentId),parsedInstance.rotationQuaternion?instance.rotationQuaternion=BABYLON.Quaternion.FromArray(parsedInstance.rotationQuaternion):parsedInstance.rotation&&(instance.rotation=BABYLON.Vector3.FromArray(parsedInstance.rotation)),instance.scaling=BABYLON.Vector3.FromArray(parsedInstance.scaling),instance.checkCollisions=mesh.checkCollisions,parsedMesh.animations){for(animationIndex=0;animationIndex<parsedMesh.animations.length;animationIndex++)parsedAnimation=parsedMesh.animations[animationIndex],instance.animations.push(BABYLON.Animation.Parse(parsedAnimation));BABYLON.Node.ParseAnimationRanges(instance,parsedMesh,scene)}}return mesh},Mesh.CreateRibbon=function(name,pathArray,closeArray,closePath,offset,scene,updatable,sideOrientation,instance){return void 0===closeArray&&(closeArray=!1),void 0===updatable&&(updatable=!1),BABYLON.MeshBuilder.CreateRibbon(name,{pathArray:pathArray,closeArray:closeArray,closePath:closePath,offset:offset,updatable:updatable,sideOrientation:sideOrientation,instance:instance},scene)},Mesh.CreateDisc=function(name,radius,tessellation,scene,updatable,sideOrientation){void 0===scene&&(scene=null);var options={radius:radius,tessellation:tessellation,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateDisc(name,options,scene)},Mesh.CreateBox=function(name,size,scene,updatable,sideOrientation){void 0===scene&&(scene=null);var options={size:size,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateBox(name,options,scene)},Mesh.CreateSphere=function(name,segments,diameter,scene,updatable,sideOrientation){var options={segments:segments,diameterX:diameter,diameterY:diameter,diameterZ:diameter,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateSphere(name,options,scene)},Mesh.CreateCylinder=function(name,height,diameterTop,diameterBottom,tessellation,subdivisions,scene,updatable,sideOrientation){void 0!==scene&&scene instanceof BABYLON.Scene||(void 0!==scene&&(sideOrientation=updatable||Mesh.DEFAULTSIDE,updatable=scene),scene=subdivisions,subdivisions=1);var options={height:height,diameterTop:diameterTop,diameterBottom:diameterBottom,tessellation:tessellation,subdivisions:subdivisions,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateCylinder(name,options,scene)},Mesh.CreateTorus=function(name,diameter,thickness,tessellation,scene,updatable,sideOrientation){var options={diameter:diameter,thickness:thickness,tessellation:tessellation,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateTorus(name,options,scene)},Mesh.CreateTorusKnot=function(name,radius,tube,radialSegments,tubularSegments,p,q,scene,updatable,sideOrientation){var options={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,p:p,q:q,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateTorusKnot(name,options,scene)},Mesh.CreateLines=function(name,points,scene,updatable,instance){void 0===scene&&(scene=null),void 0===updatable&&(updatable=!1),void 0===instance&&(instance=null);var options={points:points,updatable:updatable,instance:instance};return BABYLON.MeshBuilder.CreateLines(name,options,scene)},Mesh.CreateDashedLines=function(name,points,dashSize,gapSize,dashNb,scene,updatable,instance){void 0===scene&&(scene=null);var options={points:points,dashSize:dashSize,gapSize:gapSize,dashNb:dashNb,updatable:updatable,instance:instance};return BABYLON.MeshBuilder.CreateDashedLines(name,options,scene)},Mesh.CreatePolygon=function(name,shape,scene,holes,updatable,sideOrientation){var options={shape:shape,holes:holes,updatable:updatable,sideOrientation:sideOrientation};return BABYLON.MeshBuilder.CreatePolygon(name,options,scene)},Mesh.ExtrudePolygon=function(name,shape,depth,scene,holes,updatable,sideOrientation){var options={shape:shape,holes:holes,depth:depth,updatable:updatable,sideOrientation:sideOrientation};return BABYLON.MeshBuilder.ExtrudePolygon(name,options,scene)},Mesh.ExtrudeShape=function(name,shape,path,scale,rotation,cap,scene,updatable,sideOrientation,instance){void 0===scene&&(scene=null);var options={shape:shape,path:path,scale:scale,rotation:rotation,cap:0===cap?0:cap||Mesh.NO_CAP,sideOrientation:sideOrientation,instance:instance,updatable:updatable};return BABYLON.MeshBuilder.ExtrudeShape(name,options,scene)},Mesh.ExtrudeShapeCustom=function(name,shape,path,scaleFunction,rotationFunction,ribbonCloseArray,ribbonClosePath,cap,scene,updatable,sideOrientation,instance){var options={shape:shape,path:path,scaleFunction:scaleFunction,rotationFunction:rotationFunction,ribbonCloseArray:ribbonCloseArray,ribbonClosePath:ribbonClosePath,cap:0===cap?0:cap||Mesh.NO_CAP,sideOrientation:sideOrientation,instance:instance,updatable:updatable};return BABYLON.MeshBuilder.ExtrudeShapeCustom(name,options,scene)},Mesh.CreateLathe=function(name,shape,radius,tessellation,scene,updatable,sideOrientation){var options={shape:shape,radius:radius,tessellation:tessellation,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreateLathe(name,options,scene)},Mesh.CreatePlane=function(name,size,scene,updatable,sideOrientation){var options={size:size,width:size,height:size,sideOrientation:sideOrientation,updatable:updatable};return BABYLON.MeshBuilder.CreatePlane(name,options,scene)},Mesh.CreateGround=function(name,width,height,subdivisions,scene,updatable){var options={width:width,height:height,subdivisions:subdivisions,updatable:updatable};return BABYLON.MeshBuilder.CreateGround(name,options,scene)},Mesh.CreateTiledGround=function(name,xmin,zmin,xmax,zmax,subdivisions,precision,scene,updatable){var options={xmin:xmin,zmin:zmin,xmax:xmax,zmax:zmax,subdivisions:subdivisions,precision:precision,updatable:updatable};return BABYLON.MeshBuilder.CreateTiledGround(name,options,scene)},Mesh.CreateGroundFromHeightMap=function(name,url,width,height,subdivisions,minHeight,maxHeight,scene,updatable,onReady){var options={width:width,height:height,subdivisions:subdivisions,minHeight:minHeight,maxHeight:maxHeight,updatable:updatable,onReady:onReady};return BABYLON.MeshBuilder.CreateGroundFromHeightMap(name,url,options,scene)},Mesh.CreateTube=function(name,path,radius,tessellation,radiusFunction,cap,scene,updatable,sideOrientation,instance){var options={path:path,radius:radius,tessellation:tessellation,radiusFunction:radiusFunction,arc:1,cap:cap,updatable:updatable,sideOrientation:sideOrientation,instance:instance};return BABYLON.MeshBuilder.CreateTube(name,options,scene)},Mesh.CreatePolyhedron=function(name,options,scene){return BABYLON.MeshBuilder.CreatePolyhedron(name,options,scene)},Mesh.CreateIcoSphere=function(name,options,scene){return BABYLON.MeshBuilder.CreateIcoSphere(name,options,scene)},Mesh.CreateDecal=function(name,sourceMesh,position,normal,size,angle){var options={position:position,normal:normal,size:size,angle:angle};return BABYLON.MeshBuilder.CreateDecal(name,sourceMesh,options)},Mesh.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var source=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!source)return this._sourcePositions;this._sourcePositions=new Float32Array(source),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.PositionKind)||this.setVerticesData(BABYLON.VertexBuffer.PositionKind,source,!0)}return this._sourcePositions},Mesh.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var source=this.getVerticesData(BABYLON.VertexBuffer.NormalKind);if(!source)return this._sourceNormals;this._sourceNormals=new Float32Array(source),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.NormalKind)||this.setVerticesData(BABYLON.VertexBuffer.NormalKind,source,!0)}return this._sourceNormals},Mesh.prototype.applySkeleton=function(skeleton){if(!this.geometry)return this;if(this.geometry._softwareSkinningRenderId==this.getScene().getRenderId())return this;if(this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var submeshes=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=submeshes}this._sourceNormals||this.setNormalsForCPUSkinning();var positionsData=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!positionsData)return this;positionsData instanceof Float32Array||(positionsData=new Float32Array(positionsData));var normalsData=this.getVerticesData(BABYLON.VertexBuffer.NormalKind);if(!normalsData)return this;normalsData instanceof Float32Array||(normalsData=new Float32Array(normalsData));var matricesIndicesData=this.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind),matricesWeightsData=this.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind);if(!matricesWeightsData||!matricesIndicesData)return this;for(var inf,needExtras=this.numBoneInfluencers>4,matricesIndicesExtraData=needExtras?this.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind):null,matricesWeightsExtraData=needExtras?this.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind):null,skeletonMatrices=skeleton.getTransformMatrices(this),tempVector3=BABYLON.Vector3.Zero(),finalMatrix=new BABYLON.Matrix,tempMatrix=new BABYLON.Matrix,matWeightIdx=0,index=0;index<positionsData.length;index+=3,matWeightIdx+=4){var weight;for(inf=0;inf<4&&(weight=matricesWeightsData[matWeightIdx+inf])>0;inf++)BABYLON.Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,16*matricesIndicesData[matWeightIdx+inf],weight,tempMatrix),finalMatrix.addToSelf(tempMatrix);if(needExtras)for(inf=0;inf<4&&(weight=matricesWeightsExtraData[matWeightIdx+inf])>0;inf++)BABYLON.Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,16*matricesIndicesExtraData[matWeightIdx+inf],weight,tempMatrix),finalMatrix.addToSelf(tempMatrix);BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[index],this._sourcePositions[index+1],this._sourcePositions[index+2],finalMatrix,tempVector3),tempVector3.toArray(positionsData,index),BABYLON.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[index],this._sourceNormals[index+1],this._sourceNormals[index+2],finalMatrix,tempVector3),tempVector3.toArray(normalsData,index),finalMatrix.reset()}return this.updateVerticesData(BABYLON.VertexBuffer.PositionKind,positionsData),this.updateVerticesData(BABYLON.VertexBuffer.NormalKind,normalsData),this},Mesh.MinMax=function(meshes){var minVector=null,maxVector=null;return meshes.forEach(function(mesh,index,array){var boundingBox=mesh.getBoundingInfo().boundingBox;minVector&&maxVector?(minVector.MinimizeInPlace(boundingBox.minimumWorld),maxVector.MaximizeInPlace(boundingBox.maximumWorld)):(minVector=boundingBox.minimumWorld,maxVector=boundingBox.maximumWorld)}),minVector&&maxVector?{min:minVector,max:maxVector}:{min:BABYLON.Vector3.Zero(),max:BABYLON.Vector3.Zero()}},Mesh.Center=function(meshesOrMinMaxVector){var minMaxVector=meshesOrMinMaxVector instanceof Array?BABYLON.Mesh.MinMax(meshesOrMinMaxVector):meshesOrMinMaxVector;return BABYLON.Vector3.Center(minMaxVector.min,minMaxVector.max)},Mesh.MergeMeshes=function(meshes,disposeSource,allow32BitsIndices,meshSubclass,subdivideWithSubMeshes){void 0===disposeSource&&(disposeSource=!0);var index;if(!allow32BitsIndices){var totalVertices=0;for(index=0;index<meshes.length;index++)if(meshes[index]&&(totalVertices+=meshes[index].getTotalVertices())>65536)return BABYLON.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var otherVertexData,vertexData=null,indiceArray=new Array,source=null;for(index=0;index<meshes.length;index++)meshes[index]&&(meshes[index].computeWorldMatrix(!0),(otherVertexData=BABYLON.VertexData.ExtractFromMesh(meshes[index],!0)).transform(meshes[index].getWorldMatrix()),vertexData?vertexData.merge(otherVertexData):(vertexData=otherVertexData,source=meshes[index]),subdivideWithSubMeshes&&indiceArray.push(meshes[index].getTotalIndices()));if(source=source,meshSubclass||(meshSubclass=new Mesh(source.name+"_merged",source.getScene())),vertexData.applyToMesh(meshSubclass),meshSubclass.material=source.material,meshSubclass.checkCollisions=source.checkCollisions,disposeSource)for(index=0;index<meshes.length;index++)meshes[index]&&meshes[index].dispose();if(subdivideWithSubMeshes){meshSubclass.releaseSubMeshes(),index=0;for(var offset=0;index<indiceArray.length;)BABYLON.SubMesh.CreateFromIndices(0,offset,indiceArray[index],meshSubclass),offset+=indiceArray[index],index++}return meshSubclass},Mesh._FRONTSIDE=0,Mesh._BACKSIDE=1,Mesh._DOUBLESIDE=2,Mesh._DEFAULTSIDE=0,Mesh._NO_CAP=0,Mesh._CAP_START=1,Mesh._CAP_END=2,Mesh._CAP_ALL=3,Mesh}(BABYLON.AbstractMesh);BABYLON.Mesh=Mesh}(BABYLON||(BABYLON={}));!function(BABYLON){var BaseSubMesh=function(){function BaseSubMesh(){}return Object.defineProperty(BaseSubMesh.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),BaseSubMesh.prototype.setEffect=function(effect,defines){void 0===defines&&(defines=null),this._materialEffect!==effect?(this._materialDefines=defines,this._materialEffect=effect):effect||(this._materialDefines=null)},BaseSubMesh}();BABYLON.BaseSubMesh=BaseSubMesh;var SubMesh=function(_super){function SubMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh,createBoundingBox){void 0===createBoundingBox&&(createBoundingBox=!0);var _this=_super.call(this)||this;return _this.materialIndex=materialIndex,_this.verticesStart=verticesStart,_this.verticesCount=verticesCount,_this.indexStart=indexStart,_this.indexCount=indexCount,_this._renderId=0,_this._mesh=mesh,_this._renderingMesh=renderingMesh||mesh,mesh.subMeshes.push(_this),_this._trianglePlanes=[],_this._id=mesh.subMeshes.length-1,createBoundingBox&&(_this.refreshBoundingInfo(),mesh.computeWorldMatrix(!0)),_this}return __extends(SubMesh,_super),SubMesh.AddToMesh=function(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh,createBoundingBox){return void 0===createBoundingBox&&(createBoundingBox=!0),new SubMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh,createBoundingBox)},Object.defineProperty(SubMesh.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),SubMesh.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},SubMesh.prototype.setBoundingInfo=function(boundingInfo){return this._boundingInfo=boundingInfo,this},SubMesh.prototype.getMesh=function(){return this._mesh},SubMesh.prototype.getRenderingMesh=function(){return this._renderingMesh},SubMesh.prototype.getMaterial=function(){var rootMaterial=this._renderingMesh.material;if(rootMaterial&&rootMaterial.getSubMaterial){var effectiveMaterial=rootMaterial.getSubMaterial(this.materialIndex);return this._currentMaterial!==effectiveMaterial&&(this._currentMaterial=effectiveMaterial,this._materialDefines=null),effectiveMaterial}return rootMaterial||this._mesh.getScene().defaultMaterial},SubMesh.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var data=this._renderingMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!data)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var extend,indices=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===indices.length){var boundingInfo=this._renderingMesh.getBoundingInfo();extend={minimum:boundingInfo.minimum.clone(),maximum:boundingInfo.maximum.clone()}}else extend=BABYLON.Tools.ExtractMinAndMaxIndexed(data,indices,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo=new BABYLON.BoundingInfo(extend.minimum,extend.maximum),this},SubMesh.prototype._checkCollision=function(collider){return this._renderingMesh.getBoundingInfo()._checkCollision(collider)},SubMesh.prototype.updateBoundingInfo=function(world){var boundingInfo=this.getBoundingInfo();return boundingInfo||(this.refreshBoundingInfo(),boundingInfo=this.getBoundingInfo()),boundingInfo.update(world),this},SubMesh.prototype.isInFrustum=function(frustumPlanes){var boundingInfo=this.getBoundingInfo();return!!boundingInfo&&boundingInfo.isInFrustum(frustumPlanes)},SubMesh.prototype.isCompletelyInFrustum=function(frustumPlanes){var boundingInfo=this.getBoundingInfo();return!!boundingInfo&&boundingInfo.isCompletelyInFrustum(frustumPlanes)},SubMesh.prototype.render=function(enableAlphaMode){return this._renderingMesh.render(this,enableAlphaMode),this},SubMesh.prototype.getLinesIndexBuffer=function(indices,engine){if(!this._linesIndexBuffer){for(var linesIndices=[],index=this.indexStart;index<this.indexStart+this.indexCount;index+=3)linesIndices.push(indices[index],indices[index+1],indices[index+1],indices[index+2],indices[index+2],indices[index]);this._linesIndexBuffer=engine.createIndexBuffer(linesIndices),this.linesIndexCount=linesIndices.length}return this._linesIndexBuffer},SubMesh.prototype.canIntersects=function(ray){var boundingInfo=this.getBoundingInfo();return!!boundingInfo&&ray.intersectsBox(boundingInfo.boundingBox)},SubMesh.prototype.intersects=function(ray,positions,indices,fastCheck){var intersectInfo=null;if(BABYLON.LinesMesh&&this._mesh instanceof BABYLON.LinesMesh)for(var lineMesh=this._mesh,index=this.indexStart;index<this.indexStart+this.indexCount;index+=2){var p0=positions[indices[index]],p1=positions[indices[index+1]],length=ray.intersectionSegment(p0,p1,lineMesh.intersectionThreshold);if(!(length<0)&&((fastCheck||!intersectInfo||length<intersectInfo.distance)&&(intersectInfo=new BABYLON.IntersectionInfo(null,null,length),fastCheck)))break}else for(index=this.indexStart;index<this.indexStart+this.indexCount;index+=3){var p0=positions[indices[index]],p1=positions[indices[index+1]],p2=positions[indices[index+2]],currentIntersectInfo=ray.intersectsTriangle(p0,p1,p2);if(currentIntersectInfo){if(currentIntersectInfo.distance<0)continue;if((fastCheck||!intersectInfo||currentIntersectInfo.distance<intersectInfo.distance)&&(intersectInfo=currentIntersectInfo,intersectInfo.faceId=index/3,fastCheck))break}}return intersectInfo},SubMesh.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},SubMesh.prototype.clone=function(newMesh,newRenderingMesh){var result=new SubMesh(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,newMesh,newRenderingMesh,!1);if(!this.IsGlobal){var boundingInfo=this.getBoundingInfo();if(!boundingInfo)return result;result._boundingInfo=new BABYLON.BoundingInfo(boundingInfo.minimum,boundingInfo.maximum)}return result},SubMesh.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var index=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(index,1)},SubMesh.CreateFromIndices=function(materialIndex,startIndex,indexCount,mesh,renderingMesh){for(var minVertexIndex=Number.MAX_VALUE,maxVertexIndex=-Number.MAX_VALUE,indices=(renderingMesh=renderingMesh||mesh).getIndices(),index=startIndex;index<startIndex+indexCount;index++){var vertexIndex=indices[index];vertexIndex<minVertexIndex&&(minVertexIndex=vertexIndex),vertexIndex>maxVertexIndex&&(maxVertexIndex=vertexIndex)}return new SubMesh(materialIndex,minVertexIndex,maxVertexIndex-minVertexIndex+1,startIndex,indexCount,mesh,renderingMesh)},SubMesh}(BaseSubMesh);BABYLON.SubMesh=SubMesh}(BABYLON||(BABYLON={}));!function(BABYLON){var EffectFallbacks=function(){function EffectFallbacks(){this._defines={},this._currentRank=32,this._maxRank=-1}return EffectFallbacks.prototype.unBindMesh=function(){this._mesh=null},EffectFallbacks.prototype.addFallback=function(rank,define){this._defines[rank]||(rank<this._currentRank&&(this._currentRank=rank),rank>this._maxRank&&(this._maxRank=rank),this._defines[rank]=new Array),this._defines[rank].push(define)},EffectFallbacks.prototype.addCPUSkinningFallback=function(rank,mesh){this._mesh=mesh,rank<this._currentRank&&(this._currentRank=rank),rank>this._maxRank&&(this._maxRank=rank)},Object.defineProperty(EffectFallbacks.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),EffectFallbacks.prototype.reduce=function(currentDefines){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,currentDefines=currentDefines.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),BABYLON.Tools.Log("Falling back to CPU skinning for "+this._mesh.name);for(var scene=this._mesh.getScene(),index=0;index<scene.meshes.length;index++){var otherMesh=scene.meshes[index];otherMesh.material===this._mesh.material&&otherMesh.computeBonesUsingShaders&&otherMesh.numBoneInfluencers>0&&(otherMesh.computeBonesUsingShaders=!1)}}else{var currentFallbacks=this._defines[this._currentRank];if(currentFallbacks)for(index=0;index<currentFallbacks.length;index++)currentDefines=currentDefines.replace("#define "+currentFallbacks[index],"");this._currentRank++}return currentDefines},EffectFallbacks}();BABYLON.EffectFallbacks=EffectFallbacks;var EffectCreationOptions=function(){return function(){}}();BABYLON.EffectCreationOptions=EffectCreationOptions;var Effect=function(){function Effect(baseName,attributesNamesOrOptions,uniformsNamesOrEngine,samplers,engine,defines,fallbacks,onCompiled,onError,indexParameters){void 0===samplers&&(samplers=null),void 0===defines&&(defines=null),void 0===fallbacks&&(fallbacks=null),void 0===onCompiled&&(onCompiled=null),void 0===onError&&(onError=null);var _this=this;if(this.uniqueId=0,this.onCompileObservable=new BABYLON.Observable,this.onErrorObservable=new BABYLON.Observable,this.onBindObservable=new BABYLON.Observable,this._uniformBuffersNames={},this._isReady=!1,this._compilationError="",this.name=baseName,attributesNamesOrOptions.attributes){var options=attributesNamesOrOptions;if(this._engine=uniformsNamesOrEngine,this._attributesNames=options.attributes,this._uniformsNames=options.uniformsNames.concat(options.samplers),this._samplers=options.samplers,this.defines=options.defines,this.onError=options.onError,this.onCompiled=options.onCompiled,this._fallbacks=options.fallbacks,this._indexParameters=options.indexParameters,this._transformFeedbackVaryings=options.transformFeedbackVaryings,options.uniformBuffersNames)for(var i=0;i<options.uniformBuffersNames.length;i++)this._uniformBuffersNames[options.uniformBuffersNames[i]]=i}else this._engine=engine,this.defines=defines,this._uniformsNames=uniformsNamesOrEngine.concat(samplers),this._samplers=samplers,this._attributesNames=attributesNamesOrOptions,this.onError=onError,this.onCompiled=onCompiled,this._indexParameters=indexParameters,this._fallbacks=fallbacks;this.uniqueId=Effect._uniqueIdSeed++;var vertexSource,fragmentSource;baseName.vertexElement?(vertexSource=document.getElementById(baseName.vertexElement))||(vertexSource=baseName.vertexElement):vertexSource=baseName.vertex||baseName,baseName.fragmentElement?(fragmentSource=document.getElementById(baseName.fragmentElement))||(fragmentSource=baseName.fragmentElement):fragmentSource=baseName.fragment||baseName,this._loadVertexShader(vertexSource,function(vertexCode){_this._processIncludes(vertexCode,function(vertexCodeWithIncludes){_this._processShaderConversion(vertexCodeWithIncludes,!1,function(migratedVertexCode){_this._loadFragmentShader(fragmentSource,function(fragmentCode){_this._processIncludes(fragmentCode,function(fragmentCodeWithIncludes){_this._processShaderConversion(fragmentCodeWithIncludes,!0,function(migratedFragmentCode){if(baseName){var vertex=baseName.vertexElement||baseName.vertex||baseName,fragment=baseName.fragmentElement||baseName.fragment||baseName;_this._vertexSourceCode="#define SHADER_NAME vertex:"+vertex+"\n"+migratedVertexCode,_this._fragmentSourceCode="#define SHADER_NAME fragment:"+fragment+"\n"+migratedFragmentCode}else _this._vertexSourceCode=migratedVertexCode,_this._fragmentSourceCode=migratedFragmentCode;_this._prepareEffect()})})})})})})}return Object.defineProperty(Effect.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Effect.prototype.isReady=function(){return this._isReady},Effect.prototype.getEngine=function(){return this._engine},Effect.prototype.getProgram=function(){return this._program},Effect.prototype.getAttributesNames=function(){return this._attributesNames},Effect.prototype.getAttributeLocation=function(index){return this._attributes[index]},Effect.prototype.getAttributeLocationByName=function(name){var index=this._attributesNames.indexOf(name);return this._attributes[index]},Effect.prototype.getAttributesCount=function(){return this._attributes.length},Effect.prototype.getUniformIndex=function(uniformName){return this._uniformsNames.indexOf(uniformName)},Effect.prototype.getUniform=function(uniformName){return this._uniforms[this._uniformsNames.indexOf(uniformName)]},Effect.prototype.getSamplers=function(){return this._samplers},Effect.prototype.getCompilationError=function(){return this._compilationError},Effect.prototype.executeWhenCompiled=function(func){this.isReady()?func(this):this.onCompileObservable.add(function(effect){func(effect)})},Effect.prototype._loadVertexShader=function(vertex,callback){if(BABYLON.Tools.IsWindowObjectExist()&&vertex instanceof HTMLElement)callback(BABYLON.Tools.GetDOMTextContent(vertex));else if("base64:"!==vertex.substr(0,7))if(Effect.ShadersStore[vertex+"VertexShader"])callback(Effect.ShadersStore[vertex+"VertexShader"]);else{var vertexShaderUrl;vertexShaderUrl="."===vertex[0]||"/"===vertex[0]||vertex.indexOf("http")>-1?vertex:BABYLON.Engine.ShadersRepository+vertex,BABYLON.Tools.LoadFile(vertexShaderUrl+".vertex.fx",callback)}else callback(window.atob(vertex.substr(7)))},Effect.prototype._loadFragmentShader=function(fragment,callback){if(BABYLON.Tools.IsWindowObjectExist()&&fragment instanceof HTMLElement)callback(BABYLON.Tools.GetDOMTextContent(fragment));else if("base64:"!==fragment.substr(0,7))if(Effect.ShadersStore[fragment+"PixelShader"])callback(Effect.ShadersStore[fragment+"PixelShader"]);else if(Effect.ShadersStore[fragment+"FragmentShader"])callback(Effect.ShadersStore[fragment+"FragmentShader"]);else{var fragmentShaderUrl;fragmentShaderUrl="."===fragment[0]||"/"===fragment[0]||fragment.indexOf("http")>-1?fragment:BABYLON.Engine.ShadersRepository+fragment,BABYLON.Tools.LoadFile(fragmentShaderUrl+".fragment.fx",callback)}else callback(window.atob(fragment.substr(7)))},Effect.prototype._dumpShadersSource=function(vertexCode,fragmentCode,defines){var prefix=(this._engine.webGLVersion>1?"#version 300 es\n":"")+(defines?defines+"\n":"");fragmentCode=prefix+fragmentCode;var i=2,regex=/\n/gm,formattedVertexCode="\n1\t"+(vertexCode=prefix+vertexCode).replace(regex,function(){return"\n"+i+++"\t"});i=2;var formattedFragmentCode="\n1\t"+fragmentCode.replace(regex,function(){return"\n"+i+++"\t"});this.name.vertexElement?(BABYLON.Tools.Error("Vertex shader: "+this.name.vertexElement+formattedVertexCode),BABYLON.Tools.Error("Fragment shader: "+this.name.fragmentElement+formattedFragmentCode)):this.name.vertex?(BABYLON.Tools.Error("Vertex shader: "+this.name.vertex+formattedVertexCode),BABYLON.Tools.Error("Fragment shader: "+this.name.fragment+formattedFragmentCode)):(BABYLON.Tools.Error("Vertex shader: "+this.name+formattedVertexCode),BABYLON.Tools.Error("Fragment shader: "+this.name+formattedFragmentCode))},Effect.prototype._processShaderConversion=function(sourceCode,isFragment,callback){var preparedSourceCode=this._processPrecision(sourceCode);if(1!=this._engine.webGLVersion)if(-1===preparedSourceCode.indexOf("#version 3")){var hasDrawBuffersExtension=-1!==preparedSourceCode.search(/#extension.+GL_EXT_draw_buffers.+require/),regex=/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,result=preparedSourceCode.replace(regex,"");result=(result=(result=result.replace(/varying(?![\n\r])\s/g,isFragment?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in"),isFragment&&(result=(result=(result=(result=(result=(result=(result=(result=result.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/texture2D\s*\(/g,"texture(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(hasDrawBuffersExtension?"":"out vec4 glFragColor;\n")+"void main(")),callback(result)}else callback(preparedSourceCode.replace("#version 300 es",""));else callback(preparedSourceCode)},Effect.prototype._processIncludes=function(sourceCode,callback){for(var _this=this,regex=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,match=regex.exec(sourceCode),returnValue=new String(sourceCode);null!=match;){var includeFile=match[1];if(-1!==includeFile.indexOf("__decl__")&&(includeFile=includeFile.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(includeFile=includeFile.replace(/Vertex/,"Ubo"),includeFile=includeFile.replace(/Fragment/,"Ubo")),includeFile+="Declaration"),!Effect.IncludesShadersStore[includeFile]){var includeShaderUrl=BABYLON.Engine.ShadersRepository+"ShadersInclude/"+includeFile+".fx";return void BABYLON.Tools.LoadFile(includeShaderUrl,function(fileContent){Effect.IncludesShadersStore[includeFile]=fileContent,_this._processIncludes(returnValue,callback)})}var includeContent=Effect.IncludesShadersStore[includeFile];if(match[2])for(var splits=match[3].split(","),index=0;index<splits.length;index+=2){var source=new RegExp(splits[index],"g"),dest=splits[index+1];includeContent=includeContent.replace(source,dest)}if(match[4]){var indexString=match[5];if(-1!==indexString.indexOf("..")){var indexSplits=indexString.split(".."),minIndex=parseInt(indexSplits[0]),maxIndex=parseInt(indexSplits[1]),sourceIncludeContent=includeContent.slice(0);includeContent="",isNaN(maxIndex)&&(maxIndex=this._indexParameters[indexSplits[1]]);for(var i=minIndex;i<maxIndex;i++)this._engine.supportsUniformBuffers||(sourceIncludeContent=sourceIncludeContent.replace(/light\{X\}.(\w*)/g,function(str,p1){return p1+"{X}"})),includeContent+=sourceIncludeContent.replace(/\{X\}/g,i.toString())+"\n"}else this._engine.supportsUniformBuffers||(includeContent=includeContent.replace(/light\{X\}.(\w*)/g,function(str,p1){return p1+"{X}"})),includeContent=includeContent.replace(/\{X\}/g,indexString)}returnValue=returnValue.replace(match[0],includeContent),match=regex.exec(sourceCode)}callback(returnValue)},Effect.prototype._processPrecision=function(source){return-1===source.indexOf("precision highp float")?source=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+source:"precision mediump float;\n"+source:this._engine.getCaps().highPrecisionShaderSupported||(source=source.replace("precision highp float","precision mediump float")),source},Effect.prototype._rebuildProgram=function(vertexSourceCode,fragmentSourceCode,onCompiled,onError){var _this=this;this._isReady=!1,this._vertexSourceCodeOverride=vertexSourceCode,this._fragmentSourceCodeOverride=fragmentSourceCode,this.onError=function(effect,error){onError&&onError(error)},this.onCompiled=function(){for(var scenes=_this.getEngine().scenes,i=0;i<scenes.length;i++)scenes[i].markAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag);onCompiled&&onCompiled(_this._program)},this._fallbacks=null,this._prepareEffect()},Effect.prototype._prepareEffect=function(){var attributesNames=this._attributesNames,defines=this.defines,fallbacks=this._fallbacks;this._valueCache={};var previousProgram=this._program;try{var engine=this._engine;if(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._program=engine.createRawShaderProgram(this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,void 0,this._transformFeedbackVaryings):this._program=engine.createShaderProgram(this._vertexSourceCode,this._fragmentSourceCode,defines,void 0,this._transformFeedbackVaryings),this._program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this),engine.supportsUniformBuffers)for(var name in this._uniformBuffersNames)this.bindUniformBlock(name,this._uniformBuffersNames[name]);this._uniforms=engine.getUniforms(this._program,this._uniformsNames),this._attributes=engine.getAttributes(this._program,attributesNames);var index;for(index=0;index<this._samplers.length;index++)null==this.getUniform(this._samplers[index])&&(this._samplers.splice(index,1),index--);engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),previousProgram&&this.getEngine()._deleteProgram(previousProgram)}catch(e){this._compilationError=e.message,BABYLON.Tools.Error("Unable to compile effect:"),BABYLON.Tools.Error("Uniforms: "+this._uniformsNames.map(function(uniform){return" "+uniform})),BABYLON.Tools.Error("Attributes: "+attributesNames.map(function(attribute){return" "+attribute})),this._dumpShadersSource(this._vertexSourceCode,this._fragmentSourceCode,defines),BABYLON.Tools.Error("Error: "+this._compilationError),previousProgram&&(this._program=previousProgram,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),fallbacks&&fallbacks.isMoreFallbacks?(BABYLON.Tools.Error("Trying next fallback."),this.defines=fallbacks.reduce(this.defines),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(Effect.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),Effect.prototype._bindTexture=function(channel,texture){this._engine._bindTexture(this._samplers.indexOf(channel),texture)},Effect.prototype.setTexture=function(channel,texture){this._engine.setTexture(this._samplers.indexOf(channel),this.getUniform(channel),texture)},Effect.prototype.setTextureArray=function(channel,textures){if(-1===this._samplers.indexOf(channel+"Ex"))for(var initialPos=this._samplers.indexOf(channel),index=1;index<textures.length;index++)this._samplers.splice(initialPos+index,0,channel+"Ex");this._engine.setTextureArray(this._samplers.indexOf(channel),this.getUniform(channel),textures)},Effect.prototype.setTextureFromPostProcess=function(channel,postProcess){this._engine.setTextureFromPostProcess(this._samplers.indexOf(channel),postProcess)},Effect.prototype._cacheMatrix=function(uniformName,matrix){var cache=this._valueCache[uniformName],flag=matrix.updateFlag;return(void 0===cache||cache!==flag)&&(this._valueCache[uniformName]=flag,!0)},Effect.prototype._cacheFloat2=function(uniformName,x,y){var cache=this._valueCache[uniformName];if(!cache)return cache=[x,y],this._valueCache[uniformName]=cache,!0;var changed=!1;return cache[0]!==x&&(cache[0]=x,changed=!0),cache[1]!==y&&(cache[1]=y,changed=!0),changed},Effect.prototype._cacheFloat3=function(uniformName,x,y,z){var cache=this._valueCache[uniformName];if(!cache)return cache=[x,y,z],this._valueCache[uniformName]=cache,!0;var changed=!1;return cache[0]!==x&&(cache[0]=x,changed=!0),cache[1]!==y&&(cache[1]=y,changed=!0),cache[2]!==z&&(cache[2]=z,changed=!0),changed},Effect.prototype._cacheFloat4=function(uniformName,x,y,z,w){var cache=this._valueCache[uniformName];if(!cache)return cache=[x,y,z,w],this._valueCache[uniformName]=cache,!0;var changed=!1;return cache[0]!==x&&(cache[0]=x,changed=!0),cache[1]!==y&&(cache[1]=y,changed=!0),cache[2]!==z&&(cache[2]=z,changed=!0),cache[3]!==w&&(cache[3]=w,changed=!0),changed},Effect.prototype.bindUniformBuffer=function(buffer,name){var bufferName=this._uniformBuffersNames[name];Effect._baseCache[bufferName]!==buffer&&(Effect._baseCache[bufferName]=buffer,this._engine.bindUniformBufferBase(buffer,bufferName))},Effect.prototype.bindUniformBlock=function(blockName,index){this._engine.bindUniformBlock(this._program,blockName,index)},Effect.prototype.setIntArray=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setIntArray(this.getUniform(uniformName),array),this},Effect.prototype.setIntArray2=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setIntArray2(this.getUniform(uniformName),array),this},Effect.prototype.setIntArray3=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setIntArray3(this.getUniform(uniformName),array),this},Effect.prototype.setIntArray4=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setIntArray4(this.getUniform(uniformName),array),this},Effect.prototype.setFloatArray=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setFloatArray(this.getUniform(uniformName),array),this},Effect.prototype.setFloatArray2=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setFloatArray2(this.getUniform(uniformName),array),this},Effect.prototype.setFloatArray3=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setFloatArray3(this.getUniform(uniformName),array),this},Effect.prototype.setFloatArray4=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setFloatArray4(this.getUniform(uniformName),array),this},Effect.prototype.setArray=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setArray(this.getUniform(uniformName),array),this},Effect.prototype.setArray2=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setArray2(this.getUniform(uniformName),array),this},Effect.prototype.setArray3=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setArray3(this.getUniform(uniformName),array),this},Effect.prototype.setArray4=function(uniformName,array){return this._valueCache[uniformName]=null,this._engine.setArray4(this.getUniform(uniformName),array),this},Effect.prototype.setMatrices=function(uniformName,matrices){return matrices?(this._valueCache[uniformName]=null,this._engine.setMatrices(this.getUniform(uniformName),matrices),this):this},Effect.prototype.setMatrix=function(uniformName,matrix){return this._cacheMatrix(uniformName,matrix)&&this._engine.setMatrix(this.getUniform(uniformName),matrix),this},Effect.prototype.setMatrix3x3=function(uniformName,matrix){return this._valueCache[uniformName]=null,this._engine.setMatrix3x3(this.getUniform(uniformName),matrix),this},Effect.prototype.setMatrix2x2=function(uniformName,matrix){return this._valueCache[uniformName]=null,this._engine.setMatrix2x2(this.getUniform(uniformName),matrix),this},Effect.prototype.setFloat=function(uniformName,value){var cache=this._valueCache[uniformName];return void 0!==cache&&cache===value?this:(this._valueCache[uniformName]=value,this._engine.setFloat(this.getUniform(uniformName),value),this)},Effect.prototype.setBool=function(uniformName,bool){var cache=this._valueCache[uniformName];return void 0!==cache&&cache===bool?this:(this._valueCache[uniformName]=bool,this._engine.setBool(this.getUniform(uniformName),bool?1:0),this)},Effect.prototype.setVector2=function(uniformName,vector2){return this._cacheFloat2(uniformName,vector2.x,vector2.y)&&this._engine.setFloat2(this.getUniform(uniformName),vector2.x,vector2.y),this},Effect.prototype.setFloat2=function(uniformName,x,y){return this._cacheFloat2(uniformName,x,y)&&this._engine.setFloat2(this.getUniform(uniformName),x,y),this},Effect.prototype.setVector3=function(uniformName,vector3){return this._cacheFloat3(uniformName,vector3.x,vector3.y,vector3.z)&&this._engine.setFloat3(this.getUniform(uniformName),vector3.x,vector3.y,vector3.z),this},Effect.prototype.setFloat3=function(uniformName,x,y,z){return this._cacheFloat3(uniformName,x,y,z)&&this._engine.setFloat3(this.getUniform(uniformName),x,y,z),this},Effect.prototype.setVector4=function(uniformName,vector4){return this._cacheFloat4(uniformName,vector4.x,vector4.y,vector4.z,vector4.w)&&this._engine.setFloat4(this.getUniform(uniformName),vector4.x,vector4.y,vector4.z,vector4.w),this},Effect.prototype.setFloat4=function(uniformName,x,y,z,w){return this._cacheFloat4(uniformName,x,y,z,w)&&this._engine.setFloat4(this.getUniform(uniformName),x,y,z,w),this},Effect.prototype.setColor3=function(uniformName,color3){return this._cacheFloat3(uniformName,color3.r,color3.g,color3.b)&&this._engine.setColor3(this.getUniform(uniformName),color3),this},Effect.prototype.setColor4=function(uniformName,color3,alpha){return this._cacheFloat4(uniformName,color3.r,color3.g,color3.b,alpha)&&this._engine.setColor4(this.getUniform(uniformName),color3,alpha),this},Effect.ResetCache=function(){Effect._baseCache={}},Effect._uniqueIdSeed=0,Effect._baseCache={},Effect.ShadersStore={},Effect.IncludesShadersStore={},Effect}();BABYLON.Effect=Effect}(BABYLON||(BABYLON={}));!function(BABYLON){var MaterialHelper=function(){function MaterialHelper(){}return MaterialHelper.BindEyePosition=function(effect,scene){scene._forcedViewPosition?effect.setVector3("vEyePosition",scene._forcedViewPosition):effect.setVector3("vEyePosition",scene._mirroredCameraPosition?scene._mirroredCameraPosition:scene.activeCamera.globalPosition)},MaterialHelper.PrepareDefinesForMergedUV=function(texture,defines,key){defines._needUVs=!0,defines[key]=!0,texture.getTextureMatrix().isIdentity(!0)?(defines[key+"DIRECTUV"]=texture.coordinatesIndex+1,0===texture.coordinatesIndex?defines.MAINUV1=!0:defines.MAINUV2=!0):defines[key+"DIRECTUV"]=0},MaterialHelper.BindTextureMatrix=function(texture,uniformBuffer,key){var matrix=texture.getTextureMatrix();matrix.isIdentity(!0)||uniformBuffer.updateMatrix(key+"Matrix",matrix)},MaterialHelper.PrepareDefinesForMisc=function(mesh,scene,useLogarithmicDepth,pointsCloud,fogEnabled,defines){defines._areMiscDirty&&(defines.LOGARITHMICDEPTH=useLogarithmicDepth,defines.POINTSIZE=pointsCloud||scene.forcePointsCloud,defines.FOG=scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==BABYLON.Scene.FOGMODE_NONE&&fogEnabled,defines.NONUNIFORMSCALING=mesh.nonUniformScaling)},MaterialHelper.PrepareDefinesForFrameBoundValues=function(scene,engine,defines,useInstances,forceAlphaTest){void 0===forceAlphaTest&&(forceAlphaTest=!1);var changed=!1;defines.CLIPPLANE!==(void 0!==scene.clipPlane&&null!==scene.clipPlane)&&(defines.CLIPPLANE=!defines.CLIPPLANE,changed=!0),defines.ALPHATEST!==(engine.getAlphaTesting()||forceAlphaTest)&&(defines.ALPHATEST=!defines.ALPHATEST,changed=!0),defines.DEPTHPREPASS!==!engine.getColorWrite()&&(defines.DEPTHPREPASS=!defines.DEPTHPREPASS,changed=!0),defines.INSTANCES!==useInstances&&(defines.INSTANCES=useInstances,changed=!0),changed&&defines.markAsUnprocessed()},MaterialHelper.PrepareDefinesForAttributes=function(mesh,defines,useVertexColor,useBones,useMorphTargets,useVertexAlpha){if(void 0===useMorphTargets&&(useMorphTargets=!1),void 0===useVertexAlpha&&(useVertexAlpha=!0),!defines._areAttributesDirty&&defines._needNormals===defines._normals&&defines._needUVs===defines._uvs)return!1;if(defines._normals=defines._needNormals,defines._uvs=defines._needUVs,defines.NORMAL=defines._needNormals&&mesh.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind),defines._needNormals&&mesh.isVerticesDataPresent(BABYLON.VertexBuffer.TangentKind)&&(defines.TANGENT=!0),defines._needUVs?(defines.UV1=mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind),defines.UV2=mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)):(defines.UV1=!1,defines.UV2=!1),useVertexColor){var hasVertexColors=mesh.useVertexColors&&mesh.isVerticesDataPresent(BABYLON.VertexBuffer.ColorKind);defines.VERTEXCOLOR=hasVertexColors,defines.VERTEXALPHA=mesh.hasVertexAlpha&&hasVertexColors&&useVertexAlpha}if(useBones&&(mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton?(defines.NUM_BONE_INFLUENCERS=mesh.numBoneInfluencers,defines.BonesPerMesh=mesh.skeleton.bones.length+1):(defines.NUM_BONE_INFLUENCERS=0,defines.BonesPerMesh=0)),useMorphTargets){var manager=mesh.morphTargetManager;manager?(defines.MORPHTARGETS_TANGENT=manager.supportsTangents&&defines.TANGENT,defines.MORPHTARGETS_NORMAL=manager.supportsNormals&&defines.NORMAL,defines.MORPHTARGETS=manager.numInfluencers>0,defines.NUM_MORPH_INFLUENCERS=manager.numInfluencers):(defines.MORPHTARGETS_TANGENT=!1,defines.MORPHTARGETS_NORMAL=!1,defines.MORPHTARGETS=!1,defines.NUM_MORPH_INFLUENCERS=0)}return!0},MaterialHelper.PrepareDefinesForLights=function(scene,mesh,defines,specularSupported,maxSimultaneousLights,disableLighting){if(void 0===maxSimultaneousLights&&(maxSimultaneousLights=4),void 0===disableLighting&&(disableLighting=!1),!defines._areLightsDirty)return defines._needNormals;var lightIndex=0,needNormals=!1,needRebuild=!1,lightmapMode=!1,shadowEnabled=!1,specularEnabled=!1;if(scene.lightsEnabled&&!disableLighting)for(var _i=0,_a=mesh._lightSources;_i<_a.length;_i++){var light=_a[_i];needNormals=!0,void 0===defines["LIGHT"+lightIndex]&&(needRebuild=!0),defines["LIGHT"+lightIndex]=!0,defines["SPOTLIGHT"+lightIndex]=!1,defines["HEMILIGHT"+lightIndex]=!1,defines["POINTLIGHT"+lightIndex]=!1,defines["DIRLIGHT"+lightIndex]=!1;var type;if(type=light.getTypeID()===BABYLON.Light.LIGHTTYPEID_SPOTLIGHT?"SPOTLIGHT"+lightIndex:light.getTypeID()===BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT?"HEMILIGHT"+lightIndex:light.getTypeID()===BABYLON.Light.LIGHTTYPEID_POINTLIGHT?"POINTLIGHT"+lightIndex:"DIRLIGHT"+lightIndex,defines[type]=!0,specularSupported&&!light.specular.equalsFloats(0,0,0)&&(specularEnabled=!0),defines["SHADOW"+lightIndex]=!1,defines["SHADOWPCF"+lightIndex]=!1,defines["SHADOWESM"+lightIndex]=!1,defines["SHADOWCUBE"+lightIndex]=!1,mesh&&mesh.receiveShadows&&scene.shadowsEnabled&&light.shadowEnabled){var shadowGenerator=light.getShadowGenerator();shadowGenerator&&(shadowEnabled=!0,shadowGenerator.prepareDefines(defines,lightIndex))}if(light.lightmapMode!=BABYLON.Light.LIGHTMAP_DEFAULT?(lightmapMode=!0,defines["LIGHTMAPEXCLUDED"+lightIndex]=!0,defines["LIGHTMAPNOSPECULAR"+lightIndex]=light.lightmapMode==BABYLON.Light.LIGHTMAP_SHADOWSONLY):(defines["LIGHTMAPEXCLUDED"+lightIndex]=!1,defines["LIGHTMAPNOSPECULAR"+lightIndex]=!1),++lightIndex===maxSimultaneousLights)break}defines.SPECULARTERM=specularEnabled,defines.SHADOWS=shadowEnabled;for(var index=lightIndex;index<maxSimultaneousLights;index++)void 0!==defines["LIGHT"+index]&&(defines["LIGHT"+index]=!1,defines["HEMILIGHT"+lightIndex]=!1,defines["POINTLIGHT"+lightIndex]=!1,defines["DIRLIGHT"+lightIndex]=!1,defines["SPOTLIGHT"+lightIndex]=!1,defines["SHADOW"+lightIndex]=!1);var caps=scene.getEngine().getCaps();return void 0===defines.SHADOWFLOAT&&(needRebuild=!0),defines.SHADOWFLOAT=shadowEnabled&&(caps.textureFloatRender&&caps.textureFloatLinearFiltering||caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering),defines.LIGHTMAPEXCLUDED=lightmapMode,needRebuild&&defines.rebuild(),needNormals},MaterialHelper.PrepareUniformsAndSamplersList=function(uniformsListOrOptions,samplersList,defines,maxSimultaneousLights){void 0===maxSimultaneousLights&&(maxSimultaneousLights=4);var uniformsList,uniformBuffersList=null;if(uniformsListOrOptions.uniformsNames){var options=uniformsListOrOptions;uniformsList=options.uniformsNames,uniformBuffersList=options.uniformBuffersNames,samplersList=options.samplers,defines=options.defines,maxSimultaneousLights=options.maxSimultaneousLights}else uniformsList=uniformsListOrOptions,samplersList||(samplersList=[]);for(var lightIndex=0;lightIndex<maxSimultaneousLights&&defines["LIGHT"+lightIndex];lightIndex++)uniformsList.push("vLightData"+lightIndex,"vLightDiffuse"+lightIndex,"vLightSpecular"+lightIndex,"vLightDirection"+lightIndex,"vLightGround"+lightIndex,"lightMatrix"+lightIndex,"shadowsInfo"+lightIndex,"depthValues"+lightIndex),uniformBuffersList&&uniformBuffersList.push("Light"+lightIndex),samplersList.push("shadowSampler"+lightIndex);defines.NUM_MORPH_INFLUENCERS&&uniformsList.push("morphTargetInfluences")},MaterialHelper.HandleFallbacksForShadows=function(defines,fallbacks,maxSimultaneousLights,rank){void 0===maxSimultaneousLights&&(maxSimultaneousLights=4),void 0===rank&&(rank=0);for(var lightFallbackRank=0,lightIndex=0;lightIndex<maxSimultaneousLights&&defines["LIGHT"+lightIndex];lightIndex++)lightIndex>0&&(lightFallbackRank=rank+lightIndex,fallbacks.addFallback(lightFallbackRank,"LIGHT"+lightIndex)),defines.SHADOWS||(defines["SHADOW"+lightIndex]&&fallbacks.addFallback(rank,"SHADOW"+lightIndex),defines["SHADOWPCF"+lightIndex]&&fallbacks.addFallback(rank,"SHADOWPCF"+lightIndex),defines["SHADOWESM"+lightIndex]&&fallbacks.addFallback(rank,"SHADOWESM"+lightIndex));return lightFallbackRank++},MaterialHelper.PrepareAttributesForMorphTargets=function(attribs,mesh,defines){var influencers=defines.NUM_MORPH_INFLUENCERS;if(influencers>0&&BABYLON.Engine.LastCreatedEngine)for(var maxAttributesCount=BABYLON.Engine.LastCreatedEngine.getCaps().maxVertexAttribs,manager=mesh.morphTargetManager,normal=manager&&manager.supportsNormals&&defines.NORMAL,tangent=manager&&manager.supportsTangents&&defines.TANGENT,index=0;index<influencers;index++)attribs.push(BABYLON.VertexBuffer.PositionKind+index),normal&&attribs.push(BABYLON.VertexBuffer.NormalKind+index),tangent&&attribs.push(BABYLON.VertexBuffer.TangentKind+index),attribs.length>maxAttributesCount&&BABYLON.Tools.Error("Cannot add more vertex attributes for mesh "+mesh.name)},MaterialHelper.PrepareAttributesForBones=function(attribs,mesh,defines,fallbacks){defines.NUM_BONE_INFLUENCERS>0&&(fallbacks.addCPUSkinningFallback(0,mesh),attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),defines.NUM_BONE_INFLUENCERS>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)))},MaterialHelper.PrepareAttributesForInstances=function(attribs,defines){defines.INSTANCES&&(attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"))},MaterialHelper.BindLightShadow=function(light,scene,mesh,lightIndex,effect){if(light.shadowEnabled&&mesh.receiveShadows){var shadowGenerator=light.getShadowGenerator();shadowGenerator&&shadowGenerator.bindShadowLight(lightIndex,effect)}},MaterialHelper.BindLightProperties=function(light,effect,lightIndex){light.transferToEffect(effect,lightIndex+"")},MaterialHelper.BindLights=function(scene,mesh,effect,defines,maxSimultaneousLights,usePhysicalLightFalloff){void 0===maxSimultaneousLights&&(maxSimultaneousLights=4),void 0===usePhysicalLightFalloff&&(usePhysicalLightFalloff=!1);for(var lightIndex=0,_i=0,_a=mesh._lightSources;_i<_a.length;_i++){var light=_a[_i],scaledIntensity=light.getScaledIntensity();if(light._uniformBuffer.bindToEffect(effect,"Light"+lightIndex),MaterialHelper.BindLightProperties(light,effect,lightIndex),light.diffuse.scaleToRef(scaledIntensity,BABYLON.Tmp.Color3[0]),light._uniformBuffer.updateColor4("vLightDiffuse",BABYLON.Tmp.Color3[0],usePhysicalLightFalloff?light.radius:light.range,lightIndex+""),defines.SPECULARTERM&&(light.specular.scaleToRef(scaledIntensity,BABYLON.Tmp.Color3[1]),light._uniformBuffer.updateColor3("vLightSpecular",BABYLON.Tmp.Color3[1],lightIndex+"")),scene.shadowsEnabled&&this.BindLightShadow(light,scene,mesh,lightIndex+"",effect),light._uniformBuffer.update(),++lightIndex===maxSimultaneousLights)break}},MaterialHelper.BindFogParameters=function(scene,mesh,effect){scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==BABYLON.Scene.FOGMODE_NONE&&(effect.setFloat4("vFogInfos",scene.fogMode,scene.fogStart,scene.fogEnd,scene.fogDensity),effect.setColor3("vFogColor",scene.fogColor))},MaterialHelper.BindBonesParameters=function(mesh,effect){if(mesh&&mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){var matrices=mesh.skeleton.getTransformMatrices(mesh);matrices&&effect&&effect.setMatrices("mBones",matrices)}},MaterialHelper.BindMorphTargetParameters=function(abstractMesh,effect){var manager=abstractMesh.morphTargetManager;abstractMesh&&manager&&effect.setFloatArray("morphTargetInfluences",manager.influences)},MaterialHelper.BindLogDepth=function(defines,effect,scene){defines.LOGARITHMICDEPTH&&effect.setFloat("logarithmicDepthConstant",2/(Math.log(scene.activeCamera.maxZ+1)/Math.LN2))},MaterialHelper.BindClipPlane=function(effect,scene){if(scene.clipPlane){var clipPlane=scene.clipPlane;effect.setFloat4("vClipPlane",clipPlane.normal.x,clipPlane.normal.y,clipPlane.normal.z,clipPlane.d)}},MaterialHelper}();BABYLON.MaterialHelper=MaterialHelper}(BABYLON||(BABYLON={}));__assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};!function(BABYLON){var MaterialDefines=function(){function MaterialDefines(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(MaterialDefines.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),MaterialDefines.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},MaterialDefines.prototype.markAsUnprocessed=function(){this._isDirty=!0},MaterialDefines.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},MaterialDefines.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},MaterialDefines.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var _i=0,_a=Object.keys(this);_i<_a.length;_i++){var key=_a[_i];"_"!==key[0]&&this._keys.push(key)}},MaterialDefines.prototype.isEqual=function(other){if(this._keys.length!==other._keys.length)return!1;for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];if(this[prop]!==other[prop])return!1}return!0},MaterialDefines.prototype.cloneTo=function(other){this._keys.length!==other._keys.length&&(other._keys=this._keys.slice(0));for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];other[prop]=this[prop]}},MaterialDefines.prototype.reset=function(){for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];"number"==typeof this[prop]?this[prop]=0:this[prop]=!1}},MaterialDefines.prototype.toString=function(){for(var result="",index=0;index<this._keys.length;index++){var prop=this._keys[index],value=this[prop];"number"==typeof value?result+="#define "+prop+" "+this[prop]+"\n":value&&(result+="#define "+prop+"\n")}return result},MaterialDefines}();BABYLON.MaterialDefines=MaterialDefines;var Material=function(){function Material(name,scene,doNotAdd){this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this._backFaceCulling=!0,this.doNotSerialize=!1,this.storeEffectOnSubMeshes=!1,this.onDisposeObservable=new BABYLON.Observable,this.onBindObservable=new BABYLON.Observable,this.onUnBindObservable=new BABYLON.Observable,this._alphaMode=BABYLON.Engine.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=Material.TriangleFillMode,this.name=name,this.id=name||BABYLON.Tools.RandomId(),this._scene=scene||BABYLON.Engine.LastCreatedScene,this._scene.useRightHandedSystem?this.sideOrientation=Material.ClockWiseSideOrientation:this.sideOrientation=Material.CounterClockWiseSideOrientation,this._uniformBuffer=new BABYLON.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,doNotAdd||this._scene.materials.push(this)}return Object.defineProperty(Material,"TriangleFillMode",{get:function(){return Material._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"WireFrameFillMode",{get:function(){return Material._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"PointFillMode",{get:function(){return Material._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"ClockWiseSideOrientation",{get:function(){return Material._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"CounterClockWiseSideOrientation",{get:function(){return Material._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"TextureDirtyFlag",{get:function(){return Material._TextureDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"LightDirtyFlag",{get:function(){return Material._LightDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"FresnelDirtyFlag",{get:function(){return Material._FresnelDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"AttributesDirtyFlag",{get:function(){return Material._AttributesDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(Material,"MiscDirtyFlag",{get:function(){return Material._MiscDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(value){this._backFaceCulling!==value&&(this._backFaceCulling=value,this.markAsDirty(Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"onBind",{set:function(callback){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(value){this._alphaMode!==value&&(this._alphaMode=value,this.markAsDirty(Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(value){this._needDepthPrePass!==value&&(this._needDepthPrePass=value,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(value){this._fogEnabled!==value&&(this._fogEnabled=value,this.markAsDirty(Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"wireframe",{get:function(){return this._fillMode===Material.WireFrameFillMode},set:function(value){this._fillMode=value?Material.WireFrameFillMode:Material.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"pointsCloud",{get:function(){return this._fillMode===Material.PointFillMode},set:function(value){this._fillMode=value?Material.PointFillMode:Material.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"fillMode",{get:function(){return this._fillMode},set:function(value){this._fillMode!==value&&(this._fillMode=value,this.markAsDirty(Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Material.prototype.toString=function(fullDetails){return"Name: "+this.name},Material.prototype.getClassName=function(){return"Material"},Object.defineProperty(Material.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),Material.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},Material.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},Material.prototype.isReady=function(mesh,useInstances){return!0},Material.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){return!1},Material.prototype.getEffect=function(){return this._effect},Material.prototype.getScene=function(){return this._scene},Material.prototype.needAlphaBlending=function(){return this.alpha<1},Material.prototype.needAlphaBlendingForMesh=function(mesh){return this.needAlphaBlending()||mesh.visibility<1||mesh.hasVertexAlpha},Material.prototype.needAlphaTesting=function(){return!1},Material.prototype.getAlphaTestTexture=function(){return null},Material.prototype.markDirty=function(){this._wasPreviouslyReady=!1},Material.prototype._preBind=function(effect,overrideOrientation){void 0===overrideOrientation&&(overrideOrientation=null);var engine=this._scene.getEngine(),reverse=(null==overrideOrientation?this.sideOrientation:overrideOrientation)===Material.ClockWiseSideOrientation;return engine.enableEffect(effect||this._effect),engine.setState(this.backFaceCulling,this.zOffset,!1,reverse),reverse},Material.prototype.bind=function(world,mesh){},Material.prototype.bindForSubMesh=function(world,mesh,subMesh){},Material.prototype.bindOnlyWorldMatrix=function(world){},Material.prototype.bindSceneUniformBuffer=function(effect,sceneUbo){sceneUbo.bindToEffect(effect,"Scene")},Material.prototype.bindView=function(effect){this._useUBO?this.bindSceneUniformBuffer(effect,this.getScene().getSceneUniformBuffer()):effect.setMatrix("view",this.getScene().getViewMatrix())},Material.prototype.bindViewProjection=function(effect){this._useUBO?this.bindSceneUniformBuffer(effect,this.getScene().getSceneUniformBuffer()):effect.setMatrix("viewProjection",this.getScene().getTransformMatrix())},Material.prototype._afterBind=function(mesh){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=mesh?mesh.visibility:1,mesh&&this.onBindObservable.notifyObservers(mesh),this.disableDepthWrite){var engine=this._scene.getEngine();this._cachedDepthWriteState=engine.getDepthWrite(),engine.setDepthWrite(!1)}},Material.prototype.unbind=function(){this.onUnBindObservable.notifyObservers(this),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},Material.prototype.getActiveTextures=function(){return[]},Material.prototype.hasTexture=function(texture){return!1},Material.prototype.clone=function(name){return null},Material.prototype.getBindedMeshes=function(){for(var result=new Array,index=0;index<this._scene.meshes.length;index++){var mesh=this._scene.meshes[index];mesh.material===this&&result.push(mesh)}return result},Material.prototype.forceCompilation=function(mesh,onCompiled,options){var _this=this,localOptions=__assign({alphaTest:null,clipPlane:!1},options),subMesh=new BABYLON.BaseSubMesh,scene=this.getScene(),engine=scene.getEngine(),checkReady=function(){if(_this._scene&&_this._scene.getEngine()){subMesh._materialDefines&&(subMesh._materialDefines._renderId=-1);var alphaTestState=engine.getAlphaTesting(),clipPlaneState=scene.clipPlane;engine.setAlphaTesting(localOptions.alphaTest||!_this.needAlphaBlendingForMesh(mesh)&&_this.needAlphaTesting()),localOptions.clipPlane&&(scene.clipPlane=new BABYLON.Plane(0,0,0,1)),_this.storeEffectOnSubMeshes?_this.isReadyForSubMesh(mesh,subMesh)?onCompiled&&onCompiled(_this):setTimeout(checkReady,16):_this.isReady(mesh)?onCompiled&&onCompiled(_this):setTimeout(checkReady,16),engine.setAlphaTesting(alphaTestState),options&&options.clipPlane&&(scene.clipPlane=clipPlaneState)}};checkReady()},Material.prototype.markAsDirty=function(flag){flag&Material.TextureDirtyFlag&&this._markAllSubMeshesAsTexturesDirty(),flag&Material.LightDirtyFlag&&this._markAllSubMeshesAsLightsDirty(),flag&Material.FresnelDirtyFlag&&this._markAllSubMeshesAsFresnelDirty(),flag&Material.AttributesDirtyFlag&&this._markAllSubMeshesAsAttributesDirty(),flag&Material.MiscDirtyFlag&&this._markAllSubMeshesAsMiscDirty(),this.getScene().resetCachedMaterial()},Material.prototype._markAllSubMeshesAsDirty=function(func){for(var _i=0,_a=this.getScene().meshes;_i<_a.length;_i++){var mesh=_a[_i];if(mesh.subMeshes)for(var _b=0,_c=mesh.subMeshes;_b<_c.length;_b++){var subMesh=_c[_b];subMesh.getMaterial()===this&&(subMesh._materialDefines&&func(subMesh._materialDefines))}}},Material.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsImageProcessingDirty()})},Material.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsTexturesDirty()})},Material.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsFresnelDirty()})},Material.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsLightDirty()})},Material.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsAttributesDirty()})},Material.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(function(defines){return defines.markAsMiscDirty()})},Material.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){this.getScene().stopAnimation(this);var index=this._scene.materials.indexOf(this);for(index>=0&&this._scene.materials.splice(index,1),index=0;index<this._scene.meshes.length;index++){var mesh=this._scene.meshes[index];if(mesh.material===this&&(mesh.material=null,mesh.geometry)){var geometry=mesh.geometry;if(this.storeEffectOnSubMeshes)for(var _i=0,_a=mesh.subMeshes;_i<_a.length;_i++){var subMesh=_a[_i];geometry._releaseVertexArrayObject(subMesh._materialEffect),forceDisposeEffect&&subMesh._materialEffect&&this._scene.getEngine()._releaseEffect(subMesh._materialEffect)}else geometry._releaseVertexArrayObject(this._effect)}}this._uniformBuffer.dispose(),forceDisposeEffect&&this._effect&&(this.storeEffectOnSubMeshes||this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBindObservable.clear(),this.onUnBindObservable.clear()},Material.prototype.serialize=function(){return BABYLON.SerializationHelper.Serialize(this)},Material.ParseMultiMaterial=function(parsedMultiMaterial,scene){var multiMaterial=new BABYLON.MultiMaterial(parsedMultiMaterial.name,scene);multiMaterial.id=parsedMultiMaterial.id,BABYLON.Tags&&BABYLON.Tags.AddTagsTo(multiMaterial,parsedMultiMaterial.tags);for(var matIndex=0;matIndex<parsedMultiMaterial.materials.length;matIndex++){var subMatId=parsedMultiMaterial.materials[matIndex];subMatId?multiMaterial.subMaterials.push(scene.getMaterialByID(subMatId)):multiMaterial.subMaterials.push(null)}return multiMaterial},Material.Parse=function(parsedMaterial,scene,rootUrl){if(!parsedMaterial.customType)return BABYLON.StandardMaterial.Parse(parsedMaterial,scene,rootUrl);{if("BABYLON.PBRMaterial"!==parsedMaterial.customType||!parsedMaterial.overloadedAlbedo||(parsedMaterial.customType="BABYLON.LegacyPBRMaterial",BABYLON.LegacyPBRMaterial))return BABYLON.Tools.Instantiate(parsedMaterial.customType).Parse(parsedMaterial,scene,rootUrl);BABYLON.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.")}},Material._TriangleFillMode=0,Material._WireFrameFillMode=1,Material._PointFillMode=2,Material._ClockWiseSideOrientation=0,Material._CounterClockWiseSideOrientation=1,Material._TextureDirtyFlag=1,Material._LightDirtyFlag=2,Material._FresnelDirtyFlag=4,Material._AttributesDirtyFlag=8,Material._MiscDirtyFlag=16,__decorate([BABYLON.serialize()],Material.prototype,"id",void 0),__decorate([BABYLON.serialize()],Material.prototype,"name",void 0),__decorate([BABYLON.serialize()],Material.prototype,"checkReadyOnEveryCall",void 0),__decorate([BABYLON.serialize()],Material.prototype,"checkReadyOnlyOnce",void 0),__decorate([BABYLON.serialize()],Material.prototype,"state",void 0),__decorate([BABYLON.serialize()],Material.prototype,"alpha",void 0),__decorate([BABYLON.serialize("backFaceCulling")],Material.prototype,"_backFaceCulling",void 0),__decorate([BABYLON.serialize()],Material.prototype,"sideOrientation",void 0),__decorate([BABYLON.serialize("alphaMode")],Material.prototype,"_alphaMode",void 0),__decorate([BABYLON.serialize()],Material.prototype,"_needDepthPrePass",void 0),__decorate([BABYLON.serialize()],Material.prototype,"disableDepthWrite",void 0),__decorate([BABYLON.serialize()],Material.prototype,"forceDepthWrite",void 0),__decorate([BABYLON.serialize()],Material.prototype,"separateCullingPass",void 0),__decorate([BABYLON.serialize("fogEnabled")],Material.prototype,"_fogEnabled",void 0),__decorate([BABYLON.serialize()],Material.prototype,"pointSize",void 0),__decorate([BABYLON.serialize()],Material.prototype,"zOffset",void 0),__decorate([BABYLON.serialize()],Material.prototype,"wireframe",null),__decorate([BABYLON.serialize()],Material.prototype,"pointsCloud",null),__decorate([BABYLON.serialize()],Material.prototype,"fillMode",null),Material}();BABYLON.Material=Material}(BABYLON||(BABYLON={}));!function(BABYLON){var UniformBuffer=function(){function UniformBuffer(engine,data,dynamic){this._engine=engine,this._noUBO=!engine.supportsUniformBuffers,this._dynamic=dynamic,this._data=data||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(UniformBuffer.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(UniformBuffer.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),UniformBuffer.prototype.isDynamic=function(){return void 0!==this._dynamic},UniformBuffer.prototype.getData=function(){return this._bufferData},UniformBuffer.prototype.getBuffer=function(){return this._buffer},UniformBuffer.prototype._fillAlignment=function(size){var alignment;if(alignment=size<=2?size:4,this._uniformLocationPointer%alignment!=0){var oldPointer=this._uniformLocationPointer;this._uniformLocationPointer+=alignment-this._uniformLocationPointer%alignment;for(var diff=this._uniformLocationPointer-oldPointer,i=0;i<diff;i++)this._data.push(0)}},UniformBuffer.prototype.addUniform=function(name,size){if(!this._noUBO&&void 0===this._uniformLocations[name]){var data;if(size instanceof Array)size=(data=size).length;else{size=size,data=[];for(i=0;i<size;i++)data.push(0)}this._fillAlignment(size),this._uniformSizes[name]=size,this._uniformLocations[name]=this._uniformLocationPointer,this._uniformLocationPointer+=size;for(var i=0;i<size;i++)this._data.push(data[i]);this._needSync=!0}},UniformBuffer.prototype.addMatrix=function(name,mat){this.addUniform(name,Array.prototype.slice.call(mat.toArray()))},UniformBuffer.prototype.addFloat2=function(name,x,y){var temp=[x,y];this.addUniform(name,temp)},UniformBuffer.prototype.addFloat3=function(name,x,y,z){var temp=[x,y,z];this.addUniform(name,temp)},UniformBuffer.prototype.addColor3=function(name,color){var temp=new Array;color.toArray(temp),this.addUniform(name,temp)},UniformBuffer.prototype.addColor4=function(name,color,alpha){var temp=new Array;color.toArray(temp),temp.push(alpha),this.addUniform(name,temp)},UniformBuffer.prototype.addVector3=function(name,vector){var temp=new Array;vector.toArray(temp),this.addUniform(name,temp)},UniformBuffer.prototype.addMatrix3x3=function(name){this.addUniform(name,12)},UniformBuffer.prototype.addMatrix2x2=function(name){this.addUniform(name,8)},UniformBuffer.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},UniformBuffer.prototype._rebuild=function(){this._noUBO||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},UniformBuffer.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},UniformBuffer.prototype.updateUniform=function(uniformName,data,size){var location=this._uniformLocations[uniformName];if(void 0===location){if(this._buffer)return void BABYLON.Tools.Error("Cannot add an uniform after UBO has been created.");this.addUniform(uniformName,size),location=this._uniformLocations[uniformName]}if(this._buffer||this.create(),this._dynamic)for(i=0;i<size;i++)this._bufferData[location+i]=data[i];else{for(var changed=!1,i=0;i<size;i++)this._bufferData[location+i]!==data[i]&&(changed=!0,this._bufferData[location+i]=data[i]);this._needSync=this._needSync||changed}},UniformBuffer.prototype._updateMatrix3x3ForUniform=function(name,matrix){for(var i=0;i<3;i++)UniformBuffer._tempBuffer[4*i]=matrix[3*i],UniformBuffer._tempBuffer[4*i+1]=matrix[3*i+1],UniformBuffer._tempBuffer[4*i+2]=matrix[3*i+2],UniformBuffer._tempBuffer[4*i+3]=0;this.updateUniform(name,UniformBuffer._tempBuffer,12)},UniformBuffer.prototype._updateMatrix3x3ForEffect=function(name,matrix){this._currentEffect.setMatrix3x3(name,matrix)},UniformBuffer.prototype._updateMatrix2x2ForEffect=function(name,matrix){this._currentEffect.setMatrix2x2(name,matrix)},UniformBuffer.prototype._updateMatrix2x2ForUniform=function(name,matrix){for(var i=0;i<2;i++)UniformBuffer._tempBuffer[4*i]=matrix[2*i],UniformBuffer._tempBuffer[4*i+1]=matrix[2*i+1],UniformBuffer._tempBuffer[4*i+2]=0,UniformBuffer._tempBuffer[4*i+3]=0;this.updateUniform(name,UniformBuffer._tempBuffer,8)},UniformBuffer.prototype._updateFloatForEffect=function(name,x){this._currentEffect.setFloat(name,x)},UniformBuffer.prototype._updateFloatForUniform=function(name,x){UniformBuffer._tempBuffer[0]=x,this.updateUniform(name,UniformBuffer._tempBuffer,1)},UniformBuffer.prototype._updateFloat2ForEffect=function(name,x,y,suffix){void 0===suffix&&(suffix=""),this._currentEffect.setFloat2(name+suffix,x,y)},UniformBuffer.prototype._updateFloat2ForUniform=function(name,x,y,suffix){void 0===suffix&&(suffix=""),UniformBuffer._tempBuffer[0]=x,UniformBuffer._tempBuffer[1]=y,this.updateUniform(name,UniformBuffer._tempBuffer,2)},UniformBuffer.prototype._updateFloat3ForEffect=function(name,x,y,z,suffix){void 0===suffix&&(suffix=""),this._currentEffect.setFloat3(name+suffix,x,y,z)},UniformBuffer.prototype._updateFloat3ForUniform=function(name,x,y,z,suffix){void 0===suffix&&(suffix=""),UniformBuffer._tempBuffer[0]=x,UniformBuffer._tempBuffer[1]=y,UniformBuffer._tempBuffer[2]=z,this.updateUniform(name,UniformBuffer._tempBuffer,3)},UniformBuffer.prototype._updateFloat4ForEffect=function(name,x,y,z,w,suffix){void 0===suffix&&(suffix=""),this._currentEffect.setFloat4(name+suffix,x,y,z,w)},UniformBuffer.prototype._updateFloat4ForUniform=function(name,x,y,z,w,suffix){void 0===suffix&&(suffix=""),UniformBuffer._tempBuffer[0]=x,UniformBuffer._tempBuffer[1]=y,UniformBuffer._tempBuffer[2]=z,UniformBuffer._tempBuffer[3]=w,this.updateUniform(name,UniformBuffer._tempBuffer,4)},UniformBuffer.prototype._updateMatrixForEffect=function(name,mat){this._currentEffect.setMatrix(name,mat)},UniformBuffer.prototype._updateMatrixForUniform=function(name,mat){this.updateUniform(name,mat.toArray(),16)},UniformBuffer.prototype._updateVector3ForEffect=function(name,vector){this._currentEffect.setVector3(name,vector)},UniformBuffer.prototype._updateVector3ForUniform=function(name,vector){vector.toArray(UniformBuffer._tempBuffer),this.updateUniform(name,UniformBuffer._tempBuffer,3)},UniformBuffer.prototype._updateVector4ForEffect=function(name,vector){this._currentEffect.setVector4(name,vector)},UniformBuffer.prototype._updateVector4ForUniform=function(name,vector){vector.toArray(UniformBuffer._tempBuffer),this.updateUniform(name,UniformBuffer._tempBuffer,4)},UniformBuffer.prototype._updateColor3ForEffect=function(name,color,suffix){void 0===suffix&&(suffix=""),this._currentEffect.setColor3(name+suffix,color)},UniformBuffer.prototype._updateColor3ForUniform=function(name,color,suffix){void 0===suffix&&(suffix=""),color.toArray(UniformBuffer._tempBuffer),this.updateUniform(name,UniformBuffer._tempBuffer,3)},UniformBuffer.prototype._updateColor4ForEffect=function(name,color,alpha,suffix){void 0===suffix&&(suffix=""),this._currentEffect.setColor4(name+suffix,color,alpha)},UniformBuffer.prototype._updateColor4ForUniform=function(name,color,alpha,suffix){void 0===suffix&&(suffix=""),color.toArray(UniformBuffer._tempBuffer),UniformBuffer._tempBuffer[3]=alpha,this.updateUniform(name,UniformBuffer._tempBuffer,4)},UniformBuffer.prototype.setTexture=function(name,texture){this._currentEffect.setTexture(name,texture)},UniformBuffer.prototype.updateUniformDirectly=function(uniformName,data){this.updateUniform(uniformName,data,data.length),this.update()},UniformBuffer.prototype.bindToEffect=function(effect,name){this._currentEffect=effect,!this._noUBO&&this._buffer&&effect.bindUniformBuffer(this._buffer,name)},UniformBuffer.prototype.dispose=function(){if(!this._noUBO){var index=this._engine._uniformBuffers.indexOf(this);-1!==index&&this._engine._uniformBuffers.splice(index,1),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},UniformBuffer._MAX_UNIFORM_SIZE=256,UniformBuffer._tempBuffer=new Float32Array(UniformBuffer._MAX_UNIFORM_SIZE),UniformBuffer}();BABYLON.UniformBuffer=UniformBuffer}(BABYLON||(BABYLON={}));!function(BABYLON){var PushMaterial=function(_super){function PushMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.storeEffectOnSubMeshes=!0,_this}return __extends(PushMaterial,_super),PushMaterial.prototype.getEffect=function(){return this._activeEffect},PushMaterial.prototype.isReady=function(mesh,useInstances){return!!mesh&&(!mesh.subMeshes||0===mesh.subMeshes.length||this.isReadyForSubMesh(mesh,mesh.subMeshes[0],useInstances))},PushMaterial.prototype.bindOnlyWorldMatrix=function(world){this._activeEffect.setMatrix("world",world)},PushMaterial.prototype.bind=function(world,mesh){mesh&&this.bindForSubMesh(world,mesh,mesh.subMeshes[0])},PushMaterial.prototype._afterBind=function(mesh,effect){void 0===effect&&(effect=null),_super.prototype._afterBind.call(this,mesh),this.getScene()._cachedEffect=effect},PushMaterial.prototype._mustRebind=function(scene,effect,visibility){return void 0===visibility&&(visibility=1),scene.isCachedMaterialInvalid(this,effect,visibility)},PushMaterial}(BABYLON.Material);BABYLON.PushMaterial=PushMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var VertexData=function(){function VertexData(){}return VertexData.prototype.set=function(data,kind){switch(kind){case BABYLON.VertexBuffer.PositionKind:this.positions=data;break;case BABYLON.VertexBuffer.NormalKind:this.normals=data;break;case BABYLON.VertexBuffer.TangentKind:this.tangents=data;break;case BABYLON.VertexBuffer.UVKind:this.uvs=data;break;case BABYLON.VertexBuffer.UV2Kind:this.uvs2=data;break;case BABYLON.VertexBuffer.UV3Kind:this.uvs3=data;break;case BABYLON.VertexBuffer.UV4Kind:this.uvs4=data;break;case BABYLON.VertexBuffer.UV5Kind:this.uvs5=data;break;case BABYLON.VertexBuffer.UV6Kind:this.uvs6=data;break;case BABYLON.VertexBuffer.ColorKind:this.colors=data;break;case BABYLON.VertexBuffer.MatricesIndicesKind:this.matricesIndices=data;break;case BABYLON.VertexBuffer.MatricesWeightsKind:this.matricesWeights=data;break;case BABYLON.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=data;break;case BABYLON.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=data}},VertexData.prototype.applyToMesh=function(mesh,updatable){return this._applyTo(mesh,updatable),this},VertexData.prototype.applyToGeometry=function(geometry,updatable){return this._applyTo(geometry,updatable),this},VertexData.prototype.updateMesh=function(mesh,updateExtends,makeItUnique){return this._update(mesh),this},VertexData.prototype.updateGeometry=function(geometry,updateExtends,makeItUnique){return this._update(geometry),this},VertexData.prototype._applyTo=function(meshOrGeometry,updatable){return void 0===updatable&&(updatable=!1),this.positions&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.PositionKind,this.positions,updatable),this.normals&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.NormalKind,this.normals,updatable),this.tangents&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.TangentKind,this.tangents,updatable),this.uvs&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UVKind,this.uvs,updatable),this.uvs2&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UV2Kind,this.uvs2,updatable),this.uvs3&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UV3Kind,this.uvs3,updatable),this.uvs4&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UV4Kind,this.uvs4,updatable),this.uvs5&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UV5Kind,this.uvs5,updatable),this.uvs6&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.UV6Kind,this.uvs6,updatable),this.colors&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.ColorKind,this.colors,updatable),this.matricesIndices&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,this.matricesIndices,updatable),this.matricesWeights&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind,this.matricesWeights,updatable),this.matricesIndicesExtra&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,updatable),this.matricesWeightsExtra&&meshOrGeometry.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,updatable),this.indices&&meshOrGeometry.setIndices(this.indices,null,updatable),this},VertexData.prototype._update=function(meshOrGeometry,updateExtends,makeItUnique){return this.positions&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.PositionKind,this.positions,updateExtends,makeItUnique),this.normals&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.NormalKind,this.normals,updateExtends,makeItUnique),this.tangents&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.TangentKind,this.tangents,updateExtends,makeItUnique),this.uvs&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UVKind,this.uvs,updateExtends,makeItUnique),this.uvs2&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UV2Kind,this.uvs2,updateExtends,makeItUnique),this.uvs3&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UV3Kind,this.uvs3,updateExtends,makeItUnique),this.uvs4&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UV4Kind,this.uvs4,updateExtends,makeItUnique),this.uvs5&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UV5Kind,this.uvs5,updateExtends,makeItUnique),this.uvs6&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.UV6Kind,this.uvs6,updateExtends,makeItUnique),this.colors&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.ColorKind,this.colors,updateExtends,makeItUnique),this.matricesIndices&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,this.matricesIndices,updateExtends,makeItUnique),this.matricesWeights&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind,this.matricesWeights,updateExtends,makeItUnique),this.matricesIndicesExtra&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,updateExtends,makeItUnique),this.matricesWeightsExtra&&meshOrGeometry.updateVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,updateExtends,makeItUnique),this.indices&&meshOrGeometry.setIndices(this.indices,null),this},VertexData.prototype.transform=function(matrix){var index,transformed=BABYLON.Vector3.Zero();if(this.positions){var position=BABYLON.Vector3.Zero();for(index=0;index<this.positions.length;index+=3)BABYLON.Vector3.FromArrayToRef(this.positions,index,position),BABYLON.Vector3.TransformCoordinatesToRef(position,matrix,transformed),this.positions[index]=transformed.x,this.positions[index+1]=transformed.y,this.positions[index+2]=transformed.z}if(this.normals){var normal=BABYLON.Vector3.Zero();for(index=0;index<this.normals.length;index+=3)BABYLON.Vector3.FromArrayToRef(this.normals,index,normal),BABYLON.Vector3.TransformNormalToRef(normal,matrix,transformed),this.normals[index]=transformed.x,this.normals[index+1]=transformed.y,this.normals[index+2]=transformed.z}if(this.tangents){var tangent=BABYLON.Vector4.Zero(),tangentTransformed=BABYLON.Vector4.Zero();for(index=0;index<this.tangents.length;index+=4)BABYLON.Vector4.FromArrayToRef(this.tangents,index,tangent),BABYLON.Vector4.TransformNormalToRef(tangent,matrix,tangentTransformed),this.tangents[index]=tangentTransformed.x,this.tangents[index+1]=tangentTransformed.y,this.tangents[index+2]=tangentTransformed.z,this.tangents[index+3]=tangentTransformed.w}return this},VertexData.prototype.merge=function(other,options){if(options=options||{},other.indices){this.indices||(this.indices=[]);for(var offset=this.positions?this.positions.length/3:0,index=0;index<other.indices.length;index++)this.indices.push(other.indices[index]+offset)}if(this.positions=this._mergeElement(this.positions,other.positions),!this.positions)return this;var count=this.positions.length/3;return this.normals=this._mergeElement(this.normals,other.normals,3*count),this.tangents=this._mergeElement(this.tangents,other.tangents,count*(options.tangentLength||4)),this.uvs=this._mergeElement(this.uvs,other.uvs,2*count),this.uvs2=this._mergeElement(this.uvs2,other.uvs2,2*count),this.uvs3=this._mergeElement(this.uvs3,other.uvs3,2*count),this.uvs4=this._mergeElement(this.uvs4,other.uvs4,2*count),this.uvs5=this._mergeElement(this.uvs5,other.uvs5,2*count),this.uvs6=this._mergeElement(this.uvs6,other.uvs6,2*count),this.colors=this._mergeElement(this.colors,other.colors,4*count,1),this.matricesIndices=this._mergeElement(this.matricesIndices,other.matricesIndices,4*count),this.matricesWeights=this._mergeElement(this.matricesWeights,other.matricesWeights,4*count),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,other.matricesIndicesExtra,4*count),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,other.matricesWeightsExtra,4*count),this},VertexData.prototype._mergeElement=function(source,other,length,defaultValue){if(void 0===length&&(length=0),void 0===defaultValue&&(defaultValue=0),!other&&!source)return null;if(!other)return(padding=new Float32Array(source.length)).fill(defaultValue),this._mergeElement(source,padding,length);if(!source){if(0===length||length===other.length)return other;var padding=new Float32Array(length-other.length);return padding.fill(defaultValue),this._mergeElement(padding,other,length)}var len=other.length+source.length,isSrcTypedArray=source instanceof Float32Array,isOthTypedArray=other instanceof Float32Array;if(isSrcTypedArray){var ret32=new Float32Array(len);return ret32.set(source),ret32.set(other,source.length),ret32}if(isOthTypedArray){for(var ret=source.slice(0),i=0,len=other.length;i<len;i++)ret.push(other[i]);return ret}return source.concat(other)},VertexData.prototype.serialize=function(){var serializationObject=this.serialize();return this.positions&&(serializationObject.positions=this.positions),this.normals&&(serializationObject.normals=this.normals),this.tangents&&(serializationObject.tangents=this.tangents),this.uvs&&(serializationObject.uvs=this.uvs),this.uvs2&&(serializationObject.uvs2=this.uvs2),this.uvs3&&(serializationObject.uvs3=this.uvs3),this.uvs4&&(serializationObject.uvs4=this.uvs4),this.uvs5&&(serializationObject.uvs5=this.uvs5),this.uvs6&&(serializationObject.uvs6=this.uvs6),this.colors&&(serializationObject.colors=this.colors),this.matricesIndices&&(serializationObject.matricesIndices=this.matricesIndices,serializationObject.matricesIndices._isExpanded=!0),this.matricesWeights&&(serializationObject.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(serializationObject.matricesIndicesExtra=this.matricesIndicesExtra,serializationObject.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(serializationObject.matricesWeightsExtra=this.matricesWeightsExtra),serializationObject.indices=this.indices,serializationObject},VertexData.ExtractFromMesh=function(mesh,copyWhenShared,forceCopy){return VertexData._ExtractFrom(mesh,copyWhenShared,forceCopy)},VertexData.ExtractFromGeometry=function(geometry,copyWhenShared,forceCopy){return VertexData._ExtractFrom(geometry,copyWhenShared,forceCopy)},VertexData._ExtractFrom=function(meshOrGeometry,copyWhenShared,forceCopy){var result=new VertexData;return meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind)&&(result.positions=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.PositionKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)&&(result.normals=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.NormalKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.TangentKind)&&(result.tangents=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.TangentKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(result.uvs=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UVKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(result.uvs2=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UV2Kind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UV3Kind)&&(result.uvs3=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UV3Kind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UV4Kind)&&(result.uvs4=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UV4Kind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UV5Kind)&&(result.uvs5=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UV5Kind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.UV6Kind)&&(result.uvs6=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.UV6Kind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.ColorKind)&&(result.colors=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.ColorKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesIndicesKind)&&(result.matricesIndices=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesWeightsKind)&&(result.matricesWeights=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesIndicesExtraKind)&&(result.matricesIndicesExtra=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,copyWhenShared,forceCopy)),meshOrGeometry.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesWeightsExtraKind)&&(result.matricesWeightsExtra=meshOrGeometry.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind,copyWhenShared,forceCopy)),result.indices=meshOrGeometry.getIndices(copyWhenShared),result},VertexData.CreateRibbon=function(options){var pathArray=options.pathArray,closeArray=options.closeArray||!1,closePath=options.closePath||!1,invertUV=options.invertUV||!1,defaultOffset=Math.floor(pathArray[0].length/2),offset=options.offset||defaultOffset;offset=offset>defaultOffset?defaultOffset:Math.floor(offset);var minlg,p,i,j,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,customUV=options.uvs,customColors=options.colors,positions=[],indices=[],normals=[],uvs=[],us=[],vs=[],uTotalDistance=[],vTotalDistance=[],lg=[],idx=[];if(pathArray.length<2){var ar1=[],ar2=[];for(i=0;i<pathArray[0].length-offset;i++)ar1.push(pathArray[0][i]),ar2.push(pathArray[0][i+offset]);pathArray=[ar1,ar2]}var path,l,idc=0,closePathCorr=closePath?1:0;minlg=pathArray[0].length;var dist;for(p=0;p<pathArray.length;p++){for(uTotalDistance[p]=0,us[p]=[0],minlg=minlg<(l=(path=pathArray[p]).length)?minlg:l,j=0;j<l;)positions.push(path[j].x,path[j].y,path[j].z),j>0&&(dist=path[j].subtract(path[j-1]).length()+uTotalDistance[p],us[p].push(dist),uTotalDistance[p]=dist),j++;closePath&&(j--,positions.push(path[0].x,path[0].y,path[0].z),dist=path[j].subtract(path[0]).length()+uTotalDistance[p],us[p].push(dist),uTotalDistance[p]=dist),lg[p]=l+closePathCorr,idx[p]=idc,idc+=l+closePathCorr}var path1,path2,vertex1=null,vertex2=null;for(i=0;i<minlg+closePathCorr;i++){for(vTotalDistance[i]=0,vs[i]=[0],p=0;p<pathArray.length-1;p++)path1=pathArray[p],path2=pathArray[p+1],i===minlg?(vertex1=path1[0],vertex2=path2[0]):(vertex1=path1[i],vertex2=path2[i]),dist=vertex2.subtract(vertex1).length()+vTotalDistance[i],vs[i].push(dist),vTotalDistance[i]=dist;closeArray&&vertex2&&vertex1&&(path1=pathArray[p],path2=pathArray[0],i===minlg&&(vertex2=path2[0]),dist=vertex2.subtract(vertex1).length()+vTotalDistance[i],vTotalDistance[i]=dist)}var u,v;if(customUV)for(p=0;p<customUV.length;p++)uvs.push(customUV[p].x,customUV[p].y);else for(p=0;p<pathArray.length;p++)for(i=0;i<minlg+closePathCorr;i++)u=0!=uTotalDistance[p]?us[p][i]/uTotalDistance[p]:0,v=0!=vTotalDistance[i]?vs[i][p]/vTotalDistance[i]:0,invertUV?uvs.push(v,u):uvs.push(u,v);for(var pi=0,l1=lg[p=0]-1,l2=lg[p+1]-1,min=l1<l2?l1:l2,shft=idx[1]-idx[0],path1nb=closeArray?lg.length:lg.length-1;pi<=min&&p<path1nb;)indices.push(pi,pi+shft,pi+1),indices.push(pi+shft+1,pi+1,pi+shft),(pi+=1)===min&&(++p===lg.length-1?(shft=idx[0]-idx[p],l1=lg[p]-1,l2=lg[0]-1):(shft=idx[p+1]-idx[p],l1=lg[p]-1,l2=lg[p+1]-1),pi=idx[p],min=l1<l2?l1+pi:l2+pi);if(VertexData.ComputeNormals(positions,indices,normals),closePath){var indexFirst=0,indexLast=0;for(p=0;p<pathArray.length;p++)indexFirst=3*idx[p],indexLast=p+1<pathArray.length?3*(idx[p+1]-1):normals.length-3,normals[indexFirst]=.5*(normals[indexFirst]+normals[indexLast]),normals[indexFirst+1]=.5*(normals[indexFirst+1]+normals[indexLast+1]),normals[indexFirst+2]=.5*(normals[indexFirst+2]+normals[indexLast+2]),normals[indexLast]=normals[indexFirst],normals[indexLast+1]=normals[indexFirst+1],normals[indexLast+2]=normals[indexFirst+2]}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var colors=null;if(customColors){colors=new Float32Array(4*customColors.length);for(var c=0;c<customColors.length;c++)colors[4*c]=customColors[c].r,colors[4*c+1]=customColors[c].g,colors[4*c+2]=customColors[c].b,colors[4*c+3]=customColors[c].a}var vertexData=new VertexData,positions32=new Float32Array(positions),normals32=new Float32Array(normals),uvs32=new Float32Array(uvs);return vertexData.indices=indices,vertexData.positions=positions32,vertexData.normals=normals32,vertexData.uvs=uvs32,colors&&vertexData.set(colors,BABYLON.VertexBuffer.ColorKind),closePath&&(vertexData._idx=idx),vertexData},VertexData.CreateBox=function(options){for(var normalsSource=[new BABYLON.Vector3(0,0,1),new BABYLON.Vector3(0,0,-1),new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(-1,0,0),new BABYLON.Vector3(0,1,0),new BABYLON.Vector3(0,-1,0)],indices=[],positions=[],normals=[],uvs=[],width=options.width||options.size||1,height=options.height||options.size||1,depth=options.depth||options.size||1,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,faceUV=options.faceUV||new Array(6),faceColors=options.faceColors,colors=[],f=0;f<6;f++)void 0===faceUV[f]&&(faceUV[f]=new BABYLON.Vector4(0,0,1,1)),faceColors&&void 0===faceColors[f]&&(faceColors[f]=new BABYLON.Color4(1,1,1,1));for(var scaleVector=new BABYLON.Vector3(width/2,height/2,depth/2),index=0;index<normalsSource.length;index++){var normal=normalsSource[index],side1=new BABYLON.Vector3(normal.y,normal.z,normal.x),side2=BABYLON.Vector3.Cross(normal,side1),verticesLength=positions.length/3;indices.push(verticesLength),indices.push(verticesLength+1),indices.push(verticesLength+2),indices.push(verticesLength),indices.push(verticesLength+2),indices.push(verticesLength+3);var vertex=normal.subtract(side1).subtract(side2).multiply(scaleVector);positions.push(vertex.x,vertex.y,vertex.z),normals.push(normal.x,normal.y,normal.z),uvs.push(faceUV[index].z,faceUV[index].w),faceColors&&colors.push(faceColors[index].r,faceColors[index].g,faceColors[index].b,faceColors[index].a),vertex=normal.subtract(side1).add(side2).multiply(scaleVector),positions.push(vertex.x,vertex.y,vertex.z),normals.push(normal.x,normal.y,normal.z),uvs.push(faceUV[index].x,faceUV[index].w),faceColors&&colors.push(faceColors[index].r,faceColors[index].g,faceColors[index].b,faceColors[index].a),vertex=normal.add(side1).add(side2).multiply(scaleVector),positions.push(vertex.x,vertex.y,vertex.z),normals.push(normal.x,normal.y,normal.z),uvs.push(faceUV[index].x,faceUV[index].y),faceColors&&colors.push(faceColors[index].r,faceColors[index].g,faceColors[index].b,faceColors[index].a),vertex=normal.add(side1).subtract(side2).multiply(scaleVector),positions.push(vertex.x,vertex.y,vertex.z),normals.push(normal.x,normal.y,normal.z),uvs.push(faceUV[index].z,faceUV[index].y),faceColors&&colors.push(faceColors[index].r,faceColors[index].g,faceColors[index].b,faceColors[index].a)}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;if(vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,faceColors){var totalColors=sideOrientation===BABYLON.Mesh.DOUBLESIDE?colors.concat(colors):colors;vertexData.colors=totalColors}return vertexData},VertexData.CreateSphere=function(options){for(var segments=options.segments||32,diameterX=options.diameterX||options.diameter||1,diameterY=options.diameterY||options.diameter||1,diameterZ=options.diameterZ||options.diameter||1,arc=options.arc&&(options.arc<=0||options.arc>1)?1:options.arc||1,slice=options.slice&&options.slice<=0?1:options.slice||1,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,radius=new BABYLON.Vector3(diameterX/2,diameterY/2,diameterZ/2),totalZRotationSteps=2+segments,totalYRotationSteps=2*totalZRotationSteps,indices=[],positions=[],normals=[],uvs=[],zRotationStep=0;zRotationStep<=totalZRotationSteps;zRotationStep++){for(var normalizedZ=zRotationStep/totalZRotationSteps,angleZ=normalizedZ*Math.PI*slice,yRotationStep=0;yRotationStep<=totalYRotationSteps;yRotationStep++){var normalizedY=yRotationStep/totalYRotationSteps,angleY=normalizedY*Math.PI*2*arc,rotationZ=BABYLON.Matrix.RotationZ(-angleZ),rotationY=BABYLON.Matrix.RotationY(angleY),afterRotZ=BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.Up(),rotationZ),complete=BABYLON.Vector3.TransformCoordinates(afterRotZ,rotationY),vertex=complete.multiply(radius),normal=complete.divide(radius).normalize();positions.push(vertex.x,vertex.y,vertex.z),normals.push(normal.x,normal.y,normal.z),uvs.push(normalizedY,normalizedZ)}if(zRotationStep>0)for(var verticesCount=positions.length/3,firstIndex=verticesCount-2*(totalYRotationSteps+1);firstIndex+totalYRotationSteps+2<verticesCount;firstIndex++)indices.push(firstIndex),indices.push(firstIndex+1),indices.push(firstIndex+totalYRotationSteps+1),indices.push(firstIndex+totalYRotationSteps+1),indices.push(firstIndex+1),indices.push(firstIndex+totalYRotationSteps+2)}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreateCylinder=function(options){var f,height=options.height||2,diameterTop=0===options.diameterTop?0:options.diameterTop||options.diameter||1,diameterBottom=0===options.diameterBottom?0:options.diameterBottom||options.diameter||1,tessellation=options.tessellation||24,subdivisions=options.subdivisions||1,hasRings=!!options.hasRings,enclose=!!options.enclose,arc=options.arc&&(options.arc<=0||options.arc>1)?1:options.arc||1,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,faceUV=options.faceUV||new Array(3),faceColors=options.faceColors,surfaceNb=2+(1+(1!==arc&&enclose?2:0))*(hasRings?subdivisions:1);for(f=0;f<surfaceNb;f++)faceColors&&void 0===faceColors[f]&&(faceColors[f]=new BABYLON.Color4(1,1,1,1));for(f=0;f<surfaceNb;f++)faceUV&&void 0===faceUV[f]&&(faceUV[f]=new BABYLON.Vector4(0,0,1,1));var angle,h,radius,i,j,r,indices=new Array,positions=new Array,normals=new Array,uvs=new Array,colors=new Array,angle_step=2*Math.PI*arc/tessellation,tan=(diameterBottom-diameterTop)/2/height,ringVertex=BABYLON.Vector3.Zero(),ringNormal=BABYLON.Vector3.Zero(),ringFirstVertex=BABYLON.Vector3.Zero(),ringFirstNormal=BABYLON.Vector3.Zero(),quadNormal=BABYLON.Vector3.Zero(),Y=BABYLON.Axis.Y,ringIdx=1,s=1,cs=0,v=0;for(i=0;i<=subdivisions;i++)for(radius=((h=i/subdivisions)*(diameterTop-diameterBottom)+diameterBottom)/2,ringIdx=hasRings&&0!==i&&i!==subdivisions?2:1,r=0;r<ringIdx;r++){for(hasRings&&(s+=r),enclose&&(s+=2*r),j=0;j<=tessellation;j++)angle=j*angle_step,ringVertex.x=Math.cos(-angle)*radius,ringVertex.y=-height/2+h*height,ringVertex.z=Math.sin(-angle)*radius,0===diameterTop&&i===subdivisions?(ringNormal.x=normals[normals.length-3*(tessellation+1)],ringNormal.y=normals[normals.length-3*(tessellation+1)+1],ringNormal.z=normals[normals.length-3*(tessellation+1)+2]):(ringNormal.x=ringVertex.x,ringNormal.z=ringVertex.z,ringNormal.y=Math.sqrt(ringNormal.x*ringNormal.x+ringNormal.z*ringNormal.z)*tan,ringNormal.normalize()),0===j&&(ringFirstVertex.copyFrom(ringVertex),ringFirstNormal.copyFrom(ringNormal)),positions.push(ringVertex.x,ringVertex.y,ringVertex.z),normals.push(ringNormal.x,ringNormal.y,ringNormal.z),v=hasRings?cs!==s?faceUV[s].y:faceUV[s].w:faceUV[s].y+(faceUV[s].w-faceUV[s].y)*h,uvs.push(faceUV[s].x+(faceUV[s].z-faceUV[s].x)*j/tessellation,v),faceColors&&colors.push(faceColors[s].r,faceColors[s].g,faceColors[s].b,faceColors[s].a);1!==arc&&enclose&&(positions.push(ringVertex.x,ringVertex.y,ringVertex.z),positions.push(0,ringVertex.y,0),positions.push(0,ringVertex.y,0),positions.push(ringFirstVertex.x,ringFirstVertex.y,ringFirstVertex.z),BABYLON.Vector3.CrossToRef(Y,ringNormal,quadNormal),quadNormal.normalize(),normals.push(quadNormal.x,quadNormal.y,quadNormal.z,quadNormal.x,quadNormal.y,quadNormal.z),BABYLON.Vector3.CrossToRef(ringFirstNormal,Y,quadNormal),quadNormal.normalize(),normals.push(quadNormal.x,quadNormal.y,quadNormal.z,quadNormal.x,quadNormal.y,quadNormal.z),v=hasRings?cs!==s?faceUV[s+1].y:faceUV[s+1].w:faceUV[s+1].y+(faceUV[s+1].w-faceUV[s+1].y)*h,uvs.push(faceUV[s+1].x,v),uvs.push(faceUV[s+1].z,v),v=hasRings?cs!==s?faceUV[s+2].y:faceUV[s+2].w:faceUV[s+2].y+(faceUV[s+2].w-faceUV[s+2].y)*h,uvs.push(faceUV[s+2].x,v),uvs.push(faceUV[s+2].z,v),faceColors&&(colors.push(faceColors[s+1].r,faceColors[s+1].g,faceColors[s+1].b,faceColors[s+1].a),colors.push(faceColors[s+1].r,faceColors[s+1].g,faceColors[s+1].b,faceColors[s+1].a),colors.push(faceColors[s+2].r,faceColors[s+2].g,faceColors[s+2].b,faceColors[s+2].a),colors.push(faceColors[s+2].r,faceColors[s+2].g,faceColors[s+2].b,faceColors[s+2].a))),cs!==s&&(cs=s)}var e=1!==arc&&enclose?tessellation+4:tessellation;for(i=0,s=0;s<subdivisions;s++){var i0=0,i1=0,i2=0,i3=0;for(j=0;j<tessellation;j++)i0=i*(e+1)+j,i1=(i+1)*(e+1)+j,i2=i*(e+1)+(j+1),i3=(i+1)*(e+1)+(j+1),indices.push(i0,i1,i2),indices.push(i3,i2,i1);1!==arc&&enclose&&(indices.push(i0+2,i1+2,i2+2),indices.push(i3+2,i2+2,i1+2),indices.push(i0+4,i1+4,i2+4),indices.push(i3+4,i2+4,i1+4)),i=hasRings?i+2:i+1}var createCylinderCap=function(isTop){var radius=isTop?diameterTop/2:diameterBottom/2;if(0!==radius){var angle,circleVector,i,u=isTop?faceUV[surfaceNb-1]:faceUV[0],c=null;faceColors&&(c=isTop?faceColors[surfaceNb-1]:faceColors[0]);var vbase=positions.length/3,offset=isTop?height/2:-height/2,center=new BABYLON.Vector3(0,offset,0);positions.push(center.x,center.y,center.z),normals.push(0,isTop?1:-1,0),uvs.push(u.x+.5*(u.z-u.x),u.y+.5*(u.w-u.y)),c&&colors.push(c.r,c.g,c.b,c.a);var textureScale=new BABYLON.Vector2(.5,.5);for(i=0;i<=tessellation;i++){angle=2*Math.PI*i*arc/tessellation;var cos=Math.cos(-angle),sin=Math.sin(-angle);circleVector=new BABYLON.Vector3(cos*radius,offset,sin*radius);var textureCoordinate=new BABYLON.Vector2(cos*textureScale.x+.5,sin*textureScale.y+.5);positions.push(circleVector.x,circleVector.y,circleVector.z),normals.push(0,isTop?1:-1,0),uvs.push(u.x+(u.z-u.x)*textureCoordinate.x,u.y+(u.w-u.y)*textureCoordinate.y),c&&colors.push(c.r,c.g,c.b,c.a)}for(i=0;i<tessellation;i++)isTop?(indices.push(vbase),indices.push(vbase+(i+2)),indices.push(vbase+(i+1))):(indices.push(vbase),indices.push(vbase+(i+1)),indices.push(vbase+(i+2)))}};createCylinderCap(!1),createCylinderCap(!0),VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,faceColors&&(vertexData.colors=colors),vertexData},VertexData.CreateTorus=function(options){for(var indices=[],positions=[],normals=[],uvs=[],diameter=options.diameter||1,thickness=options.thickness||.5,tessellation=options.tessellation||16,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,stride=tessellation+1,i=0;i<=tessellation;i++)for(var u=i/tessellation,outerAngle=i*Math.PI*2/tessellation-Math.PI/2,transform=BABYLON.Matrix.Translation(diameter/2,0,0).multiply(BABYLON.Matrix.RotationY(outerAngle)),j=0;j<=tessellation;j++){var v=1-j/tessellation,innerAngle=j*Math.PI*2/tessellation+Math.PI,dx=Math.cos(innerAngle),dy=Math.sin(innerAngle),normal=new BABYLON.Vector3(dx,dy,0),position=normal.scale(thickness/2),textureCoordinate=new BABYLON.Vector2(u,v);position=BABYLON.Vector3.TransformCoordinates(position,transform),normal=BABYLON.Vector3.TransformNormal(normal,transform),positions.push(position.x,position.y,position.z),normals.push(normal.x,normal.y,normal.z),uvs.push(textureCoordinate.x,textureCoordinate.y);var nextI=(i+1)%stride,nextJ=(j+1)%stride;indices.push(i*stride+j),indices.push(i*stride+nextJ),indices.push(nextI*stride+j),indices.push(i*stride+nextJ),indices.push(nextI*stride+nextJ),indices.push(nextI*stride+j)}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreateLineSystem=function(options){for(var indices=[],positions=[],lines=options.lines,colors=options.colors,vertexColors=[],idx=0,l=0;l<lines.length;l++)for(var points=lines[l],index=0;index<points.length;index++){if(positions.push(points[index].x,points[index].y,points[index].z),colors){var color=colors[l];vertexColors.push(color[index].r,color[index].g,color[index].b,color[index].a)}index>0&&(indices.push(idx-1),indices.push(idx)),idx++}var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,colors&&(vertexData.colors=vertexColors),vertexData},VertexData.CreateDashedLines=function(options){var dashSize=options.dashSize||3,gapSize=options.gapSize||1,dashNb=options.dashNb||200,points=options.points,positions=new Array,indices=new Array,curvect=BABYLON.Vector3.Zero(),lg=0,nb=0,shft=0,dashshft=0,curshft=0,idx=0,i=0;for(i=0;i<points.length-1;i++)points[i+1].subtractToRef(points[i],curvect),lg+=curvect.length();for(dashshft=dashSize*(shft=lg/dashNb)/(dashSize+gapSize),i=0;i<points.length-1;i++){points[i+1].subtractToRef(points[i],curvect),nb=Math.floor(curvect.length()/shft),curvect.normalize();for(var j=0;j<nb;j++)curshft=shft*j,positions.push(points[i].x+curshft*curvect.x,points[i].y+curshft*curvect.y,points[i].z+curshft*curvect.z),positions.push(points[i].x+(curshft+dashshft)*curvect.x,points[i].y+(curshft+dashshft)*curvect.y,points[i].z+(curshft+dashshft)*curvect.z),indices.push(idx,idx+1),idx+=2}var vertexData=new VertexData;return vertexData.positions=positions,vertexData.indices=indices,vertexData},VertexData.CreateGround=function(options){var row,col,indices=[],positions=[],normals=[],uvs=[],width=options.width||1,height=options.height||1,subdivisionsX=options.subdivisionsX||options.subdivisions||1,subdivisionsY=options.subdivisionsY||options.subdivisions||1;for(row=0;row<=subdivisionsY;row++)for(col=0;col<=subdivisionsX;col++){var position=new BABYLON.Vector3(col*width/subdivisionsX-width/2,0,(subdivisionsY-row)*height/subdivisionsY-height/2),normal=new BABYLON.Vector3(0,1,0);positions.push(position.x,position.y,position.z),normals.push(normal.x,normal.y,normal.z),uvs.push(col/subdivisionsX,1-row/subdivisionsY)}for(row=0;row<subdivisionsY;row++)for(col=0;col<subdivisionsX;col++)indices.push(col+1+(row+1)*(subdivisionsX+1)),indices.push(col+1+row*(subdivisionsX+1)),indices.push(col+row*(subdivisionsX+1)),indices.push(col+(row+1)*(subdivisionsX+1)),indices.push(col+1+(row+1)*(subdivisionsX+1)),indices.push(col+row*(subdivisionsX+1));var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreateTiledGround=function(options){var row,col,tileRow,tileCol,xmin=options.xmin||-1,zmin=options.zmin||-1,xmax=options.xmax||1,zmax=options.zmax||1,subdivisions=options.subdivisions||{w:1,h:1},precision=options.precision||{w:1,h:1},indices=new Array,positions=new Array,normals=new Array,uvs=new Array;subdivisions.h=subdivisions.h<1?1:subdivisions.h,subdivisions.w=subdivisions.w<1?1:subdivisions.w,precision.w=precision.w<1?1:precision.w,precision.h=precision.h<1?1:precision.h;var tileSize={w:(xmax-xmin)/subdivisions.w,h:(zmax-zmin)/subdivisions.h};for(tileRow=0;tileRow<subdivisions.h;tileRow++)for(tileCol=0;tileCol<subdivisions.w;tileCol++)!function(xTileMin,zTileMin,xTileMax,zTileMax){var base=positions.length/3,rowLength=precision.w+1;for(row=0;row<precision.h;row++)for(col=0;col<precision.w;col++){var square=[base+col+row*rowLength,base+(col+1)+row*rowLength,base+(col+1)+(row+1)*rowLength,base+col+(row+1)*rowLength];indices.push(square[1]),indices.push(square[2]),indices.push(square[3]),indices.push(square[0]),indices.push(square[1]),indices.push(square[3])}var position=BABYLON.Vector3.Zero(),normal=new BABYLON.Vector3(0,1,0);for(row=0;row<=precision.h;row++)for(position.z=row*(zTileMax-zTileMin)/precision.h+zTileMin,col=0;col<=precision.w;col++)position.x=col*(xTileMax-xTileMin)/precision.w+xTileMin,position.y=0,positions.push(position.x,position.y,position.z),normals.push(normal.x,normal.y,normal.z),uvs.push(col/precision.w,row/precision.h)}(xmin+tileCol*tileSize.w,zmin+tileRow*tileSize.h,xmin+(tileCol+1)*tileSize.w,zmin+(tileRow+1)*tileSize.h);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreateGroundFromHeightMap=function(options){var row,col,indices=[],positions=[],normals=[],uvs=[],filter=options.colorFilter||new BABYLON.Color3(.3,.59,.11);for(row=0;row<=options.subdivisions;row++)for(col=0;col<=options.subdivisions;col++){var position=new BABYLON.Vector3(col*options.width/options.subdivisions-options.width/2,0,(options.subdivisions-row)*options.height/options.subdivisions-options.height/2),pos=4*(((position.x+options.width/2)/options.width*(options.bufferWidth-1)|0)+((1-(position.z+options.height/2)/options.height)*(options.bufferHeight-1)|0)*options.bufferWidth),r=options.buffer[pos]/255,g=options.buffer[pos+1]/255,b=options.buffer[pos+2]/255,gradient=r*filter.r+g*filter.g+b*filter.b;position.y=options.minHeight+(options.maxHeight-options.minHeight)*gradient,positions.push(position.x,position.y,position.z),normals.push(0,0,0),uvs.push(col/options.subdivisions,1-row/options.subdivisions)}for(row=0;row<options.subdivisions;row++)for(col=0;col<options.subdivisions;col++)indices.push(col+1+(row+1)*(options.subdivisions+1)),indices.push(col+1+row*(options.subdivisions+1)),indices.push(col+row*(options.subdivisions+1)),indices.push(col+(row+1)*(options.subdivisions+1)),indices.push(col+1+(row+1)*(options.subdivisions+1)),indices.push(col+row*(options.subdivisions+1));VertexData.ComputeNormals(positions,indices,normals);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreatePlane=function(options){var indices=[],positions=[],normals=[],uvs=[],width=options.width||options.size||1,height=options.height||options.size||1,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,halfWidth=width/2,halfHeight=height/2;positions.push(-halfWidth,-halfHeight,0),normals.push(0,0,-1),uvs.push(0,0),positions.push(halfWidth,-halfHeight,0),normals.push(0,0,-1),uvs.push(1,0),positions.push(halfWidth,halfHeight,0),normals.push(0,0,-1),uvs.push(1,1),positions.push(-halfWidth,halfHeight,0),normals.push(0,0,-1),uvs.push(0,1),indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreateDisc=function(options){var positions=new Array,indices=new Array,normals=new Array,uvs=new Array,radius=options.radius||.5,tessellation=options.tessellation||64,arc=options.arc&&(options.arc<=0||options.arc>1)?1:options.arc||1,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE;positions.push(0,0,0),uvs.push(.5,.5);for(var theta=2*Math.PI*arc,step=theta/tessellation,a=0;a<theta;a+=step){var x=Math.cos(a),y=Math.sin(a),u=(x+1)/2,v=(1-y)/2;positions.push(radius*x,radius*y,0),uvs.push(u,v)}1===arc&&(positions.push(positions[3],positions[4],positions[5]),uvs.push(uvs[2],uvs[3]));for(var vertexNb=positions.length/3,i=1;i<vertexNb-1;i++)indices.push(i+1,0,i);VertexData.ComputeNormals(positions,indices,normals),VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreatePolygon=function(polygon,sideOrientation,fUV,fColors,frontUVs,backUVs){for(var faceUV=fUV||new Array(3),faceColors=fColors,colors=[],f=0;f<3;f++)void 0===faceUV[f]&&(faceUV[f]=new BABYLON.Vector4(0,0,1,1)),faceColors&&void 0===faceColors[f]&&(faceColors[f]=new BABYLON.Color4(1,1,1,1));for(var positions=polygon.getVerticesData(BABYLON.VertexBuffer.PositionKind),normals=polygon.getVerticesData(BABYLON.VertexBuffer.NormalKind),uvs=polygon.getVerticesData(BABYLON.VertexBuffer.UVKind),indices=polygon.getIndices(),idx=0,face=0,index=0;index<normals.length;index+=3)Math.abs(normals[index+1])<.001&&(face=1),Math.abs(normals[index+1]-1)<.001&&(face=0),Math.abs(normals[index+1]+1)<.001&&(face=2),uvs[2*(idx=index/3)]=(1-uvs[2*idx])*faceUV[face].x+uvs[2*idx]*faceUV[face].z,uvs[2*idx+1]=(1-uvs[2*idx+1])*faceUV[face].y+uvs[2*idx+1]*faceUV[face].w,faceColors&&colors.push(faceColors[face].r,faceColors[face].g,faceColors[face].b,faceColors[face].a);VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,frontUVs,backUVs);var vertexData=new VertexData;if(vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,faceColors){var totalColors=sideOrientation===BABYLON.Mesh.DOUBLESIDE?colors.concat(colors):colors;vertexData.colors=totalColors}return vertexData},VertexData.CreateIcoSphere=function(options){var v012,sideOrientation=options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,radius=options.radius||1,flat=void 0===options.flat||options.flat,subdivisions=options.subdivisions||4,radiusX=options.radiusX||radius,radiusY=options.radiusY||radius,radiusZ=options.radiusZ||radius,t=(1+Math.sqrt(5))/2,ico_vertices=[-1,t,-0,1,t,0,-1,-t,0,1,-t,0,0,-1,-t,0,1,-t,0,-1,t,0,1,t,t,0,1,t,0,-1,-t,0,1,-t,0,-1],ico_indices=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],vertices_unalias_id=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],ico_vertexuv=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],island=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],indices=new Array,positions=new Array,normals=new Array,uvs=new Array,current_indice=0,face_vertex_pos=new Array(3),face_vertex_uv=new Array(3);for(v012=0;v012<3;v012++)face_vertex_pos[v012]=BABYLON.Vector3.Zero(),face_vertex_uv[v012]=BABYLON.Vector2.Zero();for(var face=0;face<20;face++){for(v012=0;v012<3;v012++){var v_id=ico_indices[3*face+v012];face_vertex_pos[v012].copyFromFloats(ico_vertices[3*vertices_unalias_id[v_id]],ico_vertices[3*vertices_unalias_id[v_id]+1],ico_vertices[3*vertices_unalias_id[v_id]+2]),face_vertex_pos[v012].normalize().scaleInPlace(radius),face_vertex_uv[v012].copyFromFloats(ico_vertexuv[2*v_id]*(138/1024)+60/1024+island[face]*(-40/1024),ico_vertexuv[2*v_id+1]*(239/1024)+26/1024+island[face]*(20/1024))}for(var interp_vertex=function(i1,i2,c1,c2){var pos_x0=BABYLON.Vector3.Lerp(face_vertex_pos[0],face_vertex_pos[2],i2/subdivisions),pos_x1=BABYLON.Vector3.Lerp(face_vertex_pos[1],face_vertex_pos[2],i2/subdivisions),pos_interp=subdivisions===i2?face_vertex_pos[2]:BABYLON.Vector3.Lerp(pos_x0,pos_x1,i1/(subdivisions-i2));pos_interp.normalize();var vertex_normal;if(flat){var centroid_x0=BABYLON.Vector3.Lerp(face_vertex_pos[0],face_vertex_pos[2],c2/subdivisions),centroid_x1=BABYLON.Vector3.Lerp(face_vertex_pos[1],face_vertex_pos[2],c2/subdivisions);vertex_normal=BABYLON.Vector3.Lerp(centroid_x0,centroid_x1,c1/(subdivisions-c2))}else vertex_normal=new BABYLON.Vector3(pos_interp.x,pos_interp.y,pos_interp.z);vertex_normal.x/=radiusX,vertex_normal.y/=radiusY,vertex_normal.z/=radiusZ,vertex_normal.normalize();var uv_x0=BABYLON.Vector2.Lerp(face_vertex_uv[0],face_vertex_uv[2],i2/subdivisions),uv_x1=BABYLON.Vector2.Lerp(face_vertex_uv[1],face_vertex_uv[2],i2/subdivisions),uv_interp=subdivisions===i2?face_vertex_uv[2]:BABYLON.Vector2.Lerp(uv_x0,uv_x1,i1/(subdivisions-i2));positions.push(pos_interp.x*radiusX,pos_interp.y*radiusY,pos_interp.z*radiusZ),normals.push(vertex_normal.x,vertex_normal.y,vertex_normal.z),uvs.push(uv_interp.x,uv_interp.y),indices.push(current_indice),current_indice++},i2=0;i2<subdivisions;i2++)for(var i1=0;i1+i2<subdivisions;i1++)interp_vertex(i1,i2,i1+1/3,i2+1/3),interp_vertex(i1+1,i2,i1+1/3,i2+1/3),interp_vertex(i1,i2+1,i1+1/3,i2+1/3),i1+i2+1<subdivisions&&(interp_vertex(i1+1,i2,i1+2/3,i2+2/3),interp_vertex(i1+1,i2+1,i1+2/3,i2+2/3),interp_vertex(i1,i2+1,i1+2/3,i2+2/3))}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.CreatePolyhedron=function(options){var polyhedra=[];polyhedra[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},polyhedra[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},polyhedra[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},polyhedra[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},polyhedra[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},polyhedra[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},polyhedra[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},polyhedra[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},polyhedra[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},polyhedra[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},polyhedra[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},polyhedra[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},polyhedra[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},polyhedra[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},polyhedra[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var u,v,ang,x,y,tmp,type=options.type&&(options.type<0||options.type>=polyhedra.length)?0:options.type||0,size=options.size,sizeX=options.sizeX||size||1,sizeY=options.sizeY||size||1,sizeZ=options.sizeZ||size||1,data=options.custom||polyhedra[type],nbfaces=data.face.length,faceUV=options.faceUV||new Array(nbfaces),faceColors=options.faceColors,flat=void 0===options.flat||options.flat,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,positions=new Array,indices=new Array,normals=new Array,uvs=new Array,colors=new Array,index=0,faceIdx=0,indexes=new Array,i=0,f=0;if(flat)for(f=0;f<nbfaces;f++)faceColors&&void 0===faceColors[f]&&(faceColors[f]=new BABYLON.Color4(1,1,1,1)),faceUV&&void 0===faceUV[f]&&(faceUV[f]=new BABYLON.Vector4(0,0,1,1));if(flat)for(f=0;f<nbfaces;f++){var fl=data.face[f].length;for(ang=2*Math.PI/fl,x=.5*Math.tan(ang/2),y=.5,i=0;i<fl;i++)positions.push(data.vertex[data.face[f][i]][0]*sizeX,data.vertex[data.face[f][i]][1]*sizeY,data.vertex[data.face[f][i]][2]*sizeZ),indexes.push(index),index++,u=faceUV[f].x+(faceUV[f].z-faceUV[f].x)*(.5+x),v=faceUV[f].y+(faceUV[f].w-faceUV[f].y)*(y-.5),uvs.push(u,v),tmp=x*Math.cos(ang)-y*Math.sin(ang),y=x*Math.sin(ang)+y*Math.cos(ang),x=tmp,faceColors&&colors.push(faceColors[f].r,faceColors[f].g,faceColors[f].b,faceColors[f].a);for(i=0;i<fl-2;i++)indices.push(indexes[0+faceIdx],indexes[i+2+faceIdx],indexes[i+1+faceIdx]);faceIdx+=fl}else{for(i=0;i<data.vertex.length;i++)positions.push(data.vertex[i][0]*sizeX,data.vertex[i][1]*sizeY,data.vertex[i][2]*sizeZ),uvs.push(0,0);for(f=0;f<nbfaces;f++)for(i=0;i<data.face[f].length-2;i++)indices.push(data.face[f][0],data.face[f][i+2],data.face[f][i+1])}VertexData.ComputeNormals(positions,indices,normals),VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.positions=positions,vertexData.indices=indices,vertexData.normals=normals,vertexData.uvs=uvs,faceColors&&flat&&(vertexData.colors=colors),vertexData},VertexData.CreateTorusKnot=function(options){var i,j,indices=new Array,positions=new Array,normals=new Array,uvs=new Array,radius=options.radius||2,tube=options.tube||.5,radialSegments=options.radialSegments||32,tubularSegments=options.tubularSegments||32,p=options.p||2,q=options.q||3,sideOrientation=0===options.sideOrientation?0:options.sideOrientation||BABYLON.Mesh.DEFAULTSIDE,getPos=function(angle){var cu=Math.cos(angle),su=Math.sin(angle),quOverP=q/p*angle,cs=Math.cos(quOverP),tx=radius*(2+cs)*.5*cu,ty=radius*(2+cs)*su*.5,tz=radius*Math.sin(quOverP)*.5;return new BABYLON.Vector3(tx,ty,tz)};for(i=0;i<=radialSegments;i++){var u=i%radialSegments/radialSegments*2*p*Math.PI,p1=getPos(u),p2=getPos(u+.01),tang=p2.subtract(p1),n=p2.add(p1),bitan=BABYLON.Vector3.Cross(tang,n);for(n=BABYLON.Vector3.Cross(bitan,tang),bitan.normalize(),n.normalize(),j=0;j<tubularSegments;j++){var v=j%tubularSegments/tubularSegments*2*Math.PI,cx=-tube*Math.cos(v),cy=tube*Math.sin(v);positions.push(p1.x+cx*n.x+cy*bitan.x),positions.push(p1.y+cx*n.y+cy*bitan.y),positions.push(p1.z+cx*n.z+cy*bitan.z),uvs.push(i/radialSegments),uvs.push(j/tubularSegments)}}for(i=0;i<radialSegments;i++)for(j=0;j<tubularSegments;j++){var jNext=(j+1)%tubularSegments,a=i*tubularSegments+j,b=(i+1)*tubularSegments+j,c=(i+1)*tubularSegments+jNext,d=i*tubularSegments+jNext;indices.push(d),indices.push(b),indices.push(a),indices.push(d),indices.push(c),indices.push(b)}VertexData.ComputeNormals(positions,indices,normals),VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData;return vertexData.indices=indices,vertexData.positions=positions,vertexData.normals=normals,vertexData.uvs=uvs,vertexData},VertexData.ComputeNormals=function(positions,indices,normals,options){var index=0,p1p2x=0,p1p2y=0,p1p2z=0,p3p2x=0,p3p2y=0,p3p2z=0,faceNormalx=0,faceNormaly=0,faceNormalz=0,length=0,v1x=0,v1y=0,v1z=0,v2x=0,v2y=0,v2z=0,v3x=0,v3y=0,v3z=0,computeFacetNormals=!1,computeFacetPositions=!1,computeFacetPartitioning=!1,computeDepthSort=!1,faceNormalSign=1,ratio=0,distanceTo=null;if(options&&(computeFacetNormals=!!options.facetNormals,computeFacetPositions=!!options.facetPositions,computeFacetPartitioning=!!options.facetPartitioning,faceNormalSign=!0===options.useRightHandedSystem?-1:1,ratio=options.ratio||0,computeDepthSort=!!options.depthSort,distanceTo=options.distanceTo,computeDepthSort)){void 0===distanceTo&&(distanceTo=BABYLON.Vector3.Zero());var depthSortedFacets=options.depthSortedFacets}var xSubRatio=0,ySubRatio=0,zSubRatio=0,subSq=0;if(computeFacetPartitioning&&options&&options.bbSize){var ox=0,oy=0,oz=0,b1x=0,b1y=0,b1z=0,b2x=0,b2y=0,b2z=0,b3x=0,b3y=0,b3z=0,block_idx_o=0,block_idx_v1=0,block_idx_v2=0,block_idx_v3=0,bbSizeMax=options.bbSize.x>options.bbSize.y?options.bbSize.x:options.bbSize.y;bbSizeMax=bbSizeMax>options.bbSize.z?bbSizeMax:options.bbSize.z,xSubRatio=options.subDiv.X*ratio/options.bbSize.x,ySubRatio=options.subDiv.Y*ratio/options.bbSize.y,zSubRatio=options.subDiv.Z*ratio/options.bbSize.z,subSq=options.subDiv.max*options.subDiv.max,options.facetPartitioning.length=0}for(index=0;index<positions.length;index++)normals[index]=0;var nbFaces=indices.length/3|0;for(index=0;index<nbFaces;index++){if(v1x=3*indices[3*index],v1y=v1x+1,v1z=v1x+2,v2x=3*indices[3*index+1],v2y=v2x+1,v2z=v2x+2,v3x=3*indices[3*index+2],v3y=v3x+1,v3z=v3x+2,p1p2x=positions[v1x]-positions[v2x],p1p2y=positions[v1y]-positions[v2y],p1p2z=positions[v1z]-positions[v2z],p3p2x=positions[v3x]-positions[v2x],p3p2y=positions[v3y]-positions[v2y],p3p2z=positions[v3z]-positions[v2z],faceNormalx=faceNormalSign*(p1p2y*p3p2z-p1p2z*p3p2y),faceNormaly=faceNormalSign*(p1p2z*p3p2x-p1p2x*p3p2z),faceNormalz=faceNormalSign*(p1p2x*p3p2y-p1p2y*p3p2x),length=Math.sqrt(faceNormalx*faceNormalx+faceNormaly*faceNormaly+faceNormalz*faceNormalz),length=0===length?1:length,faceNormalx/=length,faceNormaly/=length,faceNormalz/=length,computeFacetNormals&&options&&(options.facetNormals[index].x=faceNormalx,options.facetNormals[index].y=faceNormaly,options.facetNormals[index].z=faceNormalz),computeFacetPositions&&options&&(options.facetPositions[index].x=(positions[v1x]+positions[v2x]+positions[v3x])/3,options.facetPositions[index].y=(positions[v1y]+positions[v2y]+positions[v3y])/3,options.facetPositions[index].z=(positions[v1z]+positions[v2z]+positions[v3z])/3),computeFacetPartitioning&&options&&(ox=Math.floor((options.facetPositions[index].x-options.bInfo.minimum.x*ratio)*xSubRatio),oy=Math.floor((options.facetPositions[index].y-options.bInfo.minimum.y*ratio)*ySubRatio),oz=Math.floor((options.facetPositions[index].z-options.bInfo.minimum.z*ratio)*zSubRatio),b1x=Math.floor((positions[v1x]-options.bInfo.minimum.x*ratio)*xSubRatio),b1y=Math.floor((positions[v1y]-options.bInfo.minimum.y*ratio)*ySubRatio),b1z=Math.floor((positions[v1z]-options.bInfo.minimum.z*ratio)*zSubRatio),b2x=Math.floor((positions[v2x]-options.bInfo.minimum.x*ratio)*xSubRatio),b2y=Math.floor((positions[v2y]-options.bInfo.minimum.y*ratio)*ySubRatio),b2z=Math.floor((positions[v2z]-options.bInfo.minimum.z*ratio)*zSubRatio),b3x=Math.floor((positions[v3x]-options.bInfo.minimum.x*ratio)*xSubRatio),b3y=Math.floor((positions[v3y]-options.bInfo.minimum.y*ratio)*ySubRatio),b3z=Math.floor((positions[v3z]-options.bInfo.minimum.z*ratio)*zSubRatio),block_idx_v1=b1x+options.subDiv.max*b1y+subSq*b1z,block_idx_v2=b2x+options.subDiv.max*b2y+subSq*b2z,block_idx_v3=b3x+options.subDiv.max*b3y+subSq*b3z,block_idx_o=ox+options.subDiv.max*oy+subSq*oz,options.facetPartitioning[block_idx_o]=options.facetPartitioning[block_idx_o]?options.facetPartitioning[block_idx_o]:new Array,options.facetPartitioning[block_idx_v1]=options.facetPartitioning[block_idx_v1]?options.facetPartitioning[block_idx_v1]:new Array,options.facetPartitioning[block_idx_v2]=options.facetPartitioning[block_idx_v2]?options.facetPartitioning[block_idx_v2]:new Array,options.facetPartitioning[block_idx_v3]=options.facetPartitioning[block_idx_v3]?options.facetPartitioning[block_idx_v3]:new Array,options.facetPartitioning[block_idx_v1].push(index),block_idx_v2!=block_idx_v1&&options.facetPartitioning[block_idx_v2].push(index),block_idx_v3!=block_idx_v2&&block_idx_v3!=block_idx_v1&&options.facetPartitioning[block_idx_v3].push(index),block_idx_o!=block_idx_v1&&block_idx_o!=block_idx_v2&&block_idx_o!=block_idx_v3&&options.facetPartitioning[block_idx_o].push(index)),computeDepthSort&&options&&options.facetPositions){var dsf=depthSortedFacets[index];dsf.ind=3*index,dsf.sqDistance=BABYLON.Vector3.DistanceSquared(options.facetPositions[index],distanceTo)}normals[v1x]+=faceNormalx,normals[v1y]+=faceNormaly,normals[v1z]+=faceNormalz,normals[v2x]+=faceNormalx,normals[v2y]+=faceNormaly,normals[v2z]+=faceNormalz,normals[v3x]+=faceNormalx,normals[v3y]+=faceNormaly,normals[v3z]+=faceNormalz}for(index=0;index<normals.length/3;index++)faceNormalx=normals[3*index],faceNormaly=normals[3*index+1],faceNormalz=normals[3*index+2],faceNormalx/=length=0===(length=Math.sqrt(faceNormalx*faceNormalx+faceNormaly*faceNormaly+faceNormalz*faceNormalz))?1:length,faceNormaly/=length,faceNormalz/=length,normals[3*index]=faceNormalx,normals[3*index+1]=faceNormaly,normals[3*index+2]=faceNormalz},VertexData._ComputeSides=function(sideOrientation,positions,indices,normals,uvs,frontUVs,backUVs){var i,n,li=indices.length,ln=normals.length;switch(sideOrientation=sideOrientation||BABYLON.Mesh.DEFAULTSIDE){case BABYLON.Mesh.FRONTSIDE:break;case BABYLON.Mesh.BACKSIDE:var tmp;for(i=0;i<li;i+=3)tmp=indices[i],indices[i]=indices[i+2],indices[i+2]=tmp;for(n=0;n<ln;n++)normals[n]=-normals[n];break;case BABYLON.Mesh.DOUBLESIDE:for(var lp=positions.length,l=lp/3,p=0;p<lp;p++)positions[lp+p]=positions[p];for(i=0;i<li;i+=3)indices[i+li]=indices[i+2]+l,indices[i+1+li]=indices[i+1]+l,indices[i+2+li]=indices[i]+l;for(n=0;n<ln;n++)normals[ln+n]=-normals[n];var lu=uvs.length,u=0;for(u=0;u<lu;u++)uvs[u+lu]=uvs[u];for(frontUVs=frontUVs||new BABYLON.Vector4(0,0,1,1),backUVs=backUVs||new BABYLON.Vector4(0,0,1,1),u=0,i=0;i<lu/2;i++)uvs[u]=frontUVs.x+(frontUVs.z-frontUVs.x)*uvs[u],uvs[u+1]=frontUVs.y+(frontUVs.w-frontUVs.y)*uvs[u+1],uvs[u+lu]=backUVs.x+(backUVs.z-backUVs.x)*uvs[u+lu],uvs[u+lu+1]=backUVs.y+(backUVs.w-backUVs.y)*uvs[u+lu+1],u+=2}},VertexData.ImportVertexData=function(parsedVertexData,geometry){var vertexData=new VertexData,positions=parsedVertexData.positions;positions&&vertexData.set(positions,BABYLON.VertexBuffer.PositionKind);var normals=parsedVertexData.normals;normals&&vertexData.set(normals,BABYLON.VertexBuffer.NormalKind);var tangents=parsedVertexData.tangents;tangents&&vertexData.set(tangents,BABYLON.VertexBuffer.TangentKind);var uvs=parsedVertexData.uvs;uvs&&vertexData.set(uvs,BABYLON.VertexBuffer.UVKind);var uv2s=parsedVertexData.uv2s;uv2s&&vertexData.set(uv2s,BABYLON.VertexBuffer.UV2Kind);var uv3s=parsedVertexData.uv3s;uv3s&&vertexData.set(uv3s,BABYLON.VertexBuffer.UV3Kind);var uv4s=parsedVertexData.uv4s;uv4s&&vertexData.set(uv4s,BABYLON.VertexBuffer.UV4Kind);var uv5s=parsedVertexData.uv5s;uv5s&&vertexData.set(uv5s,BABYLON.VertexBuffer.UV5Kind);var uv6s=parsedVertexData.uv6s;uv6s&&vertexData.set(uv6s,BABYLON.VertexBuffer.UV6Kind);var colors=parsedVertexData.colors;colors&&vertexData.set(BABYLON.Color4.CheckColors4(colors,positions.length/3),BABYLON.VertexBuffer.ColorKind);var matricesIndices=parsedVertexData.matricesIndices;matricesIndices&&vertexData.set(matricesIndices,BABYLON.VertexBuffer.MatricesIndicesKind);var matricesWeights=parsedVertexData.matricesWeights;matricesWeights&&vertexData.set(matricesWeights,BABYLON.VertexBuffer.MatricesWeightsKind);var indices=parsedVertexData.indices;indices&&(vertexData.indices=indices),geometry.setAllVerticesData(vertexData,parsedVertexData.updatable)},VertexData}();BABYLON.VertexData=VertexData}(BABYLON||(BABYLON={}));!function(BABYLON){var Geometry=function(){function Geometry(id,scene,vertexData,updatable,mesh){void 0===updatable&&(updatable=!1),void 0===mesh&&(mesh=null),this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=id,this._engine=scene.getEngine(),this._meshes=[],this._scene=scene,this._vertexBuffers={},this._indices=[],this._updatable=updatable,vertexData?this.setAllVerticesData(vertexData,updatable):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),mesh&&("LinesMesh"===mesh.getClassName()&&(this.boundingBias=new BABYLON.Vector2(0,mesh.intersectionThreshold),this.updateExtend()),this.applyToMesh(mesh),mesh.computeWorldMatrix(!0))}return Object.defineProperty(Geometry.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(value){this._boundingBias&&this._boundingBias.equals(value)||(this._boundingBias=value.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),Geometry.CreateGeometryForMesh=function(mesh){var geometry=new Geometry(Geometry.RandomId(),mesh.getScene());return geometry.applyToMesh(mesh),geometry},Object.defineProperty(Geometry.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),Geometry.prototype.getScene=function(){return this._scene},Geometry.prototype.getEngine=function(){return this._engine},Geometry.prototype.isReady=function(){return this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NONE},Object.defineProperty(Geometry.prototype,"doNotSerialize",{get:function(){for(var index=0;index<this._meshes.length;index++)if(!this._meshes[index].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),Geometry.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var key in this._vertexBuffers)this._vertexBuffers[key]._rebuild()},Geometry.prototype.setAllVerticesData=function(vertexData,updatable){vertexData.applyToGeometry(this,updatable),this.notifyUpdate()},Geometry.prototype.setVerticesData=function(kind,data,updatable,stride){void 0===updatable&&(updatable=!1);var buffer=new BABYLON.VertexBuffer(this._engine,data,kind,updatable,0===this._meshes.length,stride);this.setVerticesBuffer(buffer)},Geometry.prototype.removeVerticesData=function(kind){this._vertexBuffers[kind]&&(this._vertexBuffers[kind].dispose(),delete this._vertexBuffers[kind])},Geometry.prototype.setVerticesBuffer=function(buffer){var kind=buffer.getKind();if(this._vertexBuffers[kind]&&this._vertexBuffers[kind].dispose(),this._vertexBuffers[kind]=buffer,kind===BABYLON.VertexBuffer.PositionKind){var data=buffer.getData(),stride=buffer.getStrideSize();this._totalVertices=data.length/stride,this.updateExtend(data,stride),this._resetPointsArrayCache();for(var meshes=this._meshes,numOfMeshes=meshes.length,index=0;index<numOfMeshes;index++){var mesh=meshes[index];mesh._boundingInfo=new BABYLON.BoundingInfo(this._extend.minimum,this._extend.maximum),mesh._createGlobalSubMesh(!1),mesh.computeWorldMatrix(!0)}}this.notifyUpdate(kind),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},Geometry.prototype.updateVerticesDataDirectly=function(kind,data,offset){var vertexBuffer=this.getVertexBuffer(kind);vertexBuffer&&(vertexBuffer.updateDirectly(data,offset),this.notifyUpdate(kind))},Geometry.prototype.updateVerticesData=function(kind,data,updateExtends){void 0===updateExtends&&(updateExtends=!1);var vertexBuffer=this.getVertexBuffer(kind);if(vertexBuffer){if(vertexBuffer.update(data),kind===BABYLON.VertexBuffer.PositionKind){var stride=vertexBuffer.getStrideSize();this._totalVertices=data.length/stride,this.updateBoundingInfo(updateExtends,data)}this.notifyUpdate(kind)}},Geometry.prototype.updateBoundingInfo=function(updateExtends,data){updateExtends&&this.updateExtend(data);var meshes=this._meshes,numOfMeshes=meshes.length;this._resetPointsArrayCache();for(var index=0;index<numOfMeshes;index++){var mesh=meshes[index];if(updateExtends){mesh._boundingInfo=new BABYLON.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var subIndex=0;subIndex<mesh.subMeshes.length;subIndex++)mesh.subMeshes[subIndex].refreshBoundingInfo()}}},Geometry.prototype._bind=function(effect,indexToBind){if(effect){void 0===indexToBind&&(indexToBind=this._indexBuffer);var vbs=this.getVertexBuffers();vbs&&(indexToBind==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[effect.key]||(this._vertexArrayObjects[effect.key]=this._engine.recordVertexArrayObject(vbs,indexToBind,effect)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[effect.key],indexToBind)):this._engine.bindBuffers(vbs,indexToBind,effect))}},Geometry.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},Geometry.prototype.getVerticesData=function(kind,copyWhenShared,forceCopy){var vertexBuffer=this.getVertexBuffer(kind);if(!vertexBuffer)return null;var orig=vertexBuffer.getData();if(forceCopy||copyWhenShared&&1!==this._meshes.length){for(var len=orig.length,copy=[],i=0;i<len;i++)copy.push(orig[i]);return copy}return orig},Geometry.prototype.isVertexBufferUpdatable=function(kind){var vb=this._vertexBuffers[kind];return!!vb&&vb.isUpdatable()},Geometry.prototype.getVertexBuffer=function(kind){return this.isReady()?this._vertexBuffers[kind]:null},Geometry.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},Geometry.prototype.isVerticesDataPresent=function(kind){return this._vertexBuffers?void 0!==this._vertexBuffers[kind]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(kind)},Geometry.prototype.getVerticesDataKinds=function(){var kind,result=[];if(!this._vertexBuffers&&this._delayInfo)for(kind in this._delayInfo)result.push(kind);else for(kind in this._vertexBuffers)result.push(kind);return result},Geometry.prototype.updateIndices=function(indices,offset){this._indexBuffer&&(this._indexBufferIsUpdatable?this._engine.updateDynamicIndexBuffer(this._indexBuffer,indices,offset):this.setIndices(indices,null,!0))},Geometry.prototype.setIndices=function(indices,totalVertices,updatable){void 0===totalVertices&&(totalVertices=null),void 0===updatable&&(updatable=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=indices,this._indexBufferIsUpdatable=updatable,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,updatable)),void 0!=totalVertices&&(this._totalVertices=totalVertices);for(var meshes=this._meshes,numOfMeshes=meshes.length,index=0;index<numOfMeshes;index++)meshes[index]._createGlobalSubMesh(!0);this.notifyUpdate()},Geometry.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},Geometry.prototype.getIndices=function(copyWhenShared){if(!this.isReady())return null;var orig=this._indices;if(copyWhenShared&&1!==this._meshes.length){for(var len=orig.length,copy=[],i=0;i<len;i++)copy.push(orig[i]);return copy}return orig},Geometry.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},Geometry.prototype._releaseVertexArrayObject=function(effect){void 0===effect&&(effect=null),effect&&this._vertexArrayObjects&&this._vertexArrayObjects[effect.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[effect.key]),delete this._vertexArrayObjects[effect.key])},Geometry.prototype.releaseForMesh=function(mesh,shouldDispose){var meshes=this._meshes,index=meshes.indexOf(mesh);-1!==index&&(meshes.splice(index,1),mesh._geometry=null,0===meshes.length&&shouldDispose&&this.dispose())},Geometry.prototype.applyToMesh=function(mesh){if(mesh._geometry!==this){var previousGeometry=mesh._geometry;previousGeometry&&previousGeometry.releaseForMesh(mesh);var meshes=this._meshes;mesh._geometry=this,this._scene.pushGeometry(this),meshes.push(mesh),this.isReady()?this._applyToMesh(mesh):mesh._boundingInfo=this._boundingInfo}},Geometry.prototype.updateExtend=function(data,stride){void 0===data&&(data=null),data||(data=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind].getData()),this._extend=BABYLON.Tools.ExtractMinAndMax(data,0,this._totalVertices,this.boundingBias,stride)},Geometry.prototype._applyToMesh=function(mesh){var numOfMeshes=this._meshes.length;for(var kind in this._vertexBuffers){1===numOfMeshes&&this._vertexBuffers[kind].create();var buffer=this._vertexBuffers[kind].getBuffer();buffer&&(buffer.references=numOfMeshes),kind===BABYLON.VertexBuffer.PositionKind&&(this._extend||this.updateExtend(this._vertexBuffers[kind].getData()),mesh._boundingInfo=new BABYLON.BoundingInfo(this._extend.minimum,this._extend.maximum),mesh._createGlobalSubMesh(!1),mesh._updateBoundingInfo())}1===numOfMeshes&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=numOfMeshes)},Geometry.prototype.notifyUpdate=function(kind){this.onGeometryUpdated&&this.onGeometryUpdated(this,kind);for(var _i=0,_a=this._meshes;_i<_a.length;_i++)_a[_i]._markSubMeshesAsAttributesDirty()},Geometry.prototype.load=function(scene,onLoaded){this.delayLoadState!==BABYLON.Engine.DELAYLOADSTATE_LOADING&&(this.isReady()?onLoaded&&onLoaded():(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(scene,onLoaded)))},Geometry.prototype._queueLoad=function(scene,onLoaded){var _this=this;this.delayLoadingFile&&(scene._addPendingData(this),BABYLON.Tools.LoadFile(this.delayLoadingFile,function(data){if(_this._delayLoadingFunction){_this._delayLoadingFunction(JSON.parse(data),_this),_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,_this._delayInfo=[],scene._removePendingData(_this);for(var meshes=_this._meshes,numOfMeshes=meshes.length,index=0;index<numOfMeshes;index++)_this._applyToMesh(meshes[index]);onLoaded&&onLoaded()}},function(){},scene.database))},Geometry.prototype.toLeftHanded=function(){var tIndices=this.getIndices(!1);if(null!=tIndices&&tIndices.length>0){for(i=0;i<tIndices.length;i+=3){var tTemp=tIndices[i+0];tIndices[i+0]=tIndices[i+2],tIndices[i+2]=tTemp}this.setIndices(tIndices)}var tPositions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind,!1);if(null!=tPositions&&tPositions.length>0){for(i=0;i<tPositions.length;i+=3)tPositions[i+2]=-tPositions[i+2];this.setVerticesData(BABYLON.VertexBuffer.PositionKind,tPositions,!1)}var tNormals=this.getVerticesData(BABYLON.VertexBuffer.NormalKind,!1);if(null!=tNormals&&tNormals.length>0){for(var i=0;i<tNormals.length;i+=3)tNormals[i+2]=-tNormals[i+2];this.setVerticesData(BABYLON.VertexBuffer.NormalKind,tNormals,!1)}},Geometry.prototype._resetPointsArrayCache=function(){this._positions=null},Geometry.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var data=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!data)return!1;for(var index=0;index<data.length;index+=3)this._positions.push(BABYLON.Vector3.FromArray(data,index));return!0},Geometry.prototype.isDisposed=function(){return this._isDisposed},Geometry.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var kind in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[kind]);this._vertexArrayObjects={}}},Geometry.prototype.dispose=function(){var index,meshes=this._meshes,numOfMeshes=meshes.length;for(index=0;index<numOfMeshes;index++)this.releaseForMesh(meshes[index]);this._meshes=[],this._disposeVertexArrayObjects();for(var kind in this._vertexBuffers)this._vertexBuffers[kind].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},Geometry.prototype.copy=function(id){var vertexData=new BABYLON.VertexData;vertexData.indices=[];var indices=this.getIndices();if(indices)for(var index=0;index<indices.length;index++)vertexData.indices.push(indices[index]);var kind,updatable=!1,stopChecking=!1;for(kind in this._vertexBuffers){var data=this.getVerticesData(kind);if(data instanceof Float32Array?vertexData.set(new Float32Array(data),kind):vertexData.set(data.slice(0),kind),!stopChecking){var vb=this.getVertexBuffer(kind);vb&&(stopChecking=!(updatable=vb.isUpdatable()))}}var geometry=new Geometry(id,this._scene,vertexData,updatable);geometry.delayLoadState=this.delayLoadState,geometry.delayLoadingFile=this.delayLoadingFile,geometry._delayLoadingFunction=this._delayLoadingFunction;for(kind in this._delayInfo)geometry._delayInfo=geometry._delayInfo||[],geometry._delayInfo.push(kind);return geometry._boundingInfo=new BABYLON.BoundingInfo(this._extend.minimum,this._extend.maximum),geometry},Geometry.prototype.serialize=function(){var serializationObject={};return serializationObject.id=this.id,serializationObject.updatable=this._updatable,BABYLON.Tags&&BABYLON.Tags.HasTags(this)&&(serializationObject.tags=BABYLON.Tags.GetTags(this)),serializationObject},Geometry.prototype.toNumberArray=function(origin){return Array.isArray(origin)?origin:Array.prototype.slice.call(origin)},Geometry.prototype.serializeVerticeData=function(){var serializationObject=this.serialize();return this.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind)&&(serializationObject.positions=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.PositionKind)&&(serializationObject.positions._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)&&(serializationObject.normals=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.NormalKind)&&(serializationObject.normals._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(serializationObject.uvs=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UVKind)&&(serializationObject.uvs._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(serializationObject.uv2s=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UV2Kind)&&(serializationObject.uv2s._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UV3Kind)&&(serializationObject.uv3s=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UV3Kind)&&(serializationObject.uv3s._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UV4Kind)&&(serializationObject.uv4s=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UV4Kind)&&(serializationObject.uv4s._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UV5Kind)&&(serializationObject.uv5s=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UV5Kind)&&(serializationObject.uv5s._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.UV6Kind)&&(serializationObject.uv6s=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.UV6Kind)&&(serializationObject.uv6s._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.ColorKind)&&(serializationObject.colors=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.ColorKind)&&(serializationObject.colors._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesIndicesKind)&&(serializationObject.matricesIndices=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind)),serializationObject.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(BABYLON.VertexBuffer.MatricesIndicesKind)&&(serializationObject.matricesIndices._updatable=!0)),this.isVerticesDataPresent(BABYLON.VertexBuffer.MatricesWeightsKind)&&(serializationObject.matricesWeights=this.toNumberArray(this.getVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(BABYLON.VertexBuffer.MatricesWeightsKind)&&(serializationObject.matricesWeights._updatable=!0)),serializationObject.indices=this.toNumberArray(this.getIndices()),serializationObject},Geometry.ExtractFromMesh=function(mesh,id){var geometry=mesh._geometry;return geometry?geometry.copy(id):null},Geometry.RandomId=function(){return BABYLON.Tools.RandomId()},Geometry.ImportGeometry=function(parsedGeometry,mesh){var scene=mesh.getScene(),geometryId=parsedGeometry.geometryId;if(geometryId){var geometry=scene.getGeometryByID(geometryId);geometry&&geometry.applyToMesh(mesh)}else if(parsedGeometry instanceof ArrayBuffer){var binaryInfo=mesh._binaryInfo;if(binaryInfo.positionsAttrDesc&&binaryInfo.positionsAttrDesc.count>0){var positionsData=new Float32Array(parsedGeometry,binaryInfo.positionsAttrDesc.offset,binaryInfo.positionsAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.PositionKind,positionsData,!1)}if(binaryInfo.normalsAttrDesc&&binaryInfo.normalsAttrDesc.count>0){var normalsData=new Float32Array(parsedGeometry,binaryInfo.normalsAttrDesc.offset,binaryInfo.normalsAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.NormalKind,normalsData,!1)}if(binaryInfo.uvsAttrDesc&&binaryInfo.uvsAttrDesc.count>0){var uvsData=new Float32Array(parsedGeometry,binaryInfo.uvsAttrDesc.offset,binaryInfo.uvsAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UVKind,uvsData,!1)}if(binaryInfo.uvs2AttrDesc&&binaryInfo.uvs2AttrDesc.count>0){var uvs2Data=new Float32Array(parsedGeometry,binaryInfo.uvs2AttrDesc.offset,binaryInfo.uvs2AttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UV2Kind,uvs2Data,!1)}if(binaryInfo.uvs3AttrDesc&&binaryInfo.uvs3AttrDesc.count>0){var uvs3Data=new Float32Array(parsedGeometry,binaryInfo.uvs3AttrDesc.offset,binaryInfo.uvs3AttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UV3Kind,uvs3Data,!1)}if(binaryInfo.uvs4AttrDesc&&binaryInfo.uvs4AttrDesc.count>0){var uvs4Data=new Float32Array(parsedGeometry,binaryInfo.uvs4AttrDesc.offset,binaryInfo.uvs4AttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UV4Kind,uvs4Data,!1)}if(binaryInfo.uvs5AttrDesc&&binaryInfo.uvs5AttrDesc.count>0){var uvs5Data=new Float32Array(parsedGeometry,binaryInfo.uvs5AttrDesc.offset,binaryInfo.uvs5AttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UV5Kind,uvs5Data,!1)}if(binaryInfo.uvs6AttrDesc&&binaryInfo.uvs6AttrDesc.count>0){var uvs6Data=new Float32Array(parsedGeometry,binaryInfo.uvs6AttrDesc.offset,binaryInfo.uvs6AttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.UV6Kind,uvs6Data,!1)}if(binaryInfo.colorsAttrDesc&&binaryInfo.colorsAttrDesc.count>0){var colorsData=new Float32Array(parsedGeometry,binaryInfo.colorsAttrDesc.offset,binaryInfo.colorsAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.ColorKind,colorsData,!1,binaryInfo.colorsAttrDesc.stride)}if(binaryInfo.matricesIndicesAttrDesc&&binaryInfo.matricesIndicesAttrDesc.count>0){var matricesIndicesData=new Int32Array(parsedGeometry,binaryInfo.matricesIndicesAttrDesc.offset,binaryInfo.matricesIndicesAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,matricesIndicesData,!1)}if(binaryInfo.matricesWeightsAttrDesc&&binaryInfo.matricesWeightsAttrDesc.count>0){var matricesWeightsData=new Float32Array(parsedGeometry,binaryInfo.matricesWeightsAttrDesc.offset,binaryInfo.matricesWeightsAttrDesc.count);mesh.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind,matricesWeightsData,!1)}if(binaryInfo.indicesAttrDesc&&binaryInfo.indicesAttrDesc.count>0){var indicesData=new Int32Array(parsedGeometry,binaryInfo.indicesAttrDesc.offset,binaryInfo.indicesAttrDesc.count);mesh.setIndices(indicesData,null)}if(binaryInfo.subMeshesAttrDesc&&binaryInfo.subMeshesAttrDesc.count>0){var subMeshesData=new Int32Array(parsedGeometry,binaryInfo.subMeshesAttrDesc.offset,5*binaryInfo.subMeshesAttrDesc.count);mesh.subMeshes=[];for(i=0;i<binaryInfo.subMeshesAttrDesc.count;i++){var materialIndex=subMeshesData[5*i+0],verticesStart=subMeshesData[5*i+1],verticesCount=subMeshesData[5*i+2],indexStart=subMeshesData[5*i+3],indexCount=subMeshesData[5*i+4];BABYLON.SubMesh.AddToMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh)}}}else if(parsedGeometry.positions&&parsedGeometry.normals&&parsedGeometry.indices){if(mesh.setVerticesData(BABYLON.VertexBuffer.PositionKind,parsedGeometry.positions,parsedGeometry.positions._updatable),mesh.setVerticesData(BABYLON.VertexBuffer.NormalKind,parsedGeometry.normals,parsedGeometry.normals._updatable),parsedGeometry.uvs&&mesh.setVerticesData(BABYLON.VertexBuffer.UVKind,parsedGeometry.uvs,parsedGeometry.uvs._updatable),parsedGeometry.uvs2&&mesh.setVerticesData(BABYLON.VertexBuffer.UV2Kind,parsedGeometry.uvs2,parsedGeometry.uvs2._updatable),parsedGeometry.uvs3&&mesh.setVerticesData(BABYLON.VertexBuffer.UV3Kind,parsedGeometry.uvs3,parsedGeometry.uvs3._updatable),parsedGeometry.uvs4&&mesh.setVerticesData(BABYLON.VertexBuffer.UV4Kind,parsedGeometry.uvs4,parsedGeometry.uvs4._updatable),parsedGeometry.uvs5&&mesh.setVerticesData(BABYLON.VertexBuffer.UV5Kind,parsedGeometry.uvs5,parsedGeometry.uvs5._updatable),parsedGeometry.uvs6&&mesh.setVerticesData(BABYLON.VertexBuffer.UV6Kind,parsedGeometry.uvs6,parsedGeometry.uvs6._updatable),parsedGeometry.colors&&mesh.setVerticesData(BABYLON.VertexBuffer.ColorKind,BABYLON.Color4.CheckColors4(parsedGeometry.colors,parsedGeometry.positions.length/3),parsedGeometry.colors._updatable),parsedGeometry.matricesIndices)if(parsedGeometry.matricesIndices._isExpanded)delete parsedGeometry.matricesIndices._isExpanded,mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,parsedGeometry.matricesIndices,parsedGeometry.matricesIndices._updatable);else{for(var floatIndices=[],i=0;i<parsedGeometry.matricesIndices.length;i++){matricesIndex=parsedGeometry.matricesIndices[i];floatIndices.push(255&matricesIndex),floatIndices.push((65280&matricesIndex)>>8),floatIndices.push((16711680&matricesIndex)>>16),floatIndices.push(matricesIndex>>24)}mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,floatIndices,parsedGeometry.matricesIndices._updatable)}if(parsedGeometry.matricesIndicesExtra)if(parsedGeometry.matricesIndicesExtra._isExpanded)delete parsedGeometry.matricesIndices._isExpanded,mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,parsedGeometry.matricesIndicesExtra,parsedGeometry.matricesIndicesExtra._updatable);else{for(var floatIndices=[],i=0;i<parsedGeometry.matricesIndicesExtra.length;i++){var matricesIndex=parsedGeometry.matricesIndicesExtra[i];floatIndices.push(255&matricesIndex),floatIndices.push((65280&matricesIndex)>>8),floatIndices.push((16711680&matricesIndex)>>16),floatIndices.push(matricesIndex>>24)}mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,floatIndices,parsedGeometry.matricesIndicesExtra._updatable)}parsedGeometry.matricesWeights&&(Geometry._CleanMatricesWeights(parsedGeometry,mesh),mesh.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind,parsedGeometry.matricesWeights,parsedGeometry.matricesWeights._updatable)),parsedGeometry.matricesWeightsExtra&&mesh.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsExtraKind,parsedGeometry.matricesWeightsExtra,parsedGeometry.matricesWeights._updatable),mesh.setIndices(parsedGeometry.indices,null)}if(parsedGeometry.subMeshes){mesh.subMeshes=[];for(var subIndex=0;subIndex<parsedGeometry.subMeshes.length;subIndex++){var parsedSubMesh=parsedGeometry.subMeshes[subIndex];BABYLON.SubMesh.AddToMesh(parsedSubMesh.materialIndex,parsedSubMesh.verticesStart,parsedSubMesh.verticesCount,parsedSubMesh.indexStart,parsedSubMesh.indexCount,mesh)}}mesh._shouldGenerateFlatShading&&(mesh.convertToFlatShadedMesh(),delete mesh._shouldGenerateFlatShading),mesh.computeWorldMatrix(!0),scene._selectionOctree&&scene._selectionOctree.addMesh(mesh)},Geometry._CleanMatricesWeights=function(parsedGeometry,mesh){if(BABYLON.SceneLoader.CleanBoneMatrixWeights){var noInfluenceBoneIndex=0;if(parsedGeometry.skeletonId>-1){var skeleton=mesh.getScene().getLastSkeletonByID(parsedGeometry.skeletonId);if(skeleton){noInfluenceBoneIndex=skeleton.bones.length;for(var matricesIndices=mesh.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind),matricesIndicesExtra=mesh.getVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind),matricesWeights=parsedGeometry.matricesWeights,matricesWeightsExtra=parsedGeometry.matricesWeightsExtra,influencers=parsedGeometry.numBoneInfluencer,size=matricesWeights.length,i=0;i<size;i+=4){for(var weight=0,firstZeroWeight=-1,j=0;j<4;j++)weight+=w=matricesWeights[i+j],w<.001&&firstZeroWeight<0&&(firstZeroWeight=j);if(matricesWeightsExtra)for(j=0;j<4;j++){var w=matricesWeightsExtra[i+j];weight+=w,w<.001&&firstZeroWeight<0&&(firstZeroWeight=j+4)}if((firstZeroWeight<0||firstZeroWeight>influencers-1)&&(firstZeroWeight=influencers-1),weight>.001){for(var mweight=1/weight,j=0;j<4;j++)matricesWeights[i+j]*=mweight;if(matricesWeightsExtra)for(j=0;j<4;j++)matricesWeightsExtra[i+j]*=mweight}else firstZeroWeight>=4?(matricesWeightsExtra[i+firstZeroWeight-4]=1-weight,matricesIndicesExtra[i+firstZeroWeight-4]=noInfluenceBoneIndex):(matricesWeights[i+firstZeroWeight]=1-weight,matricesIndices[i+firstZeroWeight]=noInfluenceBoneIndex)}mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind,matricesIndices),parsedGeometry.matricesWeightsExtra&&mesh.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesExtraKind,matricesIndicesExtra)}}}},Geometry.Parse=function(parsedVertexData,scene,rootUrl){if(scene.getGeometryByID(parsedVertexData.id))return null;var geometry=new Geometry(parsedVertexData.id,scene,void 0,parsedVertexData.updatable);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(geometry,parsedVertexData.tags),parsedVertexData.delayLoadingFile?(geometry.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED,geometry.delayLoadingFile=rootUrl+parsedVertexData.delayLoadingFile,geometry._boundingInfo=new BABYLON.BoundingInfo(BABYLON.Vector3.FromArray(parsedVertexData.boundingBoxMinimum),BABYLON.Vector3.FromArray(parsedVertexData.boundingBoxMaximum)),geometry._delayInfo=[],parsedVertexData.hasUVs&&geometry._delayInfo.push(BABYLON.VertexBuffer.UVKind),parsedVertexData.hasUVs2&&geometry._delayInfo.push(BABYLON.VertexBuffer.UV2Kind),parsedVertexData.hasUVs3&&geometry._delayInfo.push(BABYLON.VertexBuffer.UV3Kind),parsedVertexData.hasUVs4&&geometry._delayInfo.push(BABYLON.VertexBuffer.UV4Kind),parsedVertexData.hasUVs5&&geometry._delayInfo.push(BABYLON.VertexBuffer.UV5Kind),parsedVertexData.hasUVs6&&geometry._delayInfo.push(BABYLON.VertexBuffer.UV6Kind),parsedVertexData.hasColors&&geometry._delayInfo.push(BABYLON.VertexBuffer.ColorKind),parsedVertexData.hasMatricesIndices&&geometry._delayInfo.push(BABYLON.VertexBuffer.MatricesIndicesKind),parsedVertexData.hasMatricesWeights&&geometry._delayInfo.push(BABYLON.VertexBuffer.MatricesWeightsKind),geometry._delayLoadingFunction=BABYLON.VertexData.ImportVertexData):BABYLON.VertexData.ImportVertexData(parsedVertexData,geometry),scene.pushGeometry(geometry,!0),geometry},Geometry}();BABYLON.Geometry=Geometry,function(Geometry){!function(Primitives){var _Primitive=function(_super){function _Primitive(id,scene,_canBeRegenerated,mesh){void 0===_canBeRegenerated&&(_canBeRegenerated=!1),void 0===mesh&&(mesh=null);var _this=_super.call(this,id,scene,void 0,!1,mesh)||this;return _this._canBeRegenerated=_canBeRegenerated,_this._beingRegenerated=!0,_this.regenerate(),_this._beingRegenerated=!1,_this}return __extends(_Primitive,_super),_Primitive.prototype.canBeRegenerated=function(){return this._canBeRegenerated},_Primitive.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},_Primitive.prototype.asNewGeometry=function(id){return _super.prototype.copy.call(this,id)},_Primitive.prototype.setAllVerticesData=function(vertexData,updatable){this._beingRegenerated&&_super.prototype.setAllVerticesData.call(this,vertexData,!1)},_Primitive.prototype.setVerticesData=function(kind,data,updatable){this._beingRegenerated&&_super.prototype.setVerticesData.call(this,kind,data,!1)},_Primitive.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},_Primitive.prototype.copy=function(id){throw new Error("Must be overriden in sub-classes.")},_Primitive.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.canBeRegenerated=this.canBeRegenerated(),serializationObject},_Primitive}(Geometry);Primitives._Primitive=_Primitive;var Ribbon=function(_super){function Ribbon(id,scene,pathArray,closeArray,closePath,offset,canBeRegenerated,mesh,side){void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.pathArray=pathArray,_this.closeArray=closeArray,_this.closePath=closePath,_this.offset=offset,_this.side=side,_this}return __extends(Ribbon,_super),Ribbon.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},Ribbon.prototype.copy=function(id){return new Ribbon(id,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},Ribbon}(_Primitive);Primitives.Ribbon=Ribbon;var Box=function(_super){function Box(id,scene,size,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.size=size,_this.side=side,_this}return __extends(Box,_super),Box.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},Box.prototype.copy=function(id){return new Box(id,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},Box.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.size=this.size,serializationObject},Box.Parse=function(parsedBox,scene){if(scene.getGeometryByID(parsedBox.id))return null;var box=new Geometry.Primitives.Box(parsedBox.id,scene,parsedBox.size,parsedBox.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(box,parsedBox.tags),scene.pushGeometry(box,!0),box},Box}(_Primitive);Primitives.Box=Box;var Sphere=function(_super){function Sphere(id,scene,segments,diameter,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.segments=segments,_this.diameter=diameter,_this.side=side,_this}return __extends(Sphere,_super),Sphere.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},Sphere.prototype.copy=function(id){return new Sphere(id,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},Sphere.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.segments=this.segments,serializationObject.diameter=this.diameter,serializationObject},Sphere.Parse=function(parsedSphere,scene){if(scene.getGeometryByID(parsedSphere.id))return null;var sphere=new Geometry.Primitives.Sphere(parsedSphere.id,scene,parsedSphere.segments,parsedSphere.diameter,parsedSphere.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(sphere,parsedSphere.tags),scene.pushGeometry(sphere,!0),sphere},Sphere}(_Primitive);Primitives.Sphere=Sphere;var Disc=function(_super){function Disc(id,scene,radius,tessellation,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.radius=radius,_this.tessellation=tessellation,_this.side=side,_this}return __extends(Disc,_super),Disc.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},Disc.prototype.copy=function(id){return new Disc(id,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},Disc}(_Primitive);Primitives.Disc=Disc;var Cylinder=function(_super){function Cylinder(id,scene,height,diameterTop,diameterBottom,tessellation,subdivisions,canBeRegenerated,mesh,side){void 0===subdivisions&&(subdivisions=1),void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.height=height,_this.diameterTop=diameterTop,_this.diameterBottom=diameterBottom,_this.tessellation=tessellation,_this.subdivisions=subdivisions,_this.side=side,_this}return __extends(Cylinder,_super),Cylinder.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},Cylinder.prototype.copy=function(id){return new Cylinder(id,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},Cylinder.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.height=this.height,serializationObject.diameterTop=this.diameterTop,serializationObject.diameterBottom=this.diameterBottom,serializationObject.tessellation=this.tessellation,serializationObject},Cylinder.Parse=function(parsedCylinder,scene){if(scene.getGeometryByID(parsedCylinder.id))return null;var cylinder=new Geometry.Primitives.Cylinder(parsedCylinder.id,scene,parsedCylinder.height,parsedCylinder.diameterTop,parsedCylinder.diameterBottom,parsedCylinder.tessellation,parsedCylinder.subdivisions,parsedCylinder.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(cylinder,parsedCylinder.tags),scene.pushGeometry(cylinder,!0),cylinder},Cylinder}(_Primitive);Primitives.Cylinder=Cylinder;var Torus=function(_super){function Torus(id,scene,diameter,thickness,tessellation,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.diameter=diameter,_this.thickness=thickness,_this.tessellation=tessellation,_this.side=side,_this}return __extends(Torus,_super),Torus.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},Torus.prototype.copy=function(id){return new Torus(id,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},Torus.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.diameter=this.diameter,serializationObject.thickness=this.thickness,serializationObject.tessellation=this.tessellation,serializationObject},Torus.Parse=function(parsedTorus,scene){if(scene.getGeometryByID(parsedTorus.id))return null;var torus=new Geometry.Primitives.Torus(parsedTorus.id,scene,parsedTorus.diameter,parsedTorus.thickness,parsedTorus.tessellation,parsedTorus.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(torus,parsedTorus.tags),scene.pushGeometry(torus,!0),torus},Torus}(_Primitive);Primitives.Torus=Torus;var Ground=function(_super){function Ground(id,scene,width,height,subdivisions,canBeRegenerated,mesh){void 0===mesh&&(mesh=null);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.width=width,_this.height=height,_this.subdivisions=subdivisions,_this}return __extends(Ground,_super),Ground.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},Ground.prototype.copy=function(id){return new Ground(id,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},Ground.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.width=this.width,serializationObject.height=this.height,serializationObject.subdivisions=this.subdivisions,serializationObject},Ground.Parse=function(parsedGround,scene){if(scene.getGeometryByID(parsedGround.id))return null;var ground=new Geometry.Primitives.Ground(parsedGround.id,scene,parsedGround.width,parsedGround.height,parsedGround.subdivisions,parsedGround.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(ground,parsedGround.tags),scene.pushGeometry(ground,!0),ground},Ground}(_Primitive);Primitives.Ground=Ground;var TiledGround=function(_super){function TiledGround(id,scene,xmin,zmin,xmax,zmax,subdivisions,precision,canBeRegenerated,mesh){void 0===mesh&&(mesh=null);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.xmin=xmin,_this.zmin=zmin,_this.xmax=xmax,_this.zmax=zmax,_this.subdivisions=subdivisions,_this.precision=precision,_this}return __extends(TiledGround,_super),TiledGround.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},TiledGround.prototype.copy=function(id){return new TiledGround(id,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},TiledGround}(_Primitive);Primitives.TiledGround=TiledGround;var Plane=function(_super){function Plane(id,scene,size,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.size=size,_this.side=side,_this}return __extends(Plane,_super),Plane.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},Plane.prototype.copy=function(id){return new Plane(id,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},Plane.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.size=this.size,serializationObject},Plane.Parse=function(parsedPlane,scene){if(scene.getGeometryByID(parsedPlane.id))return null;var plane=new Geometry.Primitives.Plane(parsedPlane.id,scene,parsedPlane.size,parsedPlane.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(plane,parsedPlane.tags),scene.pushGeometry(plane,!0),plane},Plane}(_Primitive);Primitives.Plane=Plane;var TorusKnot=function(_super){function TorusKnot(id,scene,radius,tube,radialSegments,tubularSegments,p,q,canBeRegenerated,mesh,side){void 0===mesh&&(mesh=null),void 0===side&&(side=BABYLON.Mesh.DEFAULTSIDE);var _this=_super.call(this,id,scene,canBeRegenerated,mesh)||this;return _this.radius=radius,_this.tube=tube,_this.radialSegments=radialSegments,_this.tubularSegments=tubularSegments,_this.p=p,_this.q=q,_this.side=side,_this}return __extends(TorusKnot,_super),TorusKnot.prototype._regenerateVertexData=function(){return BABYLON.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},TorusKnot.prototype.copy=function(id){return new TorusKnot(id,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},TorusKnot.prototype.serialize=function(){var serializationObject=_super.prototype.serialize.call(this);return serializationObject.radius=this.radius,serializationObject.tube=this.tube,serializationObject.radialSegments=this.radialSegments,serializationObject.tubularSegments=this.tubularSegments,serializationObject.p=this.p,serializationObject.q=this.q,serializationObject},TorusKnot.Parse=function(parsedTorusKnot,scene){if(scene.getGeometryByID(parsedTorusKnot.id))return null;var torusKnot=new Geometry.Primitives.TorusKnot(parsedTorusKnot.id,scene,parsedTorusKnot.radius,parsedTorusKnot.tube,parsedTorusKnot.radialSegments,parsedTorusKnot.tubularSegments,parsedTorusKnot.p,parsedTorusKnot.q,parsedTorusKnot.canBeRegenerated,null);return BABYLON.Tags&&BABYLON.Tags.AddTagsTo(torusKnot,parsedTorusKnot.tags),scene.pushGeometry(torusKnot,!0),torusKnot},TorusKnot}(_Primitive);Primitives.TorusKnot=TorusKnot}(Geometry.Primitives||(Geometry.Primitives={}))}(Geometry=BABYLON.Geometry||(BABYLON.Geometry={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcessManager=function(){function PostProcessManager(scene){this._vertexBuffers={},this._scene=scene}return PostProcessManager.prototype._prepareBuffers=function(){if(!this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]){var vertices=[];vertices.push(1,1),vertices.push(-1,1),vertices.push(-1,-1),vertices.push(1,-1),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=new BABYLON.VertexBuffer(this._scene.getEngine(),vertices,BABYLON.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},PostProcessManager.prototype._buildIndexBuffer=function(){var indices=[];indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(indices)},PostProcessManager.prototype._rebuild=function(){var vb=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vb&&(vb._rebuild(),this._buildIndexBuffer())},PostProcessManager.prototype._prepareFrame=function(sourceTexture,postProcesses){void 0===sourceTexture&&(sourceTexture=null),void 0===postProcesses&&(postProcesses=null);var camera=this._scene.activeCamera;return!!camera&&(!(!(postProcesses=postProcesses||camera._postProcesses)||0===postProcesses.length||!this._scene.postProcessesEnabled)&&(postProcesses[0].activate(camera,sourceTexture,null!==postProcesses&&void 0!==postProcesses),!0))},PostProcessManager.prototype.directRender=function(postProcesses,targetTexture,forceFullscreenViewport){void 0===targetTexture&&(targetTexture=null),void 0===forceFullscreenViewport&&(forceFullscreenViewport=!1);for(var engine=this._scene.getEngine(),index=0;index<postProcesses.length;index++){index<postProcesses.length-1?postProcesses[index+1].activate(this._scene.activeCamera,targetTexture):targetTexture?engine.bindFramebuffer(targetTexture,0,void 0,void 0,forceFullscreenViewport):engine.restoreDefaultFramebuffer();var pp=postProcesses[index],effect=pp.apply();effect&&(pp.onBeforeRenderObservable.notifyObservers(effect),this._prepareBuffers(),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect),engine.draw(!0,0,6),pp.onAfterRenderObservable.notifyObservers(effect))}engine.setDepthBuffer(!0),engine.setDepthWrite(!0)},PostProcessManager.prototype._finalizeFrame=function(doNotPresent,targetTexture,faceIndex,postProcesses,forceFullscreenViewport){void 0===forceFullscreenViewport&&(forceFullscreenViewport=!1);var camera=this._scene.activeCamera;if(camera&&0!==(postProcesses=postProcesses||camera._postProcesses).length&&this._scene.postProcessesEnabled){for(var engine=this._scene.getEngine(),index=0,len=postProcesses.length;index<len&&(index<len-1?postProcesses[index+1].activate(camera,targetTexture):targetTexture?engine.bindFramebuffer(targetTexture,faceIndex,void 0,void 0,forceFullscreenViewport):engine.restoreDefaultFramebuffer(),!doNotPresent);index++){var pp=postProcesses[index],effect=pp.apply();effect&&(pp.onBeforeRenderObservable.notifyObservers(effect),this._prepareBuffers(),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect),engine.draw(!0,0,6),pp.onAfterRenderObservable.notifyObservers(effect))}engine.setDepthBuffer(!0),engine.setDepthWrite(!0),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE)}},PostProcessManager.prototype.dispose=function(){var buffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];buffer&&(buffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},PostProcessManager}();BABYLON.PostProcessManager=PostProcessManager}(BABYLON||(BABYLON={}));!function(BABYLON){var PerformanceMonitor=function(){function PerformanceMonitor(frameSampleSize){void 0===frameSampleSize&&(frameSampleSize=30),this._enabled=!0,this._rollingFrameTime=new RollingAverage(frameSampleSize)}return PerformanceMonitor.prototype.sampleFrame=function(timeMs){if(void 0===timeMs&&(timeMs=BABYLON.Tools.Now),this._enabled){if(null!=this._lastFrameTimeMs){var dt=timeMs-this._lastFrameTimeMs;this._rollingFrameTime.add(dt)}this._lastFrameTimeMs=timeMs}},Object.defineProperty(PerformanceMonitor.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(PerformanceMonitor.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(PerformanceMonitor.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(PerformanceMonitor.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(PerformanceMonitor.prototype,"instantaneousFPS",{get:function(){var history=this._rollingFrameTime.history(0);return 0===history?0:1e3/history},enumerable:!0,configurable:!0}),Object.defineProperty(PerformanceMonitor.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),PerformanceMonitor.prototype.enable=function(){this._enabled=!0},PerformanceMonitor.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(PerformanceMonitor.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),PerformanceMonitor.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},PerformanceMonitor}();BABYLON.PerformanceMonitor=PerformanceMonitor;var RollingAverage=function(){function RollingAverage(length){this._samples=new Array(length),this.reset()}return RollingAverage.prototype.add=function(v){var delta;if(this.isSaturated()){var bottomValue=this._samples[this._pos];delta=bottomValue-this.average,this.average-=delta/(this._sampleCount-1),this._m2-=delta*(bottomValue-this.average)}else this._sampleCount++;delta=v-this.average,this.average+=delta/this._sampleCount,this._m2+=delta*(v-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=v,this._pos++,this._pos%=this._samples.length},RollingAverage.prototype.history=function(i){if(i>=this._sampleCount||i>=this._samples.length)return 0;var i0=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(i0-i)]},RollingAverage.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},RollingAverage.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},RollingAverage.prototype._wrapPosition=function(i){var max=this._samples.length;return(i%max+max)%max},RollingAverage}();BABYLON.RollingAverage=RollingAverage}(BABYLON||(BABYLON={}));!function(BABYLON){var ImageProcessingConfiguration=function(){function ImageProcessingConfiguration(){this.colorCurves=new BABYLON.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new BABYLON.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=ImageProcessingConfiguration.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new BABYLON.Observable}return Object.defineProperty(ImageProcessingConfiguration.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(value){this._colorCurvesEnabled!==value&&(this._colorCurvesEnabled=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(value){this._colorGradingEnabled!==value&&(this._colorGradingEnabled=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(value){this._colorGradingWithGreenDepth!==value&&(this._colorGradingWithGreenDepth=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(value){this._colorGradingBGR!==value&&(this._colorGradingBGR=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"exposure",{get:function(){return this._exposure},set:function(value){this._exposure!==value&&(this._exposure=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(value){this._toneMappingEnabled!==value&&(this._toneMappingEnabled=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"contrast",{get:function(){return this._contrast},set:function(value){this._contrast!==value&&(this._contrast=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(value){this._vignetteBlendMode!==value&&(this._vignetteBlendMode=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(value){this._vignetteEnabled!==value&&(this._vignetteEnabled=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(value){this._applyByPostProcess!==value&&(this._applyByPostProcess=value,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(value){this._isEnabled!==value&&(this._isEnabled=value,this._updateParameters())},enumerable:!0,configurable:!0}),ImageProcessingConfiguration.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},ImageProcessingConfiguration.prototype.getClassName=function(){return"ImageProcessingConfiguration"},ImageProcessingConfiguration.PrepareUniforms=function(uniforms,defines){defines.EXPOSURE&&uniforms.push("exposureLinear"),defines.CONTRAST&&uniforms.push("contrast"),defines.COLORGRADING&&uniforms.push("colorTransformSettings"),defines.VIGNETTE&&(uniforms.push("vInverseScreenSize"),uniforms.push("vignetteSettings1"),uniforms.push("vignetteSettings2")),defines.COLORCURVES&&BABYLON.ColorCurves.PrepareUniforms(uniforms)},ImageProcessingConfiguration.PrepareSamplers=function(samplersList,defines){defines.COLORGRADING&&samplersList.push("txColorTransform")},ImageProcessingConfiguration.prototype.prepareDefines=function(defines,forPostProcess){if(void 0===forPostProcess&&(forPostProcess=!1),forPostProcess!==this.applyByPostProcess||!this._isEnabled)return defines.VIGNETTE=!1,defines.TONEMAPPING=!1,defines.CONTRAST=!1,defines.EXPOSURE=!1,defines.COLORCURVES=!1,defines.COLORGRADING=!1,defines.COLORGRADING3D=!1,defines.IMAGEPROCESSING=!1,void(defines.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);defines.VIGNETTE=this.vignetteEnabled,defines.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY,defines.VIGNETTEBLENDMODEOPAQUE=!defines.VIGNETTEBLENDMODEMULTIPLY,defines.TONEMAPPING=this.toneMappingEnabled,defines.CONTRAST=1!==this.contrast,defines.EXPOSURE=1!==this.exposure,defines.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,defines.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,defines.COLORGRADING?defines.COLORGRADING3D=this.colorGradingTexture.is3D:defines.COLORGRADING3D=!1,defines.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,defines.SAMPLER3DBGRMAP=this.colorGradingBGR,defines.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,defines.IMAGEPROCESSING=defines.VIGNETTE||defines.TONEMAPPING||defines.CONTRAST||defines.EXPOSURE||defines.COLORCURVES||defines.COLORGRADING},ImageProcessingConfiguration.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},ImageProcessingConfiguration.prototype.bind=function(effect,aspectRatio){if(void 0===aspectRatio&&(aspectRatio=1),this._colorCurvesEnabled&&this.colorCurves&&BABYLON.ColorCurves.Bind(this.colorCurves,effect),this._vignetteEnabled){var inverseWidth=1/effect.getEngine().getRenderWidth(),inverseHeight=1/effect.getEngine().getRenderHeight();effect.setFloat2("vInverseScreenSize",inverseWidth,inverseHeight);var vignetteScaleY=Math.tan(.5*this.vignetteCameraFov),vignetteScaleX=vignetteScaleY*aspectRatio,vignetteScaleGeometricMean=Math.sqrt(vignetteScaleX*vignetteScaleY);vignetteScaleX=BABYLON.Tools.Mix(vignetteScaleX,vignetteScaleGeometricMean,this.vignetteStretch),vignetteScaleY=BABYLON.Tools.Mix(vignetteScaleY,vignetteScaleGeometricMean,this.vignetteStretch),effect.setFloat4("vignetteSettings1",vignetteScaleX,vignetteScaleY,-vignetteScaleX*this.vignetteCentreX,-vignetteScaleY*this.vignetteCentreY);var vignettePower=-2*this.vignetteWeight;effect.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,vignettePower)}if(effect.setFloat("exposureLinear",this.exposure),effect.setFloat("contrast",this.contrast),this.colorGradingTexture){effect.setTexture("txColorTransform",this.colorGradingTexture);var textureSize=this.colorGradingTexture.getSize().height;effect.setFloat4("colorTransformSettings",(textureSize-1)/textureSize,.5/textureSize,textureSize,this.colorGradingTexture.level)}},ImageProcessingConfiguration.prototype.clone=function(){return BABYLON.SerializationHelper.Clone(function(){return new ImageProcessingConfiguration},this)},ImageProcessingConfiguration.prototype.serialize=function(){return BABYLON.SerializationHelper.Serialize(this)},ImageProcessingConfiguration.Parse=function(source){return BABYLON.SerializationHelper.Parse(function(){return new ImageProcessingConfiguration},source,null,null)},Object.defineProperty(ImageProcessingConfiguration,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingConfiguration,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY=0,ImageProcessingConfiguration._VIGNETTEMODE_OPAQUE=1,__decorate([BABYLON.serializeAsColorCurves()],ImageProcessingConfiguration.prototype,"colorCurves",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_colorCurvesEnabled",void 0),__decorate([BABYLON.serializeAsTexture()],ImageProcessingConfiguration.prototype,"colorGradingTexture",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_colorGradingEnabled",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_colorGradingWithGreenDepth",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_colorGradingBGR",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_exposure",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_toneMappingEnabled",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_contrast",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"vignetteStretch",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"vignetteCentreX",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"vignetteCentreY",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"vignetteWeight",void 0),__decorate([BABYLON.serializeAsColor4()],ImageProcessingConfiguration.prototype,"vignetteColor",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"vignetteCameraFov",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_vignetteBlendMode",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_vignetteEnabled",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_applyByPostProcess",void 0),__decorate([BABYLON.serialize()],ImageProcessingConfiguration.prototype,"_isEnabled",void 0),ImageProcessingConfiguration}();BABYLON.ImageProcessingConfiguration=ImageProcessingConfiguration}(BABYLON||(BABYLON={}));!function(BABYLON){var ColorGradingTexture=function(_super){function ColorGradingTexture(url,scene){var _this=_super.call(this,scene)||this;return url?(_this._engine=scene.getEngine(),_this._textureMatrix=BABYLON.Matrix.Identity(),_this.name=url,_this.url=url,_this.hasAlpha=!1,_this.isCube=!1,_this.is3D=_this._engine.webGLVersion>1,_this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapR=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.anisotropicFilteringLevel=1,_this._texture=_this._getFromCache(url,!0),_this._texture||(scene.useDelayedTextureLoading?_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED:_this.loadTexture()),_this):_this}return __extends(ColorGradingTexture,_super),ColorGradingTexture.prototype.getTextureMatrix=function(){return this._textureMatrix},ColorGradingTexture.prototype.load3dlTexture=function(){var texture,engine=this._engine;texture=1===engine.webGLVersion?engine.createRawTexture(null,1,1,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE):engine.createRawTexture3D(null,1,1,1,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE),this._texture=texture;return BABYLON.Tools.LoadFile(this.url,function(text){if("string"==typeof text){for(var line,data=null,tempData=null,lines=text.split("\n"),size=0,pixelIndexW=0,pixelIndexH=0,pixelIndexSlice=0,maxColor=0,i=0;i<lines.length;i++)if(line=lines[i],ColorGradingTexture._noneEmptyLineRegex.test(line)&&0!==line.indexOf("#")){var words=line.split(" ");if(0!==size){if(0!=size){var r=Math.max(parseInt(words[0]),0),g=Math.max(parseInt(words[1]),0),b=Math.max(parseInt(words[2]),0);maxColor=Math.max(r,maxColor),maxColor=Math.max(g,maxColor),maxColor=Math.max(b,maxColor);var pixelStorageIndex=4*(pixelIndexW+pixelIndexSlice*size+pixelIndexH*size*size);tempData&&(tempData[pixelStorageIndex+0]=r,tempData[pixelStorageIndex+1]=g,tempData[pixelStorageIndex+2]=b),++pixelIndexSlice%size==0&&(pixelIndexSlice=0,++pixelIndexH%size==0&&(pixelIndexW++,pixelIndexH=0))}}else size=words.length,data=new Uint8Array(size*size*size*4),tempData=new Float32Array(size*size*size*4)}if(tempData&&data)for(i=0;i<tempData.length;i++)if(i>0&&(i+1)%4==0)data[i]=255;else{var value=tempData[i];data[i]=value/maxColor*255}texture.is3D?(texture.updateSize(size,size,size),engine.updateRawTexture3D(texture,data,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1)):(texture.updateSize(size*size,size),engine.updateRawTexture(texture,data,BABYLON.Engine.TEXTUREFORMAT_RGBA,!1))}}),this._texture},ColorGradingTexture.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},ColorGradingTexture.prototype.clone=function(){var newTexture=new ColorGradingTexture(this.url,this.getScene());return newTexture.level=this.level,newTexture},ColorGradingTexture.prototype.delayLoad=function(){this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},ColorGradingTexture.Parse=function(parsedTexture,scene,rootUrl){var texture=null;return parsedTexture.name&&!parsedTexture.isRenderTarget&&((texture=new BABYLON.ColorGradingTexture(parsedTexture.name,scene)).name=parsedTexture.name,texture.level=parsedTexture.level),texture},ColorGradingTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject={};return serializationObject.name=this.name,serializationObject.level=this.level,serializationObject.customType="BABYLON.ColorGradingTexture",serializationObject},ColorGradingTexture._noneEmptyLineRegex=/\S+/,ColorGradingTexture}(BABYLON.BaseTexture);BABYLON.ColorGradingTexture=ColorGradingTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var ColorCurves=function(){function ColorCurves(){this._dirty=!0,this._tempColor=new BABYLON.Color4(0,0,0,0),this._globalCurve=new BABYLON.Color4(0,0,0,0),this._highlightsCurve=new BABYLON.Color4(0,0,0,0),this._midtonesCurve=new BABYLON.Color4(0,0,0,0),this._shadowsCurve=new BABYLON.Color4(0,0,0,0),this._positiveCurve=new BABYLON.Color4(0,0,0,0),this._negativeCurve=new BABYLON.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(ColorCurves.prototype,"globalHue",{get:function(){return this._globalHue},set:function(value){this._globalHue=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(value){this._globalDensity=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(value){this._globalSaturation=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(value){this._highlightsHue=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(value){this._highlightsDensity=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(value){this._highlightsSaturation=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(value){this._highlightsExposure=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(value){this._midtonesHue=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(value){this._midtonesDensity=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(value){this._midtonesSaturation=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(value){this._midtonesExposure=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(value){this._shadowsHue=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(value){this._shadowsDensity=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(value){this._shadowsSaturation=value,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ColorCurves.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(value){this._shadowsExposure=value,this._dirty=!0},enumerable:!0,configurable:!0}),ColorCurves.prototype.getClassName=function(){return"ColorCurves"},ColorCurves.Bind=function(colorCurves,effect,positiveUniform,neutralUniform,negativeUniform){void 0===positiveUniform&&(positiveUniform="vCameraColorCurvePositive"),void 0===neutralUniform&&(neutralUniform="vCameraColorCurveNeutral"),void 0===negativeUniform&&(negativeUniform="vCameraColorCurveNegative"),colorCurves._dirty&&(colorCurves._dirty=!1,colorCurves.getColorGradingDataToRef(colorCurves._globalHue,colorCurves._globalDensity,colorCurves._globalSaturation,colorCurves._globalExposure,colorCurves._globalCurve),colorCurves.getColorGradingDataToRef(colorCurves._highlightsHue,colorCurves._highlightsDensity,colorCurves._highlightsSaturation,colorCurves._highlightsExposure,colorCurves._tempColor),colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._highlightsCurve),colorCurves.getColorGradingDataToRef(colorCurves._midtonesHue,colorCurves._midtonesDensity,colorCurves._midtonesSaturation,colorCurves._midtonesExposure,colorCurves._tempColor),colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._midtonesCurve),colorCurves.getColorGradingDataToRef(colorCurves._shadowsHue,colorCurves._shadowsDensity,colorCurves._shadowsSaturation,colorCurves._shadowsExposure,colorCurves._tempColor),colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._shadowsCurve),colorCurves._highlightsCurve.subtractToRef(colorCurves._midtonesCurve,colorCurves._positiveCurve),colorCurves._midtonesCurve.subtractToRef(colorCurves._shadowsCurve,colorCurves._negativeCurve)),effect&&(effect.setFloat4(positiveUniform,colorCurves._positiveCurve.r,colorCurves._positiveCurve.g,colorCurves._positiveCurve.b,colorCurves._positiveCurve.a),effect.setFloat4(neutralUniform,colorCurves._midtonesCurve.r,colorCurves._midtonesCurve.g,colorCurves._midtonesCurve.b,colorCurves._midtonesCurve.a),effect.setFloat4(negativeUniform,colorCurves._negativeCurve.r,colorCurves._negativeCurve.g,colorCurves._negativeCurve.b,colorCurves._negativeCurve.a))},ColorCurves.PrepareUniforms=function(uniformsList){uniformsList.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},ColorCurves.prototype.getColorGradingDataToRef=function(hue,density,saturation,exposure,result){null!=hue&&(hue=ColorCurves.clamp(hue,0,360),density=ColorCurves.clamp(density,-100,100),saturation=ColorCurves.clamp(saturation,-100,100),exposure=ColorCurves.clamp(exposure,-100,100),density=ColorCurves.applyColorGradingSliderNonlinear(density),density*=.5,exposure=ColorCurves.applyColorGradingSliderNonlinear(exposure),density<0&&(density*=-1,hue=(hue+180)%360),ColorCurves.fromHSBToRef(hue,density,50+.25*exposure,result),result.scaleToRef(2,result),result.a=1+.01*saturation)},ColorCurves.applyColorGradingSliderNonlinear=function(value){value/=100;var x=Math.abs(value);return x=Math.pow(x,2),value<0&&(x*=-1),x*=100},ColorCurves.fromHSBToRef=function(hue,saturation,brightness,result){var h=ColorCurves.clamp(hue,0,360),s=ColorCurves.clamp(saturation/100,0,1),v=ColorCurves.clamp(brightness/100,0,1);if(0===s)result.r=v,result.g=v,result.b=v;else{h/=60;var i=Math.floor(h),f=h-i,p=v*(1-s),q=v*(1-s*f),t=v*(1-s*(1-f));switch(i){case 0:result.r=v,result.g=t,result.b=p;break;case 1:result.r=q,result.g=v,result.b=p;break;case 2:result.r=p,result.g=v,result.b=t;break;case 3:result.r=p,result.g=q,result.b=v;break;case 4:result.r=t,result.g=p,result.b=v;break;default:result.r=v,result.g=p,result.b=q}}result.a=1},ColorCurves.clamp=function(value,min,max){return Math.min(Math.max(value,min),max)},ColorCurves.prototype.clone=function(){return BABYLON.SerializationHelper.Clone(function(){return new ColorCurves},this)},ColorCurves.prototype.serialize=function(){return BABYLON.SerializationHelper.Serialize(this)},ColorCurves.Parse=function(source){return BABYLON.SerializationHelper.Parse(function(){return new ColorCurves},source,null,null)},__decorate([BABYLON.serialize()],ColorCurves.prototype,"_globalHue",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_globalDensity",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_globalSaturation",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_globalExposure",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_highlightsHue",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_highlightsDensity",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_highlightsSaturation",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_highlightsExposure",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_midtonesHue",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_midtonesDensity",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_midtonesSaturation",void 0),__decorate([BABYLON.serialize()],ColorCurves.prototype,"_midtonesExposure",void 0),ColorCurves}();BABYLON.ColorCurves=ColorCurves}(BABYLON||(BABYLON={}));!function(BABYLON){var StandardMaterialDefines=function(_super){function StandardMaterialDefines(){var _this=_super.call(this)||this;return _this.MAINUV1=!1,_this.MAINUV2=!1,_this.DIFFUSE=!1,_this.DIFFUSEDIRECTUV=0,_this.AMBIENT=!1,_this.AMBIENTDIRECTUV=0,_this.OPACITY=!1,_this.OPACITYDIRECTUV=0,_this.OPACITYRGB=!1,_this.REFLECTION=!1,_this.EMISSIVE=!1,_this.EMISSIVEDIRECTUV=0,_this.SPECULAR=!1,_this.SPECULARDIRECTUV=0,_this.BUMP=!1,_this.BUMPDIRECTUV=0,_this.PARALLAX=!1,_this.PARALLAXOCCLUSION=!1,_this.SPECULAROVERALPHA=!1,_this.CLIPPLANE=!1,_this.ALPHATEST=!1,_this.DEPTHPREPASS=!1,_this.ALPHAFROMDIFFUSE=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.SPECULARTERM=!1,_this.DIFFUSEFRESNEL=!1,_this.OPACITYFRESNEL=!1,_this.REFLECTIONFRESNEL=!1,_this.REFRACTIONFRESNEL=!1,_this.EMISSIVEFRESNEL=!1,_this.FRESNEL=!1,_this.NORMAL=!1,_this.UV1=!1,_this.UV2=!1,_this.VERTEXCOLOR=!1,_this.VERTEXALPHA=!1,_this.NUM_BONE_INFLUENCERS=0,_this.BonesPerMesh=0,_this.INSTANCES=!1,_this.GLOSSINESS=!1,_this.ROUGHNESS=!1,_this.EMISSIVEASILLUMINATION=!1,_this.LINKEMISSIVEWITHDIFFUSE=!1,_this.REFLECTIONFRESNELFROMSPECULAR=!1,_this.LIGHTMAP=!1,_this.LIGHTMAPDIRECTUV=0,_this.USELIGHTMAPASSHADOWMAP=!1,_this.REFLECTIONMAP_3D=!1,_this.REFLECTIONMAP_SPHERICAL=!1,_this.REFLECTIONMAP_PLANAR=!1,_this.REFLECTIONMAP_CUBIC=!1,_this.REFLECTIONMAP_PROJECTION=!1,_this.REFLECTIONMAP_SKYBOX=!1,_this.REFLECTIONMAP_EXPLICIT=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,_this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,_this.INVERTCUBICMAP=!1,_this.LOGARITHMICDEPTH=!1,_this.REFRACTION=!1,_this.REFRACTIONMAP_3D=!1,_this.REFLECTIONOVERALPHA=!1,_this.TWOSIDEDLIGHTING=!1,_this.SHADOWFLOAT=!1,_this.MORPHTARGETS=!1,_this.MORPHTARGETS_NORMAL=!1,_this.MORPHTARGETS_TANGENT=!1,_this.NUM_MORPH_INFLUENCERS=0,_this.NONUNIFORMSCALING=!1,_this.PREMULTIPLYALPHA=!1,_this.IMAGEPROCESSING=!1,_this.VIGNETTE=!1,_this.VIGNETTEBLENDMODEMULTIPLY=!1,_this.VIGNETTEBLENDMODEOPAQUE=!1,_this.TONEMAPPING=!1,_this.CONTRAST=!1,_this.COLORCURVES=!1,_this.COLORGRADING=!1,_this.COLORGRADING3D=!1,_this.SAMPLER3DGREENDEPTH=!1,_this.SAMPLER3DBGRMAP=!1,_this.IMAGEPROCESSINGPOSTPROCESS=!1,_this.EXPOSURE=!1,_this.rebuild(),_this}return __extends(StandardMaterialDefines,_super),StandardMaterialDefines.prototype.setReflectionMode=function(modeToEnable){for(var _i=0,modes_1=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];_i<modes_1.length;_i++){var mode=modes_1[_i];this[mode]=mode===modeToEnable}},StandardMaterialDefines}(BABYLON.MaterialDefines);BABYLON.StandardMaterialDefines=StandardMaterialDefines;var StandardMaterial=function(_super){function StandardMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.ambientColor=new BABYLON.Color3(0,0,0),_this.diffuseColor=new BABYLON.Color3(1,1,1),_this.specularColor=new BABYLON.Color3(1,1,1),_this.emissiveColor=new BABYLON.Color3(0,0,0),_this.specularPower=64,_this._useAlphaFromDiffuseTexture=!1,_this._useEmissiveAsIllumination=!1,_this._linkEmissiveWithDiffuse=!1,_this._useSpecularOverAlpha=!1,_this._useReflectionOverAlpha=!1,_this._disableLighting=!1,_this._useParallax=!1,_this._useParallaxOcclusion=!1,_this.parallaxScaleBias=.05,_this._roughness=0,_this.indexOfRefraction=.98,_this.invertRefractionY=!0,_this._useLightmapAsShadowmap=!1,_this._useReflectionFresnelFromSpecular=!1,_this._useGlossinessFromSpecularMapAlpha=!1,_this._maxSimultaneousLights=4,_this._invertNormalMapX=!1,_this._invertNormalMapY=!1,_this._twoSidedLighting=!1,_this._renderTargets=new BABYLON.SmartArray(16),_this._worldViewProjectionMatrix=BABYLON.Matrix.Zero(),_this._globalAmbientColor=new BABYLON.Color3(0,0,0),_this._attachImageProcessingConfiguration(null),_this.getRenderTargetTextures=function(){return _this._renderTargets.reset(),StandardMaterial.ReflectionTextureEnabled&&_this._reflectionTexture&&_this._reflectionTexture.isRenderTarget&&_this._renderTargets.push(_this._reflectionTexture),StandardMaterial.RefractionTextureEnabled&&_this._refractionTexture&&_this._refractionTexture.isRenderTarget&&_this._renderTargets.push(_this._refractionTexture),_this._renderTargets},_this}return __extends(StandardMaterial,_super),Object.defineProperty(StandardMaterial.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(value){this._attachImageProcessingConfiguration(value),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),StandardMaterial.prototype._attachImageProcessingConfiguration=function(configuration){var _this=this;configuration!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=configuration||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(conf){_this._markAllSubMeshesAsImageProcessingDirty()}))},Object.defineProperty(StandardMaterial.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(value){this.imageProcessingConfiguration.colorCurvesEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(value){this.imageProcessingConfiguration.colorGradingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(value){this._imageProcessingConfiguration.toneMappingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(value){this._imageProcessingConfiguration.exposure=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(value){this._imageProcessingConfiguration.contrast=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(value){this._imageProcessingConfiguration.colorGradingTexture=value},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(value){this._imageProcessingConfiguration.colorCurves=value},enumerable:!0,configurable:!0}),StandardMaterial.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(StandardMaterial.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(value){this._useLogarithmicDepth=value&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),StandardMaterial.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},StandardMaterial.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},StandardMaterial.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},StandardMaterial.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},StandardMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){if(void 0===useInstances&&(useInstances=!1),subMesh.effect&&this.isFrozen&&this._wasPreviouslyReady&&subMesh.effect)return!0;subMesh._materialDefines||(subMesh._materialDefines=new StandardMaterialDefines);var scene=this.getScene(),defines=subMesh._materialDefines;if(!this.checkReadyOnEveryCall&&subMesh.effect&&defines._renderId===scene.getRenderId())return!0;var engine=scene.getEngine();if(defines._needNormals=BABYLON.MaterialHelper.PrepareDefinesForLights(scene,mesh,defines,!0,this._maxSimultaneousLights,this._disableLighting),defines._areTexturesDirty){if(defines._needUVs=!1,defines.MAINUV1=!1,defines.MAINUV2=!1,scene.texturesEnabled){if(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,defines,"DIFFUSE")}else defines.DIFFUSE=!1;if(this._ambientTexture&&StandardMaterial.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,defines,"AMBIENT")}else defines.AMBIENT=!1;if(this._opacityTexture&&StandardMaterial.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,defines,"OPACITY"),defines.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else defines.OPACITY=!1;if(this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(defines._needNormals=!0,defines.REFLECTION=!0,defines.ROUGHNESS=this._roughness>0,defines.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,defines.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===BABYLON.Texture.INVCUBIC_MODE,defines.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case BABYLON.Texture.CUBIC_MODE:case BABYLON.Texture.INVCUBIC_MODE:defines.setReflectionMode("REFLECTIONMAP_CUBIC");break;case BABYLON.Texture.EXPLICIT_MODE:defines.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case BABYLON.Texture.PLANAR_MODE:defines.setReflectionMode("REFLECTIONMAP_PLANAR");break;case BABYLON.Texture.PROJECTION_MODE:defines.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case BABYLON.Texture.SKYBOX_MODE:defines.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case BABYLON.Texture.SPHERICAL_MODE:defines.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case BABYLON.Texture.EQUIRECTANGULAR_MODE:defines.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MODE:defines.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:defines.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED")}}else defines.REFLECTION=!1;if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,defines,"EMISSIVE")}else defines.EMISSIVE=!1;if(this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,defines,"LIGHTMAP"),defines.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else defines.LIGHTMAP=!1;if(this._specularTexture&&StandardMaterial.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,defines,"SPECULAR"),defines.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else defines.SPECULAR=!1;if(scene.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&StandardMaterial.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,defines,"BUMP"),defines.PARALLAX=this._useParallax,defines.PARALLAXOCCLUSION=this._useParallaxOcclusion}else defines.BUMP=!1;if(this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;defines._needUVs=!0,defines.REFRACTION=!0,defines.REFRACTIONMAP_3D=this._refractionTexture.isCube}else defines.REFRACTION=!1;defines.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else defines.DIFFUSE=!1,defines.AMBIENT=!1,defines.OPACITY=!1,defines.REFLECTION=!1,defines.EMISSIVE=!1,defines.LIGHTMAP=!1,defines.BUMP=!1,defines.REFRACTION=!1;defines.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),defines.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,defines.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,defines.SPECULAROVERALPHA=this._useSpecularOverAlpha,defines.PREMULTIPLYALPHA=this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF}if(defines._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(defines)}if(defines._areFresnelDirty&&(StandardMaterial.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(defines.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,defines.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,defines.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,defines.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,defines.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,defines.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,defines._needNormals=!0,defines.FRESNEL=!0):defines.FRESNEL=!1),BABYLON.MaterialHelper.PrepareDefinesForMisc(mesh,scene,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,defines),BABYLON.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!0,!0,!0),BABYLON.MaterialHelper.PrepareDefinesForFrameBoundValues(scene,engine,defines,useInstances),defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new BABYLON.EffectFallbacks;defines.REFLECTION&&fallbacks.addFallback(0,"REFLECTION"),defines.SPECULAR&&fallbacks.addFallback(0,"SPECULAR"),defines.BUMP&&fallbacks.addFallback(0,"BUMP"),defines.PARALLAX&&fallbacks.addFallback(1,"PARALLAX"),defines.PARALLAXOCCLUSION&&fallbacks.addFallback(0,"PARALLAXOCCLUSION"),defines.SPECULAROVERALPHA&&fallbacks.addFallback(0,"SPECULAROVERALPHA"),defines.FOG&&fallbacks.addFallback(1,"FOG"),defines.POINTSIZE&&fallbacks.addFallback(0,"POINTSIZE"),defines.LOGARITHMICDEPTH&&fallbacks.addFallback(0,"LOGARITHMICDEPTH"),BABYLON.MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this._maxSimultaneousLights),defines.SPECULARTERM&&fallbacks.addFallback(0,"SPECULARTERM"),defines.DIFFUSEFRESNEL&&fallbacks.addFallback(1,"DIFFUSEFRESNEL"),defines.OPACITYFRESNEL&&fallbacks.addFallback(2,"OPACITYFRESNEL"),defines.REFLECTIONFRESNEL&&fallbacks.addFallback(3,"REFLECTIONFRESNEL"),defines.EMISSIVEFRESNEL&&fallbacks.addFallback(4,"EMISSIVEFRESNEL"),defines.FRESNEL&&fallbacks.addFallback(4,"FRESNEL");var attribs=[BABYLON.VertexBuffer.PositionKind];defines.NORMAL&&attribs.push(BABYLON.VertexBuffer.NormalKind),defines.UV1&&attribs.push(BABYLON.VertexBuffer.UVKind),defines.UV2&&attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.VERTEXCOLOR&&attribs.push(BABYLON.VertexBuffer.ColorKind),BABYLON.MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks),BABYLON.MaterialHelper.PrepareAttributesForInstances(attribs,defines),BABYLON.MaterialHelper.PrepareAttributesForMorphTargets(attribs,mesh,defines);var shaderName="default",uniforms=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","logarithmicDepthConstant","vTangentSpaceParams"],samplers=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"],uniformBuffers=["Material","Scene"];BABYLON.ImageProcessingConfiguration.PrepareUniforms(uniforms,defines),BABYLON.ImageProcessingConfiguration.PrepareSamplers(samplers,defines),BABYLON.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(shaderName=this.customShaderNameResolve(shaderName,uniforms,uniformBuffers,samplers,defines));var join=defines.toString();subMesh.setEffect(scene.getEngine().createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:defines.NUM_MORPH_INFLUENCERS}},engine),defines),this.buildUniformLayout()}return!(!subMesh.effect||!subMesh.effect.isReady())&&(defines._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},StandardMaterial.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},StandardMaterial.prototype.unbind=function(){this._activeEffect&&(this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._activeEffect.setTexture("reflection2DSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._activeEffect.setTexture("refraction2DSampler",null)),_super.prototype.unbind.call(this)},StandardMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var scene=this.getScene(),defines=subMesh._materialDefines;if(defines){var effect=subMesh.effect;if(effect){this._activeEffect=effect,this.bindOnlyWorldMatrix(world);var mustRebind=this._mustRebind(scene,effect,mesh.visibility);if(BABYLON.MaterialHelper.BindBonesParameters(mesh,effect),mustRebind){if(this._uniformBuffer.bindToEffect(effect,"Material"),this.bindViewProjection(effect),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(StandardMaterial.FresnelEnabled&&defines.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new BABYLON.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),scene.texturesEnabled&&(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),this._ambientTexture&&StandardMaterial.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&StandardMaterial.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix())),this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),this._specularTexture&&StandardMaterial.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._specularTexture,this._uniformBuffer,"specular")),this._bumpTexture&&scene.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),BABYLON.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),scene._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&StandardMaterial.RefractionTextureEnabled)){depth=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(depth=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,depth,this.invertRefractionY?-1:1)}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),defines.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",this.emissiveColor),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*mesh.visibility)}if(scene.texturesEnabled&&(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled&&effect.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&StandardMaterial.AmbientTextureEnabled&&effect.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&StandardMaterial.OpacityTextureEnabled&&effect.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?effect.setTexture("reflectionCubeSampler",this._reflectionTexture):effect.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled&&effect.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled&&effect.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&StandardMaterial.SpecularTextureEnabled&&effect.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&scene.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled&&effect.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&StandardMaterial.RefractionTextureEnabled)){var depth=1;this._refractionTexture.isCube?effect.setTexture("refractionCubeSampler",this._refractionTexture):effect.setTexture("refraction2DSampler",this._refractionTexture)}BABYLON.MaterialHelper.BindClipPlane(effect,scene),scene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),BABYLON.MaterialHelper.BindEyePosition(effect,scene),effect.setColor3("vAmbientColor",this._globalAmbientColor)}!mustRebind&&this.isFrozen||(scene.lightsEnabled&&!this._disableLighting&&BABYLON.MaterialHelper.BindLights(scene,mesh,effect,defines,this._maxSimultaneousLights),(scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==BABYLON.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(effect),BABYLON.MaterialHelper.BindFogParameters(scene,mesh,effect),defines.NUM_MORPH_INFLUENCERS&&BABYLON.MaterialHelper.BindMorphTargetParameters(mesh,effect),BABYLON.MaterialHelper.BindLogDepth(defines,effect,scene),this._imageProcessingConfiguration.applyByPostProcess||this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(mesh,this._activeEffect)}}},StandardMaterial.prototype.getAnimatables=function(){var results=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&results.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&results.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&results.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&results.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&results.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&results.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&results.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&results.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&results.push(this._refractionTexture),results},StandardMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);return this._diffuseTexture&&activeTextures.push(this._diffuseTexture),this._ambientTexture&&activeTextures.push(this._ambientTexture),this._opacityTexture&&activeTextures.push(this._opacityTexture),this._reflectionTexture&&activeTextures.push(this._reflectionTexture),this._emissiveTexture&&activeTextures.push(this._emissiveTexture),this._specularTexture&&activeTextures.push(this._specularTexture),this._bumpTexture&&activeTextures.push(this._bumpTexture),this._lightmapTexture&&activeTextures.push(this._lightmapTexture),this._refractionTexture&&activeTextures.push(this._refractionTexture),activeTextures},StandardMaterial.prototype.hasTexture=function(texture){return!!_super.prototype.hasTexture.call(this,texture)||(this._diffuseTexture===texture||(this._ambientTexture===texture||(this._opacityTexture===texture||(this._reflectionTexture===texture||(this._emissiveTexture===texture||(this._specularTexture===texture||(this._bumpTexture===texture||(this._lightmapTexture===texture||this._refractionTexture===texture))))))))},StandardMaterial.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){forceDisposeTextures&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),_super.prototype.dispose.call(this,forceDisposeEffect,forceDisposeTextures)},StandardMaterial.prototype.clone=function(name){var _this=this,result=BABYLON.SerializationHelper.Clone(function(){return new StandardMaterial(name,_this.getScene())},this);return result.name=name,result.id=name,result},StandardMaterial.prototype.serialize=function(){return BABYLON.SerializationHelper.Serialize(this)},StandardMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new StandardMaterial(source.name,scene)},source,scene,rootUrl)},Object.defineProperty(StandardMaterial,"DiffuseTextureEnabled",{get:function(){return StandardMaterial._DiffuseTextureEnabled},set:function(value){StandardMaterial._DiffuseTextureEnabled!==value&&(StandardMaterial._DiffuseTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"AmbientTextureEnabled",{get:function(){return StandardMaterial._AmbientTextureEnabled},set:function(value){StandardMaterial._AmbientTextureEnabled!==value&&(StandardMaterial._AmbientTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"OpacityTextureEnabled",{get:function(){return StandardMaterial._OpacityTextureEnabled},set:function(value){StandardMaterial._OpacityTextureEnabled!==value&&(StandardMaterial._OpacityTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"ReflectionTextureEnabled",{get:function(){return StandardMaterial._ReflectionTextureEnabled},set:function(value){StandardMaterial._ReflectionTextureEnabled!==value&&(StandardMaterial._ReflectionTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"EmissiveTextureEnabled",{get:function(){return StandardMaterial._EmissiveTextureEnabled},set:function(value){StandardMaterial._EmissiveTextureEnabled!==value&&(StandardMaterial._EmissiveTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"SpecularTextureEnabled",{get:function(){return StandardMaterial._SpecularTextureEnabled},set:function(value){StandardMaterial._SpecularTextureEnabled!==value&&(StandardMaterial._SpecularTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"BumpTextureEnabled",{get:function(){return StandardMaterial._BumpTextureEnabled},set:function(value){StandardMaterial._BumpTextureEnabled!==value&&(StandardMaterial._BumpTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"LightmapTextureEnabled",{get:function(){return StandardMaterial._LightmapTextureEnabled},set:function(value){StandardMaterial._LightmapTextureEnabled!==value&&(StandardMaterial._LightmapTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"RefractionTextureEnabled",{get:function(){return StandardMaterial._RefractionTextureEnabled},set:function(value){StandardMaterial._RefractionTextureEnabled!==value&&(StandardMaterial._RefractionTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"ColorGradingTextureEnabled",{get:function(){return StandardMaterial._ColorGradingTextureEnabled},set:function(value){StandardMaterial._ColorGradingTextureEnabled!==value&&(StandardMaterial._ColorGradingTextureEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardMaterial,"FresnelEnabled",{get:function(){return StandardMaterial._FresnelEnabled},set:function(value){StandardMaterial._FresnelEnabled!==value&&(StandardMaterial._FresnelEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),StandardMaterial._DiffuseTextureEnabled=!0,StandardMaterial._AmbientTextureEnabled=!0,StandardMaterial._OpacityTextureEnabled=!0,StandardMaterial._ReflectionTextureEnabled=!0,StandardMaterial._EmissiveTextureEnabled=!0,StandardMaterial._SpecularTextureEnabled=!0,StandardMaterial._BumpTextureEnabled=!0,StandardMaterial._LightmapTextureEnabled=!0,StandardMaterial._RefractionTextureEnabled=!0,StandardMaterial._ColorGradingTextureEnabled=!0,StandardMaterial._FresnelEnabled=!0,__decorate([BABYLON.serializeAsTexture("diffuseTexture")],StandardMaterial.prototype,"_diffuseTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"diffuseTexture",void 0),__decorate([BABYLON.serializeAsTexture("ambientTexture")],StandardMaterial.prototype,"_ambientTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"ambientTexture",void 0),__decorate([BABYLON.serializeAsTexture("opacityTexture")],StandardMaterial.prototype,"_opacityTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"opacityTexture",void 0),__decorate([BABYLON.serializeAsTexture("reflectionTexture")],StandardMaterial.prototype,"_reflectionTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"reflectionTexture",void 0),__decorate([BABYLON.serializeAsTexture("emissiveTexture")],StandardMaterial.prototype,"_emissiveTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"emissiveTexture",void 0),__decorate([BABYLON.serializeAsTexture("specularTexture")],StandardMaterial.prototype,"_specularTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"specularTexture",void 0),__decorate([BABYLON.serializeAsTexture("bumpTexture")],StandardMaterial.prototype,"_bumpTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"bumpTexture",void 0),__decorate([BABYLON.serializeAsTexture("lightmapTexture")],StandardMaterial.prototype,"_lightmapTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"lightmapTexture",void 0),__decorate([BABYLON.serializeAsTexture("refractionTexture")],StandardMaterial.prototype,"_refractionTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"refractionTexture",void 0),__decorate([BABYLON.serializeAsColor3("ambient")],StandardMaterial.prototype,"ambientColor",void 0),__decorate([BABYLON.serializeAsColor3("diffuse")],StandardMaterial.prototype,"diffuseColor",void 0),__decorate([BABYLON.serializeAsColor3("specular")],StandardMaterial.prototype,"specularColor",void 0),__decorate([BABYLON.serializeAsColor3("emissive")],StandardMaterial.prototype,"emissiveColor",void 0),__decorate([BABYLON.serialize()],StandardMaterial.prototype,"specularPower",void 0),__decorate([BABYLON.serialize("useAlphaFromDiffuseTexture")],StandardMaterial.prototype,"_useAlphaFromDiffuseTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([BABYLON.serialize("useEmissiveAsIllumination")],StandardMaterial.prototype,"_useEmissiveAsIllumination",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useEmissiveAsIllumination",void 0),__decorate([BABYLON.serialize("linkEmissiveWithDiffuse")],StandardMaterial.prototype,"_linkEmissiveWithDiffuse",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([BABYLON.serialize("useSpecularOverAlpha")],StandardMaterial.prototype,"_useSpecularOverAlpha",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useSpecularOverAlpha",void 0),__decorate([BABYLON.serialize("useReflectionOverAlpha")],StandardMaterial.prototype,"_useReflectionOverAlpha",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useReflectionOverAlpha",void 0),__decorate([BABYLON.serialize("disableLighting")],StandardMaterial.prototype,"_disableLighting",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"disableLighting",void 0),__decorate([BABYLON.serialize("useParallax")],StandardMaterial.prototype,"_useParallax",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallax",void 0),__decorate([BABYLON.serialize("useParallaxOcclusion")],StandardMaterial.prototype,"_useParallaxOcclusion",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallaxOcclusion",void 0),__decorate([BABYLON.serialize()],StandardMaterial.prototype,"parallaxScaleBias",void 0),__decorate([BABYLON.serialize("roughness")],StandardMaterial.prototype,"_roughness",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"roughness",void 0),__decorate([BABYLON.serialize()],StandardMaterial.prototype,"indexOfRefraction",void 0),__decorate([BABYLON.serialize()],StandardMaterial.prototype,"invertRefractionY",void 0),__decorate([BABYLON.serialize("useLightmapAsShadowmap")],StandardMaterial.prototype,"_useLightmapAsShadowmap",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useLightmapAsShadowmap",void 0),__decorate([BABYLON.serializeAsFresnelParameters("diffuseFresnelParameters")],StandardMaterial.prototype,"_diffuseFresnelParameters",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"diffuseFresnelParameters",void 0),__decorate([BABYLON.serializeAsFresnelParameters("opacityFresnelParameters")],StandardMaterial.prototype,"_opacityFresnelParameters",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"opacityFresnelParameters",void 0),__decorate([BABYLON.serializeAsFresnelParameters("reflectionFresnelParameters")],StandardMaterial.prototype,"_reflectionFresnelParameters",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"reflectionFresnelParameters",void 0),__decorate([BABYLON.serializeAsFresnelParameters("refractionFresnelParameters")],StandardMaterial.prototype,"_refractionFresnelParameters",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"refractionFresnelParameters",void 0),__decorate([BABYLON.serializeAsFresnelParameters("emissiveFresnelParameters")],StandardMaterial.prototype,"_emissiveFresnelParameters",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"emissiveFresnelParameters",void 0),__decorate([BABYLON.serialize("useReflectionFresnelFromSpecular")],StandardMaterial.prototype,"_useReflectionFresnelFromSpecular",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([BABYLON.serialize("useGlossinessFromSpecularMapAlpha")],StandardMaterial.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([BABYLON.serialize("maxSimultaneousLights")],StandardMaterial.prototype,"_maxSimultaneousLights",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([BABYLON.serialize("invertNormalMapX")],StandardMaterial.prototype,"_invertNormalMapX",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapX",void 0),__decorate([BABYLON.serialize("invertNormalMapY")],StandardMaterial.prototype,"_invertNormalMapY",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapY",void 0),__decorate([BABYLON.serialize("twoSidedLighting")],StandardMaterial.prototype,"_twoSidedLighting",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"twoSidedLighting",void 0),__decorate([BABYLON.serialize()],StandardMaterial.prototype,"useLogarithmicDepth",null),StandardMaterial}(BABYLON.PushMaterial);BABYLON.StandardMaterial=StandardMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var PBRMaterialDefines=function(_super){function PBRMaterialDefines(){var _this=_super.call(this)||this;return _this.PBR=!0,_this.MAINUV1=!1,_this.MAINUV2=!1,_this.UV1=!1,_this.UV2=!1,_this.ALBEDO=!1,_this.ALBEDODIRECTUV=0,_this.VERTEXCOLOR=!1,_this.AMBIENT=!1,_this.AMBIENTDIRECTUV=0,_this.AMBIENTINGRAYSCALE=!1,_this.OPACITY=!1,_this.VERTEXALPHA=!1,_this.OPACITYDIRECTUV=0,_this.OPACITYRGB=!1,_this.ALPHATEST=!1,_this.DEPTHPREPASS=!1,_this.ALPHABLEND=!1,_this.ALPHAFROMALBEDO=!1,_this.ALPHATESTVALUE=.5,_this.SPECULAROVERALPHA=!1,_this.RADIANCEOVERALPHA=!1,_this.ALPHAFRESNEL=!1,_this.LINEARALPHAFRESNEL=!1,_this.PREMULTIPLYALPHA=!1,_this.EMISSIVE=!1,_this.EMISSIVEDIRECTUV=0,_this.REFLECTIVITY=!1,_this.REFLECTIVITYDIRECTUV=0,_this.SPECULARTERM=!1,_this.MICROSURFACEFROMREFLECTIVITYMAP=!1,_this.MICROSURFACEAUTOMATIC=!1,_this.LODBASEDMICROSFURACE=!1,_this.MICROSURFACEMAP=!1,_this.MICROSURFACEMAPDIRECTUV=0,_this.METALLICWORKFLOW=!1,_this.ROUGHNESSSTOREINMETALMAPALPHA=!1,_this.ROUGHNESSSTOREINMETALMAPGREEN=!1,_this.METALLNESSSTOREINMETALMAPBLUE=!1,_this.AOSTOREINMETALMAPRED=!1,_this.ENVIRONMENTBRDF=!1,_this.NORMAL=!1,_this.TANGENT=!1,_this.BUMP=!1,_this.BUMPDIRECTUV=0,_this.PARALLAX=!1,_this.PARALLAXOCCLUSION=!1,_this.NORMALXYSCALE=!0,_this.LIGHTMAP=!1,_this.LIGHTMAPDIRECTUV=0,_this.USELIGHTMAPASSHADOWMAP=!1,_this.REFLECTION=!1,_this.REFLECTIONMAP_3D=!1,_this.REFLECTIONMAP_SPHERICAL=!1,_this.REFLECTIONMAP_PLANAR=!1,_this.REFLECTIONMAP_CUBIC=!1,_this.REFLECTIONMAP_PROJECTION=!1,_this.REFLECTIONMAP_SKYBOX=!1,_this.REFLECTIONMAP_EXPLICIT=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,_this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,_this.INVERTCUBICMAP=!1,_this.USESPHERICALFROMREFLECTIONMAP=!1,_this.USESPHERICALINVERTEX=!1,_this.REFLECTIONMAP_OPPOSITEZ=!1,_this.LODINREFLECTIONALPHA=!1,_this.GAMMAREFLECTION=!1,_this.RADIANCEOCCLUSION=!1,_this.HORIZONOCCLUSION=!1,_this.REFRACTION=!1,_this.REFRACTIONMAP_3D=!1,_this.REFRACTIONMAP_OPPOSITEZ=!1,_this.LODINREFRACTIONALPHA=!1,_this.GAMMAREFRACTION=!1,_this.LINKREFRACTIONTOTRANSPARENCY=!1,_this.INSTANCES=!1,_this.NUM_BONE_INFLUENCERS=0,_this.BonesPerMesh=0,_this.NONUNIFORMSCALING=!1,_this.MORPHTARGETS=!1,_this.MORPHTARGETS_NORMAL=!1,_this.MORPHTARGETS_TANGENT=!1,_this.NUM_MORPH_INFLUENCERS=0,_this.IMAGEPROCESSING=!1,_this.VIGNETTE=!1,_this.VIGNETTEBLENDMODEMULTIPLY=!1,_this.VIGNETTEBLENDMODEOPAQUE=!1,_this.TONEMAPPING=!1,_this.CONTRAST=!1,_this.COLORCURVES=!1,_this.COLORGRADING=!1,_this.COLORGRADING3D=!1,_this.SAMPLER3DGREENDEPTH=!1,_this.SAMPLER3DBGRMAP=!1,_this.IMAGEPROCESSINGPOSTPROCESS=!1,_this.EXPOSURE=!1,_this.USEPHYSICALLIGHTFALLOFF=!1,_this.TWOSIDEDLIGHTING=!1,_this.SHADOWFLOAT=!1,_this.CLIPPLANE=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.LOGARITHMICDEPTH=!1,_this.FORCENORMALFORWARD=!1,_this.rebuild(),_this}return __extends(PBRMaterialDefines,_super),PBRMaterialDefines.prototype.reset=function(){_super.prototype.reset.call(this),this.ALPHATESTVALUE=.5,this.PBR=!0},PBRMaterialDefines}(BABYLON.MaterialDefines),PBRBaseMaterial=function(_super){function PBRBaseMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this._directIntensity=1,_this._emissiveIntensity=1,_this._environmentIntensity=1,_this._specularIntensity=1,_this._lightingInfos=new BABYLON.Vector4(_this._directIntensity,_this._emissiveIntensity,_this._environmentIntensity,_this._specularIntensity),_this._disableBumpMap=!1,_this._ambientTextureStrength=1,_this._ambientColor=new BABYLON.Color3(0,0,0),_this._albedoColor=new BABYLON.Color3(1,1,1),_this._reflectivityColor=new BABYLON.Color3(1,1,1),_this._reflectionColor=new BABYLON.Color3(1,1,1),_this._emissiveColor=new BABYLON.Color3(0,0,0),_this._microSurface=.9,_this._indexOfRefraction=.66,_this._invertRefractionY=!1,_this._linkRefractionWithTransparency=!1,_this._useLightmapAsShadowmap=!1,_this._useHorizonOcclusion=!0,_this._useRadianceOcclusion=!0,_this._useAlphaFromAlbedoTexture=!1,_this._useSpecularOverAlpha=!0,_this._useMicroSurfaceFromReflectivityMapAlpha=!1,_this._useRoughnessFromMetallicTextureAlpha=!0,_this._useRoughnessFromMetallicTextureGreen=!1,_this._useMetallnessFromMetallicTextureBlue=!1,_this._useAmbientOcclusionFromMetallicTextureRed=!1,_this._useAmbientInGrayScale=!1,_this._useAutoMicroSurfaceFromReflectivityMap=!1,_this._usePhysicalLightFalloff=!0,_this._useRadianceOverAlpha=!0,_this._useParallax=!1,_this._useParallaxOcclusion=!1,_this._parallaxScaleBias=.05,_this._disableLighting=!1,_this._maxSimultaneousLights=4,_this._invertNormalMapX=!1,_this._invertNormalMapY=!1,_this._twoSidedLighting=!1,_this._alphaCutOff=.4,_this._forceAlphaTest=!1,_this._useAlphaFresnel=!1,_this._useLinearAlphaFresnel=!1,_this._transparencyMode=null,_this._environmentBRDFTexture=null,_this._forceIrradianceInFragment=!1,_this._forceNormalForward=!1,_this._renderTargets=new BABYLON.SmartArray(16),_this._globalAmbientColor=new BABYLON.Color3(0,0,0),_this._attachImageProcessingConfiguration(null),_this.getRenderTargetTextures=function(){return _this._renderTargets.reset(),BABYLON.StandardMaterial.ReflectionTextureEnabled&&_this._reflectionTexture&&_this._reflectionTexture.isRenderTarget&&_this._renderTargets.push(_this._reflectionTexture),BABYLON.StandardMaterial.RefractionTextureEnabled&&_this._refractionTexture&&_this._refractionTexture.isRenderTarget&&_this._renderTargets.push(_this._refractionTexture),_this._renderTargets},_this._environmentBRDFTexture=BABYLON.TextureTools.GetEnvironmentBRDFTexture(scene),_this}return __extends(PBRBaseMaterial,_super),PBRBaseMaterial.prototype._attachImageProcessingConfiguration=function(configuration){var _this=this;configuration!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=configuration||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(conf){_this._markAllSubMeshesAsImageProcessingDirty()}))},PBRBaseMaterial.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(PBRBaseMaterial.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(value){this._useLogarithmicDepth=value&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(PBRBaseMaterial.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(value){this._transparencyMode!==value&&(this._transparencyMode=value,this._forceAlphaTest=value===BABYLON.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(PBRBaseMaterial.prototype,"_disableAlphaBlending",{get:function(){return this._linkRefractionWithTransparency||this._transparencyMode===BABYLON.PBRMaterial.PBRMATERIAL_OPAQUE||this._transparencyMode===BABYLON.PBRMaterial.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),PBRBaseMaterial.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},PBRBaseMaterial.prototype.needAlphaBlendingForMesh=function(mesh){return!this._disableAlphaBlending&&_super.prototype.needAlphaBlendingForMesh.call(this,mesh)},PBRBaseMaterial.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this._linkRefractionWithTransparency&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===BABYLON.PBRMaterial.PBRMATERIAL_ALPHATEST))},PBRBaseMaterial.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==BABYLON.PBRMaterial.PBRMATERIAL_OPAQUE},PBRBaseMaterial.prototype.getAlphaTestTexture=function(){return this._albedoTexture},PBRBaseMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){var _this=this;if(subMesh.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;subMesh._materialDefines||(subMesh._materialDefines=new PBRMaterialDefines);var scene=this.getScene(),defines=subMesh._materialDefines;if(!this.checkReadyOnEveryCall&&subMesh.effect&&defines._renderId===scene.getRenderId())return!0;var engine=scene.getEngine();if(BABYLON.MaterialHelper.PrepareDefinesForLights(scene,mesh,defines,!0,this._maxSimultaneousLights,this._disableLighting),defines._needNormals=!0,defines._areTexturesDirty){if(defines._needUVs=!1,scene.texturesEnabled){if(scene.getEngine().getCaps().textureLOD&&(defines.LODBASEDMICROSFURACE=!0),this._albedoTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,defines,"ALBEDO")}else defines.ALBEDO=!1;if(this._ambientTexture&&BABYLON.StandardMaterial.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,defines,"AMBIENT"),defines.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale}else defines.AMBIENT=!1;if(this._opacityTexture&&BABYLON.StandardMaterial.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,defines,"OPACITY"),defines.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else defines.OPACITY=!1;var reflectionTexture=this._getReflectionTexture();if(reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled){if(!reflectionTexture.isReadyOrNotBlocking())return!1;switch(defines.REFLECTION=!0,defines.GAMMAREFLECTION=reflectionTexture.gammaSpace,defines.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!reflectionTexture.invertZ:reflectionTexture.invertZ,defines.LODINREFLECTIONALPHA=reflectionTexture.lodLevelInAlpha,reflectionTexture.coordinatesMode===BABYLON.Texture.INVCUBIC_MODE&&(defines.INVERTCUBICMAP=!0),defines.REFLECTIONMAP_3D=reflectionTexture.isCube,reflectionTexture.coordinatesMode){case BABYLON.Texture.CUBIC_MODE:case BABYLON.Texture.INVCUBIC_MODE:defines.REFLECTIONMAP_CUBIC=!0;break;case BABYLON.Texture.EXPLICIT_MODE:defines.REFLECTIONMAP_EXPLICIT=!0;break;case BABYLON.Texture.PLANAR_MODE:defines.REFLECTIONMAP_PLANAR=!0;break;case BABYLON.Texture.PROJECTION_MODE:defines.REFLECTIONMAP_PROJECTION=!0;break;case BABYLON.Texture.SKYBOX_MODE:defines.REFLECTIONMAP_SKYBOX=!0;break;case BABYLON.Texture.SPHERICAL_MODE:defines.REFLECTIONMAP_SPHERICAL=!0;break;case BABYLON.Texture.EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0}reflectionTexture.coordinatesMode!==BABYLON.Texture.SKYBOX_MODE&&reflectionTexture.sphericalPolynomial&&(defines.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||scene.getEngine().getCaps().maxVaryingVectors<=8?defines.USESPHERICALINVERTEX=!1:defines.USESPHERICALINVERTEX=!0)}else defines.REFLECTION=!1,defines.REFLECTIONMAP_3D=!1,defines.REFLECTIONMAP_SPHERICAL=!1,defines.REFLECTIONMAP_PLANAR=!1,defines.REFLECTIONMAP_CUBIC=!1,defines.REFLECTIONMAP_PROJECTION=!1,defines.REFLECTIONMAP_SKYBOX=!1,defines.REFLECTIONMAP_EXPLICIT=!1,defines.REFLECTIONMAP_EQUIRECTANGULAR=!1,defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,defines.INVERTCUBICMAP=!1,defines.USESPHERICALFROMREFLECTIONMAP=!1,defines.USESPHERICALINVERTEX=!1,defines.REFLECTIONMAP_OPPOSITEZ=!1,defines.LODINREFLECTIONALPHA=!1,defines.GAMMAREFLECTION=!1;if(this._lightmapTexture&&BABYLON.StandardMaterial.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,defines,"LIGHTMAP"),defines.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else defines.LIGHTMAP=!1;if(this._emissiveTexture&&BABYLON.StandardMaterial.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,defines,"EMISSIVE")}else defines.EMISSIVE=!1;if(BABYLON.StandardMaterial.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,defines,"REFLECTIVITY"),defines.METALLICWORKFLOW=!0,defines.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,defines.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,defines.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,defines.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed}else if(this._reflectivityTexture){if(!this._reflectivityTexture.isReadyOrNotBlocking())return!1;defines.METALLICWORKFLOW=!1,BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,defines,"REFLECTIVITY"),defines.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,defines.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap}else defines.METALLICWORKFLOW=!1,defines.REFLECTIVITY=!1;if(this._microSurfaceTexture){if(!this._microSurfaceTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,defines,"MICROSURFACEMAP")}else defines.MICROSURFACEMAP=!1}else defines.REFLECTIVITY=!1,defines.MICROSURFACEMAP=!1;if(scene.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&BABYLON.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap){if(!this._bumpTexture.isReady())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,defines,"BUMP"),this._useParallax&&this._albedoTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled?(defines.PARALLAX=!0,defines.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):defines.PARALLAX=!1}else defines.BUMP=!1;var refractionTexture=this._getRefractionTexture();if(refractionTexture&&BABYLON.StandardMaterial.RefractionTextureEnabled){if(!refractionTexture.isReadyOrNotBlocking())return!1;defines.REFRACTION=!0,defines.REFRACTIONMAP_3D=refractionTexture.isCube,defines.GAMMAREFRACTION=refractionTexture.gammaSpace,defines.REFRACTIONMAP_OPPOSITEZ=refractionTexture.invertZ,defines.LODINREFRACTIONALPHA=refractionTexture.lodLevelInAlpha,this._linkRefractionWithTransparency&&(defines.LINKREFRACTIONTOTRANSPARENCY=!0)}else defines.REFRACTION=!1;if(this._environmentBRDFTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled){if(!this._environmentBRDFTexture.isReady())return!1;defines.ENVIRONMENTBRDF=!0}else defines.ENVIRONMENTBRDF=!1;this._shouldUseAlphaFromAlbedoTexture()?defines.ALPHAFROMALBEDO=!0:defines.ALPHAFROMALBEDO=!1}defines.SPECULAROVERALPHA=this._useSpecularOverAlpha,defines.USEPHYSICALLIGHTFALLOFF=this._usePhysicalLightFalloff,defines.RADIANCEOVERALPHA=this._useRadianceOverAlpha,void 0!==this._metallic&&null!==this._metallic||void 0!==this._roughness&&null!==this._roughness?defines.METALLICWORKFLOW=!0:defines.METALLICWORKFLOW=!1,!this.backFaceCulling&&this._twoSidedLighting?defines.TWOSIDEDLIGHTING=!0:defines.TWOSIDEDLIGHTING=!1,defines.ALPHATESTVALUE=this._alphaCutOff,defines.PREMULTIPLYALPHA=this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,defines.ALPHABLEND=this.needAlphaBlendingForMesh(mesh),defines.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,defines.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel}if(defines._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(defines)}if(defines.FORCENORMALFORWARD=this._forceNormalForward,defines.RADIANCEOCCLUSION=this._useRadianceOcclusion,defines.HORIZONOCCLUSION=this._useHorizonOcclusion,BABYLON.MaterialHelper.PrepareDefinesForMisc(mesh,scene,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,defines),BABYLON.MaterialHelper.PrepareDefinesForFrameBoundValues(scene,engine,defines,!!useInstances,this._forceAlphaTest),BABYLON.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!0,!0,!0,this._transparencyMode!==BABYLON.PBRMaterial.PBRMATERIAL_OPAQUE)&&mesh){var bufferMesh=null;if(mesh instanceof BABYLON.InstancedMesh?bufferMesh=mesh.sourceMesh:mesh instanceof BABYLON.Mesh&&(bufferMesh=mesh),bufferMesh)if(bufferMesh.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)){var normalVertexBuffer=bufferMesh.getVertexBuffer(BABYLON.VertexBuffer.NormalKind),normals=normalVertexBuffer.getData(),vertexBufferOffset=normalVertexBuffer.getOffset(),strideSize=normalVertexBuffer.getStrideSize(),offset=vertexBufferOffset+subMesh.indexStart*strideSize;if(0===normals[offset]&&0===normals[offset+1]&&0===normals[offset+2]&&(defines.NORMAL=!1),bufferMesh.isVerticesDataPresent(BABYLON.VertexBuffer.TangentKind)){var tangentVertexBuffer=bufferMesh.getVertexBuffer(BABYLON.VertexBuffer.TangentKind),tangents=tangentVertexBuffer.getData(),vertexBufferOffset_1=tangentVertexBuffer.getOffset(),strideSize_1=tangentVertexBuffer.getStrideSize(),offset_1=vertexBufferOffset_1+subMesh.indexStart*strideSize_1;0===tangents[offset_1]&&0===tangents[offset_1+1]&&0===tangents[offset_1+2]&&(defines.TANGENT=!1)}}else scene.getEngine().getCaps().standardDerivatives||(bufferMesh.createNormals(!0),BABYLON.Tools.Warn("PBRMaterial: Normals have been created for the mesh: "+bufferMesh.name))}if(defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new BABYLON.EffectFallbacks,fallbackRank=0;defines.USESPHERICALINVERTEX&&fallbacks.addFallback(fallbackRank++,"USESPHERICALINVERTEX"),defines.FOG&&fallbacks.addFallback(fallbackRank,"FOG"),defines.POINTSIZE&&fallbacks.addFallback(fallbackRank,"POINTSIZE"),defines.LOGARITHMICDEPTH&&fallbacks.addFallback(fallbackRank,"LOGARITHMICDEPTH"),defines.PARALLAX&&fallbacks.addFallback(fallbackRank,"PARALLAX"),defines.PARALLAXOCCLUSION&&fallbacks.addFallback(fallbackRank++,"PARALLAXOCCLUSION"),defines.ENVIRONMENTBRDF&&fallbacks.addFallback(fallbackRank++,"ENVIRONMENTBRDF"),defines.TANGENT&&fallbacks.addFallback(fallbackRank++,"TANGENT"),defines.BUMP&&fallbacks.addFallback(fallbackRank++,"BUMP"),fallbackRank=BABYLON.MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this._maxSimultaneousLights,fallbackRank++),defines.SPECULARTERM&&fallbacks.addFallback(fallbackRank++,"SPECULARTERM"),defines.USESPHERICALFROMREFLECTIONMAP&&fallbacks.addFallback(fallbackRank++,"USESPHERICALFROMREFLECTIONMAP"),defines.LIGHTMAP&&fallbacks.addFallback(fallbackRank++,"LIGHTMAP"),defines.NORMAL&&fallbacks.addFallback(fallbackRank++,"NORMAL"),defines.AMBIENT&&fallbacks.addFallback(fallbackRank++,"AMBIENT"),defines.EMISSIVE&&fallbacks.addFallback(fallbackRank++,"EMISSIVE"),defines.VERTEXCOLOR&&fallbacks.addFallback(fallbackRank++,"VERTEXCOLOR"),defines.NUM_BONE_INFLUENCERS>0&&fallbacks.addCPUSkinningFallback(fallbackRank++,mesh),defines.MORPHTARGETS&&fallbacks.addFallback(fallbackRank++,"MORPHTARGETS");var attribs=[BABYLON.VertexBuffer.PositionKind];defines.NORMAL&&attribs.push(BABYLON.VertexBuffer.NormalKind),defines.TANGENT&&attribs.push(BABYLON.VertexBuffer.TangentKind),defines.UV1&&attribs.push(BABYLON.VertexBuffer.UVKind),defines.UV2&&attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.VERTEXCOLOR&&attribs.push(BABYLON.VertexBuffer.ColorKind),BABYLON.MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks),BABYLON.MaterialHelper.PrepareAttributesForInstances(attribs,defines),BABYLON.MaterialHelper.PrepareAttributesForMorphTargets(attribs,mesh,defines);var uniforms=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vReflectionMicrosurfaceInfos","vRefractionMicrosurfaceInfos","vTangentSpaceParams"],samplers=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler"],uniformBuffers=["Material","Scene"];BABYLON.ImageProcessingConfiguration.PrepareUniforms(uniforms,defines),BABYLON.ImageProcessingConfiguration.PrepareSamplers(samplers,defines),BABYLON.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this._maxSimultaneousLights});var join=defines.toString();subMesh.setEffect(scene.getEngine().createEffect("pbr",{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:function(effect){_this.onCompiled&&_this.onCompiled(effect),_this.bindSceneUniformBuffer(effect,scene.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:defines.NUM_MORPH_INFLUENCERS}},engine),defines),this.buildUniformLayout()}return!(!subMesh.effect||!subMesh.effect.isReady())&&(defines._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},PBRBaseMaterial.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vAlbedoInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",3),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vReflectivityInfos",3),this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos",2),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("albedoMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("reflectivityMatrix",16),this._uniformBuffer.addUniform("microSurfaceSamplerMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionColor",3),this._uniformBuffer.addUniform("vAlbedoColor",4),this._uniformBuffer.addUniform("vLightingIntensity",4),this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectivityColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},PBRBaseMaterial.prototype.unbind=function(){this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._uniformBuffer.setTexture("refractionSampler",null),_super.prototype.unbind.call(this)},PBRBaseMaterial.prototype.bindOnlyWorldMatrix=function(world){this._activeEffect.setMatrix("world",world)},PBRBaseMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var scene=this.getScene(),defines=subMesh._materialDefines;if(defines){var effect=subMesh.effect;if(effect){this._activeEffect=effect,this.bindOnlyWorldMatrix(world);var mustRebind=this._mustRebind(scene,effect,mesh.visibility);BABYLON.MaterialHelper.BindBonesParameters(mesh,this._activeEffect);var reflectionTexture=null;if(mustRebind){this._uniformBuffer.bindToEffect(effect,"Material"),this.bindViewProjection(effect),reflectionTexture=this._getReflectionTexture();var refractionTexture=this._getRefractionTexture();if(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(scene.texturesEnabled){if(this._albedoTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._albedoTexture,this._uniformBuffer,"albedo")),this._ambientTexture&&BABYLON.StandardMaterial.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat3("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength),BABYLON.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&BABYLON.StandardMaterial.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled){this._uniformBuffer.updateMatrix("reflectionMatrix",reflectionTexture.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",reflectionTexture.level,0);var polynomials=reflectionTexture.sphericalPolynomial;defines.USESPHERICALFROMREFLECTIONMAP&&polynomials&&(this._activeEffect.setFloat3("vSphericalX",polynomials.x.x,polynomials.x.y,polynomials.x.z),this._activeEffect.setFloat3("vSphericalY",polynomials.y.x,polynomials.y.y,polynomials.y.z),this._activeEffect.setFloat3("vSphericalZ",polynomials.z.x,polynomials.z.y,polynomials.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",polynomials.xx.x-polynomials.zz.x,polynomials.xx.y-polynomials.zz.y,polynomials.xx.z-polynomials.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",polynomials.yy.x-polynomials.zz.x,polynomials.yy.y-polynomials.zz.y,polynomials.yy.z-polynomials.zz.z),this._activeEffect.setFloat3("vSphericalZZ",polynomials.zz.x,polynomials.zz.y,polynomials.zz.z),this._activeEffect.setFloat3("vSphericalXY",polynomials.xy.x,polynomials.xy.y,polynomials.xy.z),this._activeEffect.setFloat3("vSphericalYZ",polynomials.yz.x,polynomials.yz.y,polynomials.yz.z),this._activeEffect.setFloat3("vSphericalZX",polynomials.zx.x,polynomials.zx.y,polynomials.zx.z)),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",reflectionTexture.getSize().width,reflectionTexture.lodGenerationScale,reflectionTexture.lodGenerationOffset)}if(this._emissiveTexture&&BABYLON.StandardMaterial.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&BABYLON.StandardMaterial.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),BABYLON.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),BABYLON.MaterialHelper.BindTextureMatrix(this._metallicTexture,this._uniformBuffer,"reflectivity")):this._reflectivityTexture&&(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),BABYLON.MaterialHelper.BindTextureMatrix(this._reflectivityTexture,this._uniformBuffer,"reflectivity")),this._microSurfaceTexture&&(this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,this._uniformBuffer,"microSurfaceSampler"))),this._bumpTexture&&scene.getEngine().getCaps().standardDerivatives&&BABYLON.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),BABYLON.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),scene._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),refractionTexture&&BABYLON.StandardMaterial.RefractionTextureEnabled){this._uniformBuffer.updateMatrix("refractionMatrix",refractionTexture.getReflectionTextureMatrix());var depth=1;refractionTexture.isCube||refractionTexture.depth&&(depth=refractionTexture.depth),this._uniformBuffer.updateFloat4("vRefractionInfos",refractionTexture.level,this._indexOfRefraction,depth,this._invertRefractionY?-1:1),this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos",refractionTexture.getSize().width,refractionTexture.lodGenerationScale,refractionTexture.lodGenerationOffset)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),defines.METALLICWORKFLOW?(BABYLON.PBRMaterial._scaledReflectivity.r=void 0===this._metallic||null===this._metallic?1:this._metallic,BABYLON.PBRMaterial._scaledReflectivity.g=void 0===this._roughness||null===this._roughness?1:this._roughness,this._uniformBuffer.updateColor4("vReflectivityColor",BABYLON.PBRMaterial._scaledReflectivity,0)):this._uniformBuffer.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),this._uniformBuffer.updateColor3("vEmissiveColor",this._emissiveColor),this._uniformBuffer.updateColor3("vReflectionColor",this._reflectionColor),this._uniformBuffer.updateColor4("vAlbedoColor",this._albedoColor,this.alpha*mesh.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,this._uniformBuffer.updateVector4("vLightingIntensity",this._lightingInfos)}scene.texturesEnabled&&(this._albedoTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&BABYLON.StandardMaterial.AmbientTextureEnabled&&this._uniformBuffer.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&BABYLON.StandardMaterial.OpacityTextureEnabled&&this._uniformBuffer.setTexture("opacitySampler",this._opacityTexture),reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled&&(defines.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("reflectionSampler",reflectionTexture):(this._uniformBuffer.setTexture("reflectionSampler",reflectionTexture._lodTextureMid||reflectionTexture),this._uniformBuffer.setTexture("reflectionSamplerLow",reflectionTexture._lodTextureLow||reflectionTexture),this._uniformBuffer.setTexture("reflectionSamplerHigh",reflectionTexture._lodTextureHigh||reflectionTexture))),defines.ENVIRONMENTBRDF&&this._uniformBuffer.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),refractionTexture&&BABYLON.StandardMaterial.RefractionTextureEnabled&&(defines.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("refractionSampler",refractionTexture):(this._uniformBuffer.setTexture("refractionSampler",refractionTexture._lodTextureMid||refractionTexture),this._uniformBuffer.setTexture("refractionSamplerLow",refractionTexture._lodTextureLow||refractionTexture),this._uniformBuffer.setTexture("refractionSamplerHigh",refractionTexture._lodTextureHigh||refractionTexture))),this._emissiveTexture&&BABYLON.StandardMaterial.EmissiveTextureEnabled&&this._uniformBuffer.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&BABYLON.StandardMaterial.LightmapTextureEnabled&&this._uniformBuffer.setTexture("lightmapSampler",this._lightmapTexture),BABYLON.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?this._uniformBuffer.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&this._uniformBuffer.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&this._uniformBuffer.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&scene.getEngine().getCaps().standardDerivatives&&BABYLON.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&this._uniformBuffer.setTexture("bumpSampler",this._bumpTexture)),BABYLON.MaterialHelper.BindClipPlane(this._activeEffect,scene),scene.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var eyePosition=scene._forcedViewPosition?scene._forcedViewPosition:scene._mirroredCameraPosition?scene._mirroredCameraPosition:scene.activeCamera.globalPosition,invertNormal=scene.useRightHandedSystem===(null!=scene._mirroredCameraPosition);effect.setFloat4("vEyePosition",eyePosition.x,eyePosition.y,eyePosition.z,invertNormal?-1:1),effect.setColor3("vAmbientColor",this._globalAmbientColor)}!mustRebind&&this.isFrozen||(scene.lightsEnabled&&!this._disableLighting&&BABYLON.MaterialHelper.BindLights(scene,mesh,this._activeEffect,defines,this._maxSimultaneousLights,this._usePhysicalLightFalloff),(scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==BABYLON.Scene.FOGMODE_NONE||reflectionTexture)&&this.bindView(effect),BABYLON.MaterialHelper.BindFogParameters(scene,mesh,this._activeEffect),defines.NUM_MORPH_INFLUENCERS&&BABYLON.MaterialHelper.BindMorphTargetParameters(mesh,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),BABYLON.MaterialHelper.BindLogDepth(defines,this._activeEffect,scene)),this._uniformBuffer.update(),this._afterBind(mesh)}}},PBRBaseMaterial.prototype.getAnimatables=function(){var results=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&results.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&results.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&results.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&results.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&results.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?results.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&results.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&results.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&results.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&results.push(this._refractionTexture),results},PBRBaseMaterial.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},PBRBaseMaterial.prototype._getRefractionTexture=function(){return this._refractionTexture?this._refractionTexture:this._linkRefractionWithTransparency?this.getScene().environmentTexture:null},PBRBaseMaterial.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){forceDisposeTextures&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene()._environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),_super.prototype.dispose.call(this,forceDisposeEffect,forceDisposeTextures)},PBRBaseMaterial._scaledReflectivity=new BABYLON.Color3,__decorate([BABYLON.serializeAsImageProcessingConfiguration()],PBRBaseMaterial.prototype,"_imageProcessingConfiguration",void 0),__decorate([BABYLON.serialize()],PBRBaseMaterial.prototype,"useLogarithmicDepth",null),__decorate([BABYLON.serialize()],PBRBaseMaterial.prototype,"transparencyMode",null),PBRBaseMaterial}(BABYLON.PushMaterial);BABYLON.PBRBaseMaterial=PBRBaseMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var PBRBaseSimpleMaterial=function(_super){function PBRBaseSimpleMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.maxSimultaneousLights=4,_this.disableLighting=!1,_this.invertNormalMapX=!1,_this.invertNormalMapY=!1,_this.emissiveColor=new BABYLON.Color3(0,0,0),_this.occlusionStrength=1,_this.useLightmapAsShadowmap=!1,_this._useAlphaFromAlbedoTexture=!0,_this._useAmbientInGrayScale=!0,_this}return __extends(PBRBaseSimpleMaterial,_super),Object.defineProperty(PBRBaseSimpleMaterial.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(value){this._twoSidedLighting!==value&&(this._twoSidedLighting=value,this.backFaceCulling=!value,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),PBRBaseSimpleMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);return this.environmentTexture&&activeTextures.push(this.environmentTexture),this.normalTexture&&activeTextures.push(this.normalTexture),this.emissiveTexture&&activeTextures.push(this.emissiveTexture),this.occlusionTexture&&activeTextures.push(this.occlusionTexture),this.lightmapTexture&&activeTextures.push(this.lightmapTexture),activeTextures},PBRBaseSimpleMaterial.prototype.hasTexture=function(texture){return!!_super.prototype.hasTexture.call(this,texture)||this.lightmapTexture===texture},PBRBaseSimpleMaterial.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRBaseSimpleMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRBaseSimpleMaterial.prototype,"disableLighting",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],PBRBaseSimpleMaterial.prototype,"environmentTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRBaseSimpleMaterial.prototype,"invertNormalMapX",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRBaseSimpleMaterial.prototype,"invertNormalMapY",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],PBRBaseSimpleMaterial.prototype,"normalTexture",void 0),__decorate([BABYLON.serializeAsColor3("emissive"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRBaseSimpleMaterial.prototype,"emissiveColor",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRBaseSimpleMaterial.prototype,"emissiveTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],PBRBaseSimpleMaterial.prototype,"occlusionStrength",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],PBRBaseSimpleMaterial.prototype,"occlusionTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],PBRBaseSimpleMaterial.prototype,"alphaCutOff",void 0),__decorate([BABYLON.serialize()],PBRBaseSimpleMaterial.prototype,"doubleSided",null),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],PBRBaseSimpleMaterial.prototype,"lightmapTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRBaseSimpleMaterial.prototype,"useLightmapAsShadowmap",void 0),PBRBaseSimpleMaterial}(BABYLON.PBRBaseMaterial);Internals.PBRBaseSimpleMaterial=PBRBaseSimpleMaterial}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var PBRMaterial=function(_super){function PBRMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.directIntensity=1,_this.emissiveIntensity=1,_this.environmentIntensity=1,_this.specularIntensity=1,_this.disableBumpMap=!1,_this.ambientTextureStrength=1,_this.ambientColor=new BABYLON.Color3(0,0,0),_this.albedoColor=new BABYLON.Color3(1,1,1),_this.reflectivityColor=new BABYLON.Color3(1,1,1),_this.reflectionColor=new BABYLON.Color3(1,1,1),_this.emissiveColor=new BABYLON.Color3(0,0,0),_this.microSurface=1,_this.indexOfRefraction=.66,_this.invertRefractionY=!1,_this.linkRefractionWithTransparency=!1,_this.useLightmapAsShadowmap=!1,_this.useAlphaFromAlbedoTexture=!1,_this.forceAlphaTest=!1,_this.alphaCutOff=.4,_this.useSpecularOverAlpha=!0,_this.useMicroSurfaceFromReflectivityMapAlpha=!1,_this.useRoughnessFromMetallicTextureAlpha=!0,_this.useRoughnessFromMetallicTextureGreen=!1,_this.useMetallnessFromMetallicTextureBlue=!1,_this.useAmbientOcclusionFromMetallicTextureRed=!1,_this.useAmbientInGrayScale=!1,_this.useAutoMicroSurfaceFromReflectivityMap=!1,_this.usePhysicalLightFalloff=!0,_this.useRadianceOverAlpha=!0,_this.useParallax=!1,_this.useParallaxOcclusion=!1,_this.parallaxScaleBias=.05,_this.disableLighting=!1,_this.forceIrradianceInFragment=!1,_this.maxSimultaneousLights=4,_this.invertNormalMapX=!1,_this.invertNormalMapY=!1,_this.twoSidedLighting=!1,_this.useAlphaFresnel=!1,_this.useLinearAlphaFresnel=!1,_this.environmentBRDFTexture=null,_this.forceNormalForward=!1,_this.useHorizonOcclusion=!0,_this.useRadianceOcclusion=!0,_this._environmentBRDFTexture=BABYLON.TextureTools.GetEnvironmentBRDFTexture(scene),_this}return __extends(PBRMaterial,_super),Object.defineProperty(PBRMaterial,"PBRMATERIAL_OPAQUE",{get:function(){return this._PBRMATERIAL_OPAQUE},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial,"PBRMATERIAL_ALPHATEST",{get:function(){return this._PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial,"PBRMATERIAL_ALPHABLEND",{get:function(){return this._PBRMATERIAL_ALPHABLEND},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial,"PBRMATERIAL_ALPHATESTANDBLEND",{get:function(){return this._PBRMATERIAL_ALPHATESTANDBLEND},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(value){this._attachImageProcessingConfiguration(value),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(value){this.imageProcessingConfiguration.colorCurvesEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(value){this.imageProcessingConfiguration.colorGradingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(value){this._imageProcessingConfiguration.toneMappingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(value){this._imageProcessingConfiguration.exposure=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(value){this._imageProcessingConfiguration.contrast=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(value){this._imageProcessingConfiguration.colorGradingTexture=value},enumerable:!0,configurable:!0}),Object.defineProperty(PBRMaterial.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(value){this._imageProcessingConfiguration.colorCurves=value},enumerable:!0,configurable:!0}),PBRMaterial.prototype.getClassName=function(){return"PBRMaterial"},PBRMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);return this._albedoTexture&&activeTextures.push(this._albedoTexture),this._ambientTexture&&activeTextures.push(this._ambientTexture),this._opacityTexture&&activeTextures.push(this._opacityTexture),this._reflectionTexture&&activeTextures.push(this._reflectionTexture),this._emissiveTexture&&activeTextures.push(this._emissiveTexture),this._reflectivityTexture&&activeTextures.push(this._reflectivityTexture),this._metallicTexture&&activeTextures.push(this._metallicTexture),this._microSurfaceTexture&&activeTextures.push(this._microSurfaceTexture),this._bumpTexture&&activeTextures.push(this._bumpTexture),this._lightmapTexture&&activeTextures.push(this._lightmapTexture),this._refractionTexture&&activeTextures.push(this._refractionTexture),activeTextures},PBRMaterial.prototype.hasTexture=function(texture){return!!_super.prototype.hasTexture.call(this,texture)||(this._albedoTexture===texture||(this._ambientTexture===texture||(this._opacityTexture===texture||(this._reflectionTexture===texture||(this._reflectivityTexture===texture||(this._metallicTexture===texture||(this._microSurfaceTexture===texture||(this._bumpTexture===texture||(this._lightmapTexture===texture||this._refractionTexture===texture)))))))))},PBRMaterial.prototype.clone=function(name){var _this=this,clone=BABYLON.SerializationHelper.Clone(function(){return new PBRMaterial(name,_this.getScene())},this);return clone.id=name,clone.name=name,clone},PBRMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.PBRMaterial",serializationObject},PBRMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new PBRMaterial(source.name,scene)},source,scene,rootUrl)},PBRMaterial._PBRMATERIAL_OPAQUE=0,PBRMaterial._PBRMATERIAL_ALPHATEST=1,PBRMaterial._PBRMATERIAL_ALPHABLEND=2,PBRMaterial._PBRMATERIAL_ALPHATESTANDBLEND=3,__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"directIntensity",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveIntensity",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentIntensity",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"specularIntensity",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"disableBumpMap",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTextureStrength",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"opacityTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallic",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"roughness",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurfaceTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"bumpTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],PBRMaterial.prototype,"lightmapTexture",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"refractionTexture",void 0),__decorate([BABYLON.serializeAsColor3("ambient"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientColor",void 0),__decorate([BABYLON.serializeAsColor3("albedo"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoColor",void 0),__decorate([BABYLON.serializeAsColor3("reflectivity"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityColor",void 0),__decorate([BABYLON.serializeAsColor3("reflection"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionColor",void 0),__decorate([BABYLON.serializeAsColor3("emissive"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveColor",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurface",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"indexOfRefraction",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertRefractionY",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"linkRefractionWithTransparency",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLightmapAsShadowmap",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceAlphaTest",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"alphaCutOff",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useSpecularOverAlpha",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureGreen",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMetallnessFromMetallicTextureBlue",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientInGrayScale",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"usePhysicalLightFalloff",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOverAlpha",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallax",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallaxOcclusion",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"parallaxScaleBias",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"disableLighting",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceIrradianceInFragment",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapX",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapY",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"twoSidedLighting",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAlphaFresnel",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLinearAlphaFresnel",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentBRDFTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceNormalForward",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useHorizonOcclusion",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOcclusion",void 0),PBRMaterial}(BABYLON.PBRBaseMaterial);BABYLON.PBRMaterial=PBRMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var PBRMetallicRoughnessMaterial=function(_super){function PBRMetallicRoughnessMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this._useRoughnessFromMetallicTextureAlpha=!1,_this._useRoughnessFromMetallicTextureGreen=!0,_this._useMetallnessFromMetallicTextureBlue=!0,_this}return __extends(PBRMetallicRoughnessMaterial,_super),PBRMetallicRoughnessMaterial.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},PBRMetallicRoughnessMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);return this.baseTexture&&activeTextures.push(this.baseTexture),this.metallicRoughnessTexture&&activeTextures.push(this.metallicRoughnessTexture),activeTextures},PBRMetallicRoughnessMaterial.prototype.hasTexture=function(texture){return!!_super.prototype.hasTexture.call(this,texture)||(this.baseTexture===texture||this.metallicRoughnessTexture===texture)},PBRMetallicRoughnessMaterial.prototype.clone=function(name){var _this=this,clone=BABYLON.SerializationHelper.Clone(function(){return new PBRMetallicRoughnessMaterial(name,_this.getScene())},this);return clone.id=name,clone.name=name,clone},PBRMetallicRoughnessMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.PBRMetallicRoughnessMaterial",serializationObject},PBRMetallicRoughnessMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new PBRMetallicRoughnessMaterial(source.name,scene)},source,scene,rootUrl)},__decorate([BABYLON.serializeAsColor3(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],PBRMetallicRoughnessMaterial.prototype,"baseColor",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],PBRMetallicRoughnessMaterial.prototype,"baseTexture",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMetallicRoughnessMaterial.prototype,"metallic",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMetallicRoughnessMaterial.prototype,"roughness",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],PBRMetallicRoughnessMaterial.prototype,"metallicRoughnessTexture",void 0),PBRMetallicRoughnessMaterial}(BABYLON.Internals.PBRBaseSimpleMaterial);BABYLON.PBRMetallicRoughnessMaterial=PBRMetallicRoughnessMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var PBRSpecularGlossinessMaterial=function(_super){function PBRSpecularGlossinessMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this._useMicroSurfaceFromReflectivityMapAlpha=!0,_this}return __extends(PBRSpecularGlossinessMaterial,_super),PBRSpecularGlossinessMaterial.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},PBRSpecularGlossinessMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);return this.diffuseTexture&&activeTextures.push(this.diffuseTexture),this.specularGlossinessTexture&&activeTextures.push(this.specularGlossinessTexture),activeTextures},PBRSpecularGlossinessMaterial.prototype.hasTexture=function(texture){return!!_super.prototype.hasTexture.call(this,texture)||(this.diffuseTexture===texture||this.specularGlossinessTexture===texture)},PBRSpecularGlossinessMaterial.prototype.clone=function(name){var _this=this,clone=BABYLON.SerializationHelper.Clone(function(){return new PBRSpecularGlossinessMaterial(name,_this.getScene())},this);return clone.id=name,clone.name=name,clone},PBRSpecularGlossinessMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.PBRSpecularGlossinessMaterial",serializationObject},PBRSpecularGlossinessMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new PBRSpecularGlossinessMaterial(source.name,scene)},source,scene,rootUrl)},__decorate([BABYLON.serializeAsColor3("diffuse"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],PBRSpecularGlossinessMaterial.prototype,"diffuseColor",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],PBRSpecularGlossinessMaterial.prototype,"diffuseTexture",void 0),__decorate([BABYLON.serializeAsColor3("specular"),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],PBRSpecularGlossinessMaterial.prototype,"specularColor",void 0),__decorate([BABYLON.serialize(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_microSurface")],PBRSpecularGlossinessMaterial.prototype,"glossiness",void 0),__decorate([BABYLON.serializeAsTexture(),BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],PBRSpecularGlossinessMaterial.prototype,"specularGlossinessTexture",void 0),PBRSpecularGlossinessMaterial}(BABYLON.Internals.PBRBaseSimpleMaterial);BABYLON.PBRSpecularGlossinessMaterial=PBRSpecularGlossinessMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){BABYLON.CameraInputTypes={};var CameraInputsManager=function(){function CameraInputsManager(camera){this.attached={},this.camera=camera,this.checkInputs=function(){}}return CameraInputsManager.prototype.add=function(input){var type=input.getSimpleName();this.attached[type]?BABYLON.Tools.Warn("camera input of type "+type+" already exists on camera"):(this.attached[type]=input,input.camera=this.camera,input.checkInputs&&(this.checkInputs=this._addCheckInputs(input.checkInputs.bind(input))),this.attachedElement&&input.attachControl(this.attachedElement))},CameraInputsManager.prototype.remove=function(inputToRemove){for(var cam in this.attached){var input=this.attached[cam];input===inputToRemove&&(input.detachControl(this.attachedElement),input.camera=null,delete this.attached[cam],this.rebuildInputCheck())}},CameraInputsManager.prototype.removeByType=function(inputType){for(var cam in this.attached){var input=this.attached[cam];input.getClassName()===inputType&&(input.detachControl(this.attachedElement),input.camera=null,delete this.attached[cam],this.rebuildInputCheck())}},CameraInputsManager.prototype._addCheckInputs=function(fn){var current=this.checkInputs;return function(){current(),fn()}},CameraInputsManager.prototype.attachInput=function(input){this.attachedElement&&input.attachControl(this.attachedElement,this.noPreventDefault)},CameraInputsManager.prototype.attachElement=function(element,noPreventDefault){if(void 0===noPreventDefault&&(noPreventDefault=!1),!this.attachedElement){noPreventDefault=!BABYLON.Camera.ForceAttachControlToAlwaysPreventDefault&&noPreventDefault,this.attachedElement=element,this.noPreventDefault=noPreventDefault;for(var cam in this.attached)this.attached[cam].attachControl(element,noPreventDefault)}},CameraInputsManager.prototype.detachElement=function(element,disconnect){if(void 0===disconnect&&(disconnect=!1),this.attachedElement===element){for(var cam in this.attached)this.attached[cam].detachControl(element),disconnect&&(this.attached[cam].camera=null);this.attachedElement=null}},CameraInputsManager.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var cam in this.attached){var input=this.attached[cam];input.checkInputs&&(this.checkInputs=this._addCheckInputs(input.checkInputs.bind(input)))}},CameraInputsManager.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},CameraInputsManager.prototype.serialize=function(serializedCamera){var inputs={};for(var cam in this.attached){var input=this.attached[cam],res=BABYLON.SerializationHelper.Serialize(input);inputs[input.getClassName()]=res}serializedCamera.inputsmgr=inputs},CameraInputsManager.prototype.parse=function(parsedCamera){var parsedInputs=parsedCamera.inputsmgr;if(parsedInputs){this.clear();for(var n in parsedInputs)if(construct=BABYLON.CameraInputTypes[n]){var parsedinput=parsedInputs[n],input=BABYLON.SerializationHelper.Parse(function(){return new construct},parsedinput,null);this.add(input)}}else for(var n in this.attached){var construct=BABYLON.CameraInputTypes[this.attached[n].getClassName()];if(construct){input=BABYLON.SerializationHelper.Parse(function(){return new construct},parsedCamera,null);this.remove(this.attached[n]),this.add(input)}}},CameraInputsManager}();BABYLON.CameraInputsManager=CameraInputsManager}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraMouseInput=function(){function FreeCameraMouseInput(touchEnabled){void 0===touchEnabled&&(touchEnabled=!0),this.touchEnabled=touchEnabled,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return FreeCameraMouseInput.prototype.attachControl=function(element,noPreventDefault){var _this=this,engine=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(p,s){var evt=p.event;if(!engine.isInVRExclusivePointerMode&&(_this.touchEnabled||"touch"!==evt.pointerType)&&(p.type===BABYLON.PointerEventTypes.POINTERMOVE||-1!==_this.buttons.indexOf(evt.button))){var srcElement=evt.srcElement||evt.target;if(p.type===BABYLON.PointerEventTypes.POINTERDOWN&&srcElement){try{srcElement.setPointerCapture(evt.pointerId)}catch(e){}_this.previousPosition={x:evt.clientX,y:evt.clientY},noPreventDefault||(evt.preventDefault(),element.focus())}else if(p.type===BABYLON.PointerEventTypes.POINTERUP&&srcElement){try{srcElement.releasePointerCapture(evt.pointerId)}catch(e){}_this.previousPosition=null,noPreventDefault||evt.preventDefault()}else if(p.type===BABYLON.PointerEventTypes.POINTERMOVE){if(!_this.previousPosition||engine.isPointerLock)return;var offsetX=evt.clientX-_this.previousPosition.x,offsetY=evt.clientY-_this.previousPosition.y;_this.camera.getScene().useRightHandedSystem?_this.camera.cameraRotation.y-=offsetX/_this.angularSensibility:_this.camera.cameraRotation.y+=offsetX/_this.angularSensibility,_this.camera.cameraRotation.x+=offsetY/_this.angularSensibility,_this.previousPosition={x:evt.clientX,y:evt.clientY},noPreventDefault||evt.preventDefault()}}}),this._onMouseMove=function(evt){if(engine.isPointerLock&&!engine.isInVRExclusivePointerMode){var offsetX=evt.movementX||evt.mozMovementX||evt.webkitMovementX||evt.msMovementX||0,offsetY=evt.movementY||evt.mozMovementY||evt.webkitMovementY||evt.msMovementY||0;_this.camera.getScene().useRightHandedSystem?_this.camera.cameraRotation.y-=offsetX/_this.angularSensibility:_this.camera.cameraRotation.y+=offsetX/_this.angularSensibility,_this.camera.cameraRotation.x+=offsetY/_this.angularSensibility,_this.previousPosition=null,noPreventDefault||evt.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,BABYLON.PointerEventTypes.POINTERDOWN|BABYLON.PointerEventTypes.POINTERUP|BABYLON.PointerEventTypes.POINTERMOVE),element.addEventListener("mousemove",this._onMouseMove,!1)},FreeCameraMouseInput.prototype.detachControl=function(element){this._observer&&element&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&element.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},FreeCameraMouseInput.prototype.getClassName=function(){return"FreeCameraMouseInput"},FreeCameraMouseInput.prototype.getSimpleName=function(){return"mouse"},__decorate([BABYLON.serialize()],FreeCameraMouseInput.prototype,"buttons",void 0),__decorate([BABYLON.serialize()],FreeCameraMouseInput.prototype,"angularSensibility",void 0),FreeCameraMouseInput}();BABYLON.FreeCameraMouseInput=FreeCameraMouseInput,BABYLON.CameraInputTypes.FreeCameraMouseInput=FreeCameraMouseInput}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraKeyboardMoveInput=function(){function FreeCameraKeyboardMoveInput(){this._keys=new Array,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return FreeCameraKeyboardMoveInput.prototype.attachControl=function(element,noPreventDefault){var _this=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){_this._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(info){var evt=info.event;if(info.type===BABYLON.KeyboardEventTypes.KEYDOWN)-1===_this.keysUp.indexOf(evt.keyCode)&&-1===_this.keysDown.indexOf(evt.keyCode)&&-1===_this.keysLeft.indexOf(evt.keyCode)&&-1===_this.keysRight.indexOf(evt.keyCode)||(-1===(index=_this._keys.indexOf(evt.keyCode))&&_this._keys.push(evt.keyCode),noPreventDefault||evt.preventDefault());else if(-1!==_this.keysUp.indexOf(evt.keyCode)||-1!==_this.keysDown.indexOf(evt.keyCode)||-1!==_this.keysLeft.indexOf(evt.keyCode)||-1!==_this.keysRight.indexOf(evt.keyCode)){var index=_this._keys.indexOf(evt.keyCode);index>=0&&_this._keys.splice(index,1),noPreventDefault||evt.preventDefault()}}))},FreeCameraKeyboardMoveInput.prototype.detachControl=function(element){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},FreeCameraKeyboardMoveInput.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var camera=this.camera,index=0;index<this._keys.length;index++){var keyCode=this._keys[index],speed=camera._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(keyCode)?camera._localDirection.copyFromFloats(-speed,0,0):-1!==this.keysUp.indexOf(keyCode)?camera._localDirection.copyFromFloats(0,0,speed):-1!==this.keysRight.indexOf(keyCode)?camera._localDirection.copyFromFloats(speed,0,0):-1!==this.keysDown.indexOf(keyCode)&&camera._localDirection.copyFromFloats(0,0,-speed),camera.getScene().useRightHandedSystem&&(camera._localDirection.z*=-1),camera.getViewMatrix().invertToRef(camera._cameraTransformMatrix),BABYLON.Vector3.TransformNormalToRef(camera._localDirection,camera._cameraTransformMatrix,camera._transformedDirection),camera.cameraDirection.addInPlace(camera._transformedDirection)}},FreeCameraKeyboardMoveInput.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},FreeCameraKeyboardMoveInput.prototype._onLostFocus=function(e){this._keys=[]},FreeCameraKeyboardMoveInput.prototype.getSimpleName=function(){return"keyboard"},__decorate([BABYLON.serialize()],FreeCameraKeyboardMoveInput.prototype,"keysUp",void 0),__decorate([BABYLON.serialize()],FreeCameraKeyboardMoveInput.prototype,"keysDown",void 0),__decorate([BABYLON.serialize()],FreeCameraKeyboardMoveInput.prototype,"keysLeft",void 0),__decorate([BABYLON.serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRight",void 0),FreeCameraKeyboardMoveInput}();BABYLON.FreeCameraKeyboardMoveInput=FreeCameraKeyboardMoveInput,BABYLON.CameraInputTypes.FreeCameraKeyboardMoveInput=FreeCameraKeyboardMoveInput}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraInputsManager=function(_super){function FreeCameraInputsManager(camera){return _super.call(this,camera)||this}return __extends(FreeCameraInputsManager,_super),FreeCameraInputsManager.prototype.addKeyboard=function(){return this.add(new BABYLON.FreeCameraKeyboardMoveInput),this},FreeCameraInputsManager.prototype.addMouse=function(touchEnabled){return void 0===touchEnabled&&(touchEnabled=!0),this.add(new BABYLON.FreeCameraMouseInput(touchEnabled)),this},FreeCameraInputsManager.prototype.addGamepad=function(){return this.add(new BABYLON.FreeCameraGamepadInput),this},FreeCameraInputsManager.prototype.addDeviceOrientation=function(){return this.add(new BABYLON.FreeCameraDeviceOrientationInput),this},FreeCameraInputsManager.prototype.addTouch=function(){return this.add(new BABYLON.FreeCameraTouchInput),this},FreeCameraInputsManager.prototype.addVirtualJoystick=function(){return this.add(new BABYLON.FreeCameraVirtualJoystickInput),this},FreeCameraInputsManager}(BABYLON.CameraInputsManager);BABYLON.FreeCameraInputsManager=FreeCameraInputsManager}(BABYLON||(BABYLON={}));!function(BABYLON){var TargetCamera=function(_super){function TargetCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this.cameraDirection=new BABYLON.Vector3(0,0,0),_this.cameraRotation=new BABYLON.Vector2(0,0),_this.rotation=new BABYLON.Vector3(0,0,0),_this.speed=2,_this.noRotationConstraint=!1,_this.lockedTarget=null,_this._currentTarget=BABYLON.Vector3.Zero(),_this._viewMatrix=BABYLON.Matrix.Zero(),_this._camMatrix=BABYLON.Matrix.Zero(),_this._cameraTransformMatrix=BABYLON.Matrix.Zero(),_this._cameraRotationMatrix=BABYLON.Matrix.Zero(),_this._referencePoint=new BABYLON.Vector3(0,0,1),_this._currentUpVector=new BABYLON.Vector3(0,1,0),_this._transformedReferencePoint=BABYLON.Vector3.Zero(),_this._lookAtTemp=BABYLON.Matrix.Zero(),_this._tempMatrix=BABYLON.Matrix.Zero(),_this}return __extends(TargetCamera,_super),TargetCamera.prototype.getFrontPosition=function(distance){var direction=this.getTarget().subtract(this.position);return direction.normalize(),direction.scaleInPlace(distance),this.globalPosition.add(direction)},TargetCamera.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},TargetCamera.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),_super.prototype.storeState.call(this)},TargetCamera.prototype._restoreStateValues=function(){return!!_super.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},TargetCamera.prototype._initCache=function(){_super.prototype._initCache.call(this),this._cache.lockedTarget=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new BABYLON.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},TargetCamera.prototype._updateCache=function(ignoreParentClass){ignoreParentClass||_super.prototype._updateCache.call(this);var lockedTargetPosition=this._getLockedTargetPosition();lockedTargetPosition?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(lockedTargetPosition):this._cache.lockedTarget=lockedTargetPosition.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},TargetCamera.prototype._isSynchronizedViewMatrix=function(){if(!_super.prototype._isSynchronizedViewMatrix.call(this))return!1;var lockedTargetPosition=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(lockedTargetPosition):!lockedTargetPosition)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},TargetCamera.prototype._computeLocalCameraSpeed=function(){var engine=this.getEngine();return this.speed*Math.sqrt(engine.getDeltaTime()/(100*engine.getFps()))},TargetCamera.prototype.setTarget=function(target){this.upVector.normalize(),BABYLON.Matrix.LookAtLHToRef(this.position,target,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var vDir=target.subtract(this.position);vDir.x>=0?this.rotation.y=-Math.atan(vDir.z/vDir.x)+Math.PI/2:this.rotation.y=-Math.atan(vDir.z/vDir.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&BABYLON.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},TargetCamera.prototype.getTarget=function(){return this._currentTarget},TargetCamera.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},TargetCamera.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(BABYLON.Tmp.Matrix[0]),BABYLON.Vector3.TransformNormalToRef(this.cameraDirection,BABYLON.Tmp.Matrix[0],BABYLON.Tmp.Vector3[0]),void this.position.addInPlace(BABYLON.Tmp.Vector3[0]);this.position.addInPlace(this.cameraDirection)},TargetCamera.prototype._checkInputs=function(){var needToMove=this._decideIfNeedsToMove(),needToRotate=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(needToMove&&this._updatePosition(),needToRotate&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion&&this.rotation.lengthSquared()&&BABYLON.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),!this.noRotationConstraint)){var limit=Math.PI/2*.95;this.rotation.x>limit&&(this.rotation.x=limit),this.rotation.x<-limit&&(this.rotation.x=-limit)}needToMove&&(Math.abs(this.cameraDirection.x)<this.speed*BABYLON.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*BABYLON.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*BABYLON.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),needToRotate&&(Math.abs(this.cameraRotation.x)<this.speed*BABYLON.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*BABYLON.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),_super.prototype._checkInputs.call(this)},TargetCamera.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):BABYLON.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),BABYLON.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._currentUpVector)},TargetCamera.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.getScene().useRightHandedSystem?BABYLON.Matrix.LookAtRHToRef(this.position,this._currentTarget,this._currentUpVector,this._viewMatrix):BABYLON.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._currentUpVector,this._viewMatrix),this._viewMatrix},TargetCamera.prototype.createRigCamera=function(name,cameraIndex){if(this.cameraRigMode!==BABYLON.Camera.RIG_MODE_NONE){var rigCamera=new TargetCamera(name,this.position.clone(),this.getScene());return this.cameraRigMode!==BABYLON.Camera.RIG_MODE_VR&&this.cameraRigMode!==BABYLON.Camera.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new BABYLON.Quaternion),rigCamera._cameraRigParams={},rigCamera.rotationQuaternion=new BABYLON.Quaternion),rigCamera}return null},TargetCamera.prototype._updateRigCameras=function(){var camLeft=this._rigCameras[0],camRight=this._rigCameras[1];switch(this.cameraRigMode){case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var leftSign=this.cameraRigMode===BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,rightSign=this.cameraRigMode===BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*leftSign,camLeft.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*rightSign,camRight.position),camLeft.setTarget(this.getTarget()),camRight.setTarget(this.getTarget());break;case BABYLON.Camera.RIG_MODE_VR:camLeft.rotationQuaternion?(camLeft.rotationQuaternion.copyFrom(this.rotationQuaternion),camRight.rotationQuaternion.copyFrom(this.rotationQuaternion)):(camLeft.rotation.copyFrom(this.rotation),camRight.rotation.copyFrom(this.rotation)),camLeft.position.copyFrom(this.position),camRight.position.copyFrom(this.position)}_super.prototype._updateRigCameras.call(this)},TargetCamera.prototype._getRigCamPosition=function(halfSpace,result){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new BABYLON.Matrix);var target=this.getTarget();BABYLON.Matrix.Translation(-target.x,-target.y,-target.z).multiplyToRef(BABYLON.Matrix.RotationY(halfSpace),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(BABYLON.Matrix.Translation(target.x,target.y,target.z)),BABYLON.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,result)},TargetCamera.prototype.getClassName=function(){return"TargetCamera"},__decorate([BABYLON.serializeAsVector3()],TargetCamera.prototype,"rotation",void 0),__decorate([BABYLON.serialize()],TargetCamera.prototype,"speed",void 0),__decorate([BABYLON.serializeAsMeshReference("lockedTargetId")],TargetCamera.prototype,"lockedTarget",void 0),TargetCamera}(BABYLON.Camera);BABYLON.TargetCamera=TargetCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCamera=function(_super){function FreeCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this.ellipsoid=new BABYLON.Vector3(.5,1,.5),_this.ellipsoidOffset=new BABYLON.Vector3(0,0,0),_this.checkCollisions=!1,_this.applyGravity=!1,_this._needMoveForGravity=!1,_this._oldPosition=BABYLON.Vector3.Zero(),_this._diffPosition=BABYLON.Vector3.Zero(),_this._newPosition=BABYLON.Vector3.Zero(),_this._collisionMask=-1,_this._onCollisionPositionChange=function(collisionId,newPosition,collidedMesh){void 0===collidedMesh&&(collidedMesh=null),_this.getScene().workerCollisions&&newPosition.multiplyInPlace(_this._collider._radius);!function(newPos){_this._newPosition.copyFrom(newPos),_this._newPosition.subtractToRef(_this._oldPosition,_this._diffPosition),_this._diffPosition.length()>BABYLON.Engine.CollisionsEpsilon&&(_this.position.addInPlace(_this._diffPosition),_this.onCollide&&collidedMesh&&_this.onCollide(collidedMesh))}(newPosition)},_this.inputs=new BABYLON.FreeCameraInputsManager(_this),_this.inputs.addKeyboard().addMouse(),_this}return __extends(FreeCamera,_super),Object.defineProperty(FreeCamera.prototype,"angularSensibility",{get:function(){var mouse=this.inputs.attached.mouse;return mouse?mouse.angularSensibility:0},set:function(value){var mouse=this.inputs.attached.mouse;mouse&&(mouse.angularSensibility=value)},enumerable:!0,configurable:!0}),Object.defineProperty(FreeCamera.prototype,"keysUp",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysUp:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysUp=value)},enumerable:!0,configurable:!0}),Object.defineProperty(FreeCamera.prototype,"keysDown",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysDown:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysDown=value)},enumerable:!0,configurable:!0}),Object.defineProperty(FreeCamera.prototype,"keysLeft",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysLeft:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysLeft=value)},enumerable:!0,configurable:!0}),Object.defineProperty(FreeCamera.prototype,"keysRight",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysRight:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysRight=value)},enumerable:!0,configurable:!0}),FreeCamera.prototype.attachControl=function(element,noPreventDefault){this.inputs.attachElement(element,noPreventDefault)},FreeCamera.prototype.detachControl=function(element){this.inputs.detachElement(element),this.cameraDirection=new BABYLON.Vector3(0,0,0),this.cameraRotation=new BABYLON.Vector2(0,0)},Object.defineProperty(FreeCamera.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(mask){this._collisionMask=isNaN(mask)?-1:mask},enumerable:!0,configurable:!0}),FreeCamera.prototype._collideWithWorld=function(displacement){(this.parent?BABYLON.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new BABYLON.Collider),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var actualDisplacement=displacement;this.applyGravity&&(actualDisplacement=displacement.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,actualDisplacement,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},FreeCamera.prototype._checkInputs=function(){this._localDirection||(this._localDirection=BABYLON.Vector3.Zero(),this._transformedDirection=BABYLON.Vector3.Zero()),this.inputs.checkInputs(),_super.prototype._checkInputs.call(this)},FreeCamera.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},FreeCamera.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):_super.prototype._updatePosition.call(this)},FreeCamera.prototype.dispose=function(){this.inputs.clear(),_super.prototype.dispose.call(this)},FreeCamera.prototype.getClassName=function(){return"FreeCamera"},__decorate([BABYLON.serializeAsVector3()],FreeCamera.prototype,"ellipsoid",void 0),__decorate([BABYLON.serializeAsVector3()],FreeCamera.prototype,"ellipsoidOffset",void 0),__decorate([BABYLON.serialize()],FreeCamera.prototype,"checkCollisions",void 0),__decorate([BABYLON.serialize()],FreeCamera.prototype,"applyGravity",void 0),FreeCamera}(BABYLON.TargetCamera);BABYLON.FreeCamera=FreeCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraKeyboardMoveInput=function(){function ArcRotateCameraKeyboardMoveInput(){this._keys=new Array,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0}return ArcRotateCameraKeyboardMoveInput.prototype.attachControl=function(element,noPreventDefault){var _this=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){_this._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(info){var evt=info.event;if(info.type===BABYLON.KeyboardEventTypes.KEYDOWN)_this._ctrlPressed=evt.ctrlKey,_this._altPressed=evt.altKey,-1===_this.keysUp.indexOf(evt.keyCode)&&-1===_this.keysDown.indexOf(evt.keyCode)&&-1===_this.keysLeft.indexOf(evt.keyCode)&&-1===_this.keysRight.indexOf(evt.keyCode)&&-1===_this.keysReset.indexOf(evt.keyCode)||(-1===(index=_this._keys.indexOf(evt.keyCode))&&_this._keys.push(evt.keyCode),evt.preventDefault&&(noPreventDefault||evt.preventDefault()));else if(-1!==_this.keysUp.indexOf(evt.keyCode)||-1!==_this.keysDown.indexOf(evt.keyCode)||-1!==_this.keysLeft.indexOf(evt.keyCode)||-1!==_this.keysRight.indexOf(evt.keyCode)||-1!==_this.keysReset.indexOf(evt.keyCode)){var index=_this._keys.indexOf(evt.keyCode);index>=0&&_this._keys.splice(index,1),evt.preventDefault&&(noPreventDefault||evt.preventDefault())}}))},ArcRotateCameraKeyboardMoveInput.prototype.detachControl=function(element){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},ArcRotateCameraKeyboardMoveInput.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var camera=this.camera,index=0;index<this._keys.length;index++){var keyCode=this._keys[index];-1!==this.keysLeft.indexOf(keyCode)?this._ctrlPressed&&this.camera._useCtrlForPanning?camera.inertialPanningX-=1/this.panningSensibility:camera.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(keyCode)?this._ctrlPressed&&this.camera._useCtrlForPanning?camera.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?camera.inertialRadiusOffset+=1/this.zoomingSensibility:camera.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(keyCode)?this._ctrlPressed&&this.camera._useCtrlForPanning?camera.inertialPanningX+=1/this.panningSensibility:camera.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(keyCode)?this._ctrlPressed&&this.camera._useCtrlForPanning?camera.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?camera.inertialRadiusOffset-=1/this.zoomingSensibility:camera.inertialBetaOffset+=.01:-1!==this.keysReset.indexOf(keyCode)&&camera.restoreState()}},ArcRotateCameraKeyboardMoveInput.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},ArcRotateCameraKeyboardMoveInput.prototype.getSimpleName=function(){return"keyboard"},__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysUp",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysDown",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysLeft",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysRight",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"keysReset",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"panningSensibility",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"zoomingSensibility",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraKeyboardMoveInput.prototype,"useAltToZoom",void 0),ArcRotateCameraKeyboardMoveInput}();BABYLON.ArcRotateCameraKeyboardMoveInput=ArcRotateCameraKeyboardMoveInput,BABYLON.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=ArcRotateCameraKeyboardMoveInput}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraMouseWheelInput=function(){function ArcRotateCameraMouseWheelInput(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return ArcRotateCameraMouseWheelInput.prototype.attachControl=function(element,noPreventDefault){var _this=this;this._wheel=function(p,s){if(p.type===BABYLON.PointerEventTypes.POINTERWHEEL){var event=p.event,delta=0;event.wheelDelta?delta=_this.wheelDeltaPercentage?.01*event.wheelDelta*_this.camera.radius*_this.wheelDeltaPercentage:event.wheelDelta/(40*_this.wheelPrecision):event.detail&&(delta=-event.detail/_this.wheelPrecision),delta&&(_this.camera.inertialRadiusOffset+=delta),event.preventDefault&&(noPreventDefault||event.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,BABYLON.PointerEventTypes.POINTERWHEEL)},ArcRotateCameraMouseWheelInput.prototype.detachControl=function(element){this._observer&&element&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},ArcRotateCameraMouseWheelInput.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},ArcRotateCameraMouseWheelInput.prototype.getSimpleName=function(){return"mousewheel"},__decorate([BABYLON.serialize()],ArcRotateCameraMouseWheelInput.prototype,"wheelPrecision",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraMouseWheelInput.prototype,"wheelDeltaPercentage",void 0),ArcRotateCameraMouseWheelInput}();BABYLON.ArcRotateCameraMouseWheelInput=ArcRotateCameraMouseWheelInput,BABYLON.CameraInputTypes.ArcRotateCameraMouseWheelInput=ArcRotateCameraMouseWheelInput}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraPointersInput=function(){function ArcRotateCameraPointersInput(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this._isPanClick=!1,this.pinchInwards=!0}return ArcRotateCameraPointersInput.prototype.attachControl=function(element,noPreventDefault){var cacheSoloPointer,_this=this,engine=this.camera.getEngine(),pointA=null,pointB=null,previousPinchSquaredDistance=0,initialDistance=0,twoFingerActivityCount=0,previousMultiTouchPanPosition={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(p,s){var evt=p.event,isTouch="touch"===p.event.pointerType;if(!engine.isInVRExclusivePointerMode&&(p.type===BABYLON.PointerEventTypes.POINTERMOVE||-1!==_this.buttons.indexOf(evt.button))){var srcElement=evt.srcElement||evt.target;if(p.type===BABYLON.PointerEventTypes.POINTERDOWN&&srcElement){try{srcElement.setPointerCapture(evt.pointerId)}catch(e){}_this._isPanClick=evt.button===_this.camera._panningMouseButton,cacheSoloPointer={x:evt.clientX,y:evt.clientY,pointerId:evt.pointerId,type:evt.pointerType},null===pointA?pointA=cacheSoloPointer:null===pointB&&(pointB=cacheSoloPointer),noPreventDefault||(evt.preventDefault(),element.focus())}else if(p.type===BABYLON.PointerEventTypes.POINTERDOUBLETAP)_this.camera.restoreState();else if(p.type===BABYLON.PointerEventTypes.POINTERUP&&srcElement){try{srcElement.releasePointerCapture(evt.pointerId)}catch(e){}cacheSoloPointer=null,previousPinchSquaredDistance=0,previousMultiTouchPanPosition.isPaning=!1,previousMultiTouchPanPosition.isPinching=!1,twoFingerActivityCount=0,initialDistance=0,isTouch||(pointB=null),engine.badOS?pointA=pointB=null:pointB&&pointA&&pointA.pointerId==evt.pointerId?(pointA=pointB,pointB=null,cacheSoloPointer={x:pointA.x,y:pointA.y,pointerId:pointA.pointerId,type:evt.pointerType}):pointA&&pointB&&pointB.pointerId==evt.pointerId?(pointB=null,cacheSoloPointer={x:pointA.x,y:pointA.y,pointerId:pointA.pointerId,type:evt.pointerType}):pointA=pointB=null,noPreventDefault||evt.preventDefault()}else if(p.type===BABYLON.PointerEventTypes.POINTERMOVE)if(noPreventDefault||evt.preventDefault(),pointA&&null===pointB&&cacheSoloPointer){if(0!==_this.panningSensibility&&(evt.ctrlKey&&_this.camera._useCtrlForPanning||_this._isPanClick))_this.camera.inertialPanningX+=-(evt.clientX-cacheSoloPointer.x)/_this.panningSensibility,_this.camera.inertialPanningY+=(evt.clientY-cacheSoloPointer.y)/_this.panningSensibility;else{var offsetX=evt.clientX-cacheSoloPointer.x,offsetY=evt.clientY-cacheSoloPointer.y;_this.camera.inertialAlphaOffset-=offsetX/_this.angularSensibilityX,_this.camera.inertialBetaOffset-=offsetY/_this.angularSensibilityY}cacheSoloPointer.x=evt.clientX,cacheSoloPointer.y=evt.clientY}else if(pointA&&pointB){var ed=pointA.pointerId===evt.pointerId?pointA:pointB;ed.x=evt.clientX,ed.y=evt.clientY;var direction=_this.pinchInwards?1:-1,distX=pointA.x-pointB.x,distY=pointA.y-pointB.y,pinchSquaredDistance=distX*distX+distY*distY,pinchDistance=Math.sqrt(pinchSquaredDistance);if(0===previousPinchSquaredDistance)return initialDistance=pinchDistance,previousPinchSquaredDistance=pinchSquaredDistance,previousMultiTouchPanPosition.x=(pointA.x+pointB.x)/2,void(previousMultiTouchPanPosition.y=(pointA.y+pointB.y)/2);if(_this.multiTouchPanAndZoom){if(_this.pinchDeltaPercentage?_this.camera.inertialRadiusOffset+=.001*(pinchSquaredDistance-previousPinchSquaredDistance)*_this.camera.radius*_this.pinchDeltaPercentage:_this.camera.inertialRadiusOffset+=(pinchSquaredDistance-previousPinchSquaredDistance)/(_this.pinchPrecision*((_this.angularSensibilityX+_this.angularSensibilityY)/2)*direction),0!==_this.panningSensibility){var pointersCenterX=(pointA.x+pointB.x)/2,pointersCenterY=(pointA.y+pointB.y)/2,pointersCenterDistX=pointersCenterX-previousMultiTouchPanPosition.x,pointersCenterDistY=pointersCenterY-previousMultiTouchPanPosition.y;previousMultiTouchPanPosition.x=pointersCenterX,previousMultiTouchPanPosition.y=pointersCenterY,_this.camera.inertialPanningX+=-pointersCenterDistX/_this.panningSensibility,_this.camera.inertialPanningY+=pointersCenterDistY/_this.panningSensibility}}else{if(twoFingerActivityCount++,previousMultiTouchPanPosition.isPinching||twoFingerActivityCount<20&&Math.abs(pinchDistance-initialDistance)>_this.camera.pinchToPanMaxDistance)_this.pinchDeltaPercentage?_this.camera.inertialRadiusOffset+=.001*(pinchSquaredDistance-previousPinchSquaredDistance)*_this.camera.radius*_this.pinchDeltaPercentage:_this.camera.inertialRadiusOffset+=(pinchSquaredDistance-previousPinchSquaredDistance)/(_this.pinchPrecision*((_this.angularSensibilityX+_this.angularSensibilityY)/2)*direction),previousMultiTouchPanPosition.isPaning=!1,previousMultiTouchPanPosition.isPinching=!0;else if(cacheSoloPointer&&cacheSoloPointer.pointerId===ed.pointerId&&0!==_this.panningSensibility&&_this.multiTouchPanning){if(!previousMultiTouchPanPosition.isPaning)return previousMultiTouchPanPosition.isPaning=!0,previousMultiTouchPanPosition.isPinching=!1,previousMultiTouchPanPosition.x=ed.x,void(previousMultiTouchPanPosition.y=ed.y);_this.camera.inertialPanningX+=-(ed.x-previousMultiTouchPanPosition.x)/_this.panningSensibility,_this.camera.inertialPanningY+=(ed.y-previousMultiTouchPanPosition.y)/_this.panningSensibility}cacheSoloPointer&&cacheSoloPointer.pointerId===evt.pointerId&&(previousMultiTouchPanPosition.x=ed.x,previousMultiTouchPanPosition.y=ed.y)}previousPinchSquaredDistance=pinchSquaredDistance}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,BABYLON.PointerEventTypes.POINTERDOWN|BABYLON.PointerEventTypes.POINTERUP|BABYLON.PointerEventTypes.POINTERMOVE|BABYLON.PointerEventTypes._POINTERDOUBLETAP),this._onContextMenu=function(evt){evt.preventDefault()},this.camera._useCtrlForPanning||element.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){pointA=pointB=null,previousPinchSquaredDistance=0,previousMultiTouchPanPosition.isPaning=!1,previousMultiTouchPanPosition.isPinching=!1,twoFingerActivityCount=0,cacheSoloPointer=null,initialDistance=0},this._onMouseMove=function(evt){if(engine.isPointerLock){var offsetX=evt.movementX||evt.mozMovementX||evt.webkitMovementX||evt.msMovementX||0,offsetY=evt.movementY||evt.mozMovementY||evt.webkitMovementY||evt.msMovementY||0;_this.camera.inertialAlphaOffset-=offsetX/_this.angularSensibilityX,_this.camera.inertialBetaOffset-=offsetY/_this.angularSensibilityY,noPreventDefault||evt.preventDefault()}},this._onGestureStart=function(e){void 0!==window.MSGesture&&(_this._MSGestureHandler||(_this._MSGestureHandler=new MSGesture,_this._MSGestureHandler.target=element),_this._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){_this.camera.radius*=e.scale,e.preventDefault&&(noPreventDefault||(e.stopPropagation(),e.preventDefault()))},element.addEventListener("mousemove",this._onMouseMove,!1),element.addEventListener("MSPointerDown",this._onGestureStart,!1),element.addEventListener("MSGestureChange",this._onGesture,!1),BABYLON.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},ArcRotateCameraPointersInput.prototype.detachControl=function(element){this._onLostFocus&&BABYLON.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),element&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&element.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&element.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&element.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&element.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},ArcRotateCameraPointersInput.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},ArcRotateCameraPointersInput.prototype.getSimpleName=function(){return"pointers"},__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"buttons",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"angularSensibilityX",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"angularSensibilityY",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"pinchPrecision",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"pinchDeltaPercentage",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"panningSensibility",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"multiTouchPanning",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraPointersInput.prototype,"multiTouchPanAndZoom",void 0),ArcRotateCameraPointersInput}();BABYLON.ArcRotateCameraPointersInput=ArcRotateCameraPointersInput,BABYLON.CameraInputTypes.ArcRotateCameraPointersInput=ArcRotateCameraPointersInput}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCamera=function(_super){function ArcRotateCamera(name,alpha,beta,radius,target,scene){var _this=_super.call(this,name,BABYLON.Vector3.Zero(),scene)||this;return _this.inertialAlphaOffset=0,_this.inertialBetaOffset=0,_this.inertialRadiusOffset=0,_this.lowerAlphaLimit=null,_this.upperAlphaLimit=null,_this.lowerBetaLimit=.01,_this.upperBetaLimit=Math.PI,_this.lowerRadiusLimit=null,_this.upperRadiusLimit=null,_this.inertialPanningX=0,_this.inertialPanningY=0,_this.pinchToPanMaxDistance=20,_this.panningDistanceLimit=null,_this.panningOriginTarget=BABYLON.Vector3.Zero(),_this.panningInertia=.9,_this.zoomOnFactor=1,_this.targetScreenOffset=BABYLON.Vector2.Zero(),_this.allowUpsideDown=!0,_this._viewMatrix=new BABYLON.Matrix,_this.panningAxis=new BABYLON.Vector3(1,1,0),_this.onMeshTargetChangedObservable=new BABYLON.Observable,_this.checkCollisions=!1,_this.collisionRadius=new BABYLON.Vector3(.5,.5,.5),_this._previousPosition=BABYLON.Vector3.Zero(),_this._collisionVelocity=BABYLON.Vector3.Zero(),_this._newPosition=BABYLON.Vector3.Zero(),_this._onCollisionPositionChange=function(collisionId,newPosition,collidedMesh){void 0===collidedMesh&&(collidedMesh=null),_this.getScene().workerCollisions&&_this.checkCollisions&&newPosition.multiplyInPlace(_this._collider._radius),collidedMesh?(_this.setPosition(newPosition),_this.onCollide&&_this.onCollide(collidedMesh)):_this._previousPosition.copyFrom(_this.position);var cosa=Math.cos(_this.alpha),sina=Math.sin(_this.alpha),cosb=Math.cos(_this.beta),sinb=Math.sin(_this.beta);0===sinb&&(sinb=1e-4);var target=_this._getTargetPosition();target.addToRef(new BABYLON.Vector3(_this.radius*cosa*sinb,_this.radius*cosb,_this.radius*sina*sinb),_this._newPosition),_this.position.copyFrom(_this._newPosition);var up=_this.upVector;_this.allowUpsideDown&&_this.beta<0&&(up=(up=up.clone()).negate()),BABYLON.Matrix.LookAtLHToRef(_this.position,target,up,_this._viewMatrix),_this._viewMatrix.m[12]+=_this.targetScreenOffset.x,_this._viewMatrix.m[13]+=_this.targetScreenOffset.y,_this._collisionTriggered=!1},_this._target=BABYLON.Vector3.Zero(),target&&_this.setTarget(target),_this.alpha=alpha,_this.beta=beta,_this.radius=radius,_this.getViewMatrix(),_this.inputs=new BABYLON.ArcRotateCameraInputsManager(_this),_this.inputs.addKeyboard().addMouseWheel().addPointers(),_this}return __extends(ArcRotateCamera,_super),Object.defineProperty(ArcRotateCamera.prototype,"target",{get:function(){return this._target},set:function(value){this.setTarget(value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"angularSensibilityX",{get:function(){var pointers=this.inputs.attached.pointers;return pointers?pointers.angularSensibilityX:0},set:function(value){var pointers=this.inputs.attached.pointers;pointers&&(pointers.angularSensibilityX=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"angularSensibilityY",{get:function(){var pointers=this.inputs.attached.pointers;return pointers?pointers.angularSensibilityY:0},set:function(value){var pointers=this.inputs.attached.pointers;pointers&&(pointers.angularSensibilityY=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"pinchPrecision",{get:function(){var pointers=this.inputs.attached.pointers;return pointers?pointers.pinchPrecision:0},set:function(value){var pointers=this.inputs.attached.pointers;pointers&&(pointers.pinchPrecision=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"pinchDeltaPercentage",{get:function(){var pointers=this.inputs.attached.pointers;return pointers?pointers.pinchDeltaPercentage:0},set:function(value){var pointers=this.inputs.attached.pointers;pointers&&(pointers.pinchDeltaPercentage=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"panningSensibility",{get:function(){var pointers=this.inputs.attached.pointers;return pointers?pointers.panningSensibility:0},set:function(value){var pointers=this.inputs.attached.pointers;pointers&&(pointers.panningSensibility=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"keysUp",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysUp:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysUp=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"keysDown",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysDown:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysDown=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"keysLeft",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysLeft:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysLeft=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"keysRight",{get:function(){var keyboard=this.inputs.attached.keyboard;return keyboard?keyboard.keysRight:[]},set:function(value){var keyboard=this.inputs.attached.keyboard;keyboard&&(keyboard.keysRight=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"wheelPrecision",{get:function(){var mousewheel=this.inputs.attached.mousewheel;return mousewheel?mousewheel.wheelPrecision:0},set:function(value){var mousewheel=this.inputs.attached.mousewheel;mousewheel&&(mousewheel.wheelPrecision=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"wheelDeltaPercentage",{get:function(){var mousewheel=this.inputs.attached.mousewheel;return mousewheel?mousewheel.wheelDeltaPercentage:0},set:function(value){var mousewheel=this.inputs.attached.mousewheel;mousewheel&&(mousewheel.wheelDeltaPercentage=value)},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(value){value!==this.useBouncingBehavior&&(value?(this._bouncingBehavior=new BABYLON.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(value){value!==this.useFramingBehavior&&(value?(this._framingBehavior=new BABYLON.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(ArcRotateCamera.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(value){value!==this.useAutoRotationBehavior&&(value?(this._autoRotationBehavior=new BABYLON.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),ArcRotateCamera.prototype._initCache=function(){_super.prototype._initCache.call(this),this._cache._target=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=BABYLON.Vector2.Zero()},ArcRotateCamera.prototype._updateCache=function(ignoreParentClass){ignoreParentClass||_super.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},ArcRotateCamera.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var pos=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?pos.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(pos)}var lockedTargetPosition=this._getLockedTargetPosition();return lockedTargetPosition||this._target},ArcRotateCamera.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),_super.prototype.storeState.call(this)},ArcRotateCamera.prototype._restoreStateValues=function(){return!!_super.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},ArcRotateCamera.prototype._isSynchronizedViewMatrix=function(){return!!_super.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},ArcRotateCamera.prototype.attachControl=function(element,noPreventDefault,useCtrlForPanning,panningMouseButton){var _this=this;void 0===useCtrlForPanning&&(useCtrlForPanning=!0),void 0===panningMouseButton&&(panningMouseButton=2),this._useCtrlForPanning=useCtrlForPanning,this._panningMouseButton=panningMouseButton,this.inputs.attachElement(element,noPreventDefault),this._reset=function(){_this.inertialAlphaOffset=0,_this.inertialBetaOffset=0,_this.inertialRadiusOffset=0,_this.inertialPanningX=0,_this.inertialPanningY=0}},ArcRotateCamera.prototype.detachControl=function(element){this.inputs.detachElement(element),this._reset&&this._reset()},ArcRotateCamera.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.getScene().useRightHandedSystem?this.alpha-=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset:this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<BABYLON.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<BABYLON.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*BABYLON.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=BABYLON.Vector3.Zero(),this._transformedDirection=BABYLON.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),BABYLON.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),BABYLON.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*BABYLON.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*BABYLON.Epsilon&&(this.inertialPanningY=0)),this._checkLimits(),_super.prototype._checkInputs.call(this))},ArcRotateCamera.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},ArcRotateCamera.prototype.rebuildAnglesAndRadius=function(){var radiusv3=this.position.subtract(this._getTargetPosition());this.radius=radiusv3.length(),0===this.radius&&(this.radius=1e-4),this.alpha=Math.acos(radiusv3.x/Math.sqrt(Math.pow(radiusv3.x,2)+Math.pow(radiusv3.z,2))),radiusv3.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(radiusv3.y/this.radius),this._checkLimits()},ArcRotateCamera.prototype.setPosition=function(position){this.position.equals(position)||(this.position.copyFrom(position),this.rebuildAnglesAndRadius())},ArcRotateCamera.prototype.setTarget=function(target,toBoundingCenter,allowSamePosition){if(void 0===toBoundingCenter&&(toBoundingCenter=!1),void 0===allowSamePosition&&(allowSamePosition=!1),target.getBoundingInfo)this._targetBoundingCenter=toBoundingCenter?target.getBoundingInfo().boundingBox.centerWorld.clone():null,this._targetHost=target,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var newTarget=target,currentTarget=this._getTargetPosition();if(currentTarget&&!allowSamePosition&&currentTarget.equals(newTarget))return;this._targetHost=null,this._target=newTarget,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},ArcRotateCamera.prototype._getViewMatrix=function(){var cosa=Math.cos(this.alpha),sina=Math.sin(this.alpha),cosb=Math.cos(this.beta),sinb=Math.sin(this.beta);0===sinb&&(sinb=1e-4);var target=this._getTargetPosition();if(target.addToRef(new BABYLON.Vector3(this.radius*cosa*sinb,this.radius*cosb,this.radius*sina*sinb),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new BABYLON.Collider),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var up=this.upVector;this.allowUpsideDown&&sinb<0&&(up=(up=up.clone()).negate()),this.getScene().useRightHandedSystem?BABYLON.Matrix.LookAtRHToRef(this.position,target,up,this._viewMatrix):BABYLON.Matrix.LookAtLHToRef(this.position,target,up,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._currentTarget=target,this._viewMatrix},ArcRotateCamera.prototype.zoomOn=function(meshes,doNotUpdateMaxZ){void 0===doNotUpdateMaxZ&&(doNotUpdateMaxZ=!1),meshes=meshes||this.getScene().meshes;var minMaxVector=BABYLON.Mesh.MinMax(meshes),distance=BABYLON.Vector3.Distance(minMaxVector.min,minMaxVector.max);this.radius=distance*this.zoomOnFactor,this.focusOn({min:minMaxVector.min,max:minMaxVector.max,distance:distance},doNotUpdateMaxZ)},ArcRotateCamera.prototype.focusOn=function(meshesOrMinMaxVectorAndDistance,doNotUpdateMaxZ){void 0===doNotUpdateMaxZ&&(doNotUpdateMaxZ=!1);var meshesOrMinMaxVector,distance;if(void 0===meshesOrMinMaxVectorAndDistance.min){var meshes=meshesOrMinMaxVectorAndDistance||this.getScene().meshes;meshesOrMinMaxVector=BABYLON.Mesh.MinMax(meshes),distance=BABYLON.Vector3.Distance(meshesOrMinMaxVector.min,meshesOrMinMaxVector.max)}else{var minMaxVectorAndDistance=meshesOrMinMaxVectorAndDistance;meshesOrMinMaxVector=minMaxVectorAndDistance,distance=minMaxVectorAndDistance.distance}this._target=BABYLON.Mesh.Center(meshesOrMinMaxVector),doNotUpdateMaxZ||(this.maxZ=2*distance)},ArcRotateCamera.prototype.createRigCamera=function(name,cameraIndex){var alphaShift=0;switch(this.cameraRigMode){case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case BABYLON.Camera.RIG_MODE_VR:alphaShift=this._cameraRigParams.stereoHalfAngle*(0===cameraIndex?1:-1);break;case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:alphaShift=this._cameraRigParams.stereoHalfAngle*(0===cameraIndex?-1:1)}var rigCam=new ArcRotateCamera(name,this.alpha+alphaShift,this.beta,this.radius,this._target,this.getScene());return rigCam._cameraRigParams={},rigCam},ArcRotateCamera.prototype._updateRigCameras=function(){var camLeft=this._rigCameras[0],camRight=this._rigCameras[1];switch(camLeft.beta=camRight.beta=this.beta,camLeft.radius=camRight.radius=this.radius,this.cameraRigMode){case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case BABYLON.Camera.RIG_MODE_VR:camLeft.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,camRight.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:camLeft.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,camRight.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}_super.prototype._updateRigCameras.call(this)},ArcRotateCamera.prototype.dispose=function(){this.inputs.clear(),_super.prototype.dispose.call(this)},ArcRotateCamera.prototype.getClassName=function(){return"ArcRotateCamera"},__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"alpha",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"beta",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"radius",void 0),__decorate([BABYLON.serializeAsVector3("target")],ArcRotateCamera.prototype,"_target",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"inertialAlphaOffset",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"inertialBetaOffset",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"inertialRadiusOffset",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"lowerAlphaLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"upperAlphaLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"lowerBetaLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"upperBetaLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"lowerRadiusLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"upperRadiusLimit",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"inertialPanningX",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"inertialPanningY",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"pinchToPanMaxDistance",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"panningDistanceLimit",void 0),__decorate([BABYLON.serializeAsVector3()],ArcRotateCamera.prototype,"panningOriginTarget",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"panningInertia",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"zoomOnFactor",void 0),__decorate([BABYLON.serialize()],ArcRotateCamera.prototype,"allowUpsideDown",void 0),ArcRotateCamera}(BABYLON.TargetCamera);BABYLON.ArcRotateCamera=ArcRotateCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraInputsManager=function(_super){function ArcRotateCameraInputsManager(camera){return _super.call(this,camera)||this}return __extends(ArcRotateCameraInputsManager,_super),ArcRotateCameraInputsManager.prototype.addMouseWheel=function(){return this.add(new BABYLON.ArcRotateCameraMouseWheelInput),this},ArcRotateCameraInputsManager.prototype.addPointers=function(){return this.add(new BABYLON.ArcRotateCameraPointersInput),this},ArcRotateCameraInputsManager.prototype.addKeyboard=function(){return this.add(new BABYLON.ArcRotateCameraKeyboardMoveInput),this},ArcRotateCameraInputsManager.prototype.addGamepad=function(){return this.add(new BABYLON.ArcRotateCameraGamepadInput),this},ArcRotateCameraInputsManager.prototype.addVRDeviceOrientation=function(){return this.add(new BABYLON.ArcRotateCameraVRDeviceOrientationInput),this},ArcRotateCameraInputsManager}(BABYLON.CameraInputsManager);BABYLON.ArcRotateCameraInputsManager=ArcRotateCameraInputsManager}(BABYLON||(BABYLON={}));!function(BABYLON){var HemisphericLight=function(_super){function HemisphericLight(name,direction,scene){var _this=_super.call(this,name,scene)||this;return _this.groundColor=new BABYLON.Color3(0,0,0),_this.direction=direction||BABYLON.Vector3.Up(),_this}return __extends(HemisphericLight,_super),HemisphericLight.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},HemisphericLight.prototype.getClassName=function(){return"HemisphericLight"},HemisphericLight.prototype.setDirectionToTarget=function(target){return this.direction=BABYLON.Vector3.Normalize(target.subtract(BABYLON.Vector3.Zero())),this.direction},HemisphericLight.prototype.getShadowGenerator=function(){return null},HemisphericLight.prototype.transferToEffect=function(effect,lightIndex){var normalizeDirection=BABYLON.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",normalizeDirection.x,normalizeDirection.y,normalizeDirection.z,0,lightIndex),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),lightIndex),this},HemisphericLight.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=BABYLON.Matrix.Identity()),this._worldMatrix},HemisphericLight.prototype.getTypeID=function(){return BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT},__decorate([BABYLON.serializeAsColor3()],HemisphericLight.prototype,"groundColor",void 0),__decorate([BABYLON.serializeAsVector3()],HemisphericLight.prototype,"direction",void 0),HemisphericLight}(BABYLON.Light);BABYLON.HemisphericLight=HemisphericLight}(BABYLON||(BABYLON={}));!function(BABYLON){var ShadowLight=function(_super){function ShadowLight(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this._needProjectionMatrixCompute=!0,_this}return __extends(ShadowLight,_super),Object.defineProperty(ShadowLight.prototype,"direction",{get:function(){return this._direction},set:function(value){this._direction=value},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowLight.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(value){this._shadowMinZ=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowLight.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(value){this._shadowMaxZ=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),ShadowLight.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=BABYLON.Vector3.Zero()),BABYLON.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=BABYLON.Vector3.Zero()),BABYLON.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},ShadowLight.prototype.getDepthScale=function(){return 50},ShadowLight.prototype.getShadowDirection=function(faceIndex){return this.transformedDirection?this.transformedDirection:this.direction},ShadowLight.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},ShadowLight.prototype.setDirectionToTarget=function(target){return this.direction=BABYLON.Vector3.Normalize(target.subtract(this.position)),this.direction},ShadowLight.prototype.getRotation=function(){this.direction.normalize();var xaxis=BABYLON.Vector3.Cross(this.direction,BABYLON.Axis.Y),yaxis=BABYLON.Vector3.Cross(xaxis,this.direction);return BABYLON.Vector3.RotationFromAxis(xaxis,yaxis,this.direction)},ShadowLight.prototype.needCube=function(){return!1},ShadowLight.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},ShadowLight.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},ShadowLight.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=BABYLON.Matrix.Identity()),BABYLON.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},ShadowLight.prototype.getDepthMinZ=function(activeCamera){return void 0!==this.shadowMinZ?this.shadowMinZ:activeCamera.minZ},ShadowLight.prototype.getDepthMaxZ=function(activeCamera){return void 0!==this.shadowMaxZ?this.shadowMaxZ:activeCamera.maxZ},ShadowLight.prototype.setShadowProjectionMatrix=function(matrix,viewMatrix,renderList){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(viewMatrix,renderList,matrix):this._setDefaultShadowProjectionMatrix(matrix,viewMatrix,renderList),this},__decorate([BABYLON.serializeAsVector3()],ShadowLight.prototype,"position",void 0),__decorate([BABYLON.serializeAsVector3()],ShadowLight.prototype,"direction",null),__decorate([BABYLON.serialize()],ShadowLight.prototype,"shadowMinZ",null),__decorate([BABYLON.serialize()],ShadowLight.prototype,"shadowMaxZ",null),ShadowLight}(BABYLON.Light);BABYLON.ShadowLight=ShadowLight}(BABYLON||(BABYLON={}));!function(BABYLON){var PointLight=function(_super){function PointLight(name,position,scene){var _this=_super.call(this,name,scene)||this;return _this._shadowAngle=Math.PI/2,_this.position=position,_this}return __extends(PointLight,_super),Object.defineProperty(PointLight.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(value){this._shadowAngle=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(PointLight.prototype,"direction",{get:function(){return this._direction},set:function(value){var previousNeedCube=this.needCube();this._direction=value,this.needCube()!==previousNeedCube&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),PointLight.prototype.getClassName=function(){return"PointLight"},PointLight.prototype.getTypeID=function(){return BABYLON.Light.LIGHTTYPEID_POINTLIGHT},PointLight.prototype.needCube=function(){return!this.direction},PointLight.prototype.getShadowDirection=function(faceIndex){if(this.direction)return _super.prototype.getShadowDirection.call(this,faceIndex);switch(faceIndex){case 0:return new BABYLON.Vector3(1,0,0);case 1:return new BABYLON.Vector3(-1,0,0);case 2:return new BABYLON.Vector3(0,-1,0);case 3:return new BABYLON.Vector3(0,1,0);case 4:return new BABYLON.Vector3(0,0,1);case 5:return new BABYLON.Vector3(0,0,-1)}return BABYLON.Vector3.Zero()},PointLight.prototype._setDefaultShadowProjectionMatrix=function(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;activeCamera&&BABYLON.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(activeCamera),this.getDepthMaxZ(activeCamera),matrix)},PointLight.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},PointLight.prototype.transferToEffect=function(effect,lightIndex){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,lightIndex),this):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,lightIndex),this)},__decorate([BABYLON.serialize()],PointLight.prototype,"shadowAngle",null),PointLight}(BABYLON.ShadowLight);BABYLON.PointLight=PointLight}(BABYLON||(BABYLON={}));!function(BABYLON){var DirectionalLight=function(_super){function DirectionalLight(name,direction,scene){var _this=_super.call(this,name,scene)||this;return _this._shadowFrustumSize=0,_this._shadowOrthoScale=.5,_this.autoUpdateExtends=!0,_this._orthoLeft=Number.MAX_VALUE,_this._orthoRight=Number.MIN_VALUE,_this._orthoTop=Number.MIN_VALUE,_this._orthoBottom=Number.MAX_VALUE,_this.position=direction.scale(-1),_this.direction=direction,_this}return __extends(DirectionalLight,_super),Object.defineProperty(DirectionalLight.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(value){this._shadowFrustumSize=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(DirectionalLight.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(value){this._shadowOrthoScale=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),DirectionalLight.prototype.getClassName=function(){return"DirectionalLight"},DirectionalLight.prototype.getTypeID=function(){return BABYLON.Light.LIGHTTYPEID_DIRECTIONALLIGHT},DirectionalLight.prototype._setDefaultShadowProjectionMatrix=function(matrix,viewMatrix,renderList){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(matrix,viewMatrix):this._setDefaultAutoExtendShadowProjectionMatrix(matrix,viewMatrix,renderList)},DirectionalLight.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(matrix,viewMatrix){var activeCamera=this.getScene().activeCamera;activeCamera&&BABYLON.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:activeCamera.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:activeCamera.maxZ,matrix)},DirectionalLight.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;if(activeCamera){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var tempVector3=BABYLON.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var meshIndex=0;meshIndex<renderList.length;meshIndex++){var mesh=renderList[meshIndex];if(mesh)for(var boundingBox=mesh.getBoundingInfo().boundingBox,index=0;index<boundingBox.vectorsWorld.length;index++)BABYLON.Vector3.TransformCoordinatesToRef(boundingBox.vectorsWorld[index],viewMatrix,tempVector3),tempVector3.x<this._orthoLeft&&(this._orthoLeft=tempVector3.x),tempVector3.y<this._orthoBottom&&(this._orthoBottom=tempVector3.y),tempVector3.x>this._orthoRight&&(this._orthoRight=tempVector3.x),tempVector3.y>this._orthoTop&&(this._orthoTop=tempVector3.y)}}var xOffset=this._orthoRight-this._orthoLeft,yOffset=this._orthoTop-this._orthoBottom;BABYLON.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-xOffset*this.shadowOrthoScale,this._orthoRight+xOffset*this.shadowOrthoScale,this._orthoBottom-yOffset*this.shadowOrthoScale,this._orthoTop+yOffset*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:activeCamera.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:activeCamera.maxZ,matrix)}},DirectionalLight.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},DirectionalLight.prototype.transferToEffect=function(effect,lightIndex){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,lightIndex),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,lightIndex),this)},DirectionalLight.prototype.getDepthMinZ=function(activeCamera){return 1},DirectionalLight.prototype.getDepthMaxZ=function(activeCamera){return 1},__decorate([BABYLON.serialize()],DirectionalLight.prototype,"shadowFrustumSize",null),__decorate([BABYLON.serialize()],DirectionalLight.prototype,"shadowOrthoScale",null),__decorate([BABYLON.serialize()],DirectionalLight.prototype,"autoUpdateExtends",void 0),DirectionalLight}(BABYLON.ShadowLight);BABYLON.DirectionalLight=DirectionalLight}(BABYLON||(BABYLON={}));!function(BABYLON){var SpotLight=function(_super){function SpotLight(name,position,direction,angle,exponent,scene){var _this=_super.call(this,name,scene)||this;return _this.position=position,_this.direction=direction,_this.angle=angle,_this.exponent=exponent,_this}return __extends(SpotLight,_super),Object.defineProperty(SpotLight.prototype,"angle",{get:function(){return this._angle},set:function(value){this._angle=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(SpotLight.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(value){this._shadowAngleScale=value,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),SpotLight.prototype.getClassName=function(){return"SpotLight"},SpotLight.prototype.getTypeID=function(){return BABYLON.Light.LIGHTTYPEID_SPOTLIGHT},SpotLight.prototype._setDefaultShadowProjectionMatrix=function(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;if(activeCamera){this._shadowAngleScale=this._shadowAngleScale||1;var angle=this._shadowAngleScale*this._angle;BABYLON.Matrix.PerspectiveFovLHToRef(angle,1,this.getDepthMinZ(activeCamera),this.getDepthMaxZ(activeCamera),matrix)}},SpotLight.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},SpotLight.prototype.transferToEffect=function(effect,lightIndex){var normalizeDirection;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,lightIndex),normalizeDirection=BABYLON.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,lightIndex),normalizeDirection=BABYLON.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",normalizeDirection.x,normalizeDirection.y,normalizeDirection.z,Math.cos(.5*this.angle),lightIndex),this},__decorate([BABYLON.serialize()],SpotLight.prototype,"angle",null),__decorate([BABYLON.serialize()],SpotLight.prototype,"shadowAngleScale",null),__decorate([BABYLON.serialize()],SpotLight.prototype,"exponent",void 0),SpotLight}(BABYLON.ShadowLight);BABYLON.SpotLight=SpotLight}(BABYLON||(BABYLON={}));!function(BABYLON){var AnimationRange=function(){function AnimationRange(name,from,to){this.name=name,this.from=from,this.to=to}return AnimationRange.prototype.clone=function(){return new AnimationRange(this.name,this.from,this.to)},AnimationRange}();BABYLON.AnimationRange=AnimationRange;var AnimationEvent=function(){return function(frame,action,onlyOnce){this.frame=frame,this.action=action,this.onlyOnce=onlyOnce,this.isDone=!1}}();BABYLON.AnimationEvent=AnimationEvent;var PathCursor=function(){function PathCursor(path){this.path=path,this._onchange=new Array,this.value=0,this.animations=new Array}return PathCursor.prototype.getPoint=function(){var point=this.path.getPointAtLengthPosition(this.value);return new BABYLON.Vector3(point.x,0,point.y)},PathCursor.prototype.moveAhead=function(step){return void 0===step&&(step=.002),this.move(step),this},PathCursor.prototype.moveBack=function(step){return void 0===step&&(step=.002),this.move(-step),this},PathCursor.prototype.move=function(step){if(Math.abs(step)>1)throw"step size should be less than 1.";return this.value+=step,this.ensureLimits(),this.raiseOnChange(),this},PathCursor.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},PathCursor.prototype.raiseOnChange=function(){var _this=this;return this._onchange.forEach(function(f){return f(_this)}),this},PathCursor.prototype.onchange=function(f){return this._onchange.push(f),this},PathCursor}();BABYLON.PathCursor=PathCursor;var Animation=function(){function Animation(name,targetProperty,framePerSecond,dataType,loopMode,enableBlending){this.name=name,this.targetProperty=targetProperty,this.framePerSecond=framePerSecond,this.dataType=dataType,this.loopMode=loopMode,this.enableBlending=enableBlending,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=targetProperty.split("."),this.dataType=dataType,this.loopMode=void 0===loopMode?Animation.ANIMATIONLOOPMODE_CYCLE:loopMode}return Animation._PrepareAnimation=function(name,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction){var dataType=void 0;if(!isNaN(parseFloat(from))&&isFinite(from)?dataType=Animation.ANIMATIONTYPE_FLOAT:from instanceof BABYLON.Quaternion?dataType=Animation.ANIMATIONTYPE_QUATERNION:from instanceof BABYLON.Vector3?dataType=Animation.ANIMATIONTYPE_VECTOR3:from instanceof BABYLON.Vector2?dataType=Animation.ANIMATIONTYPE_VECTOR2:from instanceof BABYLON.Color3?dataType=Animation.ANIMATIONTYPE_COLOR3:from instanceof BABYLON.Size&&(dataType=Animation.ANIMATIONTYPE_SIZE),void 0==dataType)return null;var animation=new Animation(name,targetProperty,framePerSecond,dataType,loopMode),keys=[{frame:0,value:from},{frame:totalFrame,value:to}];return animation.setKeys(keys),void 0!==easingFunction&&animation.setEasingFunction(easingFunction),animation},Animation.CreateAnimation=function(property,animationType,framePerSecond,easingFunction){var animation=new BABYLON.Animation(property+"Animation",property,framePerSecond,animationType,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);return animation.setEasingFunction(easingFunction),animation},Animation.CreateAndStartAnimation=function(name,node,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction,onAnimationEnd){var animation=Animation._PrepareAnimation(name,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction);return animation?node.getScene().beginDirectAnimation(node,[animation],0,totalFrame,1===animation.loopMode,1,onAnimationEnd):null},Animation.CreateMergeAndStartAnimation=function(name,node,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction,onAnimationEnd){var animation=Animation._PrepareAnimation(name,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction);return animation?(node.animations.push(animation),node.getScene().beginAnimation(node,0,totalFrame,1===animation.loopMode,1,onAnimationEnd)):null},Animation.TransitionTo=function(property,targetValue,host,scene,frameRate,transition,duration,onAnimationEnd){if(void 0===onAnimationEnd&&(onAnimationEnd=null),duration<=0)return host[property]=targetValue,onAnimationEnd&&onAnimationEnd(),null;var endFrame=frameRate*(duration/1e3);transition.setKeys([{frame:0,value:host[property].clone?host[property].clone():host[property]},{frame:endFrame,value:targetValue}]),host.animations||(host.animations=[]),host.animations.push(transition);var animation=scene.beginAnimation(host,0,endFrame,!1);return animation.onAnimationEnd=onAnimationEnd,animation},Object.defineProperty(Animation.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var _i=0,_a=this._runtimeAnimations;_i<_a.length;_i++)if(!_a[_i].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),Animation.prototype.toString=function(fullDetails){var ret="Name: "+this.name+", property: "+this.targetProperty;if(ret+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],ret+=", nKeys: "+(this._keys?this._keys.length:"none"),ret+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),fullDetails){ret+=", Ranges: {";var first=!0;for(var name in this._ranges)first&&(ret+=", ",first=!1),ret+=name;ret+="}"}return ret},Animation.prototype.addEvent=function(event){this._events.push(event)},Animation.prototype.removeEvents=function(frame){for(var index=0;index<this._events.length;index++)this._events[index].frame===frame&&(this._events.splice(index,1),index--)},Animation.prototype.getEvents=function(){return this._events},Animation.prototype.createRange=function(name,from,to){this._ranges[name]||(this._ranges[name]=new AnimationRange(name,from,to))},Animation.prototype.deleteRange=function(name,deleteFrames){void 0===deleteFrames&&(deleteFrames=!0);var range=this._ranges[name];if(range){if(deleteFrames)for(var from=range.from,to=range.to,key=this._keys.length-1;key>=0;key--)this._keys[key].frame>=from&&this._keys[key].frame<=to&&this._keys.splice(key,1);this._ranges[name]=null}},Animation.prototype.getRange=function(name){return this._ranges[name]},Animation.prototype.getKeys=function(){return this._keys},Animation.prototype.getHighestFrame=function(){for(var ret=0,key=0,nKeys=this._keys.length;key<nKeys;key++)ret<this._keys[key].frame&&(ret=this._keys[key].frame);return ret},Animation.prototype.getEasingFunction=function(){return this._easingFunction},Animation.prototype.setEasingFunction=function(easingFunction){this._easingFunction=easingFunction},Animation.prototype.floatInterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Scalar.Lerp(startValue,endValue,gradient)},Animation.prototype.floatInterpolateFunctionWithTangents=function(startValue,outTangent,endValue,inTangent,gradient){return BABYLON.Scalar.Hermite(startValue,outTangent,endValue,inTangent,gradient)},Animation.prototype.quaternionInterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Quaternion.Slerp(startValue,endValue,gradient)},Animation.prototype.quaternionInterpolateFunctionWithTangents=function(startValue,outTangent,endValue,inTangent,gradient){return BABYLON.Quaternion.Hermite(startValue,outTangent,endValue,inTangent,gradient).normalize()},Animation.prototype.vector3InterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Vector3.Lerp(startValue,endValue,gradient)},Animation.prototype.vector3InterpolateFunctionWithTangents=function(startValue,outTangent,endValue,inTangent,gradient){return BABYLON.Vector3.Hermite(startValue,outTangent,endValue,inTangent,gradient)},Animation.prototype.vector2InterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Vector2.Lerp(startValue,endValue,gradient)},Animation.prototype.vector2InterpolateFunctionWithTangents=function(startValue,outTangent,endValue,inTangent,gradient){return BABYLON.Vector2.Hermite(startValue,outTangent,endValue,inTangent,gradient)},Animation.prototype.sizeInterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Size.Lerp(startValue,endValue,gradient)},Animation.prototype.color3InterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Color3.Lerp(startValue,endValue,gradient)},Animation.prototype.matrixInterpolateFunction=function(startValue,endValue,gradient){return BABYLON.Matrix.Lerp(startValue,endValue,gradient)},Animation.prototype.clone=function(){var clone=new Animation(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(clone.enableBlending=this.enableBlending,clone.blendingSpeed=this.blendingSpeed,this._keys&&clone.setKeys(this._keys),this._ranges){clone._ranges={};for(var name in this._ranges){var range=this._ranges[name];range&&(clone._ranges[name]=range.clone())}}return clone},Animation.prototype.setKeys=function(values){this._keys=values.slice(0)},Animation.prototype.serialize=function(){var serializationObject={};serializationObject.name=this.name,serializationObject.property=this.targetProperty,serializationObject.framePerSecond=this.framePerSecond,serializationObject.dataType=this.dataType,serializationObject.loopBehavior=this.loopMode,serializationObject.enableBlending=this.enableBlending,serializationObject.blendingSpeed=this.blendingSpeed;var dataType=this.dataType;serializationObject.keys=[];for(var keys=this.getKeys(),index=0;index<keys.length;index++){var animationKey=keys[index],key={};switch(key.frame=animationKey.frame,dataType){case Animation.ANIMATIONTYPE_FLOAT:key.values=[animationKey.value];break;case Animation.ANIMATIONTYPE_QUATERNION:case Animation.ANIMATIONTYPE_MATRIX:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_COLOR3:key.values=animationKey.value.asArray()}serializationObject.keys.push(key)}serializationObject.ranges=[];for(var name in this._ranges){var source=this._ranges[name];if(source){var range={};range.name=name,range.from=source.from,range.to=source.to,serializationObject.ranges.push(range)}}return serializationObject},Object.defineProperty(Animation,"ANIMATIONTYPE_FLOAT",{get:function(){return Animation._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_VECTOR3",{get:function(){return Animation._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_VECTOR2",{get:function(){return Animation._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_SIZE",{get:function(){return Animation._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_QUATERNION",{get:function(){return Animation._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_MATRIX",{get:function(){return Animation._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONTYPE_COLOR3",{get:function(){return Animation._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return Animation._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return Animation._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(Animation,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return Animation._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),Animation.Parse=function(parsedAnimation){var data,index,animation=new Animation(parsedAnimation.name,parsedAnimation.property,parsedAnimation.framePerSecond,parsedAnimation.dataType,parsedAnimation.loopBehavior),dataType=parsedAnimation.dataType,keys=[];for(parsedAnimation.enableBlending&&(animation.enableBlending=parsedAnimation.enableBlending),parsedAnimation.blendingSpeed&&(animation.blendingSpeed=parsedAnimation.blendingSpeed),index=0;index<parsedAnimation.keys.length;index++){var inTangent,outTangent,key=parsedAnimation.keys[index];switch(dataType){case Animation.ANIMATIONTYPE_FLOAT:data=key.values[0],key.values.length>=1&&(inTangent=key.values[1]),key.values.length>=2&&(outTangent=key.values[2]);break;case Animation.ANIMATIONTYPE_QUATERNION:if(data=BABYLON.Quaternion.FromArray(key.values),key.values.length>=8){var _inTangent=BABYLON.Quaternion.FromArray(key.values.slice(4,8));_inTangent.equals(BABYLON.Quaternion.Zero())||(inTangent=_inTangent)}if(key.values.length>=12){var _outTangent=BABYLON.Quaternion.FromArray(key.values.slice(8,12));_outTangent.equals(BABYLON.Quaternion.Zero())||(outTangent=_outTangent)}break;case Animation.ANIMATIONTYPE_MATRIX:data=BABYLON.Matrix.FromArray(key.values);break;case Animation.ANIMATIONTYPE_COLOR3:data=BABYLON.Color3.FromArray(key.values);break;case Animation.ANIMATIONTYPE_VECTOR3:default:data=BABYLON.Vector3.FromArray(key.values)}var keyData={};keyData.frame=key.frame,keyData.value=data,void 0!=inTangent&&(keyData.inTangent=inTangent),void 0!=outTangent&&(keyData.outTangent=outTangent),keys.push(keyData)}if(animation.setKeys(keys),parsedAnimation.ranges)for(index=0;index<parsedAnimation.ranges.length;index++)data=parsedAnimation.ranges[index],animation.createRange(data.name,data.from,data.to);return animation},Animation.AppendSerializedAnimations=function(source,destination){if(source.animations){destination.animations=[];for(var animationIndex=0;animationIndex<source.animations.length;animationIndex++){var animation=source.animations[animationIndex];destination.animations.push(animation.serialize())}}},Animation.AllowMatricesInterpolation=!1,Animation._ANIMATIONTYPE_FLOAT=0,Animation._ANIMATIONTYPE_VECTOR3=1,Animation._ANIMATIONTYPE_QUATERNION=2,Animation._ANIMATIONTYPE_MATRIX=3,Animation._ANIMATIONTYPE_COLOR3=4,Animation._ANIMATIONTYPE_VECTOR2=5,Animation._ANIMATIONTYPE_SIZE=6,Animation._ANIMATIONLOOPMODE_RELATIVE=0,Animation._ANIMATIONLOOPMODE_CYCLE=1,Animation._ANIMATIONLOOPMODE_CONSTANT=2,Animation}();BABYLON.Animation=Animation}(BABYLON||(BABYLON={}));!function(BABYLON){var RuntimeAnimation=function(){function RuntimeAnimation(target,animation){this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._ratioOffset=0,this._animation=animation,this._target=target,animation._runtimeAnimations.push(this)}return Object.defineProperty(RuntimeAnimation.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),RuntimeAnimation.prototype.reset=function(){this._offsetsCache={},this._highLimitsCache={},this.currentFrame=0,this._blendingFactor=0,this._originalBlendValue=null},RuntimeAnimation.prototype.isStopped=function(){return this._stopped},RuntimeAnimation.prototype.dispose=function(){var index=this._animation.runtimeAnimations.indexOf(this);index>-1&&this._animation.runtimeAnimations.splice(index,1)},RuntimeAnimation.prototype._getKeyValue=function(value){return"function"==typeof value?value():value},RuntimeAnimation.prototype._interpolate=function(currentFrame,repeatCount,loopMode,offsetValue,highLimitValue){if(loopMode===BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT&&repeatCount>0)return highLimitValue.clone?highLimitValue.clone():highLimitValue;this.currentFrame=currentFrame;var keys=this._animation.getKeys(),startKeyIndex=Math.max(0,Math.min(keys.length-1,Math.floor(keys.length*(currentFrame-keys[0].frame)/(keys[keys.length-1].frame-keys[0].frame))-1));if(keys[startKeyIndex].frame>=currentFrame)for(;startKeyIndex-1>=0&&keys[startKeyIndex].frame>=currentFrame;)startKeyIndex--;for(var key=startKeyIndex;key<keys.length;key++){var endKey=keys[key+1];if(endKey.frame>=currentFrame){var startKey=keys[key],startValue=this._getKeyValue(startKey.value),endValue=this._getKeyValue(endKey.value),useTangent=void 0!==startKey.outTangent&&void 0!==endKey.inTangent,frameDelta=endKey.frame-startKey.frame,gradient=(currentFrame-startKey.frame)/frameDelta,easingFunction=this._animation.getEasingFunction();switch(null!=easingFunction&&(gradient=easingFunction.ease(gradient)),this._animation.dataType){case BABYLON.Animation.ANIMATIONTYPE_FLOAT:var floatValue=useTangent?this._animation.floatInterpolateFunctionWithTangents(startValue,startKey.outTangent*frameDelta,endValue,endKey.inTangent*frameDelta,gradient):this._animation.floatInterpolateFunction(startValue,endValue,gradient);switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return floatValue;case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return offsetValue*repeatCount+floatValue}break;case BABYLON.Animation.ANIMATIONTYPE_QUATERNION:var quatValue=useTangent?this._animation.quaternionInterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this._animation.quaternionInterpolateFunction(startValue,endValue,gradient);switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return quatValue;case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return quatValue.add(offsetValue.scale(repeatCount))}return quatValue;case BABYLON.Animation.ANIMATIONTYPE_VECTOR3:var vec3Value=useTangent?this._animation.vector3InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this._animation.vector3InterpolateFunction(startValue,endValue,gradient);switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return vec3Value;case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return vec3Value.add(offsetValue.scale(repeatCount))}case BABYLON.Animation.ANIMATIONTYPE_VECTOR2:var vec2Value=useTangent?this._animation.vector2InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this._animation.vector2InterpolateFunction(startValue,endValue,gradient);switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return vec2Value;case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return vec2Value.add(offsetValue.scale(repeatCount))}case BABYLON.Animation.ANIMATIONTYPE_SIZE:switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return this._animation.sizeInterpolateFunction(startValue,endValue,gradient);case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return this._animation.sizeInterpolateFunction(startValue,endValue,gradient).add(offsetValue.scale(repeatCount))}case BABYLON.Animation.ANIMATIONTYPE_COLOR3:switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:return this._animation.color3InterpolateFunction(startValue,endValue,gradient);case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return this._animation.color3InterpolateFunction(startValue,endValue,gradient).add(offsetValue.scale(repeatCount))}case BABYLON.Animation.ANIMATIONTYPE_MATRIX:switch(loopMode){case BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE:case BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT:if(BABYLON.Animation.AllowMatricesInterpolation)return this._animation.matrixInterpolateFunction(startValue,endValue,gradient);case BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE:return startValue}}break}}return this._getKeyValue(keys[keys.length-1].value)},RuntimeAnimation.prototype.setValue=function(currentValue,blend){void 0===blend&&(blend=!1);var path,destination,targetPropertyPath=this._animation.targetPropertyPath;if(targetPropertyPath.length>1){for(var property=this._target[targetPropertyPath[0]],index=1;index<targetPropertyPath.length-1;index++)property=property[targetPropertyPath[index]];path=targetPropertyPath[targetPropertyPath.length-1],destination=property}else path=targetPropertyPath[0],destination=this._target;this._animation.enableBlending&&this._blendingFactor<=1?(this._originalBlendValue||(destination[path].clone?this._originalBlendValue=destination[path].clone():this._originalBlendValue=destination[path]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?destination[path]=this._originalBlendValue.construtor.prototype.Lerp(currentValue,this._originalBlendValue,this._blendingFactor):destination[path]=currentValue:this._originalBlendValue.m?destination[path]=BABYLON.Matrix.Lerp(this._originalBlendValue,currentValue,this._blendingFactor):destination[path]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*currentValue,this._blendingFactor+=this._animation.blendingSpeed):destination[path]=currentValue,this._target.markAsDirty&&this._target.markAsDirty(this._animation.targetProperty)},RuntimeAnimation.prototype.goToFrame=function(frame){var keys=this._animation.getKeys();frame<keys[0].frame?frame=keys[0].frame:frame>keys[keys.length-1].frame&&(frame=keys[keys.length-1].frame);var currentValue=this._interpolate(frame,0,this._animation.loopMode);this.setValue(currentValue)},RuntimeAnimation.prototype._prepareForSpeedRatioChange=function(newSpeedRatio){var newRatio=this._previousDelay*(this._animation.framePerSecond*newSpeedRatio)/1e3;this._ratioOffset=this._previousRatio-newRatio},RuntimeAnimation.prototype.animate=function(delay,from,to,loop,speedRatio,blend){void 0===blend&&(blend=!1);var targetPropertyPath=this._animation.targetPropertyPath;if(!targetPropertyPath||targetPropertyPath.length<1)return this._stopped=!0,!1;var returnValue=!0,keys=this._animation.getKeys();if(0!==keys[0].frame){var newKey={frame:0,value:keys[0].value};keys.splice(0,0,newKey)}(from<keys[0].frame||from>keys[keys.length-1].frame)&&(from=keys[0].frame),(to<keys[0].frame||to>keys[keys.length-1].frame)&&(to=keys[keys.length-1].frame),from===to&&(from>keys[0].frame?from--:to<keys[keys.length-1].frame&&to++);var offsetValue,range=to-from,ratio=delay*(this._animation.framePerSecond*speedRatio)/1e3+this._ratioOffset,highLimitValue=0;if(this._previousDelay=delay,this._previousRatio=ratio,(to>from&&ratio>=range||from>to&&ratio<=range)&&!loop)returnValue=!1,highLimitValue=this._getKeyValue(keys[keys.length-1].value);else if(this._animation.loopMode!==BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE){var keyOffset=to.toString()+from.toString();if(!this._offsetsCache[keyOffset]){var fromValue=this._interpolate(from,0,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),toValue=this._interpolate(to,0,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);switch(this._animation.dataType){case BABYLON.Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[keyOffset]=toValue-fromValue;break;case BABYLON.Animation.ANIMATIONTYPE_QUATERNION:this._offsetsCache[keyOffset]=toValue.subtract(fromValue);break;case BABYLON.Animation.ANIMATIONTYPE_VECTOR3:this._offsetsCache[keyOffset]=toValue.subtract(fromValue);case BABYLON.Animation.ANIMATIONTYPE_VECTOR2:this._offsetsCache[keyOffset]=toValue.subtract(fromValue);case BABYLON.Animation.ANIMATIONTYPE_SIZE:this._offsetsCache[keyOffset]=toValue.subtract(fromValue);case BABYLON.Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[keyOffset]=toValue.subtract(fromValue)}this._highLimitsCache[keyOffset]=toValue}highLimitValue=this._highLimitsCache[keyOffset],offsetValue=this._offsetsCache[keyOffset]}if(void 0===offsetValue)switch(this._animation.dataType){case BABYLON.Animation.ANIMATIONTYPE_FLOAT:offsetValue=0;break;case BABYLON.Animation.ANIMATIONTYPE_QUATERNION:offsetValue=new BABYLON.Quaternion(0,0,0,0);break;case BABYLON.Animation.ANIMATIONTYPE_VECTOR3:offsetValue=BABYLON.Vector3.Zero();break;case BABYLON.Animation.ANIMATIONTYPE_VECTOR2:offsetValue=BABYLON.Vector2.Zero();break;case BABYLON.Animation.ANIMATIONTYPE_SIZE:offsetValue=BABYLON.Size.Zero();break;case BABYLON.Animation.ANIMATIONTYPE_COLOR3:offsetValue=BABYLON.Color3.Black()}var repeatCount=ratio/range>>0,currentFrame=returnValue?from+ratio%range:to,currentValue=this._interpolate(currentFrame,repeatCount,this._animation.loopMode,offsetValue,highLimitValue);this.setValue(currentValue);for(var events=this._animation.getEvents(),index=0;index<events.length;index++)if(range>0&&currentFrame>=events[index].frame&&events[index].frame>=from||range<0&&currentFrame<=events[index].frame&&events[index].frame<=from){var event=events[index];event.isDone||(event.onlyOnce&&(events.splice(index,1),index--),event.isDone=!0,event.action())}else events[index].isDone&&!events[index].onlyOnce&&(events[index].isDone=!1);return returnValue||(this._stopped=!0),returnValue},RuntimeAnimation}();BABYLON.RuntimeAnimation=RuntimeAnimation}(BABYLON||(BABYLON={}));!function(BABYLON){var Animatable=function(){function Animatable(scene,target,fromFrame,toFrame,loopAnimation,speedRatio,onAnimationEnd,animations){void 0===fromFrame&&(fromFrame=0),void 0===toFrame&&(toFrame=100),void 0===loopAnimation&&(loopAnimation=!1),void 0===speedRatio&&(speedRatio=1),this.target=target,this.fromFrame=fromFrame,this.toFrame=toFrame,this.loopAnimation=loopAnimation,this.onAnimationEnd=onAnimationEnd,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this.animationStarted=!1,animations&&this.appendAnimations(target,animations),this._speedRatio=speedRatio,this._scene=scene,scene._activeAnimatables.push(this)}return Object.defineProperty(Animatable.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(value){for(var index=0;index<this._runtimeAnimations.length;index++)this._runtimeAnimations[index]._prepareForSpeedRatioChange(value);this._speedRatio=value},enumerable:!0,configurable:!0}),Animatable.prototype.getAnimations=function(){return this._runtimeAnimations},Animatable.prototype.appendAnimations=function(target,animations){for(var index=0;index<animations.length;index++){var animation=animations[index];this._runtimeAnimations.push(new BABYLON.RuntimeAnimation(target,animation))}},Animatable.prototype.getAnimationByTargetProperty=function(property){for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)if(runtimeAnimations[index].animation.targetProperty===property)return runtimeAnimations[index].animation;return null},Animatable.prototype.getRuntimeAnimationByTargetProperty=function(property){for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)if(runtimeAnimations[index].animation.targetProperty===property)return runtimeAnimations[index];return null},Animatable.prototype.reset=function(){for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].reset();this._localDelayOffset=null,this._pausedDelay=null},Animatable.prototype.enableBlending=function(blendingSpeed){for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].animation.enableBlending=!0,runtimeAnimations[index].animation.blendingSpeed=blendingSpeed},Animatable.prototype.disableBlending=function(){for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].animation.enableBlending=!1},Animatable.prototype.goToFrame=function(frame){var runtimeAnimations=this._runtimeAnimations;if(runtimeAnimations[0]){var fps=runtimeAnimations[0].animation.framePerSecond,delay=1e3*(frame-runtimeAnimations[0].currentFrame)/fps;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=delay}for(var index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].goToFrame(frame)},Animatable.prototype.pause=function(){this._paused||(this._paused=!0)},Animatable.prototype.restart=function(){this._paused=!1},Animatable.prototype.stop=function(animationName){if(animationName){var idx=this._scene._activeAnimatables.indexOf(this);if(idx>-1){for(index=(runtimeAnimations=this._runtimeAnimations).length-1;index>=0;index--)"string"==typeof animationName&&runtimeAnimations[index].animation.name!=animationName||(runtimeAnimations[index].dispose(),runtimeAnimations.splice(index,1));0==runtimeAnimations.length&&(this._scene._activeAnimatables.splice(idx,1),this.onAnimationEnd&&this.onAnimationEnd())}}else if((index=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(index,1);for(var runtimeAnimations=this._runtimeAnimations,index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].dispose();this.onAnimationEnd&&this.onAnimationEnd()}},Animatable.prototype._animate=function(delay){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=delay),!0;null===this._localDelayOffset?this._localDelayOffset=delay:null!==this._pausedDelay&&(this._localDelayOffset+=delay-this._pausedDelay,this._pausedDelay=null);var index,running=!1,runtimeAnimations=this._runtimeAnimations;for(index=0;index<runtimeAnimations.length;index++){var isRunning=runtimeAnimations[index].animate(delay-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio);running=running||isRunning}if(this.animationStarted=running,!running)for(index=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(index,1),index=0;index<runtimeAnimations.length;index++)runtimeAnimations[index].dispose();return!running&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),running},Animatable}();BABYLON.Animatable=Animatable}(BABYLON||(BABYLON={}));!function(BABYLON){var EasingFunction=function(){function EasingFunction(){this._easingMode=EasingFunction.EASINGMODE_EASEIN}return Object.defineProperty(EasingFunction,"EASINGMODE_EASEIN",{get:function(){return EasingFunction._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(EasingFunction,"EASINGMODE_EASEOUT",{get:function(){return EasingFunction._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(EasingFunction,"EASINGMODE_EASEINOUT",{get:function(){return EasingFunction._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),EasingFunction.prototype.setEasingMode=function(easingMode){var n=Math.min(Math.max(easingMode,0),2);this._easingMode=n},EasingFunction.prototype.getEasingMode=function(){return this._easingMode},EasingFunction.prototype.easeInCore=function(gradient){throw new Error("You must implement this method")},EasingFunction.prototype.ease=function(gradient){switch(this._easingMode){case EasingFunction.EASINGMODE_EASEIN:return this.easeInCore(gradient);case EasingFunction.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-gradient)}return gradient>=.5?.5*(1-this.easeInCore(2*(1-gradient)))+.5:.5*this.easeInCore(2*gradient)},EasingFunction._EASINGMODE_EASEIN=0,EasingFunction._EASINGMODE_EASEOUT=1,EasingFunction._EASINGMODE_EASEINOUT=2,EasingFunction}();BABYLON.EasingFunction=EasingFunction;var CircleEase=function(_super){function CircleEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CircleEase,_super),CircleEase.prototype.easeInCore=function(gradient){return gradient=Math.max(0,Math.min(1,gradient)),1-Math.sqrt(1-gradient*gradient)},CircleEase}(EasingFunction);BABYLON.CircleEase=CircleEase;var BackEase=function(_super){function BackEase(amplitude){void 0===amplitude&&(amplitude=1);var _this=_super.call(this)||this;return _this.amplitude=amplitude,_this}return __extends(BackEase,_super),BackEase.prototype.easeInCore=function(gradient){var num=Math.max(0,this.amplitude);return Math.pow(gradient,3)-gradient*num*Math.sin(3.141592653589793*gradient)},BackEase}(EasingFunction);BABYLON.BackEase=BackEase;var BounceEase=function(_super){function BounceEase(bounces,bounciness){void 0===bounces&&(bounces=3),void 0===bounciness&&(bounciness=2);var _this=_super.call(this)||this;return _this.bounces=bounces,_this.bounciness=bounciness,_this}return __extends(BounceEase,_super),BounceEase.prototype.easeInCore=function(gradient){var y=Math.max(0,this.bounces),bounciness=this.bounciness;bounciness<=1&&(bounciness=1.001);var num9=Math.pow(bounciness,y),num5=1-bounciness,num4=(1-num9)/num5+.5*num9,num15=gradient*num4,num65=Math.log(-num15*(1-bounciness)+1)/Math.log(bounciness),num3=Math.floor(num65),num13=num3+1,num8=(1-Math.pow(bounciness,num3))/(num5*num4),num7=.5*(num8+(1-Math.pow(bounciness,num13))/(num5*num4)),num6=gradient-num7,num2=num7-num8;return-Math.pow(1/bounciness,y-num3)/(num2*num2)*(num6-num2)*(num6+num2)},BounceEase}(EasingFunction);BABYLON.BounceEase=BounceEase;var CubicEase=function(_super){function CubicEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CubicEase,_super),CubicEase.prototype.easeInCore=function(gradient){return gradient*gradient*gradient},CubicEase}(EasingFunction);BABYLON.CubicEase=CubicEase;var ElasticEase=function(_super){function ElasticEase(oscillations,springiness){void 0===oscillations&&(oscillations=3),void 0===springiness&&(springiness=3);var _this=_super.call(this)||this;return _this.oscillations=oscillations,_this.springiness=springiness,_this}return __extends(ElasticEase,_super),ElasticEase.prototype.easeInCore=function(gradient){var num3=Math.max(0,this.oscillations),num=Math.max(0,this.springiness);return(0==num?gradient:(Math.exp(num*gradient)-1)/(Math.exp(num)-1))*Math.sin((6.283185307179586*num3+1.5707963267948966)*gradient)},ElasticEase}(EasingFunction);BABYLON.ElasticEase=ElasticEase;var ExponentialEase=function(_super){function ExponentialEase(exponent){void 0===exponent&&(exponent=2);var _this=_super.call(this)||this;return _this.exponent=exponent,_this}return __extends(ExponentialEase,_super),ExponentialEase.prototype.easeInCore=function(gradient){return this.exponent<=0?gradient:(Math.exp(this.exponent*gradient)-1)/(Math.exp(this.exponent)-1)},ExponentialEase}(EasingFunction);BABYLON.ExponentialEase=ExponentialEase;var PowerEase=function(_super){function PowerEase(power){void 0===power&&(power=2);var _this=_super.call(this)||this;return _this.power=power,_this}return __extends(PowerEase,_super),PowerEase.prototype.easeInCore=function(gradient){var y=Math.max(0,this.power);return Math.pow(gradient,y)},PowerEase}(EasingFunction);BABYLON.PowerEase=PowerEase;var QuadraticEase=function(_super){function QuadraticEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(QuadraticEase,_super),QuadraticEase.prototype.easeInCore=function(gradient){return gradient*gradient},QuadraticEase}(EasingFunction);BABYLON.QuadraticEase=QuadraticEase;var QuarticEase=function(_super){function QuarticEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(QuarticEase,_super),QuarticEase.prototype.easeInCore=function(gradient){return gradient*gradient*gradient*gradient},QuarticEase}(EasingFunction);BABYLON.QuarticEase=QuarticEase;var QuinticEase=function(_super){function QuinticEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(QuinticEase,_super),QuinticEase.prototype.easeInCore=function(gradient){return gradient*gradient*gradient*gradient*gradient},QuinticEase}(EasingFunction);BABYLON.QuinticEase=QuinticEase;var SineEase=function(_super){function SineEase(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(SineEase,_super),SineEase.prototype.easeInCore=function(gradient){return 1-Math.sin(1.5707963267948966*(1-gradient))},SineEase}(EasingFunction);BABYLON.SineEase=SineEase;var BezierCurveEase=function(_super){function BezierCurveEase(x1,y1,x2,y2){void 0===x1&&(x1=0),void 0===y1&&(y1=0),void 0===x2&&(x2=1),void 0===y2&&(y2=1);var _this=_super.call(this)||this;return _this.x1=x1,_this.y1=y1,_this.x2=x2,_this.y2=y2,_this}return __extends(BezierCurveEase,_super),BezierCurveEase.prototype.easeInCore=function(gradient){return BABYLON.BezierCurve.interpolate(gradient,this.x1,this.y1,this.x2,this.y2)},BezierCurveEase}(EasingFunction);BABYLON.BezierCurveEase=BezierCurveEase}(BABYLON||(BABYLON={}));!function(BABYLON){var Condition=function(){function Condition(actionManager){this._actionManager=actionManager}return Condition.prototype.isValid=function(){return!0},Condition.prototype._getProperty=function(propertyPath){return this._actionManager._getProperty(propertyPath)},Condition.prototype._getEffectiveTarget=function(target,propertyPath){return this._actionManager._getEffectiveTarget(target,propertyPath)},Condition.prototype.serialize=function(){},Condition.prototype._serialize=function(serializedCondition){return{type:2,children:[],name:serializedCondition.name,properties:serializedCondition.properties}},Condition}();BABYLON.Condition=Condition;var ValueCondition=function(_super){function ValueCondition(actionManager,target,propertyPath,value,operator){void 0===operator&&(operator=ValueCondition.IsEqual);var _this=_super.call(this,actionManager)||this;return _this.propertyPath=propertyPath,_this.value=value,_this.operator=operator,_this._target=target,_this._effectiveTarget=_this._getEffectiveTarget(target,_this.propertyPath),_this._property=_this._getProperty(_this.propertyPath),_this}return __extends(ValueCondition,_super),Object.defineProperty(ValueCondition,"IsEqual",{get:function(){return ValueCondition._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(ValueCondition,"IsDifferent",{get:function(){return ValueCondition._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(ValueCondition,"IsGreater",{get:function(){return ValueCondition._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(ValueCondition,"IsLesser",{get:function(){return ValueCondition._IsLesser},enumerable:!0,configurable:!0}),ValueCondition.prototype.isValid=function(){switch(this.operator){case ValueCondition.IsGreater:return this._effectiveTarget[this._property]>this.value;case ValueCondition.IsLesser:return this._effectiveTarget[this._property]<this.value;case ValueCondition.IsEqual:case ValueCondition.IsDifferent:var check;return check=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===ValueCondition.IsEqual?check:!check}return!1},ValueCondition.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:BABYLON.Action._SerializeValueAsString(this.value)},{name:"operator",value:ValueCondition.GetOperatorName(this.operator)}]})},ValueCondition.GetOperatorName=function(operator){switch(operator){case ValueCondition._IsEqual:return"IsEqual";case ValueCondition._IsDifferent:return"IsDifferent";case ValueCondition._IsGreater:return"IsGreater";case ValueCondition._IsLesser:return"IsLesser";default:return""}},ValueCondition._IsEqual=0,ValueCondition._IsDifferent=1,ValueCondition._IsGreater=2,ValueCondition._IsLesser=3,ValueCondition}(Condition);BABYLON.ValueCondition=ValueCondition;var PredicateCondition=function(_super){function PredicateCondition(actionManager,predicate){var _this=_super.call(this,actionManager)||this;return _this.predicate=predicate,_this}return __extends(PredicateCondition,_super),PredicateCondition.prototype.isValid=function(){return this.predicate()},PredicateCondition}(Condition);BABYLON.PredicateCondition=PredicateCondition;var StateCondition=function(_super){function StateCondition(actionManager,target,value){var _this=_super.call(this,actionManager)||this;return _this.value=value,_this._target=target,_this}return __extends(StateCondition,_super),StateCondition.prototype.isValid=function(){return this._target.state===this.value},StateCondition.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},StateCondition}(Condition);BABYLON.StateCondition=StateCondition}(BABYLON||(BABYLON={}));!function(BABYLON){var Action=function(){function Action(triggerOptions,condition){this.triggerOptions=triggerOptions,this.onBeforeExecuteObservable=new BABYLON.Observable,triggerOptions.parameter?(this.trigger=triggerOptions.trigger,this._triggerParameter=triggerOptions.parameter):this.trigger=triggerOptions,this._nextActiveAction=this,this._condition=condition}return Action.prototype._prepare=function(){},Action.prototype.getTriggerParameter=function(){return this._triggerParameter},Action.prototype._executeCurrent=function(evt){if(this._nextActiveAction._condition){var condition=this._nextActiveAction._condition,currentRenderId=this._actionManager.getScene().getRenderId();if(condition._evaluationId===currentRenderId){if(!condition._currentResult)return}else{if(condition._evaluationId=currentRenderId,!condition.isValid())return void(condition._currentResult=!1);condition._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(evt),this.skipToNextActiveAction()},Action.prototype.execute=function(evt){},Action.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},Action.prototype.then=function(action){return this._child=action,action._actionManager=this._actionManager,action._prepare(),action},Action.prototype._getProperty=function(propertyPath){return this._actionManager._getProperty(propertyPath)},Action.prototype._getEffectiveTarget=function(target,propertyPath){return this._actionManager._getEffectiveTarget(target,propertyPath)},Action.prototype.serialize=function(parent){},Action.prototype._serialize=function(serializedAction,parent){var serializationObject={type:1,children:[],name:serializedAction.name,properties:serializedAction.properties||[]};if(this._child&&this._child.serialize(serializationObject),this._condition){var serializedCondition=this._condition.serialize();return serializedCondition.children.push(serializationObject),parent&&parent.children.push(serializedCondition),serializedCondition}return parent&&parent.children.push(serializationObject),serializationObject},Action._SerializeValueAsString=function(value){return"number"==typeof value?value.toString():"boolean"==typeof value?value?"true":"false":value instanceof BABYLON.Vector2?value.x+", "+value.y:value instanceof BABYLON.Vector3?value.x+", "+value.y+", "+value.z:value instanceof BABYLON.Color3?value.r+", "+value.g+", "+value.b:value instanceof BABYLON.Color4?value.r+", "+value.g+", "+value.b+", "+value.a:value},Action._GetTargetProperty=function(target){return{name:"target",targetType:target instanceof BABYLON.Mesh?"MeshProperties":target instanceof BABYLON.Light?"LightProperties":target instanceof BABYLON.Camera?"CameraProperties":"SceneProperties",value:target instanceof BABYLON.Scene?"Scene":target.name}},Action}();BABYLON.Action=Action}(BABYLON||(BABYLON={}));!function(BABYLON){var ActionEvent=function(){function ActionEvent(source,pointerX,pointerY,meshUnderPointer,sourceEvent,additionalData){this.source=source,this.pointerX=pointerX,this.pointerY=pointerY,this.meshUnderPointer=meshUnderPointer,this.sourceEvent=sourceEvent,this.additionalData=additionalData}return ActionEvent.CreateNew=function(source,evt,additionalData){var scene=source.getScene();return new ActionEvent(source,scene.pointerX,scene.pointerY,scene.meshUnderPointer,evt,additionalData)},ActionEvent.CreateNewFromSprite=function(source,scene,evt,additionalData){return new ActionEvent(source,scene.pointerX,scene.pointerY,scene.meshUnderPointer,evt,additionalData)},ActionEvent.CreateNewFromScene=function(scene,evt){return new ActionEvent(null,scene.pointerX,scene.pointerY,scene.meshUnderPointer,evt)},ActionEvent.CreateNewFromPrimitive=function(prim,pointerPos,evt,additionalData){return new ActionEvent(prim,pointerPos.x,pointerPos.y,null,evt,additionalData)},ActionEvent}();BABYLON.ActionEvent=ActionEvent;var ActionManager=function(){function ActionManager(scene){this.actions=new Array,this.hoverCursor="",this._scene=scene,scene._actionManagers.push(this)}return Object.defineProperty(ActionManager,"NothingTrigger",{get:function(){return ActionManager._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPickTrigger",{get:function(){return ActionManager._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnLeftPickTrigger",{get:function(){return ActionManager._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnRightPickTrigger",{get:function(){return ActionManager._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnCenterPickTrigger",{get:function(){return ActionManager._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPickDownTrigger",{get:function(){return ActionManager._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnDoublePickTrigger",{get:function(){return ActionManager._OnDoublePickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPickUpTrigger",{get:function(){return ActionManager._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPickOutTrigger",{get:function(){return ActionManager._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnLongPressTrigger",{get:function(){return ActionManager._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPointerOverTrigger",{get:function(){return ActionManager._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnPointerOutTrigger",{get:function(){return ActionManager._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnEveryFrameTrigger",{get:function(){return ActionManager._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnIntersectionEnterTrigger",{get:function(){return ActionManager._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnIntersectionExitTrigger",{get:function(){return ActionManager._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnKeyDownTrigger",{get:function(){return ActionManager._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"OnKeyUpTrigger",{get:function(){return ActionManager._OnKeyUpTrigger},enumerable:!0,configurable:!0}),ActionManager.prototype.dispose=function(){for(var index=this._scene._actionManagers.indexOf(this),i=0;i<this.actions.length;i++){var action=this.actions[i];ActionManager.Triggers[action.trigger]--,0===ActionManager.Triggers[action.trigger]&&delete ActionManager.Triggers[action.trigger]}index>-1&&this._scene._actionManagers.splice(index,1)},ActionManager.prototype.getScene=function(){return this._scene},ActionManager.prototype.hasSpecificTriggers=function(triggers){for(var index=0;index<this.actions.length;index++){var action=this.actions[index];if(triggers.indexOf(action.trigger)>-1)return!0}return!1},ActionManager.prototype.hasSpecificTrigger=function(trigger){for(var index=0;index<this.actions.length;index++)if(this.actions[index].trigger===trigger)return!0;return!1},Object.defineProperty(ActionManager.prototype,"hasPointerTriggers",{get:function(){for(var index=0;index<this.actions.length;index++){var action=this.actions[index];if(action.trigger>=ActionManager._OnPickTrigger&&action.trigger<=ActionManager._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager.prototype,"hasPickTriggers",{get:function(){for(var index=0;index<this.actions.length;index++){var action=this.actions[index];if(action.trigger>=ActionManager._OnPickTrigger&&action.trigger<=ActionManager._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"HasTriggers",{get:function(){for(var t in ActionManager.Triggers)if(ActionManager.Triggers.hasOwnProperty(t))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(ActionManager,"HasPickTriggers",{get:function(){for(var t in ActionManager.Triggers)if(ActionManager.Triggers.hasOwnProperty(t)){var t_int=parseInt(t);if(t_int>=ActionManager._OnPickTrigger&&t_int<=ActionManager._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),ActionManager.HasSpecificTrigger=function(trigger){for(var t in ActionManager.Triggers)if(ActionManager.Triggers.hasOwnProperty(t)&&parseInt(t)===trigger)return!0;return!1},ActionManager.prototype.registerAction=function(action){return action.trigger===ActionManager.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(BABYLON.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(action),ActionManager.Triggers[action.trigger]?ActionManager.Triggers[action.trigger]++:ActionManager.Triggers[action.trigger]=1,action._actionManager=this,action._prepare(),action)},ActionManager.prototype.processTrigger=function(trigger,evt){for(var index=0;index<this.actions.length;index++){var action=this.actions[index];if(action.trigger===trigger){if(evt&&(trigger===ActionManager.OnKeyUpTrigger||trigger===ActionManager.OnKeyDownTrigger)){var parameter=action.getTriggerParameter();if(parameter&&parameter!==evt.sourceEvent.keyCode){if(!parameter.toLowerCase)continue;var lowerCase=parameter.toLowerCase();if(lowerCase!==evt.sourceEvent.key){var unicode=evt.sourceEvent.charCode?evt.sourceEvent.charCode:evt.sourceEvent.keyCode;if(String.fromCharCode(unicode).toLowerCase()!==lowerCase)continue}}}action._executeCurrent(evt)}}},ActionManager.prototype._getEffectiveTarget=function(target,propertyPath){for(var properties=propertyPath.split("."),index=0;index<properties.length-1;index++)target=target[properties[index]];return target},ActionManager.prototype._getProperty=function(propertyPath){var properties=propertyPath.split(".");return properties[properties.length-1]},ActionManager.prototype.serialize=function(name){for(var root={children:new Array,name:name,type:3,properties:new Array},i=0;i<this.actions.length;i++){var triggerObject={type:0,children:new Array,name:ActionManager.GetTriggerName(this.actions[i].trigger),properties:new Array},triggerOptions=this.actions[i].triggerOptions;if(triggerOptions&&"number"!=typeof triggerOptions)if(triggerOptions.parameter instanceof BABYLON.Node)triggerObject.properties.push(BABYLON.Action._GetTargetProperty(triggerOptions.parameter));else{var parameter={};BABYLON.Tools.DeepCopy(triggerOptions.parameter,parameter,["mesh"]),triggerOptions.parameter.mesh&&(parameter._meshId=triggerOptions.parameter.mesh.id),triggerObject.properties.push({name:"parameter",targetType:null,value:parameter})}this.actions[i].serialize(triggerObject),root.children.push(triggerObject)}return root},ActionManager.Parse=function(parsedActions,object,scene){var actionManager=new BABYLON.ActionManager(scene);null===object?scene.actionManager=actionManager:object.actionManager=actionManager;for(var instanciate=function(name,params){var newInstance=Object.create(BABYLON.Tools.Instantiate("BABYLON."+name).prototype);return newInstance.constructor.apply(newInstance,params),newInstance},parseParameter=function(name,value,target,propertyPath){if(null===propertyPath){var floatValue=parseFloat(value);return"true"===value||"false"===value?"true"===value:isNaN(floatValue)?value:floatValue}for(var effectiveTarget=propertyPath.split("."),values=value.split(","),i=0;i<effectiveTarget.length;i++)target=target[effectiveTarget[i]];if("boolean"==typeof target)return"true"===values[0];if("string"==typeof target)return values[0];for(var split=new Array,i=0;i<values.length;i++)split.push(parseFloat(values[i]));return target instanceof BABYLON.Vector3?BABYLON.Vector3.FromArray(split):target instanceof BABYLON.Vector4?BABYLON.Vector4.FromArray(split):target instanceof BABYLON.Color3?BABYLON.Color3.FromArray(split):target instanceof BABYLON.Color4?BABYLON.Color4.FromArray(split):parseFloat(values[0])},traverse=function(parsedAction,trigger,condition,action,combineArray){if(void 0===combineArray&&(combineArray=null),!parsedAction.detached){var parameters=new Array,target=null,propertyPath=null,combine=parsedAction.combine&&parsedAction.combine.length>0;if(2===parsedAction.type?parameters.push(actionManager):parameters.push(trigger),combine){for(var actions=new Array,j=0;j<parsedAction.combine.length;j++)traverse(parsedAction.combine[j],ActionManager.NothingTrigger,condition,action,actions);parameters.push(actions)}else for(i=0;i<parsedAction.properties.length;i++){var value=parsedAction.properties[i].value,name=parsedAction.properties[i].name,targetType=parsedAction.properties[i].targetType;"target"===name?value=target=null!==targetType&&"SceneProperties"===targetType?scene:scene.getNodeByName(value):"parent"===name?value=scene.getNodeByName(value):"sound"===name?value=scene.getSoundByName(value):"propertyPath"!==name?value=2===parsedAction.type&&"operator"===name?BABYLON.ValueCondition[value]:parseParameter(0,value,target,"value"===name?propertyPath:null):propertyPath=value,parameters.push(value)}if(null===combineArray?parameters.push(condition):parameters.push(null),"InterpolateValueAction"===parsedAction.name){var param=parameters[parameters.length-2];parameters[parameters.length-1]=param,parameters[parameters.length-2]=condition}var newAction=instanciate(parsedAction.name,parameters);if(newAction instanceof BABYLON.Condition&&null!==condition){var nothing=new BABYLON.DoNothingAction(trigger,condition);action?action.then(nothing):actionManager.registerAction(nothing),action=nothing}null===combineArray?newAction instanceof BABYLON.Condition?(condition=newAction,newAction=action):(condition=null,action?action.then(newAction):actionManager.registerAction(newAction)):combineArray.push(newAction);for(var i=0;i<parsedAction.children.length;i++)traverse(parsedAction.children[i],trigger,condition,newAction,null)}},i=0;i<parsedActions.children.length;i++){var triggerParams,trigger=parsedActions.children[i];if(trigger.properties.length>0){var param=trigger.properties[0].value,value=null===trigger.properties[0].targetType?param:scene.getMeshByName(param);value._meshId&&(value.mesh=scene.getMeshByID(value._meshId)),triggerParams={trigger:ActionManager[trigger.name],parameter:value}}else triggerParams=ActionManager[trigger.name];for(var j=0;j<trigger.children.length;j++)trigger.detached||traverse(trigger.children[j],triggerParams,null,null)}},ActionManager.GetTriggerName=function(trigger){switch(trigger){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},ActionManager._NothingTrigger=0,ActionManager._OnPickTrigger=1,ActionManager._OnLeftPickTrigger=2,ActionManager._OnRightPickTrigger=3,ActionManager._OnCenterPickTrigger=4,ActionManager._OnPickDownTrigger=5,ActionManager._OnDoublePickTrigger=6,ActionManager._OnPickUpTrigger=7,ActionManager._OnLongPressTrigger=8,ActionManager._OnPointerOverTrigger=9,ActionManager._OnPointerOutTrigger=10,ActionManager._OnEveryFrameTrigger=11,ActionManager._OnIntersectionEnterTrigger=12,ActionManager._OnIntersectionExitTrigger=13,ActionManager._OnKeyDownTrigger=14,ActionManager._OnKeyUpTrigger=15,ActionManager._OnPickOutTrigger=16,ActionManager.Triggers={},ActionManager}();BABYLON.ActionManager=ActionManager}(BABYLON||(BABYLON={}));!function(BABYLON){var InterpolateValueAction=function(_super){function InterpolateValueAction(triggerOptions,target,propertyPath,value,duration,condition,stopOtherAnimations,onInterpolationDone){void 0===duration&&(duration=1e3);var _this=_super.call(this,triggerOptions,condition)||this;return _this.propertyPath=propertyPath,_this.value=value,_this.duration=duration,_this.stopOtherAnimations=stopOtherAnimations,_this.onInterpolationDone=onInterpolationDone,_this.onInterpolationDoneObservable=new BABYLON.Observable,_this._target=_this._effectiveTarget=target,_this}return __extends(InterpolateValueAction,_super),InterpolateValueAction.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},InterpolateValueAction.prototype.execute=function(){var dataType,_this=this,scene=this._actionManager.getScene(),keys=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)dataType=BABYLON.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof BABYLON.Color3)dataType=BABYLON.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof BABYLON.Vector3)dataType=BABYLON.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof BABYLON.Matrix)dataType=BABYLON.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof BABYLON.Quaternion))return void BABYLON.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");dataType=BABYLON.Animation.ANIMATIONTYPE_QUATERNION}var animation=new BABYLON.Animation("InterpolateValueAction",this._property,1e3/this.duration*100,dataType,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);animation.setKeys(keys),this.stopOtherAnimations&&scene.stopAnimation(this._effectiveTarget);scene.beginDirectAnimation(this._effectiveTarget,[animation],0,100,!1,1,function(){_this.onInterpolationDoneObservable.notifyObservers(_this),_this.onInterpolationDone&&_this.onInterpolationDone()})},InterpolateValueAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:BABYLON.Action._SerializeValueAsString(this.value)},{name:"duration",value:BABYLON.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:BABYLON.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},parent)},InterpolateValueAction}(BABYLON.Action);BABYLON.InterpolateValueAction=InterpolateValueAction}(BABYLON||(BABYLON={}));!function(BABYLON){var SwitchBooleanAction=function(_super){function SwitchBooleanAction(triggerOptions,target,propertyPath,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.propertyPath=propertyPath,_this._target=_this._effectiveTarget=target,_this}return __extends(SwitchBooleanAction,_super),SwitchBooleanAction.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},SwitchBooleanAction.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},SwitchBooleanAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},parent)},SwitchBooleanAction}(BABYLON.Action);BABYLON.SwitchBooleanAction=SwitchBooleanAction;var SetStateAction=function(_super){function SetStateAction(triggerOptions,target,value,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.value=value,_this._target=target,_this}return __extends(SetStateAction,_super),SetStateAction.prototype.execute=function(){this._target.state=this.value},SetStateAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"SetStateAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},parent)},SetStateAction}(BABYLON.Action);BABYLON.SetStateAction=SetStateAction;var SetValueAction=function(_super){function SetValueAction(triggerOptions,target,propertyPath,value,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.propertyPath=propertyPath,_this.value=value,_this._target=_this._effectiveTarget=target,_this}return __extends(SetValueAction,_super),SetValueAction.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},SetValueAction.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},SetValueAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"SetValueAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:BABYLON.Action._SerializeValueAsString(this.value)}]},parent)},SetValueAction}(BABYLON.Action);BABYLON.SetValueAction=SetValueAction;var IncrementValueAction=function(_super){function IncrementValueAction(triggerOptions,target,propertyPath,value,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.propertyPath=propertyPath,_this.value=value,_this._target=_this._effectiveTarget=target,_this}return __extends(IncrementValueAction,_super),IncrementValueAction.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&BABYLON.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},IncrementValueAction.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},IncrementValueAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:BABYLON.Action._SerializeValueAsString(this.value)}]},parent)},IncrementValueAction}(BABYLON.Action);BABYLON.IncrementValueAction=IncrementValueAction;var PlayAnimationAction=function(_super){function PlayAnimationAction(triggerOptions,target,from,to,loop,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.from=from,_this.to=to,_this.loop=loop,_this._target=target,_this}return __extends(PlayAnimationAction,_super),PlayAnimationAction.prototype._prepare=function(){},PlayAnimationAction.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},PlayAnimationAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[BABYLON.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:BABYLON.Action._SerializeValueAsString(this.loop)||!1}]},parent)},PlayAnimationAction}(BABYLON.Action);BABYLON.PlayAnimationAction=PlayAnimationAction;var StopAnimationAction=function(_super){function StopAnimationAction(triggerOptions,target,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this._target=target,_this}return __extends(StopAnimationAction,_super),StopAnimationAction.prototype._prepare=function(){},StopAnimationAction.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},StopAnimationAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[BABYLON.Action._GetTargetProperty(this._target)]},parent)},StopAnimationAction}(BABYLON.Action);BABYLON.StopAnimationAction=StopAnimationAction;var DoNothingAction=function(_super){function DoNothingAction(triggerOptions,condition){return void 0===triggerOptions&&(triggerOptions=BABYLON.ActionManager.NothingTrigger),_super.call(this,triggerOptions,condition)||this}return __extends(DoNothingAction,_super),DoNothingAction.prototype.execute=function(){},DoNothingAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},parent)},DoNothingAction}(BABYLON.Action);BABYLON.DoNothingAction=DoNothingAction;var CombineAction=function(_super){function CombineAction(triggerOptions,children,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.children=children,_this}return __extends(CombineAction,_super),CombineAction.prototype._prepare=function(){for(var index=0;index<this.children.length;index++)this.children[index]._actionManager=this._actionManager,this.children[index]._prepare()},CombineAction.prototype.execute=function(evt){for(var index=0;index<this.children.length;index++)this.children[index].execute(evt)},CombineAction.prototype.serialize=function(parent){for(var serializationObject=_super.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},parent),i=0;i<this.children.length;i++)serializationObject.combine.push(this.children[i].serialize(null));return serializationObject},CombineAction}(BABYLON.Action);BABYLON.CombineAction=CombineAction;var ExecuteCodeAction=function(_super){function ExecuteCodeAction(triggerOptions,func,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this.func=func,_this}return __extends(ExecuteCodeAction,_super),ExecuteCodeAction.prototype.execute=function(evt){this.func(evt)},ExecuteCodeAction}(BABYLON.Action);BABYLON.ExecuteCodeAction=ExecuteCodeAction;var SetParentAction=function(_super){function SetParentAction(triggerOptions,target,parent,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this._target=target,_this._parent=parent,_this}return __extends(SetParentAction,_super),SetParentAction.prototype._prepare=function(){},SetParentAction.prototype.execute=function(){if(this._target.parent!==this._parent){var invertParentWorldMatrix=this._parent.getWorldMatrix().clone();invertParentWorldMatrix.invert(),this._target.position=BABYLON.Vector3.TransformCoordinates(this._target.position,invertParentWorldMatrix),this._target.parent=this._parent}},SetParentAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"SetParentAction",properties:[BABYLON.Action._GetTargetProperty(this._target),BABYLON.Action._GetTargetProperty(this._parent)]},parent)},SetParentAction}(BABYLON.Action);BABYLON.SetParentAction=SetParentAction;var PlaySoundAction=function(_super){function PlaySoundAction(triggerOptions,sound,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this._sound=sound,_this}return __extends(PlaySoundAction,_super),PlaySoundAction.prototype._prepare=function(){},PlaySoundAction.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},PlaySoundAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},parent)},PlaySoundAction}(BABYLON.Action);BABYLON.PlaySoundAction=PlaySoundAction;var StopSoundAction=function(_super){function StopSoundAction(triggerOptions,sound,condition){var _this=_super.call(this,triggerOptions,condition)||this;return _this._sound=sound,_this}return __extends(StopSoundAction,_super),StopSoundAction.prototype._prepare=function(){},StopSoundAction.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},StopSoundAction.prototype.serialize=function(parent){return _super.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},parent)},StopSoundAction}(BABYLON.Action);BABYLON.StopSoundAction=StopSoundAction}(BABYLON||(BABYLON={}));!function(BABYLON){var SpriteManager=function(){function SpriteManager(name,imgUrl,capacity,cellSize,scene,epsilon,samplingMode){if(void 0===epsilon&&(epsilon=.01),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),this.name=name,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new BABYLON.Observable,this._vertexBuffers={},this._capacity=capacity,this._spriteTexture=new BABYLON.Texture(imgUrl,scene,!0,!1,samplingMode),this._spriteTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,cellSize.width&&cellSize.height)this.cellWidth=cellSize.width,this.cellHeight=cellSize.height;else{if(void 0===cellSize)return;this.cellWidth=cellSize,this.cellHeight=cellSize}this._epsilon=epsilon,this._scene=scene,this._scene.spriteManagers.push(this);for(var indices=[],index=0,count=0;count<capacity;count++)indices.push(index),indices.push(index+1),indices.push(index+2),indices.push(index),indices.push(index+2),indices.push(index+3),index+=4;this._indexBuffer=scene.getEngine().createIndexBuffer(indices),this._vertexData=new Float32Array(16*capacity*4),this._buffer=new BABYLON.Buffer(scene.getEngine(),this._vertexData,!0,16);var positions=this._buffer.createVertexBuffer(BABYLON.VertexBuffer.PositionKind,0,4),options=this._buffer.createVertexBuffer("options",4,4),cellInfo=this._buffer.createVertexBuffer("cellInfo",8,4),colors=this._buffer.createVertexBuffer(BABYLON.VertexBuffer.ColorKind,12,4);this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=positions,this._vertexBuffers.options=options,this._vertexBuffers.cellInfo=cellInfo,this._vertexBuffers[BABYLON.VertexBuffer.ColorKind]=colors,this._effectBase=this._scene.getEngine().createEffect("sprites",[BABYLON.VertexBuffer.PositionKind,"options","cellInfo",BABYLON.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[BABYLON.VertexBuffer.PositionKind,"options","cellInfo",BABYLON.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(SpriteManager.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteManager.prototype,"texture",{get:function(){return this._spriteTexture},set:function(value){this._spriteTexture=value},enumerable:!0,configurable:!0}),SpriteManager.prototype._appendSpriteVertex=function(index,sprite,offsetX,offsetY,rowSize){var arrayOffset=16*index;0===offsetX?offsetX=this._epsilon:1===offsetX&&(offsetX=1-this._epsilon),0===offsetY?offsetY=this._epsilon:1===offsetY&&(offsetY=1-this._epsilon),this._vertexData[arrayOffset]=sprite.position.x,this._vertexData[arrayOffset+1]=sprite.position.y,this._vertexData[arrayOffset+2]=sprite.position.z,this._vertexData[arrayOffset+3]=sprite.angle,this._vertexData[arrayOffset+4]=sprite.width,this._vertexData[arrayOffset+5]=sprite.height,this._vertexData[arrayOffset+6]=offsetX,this._vertexData[arrayOffset+7]=offsetY,this._vertexData[arrayOffset+8]=sprite.invertU?1:0,this._vertexData[arrayOffset+9]=sprite.invertV?1:0;var offset=sprite.cellIndex/rowSize>>0;this._vertexData[arrayOffset+10]=sprite.cellIndex-offset*rowSize,this._vertexData[arrayOffset+11]=offset,this._vertexData[arrayOffset+12]=sprite.color.r,this._vertexData[arrayOffset+13]=sprite.color.g,this._vertexData[arrayOffset+14]=sprite.color.b,this._vertexData[arrayOffset+15]=sprite.color.a},SpriteManager.prototype.intersects=function(ray,camera,predicate,fastCheck){for(var count=Math.min(this._capacity,this.sprites.length),min=BABYLON.Vector3.Zero(),max=BABYLON.Vector3.Zero(),distance=Number.MAX_VALUE,currentSprite=null,cameraSpacePosition=BABYLON.Vector3.Zero(),cameraView=camera.getViewMatrix(),index=0;index<count;index++){var sprite=this.sprites[index];if(sprite){if(predicate){if(!predicate(sprite))continue}else if(!sprite.isPickable)continue;if(BABYLON.Vector3.TransformCoordinatesToRef(sprite.position,cameraView,cameraSpacePosition),min.copyFromFloats(cameraSpacePosition.x-sprite.width/2,cameraSpacePosition.y-sprite.height/2,cameraSpacePosition.z),max.copyFromFloats(cameraSpacePosition.x+sprite.width/2,cameraSpacePosition.y+sprite.height/2,cameraSpacePosition.z),ray.intersectsBoxMinMax(min,max)){var currentDistance=BABYLON.Vector3.Distance(cameraSpacePosition,ray.origin);if(distance>currentDistance&&(distance=currentDistance,currentSprite=sprite,fastCheck))break}}}if(currentSprite){var result=new BABYLON.PickingInfo;return result.hit=!0,result.pickedSprite=currentSprite,result.distance=distance,result}return null},SpriteManager.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var engine=this._scene.getEngine(),baseSize=this._spriteTexture.getBaseSize(),deltaTime=engine.getDeltaTime(),max=Math.min(this._capacity,this.sprites.length),rowSize=baseSize.width/this.cellWidth,offset=0,index=0;index<max;index++){var sprite=this.sprites[index];sprite&&(sprite._animate(deltaTime),this._appendSpriteVertex(offset++,sprite,0,0,rowSize),this._appendSpriteVertex(offset++,sprite,1,0,rowSize),this._appendSpriteVertex(offset++,sprite,1,1,rowSize),this._appendSpriteVertex(offset++,sprite,0,1,rowSize))}this._buffer.update(this._vertexData);var effect=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==BABYLON.Scene.FOGMODE_NONE&&this.fogEnabled&&(effect=this._effectFog),engine.enableEffect(effect);var viewMatrix=this._scene.getViewMatrix();effect.setTexture("diffuseSampler",this._spriteTexture),effect.setMatrix("view",viewMatrix),effect.setMatrix("projection",this._scene.getProjectionMatrix()),effect.setFloat2("textureInfos",this.cellWidth/baseSize.width,this.cellHeight/baseSize.height),this._scene.fogEnabled&&this._scene.fogMode!==BABYLON.Scene.FOGMODE_NONE&&this.fogEnabled&&(effect.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),effect.setColor3("vFogColor",this._scene.fogColor)),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect),this.blendMode==BABYLON.Engine.ALPHA_ADD?(engine.setAlphaMode(BABYLON.Engine.ALPHA_ADD),engine.draw(!0,0,6*max),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE)):(this.noAlphaTest||(engine.setDepthFunctionToLessOrEqual(),effect.setBool("alphaTest",!0),engine.setColorWrite(!1),engine.draw(!0,0,6*max),engine.setColorWrite(!0),effect.setBool("alphaTest",!1)),engine.setAlphaMode(BABYLON.Engine.ALPHA_COMBINE),engine.draw(!0,0,6*max),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE))}},SpriteManager.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var index=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(index,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},SpriteManager}();BABYLON.SpriteManager=SpriteManager}(BABYLON||(BABYLON={}));!function(BABYLON){var Sprite=function(){function Sprite(name,manager){this.name=name,this.color=new BABYLON.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._manager=manager,this._manager.sprites.push(this),this.position=BABYLON.Vector3.Zero()}return Object.defineProperty(Sprite.prototype,"size",{get:function(){return this.width},set:function(value){this.width=value,this.height=value},enumerable:!0,configurable:!0}),Sprite.prototype.playAnimation=function(from,to,loop,delay,onAnimationEnd){this._fromIndex=from,this._toIndex=to,this._loopAnimation=loop,this._delay=delay,this._animationStarted=!0,this._direction=from<to?1:-1,this.cellIndex=from,this._time=0,this._onAnimationEnd=onAnimationEnd},Sprite.prototype.stopAnimation=function(){this._animationStarted=!1},Sprite.prototype._animate=function(deltaTime){this._animationStarted&&(this._time+=deltaTime,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex>this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},Sprite.prototype.dispose=function(){for(var i=0;i<this._manager.sprites.length;i++)this._manager.sprites[i]==this&&this._manager.sprites.splice(i,1)},Sprite}();BABYLON.Sprite=Sprite}(BABYLON||(BABYLON={}));!function(BABYLON){var IntersectionInfo=function(){return function(bu,bv,distance){this.bu=bu,this.bv=bv,this.distance=distance,this.faceId=0,this.subMeshId=0}}();BABYLON.IntersectionInfo=IntersectionInfo;var PickingInfo=function(){function PickingInfo(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null}return PickingInfo.prototype.getNormal=function(useWorldCoordinates,useVerticesNormals){if(void 0===useWorldCoordinates&&(useWorldCoordinates=!1),void 0===useVerticesNormals&&(useVerticesNormals=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind))return null;var indices=this.pickedMesh.getIndices();if(!indices)return null;var result;if(useVerticesNormals){var normals=this.pickedMesh.getVerticesData(BABYLON.VertexBuffer.NormalKind),normal0=BABYLON.Vector3.FromArray(normals,3*indices[3*this.faceId]),normal1=BABYLON.Vector3.FromArray(normals,3*indices[3*this.faceId+1]),normal2=BABYLON.Vector3.FromArray(normals,3*indices[3*this.faceId+2]);normal0=normal0.scale(this.bu),normal1=normal1.scale(this.bv),normal2=normal2.scale(1-this.bu-this.bv),result=new BABYLON.Vector3(normal0.x+normal1.x+normal2.x,normal0.y+normal1.y+normal2.y,normal0.z+normal1.z+normal2.z)}else{var positions=this.pickedMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),vertex1=BABYLON.Vector3.FromArray(positions,3*indices[3*this.faceId]),vertex2=BABYLON.Vector3.FromArray(positions,3*indices[3*this.faceId+1]),vertex3=BABYLON.Vector3.FromArray(positions,3*indices[3*this.faceId+2]),p1p2=vertex1.subtract(vertex2),p3p2=vertex3.subtract(vertex2);result=BABYLON.Vector3.Cross(p1p2,p3p2)}return useWorldCoordinates&&(result=BABYLON.Vector3.TransformNormal(result,this.pickedMesh.getWorldMatrix())),BABYLON.Vector3.Normalize(result)},PickingInfo.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind))return null;var indices=this.pickedMesh.getIndices();if(!indices)return null;var uvs=this.pickedMesh.getVerticesData(BABYLON.VertexBuffer.UVKind);if(!uvs)return null;var uv0=BABYLON.Vector2.FromArray(uvs,2*indices[3*this.faceId]),uv1=BABYLON.Vector2.FromArray(uvs,2*indices[3*this.faceId+1]),uv2=BABYLON.Vector2.FromArray(uvs,2*indices[3*this.faceId+2]);return uv0=uv0.scale(1-this.bu-this.bv),uv1=uv1.scale(this.bu),uv2=uv2.scale(this.bv),new BABYLON.Vector2(uv0.x+uv1.x+uv2.x,uv0.y+uv1.y+uv2.y)},PickingInfo}();BABYLON.PickingInfo=PickingInfo}(BABYLON||(BABYLON={}));!function(BABYLON){var Ray=function(){function Ray(origin,direction,length){void 0===length&&(length=Number.MAX_VALUE),this.origin=origin,this.direction=direction,this.length=length}return Ray.prototype.intersectsBoxMinMax=function(minimum,maximum){var inv,min,max,temp,d=0,maxValue=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<minimum.x||this.origin.x>maximum.x)return!1}else if(inv=1/this.direction.x,min=(minimum.x-this.origin.x)*inv,(max=(maximum.x-this.origin.x)*inv)===-1/0&&(max=1/0),min>max&&(temp=min,min=max,max=temp),d=Math.max(min,d),maxValue=Math.min(max,maxValue),d>maxValue)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<minimum.y||this.origin.y>maximum.y)return!1}else if(inv=1/this.direction.y,min=(minimum.y-this.origin.y)*inv,(max=(maximum.y-this.origin.y)*inv)===-1/0&&(max=1/0),min>max&&(temp=min,min=max,max=temp),d=Math.max(min,d),maxValue=Math.min(max,maxValue),d>maxValue)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<minimum.z||this.origin.z>maximum.z)return!1}else if(inv=1/this.direction.z,min=(minimum.z-this.origin.z)*inv,(max=(maximum.z-this.origin.z)*inv)===-1/0&&(max=1/0),min>max&&(temp=min,min=max,max=temp),d=Math.max(min,d),maxValue=Math.min(max,maxValue),d>maxValue)return!1;return!0},Ray.prototype.intersectsBox=function(box){return this.intersectsBoxMinMax(box.minimum,box.maximum)},Ray.prototype.intersectsSphere=function(sphere){var x=sphere.center.x-this.origin.x,y=sphere.center.y-this.origin.y,z=sphere.center.z-this.origin.z,pyth=x*x+y*y+z*z,rr=sphere.radius*sphere.radius;if(pyth<=rr)return!0;var dot=x*this.direction.x+y*this.direction.y+z*this.direction.z;return!(dot<0)&&pyth-dot*dot<=rr},Ray.prototype.intersectsTriangle=function(vertex0,vertex1,vertex2){this._edge1||(this._edge1=BABYLON.Vector3.Zero(),this._edge2=BABYLON.Vector3.Zero(),this._pvec=BABYLON.Vector3.Zero(),this._tvec=BABYLON.Vector3.Zero(),this._qvec=BABYLON.Vector3.Zero()),vertex1.subtractToRef(vertex0,this._edge1),vertex2.subtractToRef(vertex0,this._edge2),BABYLON.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var det=BABYLON.Vector3.Dot(this._edge1,this._pvec);if(0===det)return null;var invdet=1/det;this.origin.subtractToRef(vertex0,this._tvec);var bu=BABYLON.Vector3.Dot(this._tvec,this._pvec)*invdet;if(bu<0||bu>1)return null;BABYLON.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var bv=BABYLON.Vector3.Dot(this.direction,this._qvec)*invdet;if(bv<0||bu+bv>1)return null;var distance=BABYLON.Vector3.Dot(this._edge2,this._qvec)*invdet;return distance>this.length?null:new BABYLON.IntersectionInfo(bu,bv,distance)},Ray.prototype.intersectsPlane=function(plane){var distance,result1=BABYLON.Vector3.Dot(plane.normal,this.direction);if(Math.abs(result1)<9.99999997475243e-7)return null;var result2=BABYLON.Vector3.Dot(plane.normal,this.origin);return(distance=(-plane.d-result2)/result1)<0?distance<-9.99999997475243e-7?null:0:distance},Ray.prototype.intersectsMesh=function(mesh,fastCheck){var tm=BABYLON.Tmp.Matrix[0];return mesh.getWorldMatrix().invertToRef(tm),this._tmpRay?Ray.TransformToRef(this,tm,this._tmpRay):this._tmpRay=Ray.Transform(this,tm),mesh.intersects(this._tmpRay,fastCheck)},Ray.prototype.intersectsMeshes=function(meshes,fastCheck,results){results?results.length=0:results=[];for(var i=0;i<meshes.length;i++){var pickInfo=this.intersectsMesh(meshes[i],fastCheck);pickInfo.hit&&results.push(pickInfo)}return results.sort(this._comparePickingInfo),results},Ray.prototype._comparePickingInfo=function(pickingInfoA,pickingInfoB){return pickingInfoA.distance<pickingInfoB.distance?-1:pickingInfoA.distance>pickingInfoB.distance?1:0},Ray.prototype.intersectionSegment=function(sega,segb,threshold){var sc,sN,tc,tN,rsegb=this.origin.add(this.direction.multiplyByFloats(Ray.rayl,Ray.rayl,Ray.rayl)),u=segb.subtract(sega),v=rsegb.subtract(this.origin),w=sega.subtract(this.origin),a=BABYLON.Vector3.Dot(u,u),b=BABYLON.Vector3.Dot(u,v),c=BABYLON.Vector3.Dot(v,v),d=BABYLON.Vector3.Dot(u,w),e=BABYLON.Vector3.Dot(v,w),D=a*c-b*b,sD=D,tD=D;D<Ray.smallnum?(sN=0,sD=1,tN=e,tD=c):(tN=a*e-b*d,(sN=b*e-c*d)<0?(sN=0,tN=e,tD=c):sN>sD&&(sN=sD,tN=e+b,tD=c)),tN<0?(tN=0,-d<0?sN=0:-d>a?sN=sD:(sN=-d,sD=a)):tN>tD&&(tN=tD,-d+b<0?sN=0:-d+b>a?sN=sD:(sN=-d+b,sD=a)),sc=Math.abs(sN)<Ray.smallnum?0:sN/sD,tc=Math.abs(tN)<Ray.smallnum?0:tN/tD;var qtc=v.multiplyByFloats(tc,tc,tc),dP=w.add(u.multiplyByFloats(sc,sc,sc)).subtract(qtc);return tc>0&&tc<=this.length&&dP.lengthSquared()<threshold*threshold?qtc.length():-1},Ray.prototype.update=function(x,y,viewportWidth,viewportHeight,world,view,projection){return BABYLON.Vector3.UnprojectFloatsToRef(x,y,0,viewportWidth,viewportHeight,world,view,projection,this.origin),BABYLON.Vector3.UnprojectFloatsToRef(x,y,1,viewportWidth,viewportHeight,world,view,projection,BABYLON.Tmp.Vector3[0]),BABYLON.Tmp.Vector3[0].subtractToRef(this.origin,this.direction),this.direction.normalize(),this},Ray.Zero=function(){return new Ray(BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero())},Ray.CreateNew=function(x,y,viewportWidth,viewportHeight,world,view,projection){return Ray.Zero().update(x,y,viewportWidth,viewportHeight,world,view,projection)},Ray.CreateNewFromTo=function(origin,end,world){void 0===world&&(world=BABYLON.Matrix.Identity());var direction=end.subtract(origin),length=Math.sqrt(direction.x*direction.x+direction.y*direction.y+direction.z*direction.z);return direction.normalize(),Ray.Transform(new Ray(origin,direction,length),world)},Ray.Transform=function(ray,matrix){var result=new Ray(new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,0));return Ray.TransformToRef(ray,matrix,result),result},Ray.TransformToRef=function(ray,matrix,result){BABYLON.Vector3.TransformCoordinatesToRef(ray.origin,matrix,result.origin),BABYLON.Vector3.TransformNormalToRef(ray.direction,matrix,result.direction),result.length=ray.length;var dir=result.direction,len=dir.length();if(0!==len&&1!==len){var num=1/len;dir.x*=num,dir.y*=num,dir.z*=num,result.length*=len}},Ray.smallnum=1e-8,Ray.rayl=1e9,Ray}();BABYLON.Ray=Ray}(BABYLON||(BABYLON={}));!function(BABYLON){var intersectBoxAASphere=function(boxMin,boxMax,sphereCenter,sphereRadius){return!(boxMin.x>sphereCenter.x+sphereRadius)&&(!(sphereCenter.x-sphereRadius>boxMax.x)&&(!(boxMin.y>sphereCenter.y+sphereRadius)&&(!(sphereCenter.y-sphereRadius>boxMax.y)&&(!(boxMin.z>sphereCenter.z+sphereRadius)&&!(sphereCenter.z-sphereRadius>boxMax.z)))))},getLowestRoot=function(){var result={root:0,found:!1};return function(a,b,c,maxR){result.root=0,result.found=!1;var determinant=b*b-4*a*c;if(determinant<0)return result;var sqrtD=Math.sqrt(determinant),r1=(-b-sqrtD)/(2*a),r2=(-b+sqrtD)/(2*a);if(r1>r2){var temp=r2;r2=r1,r1=temp}return r1>0&&r1<maxR?(result.root=r1,result.found=!0,result):r2>0&&r2<maxR?(result.root=r2,result.found=!0,result):result}}(),Collider=function(){function Collider(){this._collisionPoint=BABYLON.Vector3.Zero(),this._planeIntersectionPoint=BABYLON.Vector3.Zero(),this._tempVector=BABYLON.Vector3.Zero(),this._tempVector2=BABYLON.Vector3.Zero(),this._tempVector3=BABYLON.Vector3.Zero(),this._tempVector4=BABYLON.Vector3.Zero(),this._edge=BABYLON.Vector3.Zero(),this._baseToVertex=BABYLON.Vector3.Zero(),this._destinationPoint=BABYLON.Vector3.Zero(),this._slidePlaneNormal=BABYLON.Vector3.Zero(),this._displacementVector=BABYLON.Vector3.Zero(),this._radius=BABYLON.Vector3.One(),this._retry=0,this._basePointWorld=BABYLON.Vector3.Zero(),this._velocityWorld=BABYLON.Vector3.Zero(),this._normalizedVelocity=BABYLON.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(Collider.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(mask){this._collisionMask=isNaN(mask)?-1:mask},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),Collider.prototype._initialize=function(source,dir,e){this._velocity=dir,BABYLON.Vector3.NormalizeToRef(dir,this._normalizedVelocity),this._basePoint=source,source.multiplyToRef(this._radius,this._basePointWorld),dir.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=e,this.collisionFound=!1},Collider.prototype._checkPointInTriangle=function(point,pa,pb,pc,n){pa.subtractToRef(point,this._tempVector),pb.subtractToRef(point,this._tempVector2),BABYLON.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var d=BABYLON.Vector3.Dot(this._tempVector4,n);return!(d<0)&&(pc.subtractToRef(point,this._tempVector3),BABYLON.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((d=BABYLON.Vector3.Dot(this._tempVector4,n))<0)&&(BABYLON.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(d=BABYLON.Vector3.Dot(this._tempVector4,n))>=0))},Collider.prototype._canDoCollision=function(sphereCenter,sphereRadius,vecMin,vecMax){var distance=BABYLON.Vector3.Distance(this._basePointWorld,sphereCenter),max=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(distance>this._velocityWorldLength+max+sphereRadius)&&!!intersectBoxAASphere(vecMin,vecMax,this._basePointWorld,this._velocityWorldLength+max)},Collider.prototype._testTriangle=function(faceIndex,trianglePlaneArray,p1,p2,p3,hasMaterial){var t0,embeddedInPlane=!1;trianglePlaneArray||(trianglePlaneArray=[]),trianglePlaneArray[faceIndex]||(trianglePlaneArray[faceIndex]=new BABYLON.Plane(0,0,0,0),trianglePlaneArray[faceIndex].copyFromPoints(p1,p2,p3));var trianglePlane=trianglePlaneArray[faceIndex];if(hasMaterial||trianglePlane.isFrontFacingTo(this._normalizedVelocity,0)){var signedDistToTrianglePlane=trianglePlane.signedDistanceTo(this._basePoint),normalDotVelocity=BABYLON.Vector3.Dot(trianglePlane.normal,this._velocity);if(0==normalDotVelocity){if(Math.abs(signedDistToTrianglePlane)>=1)return;embeddedInPlane=!0,t0=0}else{var t1=(1-signedDistToTrianglePlane)/normalDotVelocity;if((t0=(-1-signedDistToTrianglePlane)/normalDotVelocity)>t1){var temp=t1;t1=t0,t0=temp}if(t0>1||t1<0)return;t0<0&&(t0=0),t0>1&&(t0=1)}this._collisionPoint.copyFromFloats(0,0,0);var found=!1,t=1;if(embeddedInPlane||(this._basePoint.subtractToRef(trianglePlane.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(t0,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,p1,p2,p3,trianglePlane.normal)&&(found=!0,t=t0,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!found){var velocitySquaredLength=this._velocity.lengthSquared(),a=velocitySquaredLength;this._basePoint.subtractToRef(p1,this._tempVector);var b=2*BABYLON.Vector3.Dot(this._velocity,this._tempVector),c=this._tempVector.lengthSquared()-1,lowestRoot=getLowestRoot(a,b,c,t);lowestRoot.found&&(t=lowestRoot.root,found=!0,this._collisionPoint.copyFrom(p1)),this._basePoint.subtractToRef(p2,this._tempVector),b=2*BABYLON.Vector3.Dot(this._velocity,this._tempVector),c=this._tempVector.lengthSquared()-1,(lowestRoot=getLowestRoot(a,b,c,t)).found&&(t=lowestRoot.root,found=!0,this._collisionPoint.copyFrom(p2)),this._basePoint.subtractToRef(p3,this._tempVector),b=2*BABYLON.Vector3.Dot(this._velocity,this._tempVector),c=this._tempVector.lengthSquared()-1,(lowestRoot=getLowestRoot(a,b,c,t)).found&&(t=lowestRoot.root,found=!0,this._collisionPoint.copyFrom(p3)),p2.subtractToRef(p1,this._edge),p1.subtractToRef(this._basePoint,this._baseToVertex);var edgeSquaredLength=this._edge.lengthSquared(),edgeDotVelocity=BABYLON.Vector3.Dot(this._edge,this._velocity),edgeDotBaseToVertex=BABYLON.Vector3.Dot(this._edge,this._baseToVertex);if(a=edgeSquaredLength*-velocitySquaredLength+edgeDotVelocity*edgeDotVelocity,b=edgeSquaredLength*(2*BABYLON.Vector3.Dot(this._velocity,this._baseToVertex))-2*edgeDotVelocity*edgeDotBaseToVertex,c=edgeSquaredLength*(1-this._baseToVertex.lengthSquared())+edgeDotBaseToVertex*edgeDotBaseToVertex,(lowestRoot=getLowestRoot(a,b,c,t)).found){var f=(edgeDotVelocity*lowestRoot.root-edgeDotBaseToVertex)/edgeSquaredLength;f>=0&&f<=1&&(t=lowestRoot.root,found=!0,this._edge.scaleInPlace(f),p1.addToRef(this._edge,this._collisionPoint))}p3.subtractToRef(p2,this._edge),p2.subtractToRef(this._basePoint,this._baseToVertex),edgeSquaredLength=this._edge.lengthSquared(),edgeDotVelocity=BABYLON.Vector3.Dot(this._edge,this._velocity),edgeDotBaseToVertex=BABYLON.Vector3.Dot(this._edge,this._baseToVertex),a=edgeSquaredLength*-velocitySquaredLength+edgeDotVelocity*edgeDotVelocity,b=edgeSquaredLength*(2*BABYLON.Vector3.Dot(this._velocity,this._baseToVertex))-2*edgeDotVelocity*edgeDotBaseToVertex,c=edgeSquaredLength*(1-this._baseToVertex.lengthSquared())+edgeDotBaseToVertex*edgeDotBaseToVertex,(lowestRoot=getLowestRoot(a,b,c,t)).found&&(f=(edgeDotVelocity*lowestRoot.root-edgeDotBaseToVertex)/edgeSquaredLength)>=0&&f<=1&&(t=lowestRoot.root,found=!0,this._edge.scaleInPlace(f),p2.addToRef(this._edge,this._collisionPoint)),p1.subtractToRef(p3,this._edge),p3.subtractToRef(this._basePoint,this._baseToVertex),edgeSquaredLength=this._edge.lengthSquared(),edgeDotVelocity=BABYLON.Vector3.Dot(this._edge,this._velocity),edgeDotBaseToVertex=BABYLON.Vector3.Dot(this._edge,this._baseToVertex),a=edgeSquaredLength*-velocitySquaredLength+edgeDotVelocity*edgeDotVelocity,b=edgeSquaredLength*(2*BABYLON.Vector3.Dot(this._velocity,this._baseToVertex))-2*edgeDotVelocity*edgeDotBaseToVertex,c=edgeSquaredLength*(1-this._baseToVertex.lengthSquared())+edgeDotBaseToVertex*edgeDotBaseToVertex,(lowestRoot=getLowestRoot(a,b,c,t)).found&&(f=(edgeDotVelocity*lowestRoot.root-edgeDotBaseToVertex)/edgeSquaredLength)>=0&&f<=1&&(t=lowestRoot.root,found=!0,this._edge.scaleInPlace(f),p3.addToRef(this._edge,this._collisionPoint))}if(found){var distToCollision=t*this._velocity.length();(!this.collisionFound||distToCollision<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=distToCollision,this.collisionFound=!0)}}},Collider.prototype._collide=function(trianglePlaneArray,pts,indices,indexStart,indexEnd,decal,hasMaterial){for(var i=indexStart;i<indexEnd;i+=3){var p1=pts[indices[i]-decal],p2=pts[indices[i+1]-decal],p3=pts[indices[i+2]-decal];this._testTriangle(i,trianglePlaneArray,p3,p2,p1,hasMaterial)}},Collider.prototype._getResponse=function(pos,vel){pos.addToRef(vel,this._destinationPoint),vel.scaleInPlace(this._nearestDistance/vel.length()),this._basePoint.addToRef(vel,pos),pos.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),pos.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(BABYLON.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,vel)},Collider}();BABYLON.Collider=Collider}(BABYLON||(BABYLON={}));!function(BABYLON){BABYLON.CollisionWorker="";var WorkerTaskType;!function(WorkerTaskType){WorkerTaskType[WorkerTaskType.INIT=0]="INIT",WorkerTaskType[WorkerTaskType.UPDATE=1]="UPDATE",WorkerTaskType[WorkerTaskType.COLLIDE=2]="COLLIDE"}(WorkerTaskType=BABYLON.WorkerTaskType||(BABYLON.WorkerTaskType={}));var WorkerReplyType;!function(WorkerReplyType){WorkerReplyType[WorkerReplyType.SUCCESS=0]="SUCCESS",WorkerReplyType[WorkerReplyType.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(WorkerReplyType=BABYLON.WorkerReplyType||(BABYLON.WorkerReplyType={}));var CollisionCoordinatorWorker=function(){function CollisionCoordinatorWorker(){var _this=this;this._scaledPosition=BABYLON.Vector3.Zero(),this._scaledVelocity=BABYLON.Vector3.Zero(),this.onMeshUpdated=function(transformNode){_this._addUpdateMeshesList[transformNode.uniqueId]=CollisionCoordinatorWorker.SerializeMesh(transformNode)},this.onGeometryUpdated=function(geometry){_this._addUpdateGeometriesList[geometry.id]=CollisionCoordinatorWorker.SerializeGeometry(geometry)},this._afterRender=function(){if(_this._init&&!(0==_this._toRemoveGeometryArray.length&&0==_this._toRemoveMeshesArray.length&&0==Object.keys(_this._addUpdateGeometriesList).length&&0==Object.keys(_this._addUpdateMeshesList).length||_this._runningUpdated>4)){++_this._runningUpdated;var payload={updatedMeshes:_this._addUpdateMeshesList,updatedGeometries:_this._addUpdateGeometriesList,removedGeometries:_this._toRemoveGeometryArray,removedMeshes:_this._toRemoveMeshesArray},message={payload:payload,taskType:WorkerTaskType.UPDATE},serializable=[];for(var id in payload.updatedGeometries)payload.updatedGeometries.hasOwnProperty(id)&&(serializable.push(message.payload.updatedGeometries[id].indices.buffer),serializable.push(message.payload.updatedGeometries[id].normals.buffer),serializable.push(message.payload.updatedGeometries[id].positions.buffer));_this._worker.postMessage(message,serializable),_this._addUpdateMeshesList={},_this._addUpdateGeometriesList={},_this._toRemoveGeometryArray=[],_this._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(e){var returnData=e.data;if(returnData.error==WorkerReplyType.SUCCESS)switch(returnData.taskType){case WorkerTaskType.INIT:_this._init=!0,_this._scene.meshes.forEach(function(mesh){_this.onMeshAdded(mesh)}),_this._scene.getGeometries().forEach(function(geometry){_this.onGeometryAdded(geometry)});break;case WorkerTaskType.UPDATE:_this._runningUpdated--;break;case WorkerTaskType.COLLIDE:var returnPayload=returnData.payload;if(!_this._collisionsCallbackArray[returnPayload.collisionId])return;var callback=_this._collisionsCallbackArray[returnPayload.collisionId];if(callback){var mesh=_this._scene.getMeshByUniqueID(returnPayload.collidedMeshUniqueId);mesh&&callback(returnPayload.collisionId,BABYLON.Vector3.FromArray(returnPayload.newPosition),mesh)}_this._collisionsCallbackArray[returnPayload.collisionId]=null}else BABYLON.Tools.Warn("error returned from worker!")},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return CollisionCoordinatorWorker.prototype.getNewPosition=function(position,displacement,collider,maximumRetry,excludedMesh,onNewPosition,collisionIndex){if(this._init&&!this._collisionsCallbackArray[collisionIndex]&&!this._collisionsCallbackArray[collisionIndex+1e5]){position.divideToRef(collider._radius,this._scaledPosition),displacement.divideToRef(collider._radius,this._scaledVelocity),this._collisionsCallbackArray[collisionIndex]=onNewPosition;var message={payload:{collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:collider._radius.asArray()},collisionId:collisionIndex,excludedMeshUniqueId:excludedMesh?excludedMesh.uniqueId:null,maximumRetry:maximumRetry},taskType:WorkerTaskType.COLLIDE};this._worker.postMessage(message)}},CollisionCoordinatorWorker.prototype.init=function(scene){this._scene=scene,this._scene.registerAfterRender(this._afterRender);var workerUrl=BABYLON.WorkerIncluded?BABYLON.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([BABYLON.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(workerUrl),this._worker.onmessage=this._onMessageFromWorker;var message={payload:{},taskType:WorkerTaskType.INIT};this._worker.postMessage(message)},CollisionCoordinatorWorker.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},CollisionCoordinatorWorker.prototype.onMeshAdded=function(mesh){mesh.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(mesh)},CollisionCoordinatorWorker.prototype.onMeshRemoved=function(mesh){this._toRemoveMeshesArray.push(mesh.uniqueId)},CollisionCoordinatorWorker.prototype.onGeometryAdded=function(geometry){geometry.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(geometry)},CollisionCoordinatorWorker.prototype.onGeometryDeleted=function(geometry){this._toRemoveGeometryArray.push(geometry.id)},CollisionCoordinatorWorker.SerializeMesh=function(mesh){var submeshes=[];mesh.subMeshes&&(submeshes=mesh.subMeshes.map(function(sm,idx){var boundingInfo=sm.getBoundingInfo();return{position:idx,verticesStart:sm.verticesStart,verticesCount:sm.verticesCount,indexStart:sm.indexStart,indexCount:sm.indexCount,hasMaterial:!!sm.getMaterial(),sphereCenter:boundingInfo.boundingSphere.centerWorld.asArray(),sphereRadius:boundingInfo.boundingSphere.radiusWorld,boxMinimum:boundingInfo.boundingBox.minimumWorld.asArray(),boxMaximum:boundingInfo.boundingBox.maximumWorld.asArray()}}));var geometryId=null;if(mesh instanceof BABYLON.Mesh)geometryId=(geometry=mesh.geometry)?geometry.id:null;else if(mesh instanceof BABYLON.InstancedMesh){var geometry=mesh.sourceMesh.geometry;geometryId=geometry?geometry.id:null}var boundingInfo=mesh.getBoundingInfo();return{uniqueId:mesh.uniqueId,id:mesh.id,name:mesh.name,geometryId:geometryId,sphereCenter:boundingInfo.boundingSphere.centerWorld.asArray(),sphereRadius:boundingInfo.boundingSphere.radiusWorld,boxMinimum:boundingInfo.boundingBox.minimumWorld.asArray(),boxMaximum:boundingInfo.boundingBox.maximumWorld.asArray(),worldMatrixFromCache:mesh.worldMatrixFromCache.asArray(),subMeshes:submeshes,checkCollisions:mesh.checkCollisions}},CollisionCoordinatorWorker.SerializeGeometry=function(geometry){return{id:geometry.id,positions:new Float32Array(geometry.getVerticesData(BABYLON.VertexBuffer.PositionKind)||[]),normals:new Float32Array(geometry.getVerticesData(BABYLON.VertexBuffer.NormalKind)||[]),indices:new Uint32Array(geometry.getIndices()||[])}},CollisionCoordinatorWorker}();BABYLON.CollisionCoordinatorWorker=CollisionCoordinatorWorker;var CollisionCoordinatorLegacy=function(){function CollisionCoordinatorLegacy(){this._scaledPosition=BABYLON.Vector3.Zero(),this._scaledVelocity=BABYLON.Vector3.Zero(),this._finalPosition=BABYLON.Vector3.Zero()}return CollisionCoordinatorLegacy.prototype.getNewPosition=function(position,displacement,collider,maximumRetry,excludedMesh,onNewPosition,collisionIndex){position.divideToRef(collider._radius,this._scaledPosition),displacement.divideToRef(collider._radius,this._scaledVelocity),collider.collidedMesh=null,collider._retry=0,collider._initialVelocity=this._scaledVelocity,collider._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,collider,maximumRetry,this._finalPosition,excludedMesh),this._finalPosition.multiplyInPlace(collider._radius),onNewPosition(collisionIndex,this._finalPosition,collider.collidedMesh)},CollisionCoordinatorLegacy.prototype.init=function(scene){this._scene=scene},CollisionCoordinatorLegacy.prototype.destroy=function(){},CollisionCoordinatorLegacy.prototype.onMeshAdded=function(mesh){},CollisionCoordinatorLegacy.prototype.onMeshUpdated=function(mesh){},CollisionCoordinatorLegacy.prototype.onMeshRemoved=function(mesh){},CollisionCoordinatorLegacy.prototype.onGeometryAdded=function(geometry){},CollisionCoordinatorLegacy.prototype.onGeometryUpdated=function(geometry){},CollisionCoordinatorLegacy.prototype.onGeometryDeleted=function(geometry){},CollisionCoordinatorLegacy.prototype._collideWithWorld=function(position,velocity,collider,maximumRetry,finalPosition,excludedMesh){void 0===excludedMesh&&(excludedMesh=null);var closeDistance=10*BABYLON.Engine.CollisionsEpsilon;if(collider._retry>=maximumRetry)finalPosition.copyFrom(position);else{var collisionMask=excludedMesh?excludedMesh.collisionMask:collider.collisionMask;collider._initialize(position,velocity,closeDistance);for(var index=0;index<this._scene.meshes.length;index++){var mesh=this._scene.meshes[index];mesh.isEnabled()&&mesh.checkCollisions&&mesh.subMeshes&&mesh!==excludedMesh&&0!=(collisionMask&mesh.collisionGroup)&&mesh._checkCollision(collider)}collider.collisionFound?(0===velocity.x&&0===velocity.y&&0===velocity.z||collider._getResponse(position,velocity),velocity.length()<=closeDistance?finalPosition.copyFrom(position):(collider._retry++,this._collideWithWorld(position,velocity,collider,maximumRetry,finalPosition,excludedMesh))):position.addToRef(velocity,finalPosition)}},CollisionCoordinatorLegacy}();BABYLON.CollisionCoordinatorLegacy=CollisionCoordinatorLegacy}(BABYLON||(BABYLON={}));!function(BABYLON){var Particle=function(){function Particle(particleSystem){this.particleSystem=particleSystem,this.position=BABYLON.Vector3.Zero(),this.direction=BABYLON.Vector3.Zero(),this.color=new BABYLON.Color4(0,0,0,0),this.colorStep=new BABYLON.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.angle=0,this.angularSpeed=0,this._currentFrameCounter=0,this.cellIndex=0,this.particleSystem.isAnimationSheetEnabled&&(this.cellIndex=this.particleSystem.startSpriteCellID,0==this.particleSystem.spriteCellChangeSpeed?this.updateCellIndex=this.updateCellIndexWithSpeedCalculated:this.updateCellIndex=this.updateCellIndexWithCustomSpeed)}return Particle.prototype.updateCellIndexWithSpeedCalculated=function(scaledUpdateSpeed){var numberOfScaledUpdatesPerCell=(this.lifeTime-this.age)/scaledUpdateSpeed/(this.particleSystem.endSpriteCellID+1-this.cellIndex);this._currentFrameCounter+=scaledUpdateSpeed,this._currentFrameCounter>=numberOfScaledUpdatesPerCell*scaledUpdateSpeed&&(this._currentFrameCounter=0,this.cellIndex++,this.cellIndex>this.particleSystem.endSpriteCellID&&(this.cellIndex=this.particleSystem.endSpriteCellID))},Particle.prototype.updateCellIndexWithCustomSpeed=function(){this._currentFrameCounter>=this.particleSystem.spriteCellChangeSpeed?(this.cellIndex++,this._currentFrameCounter=0,this.cellIndex>this.particleSystem.endSpriteCellID&&(this.particleSystem.spriteCellLoop?this.cellIndex=this.particleSystem.startSpriteCellID:this.cellIndex=this.particleSystem.endSpriteCellID)):this._currentFrameCounter++},Particle.prototype.copyTo=function(other){other.position.copyFrom(this.position),other.direction.copyFrom(this.direction),other.color.copyFrom(this.color),other.colorStep.copyFrom(this.colorStep),other.lifeTime=this.lifeTime,other.age=this.age,other.size=this.size,other.angle=this.angle,other.angularSpeed=this.angularSpeed,other.particleSystem=this.particleSystem,other.cellIndex=this.cellIndex},Particle}();BABYLON.Particle=Particle}(BABYLON||(BABYLON={}));!function(BABYLON){var randomNumber=function(min,max){return min===max?min:Math.random()*(max-min)+min},ParticleSystem=function(){function ParticleSystem(name,capacity,scene,customEffect,_isAnimationSheetEnabled,epsilon){void 0===customEffect&&(customEffect=null),void 0===_isAnimationSheetEnabled&&(_isAnimationSheetEnabled=!1),void 0===epsilon&&(epsilon=.01);var _this=this;this.name=name,this._isAnimationSheetEnabled=_isAnimationSheetEnabled,this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.onDisposeObservable=new BABYLON.Observable,this.onAnimationEnd=null,this.blendMode=ParticleSystem.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=BABYLON.Vector3.Zero(),this.direction1=new BABYLON.Vector3(0,1,0),this.direction2=new BABYLON.Vector3(0,1,0),this.minEmitBox=new BABYLON.Vector3(-.5,-.5,-.5),this.maxEmitBox=new BABYLON.Vector3(.5,.5,.5),this.color1=new BABYLON.Color4(1,1,1,1),this.color2=new BABYLON.Color4(1,1,1,1),this.colorDead=new BABYLON.Color4(0,0,0,1),this.textureMask=new BABYLON.Color4(1,1,1,1),this.particles=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new BABYLON.Color4(0,0,0,0),this._colorDiff=new BABYLON.Color4(0,0,0,0),this._scaledDirection=BABYLON.Vector3.Zero(),this._scaledGravity=BABYLON.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellLoop=!0,this.spriteCellChangeSpeed=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this._vertexBufferSize=11,this.appendParticleVertexes=null,this.id=name,this._capacity=capacity,this._epsilon=epsilon,_isAnimationSheetEnabled&&(this._vertexBufferSize=12),this._scene=scene||BABYLON.Engine.LastCreatedScene,this._customEffect=customEffect,scene.particleSystems.push(this),this._createIndexBuffer(),this._vertexData=new Float32Array(capacity*this._vertexBufferSize*4),this._vertexBuffer=new BABYLON.Buffer(scene.getEngine(),this._vertexData,!0,this._vertexBufferSize);var positions=this._vertexBuffer.createVertexBuffer(BABYLON.VertexBuffer.PositionKind,0,3),colors=this._vertexBuffer.createVertexBuffer(BABYLON.VertexBuffer.ColorKind,3,4),options=this._vertexBuffer.createVertexBuffer("options",7,4);if(this._isAnimationSheetEnabled){var cellIndexBuffer=this._vertexBuffer.createVertexBuffer("cellIndex",11,1);this._vertexBuffers.cellIndex=cellIndexBuffer}this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=positions,this._vertexBuffers[BABYLON.VertexBuffer.ColorKind]=colors,this._vertexBuffers.options=options,this.startDirectionFunction=function(emitPower,worldMatrix,directionToUpdate,particle){var randX=randomNumber(_this.direction1.x,_this.direction2.x),randY=randomNumber(_this.direction1.y,_this.direction2.y),randZ=randomNumber(_this.direction1.z,_this.direction2.z);BABYLON.Vector3.TransformNormalFromFloatsToRef(randX*emitPower,randY*emitPower,randZ*emitPower,worldMatrix,directionToUpdate)},this.startPositionFunction=function(worldMatrix,positionToUpdate,particle){var randX=randomNumber(_this.minEmitBox.x,_this.maxEmitBox.x),randY=randomNumber(_this.minEmitBox.y,_this.maxEmitBox.y),randZ=randomNumber(_this.minEmitBox.z,_this.maxEmitBox.z);BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(randX,randY,randZ,worldMatrix,positionToUpdate)},this.updateFunction=function(particles){for(var index=0;index<particles.length;index++){var particle=particles[index];particle.age+=_this._scaledUpdateSpeed,particle.age>=particle.lifeTime?(_this.recycleParticle(particle),index--):(particle.colorStep.scaleToRef(_this._scaledUpdateSpeed,_this._scaledColorStep),particle.color.addInPlace(_this._scaledColorStep),particle.color.a<0&&(particle.color.a=0),particle.angle+=particle.angularSpeed*_this._scaledUpdateSpeed,particle.direction.scaleToRef(_this._scaledUpdateSpeed,_this._scaledDirection),particle.position.addInPlace(_this._scaledDirection),_this.gravity.scaleToRef(_this._scaledUpdateSpeed,_this._scaledGravity),particle.direction.addInPlace(_this._scaledGravity),_this._isAnimationSheetEnabled&&particle.updateCellIndex(_this._scaledUpdateSpeed))}}}return Object.defineProperty(ParticleSystem.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(ParticleSystem.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},enumerable:!0,configurable:!0}),ParticleSystem.prototype._createIndexBuffer=function(){for(var indices=[],index=0,count=0;count<this._capacity;count++)indices.push(index),indices.push(index+1),indices.push(index+2),indices.push(index),indices.push(index+2),indices.push(index+3),index+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(indices)},ParticleSystem.prototype.recycleParticle=function(particle){var lastParticle=this.particles.pop();lastParticle!==particle&&(lastParticle.copyTo(particle),this._stockParticles.push(lastParticle))},ParticleSystem.prototype.getCapacity=function(){return this._capacity},ParticleSystem.prototype.isAlive=function(){return this._alive},ParticleSystem.prototype.isStarted=function(){return this._started},ParticleSystem.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},ParticleSystem.prototype.stop=function(){this._stopped=!0},ParticleSystem.prototype._appendParticleVertex=function(index,particle,offsetX,offsetY){var offset=index*this._vertexBufferSize;this._vertexData[offset]=particle.position.x,this._vertexData[offset+1]=particle.position.y,this._vertexData[offset+2]=particle.position.z,this._vertexData[offset+3]=particle.color.r,this._vertexData[offset+4]=particle.color.g,this._vertexData[offset+5]=particle.color.b,this._vertexData[offset+6]=particle.color.a,this._vertexData[offset+7]=particle.angle,this._vertexData[offset+8]=particle.size,this._vertexData[offset+9]=offsetX,this._vertexData[offset+10]=offsetY},ParticleSystem.prototype._appendParticleVertexWithAnimation=function(index,particle,offsetX,offsetY){0===offsetX?offsetX=this._epsilon:1===offsetX&&(offsetX=1-this._epsilon),0===offsetY?offsetY=this._epsilon:1===offsetY&&(offsetY=1-this._epsilon);var offset=index*this._vertexBufferSize;this._vertexData[offset]=particle.position.x,this._vertexData[offset+1]=particle.position.y,this._vertexData[offset+2]=particle.position.z,this._vertexData[offset+3]=particle.color.r,this._vertexData[offset+4]=particle.color.g,this._vertexData[offset+5]=particle.color.b,this._vertexData[offset+6]=particle.color.a,this._vertexData[offset+7]=particle.angle,this._vertexData[offset+8]=particle.size,this._vertexData[offset+9]=offsetX,this._vertexData[offset+10]=offsetY,this._vertexData[offset+11]=particle.cellIndex},ParticleSystem.prototype._update=function(newParticles){this._alive=this.particles.length>0,this.updateFunction(this.particles);var worldMatrix;if(this.emitter.position)worldMatrix=this.emitter.getWorldMatrix();else{var emitterPosition=this.emitter;worldMatrix=BABYLON.Matrix.Translation(emitterPosition.x,emitterPosition.y,emitterPosition.z)}for(var particle,index=0;index<newParticles&&this.particles.length!==this._capacity;index++){0!==this._stockParticles.length?((particle=this._stockParticles.pop()).age=0,particle.cellIndex=this.startSpriteCellID):particle=new BABYLON.Particle(this),this.particles.push(particle);var emitPower=randomNumber(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(emitPower,worldMatrix,particle.direction,particle),particle.lifeTime=randomNumber(this.minLifeTime,this.maxLifeTime),particle.size=randomNumber(this.minSize,this.maxSize),particle.angularSpeed=randomNumber(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(worldMatrix,particle.position,particle);var step=randomNumber(0,1);BABYLON.Color4.LerpToRef(this.color1,this.color2,step,particle.color),this.colorDead.subtractToRef(particle.color,this._colorDiff),this._colorDiff.scaleToRef(1/particle.lifeTime,particle.colorStep)}},ParticleSystem.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var defines=[];this._scene.clipPlane&&defines.push("#define CLIPPLANE"),this._isAnimationSheetEnabled&&defines.push("#define ANIMATESHEET");var join=defines.join("\n");if(this._cachedDefines!==join){this._cachedDefines=join;var attributesNamesOrOptions,effectCreationOption;this._isAnimationSheetEnabled?(attributesNamesOrOptions=[BABYLON.VertexBuffer.PositionKind,BABYLON.VertexBuffer.ColorKind,"options","cellIndex"],effectCreationOption=["invView","view","projection","particlesInfos","vClipPlane","textureMask"]):(attributesNamesOrOptions=[BABYLON.VertexBuffer.PositionKind,BABYLON.VertexBuffer.ColorKind,"options"],effectCreationOption=["invView","view","projection","vClipPlane","textureMask"]),this._effect=this._scene.getEngine().createEffect("particles",attributesNamesOrOptions,effectCreationOption,["diffuseSampler"],join)}return this._effect},ParticleSystem.prototype.animate=function(){if(this._started){var effect=this._getEffect();if(this.emitter&&effect.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var newParticles;this.manualEmitCount>-1?(newParticles=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(newParticles=this.emitRate*this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-newParticles),this._newPartsExcess>1&&(newParticles+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?newParticles=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(newParticles),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),this._isAnimationSheetEnabled?this.appendParticleVertexes=this.appenedParticleVertexesWithSheet:this.appendParticleVertexes=this.appenedParticleVertexesNoSheet;for(var offset=0,index=0;index<this.particles.length;index++){var particle=this.particles[index];this.appendParticleVertexes(offset,particle),offset+=4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}}},ParticleSystem.prototype.appenedParticleVertexesWithSheet=function(offset,particle){this._appendParticleVertexWithAnimation(offset++,particle,0,0),this._appendParticleVertexWithAnimation(offset++,particle,1,0),this._appendParticleVertexWithAnimation(offset++,particle,1,1),this._appendParticleVertexWithAnimation(offset++,particle,0,1)},ParticleSystem.prototype.appenedParticleVertexesNoSheet=function(offset,particle){this._appendParticleVertex(offset++,particle,0,0),this._appendParticleVertex(offset++,particle,1,0),this._appendParticleVertex(offset++,particle,1,1),this._appendParticleVertex(offset++,particle,0,1)},ParticleSystem.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},ParticleSystem.prototype.render=function(){var effect=this._getEffect();if(!(this.emitter&&effect.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var engine=this._scene.getEngine();engine.enableEffect(effect),engine.setState(!1);var viewMatrix=this._scene.getViewMatrix();if(effect.setTexture("diffuseSampler",this.particleTexture),effect.setMatrix("view",viewMatrix),effect.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled){var baseSize=this.particleTexture.getBaseSize();effect.setFloat3("particlesInfos",this.spriteCellWidth/baseSize.width,this.spriteCellHeight/baseSize.height,baseSize.width/this.spriteCellWidth)}if(effect.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var clipPlane=this._scene.clipPlane,invView=viewMatrix.clone();invView.invert(),effect.setMatrix("invView",invView),effect.setFloat4("vClipPlane",clipPlane.normal.x,clipPlane.normal.y,clipPlane.normal.z,clipPlane.d)}return engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect),this.blendMode===ParticleSystem.BLENDMODE_ONEONE?engine.setAlphaMode(BABYLON.Engine.ALPHA_ONEONE):engine.setAlphaMode(BABYLON.Engine.ALPHA_COMBINE),this.forceDepthWrite&&engine.setDepthWrite(!0),engine.draw(!0,0,6*this.particles.length),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE),this.particles.length},ParticleSystem.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var index=this._scene.particleSystems.indexOf(this);index>-1&&this._scene.particleSystems.splice(index,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},ParticleSystem.prototype.clone=function(name,newEmitter){var custom=null,program=null;if(null!=this.customShader){var defines=(program=this.customShader).shaderOptions.defines.length>0?program.shaderOptions.defines.join("\n"):"";custom=this._scene.getEngine().createEffectForParticles(program.shaderPath.fragmentElement,program.shaderOptions.uniforms,program.shaderOptions.samplers,defines)}var result=new ParticleSystem(name,this._capacity,this._scene,custom);return result.customShader=program,BABYLON.Tools.DeepCopy(this,result,["particles","customShader"]),void 0===newEmitter&&(newEmitter=this.emitter),result.emitter=newEmitter,this.particleTexture&&(result.particleTexture=new BABYLON.Texture(this.particleTexture.url,this._scene)),this.preventAutoStart||result.start(),result},ParticleSystem.prototype.serialize=function(){var serializationObject={};if(serializationObject.name=this.name,serializationObject.id=this.id,this.emitter.position){var emitterMesh=this.emitter;serializationObject.emitterId=emitterMesh.id}else{var emitterPosition=this.emitter;serializationObject.emitter=emitterPosition.asArray()}return serializationObject.capacity=this.getCapacity(),this.particleTexture&&(serializationObject.textureName=this.particleTexture.name),BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject.minAngularSpeed=this.minAngularSpeed,serializationObject.maxAngularSpeed=this.maxAngularSpeed,serializationObject.minSize=this.minSize,serializationObject.maxSize=this.maxSize,serializationObject.minEmitPower=this.minEmitPower,serializationObject.maxEmitPower=this.maxEmitPower,serializationObject.minLifeTime=this.minLifeTime,serializationObject.maxLifeTime=this.maxLifeTime,serializationObject.emitRate=this.emitRate,serializationObject.minEmitBox=this.minEmitBox.asArray(),serializationObject.maxEmitBox=this.maxEmitBox.asArray(),serializationObject.gravity=this.gravity.asArray(),serializationObject.direction1=this.direction1.asArray(),serializationObject.direction2=this.direction2.asArray(),serializationObject.color1=this.color1.asArray(),serializationObject.color2=this.color2.asArray(),serializationObject.colorDead=this.colorDead.asArray(),serializationObject.updateSpeed=this.updateSpeed,serializationObject.targetStopDuration=this.targetStopDuration,serializationObject.textureMask=this.textureMask.asArray(),serializationObject.blendMode=this.blendMode,serializationObject.customShader=this.customShader,serializationObject.preventAutoStart=this.preventAutoStart,serializationObject},ParticleSystem.Parse=function(parsedParticleSystem,scene,rootUrl){var name=parsedParticleSystem.name,custom=null,program=null;if(parsedParticleSystem.customShader){var defines=(program=parsedParticleSystem.customShader).shaderOptions.defines.length>0?program.shaderOptions.defines.join("\n"):"";custom=scene.getEngine().createEffectForParticles(program.shaderPath.fragmentElement,program.shaderOptions.uniforms,program.shaderOptions.samplers,defines)}var particleSystem=new ParticleSystem(name,parsedParticleSystem.capacity,scene,custom);if(particleSystem.customShader=program,parsedParticleSystem.id&&(particleSystem.id=parsedParticleSystem.id),parsedParticleSystem.preventAutoStart&&(particleSystem.preventAutoStart=parsedParticleSystem.preventAutoStart),parsedParticleSystem.textureName&&(particleSystem.particleTexture=new BABYLON.Texture(rootUrl+parsedParticleSystem.textureName,scene),particleSystem.particleTexture.name=parsedParticleSystem.textureName),parsedParticleSystem.emitterId?particleSystem.emitter=scene.getLastMeshByID(parsedParticleSystem.emitterId):particleSystem.emitter=BABYLON.Vector3.FromArray(parsedParticleSystem.emitter),parsedParticleSystem.animations)for(var animationIndex=0;animationIndex<parsedParticleSystem.animations.length;animationIndex++){var parsedAnimation=parsedParticleSystem.animations[animationIndex];particleSystem.animations.push(BABYLON.Animation.Parse(parsedAnimation))}return parsedParticleSystem.autoAnimate&&scene.beginAnimation(particleSystem,parsedParticleSystem.autoAnimateFrom,parsedParticleSystem.autoAnimateTo,parsedParticleSystem.autoAnimateLoop,parsedParticleSystem.autoAnimateSpeed||1),particleSystem.minAngularSpeed=parsedParticleSystem.minAngularSpeed,particleSystem.maxAngularSpeed=parsedParticleSystem.maxAngularSpeed,particleSystem.minSize=parsedParticleSystem.minSize,particleSystem.maxSize=parsedParticleSystem.maxSize,particleSystem.minLifeTime=parsedParticleSystem.minLifeTime,particleSystem.maxLifeTime=parsedParticleSystem.maxLifeTime,particleSystem.minEmitPower=parsedParticleSystem.minEmitPower,particleSystem.maxEmitPower=parsedParticleSystem.maxEmitPower,particleSystem.emitRate=parsedParticleSystem.emitRate,particleSystem.minEmitBox=BABYLON.Vector3.FromArray(parsedParticleSystem.minEmitBox),particleSystem.maxEmitBox=BABYLON.Vector3.FromArray(parsedParticleSystem.maxEmitBox),particleSystem.gravity=BABYLON.Vector3.FromArray(parsedParticleSystem.gravity),particleSystem.direction1=BABYLON.Vector3.FromArray(parsedParticleSystem.direction1),particleSystem.direction2=BABYLON.Vector3.FromArray(parsedParticleSystem.direction2),particleSystem.color1=BABYLON.Color4.FromArray(parsedParticleSystem.color1),particleSystem.color2=BABYLON.Color4.FromArray(parsedParticleSystem.color2),particleSystem.colorDead=BABYLON.Color4.FromArray(parsedParticleSystem.colorDead),particleSystem.updateSpeed=parsedParticleSystem.updateSpeed,particleSystem.targetStopDuration=parsedParticleSystem.targetStopDuration,particleSystem.textureMask=BABYLON.Color4.FromArray(parsedParticleSystem.textureMask),particleSystem.blendMode=parsedParticleSystem.blendMode,particleSystem.preventAutoStart||particleSystem.start(),particleSystem},ParticleSystem.BLENDMODE_ONEONE=0,ParticleSystem.BLENDMODE_STANDARD=1,ParticleSystem}();BABYLON.ParticleSystem=ParticleSystem}(BABYLON||(BABYLON={}));!function(BABYLON){var GPUParticleSystem=function(){function GPUParticleSystem(name,capacity,scene){this.name=name,this.emitter=null,this.renderingGroupId=0,this.layerMask=268435455,this._updateVertexBuffers={},this._renderVertexBuffers={},this._currentRenderId=-1,this._started=!0,this.onDisposeObservable=new BABYLON.Observable,this.id=name,this._scene=scene||BABYLON.Engine.LastCreatedScene,this._capacity=capacity,this._engine=this._scene.getEngine(),this._scene.particleSystems.push(this),this._renderEffect=new BABYLON.Effect("gpuRenderParticles",["position","age","life","velocity"],[],[],this._scene.getEngine());var updateEffectOptions={attributes:["position","age","life","velocity"],uniformsNames:[],uniformBuffersNames:[],samplers:[],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition","outAge","outLife","outVelocity"]};this._updateEffect=new BABYLON.Effect("gpuUpdateParticles",updateEffectOptions,this._scene.getEngine())}return GPUParticleSystem.prototype.isStarted=function(){return this._started},GPUParticleSystem.prototype.start=function(){this._started=!0},GPUParticleSystem.prototype.stop=function(){this._started=!1},GPUParticleSystem.prototype.animate=function(){},GPUParticleSystem.prototype._initialize=function(){if(!this._renderVAO){for(var data=new Array,particleIndex=0;particleIndex<this._capacity;particleIndex++){data.push(0),data.push(0),data.push(0);var life=1+10*Math.random();data.push(life+1),data.push(life),data.push(0),data.push(0),data.push(0)}this._updateBuffer=new BABYLON.Buffer(this._scene.getEngine(),data,!1,0),this._updateVertexBuffers.position=this._updateBuffer.createVertexBuffer("position",0,3,3),this._updateVertexBuffers.age=this._updateBuffer.createVertexBuffer("age",3,1,1),this._updateVertexBuffers.life=this._updateBuffer.createVertexBuffer("life",4,1,1),this._updateVertexBuffers.velocity=this._updateBuffer.createVertexBuffer("velocity",5,3,3),this._updateVAO=this._engine.recordVertexArrayObject(this._updateVertexBuffers,null,this._updateEffect),this._engine.bindArrayBuffer(null),this._renderBuffer=new BABYLON.Buffer(this._scene.getEngine(),data,!1,0),this._renderVertexBuffers.position=this._renderBuffer.createVertexBuffer("position",0,3,3),this._renderVertexBuffers.age=this._renderBuffer.createVertexBuffer("age",3,1,1),this._renderVertexBuffers.life=this._renderBuffer.createVertexBuffer("life",4,1,1),this._renderVertexBuffers.velocity=this._renderBuffer.createVertexBuffer("velocity",5,3,3),this._renderVAO=this._engine.recordVertexArrayObject(this._renderVertexBuffers,null,this._renderEffect),this._engine.bindArrayBuffer(null),this._sourceVAO=this._updateVAO,this._targetVAO=this._renderVAO,this._sourceBuffer=this._updateBuffer,this._targetBuffer=this._renderBuffer}},GPUParticleSystem.prototype.render=function(){if(!this.emitter||!this._updateEffect.isReady()||!this._renderEffect.isReady())return 0;if(this._initialize(),this._currentRenderId===this._scene.getRenderId())return 0;this._currentRenderId=this._scene.getRenderId(),this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._engine.bindVertexArrayObject(this._sourceVAO,null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(),this._engine.drawPointClouds(0,this._capacity),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),this._engine.enableEffect(this._renderEffect),this._engine.bindVertexArrayObject(this._targetVAO,null),this._engine.drawPointClouds(0,this._capacity);var tmpVAO=this._sourceVAO;this._sourceVAO=this._targetVAO,this._targetVAO=tmpVAO;var tmpBuffer=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=tmpBuffer,0},GPUParticleSystem.prototype.rebuild=function(){},GPUParticleSystem.prototype.dispose=function(){var index=this._scene.particleSystems.indexOf(this);index>-1&&this._scene.particleSystems.splice(index,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},GPUParticleSystem.prototype.clone=function(name,newEmitter){return null},GPUParticleSystem.prototype.serialize=function(){},GPUParticleSystem}();BABYLON.GPUParticleSystem=GPUParticleSystem}(BABYLON||(BABYLON={}));!function(BABYLON){var SolidParticle=function(){function SolidParticle(particleIndex,positionIndex,indiceIndex,model,shapeId,idxInShape,sps,modelBoundingInfo){void 0===modelBoundingInfo&&(modelBoundingInfo=null),this.idx=0,this.color=new BABYLON.Color4(1,1,1,1),this.position=BABYLON.Vector3.Zero(),this.rotation=BABYLON.Vector3.Zero(),this.scaling=BABYLON.Vector3.One(),this.uvs=new BABYLON.Vector4(0,0,1,1),this.velocity=BABYLON.Vector3.Zero(),this.pivot=BABYLON.Vector3.Zero(),this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this.idx=particleIndex,this._pos=positionIndex,this._ind=indiceIndex,this._model=model,this.shapeId=shapeId,this.idxInShape=idxInShape,this._sps=sps,modelBoundingInfo&&(this._modelBoundingInfo=modelBoundingInfo,this._boundingInfo=new BABYLON.BoundingInfo(modelBoundingInfo.minimum,modelBoundingInfo.maximum))}return Object.defineProperty(SolidParticle.prototype,"scale",{get:function(){return this.scaling},set:function(scale){this.scaling=scale},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticle.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(q){this.rotationQuaternion=q},enumerable:!0,configurable:!0}),SolidParticle.prototype.intersectsMesh=function(target){return!(!this._boundingInfo||!target._boundingInfo)&&(this._sps._bSphereOnly?BABYLON.BoundingSphere.Intersects(this._boundingInfo.boundingSphere,target._boundingInfo.boundingSphere):this._boundingInfo.intersects(target._boundingInfo,!1))},SolidParticle}();BABYLON.SolidParticle=SolidParticle;var ModelShape=function(){return function(id,shape,indicesLength,shapeUV,posFunction,vtxFunction){this._indicesLength=0,this.shapeID=id,this._shape=shape,this._indicesLength=indicesLength,this._shapeUV=shapeUV,this._positionFunction=posFunction,this._vertexFunction=vtxFunction}}();BABYLON.ModelShape=ModelShape;var DepthSortedParticle=function(){return function(){this.ind=0,this.indicesLength=0,this.sqDistance=0}}();BABYLON.DepthSortedParticle=DepthSortedParticle}(BABYLON||(BABYLON={}));!function(BABYLON){var SolidParticleSystem=function(){function SolidParticleSystem(name,scene,options){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new BABYLON.SolidParticle(0,0,0,null,0,0,this),this._color=new BABYLON.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._cam_axisZ=BABYLON.Vector3.Zero(),this._cam_axisY=BABYLON.Vector3.Zero(),this._cam_axisX=BABYLON.Vector3.Zero(),this._axisZ=BABYLON.Axis.Z,this._camDir=BABYLON.Vector3.Zero(),this._camInvertedPosition=BABYLON.Vector3.Zero(),this._rotMatrix=new BABYLON.Matrix,this._invertMatrix=new BABYLON.Matrix,this._rotated=BABYLON.Vector3.Zero(),this._quaternion=new BABYLON.Quaternion,this._vertex=BABYLON.Vector3.Zero(),this._normal=BABYLON.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._mustUnrotateFixedNormals=!1,this._minimum=BABYLON.Tmp.Vector3[0],this._maximum=BABYLON.Tmp.Vector3[1],this._minBbox=BABYLON.Tmp.Vector3[4],this._maxBbox=BABYLON.Tmp.Vector3[5],this._particlesIntersect=!1,this._depthSortFunction=function(p1,p2){return p2.sqDistance-p1.sqDistance},this._needs32Bits=!1,this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this.name=name,this._scene=scene||BABYLON.Engine.LastCreatedScene,this._camera=scene.activeCamera,this._pickable=!!options&&options.isPickable,this._depthSort=!!options&&options.enableDepthSort,this._particlesIntersect=!!options&&options.particleIntersection,this._bSphereOnly=!!options&&options.boundingSphereOnly,this._bSphereRadiusFactor=options&&options.bSphereRadiusFactor?options.bSphereRadiusFactor:1,options&&options.updatable?this._updatable=options.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return SolidParticleSystem.prototype.buildMesh=function(){if(0===this.nbParticles){var triangle=BABYLON.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(triangle,1),triangle.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&BABYLON.VertexData.ComputeNormals(this._positions32,this._indices,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var vertexData=new BABYLON.VertexData;vertexData.indices=this._depthSort?this._indices:this._indices32,vertexData.set(this._positions32,BABYLON.VertexBuffer.PositionKind),vertexData.set(this._normals32,BABYLON.VertexBuffer.NormalKind),this._uvs32&&vertexData.set(this._uvs32,BABYLON.VertexBuffer.UVKind),this._colors32&&vertexData.set(this._colors32,BABYLON.VertexBuffer.ColorKind);var mesh=new BABYLON.Mesh(this.name,this._scene);return vertexData.applyToMesh(mesh,this._updatable),this.mesh=mesh,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),mesh},SolidParticleSystem.prototype.digest=function(mesh,options){var size=options&&options.facetNb||1,number=options&&options.number||0,delta=options&&options.delta||0,meshPos=mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),meshInd=mesh.getIndices(),meshUV=mesh.getVerticesData(BABYLON.VertexBuffer.UVKind),meshCol=mesh.getVerticesData(BABYLON.VertexBuffer.ColorKind),meshNor=mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind),f=0,totalFacets=meshInd.length/3;number?(number=number>totalFacets?totalFacets:number,size=Math.round(totalFacets/number),delta=0):size=size>totalFacets?totalFacets:size;for(var facetPos=[],facetInd=[],facetUV=[],facetCol=[],barycenter=BABYLON.Tmp.Vector3[0],sizeO=size;f<totalFacets;){f>totalFacets-(size=sizeO+Math.floor((1+delta)*Math.random()))&&(size=totalFacets-f),facetPos.length=0,facetInd.length=0,facetUV.length=0,facetCol.length=0;for(var fi=0,j=3*f;j<3*(f+size);j++){facetInd.push(fi);var i=meshInd[j];facetPos.push(meshPos[3*i],meshPos[3*i+1],meshPos[3*i+2]),meshUV&&facetUV.push(meshUV[2*i],meshUV[2*i+1]),meshCol&&facetCol.push(meshCol[4*i],meshCol[4*i+1],meshCol[4*i+2],meshCol[4*i+3]),fi++}var v,idx=this.nbParticles,shape=this._posToShape(facetPos),shapeUV=this._uvsToShapeUV(facetUV);for(v=0;v<shape.length;v++)barycenter.addInPlace(shape[v]);for(barycenter.scaleInPlace(1/shape.length),v=0;v<shape.length;v++)shape[v].subtractInPlace(barycenter);var bInfo;this._particlesIntersect&&(bInfo=new BABYLON.BoundingInfo(barycenter,barycenter));var modelShape=new BABYLON.ModelShape(this._shapeCounter,shape,3*size,shapeUV,null,null),currentPos=this._positions.length,currentInd=this._indices.length;this._meshBuilder(this._index,shape,this._positions,facetInd,this._indices,facetUV,this._uvs,facetCol,this._colors,meshNor,this._normals,idx,0,null),this._addParticle(idx,currentPos,currentInd,modelShape,this._shapeCounter,0,bInfo),this.particles[this.nbParticles].position.addInPlace(barycenter),this._index+=shape.length,idx++,this.nbParticles++,this._shapeCounter++,f+=size}return this},SolidParticleSystem.prototype._unrotateFixedNormals=function(){for(var index=0,idx=0,p=0;p<this.particles.length;p++){this._particle=this.particles[p],this._shape=this._particle._model._shape,this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix);for(var pt=0;pt<this._shape.length;pt++)idx=index+3*pt,BABYLON.Vector3.TransformNormalFromFloatsToRef(this._normals32[idx],this._normals32[idx+1],this._normals32[idx+2],this._invertMatrix,this._normal),this._fixedNormal32[idx]=this._normal.x,this._fixedNormal32[idx+1]=this._normal.y,this._fixedNormal32[idx+2]=this._normal.z;index=idx+3}},SolidParticleSystem.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null},SolidParticleSystem.prototype._meshBuilder=function(p,shape,positions,meshInd,indices,meshUV,uvs,meshCol,colors,meshNor,normals,idx,idxInShape,options){var i,u=0,c=0,n=0;for(this._resetCopy(),options&&options.positionFunction&&(options.positionFunction(this._copy,idx,idxInShape),this._mustUnrotateFixedNormals=!0),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),i=0;i<shape.length;i++)this._vertex.x=shape[i].x,this._vertex.y=shape[i].y,this._vertex.z=shape[i].z,options&&options.vertexFunction&&options.vertexFunction(this._copy,this._vertex,i),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x+=this._copy.pivot.x,this._vertex.y+=this._copy.pivot.y,this._vertex.z+=this._copy.pivot.z,BABYLON.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),positions.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),meshUV&&(uvs.push((this._copy.uvs.z-this._copy.uvs.x)*meshUV[u]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*meshUV[u+1]+this._copy.uvs.y),u+=2),!this.recomputeNormals&&meshNor&&(this._normal.x=meshNor[n],this._normal.y=meshNor[n+1],this._normal.z=meshNor[n+2],BABYLON.Vector3.TransformNormalToRef(this._normal,this._rotMatrix,this._normal),normals.push(this._normal.x,this._normal.y,this._normal.z),n+=3),this._copy.color?this._color=this._copy.color:meshCol&&void 0!==meshCol[c]?(this._color.r=meshCol[c],this._color.g=meshCol[c+1],this._color.b=meshCol[c+2],this._color.a=meshCol[c+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),options&&options.colorFunction&&options.colorFunction(this._copy,this._vertex,this._normal,this._color,i),colors.push(this._color.r,this._color.g,this._color.b,this._color.a),c+=4;for(i=0;i<meshInd.length;i++){var current_ind=p+meshInd[i];indices.push(current_ind),current_ind>65535&&(this._needs32Bits=!0)}if(this._pickable){var nbfaces=meshInd.length/3;for(i=0;i<nbfaces;i++)this.pickedParticles.push({idx:idx,faceId:i})}return this._depthSort&&this.depthSortedParticles.push(new BABYLON.DepthSortedParticle),this._copy},SolidParticleSystem.prototype._posToShape=function(positions){for(var shape=[],i=0;i<positions.length;i+=3)shape.push(new BABYLON.Vector3(positions[i],positions[i+1],positions[i+2]));return shape},SolidParticleSystem.prototype._uvsToShapeUV=function(uvs){var shapeUV=[];if(uvs)for(var i=0;i<uvs.length;i++)shapeUV.push(uvs[i]);return shapeUV},SolidParticleSystem.prototype._addParticle=function(idx,idxpos,idxind,model,shapeId,idxInShape,bInfo){void 0===bInfo&&(bInfo=null);var sp=new BABYLON.SolidParticle(idx,idxpos,idxind,model,shapeId,idxInShape,this,bInfo);return this.particles.push(sp),sp},SolidParticleSystem.prototype.addShape=function(mesh,nb,options){var bbInfo,meshPos=mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),meshInd=mesh.getIndices(),meshUV=mesh.getVerticesData(BABYLON.VertexBuffer.UVKind),meshCol=mesh.getVerticesData(BABYLON.VertexBuffer.ColorKind),meshNor=mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind);this._particlesIntersect&&(bbInfo=mesh.getBoundingInfo());for(var sp,currentCopy,shape=this._posToShape(meshPos),shapeUV=this._uvsToShapeUV(meshUV),posfunc=options?options.positionFunction:null,vtxfunc=options?options.vertexFunction:null,modelShape=new BABYLON.ModelShape(this._shapeCounter,shape,meshInd.length,shapeUV,posfunc,vtxfunc),idx=this.nbParticles,i=0;i<nb;i++){var currentPos=this._positions.length,currentInd=this._indices.length;currentCopy=this._meshBuilder(this._index,shape,this._positions,meshInd,this._indices,meshUV,this._uvs,meshCol,this._colors,meshNor,this._normals,idx,i,options),this._updatable&&((sp=this._addParticle(idx,currentPos,currentInd,modelShape,this._shapeCounter,i,bbInfo)).position.copyFrom(currentCopy.position),sp.rotation.copyFrom(currentCopy.rotation),currentCopy.rotationQuaternion&&sp.rotationQuaternion&&sp.rotationQuaternion.copyFrom(currentCopy.rotationQuaternion),currentCopy.color&&sp.color&&sp.color.copyFrom(currentCopy.color),sp.scaling.copyFrom(currentCopy.scaling),sp.uvs.copyFrom(currentCopy.uvs)),this._index+=shape.length,idx++}return this.nbParticles+=nb,this._shapeCounter++,this._shapeCounter-1},SolidParticleSystem.prototype._rebuildParticle=function(particle){this._resetCopy(),particle._model._positionFunction&&particle._model._positionFunction(this._copy,particle.idx,particle.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._shape=particle._model._shape;for(var pt=0;pt<this._shape.length;pt++)this._vertex.x=this._shape[pt].x,this._vertex.y=this._shape[pt].y,this._vertex.z=this._shape[pt].z,particle._model._vertexFunction&&particle._model._vertexFunction(this._copy,this._vertex,pt),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x+=this._copy.pivot.x,this._vertex.y+=this._copy.pivot.y,this._vertex.z+=this._copy.pivot.z,BABYLON.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[particle._pos+3*pt]=this._copy.position.x+this._rotated.x,this._positions32[particle._pos+3*pt+1]=this._copy.position.y+this._rotated.y,this._positions32[particle._pos+3*pt+2]=this._copy.position.z+this._rotated.z;particle.position.x=0,particle.position.y=0,particle.position.z=0,particle.rotation.x=0,particle.rotation.y=0,particle.rotation.z=0,particle.rotationQuaternion=null,particle.scaling.x=1,particle.scaling.y=1,particle.scaling.z=1},SolidParticleSystem.prototype.rebuildMesh=function(){for(var p=0;p<this.particles.length;p++)this._rebuildParticle(this.particles[p]);return this.mesh.updateVerticesData(BABYLON.VertexBuffer.PositionKind,this._positions32,!1,!1),this},SolidParticleSystem.prototype.setParticles=function(start,end,update){if(void 0===start&&(start=0),void 0===end&&(end=this.nbParticles-1),void 0===update&&(update=!0),!this._updatable)return this;if(this.beforeUpdateParticles(start,end,update),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,(this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(this._invertMatrix)),this.billboard){this._camera.getDirectionToRef(this._axisZ,this._camDir),BABYLON.Vector3.TransformNormalToRef(this._camDir,this._invertMatrix,this._cam_axisZ),this._cam_axisZ.normalize();var view=this._camera.getViewMatrix(!0);BABYLON.Vector3.TransformNormalFromFloatsToRef(view.m[1],view.m[5],view.m[9],this._invertMatrix,this._cam_axisY),BABYLON.Vector3.CrossToRef(this._cam_axisY,this._cam_axisZ,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize()}this._depthSort&&BABYLON.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._camInvertedPosition),BABYLON.Matrix.IdentityToRef(this._rotMatrix);var idx=0,index=0,colidx=0,colorIndex=0,uvidx=0,uvIndex=0,pt=0;this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),end=end>=this.nbParticles?this.nbParticles-1:end,this._computeBoundingBox&&(0==start&&end==this.nbParticles-1?(BABYLON.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),BABYLON.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)):this.mesh._boundingInfo&&(this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum),this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum)));var vpos=(index=this.particles[start]._pos)/3|0;colorIndex=4*vpos,uvIndex=2*vpos;for(var p=start;p<=end;p++){if(this._particle=this.particles[p],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._depthSort&&this._depthSortParticles){var dsp=this.depthSortedParticles[p];dsp.ind=this._particle._ind,dsp.indicesLength=this._particle._model._indicesLength,dsp.sqDistance=BABYLON.Vector3.DistanceSquared(this._particle.position,this._camInvertedPosition)}if(!this._particle.alive||this._particle._stillInvisible&&!this._particle.isVisible)index+=3*(pt=this._shape.length),colorIndex+=4*pt,uvIndex+=2*pt;else{if(this._particle.isVisible)for(this._particle._stillInvisible=!1,this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),(this._computeParticleRotation||this.billboard)&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),pt=0;pt<this._shape.length;pt++)idx=index+3*pt,colidx=colorIndex+4*pt,uvidx=uvIndex+2*pt,this._vertex.x=this._shape[pt].x,this._vertex.y=this._shape[pt].y,this._vertex.z=this._shape[pt].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,pt),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._vertex.x+=this._particle.pivot.x,this._vertex.y+=this._particle.pivot.y,this._vertex.z+=this._particle.pivot.z,this._rotated.x=this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8],this._rotated.y=this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9],this._rotated.z=this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10],this._positions32[idx]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[idx+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[idx+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[idx]<this._minimum.x&&(this._minimum.x=this._positions32[idx]),this._positions32[idx]>this._maximum.x&&(this._maximum.x=this._positions32[idx]),this._positions32[idx+1]<this._minimum.y&&(this._minimum.y=this._positions32[idx+1]),this._positions32[idx+1]>this._maximum.y&&(this._maximum.y=this._positions32[idx+1]),this._positions32[idx+2]<this._minimum.z&&(this._minimum.z=this._positions32[idx+2]),this._positions32[idx+2]>this._maximum.z&&(this._maximum.z=this._positions32[idx+2])),this._computeParticleVertex||(this._normal.x=this._fixedNormal32[idx],this._normal.y=this._fixedNormal32[idx+1],this._normal.z=this._fixedNormal32[idx+2],this._rotated.x=this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8],this._rotated.y=this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9],this._rotated.z=this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10],this._normals32[idx]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[idx+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[idx+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&this._particle.color&&(this._colors32[colidx]=this._particle.color.r,this._colors32[colidx+1]=this._particle.color.g,this._colors32[colidx+2]=this._particle.color.b,this._colors32[colidx+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[uvidx]=this._shapeUV[2*pt]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[uvidx+1]=this._shapeUV[2*pt+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(this._particle._stillInvisible=!0,pt=0;pt<this._shape.length;pt++)idx=index+3*pt,colidx=colorIndex+4*pt,uvidx=uvIndex+2*pt,this._positions32[idx]=0,this._positions32[idx+1]=0,this._positions32[idx+2]=0,this._normals32[idx]=0,this._normals32[idx+1]=0,this._normals32[idx+2]=0,this._computeParticleColor&&this._particle.color&&(this._colors32[colidx]=this._particle.color.r,this._colors32[colidx+1]=this._particle.color.g,this._colors32[colidx+2]=this._particle.color.b,this._colors32[colidx+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[uvidx]=this._shapeUV[2*pt]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[uvidx+1]=this._shapeUV[2*pt+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);if(this._particlesIntersect){var bInfo=this._particle._boundingInfo,bBox=bInfo.boundingBox,bSphere=bInfo.boundingSphere;if(!this._bSphereOnly){for(var b=0;b<bBox.vectors.length;b++)this._vertex.x=this._particle._modelBoundingInfo.boundingBox.vectors[b].x*this._particle.scaling.x,this._vertex.y=this._particle._modelBoundingInfo.boundingBox.vectors[b].y*this._particle.scaling.y,this._vertex.z=this._particle._modelBoundingInfo.boundingBox.vectors[b].z*this._particle.scaling.z,this._rotated.x=this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8],this._rotated.y=this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9],this._rotated.z=this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10],bBox.vectors[b].x=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,bBox.vectors[b].y=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,bBox.vectors[b].z=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z;bBox._update(this.mesh._worldMatrix)}this._minBbox.x=this._particle._modelBoundingInfo.minimum.x*this._particle.scaling.x,this._minBbox.y=this._particle._modelBoundingInfo.minimum.y*this._particle.scaling.y,this._minBbox.z=this._particle._modelBoundingInfo.minimum.z*this._particle.scaling.z,this._maxBbox.x=this._particle._modelBoundingInfo.maximum.x*this._particle.scaling.x,this._maxBbox.y=this._particle._modelBoundingInfo.maximum.y*this._particle.scaling.y,this._maxBbox.z=this._particle._modelBoundingInfo.maximum.z*this._particle.scaling.z,bSphere.center.x=this._particle.position.x+.5*(this._minBbox.x+this._maxBbox.x),bSphere.center.y=this._particle.position.y+.5*(this._minBbox.y+this._maxBbox.y),bSphere.center.z=this._particle.position.z+.5*(this._minBbox.z+this._maxBbox.z),bSphere.radius=.5*this._bSphereRadiusFactor*Math.sqrt((this._maxBbox.x-this._minBbox.x)*(this._maxBbox.x-this._minBbox.x)+(this._maxBbox.y-this._minBbox.y)*(this._maxBbox.y-this._minBbox.y)+(this._maxBbox.z-this._minBbox.z)*(this._maxBbox.z-this._minBbox.z)),bSphere._update(this.mesh._worldMatrix)}index=idx+3,colorIndex=colidx+4,uvIndex=uvidx+2}}if(update){if(this._computeParticleColor&&this.mesh.updateVerticesData(BABYLON.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(BABYLON.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(BABYLON.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen||this.mesh.isFacetDataEnabled){if(this._computeParticleVertex||this.mesh.isFacetDataEnabled){var params=this.mesh.isFacetDataEnabled?this.mesh.getFacetDataParameters():null;BABYLON.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32,params);for(i=0;i<this._normals32.length;i++)this._fixedNormal32[i]=this._normals32[i]}this.mesh.areNormalsFrozen||this.mesh.updateVerticesData(BABYLON.VertexBuffer.NormalKind,this._normals32,!1,!1)}if(this._depthSort&&this._depthSortParticles){this.depthSortedParticles.sort(this._depthSortFunction);var dspl=this.depthSortedParticles.length,sorted=0,lind=0,sind=0,sid=0;for(sorted=0;sorted<dspl;sorted++){lind=this.depthSortedParticles[sorted].indicesLength,sind=this.depthSortedParticles[sorted].ind;for(var i=0;i<lind;i++)this._indices32[sid]=this._indices[sind+i],sid++}this.mesh.updateIndices(this._indices32)}}return this._computeBoundingBox&&(this.mesh._boundingInfo=new BABYLON.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(start,end,update),this},SolidParticleSystem.prototype._quaternionRotationYPR=function(){this._halfroll=.5*this._roll,this._halfpitch=.5*this._pitch,this._halfyaw=.5*this._yaw,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},SolidParticleSystem.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[3]=0,this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[7]=0,this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[11]=0,this._rotMatrix.m[12]=0,this._rotMatrix.m[13]=0,this._rotMatrix.m[14]=0,this._rotMatrix.m[15]=1},SolidParticleSystem.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},SolidParticleSystem.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},SolidParticleSystem.prototype.setVisibilityBox=function(size){var vis=size/2;this.mesh._boundingInfo=new BABYLON.BoundingInfo(new BABYLON.Vector3(-vis,-vis,-vis),new BABYLON.Vector3(vis,vis,vis))},Object.defineProperty(SolidParticleSystem.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(val){this._alwaysVisible=val,this.mesh.alwaysSelectAsActiveMesh=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(val){this._isVisibilityBoxLocked=val,this.mesh.getBoundingInfo().isLocked=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(val){this._computeParticleRotation=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(val){this._computeParticleColor=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(val){this._computeParticleTexture=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(val){this._computeParticleVertex=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(val){this._computeBoundingBox=val},enumerable:!0,configurable:!0}),Object.defineProperty(SolidParticleSystem.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(val){this._depthSortParticles=val},enumerable:!0,configurable:!0}),SolidParticleSystem.prototype.initParticles=function(){},SolidParticleSystem.prototype.recycleParticle=function(particle){return particle},SolidParticleSystem.prototype.updateParticle=function(particle){return particle},SolidParticleSystem.prototype.updateParticleVertex=function(particle,vertex,pt){return vertex},SolidParticleSystem.prototype.beforeUpdateParticles=function(start,stop,update){},SolidParticleSystem.prototype.afterUpdateParticles=function(start,stop,update){},SolidParticleSystem}();BABYLON.SolidParticleSystem=SolidParticleSystem}(BABYLON||(BABYLON={}));!function(BABYLON){var GroundMesh=function(_super){function GroundMesh(name,scene){var _this=_super.call(this,name,scene)||this;return _this.generateOctree=!1,_this}return __extends(GroundMesh,_super),GroundMesh.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(GroundMesh.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(GroundMesh.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(GroundMesh.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),GroundMesh.prototype.optimize=function(chunksCount,octreeBlocksSize){void 0===octreeBlocksSize&&(octreeBlocksSize=32),this._subdivisionsX=chunksCount,this._subdivisionsY=chunksCount,this.subdivide(chunksCount),this.createOrUpdateSubmeshesOctree(octreeBlocksSize)},GroundMesh.prototype.getHeightAtCoordinates=function(x,z){var world=this.getWorldMatrix(),invMat=BABYLON.Tmp.Matrix[5];world.invertToRef(invMat);var tmpVect=BABYLON.Tmp.Vector3[8];if(BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(x,0,z,invMat,tmpVect),x=tmpVect.x,z=tmpVect.z,x<this._minX||x>this._maxX||z<this._minZ||z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var facet=this._getFacetAt(x,z),y=-(facet.x*x+facet.z*z+facet.w)/facet.y;return BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(0,y,0,world,tmpVect),tmpVect.y},GroundMesh.prototype.getNormalAtCoordinates=function(x,z){var normal=new BABYLON.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(x,z,normal),normal},GroundMesh.prototype.getNormalAtCoordinatesToRef=function(x,z,ref){var world=this.getWorldMatrix(),tmpMat=BABYLON.Tmp.Matrix[5];world.invertToRef(tmpMat);var tmpVect=BABYLON.Tmp.Vector3[8];if(BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(x,0,z,tmpMat,tmpVect),x=tmpVect.x,z=tmpVect.z,x<this._minX||x>this._maxX||z<this._minZ||z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var facet=this._getFacetAt(x,z);return BABYLON.Vector3.TransformNormalFromFloatsToRef(facet.x,facet.y,facet.z,world,ref),this},GroundMesh.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},GroundMesh.prototype._getFacetAt=function(x,z){var col=Math.floor((x+this._maxX)*this._subdivisionsX/this._width),row=Math.floor(-(z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),quad=this._heightQuads[row*this._subdivisionsX+col];return z<quad.slope.x*x+quad.slope.y?quad.facet1:quad.facet2},GroundMesh.prototype._initHeightQuads=function(){var subdivisionsX=this._subdivisionsX,subdivisionsY=this._subdivisionsY;this._heightQuads=new Array;for(var row=0;row<subdivisionsY;row++)for(var col=0;col<subdivisionsX;col++){var quad={slope:BABYLON.Vector2.Zero(),facet1:new BABYLON.Vector4(0,0,0,0),facet2:new BABYLON.Vector4(0,0,0,0)};this._heightQuads[row*subdivisionsX+col]=quad}return this},GroundMesh.prototype._computeHeightQuads=function(){var positions=this.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(!positions)return this;for(var v1=BABYLON.Tmp.Vector3[3],v2=BABYLON.Tmp.Vector3[2],v3=BABYLON.Tmp.Vector3[1],v4=BABYLON.Tmp.Vector3[0],v1v2=BABYLON.Tmp.Vector3[4],v1v3=BABYLON.Tmp.Vector3[5],v1v4=BABYLON.Tmp.Vector3[6],norm1=BABYLON.Tmp.Vector3[7],norm2=BABYLON.Tmp.Vector3[8],i=0,j=0,k=0,cd=0,h=0,d1=0,d2=0,subdivisionsX=this._subdivisionsX,subdivisionsY=this._subdivisionsY,row=0;row<subdivisionsY;row++)for(var col=0;col<subdivisionsX;col++){i=3*col,j=row*(subdivisionsX+1)*3,k=(row+1)*(subdivisionsX+1)*3,v1.x=positions[j+i],v1.y=positions[j+i+1],v1.z=positions[j+i+2],v2.x=positions[j+i+3],v2.y=positions[j+i+4],v2.z=positions[j+i+5],v3.x=positions[k+i],v3.y=positions[k+i+1],v3.z=positions[k+i+2],v4.x=positions[k+i+3],v4.y=positions[k+i+4],v4.z=positions[k+i+5],cd=(v4.z-v1.z)/(v4.x-v1.x),h=v1.z-cd*v1.x,v2.subtractToRef(v1,v1v2),v3.subtractToRef(v1,v1v3),v4.subtractToRef(v1,v1v4),BABYLON.Vector3.CrossToRef(v1v4,v1v3,norm1),BABYLON.Vector3.CrossToRef(v1v2,v1v4,norm2),norm1.normalize(),norm2.normalize(),d1=-(norm1.x*v1.x+norm1.y*v1.y+norm1.z*v1.z),d2=-(norm2.x*v2.x+norm2.y*v2.y+norm2.z*v2.z);var quad=this._heightQuads[row*subdivisionsX+col];quad.slope.copyFromFloats(cd,h),quad.facet1.copyFromFloats(norm1.x,norm1.y,norm1.z,d1),quad.facet2.copyFromFloats(norm2.x,norm2.y,norm2.z,d2)}return this},GroundMesh.prototype.serialize=function(serializationObject){_super.prototype.serialize.call(this,serializationObject),serializationObject.subdivisionsX=this._subdivisionsX,serializationObject.subdivisionsY=this._subdivisionsY,serializationObject.minX=this._minX,serializationObject.maxX=this._maxX,serializationObject.minZ=this._minZ,serializationObject.maxZ=this._maxZ,serializationObject.width=this._width,serializationObject.height=this._height},GroundMesh.Parse=function(parsedMesh,scene){var result=new GroundMesh(parsedMesh.name,scene);return result._subdivisionsX=parsedMesh.subdivisionsX||1,result._subdivisionsY=parsedMesh.subdivisionsY||1,result._minX=parsedMesh.minX,result._maxX=parsedMesh.maxX,result._minZ=parsedMesh.minZ,result._maxZ=parsedMesh.maxZ,result._width=parsedMesh.width,result._height=parsedMesh.height,result},GroundMesh}(BABYLON.Mesh);BABYLON.GroundMesh=GroundMesh}(BABYLON||(BABYLON={}));!function(BABYLON){var InstancedMesh=function(_super){function InstancedMesh(name,source){var _this=_super.call(this,name,source.getScene())||this;return source.instances.push(_this),_this._sourceMesh=source,_this.position.copyFrom(source.position),_this.rotation.copyFrom(source.rotation),_this.scaling.copyFrom(source.scaling),source.rotationQuaternion&&(_this.rotationQuaternion=source.rotationQuaternion.clone()),_this.infiniteDistance=source.infiniteDistance,_this.setPivotMatrix(source.getPivotMatrix()),_this.refreshBoundingInfo(),_this._syncSubMeshes(),_this}return __extends(InstancedMesh,_super),InstancedMesh.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(InstancedMesh.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(InstancedMesh.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(InstancedMesh.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(InstancedMesh.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(InstancedMesh.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),InstancedMesh.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(InstancedMesh.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),InstancedMesh.prototype.getVerticesData=function(kind,copyWhenShared){return this._sourceMesh.getVerticesData(kind,copyWhenShared)},InstancedMesh.prototype.setVerticesData=function(kind,data,updatable,stride){return this.sourceMesh&&this.sourceMesh.setVerticesData(kind,data,updatable,stride),this.sourceMesh},InstancedMesh.prototype.updateVerticesData=function(kind,data,updateExtends,makeItUnique){return this.sourceMesh&&this.sourceMesh.updateVerticesData(kind,data,updateExtends,makeItUnique),this.sourceMesh},InstancedMesh.prototype.setIndices=function(indices,totalVertices){return void 0===totalVertices&&(totalVertices=null),this.sourceMesh&&this.sourceMesh.setIndices(indices,totalVertices),this.sourceMesh},InstancedMesh.prototype.isVerticesDataPresent=function(kind){return this._sourceMesh.isVerticesDataPresent(kind)},InstancedMesh.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(InstancedMesh.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),InstancedMesh.prototype.refreshBoundingInfo=function(){var meshBB=this._sourceMesh.getBoundingInfo();return this._boundingInfo=new BABYLON.BoundingInfo(meshBB.minimum.clone(),meshBB.maximum.clone()),this._updateBoundingInfo(),this},InstancedMesh.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},InstancedMesh.prototype._activate=function(renderId){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,renderId),this},InstancedMesh.prototype.getLOD=function(camera){if(!camera)return this;var boundingInfo=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(camera,boundingInfo.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},InstancedMesh.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var index=0;index<this._sourceMesh.subMeshes.length;index++)this._sourceMesh.subMeshes[index].clone(this,this._sourceMesh);return this},InstancedMesh.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},InstancedMesh.prototype.clone=function(name,newParent,doNotCloneChildren){var result=this._sourceMesh.createInstance(name);if(BABYLON.Tools.DeepCopy(this,result,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),newParent&&(result.parent=newParent),!doNotCloneChildren)for(var index=0;index<this.getScene().meshes.length;index++){var mesh=this.getScene().meshes[index];mesh.parent===this&&mesh.clone(mesh.name,result)}return result.computeWorldMatrix(!0),result},InstancedMesh.prototype.dispose=function(doNotRecurse){var index=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(index,1),_super.prototype.dispose.call(this,doNotRecurse)},InstancedMesh}(BABYLON.AbstractMesh);BABYLON.InstancedMesh=InstancedMesh}(BABYLON||(BABYLON={}));!function(BABYLON){var LinesMesh=function(_super){function LinesMesh(name,scene,parent,source,doNotCloneChildren,useVertexColor,useVertexAlpha){void 0===scene&&(scene=null),void 0===parent&&(parent=null);var _this=_super.call(this,name,scene,parent,source,doNotCloneChildren)||this;_this.useVertexColor=useVertexColor,_this.useVertexAlpha=useVertexAlpha,_this.color=new BABYLON.Color3(1,1,1),_this.alpha=1,source&&(_this.color=source.color.clone(),_this.alpha=source.alpha,_this.useVertexColor=source.useVertexColor,_this.useVertexAlpha=source.useVertexAlpha),_this._intersectionThreshold=.1;var defines=[],options={attributes:[BABYLON.VertexBuffer.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:defines};return!1===useVertexAlpha&&(options.needAlphaBlending=!1),useVertexColor?(options.defines.push("#define VERTEXCOLOR"),options.attributes.push(BABYLON.VertexBuffer.ColorKind)):options.uniforms.push("color"),_this._colorShader=new BABYLON.ShaderMaterial("colorShader",_this.getScene(),"color",options),_this}return __extends(LinesMesh,_super),Object.defineProperty(LinesMesh.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(value){this._intersectionThreshold!==value&&(this._intersectionThreshold=value,this.geometry&&(this.geometry.boundingBias=new BABYLON.Vector2(0,value)))},enumerable:!0,configurable:!0}),LinesMesh.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(LinesMesh.prototype,"material",{get:function(){return this._colorShader},set:function(value){},enumerable:!0,configurable:!0}),Object.defineProperty(LinesMesh.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),LinesMesh.prototype.createInstance=function(name){throw new Error("LinesMeshes do not support createInstance.")},LinesMesh.prototype._bind=function(subMesh,effect,fillMode){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},LinesMesh.prototype._draw=function(subMesh,fillMode,instancesCount){return this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()?(this.getScene().getEngine().draw(!1,subMesh.indexStart,subMesh.indexCount),this):this},LinesMesh.prototype.dispose=function(doNotRecurse){this._colorShader.dispose(),_super.prototype.dispose.call(this,doNotRecurse)},LinesMesh.prototype.clone=function(name,newParent,doNotCloneChildren){return new LinesMesh(name,this.getScene(),newParent,this,doNotCloneChildren)},LinesMesh}(BABYLON.Mesh);BABYLON.LinesMesh=LinesMesh}(BABYLON||(BABYLON={}));!function(BABYLON){var ShaderMaterial=function(_super){function ShaderMaterial(name,scene,shaderPath,options){var _this=_super.call(this,name,scene)||this;return _this._textures={},_this._textureArrays={},_this._floats={},_this._floatsArrays={},_this._colors3={},_this._colors3Arrays={},_this._colors4={},_this._vectors2={},_this._vectors3={},_this._vectors4={},_this._matrices={},_this._matrices3x3={},_this._matrices2x2={},_this._vectors2Arrays={},_this._vectors3Arrays={},_this._cachedWorldViewMatrix=new BABYLON.Matrix,_this._shaderPath=shaderPath,options.needAlphaBlending=options.needAlphaBlending||!1,options.needAlphaTesting=options.needAlphaTesting||!1,options.attributes=options.attributes||["position","normal","uv"],options.uniforms=options.uniforms||["worldViewProjection"],options.uniformBuffers=options.uniformBuffers||[],options.samplers=options.samplers||[],options.defines=options.defines||[],_this._options=options,_this}return __extends(ShaderMaterial,_super),ShaderMaterial.prototype.getClassName=function(){return"ShaderMaterial"},ShaderMaterial.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},ShaderMaterial.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},ShaderMaterial.prototype._checkUniform=function(uniformName){-1===this._options.uniforms.indexOf(uniformName)&&this._options.uniforms.push(uniformName)},ShaderMaterial.prototype.setTexture=function(name,texture){return-1===this._options.samplers.indexOf(name)&&this._options.samplers.push(name),this._textures[name]=texture,this},ShaderMaterial.prototype.setTextureArray=function(name,textures){return-1===this._options.samplers.indexOf(name)&&this._options.samplers.push(name),this._checkUniform(name),this._textureArrays[name]=textures,this},ShaderMaterial.prototype.setFloat=function(name,value){return this._checkUniform(name),this._floats[name]=value,this},ShaderMaterial.prototype.setFloats=function(name,value){return this._checkUniform(name),this._floatsArrays[name]=value,this},ShaderMaterial.prototype.setColor3=function(name,value){return this._checkUniform(name),this._colors3[name]=value,this},ShaderMaterial.prototype.setColor3Array=function(name,value){return this._checkUniform(name),this._colors3Arrays[name]=value.reduce(function(arr,color){return color.toArray(arr,arr.length),arr},[]),this},ShaderMaterial.prototype.setColor4=function(name,value){return this._checkUniform(name),this._colors4[name]=value,this},ShaderMaterial.prototype.setVector2=function(name,value){return this._checkUniform(name),this._vectors2[name]=value,this},ShaderMaterial.prototype.setVector3=function(name,value){return this._checkUniform(name),this._vectors3[name]=value,this},ShaderMaterial.prototype.setVector4=function(name,value){return this._checkUniform(name),this._vectors4[name]=value,this},ShaderMaterial.prototype.setMatrix=function(name,value){return this._checkUniform(name),this._matrices[name]=value,this},ShaderMaterial.prototype.setMatrix3x3=function(name,value){return this._checkUniform(name),this._matrices3x3[name]=value,this},ShaderMaterial.prototype.setMatrix2x2=function(name,value){return this._checkUniform(name),this._matrices2x2[name]=value,this},ShaderMaterial.prototype.setArray2=function(name,value){return this._checkUniform(name),this._vectors2Arrays[name]=value,this},ShaderMaterial.prototype.setArray3=function(name,value){return this._checkUniform(name),this._vectors3Arrays[name]=value,this},ShaderMaterial.prototype._checkCache=function(scene,mesh,useInstances){return!mesh||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},ShaderMaterial.prototype.isReady=function(mesh,useInstances){var scene=this.getScene(),engine=scene.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===scene.getRenderId()&&this._checkCache(scene,mesh,useInstances))return!0;var defines=[],attribs=[],fallbacks=new BABYLON.EffectFallbacks;useInstances&&defines.push("#define INSTANCES");for(index=0;index<this._options.defines.length;index++)defines.push(this._options.defines[index]);for(var index=0;index<this._options.attributes.length;index++)attribs.push(this._options.attributes[index]);mesh&&mesh.isVerticesDataPresent(BABYLON.VertexBuffer.ColorKind)&&(attribs.push(BABYLON.VertexBuffer.ColorKind),defines.push("#define VERTEXCOLOR")),mesh&&mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton.bones.length+1)),fallbacks.addCPUSkinningFallback(0,mesh),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones")):defines.push("#define NUM_BONE_INFLUENCERS 0");for(var name in this._textures)if(!this._textures[name].isReady())return!1;engine.getAlphaTesting()&&defines.push("#define ALPHATEST");var previousEffect=this._effect,join=defines.join("\n");return this._effect=engine.createEffect(this._shaderPath,{attributes:attribs,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError},engine),!!this._effect.isReady()&&(previousEffect!==this._effect&&scene.resetCachedMaterial(),this._renderId=scene.getRenderId(),!0)},ShaderMaterial.prototype.bindOnlyWorldMatrix=function(world){var scene=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",world),-1!==this._options.uniforms.indexOf("worldView")&&(world.multiplyToRef(scene.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",world.multiply(scene.getTransformMatrix())))},ShaderMaterial.prototype.bind=function(world,mesh){if(this.bindOnlyWorldMatrix(world),this._effect&&this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),BABYLON.MaterialHelper.BindBonesParameters(mesh,this._effect);var name;for(name in this._textures)this._effect.setTexture(name,this._textures[name]);for(name in this._textureArrays)this._effect.setTextureArray(name,this._textureArrays[name]);for(name in this._floats)this._effect.setFloat(name,this._floats[name]);for(name in this._floatsArrays)this._effect.setArray(name,this._floatsArrays[name]);for(name in this._colors3)this._effect.setColor3(name,this._colors3[name]);for(name in this._colors3Arrays)this._effect.setArray3(name,this._colors3Arrays[name]);for(name in this._colors4){var color=this._colors4[name];this._effect.setFloat4(name,color.r,color.g,color.b,color.a)}for(name in this._vectors2)this._effect.setVector2(name,this._vectors2[name]);for(name in this._vectors3)this._effect.setVector3(name,this._vectors3[name]);for(name in this._vectors4)this._effect.setVector4(name,this._vectors4[name]);for(name in this._matrices)this._effect.setMatrix(name,this._matrices[name]);for(name in this._matrices3x3)this._effect.setMatrix3x3(name,this._matrices3x3[name]);for(name in this._matrices2x2)this._effect.setMatrix2x2(name,this._matrices2x2[name]);for(name in this._vectors2Arrays)this._effect.setArray2(name,this._vectors2Arrays[name]);for(name in this._vectors3Arrays)this._effect.setArray3(name,this._vectors3Arrays[name])}this._afterBind(mesh)},ShaderMaterial.prototype.getActiveTextures=function(){var activeTextures=_super.prototype.getActiveTextures.call(this);for(var name in this._textures)activeTextures.push(this._textures[name]);for(var name in this._textureArrays)for(var array=this._textureArrays[name],index=0;index<array.length;index++)activeTextures.push(array[index]);return activeTextures},ShaderMaterial.prototype.hasTexture=function(texture){if(_super.prototype.hasTexture.call(this,texture))return!0;for(var name in this._textures)if(this._textures[name]===texture)return!0;for(var name in this._textureArrays)for(var array=this._textureArrays[name],index=0;index<array.length;index++)if(array[index]===texture)return!0;return!1},ShaderMaterial.prototype.clone=function(name){return new ShaderMaterial(name,this.getScene(),this._shaderPath,this._options)},ShaderMaterial.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){if(forceDisposeTextures){var name;for(name in this._textures)this._textures[name].dispose();for(name in this._textureArrays)for(var array=this._textureArrays[name],index=0;index<array.length;index++)array[index].dispose()}this._textures={},_super.prototype.dispose.call(this,forceDisposeEffect,forceDisposeTextures)},ShaderMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);serializationObject.customType="BABYLON.ShaderMaterial",serializationObject.options=this._options,serializationObject.shaderPath=this._shaderPath;var name;serializationObject.textures={};for(name in this._textures)serializationObject.textures[name]=this._textures[name].serialize();serializationObject.textureArrays={};for(name in this._textureArrays){serializationObject.textureArrays[name]=[];for(var array=this._textureArrays[name],index=0;index<array.length;index++)serializationObject.textureArrays[name].push(array[index].serialize())}serializationObject.floats={};for(name in this._floats)serializationObject.floats[name]=this._floats[name];serializationObject.FloatArrays={};for(name in this._floatsArrays)serializationObject.FloatArrays[name]=this._floatsArrays[name];serializationObject.colors3={};for(name in this._colors3)serializationObject.colors3[name]=this._colors3[name].asArray();serializationObject.colors3Arrays={};for(name in this._colors3Arrays)serializationObject.colors3Arrays[name]=this._colors3Arrays[name];serializationObject.colors4={};for(name in this._colors4)serializationObject.colors4[name]=this._colors4[name].asArray();serializationObject.vectors2={};for(name in this._vectors2)serializationObject.vectors2[name]=this._vectors2[name].asArray();serializationObject.vectors3={};for(name in this._vectors3)serializationObject.vectors3[name]=this._vectors3[name].asArray();serializationObject.vectors4={};for(name in this._vectors4)serializationObject.vectors4[name]=this._vectors4[name].asArray();serializationObject.matrices={};for(name in this._matrices)serializationObject.matrices[name]=this._matrices[name].asArray();serializationObject.matrices3x3={};for(name in this._matrices3x3)serializationObject.matrices3x3[name]=this._matrices3x3[name];serializationObject.matrices2x2={};for(name in this._matrices2x2)serializationObject.matrices2x2[name]=this._matrices2x2[name];serializationObject.vectors2Arrays={};for(name in this._vectors2Arrays)serializationObject.vectors2Arrays[name]=this._vectors2Arrays[name];serializationObject.vectors3Arrays={};for(name in this._vectors3Arrays)serializationObject.vectors3Arrays[name]=this._vectors3Arrays[name];return serializationObject},ShaderMaterial.Parse=function(source,scene,rootUrl){var name,material=BABYLON.SerializationHelper.Parse(function(){return new ShaderMaterial(source.name,scene,source.shaderPath,source.options)},source,scene,rootUrl);for(name in source.textures)material.setTexture(name,BABYLON.Texture.Parse(source.textures[name],scene,rootUrl));for(name in source.textureArrays){for(var array=source.textureArrays[name],textureArray=new Array,index=0;index<array.length;index++)textureArray.push(BABYLON.Texture.Parse(array[index],scene,rootUrl));material.setTextureArray(name,textureArray)}for(name in source.floats)material.setFloat(name,source.floats[name]);for(name in source.floatsArrays)material.setFloats(name,source.floatsArrays[name]);for(name in source.colors3)material.setColor3(name,BABYLON.Color3.FromArray(source.colors3[name]));for(name in source.colors3Arrays){var colors=source.colors3Arrays[name].reduce(function(arr,num,i){return i%3==0?arr.push([num]):arr[arr.length-1].push(num),arr},[]).map(function(color){return BABYLON.Color3.FromArray(color)});material.setColor3Array(name,colors)}for(name in source.colors4)material.setColor4(name,BABYLON.Color4.FromArray(source.colors4[name]));for(name in source.vectors2)material.setVector2(name,BABYLON.Vector2.FromArray(source.vectors2[name]));for(name in source.vectors3)material.setVector3(name,BABYLON.Vector3.FromArray(source.vectors3[name]));for(name in source.vectors4)material.setVector4(name,BABYLON.Vector4.FromArray(source.vectors4[name]));for(name in source.matrices)material.setMatrix(name,BABYLON.Matrix.FromArray(source.matrices[name]));for(name in source.matrices3x3)material.setMatrix3x3(name,source.matrices3x3[name]);for(name in source.matrices2x2)material.setMatrix2x2(name,source.matrices2x2[name]);for(name in source.vectors2Arrays)material.setArray2(name,source.vectors2Arrays[name]);for(name in source.vectors3Arrays)material.setArray3(name,source.vectors3Arrays[name]);return material},ShaderMaterial}(BABYLON.Material);BABYLON.ShaderMaterial=ShaderMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var MeshBuilder=function(){function MeshBuilder(){}return MeshBuilder.updateSideOrientation=function(orientation){return orientation==BABYLON.Mesh.DOUBLESIDE?BABYLON.Mesh.DOUBLESIDE:void 0===orientation||null===orientation?BABYLON.Mesh.FRONTSIDE:orientation},MeshBuilder.CreateBox=function(name,options,scene){void 0===scene&&(scene=null);var box=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),box._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateBox(options).applyToMesh(box,options.updatable),box},MeshBuilder.CreateSphere=function(name,options,scene){var sphere=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),sphere._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateSphere(options).applyToMesh(sphere,options.updatable),sphere},MeshBuilder.CreateDisc=function(name,options,scene){void 0===scene&&(scene=null);var disc=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),disc._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateDisc(options).applyToMesh(disc,options.updatable),disc},MeshBuilder.CreateIcoSphere=function(name,options,scene){var sphere=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),sphere._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateIcoSphere(options).applyToMesh(sphere,options.updatable),sphere},MeshBuilder.CreateRibbon=function(name,options,scene){void 0===scene&&(scene=null);var pathArray=options.pathArray,closeArray=options.closeArray,closePath=options.closePath,sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),instance=options.instance,updatable=options.updatable;if(instance){BABYLON.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,BABYLON.Tmp.Vector3[0]),BABYLON.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,BABYLON.Tmp.Vector3[1]);var positions=instance.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(function(positions){for(var minlg=pathArray[0].length,i=0,ns=instance._originalBuilderSideOrientation===BABYLON.Mesh.DOUBLESIDE?2:1,si=1;si<=ns;si++)for(var p=0;p<pathArray.length;p++){var path=pathArray[p],l=path.length;minlg=minlg<l?minlg:l;for(var j=0;j<minlg;)positions[i]=path[j].x,positions[i+1]=path[j].y,positions[i+2]=path[j].z,path[j].x<BABYLON.Tmp.Vector3[0].x&&(BABYLON.Tmp.Vector3[0].x=path[j].x),path[j].x>BABYLON.Tmp.Vector3[1].x&&(BABYLON.Tmp.Vector3[1].x=path[j].x),path[j].y<BABYLON.Tmp.Vector3[0].y&&(BABYLON.Tmp.Vector3[0].y=path[j].y),path[j].y>BABYLON.Tmp.Vector3[1].y&&(BABYLON.Tmp.Vector3[1].y=path[j].y),path[j].z<BABYLON.Tmp.Vector3[0].z&&(BABYLON.Tmp.Vector3[0].z=path[j].z),path[j].z>BABYLON.Tmp.Vector3[1].z&&(BABYLON.Tmp.Vector3[1].z=path[j].z),j++,i+=3;instance._closePath&&(positions[i]=path[0].x,positions[i+1]=path[0].y,positions[i+2]=path[0].z,i+=3)}}(positions),instance._boundingInfo=new BABYLON.BoundingInfo(BABYLON.Tmp.Vector3[0],BABYLON.Tmp.Vector3[1]),instance._boundingInfo.update(instance._worldMatrix),instance.updateVerticesData(BABYLON.VertexBuffer.PositionKind,positions,!1,!1),options.colors){for(var colors=instance.getVerticesData(BABYLON.VertexBuffer.ColorKind),c=0;c<options.colors.length;c++)colors[4*c]=options.colors[c].r,colors[4*c+1]=options.colors[c].g,colors[4*c+2]=options.colors[c].b,colors[4*c+3]=options.colors[c].a;instance.updateVerticesData(BABYLON.VertexBuffer.ColorKind,colors,!1,!1)}if(options.uvs){for(var uvs=instance.getVerticesData(BABYLON.VertexBuffer.UVKind),i=0;i<options.uvs.length;i++)uvs[2*i]=options.uvs[i].x,uvs[2*i+1]=options.uvs[i].y;instance.updateVerticesData(BABYLON.VertexBuffer.UVKind,uvs,!1,!1)}if(!instance.areNormalsFrozen||instance.isFacetDataEnabled){var indices=instance.getIndices(),normals=instance.getVerticesData(BABYLON.VertexBuffer.NormalKind),params=instance.isFacetDataEnabled?instance.getFacetDataParameters():null;if(BABYLON.VertexData.ComputeNormals(positions,indices,normals,params),instance._closePath)for(var indexFirst=0,indexLast=0,p=0;p<pathArray.length;p++)indexFirst=3*instance._idx[p],indexLast=p+1<pathArray.length?3*(instance._idx[p+1]-1):normals.length-3,normals[indexFirst]=.5*(normals[indexFirst]+normals[indexLast]),normals[indexFirst+1]=.5*(normals[indexFirst+1]+normals[indexLast+1]),normals[indexFirst+2]=.5*(normals[indexFirst+2]+normals[indexLast+2]),normals[indexLast]=normals[indexFirst],normals[indexLast+1]=normals[indexFirst+1],normals[indexLast+2]=normals[indexFirst+2];instance.areNormalsFrozen||instance.updateVerticesData(BABYLON.VertexBuffer.NormalKind,normals,!1,!1)}return instance}var ribbon=new BABYLON.Mesh(name,scene);ribbon._originalBuilderSideOrientation=sideOrientation;var vertexData=BABYLON.VertexData.CreateRibbon(options);return closePath&&(ribbon._idx=vertexData._idx),ribbon._closePath=closePath,ribbon._closeArray=closeArray,vertexData.applyToMesh(ribbon,updatable),ribbon},MeshBuilder.CreateCylinder=function(name,options,scene){var cylinder=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),cylinder._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateCylinder(options).applyToMesh(cylinder,options.updatable),cylinder},MeshBuilder.CreateTorus=function(name,options,scene){var torus=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),torus._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateTorus(options).applyToMesh(torus,options.updatable),torus},MeshBuilder.CreateTorusKnot=function(name,options,scene){var torusKnot=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),torusKnot._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreateTorusKnot(options).applyToMesh(torusKnot,options.updatable),torusKnot},MeshBuilder.CreateLineSystem=function(name,options,scene){var instance=options.instance,lines=options.lines,colors=options.colors;if(instance){var vertexColor,lineColors,positions=instance.getVerticesData(BABYLON.VertexBuffer.PositionKind);colors&&(vertexColor=instance.getVerticesData(BABYLON.VertexBuffer.ColorKind));for(var i=0,c=0,l=0;l<lines.length;l++)for(var points=lines[l],p=0;p<points.length;p++)positions[i]=points[p].x,positions[i+1]=points[p].y,positions[i+2]=points[p].z,colors&&vertexColor&&(lineColors=colors[l],vertexColor[c]=lineColors[p].r,vertexColor[c+1]=lineColors[p].g,vertexColor[c+2]=lineColors[p].b,vertexColor[c+3]=lineColors[p].a,c+=4),i+=3;return instance.updateVerticesData(BABYLON.VertexBuffer.PositionKind,positions,!1,!1),colors&&vertexColor&&instance.updateVerticesData(BABYLON.VertexBuffer.ColorKind,vertexColor,!1,!1),instance}var useVertexColor=!!colors,lineSystem=new BABYLON.LinesMesh(name,scene,null,void 0,void 0,useVertexColor,options.useVertexAlpha);return BABYLON.VertexData.CreateLineSystem(options).applyToMesh(lineSystem,options.updatable),lineSystem},MeshBuilder.CreateLines=function(name,options,scene){void 0===scene&&(scene=null);var colors=options.colors?[options.colors]:null;return MeshBuilder.CreateLineSystem(name,{lines:[options.points],updatable:options.updatable,instance:options.instance,colors:colors,useVertexAlpha:options.useVertexAlpha},scene)},MeshBuilder.CreateDashedLines=function(name,options,scene){void 0===scene&&(scene=null);var points=options.points,instance=options.instance,gapSize=options.gapSize||1,dashSize=options.dashSize||3;if(instance){return instance.updateMeshPositions(function(positions){var curvect=BABYLON.Vector3.Zero(),nbSeg=positions.length/6,lg=0,nb=0,shft=0,dashshft=0,curshft=0,p=0,i=0,j=0;for(i=0;i<points.length-1;i++)points[i+1].subtractToRef(points[i],curvect),lg+=curvect.length();for(shft=lg/nbSeg,dashshft=instance.dashSize*shft/(instance.dashSize+instance.gapSize),i=0;i<points.length-1;i++)for(points[i+1].subtractToRef(points[i],curvect),nb=Math.floor(curvect.length()/shft),curvect.normalize(),j=0;j<nb&&p<positions.length;)curshft=shft*j,positions[p]=points[i].x+curshft*curvect.x,positions[p+1]=points[i].y+curshft*curvect.y,positions[p+2]=points[i].z+curshft*curvect.z,positions[p+3]=points[i].x+(curshft+dashshft)*curvect.x,positions[p+4]=points[i].y+(curshft+dashshft)*curvect.y,positions[p+5]=points[i].z+(curshft+dashshft)*curvect.z,p+=6,j++;for(;p<positions.length;)positions[p]=points[i].x,positions[p+1]=points[i].y,positions[p+2]=points[i].z,p+=3},!1),instance}var dashedLines=new BABYLON.LinesMesh(name,scene);return BABYLON.VertexData.CreateDashedLines(options).applyToMesh(dashedLines,options.updatable),dashedLines.dashSize=dashSize,dashedLines.gapSize=gapSize,dashedLines},MeshBuilder.ExtrudeShape=function(name,options,scene){void 0===scene&&(scene=null);var path=options.path,shape=options.shape,scale=options.scale||1,rotation=options.rotation||0,cap=0===options.cap?0:options.cap||BABYLON.Mesh.NO_CAP,updatable=options.updatable,sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),instance=options.instance||null,invertUV=options.invertUV||!1;return MeshBuilder._ExtrudeShapeGeneric(name,shape,path,scale,rotation,null,null,!1,!1,cap,!1,scene,!!updatable,sideOrientation,instance,invertUV,options.frontUVs||null,options.backUVs||null)},MeshBuilder.ExtrudeShapeCustom=function(name,options,scene){var path=options.path,shape=options.shape,scaleFunction=options.scaleFunction||function(){return 1},rotationFunction=options.rotationFunction||function(){return 0},ribbonCloseArray=options.ribbonCloseArray||!1,ribbonClosePath=options.ribbonClosePath||!1,cap=0===options.cap?0:options.cap||BABYLON.Mesh.NO_CAP,updatable=options.updatable,sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),instance=options.instance,invertUV=options.invertUV||!1;return MeshBuilder._ExtrudeShapeGeneric(name,shape,path,null,null,scaleFunction,rotationFunction,ribbonCloseArray,ribbonClosePath,cap,!0,scene,!!updatable,sideOrientation,instance||null,invertUV,options.frontUVs||null,options.backUVs||null)},MeshBuilder.CreateLathe=function(name,options,scene){var rotated,arc=options.arc?options.arc<=0||options.arc>1?1:options.arc:1,closed=void 0===options.closed||options.closed,shape=options.shape,radius=options.radius||1,tessellation=options.tessellation||64,updatable=options.updatable,sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),cap=options.cap||BABYLON.Mesh.NO_CAP,pi2=2*Math.PI,paths=new Array,invertUV=options.invertUV||!1,i=0,p=0,step=pi2/tessellation*arc,path=new Array;for(i=0;i<=tessellation;i++){path=[];for(cap!=BABYLON.Mesh.CAP_START&&cap!=BABYLON.Mesh.CAP_ALL||(path.push(new BABYLON.Vector3(0,shape[0].y,0)),path.push(new BABYLON.Vector3(Math.cos(i*step)*shape[0].x*radius,shape[0].y,Math.sin(i*step)*shape[0].x*radius))),p=0;p<shape.length;p++)rotated=new BABYLON.Vector3(Math.cos(i*step)*shape[p].x*radius,shape[p].y,Math.sin(i*step)*shape[p].x*radius),path.push(rotated);cap!=BABYLON.Mesh.CAP_END&&cap!=BABYLON.Mesh.CAP_ALL||(path.push(new BABYLON.Vector3(Math.cos(i*step)*shape[shape.length-1].x*radius,shape[shape.length-1].y,Math.sin(i*step)*shape[shape.length-1].x*radius)),path.push(new BABYLON.Vector3(0,shape[shape.length-1].y,0))),paths.push(path)}return MeshBuilder.CreateRibbon(name,{pathArray:paths,closeArray:closed,sideOrientation:sideOrientation,updatable:updatable,invertUV:invertUV,frontUVs:options.frontUVs,backUVs:options.backUVs},scene)},MeshBuilder.CreatePlane=function(name,options,scene){var plane=new BABYLON.Mesh(name,scene);if(options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),plane._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreatePlane(options).applyToMesh(plane,options.updatable),options.sourcePlane){plane.translate(options.sourcePlane.normal,options.sourcePlane.d);var product=Math.acos(BABYLON.Vector3.Dot(options.sourcePlane.normal,BABYLON.Axis.Z)),vectorProduct=BABYLON.Vector3.Cross(BABYLON.Axis.Z,options.sourcePlane.normal);plane.rotate(vectorProduct,product)}return plane},MeshBuilder.CreateGround=function(name,options,scene){var ground=new BABYLON.GroundMesh(name,scene);return ground._setReady(!1),ground._subdivisionsX=options.subdivisionsX||options.subdivisions||1,ground._subdivisionsY=options.subdivisionsY||options.subdivisions||1,ground._width=options.width||1,ground._height=options.height||1,ground._maxX=ground._width/2,ground._maxZ=ground._height/2,ground._minX=-ground._maxX,ground._minZ=-ground._maxZ,BABYLON.VertexData.CreateGround(options).applyToMesh(ground,options.updatable),ground._setReady(!0),ground},MeshBuilder.CreateTiledGround=function(name,options,scene){var tiledGround=new BABYLON.Mesh(name,scene);return BABYLON.VertexData.CreateTiledGround(options).applyToMesh(tiledGround,options.updatable),tiledGround},MeshBuilder.CreateGroundFromHeightMap=function(name,url,options,scene){var width=options.width||10,height=options.height||10,subdivisions=options.subdivisions||1,minHeight=options.minHeight||0,maxHeight=options.maxHeight||1,filter=options.colorFilter||new BABYLON.Color3(.3,.59,.11),updatable=options.updatable,onReady=options.onReady,ground=new BABYLON.GroundMesh(name,scene);ground._subdivisionsX=subdivisions,ground._subdivisionsY=subdivisions,ground._width=width,ground._height=height,ground._maxX=ground._width/2,ground._maxZ=ground._height/2,ground._minX=-ground._maxX,ground._minZ=-ground._maxZ,ground._setReady(!1);return BABYLON.Tools.LoadImage(url,function(img){var canvas=document.createElement("canvas"),context=canvas.getContext("2d");if(!context)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");var bufferWidth=img.width,bufferHeight=img.height;canvas.width=bufferWidth,canvas.height=bufferHeight,context.drawImage(img,0,0);var buffer=context.getImageData(0,0,bufferWidth,bufferHeight).data;BABYLON.VertexData.CreateGroundFromHeightMap({width:width,height:height,subdivisions:subdivisions,minHeight:minHeight,maxHeight:maxHeight,colorFilter:filter,buffer:buffer,bufferWidth:bufferWidth,bufferHeight:bufferHeight}).applyToMesh(ground,updatable),ground._setReady(!0),onReady&&onReady(ground)},function(){},scene.database),ground},MeshBuilder.CreatePolygon=function(name,options,scene){options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation);for(var shape=options.shape,holes=options.holes||[],depth=options.depth||0,contours=[],hole=[],i=0;i<shape.length;i++)contours[i]=new BABYLON.Vector2(shape[i].x,shape[i].z);contours[0].equalsWithEpsilon(contours[contours.length-1],1e-8)&&contours.pop();for(var polygonTriangulation=new BABYLON.PolygonMeshBuilder(name,contours,scene),hNb=0;hNb<holes.length;hNb++){hole=[];for(var hPoint=0;hPoint<holes[hNb].length;hPoint++)hole.push(new BABYLON.Vector2(holes[hNb][hPoint].x,holes[hNb][hPoint].z));polygonTriangulation.addHole(hole)}var polygon=polygonTriangulation.build(options.updatable,depth);return polygon._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreatePolygon(polygon,options.sideOrientation,options.faceUV,options.faceColors,options.frontUVs,options.backUVs).applyToMesh(polygon,options.updatable),polygon},MeshBuilder.ExtrudePolygon=function(name,options,scene){return MeshBuilder.CreatePolygon(name,options,scene)},MeshBuilder.CreateTube=function(name,options,scene){var path=options.path,instance=options.instance,radius=1;instance&&(radius=instance.radius),void 0!==options.radius&&(radius=options.radius);var tessellation=options.tessellation||64,radiusFunction=options.radiusFunction||null,cap=options.cap||BABYLON.Mesh.NO_CAP,invertUV=options.invertUV||!1,updatable=options.updatable,sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation);options.arc=options.arc&&(options.arc<=0||options.arc>1)?1:options.arc||1;var path3D,pathArray,tubePathArray=function(path,path3D,circlePaths,radius,tessellation,radiusFunction,cap,arc){for(var circlePath,rad,normal,rotated,tangents=path3D.getTangents(),normals=path3D.getNormals(),distances=path3D.getDistances(),step=2*Math.PI/tessellation*arc,radiusFunctionFinal=radiusFunction||function(){return radius},rotationMatrix=BABYLON.Tmp.Matrix[0],index=cap===BABYLON.Mesh._NO_CAP||cap===BABYLON.Mesh.CAP_END?0:2,i=0;i<path.length;i++){rad=radiusFunctionFinal(i,distances[i]),circlePath=Array(),normal=normals[i];for(var t=0;t<tessellation;t++)BABYLON.Matrix.RotationAxisToRef(tangents[i],step*t,rotationMatrix),rotated=circlePath[t]?circlePath[t]:BABYLON.Vector3.Zero(),BABYLON.Vector3.TransformCoordinatesToRef(normal,rotationMatrix,rotated),rotated.scaleInPlace(rad).addInPlace(path[i]),circlePath[t]=rotated;circlePaths[index]=circlePath,index++}var capPath=function(nbPoints,pathIndex){for(var pointCap=Array(),i=0;i<nbPoints;i++)pointCap.push(path[pathIndex]);return pointCap};switch(cap){case BABYLON.Mesh.NO_CAP:break;case BABYLON.Mesh.CAP_START:circlePaths[0]=capPath(tessellation,0),circlePaths[1]=circlePaths[2].slice(0);break;case BABYLON.Mesh.CAP_END:circlePaths[index]=circlePaths[index-1].slice(0),circlePaths[index+1]=capPath(tessellation,path.length-1);break;case BABYLON.Mesh.CAP_ALL:circlePaths[0]=capPath(tessellation,0),circlePaths[1]=circlePaths[2].slice(0),circlePaths[index]=circlePaths[index-1].slice(0),circlePaths[index+1]=capPath(tessellation,path.length-1)}return circlePaths};if(instance){var arc=options.arc||instance.arc;return path3D=instance.path3D.update(path),pathArray=tubePathArray(path,path3D,instance.pathArray,radius,instance.tessellation,radiusFunction,instance.cap,arc),instance=MeshBuilder.CreateRibbon("",{pathArray:pathArray,instance:instance}),instance.path3D=path3D,instance.pathArray=pathArray,instance.arc=arc,instance.radius=radius,instance}pathArray=tubePathArray(path,path3D=new BABYLON.Path3D(path),new Array,radius,tessellation,radiusFunction,cap=cap<0||cap>3?0:cap,options.arc);var tube=MeshBuilder.CreateRibbon(name,{pathArray:pathArray,closePath:!0,closeArray:!1,updatable:updatable,sideOrientation:sideOrientation,invertUV:invertUV,frontUVs:options.frontUVs,backUVs:options.backUVs},scene);return tube.pathArray=pathArray,tube.path3D=path3D,tube.tessellation=tessellation,tube.cap=cap,tube.arc=options.arc,tube.radius=radius,tube},MeshBuilder.CreatePolyhedron=function(name,options,scene){var polyhedron=new BABYLON.Mesh(name,scene);return options.sideOrientation=MeshBuilder.updateSideOrientation(options.sideOrientation),polyhedron._originalBuilderSideOrientation=options.sideOrientation,BABYLON.VertexData.CreatePolyhedron(options).applyToMesh(polyhedron,options.updatable),polyhedron},MeshBuilder.CreateDecal=function(name,sourceMesh,options){var indices=sourceMesh.getIndices(),positions=sourceMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),normals=sourceMesh.getVerticesData(BABYLON.VertexBuffer.NormalKind),position=options.position||BABYLON.Vector3.Zero(),normal=options.normal||BABYLON.Vector3.Up(),size=options.size||BABYLON.Vector3.One(),angle=options.angle||0;if(!normal){var target=new BABYLON.Vector3(0,0,1),camera=sourceMesh.getScene().activeCamera,cameraWorldTarget=BABYLON.Vector3.TransformCoordinates(target,camera.getWorldMatrix());normal=camera.globalPosition.subtract(cameraWorldTarget)}var yaw=-Math.atan2(normal.z,normal.x)-Math.PI/2,len=Math.sqrt(normal.x*normal.x+normal.z*normal.z),pitch=Math.atan2(normal.y,len),decalWorldMatrix=BABYLON.Matrix.RotationYawPitchRoll(yaw,pitch,angle).multiply(BABYLON.Matrix.Translation(position.x,position.y,position.z)),inverseDecalWorldMatrix=BABYLON.Matrix.Invert(decalWorldMatrix),transformMatrix=sourceMesh.getWorldMatrix().multiply(inverseDecalWorldMatrix),vertexData=new BABYLON.VertexData;vertexData.indices=[],vertexData.positions=[],vertexData.normals=[],vertexData.uvs=[];for(var currentVertexDataIndex=0,extractDecalVector3=function(indexId){var result=new BABYLON.PositionNormalVertex;if(!indices||!positions||!normals)return result;var vertexId=indices[indexId];return result.position=new BABYLON.Vector3(positions[3*vertexId],positions[3*vertexId+1],positions[3*vertexId+2]),result.position=BABYLON.Vector3.TransformCoordinates(result.position,transformMatrix),result.normal=new BABYLON.Vector3(normals[3*vertexId],normals[3*vertexId+1],normals[3*vertexId+2]),result.normal=BABYLON.Vector3.TransformNormal(result.normal,transformMatrix),result},clip=function(vertices,axis){if(0===vertices.length)return vertices;for(var clipSize=.5*Math.abs(BABYLON.Vector3.Dot(size,axis)),clipVertices=function(v0,v1){var clipFactor=BABYLON.Vector3.GetClipFactor(v0.position,v1.position,axis,clipSize);return new BABYLON.PositionNormalVertex(BABYLON.Vector3.Lerp(v0.position,v1.position,clipFactor),BABYLON.Vector3.Lerp(v0.normal,v1.normal,clipFactor))},result=new Array,index=0;index<vertices.length;index+=3){var v1Out,v2Out,v3Out,nV1=null,nV2=null,nV3=null,nV4=null;switch(v1Out=BABYLON.Vector3.Dot(vertices[index].position,axis)-clipSize>0,v2Out=BABYLON.Vector3.Dot(vertices[index+1].position,axis)-clipSize>0,v3Out=BABYLON.Vector3.Dot(vertices[index+2].position,axis)-clipSize>0,(v1Out?1:0)+(v2Out?1:0)+(v3Out?1:0)){case 0:result.push(vertices[index]),result.push(vertices[index+1]),result.push(vertices[index+2]);break;case 1:if(v1Out&&(nV1=vertices[index+1],nV2=vertices[index+2],nV3=clipVertices(vertices[index],nV1),nV4=clipVertices(vertices[index],nV2)),v2Out){nV1=vertices[index],nV2=vertices[index+2],nV3=clipVertices(vertices[index+1],nV1),nV4=clipVertices(vertices[index+1],nV2),result.push(nV3),result.push(nV2.clone()),result.push(nV1.clone()),result.push(nV2.clone()),result.push(nV3.clone()),result.push(nV4);break}v3Out&&(nV1=vertices[index],nV2=vertices[index+1],nV3=clipVertices(vertices[index+2],nV1),nV4=clipVertices(vertices[index+2],nV2)),nV1&&nV2&&nV3&&nV4&&(result.push(nV1.clone()),result.push(nV2.clone()),result.push(nV3),result.push(nV4),result.push(nV3.clone()),result.push(nV2.clone()));break;case 2:v1Out||(nV2=clipVertices(nV1=vertices[index].clone(),vertices[index+1]),nV3=clipVertices(nV1,vertices[index+2]),result.push(nV1),result.push(nV2),result.push(nV3)),v2Out||(nV2=clipVertices(nV1=vertices[index+1].clone(),vertices[index+2]),nV3=clipVertices(nV1,vertices[index]),result.push(nV1),result.push(nV2),result.push(nV3)),v3Out||(nV2=clipVertices(nV1=vertices[index+2].clone(),vertices[index]),nV3=clipVertices(nV1,vertices[index+1]),result.push(nV1),result.push(nV2),result.push(nV3))}}return result},index=0;index<indices.length;index+=3){var faceVertices=new Array;if(faceVertices.push(extractDecalVector3(index)),faceVertices.push(extractDecalVector3(index+1)),faceVertices.push(extractDecalVector3(index+2)),faceVertices=clip(faceVertices,new BABYLON.Vector3(1,0,0)),faceVertices=clip(faceVertices,new BABYLON.Vector3(-1,0,0)),faceVertices=clip(faceVertices,new BABYLON.Vector3(0,1,0)),faceVertices=clip(faceVertices,new BABYLON.Vector3(0,-1,0)),faceVertices=clip(faceVertices,new BABYLON.Vector3(0,0,1)),0!==(faceVertices=clip(faceVertices,new BABYLON.Vector3(0,0,-1))).length)for(var vIndex=0;vIndex<faceVertices.length;vIndex++){var vertex=faceVertices[vIndex];vertexData.indices.push(currentVertexDataIndex),vertex.position.toArray(vertexData.positions,3*currentVertexDataIndex),vertex.normal.toArray(vertexData.normals,3*currentVertexDataIndex),vertexData.uvs.push(.5+vertex.position.x/size.x),vertexData.uvs.push(.5+vertex.position.y/size.y),currentVertexDataIndex++}}var decal=new BABYLON.Mesh(name,sourceMesh.getScene());return vertexData.applyToMesh(decal),decal.position=position.clone(),decal.rotation=new BABYLON.Vector3(pitch,yaw,angle),decal},MeshBuilder._ExtrudeShapeGeneric=function(name,shape,curve,scale,rotation,scaleFunction,rotateFunction,rbCA,rbCP,cap,custom,scene,updtbl,side,instance,invertUV,frontUVs,backUVs){var path3D,pathArray,extrusionPathArray=function(shape,curve,path3D,shapePaths,scale,rotation,scaleFunction,rotateFunction,cap,custom){for(var tangents=path3D.getTangents(),normals=path3D.getNormals(),binormals=path3D.getBinormals(),distances=path3D.getDistances(),angle=0,rotate=custom&&rotateFunction?rotateFunction:function(){return null!==rotation?rotation:0},scl=custom&&scaleFunction?scaleFunction:function(){return null!==scale?scale:1},index=cap===BABYLON.Mesh.NO_CAP||cap===BABYLON.Mesh.CAP_END?0:2,rotationMatrix=BABYLON.Tmp.Matrix[0],i=0;i<curve.length;i++){for(var shapePath=new Array,angleStep=rotate(i,distances[i]),scaleRatio=scl(i,distances[i]),p=0;p<shape.length;p++){BABYLON.Matrix.RotationAxisToRef(tangents[i],angle,rotationMatrix);var planed=tangents[i].scale(shape[p].z).add(normals[i].scale(shape[p].x)).add(binormals[i].scale(shape[p].y)),rotated=shapePath[p]?shapePath[p]:BABYLON.Vector3.Zero();BABYLON.Vector3.TransformCoordinatesToRef(planed,rotationMatrix,rotated),rotated.scaleInPlace(scaleRatio).addInPlace(curve[i]),shapePath[p]=rotated}shapePaths[index]=shapePath,angle+=angleStep,index++}var capPath=function(shapePath){var i,pointCap=Array(),barycenter=BABYLON.Vector3.Zero();for(i=0;i<shapePath.length;i++)barycenter.addInPlace(shapePath[i]);for(barycenter.scaleInPlace(1/shapePath.length),i=0;i<shapePath.length;i++)pointCap.push(barycenter);return pointCap};switch(cap){case BABYLON.Mesh.NO_CAP:break;case BABYLON.Mesh.CAP_START:shapePaths[0]=capPath(shapePaths[2]),shapePaths[1]=shapePaths[2];break;case BABYLON.Mesh.CAP_END:shapePaths[index]=shapePaths[index-1],shapePaths[index+1]=capPath(shapePaths[index-1]);break;case BABYLON.Mesh.CAP_ALL:shapePaths[0]=capPath(shapePaths[2]),shapePaths[1]=shapePaths[2],shapePaths[index]=shapePaths[index-1],shapePaths[index+1]=capPath(shapePaths[index-1])}return shapePaths};if(instance)return path3D=instance.path3D.update(curve),pathArray=extrusionPathArray(shape,curve,instance.path3D,instance.pathArray,scale,rotation,scaleFunction,rotateFunction,instance.cap,custom),instance=BABYLON.Mesh.CreateRibbon("",pathArray,!1,!1,0,scene||void 0,!1,0,instance);pathArray=extrusionPathArray(shape,curve,path3D=new BABYLON.Path3D(curve),new Array,scale,rotation,scaleFunction,rotateFunction,cap=cap<0||cap>3?0:cap,custom);var extrudedGeneric=MeshBuilder.CreateRibbon(name,{pathArray:pathArray,closeArray:rbCA,closePath:rbCP,updatable:updtbl,sideOrientation:side,invertUV:invertUV,frontUVs:frontUVs||void 0,backUVs:backUVs||void 0},scene);return extrudedGeneric.pathArray=pathArray,extrudedGeneric.path3D=path3D,extrudedGeneric.cap=cap,extrudedGeneric},MeshBuilder}();BABYLON.MeshBuilder=MeshBuilder}(BABYLON||(BABYLON={}));!function(BABYLON){var AudioEngine=function(){function AudioEngine(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.unlocked=!1,this.isMP3supported=!1,this.isOGGsupported=!1,void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var audioElem=document.createElement("audio");try{audioElem&&audioElem.canPlayType&&audioElem.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(e){}try{audioElem&&audioElem.canPlayType&&audioElem.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0}return Object.defineProperty(AudioEngine.prototype,"audioContext",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),AudioEngine.prototype._unlockiOSaudio=function(){var _this=this,unlockaudio=function(){if(_this.audioContext){var buffer=_this.audioContext.createBuffer(1,1,22050),source=_this.audioContext.createBufferSource();source.buffer=buffer,source.connect(_this.audioContext.destination),source.start(0),setTimeout(function(){source.playbackState!==source.PLAYING_STATE&&source.playbackState!==source.FINISHED_STATE||(_this.unlocked=!0,window.removeEventListener("touchend",unlockaudio,!1),_this.onAudioUnlocked&&_this.onAudioUnlocked())},0)}};window.addEventListener("touchend",unlockaudio,!1)},AudioEngine.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(e){this.canUseWebAudio=!1,BABYLON.Tools.Error("Web Audio: "+e.message)}},AudioEngine.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},AudioEngine.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},AudioEngine.prototype.setGlobalVolume=function(newVolume){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=newVolume)},AudioEngine.prototype.connectToAnalyser=function(analyser){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=analyser,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},AudioEngine}();BABYLON.AudioEngine=AudioEngine}(BABYLON||(BABYLON={}));!function(BABYLON){var Sound=function(){function Sound(name,urlOrArrayBuffer,scene,readyToPlayCallback,options){void 0===readyToPlayCallback&&(readyToPlayCallback=null);var _this=this;if(this.autoplay=!1,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=BABYLON.Vector3.Zero(),this._localDirection=new BABYLON.Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=name,this._scene=scene,this._readyToPlayCallback=readyToPlayCallback,this._customAttenuationFunction=function(currentVolume,currentDistance,maxDistance,refDistance,rolloffFactor){return currentDistance<maxDistance?currentVolume*(1-currentDistance/maxDistance):0},options&&(this.autoplay=options.autoplay||!1,this.loop=options.loop||!1,this.loopStart=options.loopStart||0,this.loopEnd=options.loopEnd||0,void 0!==options.volume&&(this._volume=options.volume),this.spatialSound=options.spatialSound||!1,this.maxDistance=options.maxDistance||100,this.useCustomAttenuation=options.useCustomAttenuation||!1,this.rolloffFactor=options.rolloffFactor||1,this.refDistance=options.refDistance||1,this.distanceModel=options.distanceModel||"linear",this._playbackRate=options.playbackRate||1,this._streaming=options.streaming||!1),BABYLON.Engine.audioEngine.canUseWebAudio&&BABYLON.Engine.audioEngine.audioContext){this._soundGain=BABYLON.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var validParameter=!0;if(urlOrArrayBuffer){"string"==typeof urlOrArrayBuffer&&(this._urlType="String"),Array.isArray(urlOrArrayBuffer)&&(this._urlType="Array"),urlOrArrayBuffer instanceof ArrayBuffer&&(this._urlType="ArrayBuffer");var urls=[],codecSupportedFound=!1;switch(this._urlType){case"ArrayBuffer":urlOrArrayBuffer.byteLength>0&&(codecSupportedFound=!0,this._soundLoaded(urlOrArrayBuffer));break;case"String":urls.push(urlOrArrayBuffer);case"Array":0===urls.length&&(urls=urlOrArrayBuffer);for(var i=0;i<urls.length;i++){var url=urls[i];if(-1!==url.indexOf(".mp3",url.length-4)&&BABYLON.Engine.audioEngine.isMP3supported&&(codecSupportedFound=!0),-1!==url.indexOf(".ogg",url.length-4)&&BABYLON.Engine.audioEngine.isOGGsupported&&(codecSupportedFound=!0),-1!==url.indexOf(".wav",url.length-4)&&(codecSupportedFound=!0),-1!==url.indexOf("blob:")&&(codecSupportedFound=!0),codecSupportedFound){this._streaming?(this._htmlAudioElement=new Audio(url),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,BABYLON.Tools.SetCorsBehavior(url,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){_this._isReadyToPlay=!0,_this.autoplay&&_this.play(),_this._readyToPlayCallback&&_this._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):BABYLON.Tools.LoadFile(url,function(data){_this._soundLoaded(data)},void 0,this._scene.database,!0);break}}break;default:validParameter=!1}validParameter?codecSupportedFound||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){_this._readyToPlayCallback&&_this._readyToPlayCallback()},1e3)):BABYLON.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}}else this._scene.mainSoundTrack.AddSound(this),BABYLON.Engine.audioEngine.WarnedWebAudioUnsupported||(BABYLON.Tools.Error("Web Audio is not supported by your browser."),BABYLON.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){_this._readyToPlayCallback&&_this._readyToPlayCallback()},1e3)}return Sound.prototype.dispose=function(){BABYLON.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},Sound.prototype.isReady=function(){return this._isReadyToPlay},Sound.prototype._soundLoaded=function(audioData){var _this=this;BABYLON.Engine.audioEngine.audioContext&&BABYLON.Engine.audioEngine.audioContext.decodeAudioData(audioData,function(buffer){_this._audioBuffer=buffer,_this._isReadyToPlay=!0,_this.autoplay&&_this.play(),_this._readyToPlayCallback&&_this._readyToPlayCallback()},function(err){BABYLON.Tools.Error("Error while decoding audio data for: "+_this.name+" / Error: "+err)})},Sound.prototype.setAudioBuffer=function(audioBuffer){BABYLON.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=audioBuffer,this._isReadyToPlay=!0)},Sound.prototype.updateOptions=function(options){options&&(this.loop=options.loop||this.loop,this.loopStart=options.loopStart||this.loopStart,this.loopEnd=options.loopEnd||this.loopEnd,this.maxDistance=options.maxDistance||this.maxDistance,this.useCustomAttenuation=options.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=options.rolloffFactor||this.rolloffFactor,this.refDistance=options.refDistance||this.refDistance,this.distanceModel=options.distanceModel||this.distanceModel,this._playbackRate=options.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},Sound.prototype._createSpatialParameters=function(){BABYLON.Engine.audioEngine.canUseWebAudio&&BABYLON.Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=BABYLON.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},Sound.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},Sound.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},Sound.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},Sound.prototype._switchPanningModel=function(){BABYLON.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},Sound.prototype.connectToSoundTrackAudioNode=function(soundTrackAudioNode){BABYLON.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(soundTrackAudioNode),this._isOutputConnected=!0)},Sound.prototype.setDirectionalCone=function(coneInnerAngle,coneOuterAngle,coneOuterGain){coneOuterAngle<coneInnerAngle?BABYLON.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=coneInnerAngle,this._coneOuterAngle=coneOuterAngle,this._coneOuterGain=coneOuterGain,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Sound.prototype.setPosition=function(newPosition){this._position=newPosition,BABYLON.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&isFinite(this._position.x)&&isFinite(this._position.y)&&isFinite(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},Sound.prototype.setLocalDirectionToMesh=function(newLocalDirection){this._localDirection=newLocalDirection,BABYLON.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},Sound.prototype._updateDirection=function(){if(this._connectedMesh&&this._soundPanner){var mat=this._connectedMesh.getWorldMatrix(),direction=BABYLON.Vector3.TransformNormal(this._localDirection,mat);direction.normalize(),this._soundPanner.setOrientation(direction.x,direction.y,direction.z)}},Sound.prototype.updateDistanceFromListener=function(){if(BABYLON.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var distance=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,distance,this.maxDistance,this.refDistance,this.rolloffFactor)}},Sound.prototype.setAttenuationFunction=function(callback){this._customAttenuationFunction=callback},Sound.prototype.play=function(time,offset){var _this=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&BABYLON.Engine.audioEngine.audioContext)try{this._startOffset<0&&(time=-this._startOffset,this._startOffset=0);var startTime=time?BABYLON.Engine.audioEngine.audioContext.currentTime+time:BABYLON.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&isFinite(this._position.x)&&isFinite(this._position.y)&&isFinite(this._position.z)&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming?(this._streamingSource||(this._streamingSource=BABYLON.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){_this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=BABYLON.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.loopStart=this.loopStart,this._soundSource.loopEnd=this.loopEnd||this._audioBuffer.duration,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){_this._onended()},this._soundSource.buffer&&this._soundSource.start(startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:offset||0)),this._startTime=startTime,this.isPlaying=!0,this.isPaused=!1}catch(ex){BABYLON.Tools.Error("Error while trying to play audio: "+this.name+", "+ex.message)}},Sound.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},Sound.prototype.stop=function(time){if(this.isPlaying){if(this._streaming)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else if(BABYLON.Engine.audioEngine.audioContext&&this._soundSource){var stopTime=time?BABYLON.Engine.audioEngine.audioContext.currentTime+time:BABYLON.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(stopTime),this._soundSource.onended=function(){},this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},Sound.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():BABYLON.Engine.audioEngine.audioContext&&(this.stop(0),this._startOffset+=BABYLON.Engine.audioEngine.audioContext.currentTime-this._startTime))},Sound.prototype.setVolume=function(newVolume,time){BABYLON.Engine.audioEngine.canUseWebAudio&&this._soundGain&&(time&&BABYLON.Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(BABYLON.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,BABYLON.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(newVolume,BABYLON.Engine.audioEngine.audioContext.currentTime+time)):this._soundGain.gain.value=newVolume),this._volume=newVolume},Sound.prototype.setPlaybackRate=function(newPlaybackRate){this._playbackRate=newPlaybackRate,this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},Sound.prototype.getVolume=function(){return this._volume},Sound.prototype.attachToMesh=function(meshToConnectTo){var _this=this;this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=meshToConnectTo,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(connectedMesh){return _this._onRegisterAfterWorldMatrixUpdate(connectedMesh)},meshToConnectTo.registerAfterWorldMatrixUpdate(this._registerFunc)},Sound.prototype.detachFromMesh=function(){this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},Sound.prototype._onRegisterAfterWorldMatrixUpdate=function(node){if(node.getBoundingInfo){var boundingInfo=node.getBoundingInfo();this.setPosition(boundingInfo.boundingSphere.centerWorld),BABYLON.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},Sound.prototype.clone=function(){var _this=this;if(this._streaming)return null;var setBufferAndRun=function(){_this._isReadyToPlay?(clonedSound._audioBuffer=_this.getAudioBuffer(),clonedSound._isReadyToPlay=!0,clonedSound.autoplay&&clonedSound.play()):window.setTimeout(setBufferAndRun,300)},currentOptions={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},clonedSound=new Sound(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,currentOptions);return this.useCustomAttenuation&&clonedSound.setAttenuationFunction(this._customAttenuationFunction),clonedSound.setPosition(this._position),clonedSound.setPlaybackRate(this._playbackRate),setBufferAndRun(),clonedSound},Sound.prototype.getAudioBuffer=function(){return this._audioBuffer},Sound.prototype.serialize=function(){var serializationObject={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedMesh&&(serializationObject.connectedMeshId=this._connectedMesh.id),serializationObject.position=this._position.asArray(),serializationObject.refDistance=this.refDistance,serializationObject.distanceModel=this.distanceModel,serializationObject.isDirectional=this._isDirectional,serializationObject.localDirectionToMesh=this._localDirection.asArray(),serializationObject.coneInnerAngle=this._coneInnerAngle,serializationObject.coneOuterAngle=this._coneOuterAngle,serializationObject.coneOuterGain=this._coneOuterGain),serializationObject},Sound.Parse=function(parsedSound,scene,rootUrl,sourceSound){var soundUrl,soundName=parsedSound.name;soundUrl=parsedSound.url?rootUrl+parsedSound.url:rootUrl+soundName;var newSound,options={autoplay:parsedSound.autoplay,loop:parsedSound.loop,volume:parsedSound.volume,spatialSound:parsedSound.spatialSound,maxDistance:parsedSound.maxDistance,rolloffFactor:parsedSound.rolloffFactor,refDistance:parsedSound.refDistance,distanceModel:parsedSound.distanceModel,playbackRate:parsedSound.playbackRate};if(sourceSound){var setBufferAndRun=function(){sourceSound._isReadyToPlay?(newSound._audioBuffer=sourceSound.getAudioBuffer(),newSound._isReadyToPlay=!0,newSound.autoplay&&newSound.play()):window.setTimeout(setBufferAndRun,300)};newSound=new Sound(soundName,new ArrayBuffer(0),scene,null,options),setBufferAndRun()}else newSound=new Sound(soundName,soundUrl,scene,function(){scene._removePendingData(newSound)},options),scene._addPendingData(newSound);if(parsedSound.position){var soundPosition=BABYLON.Vector3.FromArray(parsedSound.position);newSound.setPosition(soundPosition)}if(parsedSound.isDirectional&&(newSound.setDirectionalCone(parsedSound.coneInnerAngle||360,parsedSound.coneOuterAngle||360,parsedSound.coneOuterGain||0),parsedSound.localDirectionToMesh)){var localDirectionToMesh=BABYLON.Vector3.FromArray(parsedSound.localDirectionToMesh);newSound.setLocalDirectionToMesh(localDirectionToMesh)}if(parsedSound.connectedMeshId){var connectedMesh=scene.getMeshByID(parsedSound.connectedMeshId);connectedMesh&&newSound.attachToMesh(connectedMesh)}return newSound},Sound}();BABYLON.Sound=Sound}(BABYLON||(BABYLON={}));!function(BABYLON){var SoundTrack=function(){function SoundTrack(scene,options){this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=scene,this.soundCollection=new Array,this._options=options,this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return SoundTrack.prototype._initializeSoundTrackAudioGraph=function(){BABYLON.Engine.audioEngine.canUseWebAudio&&BABYLON.Engine.audioEngine.audioContext&&(this._outputAudioNode=BABYLON.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(BABYLON.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},SoundTrack.prototype.dispose=function(){if(BABYLON.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},SoundTrack.prototype.AddSound=function(sound){this._isInitialized||this._initializeSoundTrackAudioGraph(),BABYLON.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&sound.connectToSoundTrackAudioNode(this._outputAudioNode),sound.soundTrackId&&(-1===sound.soundTrackId?this._scene.mainSoundTrack.RemoveSound(sound):this._scene.soundTracks[sound.soundTrackId].RemoveSound(sound)),this.soundCollection.push(sound),sound.soundTrackId=this.id},SoundTrack.prototype.RemoveSound=function(sound){var index=this.soundCollection.indexOf(sound);-1!==index&&this.soundCollection.splice(index,1)},SoundTrack.prototype.setVolume=function(newVolume){BABYLON.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=newVolume)},SoundTrack.prototype.switchPanningModelToHRTF=function(){if(BABYLON.Engine.audioEngine.canUseWebAudio)for(var i=0;i<this.soundCollection.length;i++)this.soundCollection[i].switchPanningModelToHRTF()},SoundTrack.prototype.switchPanningModelToEqualPower=function(){if(BABYLON.Engine.audioEngine.canUseWebAudio)for(var i=0;i<this.soundCollection.length;i++)this.soundCollection[i].switchPanningModelToEqualPower()},SoundTrack.prototype.connectToAnalyser=function(analyser){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=analyser,BABYLON.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,BABYLON.Engine.audioEngine.masterGain))},SoundTrack}();BABYLON.SoundTrack=SoundTrack}(BABYLON||(BABYLON={}));!function(BABYLON){var Analyser=function(){function Analyser(scene){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=scene,this._audioEngine=BABYLON.Engine.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return Analyser.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},Analyser.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},Analyser.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},Analyser.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},Analyser.prototype.drawDebugCanvas=function(){var _this=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){_this.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var workingArray=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var percent=workingArray[i]/this.BARGRAPHAMPLITUDE,height=this.DEBUGCANVASSIZE.height*percent,offset=this.DEBUGCANVASSIZE.height-height-1,barWidth=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),hue=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+hue+", 100%, 50%)",this._debugCanvasContext.fillRect(i*barWidth,offset,barWidth,height)}}},Analyser.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},Analyser.prototype.connectAudioNodes=function(inputAudioNode,outputAudioNode){this._audioEngine.canUseWebAudio&&(inputAudioNode.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(outputAudioNode))},Analyser.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},Analyser}();BABYLON.Analyser=Analyser}(BABYLON||(BABYLON={}));!function(BABYLON){var CubeTexture=function(_super){function CubeTexture(rootUrl,scene,extensions,noMipmap,files,onLoad,onError,format,prefiltered,forcedExtension){void 0===extensions&&(extensions=null),void 0===noMipmap&&(noMipmap=!1),void 0===files&&(files=null),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===format&&(format=BABYLON.Engine.TEXTUREFORMAT_RGBA),void 0===prefiltered&&(prefiltered=!1),void 0===forcedExtension&&(forcedExtension=null);var _this=_super.call(this,scene)||this;if(_this.coordinatesMode=BABYLON.Texture.CUBIC_MODE,_this.name=rootUrl,_this.url=rootUrl,_this._noMipmap=noMipmap,_this.hasAlpha=!1,_this._format=format,_this._prefiltered=prefiltered,_this.isCube=!0,_this._textureMatrix=BABYLON.Matrix.Identity(),prefiltered&&(_this.gammaSpace=!1),!rootUrl&&!files)return _this;_this._texture=_this._getFromCache(rootUrl,noMipmap);var lastDot=rootUrl.lastIndexOf("."),isDDS=".dds"===(forcedExtension||(lastDot>-1?rootUrl.substring(lastDot).toLowerCase():""));if(!files&&(isDDS||extensions||(extensions=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),files=[],extensions))for(var index=0;index<extensions.length;index++)files.push(rootUrl+extensions[index]);return _this._files=files,_this._texture?onLoad&&(_this._texture.isReady?BABYLON.Tools.SetImmediate(function(){return onLoad()}):_this._texture.onLoadedObservable.add(onLoad)):scene.useDelayedTextureLoading?_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED:_this._texture=prefiltered?scene.getEngine().createPrefilteredCubeTexture(rootUrl,scene,_this.lodGenerationScale,_this.lodGenerationOffset,onLoad,onError,format,forcedExtension):scene.getEngine().createCubeTexture(rootUrl,scene,files,noMipmap,onLoad,onError,_this._format,forcedExtension),_this}return __extends(CubeTexture,_super),CubeTexture.CreateFromImages=function(files,scene,noMipmap){return new CubeTexture("",scene,null,noMipmap,files)},CubeTexture.CreateFromPrefilteredData=function(url,scene,forcedExtension){return void 0===forcedExtension&&(forcedExtension=null),new CubeTexture(url,scene,null,!1,null,null,null,void 0,!0,forcedExtension)},CubeTexture.prototype.delayLoad=function(){if(this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED){var scene=this.getScene();scene&&(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=scene.getEngine().createPrefilteredCubeTexture(this.url,scene,this.lodGenerationScale,this.lodGenerationOffset,void 0,void 0,this._format):this._texture=scene.getEngine().createCubeTexture(this.url,scene,this._files,this._noMipmap,void 0,void 0,this._format)))}},CubeTexture.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},CubeTexture.prototype.setReflectionTextureMatrix=function(value){this._textureMatrix=value},CubeTexture.Parse=function(parsedTexture,scene,rootUrl){var texture=BABYLON.SerializationHelper.Parse(function(){return new BABYLON.CubeTexture(rootUrl+parsedTexture.name,scene,parsedTexture.extensions)},parsedTexture,scene);if(parsedTexture.animations)for(var animationIndex=0;animationIndex<parsedTexture.animations.length;animationIndex++){var parsedAnimation=parsedTexture.animations[animationIndex];texture.animations.push(BABYLON.Animation.Parse(parsedAnimation))}return texture},CubeTexture.prototype.clone=function(){var _this=this;return BABYLON.SerializationHelper.Clone(function(){var scene=_this.getScene();return scene?new CubeTexture(_this.url,scene,_this._extensions,_this._noMipmap,_this._files):_this},this)},CubeTexture}(BABYLON.BaseTexture);BABYLON.CubeTexture=CubeTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var RenderTargetTexture=function(_super){function RenderTargetTexture(name,size,scene,generateMipMaps,doNotChangeAspectRatio,type,isCube,samplingMode,generateDepthBuffer,generateStencilBuffer,isMulti){void 0===doNotChangeAspectRatio&&(doNotChangeAspectRatio=!0),void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===isCube&&(isCube=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===generateDepthBuffer&&(generateDepthBuffer=!0),void 0===generateStencilBuffer&&(generateStencilBuffer=!1),void 0===isMulti&&(isMulti=!1);var _this=_super.call(this,null,scene,!generateMipMaps)||this;return _this.isCube=isCube,_this.renderList=new Array,_this.renderParticles=!0,_this.renderSprites=!1,_this.coordinatesMode=BABYLON.Texture.PROJECTION_MODE,_this.ignoreCameraViewport=!1,_this.onBeforeBindObservable=new BABYLON.Observable,_this.onAfterUnbindObservable=new BABYLON.Observable,_this.onBeforeRenderObservable=new BABYLON.Observable,_this.onAfterRenderObservable=new BABYLON.Observable,_this.onClearObservable=new BABYLON.Observable,_this._currentRefreshId=-1,_this._refreshRate=1,_this._samples=1,(scene=_this.getScene())?(_this._engine=scene.getEngine(),_this.name=name,_this.isRenderTarget=!0,_this._initialSizeParameter=size,_this._processSizeParameter(size),_this._resizeObserver=_this.getScene().getEngine().onResizeObservable.add(function(){}),_this._generateMipMaps=!!generateMipMaps,_this._doNotChangeAspectRatio=doNotChangeAspectRatio,_this._renderingManager=new BABYLON.RenderingManager(scene),isMulti?_this:(_this._renderTargetOptions={generateMipMaps:generateMipMaps,type:type,samplingMode:samplingMode,generateDepthBuffer:generateDepthBuffer,generateStencilBuffer:generateStencilBuffer},samplingMode===BABYLON.Texture.NEAREST_SAMPLINGMODE&&(_this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE),isCube?(_this._texture=scene.getEngine().createRenderTargetCubeTexture(_this.getRenderSize(),_this._renderTargetOptions),_this.coordinatesMode=BABYLON.Texture.INVCUBIC_MODE,_this._textureMatrix=BABYLON.Matrix.Identity()):_this._texture=scene.getEngine().createRenderTargetTexture(_this._size,_this._renderTargetOptions),_this)):_this}return __extends(RenderTargetTexture,_super),Object.defineProperty(RenderTargetTexture,"REFRESHRATE_RENDER_ONCE",{get:function(){return RenderTargetTexture._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return RenderTargetTexture._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return RenderTargetTexture._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture.prototype,"onAfterUnbind",{set:function(callback){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture.prototype,"onBeforeRender",{set:function(callback){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture.prototype,"onAfterRender",{set:function(callback){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture.prototype,"onClear",{set:function(callback){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTargetTexture.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),RenderTargetTexture.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},RenderTargetTexture.prototype._processSizeParameter=function(size){size.ratio?(this._sizeRatio=size.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=size},Object.defineProperty(RenderTargetTexture.prototype,"samples",{get:function(){return this._samples},set:function(value){if(this._samples!==value){var scene=this.getScene();scene&&(this._samples=scene.getEngine().updateRenderTargetTextureSampleCount(this._texture,value))}},enumerable:!0,configurable:!0}),RenderTargetTexture.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(RenderTargetTexture.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(value){this._refreshRate=value,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),RenderTargetTexture.prototype.addPostProcess=function(postProcess){if(!this._postProcessManager){var scene=this.getScene();if(!scene)return;this._postProcessManager=new BABYLON.PostProcessManager(scene),this._postProcesses=new Array}this._postProcesses.push(postProcess),this._postProcesses[0].autoClear=!1},RenderTargetTexture.prototype.clearPostProcesses=function(dispose){if(this._postProcesses){if(dispose)for(var _i=0,_a=this._postProcesses;_i<_a.length;_i++)_a[_i].dispose();this._postProcesses=[]}},RenderTargetTexture.prototype.removePostProcess=function(postProcess){if(this._postProcesses){var index=this._postProcesses.indexOf(postProcess);-1!==index&&(this._postProcesses.splice(index,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},RenderTargetTexture.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},RenderTargetTexture.prototype.getRenderSize=function(){return this._size.width?this._size.width:this._size},RenderTargetTexture.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},RenderTargetTexture.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(RenderTargetTexture.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),RenderTargetTexture.prototype.scale=function(ratio){var newSize=this.getRenderSize()*ratio;this.resize(newSize)},RenderTargetTexture.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:_super.prototype.getReflectionTextureMatrix.call(this)},RenderTargetTexture.prototype.resize=function(size){this.releaseInternalTexture();var scene=this.getScene();scene&&(this._processSizeParameter(size),this.isCube?this._texture=scene.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=scene.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},RenderTargetTexture.prototype.render=function(useCameraPostProcess,dumpForDebug){void 0===useCameraPostProcess&&(useCameraPostProcess=!1),void 0===dumpForDebug&&(dumpForDebug=!1);var scene=this.getScene();if(scene){var engine=scene.getEngine();if(void 0!==this.useCameraPostProcesses&&(useCameraPostProcess=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(index=0;index<this._waitingRenderList.length;index++){var id=this._waitingRenderList[index],mesh_1=scene.getMeshByID(id);mesh_1&&this.renderList.push(mesh_1)}delete this._waitingRenderList}if(this.renderListPredicate){if(this.renderList?this.renderList.splice(0):this.renderList=[],!(scene=this.getScene()))return;for(var sceneMeshes=scene.meshes,index=0;index<sceneMeshes.length;index++){var mesh=sceneMeshes[index];this.renderListPredicate(mesh)&&this.renderList.push(mesh)}}this.onBeforeBindObservable.notifyObservers(this);var camera;this.activeCamera?(camera=this.activeCamera,engine.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==scene.activeCamera&&scene.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(camera=scene.activeCamera)&&engine.setViewport(camera.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var currentRenderList=this.renderList?this.renderList:scene.getActiveMeshes().data,currentRenderListLength=this.renderList?this.renderList.length:scene.getActiveMeshes().length,sceneRenderId=scene.getRenderId(),meshIndex=0;meshIndex<currentRenderListLength;meshIndex++)if(mesh=currentRenderList[meshIndex]){if(!mesh.isReady()){this.resetRefreshCounter();continue}mesh._preActivateForIntermediateRendering(sceneRenderId);var isMasked=void 0;if(isMasked=!(this.renderList||!camera)&&0==(mesh.layerMask&camera.layerMask),mesh.isEnabled()&&mesh.isVisible&&mesh.subMeshes&&!isMasked){mesh._activate(sceneRenderId);for(var subIndex=0;subIndex<mesh.subMeshes.length;subIndex++){var subMesh=mesh.subMeshes[subIndex];scene._activeIndices.addCount(subMesh.indexCount,!1),this._renderingManager.dispatch(subMesh)}}}for(var particleIndex=0;particleIndex<scene.particleSystems.length;particleIndex++){var particleSystem=scene.particleSystems[particleIndex],emitter=particleSystem.emitter;particleSystem.isStarted()&&emitter&&emitter.position&&emitter.isEnabled()&&(currentRenderList.indexOf(emitter)>=0&&this._renderingManager.dispatchParticles(particleSystem))}if(this.isCube)for(var face=0;face<6;face++)this.renderToTarget(face,currentRenderList,currentRenderListLength,useCameraPostProcess,dumpForDebug),scene.incrementRenderId(),scene.resetCachedMaterial();else this.renderToTarget(0,currentRenderList,currentRenderListLength,useCameraPostProcess,dumpForDebug);this.onAfterUnbindObservable.notifyObservers(this),scene.activeCamera&&(this.activeCamera&&this.activeCamera!==scene.activeCamera&&scene.setTransformMatrix(scene.activeCamera.getViewMatrix(),scene.activeCamera.getProjectionMatrix(!0)),engine.setViewport(scene.activeCamera.viewport)),scene.resetCachedMaterial()}},RenderTargetTexture.prototype._bestReflectionRenderTargetDimension=function(renderDimension,scale){var x=renderDimension*scale,curved=BABYLON.Tools.NearestPOT(x+16384/(128+x));return Math.min(BABYLON.Tools.FloorPOT(renderDimension),curved)},RenderTargetTexture.prototype.renderToTarget=function(faceIndex,currentRenderList,currentRenderListLength,useCameraPostProcess,dumpForDebug){var _this=this,scene=this.getScene();if(scene){var engine=scene.getEngine();this._texture&&(this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):useCameraPostProcess&&scene.postProcessManager._prepareFrame(this._texture)||this._texture&&engine.bindFramebuffer(this._texture,this.isCube?faceIndex:void 0,void 0,void 0,this.ignoreCameraViewport),this.onBeforeRenderObservable.notifyObservers(faceIndex),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(engine):engine.clear(this.clearColor||scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||scene.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,currentRenderList,this.renderParticles,this.renderSprites),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,faceIndex,this._postProcesses,this.ignoreCameraViewport):useCameraPostProcess&&scene.postProcessManager._finalizeFrame(!1,this._texture,faceIndex),this._doNotChangeAspectRatio||scene.updateTransformMatrix(!0),dumpForDebug&&BABYLON.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),engine),this.isCube&&5!==faceIndex?this.onAfterRenderObservable.notifyObservers(faceIndex):(this.isCube&&5===faceIndex&&engine.generateMipMapsForCubemap(this._texture),engine.unBindFramebuffer(this._texture,this.isCube,function(){_this.onAfterRenderObservable.notifyObservers(faceIndex)})))}},RenderTargetTexture.prototype.setRenderingOrder=function(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn){void 0===opaqueSortCompareFn&&(opaqueSortCompareFn=null),void 0===alphaTestSortCompareFn&&(alphaTestSortCompareFn=null),void 0===transparentSortCompareFn&&(transparentSortCompareFn=null),this._renderingManager.setRenderingOrder(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn)},RenderTargetTexture.prototype.setRenderingAutoClearDepthStencil=function(renderingGroupId,autoClearDepthStencil){this._renderingManager.setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil)},RenderTargetTexture.prototype.clone=function(){var textureSize=this.getSize(),newTexture=new RenderTargetTexture(this.name,textureSize.width,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return newTexture.hasAlpha=this.hasAlpha,newTexture.level=this.level,newTexture.coordinatesMode=this.coordinatesMode,this.renderList&&(newTexture.renderList=this.renderList.slice(0)),newTexture},RenderTargetTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject=_super.prototype.serialize.call(this);if(serializationObject.renderTargetSize=this.getRenderSize(),serializationObject.renderList=[],this.renderList)for(var index=0;index<this.renderList.length;index++)serializationObject.renderList.push(this.renderList[index].id);return serializationObject},RenderTargetTexture.prototype.disposeFramebufferObjects=function(){var objBuffer=this.getInternalTexture(),scene=this.getScene();objBuffer&&scene&&scene.getEngine()._releaseFramebufferObjects(objBuffer)},RenderTargetTexture.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var scene=this.getScene();if(scene){var index=scene.customRenderTargets.indexOf(this);index>=0&&scene.customRenderTargets.splice(index,1);for(var _i=0,_a=scene.cameras;_i<_a.length;_i++){var camera=_a[_i];(index=camera.customRenderTargets.indexOf(this))>=0&&camera.customRenderTargets.splice(index,1)}_super.prototype.dispose.call(this)}},RenderTargetTexture.prototype._rebuild=function(){this.refreshRate===RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=RenderTargetTexture.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},RenderTargetTexture._REFRESHRATE_RENDER_ONCE=0,RenderTargetTexture._REFRESHRATE_RENDER_ONEVERYFRAME=1,RenderTargetTexture._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,RenderTargetTexture}(BABYLON.Texture);BABYLON.RenderTargetTexture=RenderTargetTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var MultiRenderTarget=function(_super){function MultiRenderTarget(name,size,count,scene,options){var _this=this,generateMipMaps=!!(options=options||{}).generateMipMaps&&options.generateMipMaps,generateDepthTexture=!!options.generateDepthTexture&&options.generateDepthTexture,doNotChangeAspectRatio=void 0===options.doNotChangeAspectRatio||options.doNotChangeAspectRatio;if((_this=_super.call(this,name,size,scene,generateMipMaps,doNotChangeAspectRatio)||this)._engine=scene.getEngine(),_this.isSupported){for(var types=[],samplingModes=[],i=0;i<count;i++)options.types&&options.types[i]?types.push(options.types[i]):types.push(BABYLON.Engine.TEXTURETYPE_FLOAT),options.samplingModes&&options.samplingModes[i]?samplingModes.push(options.samplingModes[i]):samplingModes.push(BABYLON.Texture.BILINEAR_SAMPLINGMODE);var generateDepthBuffer=void 0===options.generateDepthBuffer||options.generateDepthBuffer,generateStencilBuffer=void 0!==options.generateStencilBuffer&&options.generateStencilBuffer;return _this._size=size,_this._multiRenderTargetOptions={samplingModes:samplingModes,generateMipMaps:generateMipMaps,generateDepthBuffer:generateDepthBuffer,generateStencilBuffer:generateStencilBuffer,generateDepthTexture:generateDepthTexture,types:types,textureCount:count},_this._createInternalTextures(),_this._createTextures(),_this}_this.dispose()}return __extends(MultiRenderTarget,_super),Object.defineProperty(MultiRenderTarget.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(MultiRenderTarget.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(MultiRenderTarget.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(MultiRenderTarget.prototype,"wrapU",{set:function(wrap){if(this._textures)for(var i=0;i<this._textures.length;i++)this._textures[i].wrapU=wrap},enumerable:!0,configurable:!0}),Object.defineProperty(MultiRenderTarget.prototype,"wrapV",{set:function(wrap){if(this._textures)for(var i=0;i<this._textures.length;i++)this._textures[i].wrapV=wrap},enumerable:!0,configurable:!0}),MultiRenderTarget.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var i=0;i<this._internalTextures.length;i++)this._textures[i]._texture=this._internalTextures[i];this._texture=this._internalTextures[0]},MultiRenderTarget.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},MultiRenderTarget.prototype._createTextures=function(){this._textures=[];for(var i=0;i<this._internalTextures.length;i++){var texture=new BABYLON.Texture(null,this.getScene());texture._texture=this._internalTextures[i],this._textures.push(texture)}this._texture=this._internalTextures[0]},Object.defineProperty(MultiRenderTarget.prototype,"samples",{get:function(){return this._samples},set:function(value){if(this._samples!==value)for(var i=0;i<this._internalTextures.length;i++)this._samples=this._engine.updateRenderTargetTextureSampleCount(this._internalTextures[i],value)},enumerable:!0,configurable:!0}),MultiRenderTarget.prototype.resize=function(size){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(size,this._multiRenderTargetOptions),this._createInternalTextures()},MultiRenderTarget.prototype.dispose=function(){this.releaseInternalTextures(),_super.prototype.dispose.call(this)},MultiRenderTarget.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var i=this._internalTextures.length-1;i>=0;i--)void 0!==this._internalTextures[i]&&(this._internalTextures[i].dispose(),this._internalTextures.splice(i,1))},MultiRenderTarget}(BABYLON.RenderTargetTexture);BABYLON.MultiRenderTarget=MultiRenderTarget}(BABYLON||(BABYLON={}));!function(BABYLON){var MirrorTexture=function(_super){function MirrorTexture(name,size,scene,generateMipMaps,type,samplingMode,generateDepthBuffer){void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===samplingMode&&(samplingMode=BABYLON.Texture.BILINEAR_SAMPLINGMODE),void 0===generateDepthBuffer&&(generateDepthBuffer=!0);var _this=_super.call(this,name,size,scene,generateMipMaps,!0,type,!1,samplingMode,generateDepthBuffer)||this;return _this.mirrorPlane=new BABYLON.Plane(0,1,0,1),_this._transformMatrix=BABYLON.Matrix.Zero(),_this._mirrorMatrix=BABYLON.Matrix.Zero(),_this._adaptiveBlurKernel=0,_this._blurKernelX=0,_this._blurKernelY=0,_this._blurRatio=1,_this.ignoreCameraViewport=!0,_this.onBeforeRenderObservable.add(function(){BABYLON.Matrix.ReflectionToRef(_this.mirrorPlane,_this._mirrorMatrix),_this._savedViewMatrix=scene.getViewMatrix(),_this._mirrorMatrix.multiplyToRef(_this._savedViewMatrix,_this._transformMatrix),scene.setTransformMatrix(_this._transformMatrix,scene.getProjectionMatrix()),scene.clipPlane=_this.mirrorPlane,scene.getEngine().cullBackFaces=!1,scene._mirroredCameraPosition=BABYLON.Vector3.TransformCoordinates(scene.activeCamera.globalPosition,_this._mirrorMatrix)}),_this.onAfterRenderObservable.add(function(){scene.setTransformMatrix(_this._savedViewMatrix,scene.getProjectionMatrix()),scene.getEngine().cullBackFaces=!0,scene._mirroredCameraPosition=null,delete scene.clipPlane}),_this}return __extends(MirrorTexture,_super),Object.defineProperty(MirrorTexture.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(value){this._blurRatio!==value&&(this._blurRatio=value,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(MirrorTexture.prototype,"adaptiveBlurKernel",{set:function(value){this._adaptiveBlurKernel=value,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(MirrorTexture.prototype,"blurKernel",{set:function(value){this.blurKernelX=value,this.blurKernelY=value},enumerable:!0,configurable:!0}),Object.defineProperty(MirrorTexture.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(value){this._blurKernelX!==value&&(this._blurKernelX=value,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(MirrorTexture.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(value){this._blurKernelY!==value&&(this._blurKernelY=value,this._preparePostProcesses())},enumerable:!0,configurable:!0}),MirrorTexture.prototype._autoComputeBlurKernel=function(){var engine=this.getScene().getEngine(),dw=this.getRenderWidth()/engine.getRenderWidth(),dh=this.getRenderHeight()/engine.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*dw,this.blurKernelY=this._adaptiveBlurKernel*dh},MirrorTexture.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},MirrorTexture.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var engine=this.getScene().getEngine(),textureType=engine.getCaps().textureFloatRender?BABYLON.Engine.TEXTURETYPE_FLOAT:BABYLON.Engine.TEXTURETYPE_HALF_FLOAT;this._blurX=new BABYLON.BlurPostProcess("horizontal blur",new BABYLON.Vector2(1,0),this._blurKernelX,this._blurRatio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,textureType),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.outputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new BABYLON.BlurPostProcess("vertical blur",new BABYLON.Vector2(0,1),this._blurKernelY,this._blurRatio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,textureType),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},MirrorTexture.prototype.clone=function(){var scene=this.getScene();if(!scene)return this;var textureSize=this.getSize(),newTexture=new MirrorTexture(this.name,textureSize.width,scene,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return newTexture.hasAlpha=this.hasAlpha,newTexture.level=this.level,newTexture.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(newTexture.renderList=this.renderList.slice(0)),newTexture},MirrorTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject=_super.prototype.serialize.call(this);return serializationObject.mirrorPlane=this.mirrorPlane.asArray(),serializationObject},MirrorTexture}(BABYLON.RenderTargetTexture);BABYLON.MirrorTexture=MirrorTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var RefractionTexture=function(_super){function RefractionTexture(name,size,scene,generateMipMaps){var _this=_super.call(this,name,size,scene,generateMipMaps,!0)||this;return _this.refractionPlane=new BABYLON.Plane(0,1,0,1),_this.depth=2,_this.onBeforeRenderObservable.add(function(){scene.clipPlane=_this.refractionPlane}),_this.onAfterRenderObservable.add(function(){delete scene.clipPlane}),_this}return __extends(RefractionTexture,_super),RefractionTexture.prototype.clone=function(){var scene=this.getScene();if(!scene)return this;var textureSize=this.getSize(),newTexture=new RefractionTexture(this.name,textureSize.width,scene,this._generateMipMaps);return newTexture.hasAlpha=this.hasAlpha,newTexture.level=this.level,newTexture.refractionPlane=this.refractionPlane.clone(),this.renderList&&(newTexture.renderList=this.renderList.slice(0)),newTexture.depth=this.depth,newTexture},RefractionTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject=_super.prototype.serialize.call(this);return serializationObject.mirrorPlane=this.refractionPlane.asArray(),serializationObject.depth=this.depth,serializationObject},RefractionTexture}(BABYLON.RenderTargetTexture);BABYLON.RefractionTexture=RefractionTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var DynamicTexture=function(_super){function DynamicTexture(name,options,scene,generateMipMaps,samplingMode,format){void 0===scene&&(scene=null),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===format&&(format=BABYLON.Engine.TEXTUREFORMAT_RGBA);var _this=_super.call(this,null,scene,!generateMipMaps,void 0,samplingMode,void 0,void 0,void 0,void 0,format)||this;_this.name=name,_this._engine=_this.getScene().getEngine(),_this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,_this._generateMipMaps=generateMipMaps,options.getContext?(_this._canvas=options,_this._texture=_this._engine.createDynamicTexture(options.width,options.height,generateMipMaps,samplingMode)):(_this._canvas=document.createElement("canvas"),options.width?_this._texture=_this._engine.createDynamicTexture(options.width,options.height,generateMipMaps,samplingMode):_this._texture=_this._engine.createDynamicTexture(options,options,generateMipMaps,samplingMode));var textureSize=_this.getSize();return _this._canvas.width=textureSize.width,_this._canvas.height=textureSize.height,_this._context=_this._canvas.getContext("2d"),_this}return __extends(DynamicTexture,_super),Object.defineProperty(DynamicTexture.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),DynamicTexture.prototype._recreate=function(textureSize){this._canvas.width=textureSize.width,this._canvas.height=textureSize.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(textureSize.width,textureSize.height,this._generateMipMaps,this._samplingMode)},DynamicTexture.prototype.scale=function(ratio){var textureSize=this.getSize();textureSize.width*=ratio,textureSize.height*=ratio,this._recreate(textureSize)},DynamicTexture.prototype.scaleTo=function(width,height){var textureSize=this.getSize();textureSize.width=width,textureSize.height=height,this._recreate(textureSize)},DynamicTexture.prototype.getContext=function(){return this._context},DynamicTexture.prototype.clear=function(){var size=this.getSize();this._context.fillRect(0,0,size.width,size.height)},DynamicTexture.prototype.update=function(invertY){this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===invertY||invertY,void 0,this._format||void 0)},DynamicTexture.prototype.drawText=function(text,x,y,font,color,clearColor,invertY,update){void 0===update&&(update=!0);var size=this.getSize();if(clearColor&&(this._context.fillStyle=clearColor,this._context.fillRect(0,0,size.width,size.height)),this._context.font=font,null===x||void 0===x){var textSize=this._context.measureText(text);x=(size.width-textSize.width)/2}if(null===y||void 0===y){var fontSize=parseInt(font.replace(/\D/g,""));y=size.height/2+fontSize/3.65}this._context.fillStyle=color,this._context.fillText(text,x,y),update&&this.update(invertY)},DynamicTexture.prototype.clone=function(){var scene=this.getScene();if(!scene)return this;var textureSize=this.getSize(),newTexture=new DynamicTexture(this.name,textureSize,scene,this._generateMipMaps);return newTexture.hasAlpha=this.hasAlpha,newTexture.level=this.level,newTexture.wrapU=this.wrapU,newTexture.wrapV=this.wrapV,newTexture},DynamicTexture.prototype._rebuild=function(){this.update()},DynamicTexture}(BABYLON.Texture);BABYLON.DynamicTexture=DynamicTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var VideoTexture=function(_super){function VideoTexture(name,urlsOrVideo,scene,generateMipMaps,invertY,samplingMode){void 0===generateMipMaps&&(generateMipMaps=!1),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);var _this=_super.call(this,null,scene,!generateMipMaps,invertY)||this;_this._autoLaunch=!0;var urls=null;return _this.name=name,urlsOrVideo instanceof HTMLVideoElement?_this.video=urlsOrVideo:(urls=urlsOrVideo,_this.video=document.createElement("video"),_this.video.autoplay=!1,_this.video.loop=!0,BABYLON.Tools.SetCorsBehavior(urls,_this.video)),_this._engine=_this.getScene().getEngine(),_this._generateMipMaps=generateMipMaps,_this._samplingMode=samplingMode,!_this._engine.needPOTTextures||BABYLON.Tools.IsExponentOfTwo(_this.video.videoWidth)&&BABYLON.Tools.IsExponentOfTwo(_this.video.videoHeight)?(_this.wrapU=BABYLON.Texture.WRAP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.WRAP_ADDRESSMODE):(_this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,_this._generateMipMaps=!1),urls?(_this.video.addEventListener("canplay",function(){_this._createTexture()}),urls.forEach(function(url){var source=document.createElement("source");source.src=url,_this.video.appendChild(source)})):_this._createTexture(),_this._lastUpdate=BABYLON.Tools.Now,_this}return __extends(VideoTexture,_super),VideoTexture.prototype.__setTextureReady=function(){this._texture&&(this._texture.isReady=!0)},VideoTexture.prototype._createTexture=function(){this._texture=this._engine.createDynamicTexture(this.video.videoWidth,this.video.videoHeight,this._generateMipMaps,this._samplingMode),this._autoLaunch&&(this._autoLaunch=!1,this.video.play()),this._setTextureReady=this.__setTextureReady.bind(this),this.video.addEventListener("playing",this._setTextureReady)},VideoTexture.prototype._rebuild=function(){this.update()},VideoTexture.prototype.update=function(){var now=BABYLON.Tools.Now;return!(now-this._lastUpdate<15||this.video.readyState!==this.video.HAVE_ENOUGH_DATA)&&(this._lastUpdate=now,this._engine.updateVideoTexture(this._texture,this.video,this._invertY),!0)},VideoTexture.prototype.dispose=function(){_super.prototype.dispose.call(this),this.video.removeEventListener("playing",this._setTextureReady)},VideoTexture.CreateFromWebCam=function(scene,onReady,constraints){var constraintsDeviceId,video=document.createElement("video");constraints&&constraints.deviceId&&(constraintsDeviceId={exact:constraints.deviceId}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:constraintsDeviceId,width:{min:constraints&&constraints.minWidth||256,max:constraints&&constraints.maxWidth||640},height:{min:constraints&&constraints.minHeight||256,max:constraints&&constraints.maxHeight||480}}},function(stream){void 0!==video.mozSrcObject?video.mozSrcObject=stream:video.src=window.URL&&window.URL.createObjectURL(stream)||stream,video.play(),onReady&&onReady(new BABYLON.VideoTexture("video",video,scene,!0,!0))},function(e){BABYLON.Tools.Error(e.name)})},VideoTexture}(BABYLON.Texture);BABYLON.VideoTexture=VideoTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var RawTexture=function(_super){function RawTexture(data,width,height,format,scene,generateMipMaps,invertY,samplingMode,type){void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var _this=_super.call(this,null,scene,!generateMipMaps,invertY)||this;return _this.format=format,_this._engine=scene.getEngine(),_this._texture=scene.getEngine().createRawTexture(data,width,height,format,generateMipMaps,invertY,samplingMode,null,type),_this.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,_this}return __extends(RawTexture,_super),RawTexture.prototype.update=function(data){this._engine.updateRawTexture(this._texture,data,this._texture.format,this._texture.invertY,void 0,this._texture.type)},RawTexture.CreateLuminanceTexture=function(data,width,height,scene,generateMipMaps,invertY,samplingMode){return void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),new RawTexture(data,width,height,BABYLON.Engine.TEXTUREFORMAT_LUMINANCE,scene,generateMipMaps,invertY,samplingMode)},RawTexture.CreateLuminanceAlphaTexture=function(data,width,height,scene,generateMipMaps,invertY,samplingMode){return void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),new RawTexture(data,width,height,BABYLON.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,scene,generateMipMaps,invertY,samplingMode)},RawTexture.CreateAlphaTexture=function(data,width,height,scene,generateMipMaps,invertY,samplingMode){return void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),new RawTexture(data,width,height,BABYLON.Engine.TEXTUREFORMAT_ALPHA,scene,generateMipMaps,invertY,samplingMode)},RawTexture.CreateRGBTexture=function(data,width,height,scene,generateMipMaps,invertY,samplingMode,type){return void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),new RawTexture(data,width,height,BABYLON.Engine.TEXTUREFORMAT_RGB,scene,generateMipMaps,invertY,samplingMode,type)},RawTexture.CreateRGBATexture=function(data,width,height,scene,generateMipMaps,invertY,samplingMode,type){return void 0===generateMipMaps&&(generateMipMaps=!0),void 0===invertY&&(invertY=!1),void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),new RawTexture(data,width,height,BABYLON.Engine.TEXTUREFORMAT_RGBA,scene,generateMipMaps,invertY,samplingMode,type)},RawTexture}(BABYLON.Texture);BABYLON.RawTexture=RawTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcess=function(){function PostProcess(name,fragmentUrl,parameters,samplers,options,camera,samplingMode,engine,reusable,defines,textureType,vertexUrl,indexParameters,blockCompilation){void 0===samplingMode&&(samplingMode=BABYLON.Texture.NEAREST_SAMPLINGMODE),void 0===defines&&(defines=null),void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===vertexUrl&&(vertexUrl="postprocess"),void 0===blockCompilation&&(blockCompilation=!1),this.name=name,this.width=-1,this.height=-1,this.autoClear=!0,this.alphaMode=BABYLON.Engine.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.scaleMode=BABYLON.Engine.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this.samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new BABYLON.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new BABYLON.Vector2(1,1),this._texelSize=BABYLON.Vector2.Zero(),this.onActivateObservable=new BABYLON.Observable,this.onSizeChangedObservable=new BABYLON.Observable,this.onApplyObservable=new BABYLON.Observable,this.onBeforeRenderObservable=new BABYLON.Observable,this.onAfterRenderObservable=new BABYLON.Observable,null!=camera?(this._camera=camera,this._scene=camera.getScene(),camera.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this)):engine&&(this._engine=engine,this._engine.postProcesses.push(this)),this._options=options,this.renderTargetSamplingMode=samplingMode||BABYLON.Texture.NEAREST_SAMPLINGMODE,this._reusable=reusable||!1,this._textureType=textureType,this._samplers=samplers||[],this._samplers.push("textureSampler"),this._fragmentUrl=fragmentUrl,this._vertexUrl=vertexUrl,this._parameters=parameters||[],this._parameters.push("scale"),this._indexParameters=indexParameters,blockCompilation||this.updateEffect(defines)}return Object.defineProperty(PostProcess.prototype,"onActivate",{set:function(callback){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),callback&&(this._onActivateObserver=this.onActivateObservable.add(callback))},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"onSizeChanged",{set:function(callback){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"onApply",{set:function(callback){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"onBeforeRender",{set:function(callback){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"onAfterRender",{set:function(callback){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"outputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(value){this._forcedOutputTexture=value},enumerable:!0,configurable:!0}),PostProcess.prototype.getCamera=function(){return this._camera},Object.defineProperty(PostProcess.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),PostProcess.prototype.getEngine=function(){return this._engine},PostProcess.prototype.getEffect=function(){return this._effect},PostProcess.prototype.shareOutputWith=function(postProcess){return this._disposeTextures(),this._shareOutputWithPostProcess=postProcess,this},PostProcess.prototype.updateEffect=function(defines,uniforms,samplers,indexParameters,onCompiled,onError){void 0===defines&&(defines=null),void 0===uniforms&&(uniforms=null),void 0===samplers&&(samplers=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],uniforms||this._parameters,samplers||this._samplers,null!==defines?defines:"",void 0,onCompiled,onError,indexParameters||this._indexParameters)},PostProcess.prototype.isReusable=function(){return this._reusable},PostProcess.prototype.markTextureDirty=function(){this.width=-1},PostProcess.prototype.activate=function(camera,sourceTexture,forceDepthStencil){var _this=this;void 0===sourceTexture&&(sourceTexture=null);var scene=(camera=camera||this._camera).getScene(),engine=scene.getEngine(),maxSize=engine.getCaps().maxTextureSize,requiredWidth=(sourceTexture?sourceTexture.width:this._engine.getRenderWidth(!0))*this._options|0,requiredHeight=(sourceTexture?sourceTexture.height:this._engine.getRenderHeight(!0))*this._options|0,desiredWidth=this._options.width||requiredWidth,desiredHeight=this._options.height||requiredHeight;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var currentViewport=engine.currentViewport;currentViewport&&(desiredWidth*=currentViewport.width,desiredHeight*=currentViewport.height)}if((this.renderTargetSamplingMode===BABYLON.Texture.TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(desiredWidth=engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(desiredWidth,maxSize,this.scaleMode):desiredWidth),this._options.height||(desiredHeight=engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(desiredHeight,maxSize,this.scaleMode):desiredHeight)),this.width!==desiredWidth||this.height!==desiredHeight){if(this._textures.length>0){for(var i=0;i<this._textures.length;i++)this._engine._releaseTexture(this._textures.data[i]);this._textures.reset()}this.width=desiredWidth,this.height=desiredHeight;var textureSize={width:this.width,height:this.height},textureOptions={generateMipMaps:!1,generateDepthBuffer:forceDepthStencil||0===camera._postProcesses.indexOf(this),generateStencilBuffer:(forceDepthStencil||0===camera._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(textureSize,textureOptions)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(textureSize,textureOptions)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(texture){texture.samples!==_this.samples&&_this._engine.updateRenderTargetTextureSampleCount(texture,_this.samples)})}var target;this._shareOutputWithPostProcess?target=this._shareOutputWithPostProcess.outputTexture:this._forcedOutputTexture?(target=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):target=this.outputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(requiredWidth/desiredWidth,requiredHeight/desiredHeight),this._engine.bindFramebuffer(target,0,requiredWidth,requiredHeight,!0)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(target,0,void 0,void 0,!0)),this.onActivateObservable.notifyObservers(camera),this.autoClear&&this.alphaMode===BABYLON.Engine.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:scene.clearColor,!0,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(PostProcess.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(PostProcess.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),PostProcess.prototype.apply=function(){if(!this._effect||!this._effect.isReady())return null;this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);var source;return source=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.outputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.outputTexture,this._effect._bindTexture("textureSampler",source),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect},PostProcess.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var i=0;i<this._textures.length;i++)this._engine._releaseTexture(this._textures.data[i]);this._textures.dispose()}},PostProcess.prototype.dispose=function(camera){if(camera=camera||this._camera,this._disposeTextures(),this._scene){var index_1=this._scene.postProcesses.indexOf(this);-1!==index_1&&this._scene.postProcesses.splice(index_1,1)}else{var index_2=this._engine.postProcesses.indexOf(this);-1!==index_2&&this._engine.postProcesses.splice(index_2,1)}camera&&(camera.detachPostProcess(this),0===camera._postProcesses.indexOf(this)&&camera._postProcesses.length>0&&this._camera._postProcesses[0].markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear())},PostProcess}();BABYLON.PostProcess=PostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var PassPostProcess=function(_super){function PassPostProcess(name,options,camera,samplingMode,engine,reusable,textureType){return void 0===camera&&(camera=null),void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),_super.call(this,name,"pass",null,null,options,camera,samplingMode,engine,reusable,void 0,textureType)||this}return __extends(PassPostProcess,_super),PassPostProcess}(BABYLON.PostProcess);BABYLON.PassPostProcess=PassPostProcess}(BABYLON||(BABYLON={}));__assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};!function(BABYLON){var ShadowGenerator=function(){function ShadowGenerator(mapSize,light,useFullFloatFirst){this._bias=5e-5,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=ShadowGenerator.FILTER_NONE,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=BABYLON.Vector3.Zero(),this._viewMatrix=BABYLON.Matrix.Zero(),this._projectionMatrix=BABYLON.Matrix.Zero(),this._transformMatrix=BABYLON.Matrix.Zero(),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=BABYLON.Matrix.Identity(),this._mapSize=mapSize,this._light=light,this._scene=light.getScene(),light._shadowGenerator=this;var caps=this._scene.getEngine().getCaps();useFullFloatFirst?caps.textureFloatRender&&caps.textureFloatLinearFiltering?this._textureType=BABYLON.Engine.TEXTURETYPE_FLOAT:caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering?this._textureType=BABYLON.Engine.TEXTURETYPE_HALF_FLOAT:this._textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT:caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering?this._textureType=BABYLON.Engine.TEXTURETYPE_HALF_FLOAT:caps.textureFloatRender&&caps.textureFloatLinearFiltering?this._textureType=BABYLON.Engine.TEXTURETYPE_FLOAT:this._textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator()}return Object.defineProperty(ShadowGenerator,"FILTER_NONE",{get:function(){return ShadowGenerator._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator,"FILTER_POISSONSAMPLING",{get:function(){return ShadowGenerator._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator,"FILTER_EXPONENTIALSHADOWMAP",{get:function(){return ShadowGenerator._FILTER_EXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator,"FILTER_BLUREXPONENTIALSHADOWMAP",{get:function(){return ShadowGenerator._FILTER_BLUREXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator,"FILTER_CLOSEEXPONENTIALSHADOWMAP",{get:function(){return ShadowGenerator._FILTER_CLOSEEXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator,"FILTER_BLURCLOSEEXPONENTIALSHADOWMAP",{get:function(){return ShadowGenerator._FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"bias",{get:function(){return this._bias},set:function(bias){this._bias=bias},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(value){this._blurBoxOffset!==value&&(this._blurBoxOffset=value,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"blurScale",{get:function(){return this._blurScale},set:function(value){this._blurScale!==value&&(this._blurScale=value,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(value){this._blurKernel!==value&&(this._blurKernel=value,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(value){this._useKernelBlur!==value&&(this._useKernelBlur=value,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(value){this._depthScale=value},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"filter",{get:function(){return this._filter},set:function(value){if(this._light.needCube()){if(value===ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(value===ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0)}this._filter!==value&&(this._filter=value,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"usePoissonSampling",{get:function(){return this.filter===ShadowGenerator.FILTER_POISSONSAMPLING},set:function(value){(value||this.filter===ShadowGenerator.FILTER_POISSONSAMPLING)&&(this.filter=value?ShadowGenerator.FILTER_POISSONSAMPLING:ShadowGenerator.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useVarianceShadowMap",{get:function(){return BABYLON.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap},set:function(value){BABYLON.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap=value},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useBlurVarianceShadowMap",{get:function(){return BABYLON.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap},set:function(value){BABYLON.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap=value},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useExponentialShadowMap",{get:function(){return this.filter===ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP},set:function(value){(value||this.filter===ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=value?ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP:ShadowGenerator.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(value){(value||this.filter===ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=value?ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP:ShadowGenerator.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(value){(value||this.filter===ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=value?ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP:ShadowGenerator.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(ShadowGenerator.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(value){(value||this.filter===ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=value?ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:ShadowGenerator.FILTER_NONE)},enumerable:!0,configurable:!0}),ShadowGenerator.prototype.getDarkness=function(){return this._darkness},ShadowGenerator.prototype.setDarkness=function(darkness){return this._darkness=darkness>=1?1:darkness<=0?0:darkness,this},ShadowGenerator.prototype.setTransparencyShadow=function(hasShadow){return this._transparencyShadow=hasShadow,this},ShadowGenerator.prototype.getShadowMap=function(){return this._shadowMap},ShadowGenerator.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},ShadowGenerator.prototype.addShadowCaster=function(mesh,includeDescendants){return void 0===includeDescendants&&(includeDescendants=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(mesh),includeDescendants&&(_a=this._shadowMap.renderList).push.apply(_a,mesh.getChildMeshes()),this):this;var _a},ShadowGenerator.prototype.removeShadowCaster=function(mesh,includeDescendants){if(void 0===includeDescendants&&(includeDescendants=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var index=this._shadowMap.renderList.indexOf(mesh);if(-1!==index&&this._shadowMap.renderList.splice(index,1),includeDescendants)for(var _i=0,_a=mesh.getChildren();_i<_a.length;_i++){var child=_a[_i];this.removeShadowCaster(child)}return this},ShadowGenerator.prototype.getLight=function(){return this._light},ShadowGenerator.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},ShadowGenerator.prototype._initializeShadowMap=function(){var _this=this;this._shadowMap=new BABYLON.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(BABYLON.Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(faceIndex){_this._currentFaceIndex=faceIndex}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(_this.useBlurExponentialShadowMap||_this.useBlurCloseExponentialShadowMap){_this._blurPostProcesses&&_this._blurPostProcesses.length||_this._initializeBlurRTTAndPostProcesses();var shadowMap=_this.getShadowMapForRendering();shadowMap&&_this._scene.postProcessManager.directRender(_this._blurPostProcesses,shadowMap.getInternalTexture(),!0)}}),this._shadowMap.onClearObservable.add(function(engine){_this.useExponentialShadowMap||_this.useBlurExponentialShadowMap?engine.clear(new BABYLON.Color4(0,0,0,0),!0,!0,!0):engine.clear(new BABYLON.Color4(1,1,1,1),!0,!0,!0)})},ShadowGenerator.prototype._initializeBlurRTTAndPostProcesses=function(){var _this=this,engine=this._scene.getEngine(),targetSize=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new BABYLON.RenderTargetTexture(this._light.name+"_shadowMap2",targetSize,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(BABYLON.Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new BABYLON.BlurPostProcess(this._light.name+"KernelBlurX",new BABYLON.Vector2(1,0),this.blurKernel,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._textureType),this._kernelBlurXPostprocess.width=targetSize,this._kernelBlurXPostprocess.height=targetSize,this._kernelBlurXPostprocess.onApplyObservable.add(function(effect){effect.setTexture("textureSampler",_this._shadowMap)}),this._kernelBlurYPostprocess=new BABYLON.BlurPostProcess(this._light.name+"KernelBlurY",new BABYLON.Vector2(0,1),this.blurKernel,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new BABYLON.PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",targetSize,targetSize),effect.setTexture("textureSampler",_this._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},ShadowGenerator.prototype._renderForShadowMap=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index,engine=this._scene.getEngine();if(depthOnlySubMeshes.length){for(engine.setColorWrite(!1),index=0;index<depthOnlySubMeshes.length;index++)this._renderSubMeshForShadowMap(depthOnlySubMeshes.data[index]);engine.setColorWrite(!0)}for(index=0;index<opaqueSubMeshes.length;index++)this._renderSubMeshForShadowMap(opaqueSubMeshes.data[index]);for(index=0;index<alphaTestSubMeshes.length;index++)this._renderSubMeshForShadowMap(alphaTestSubMeshes.data[index]);if(this._transparencyShadow)for(index=0;index<transparentSubMeshes.length;index++)this._renderSubMeshForShadowMap(transparentSubMeshes.data[index])},ShadowGenerator.prototype._renderSubMeshForShadowMap=function(subMesh){var _this=this,mesh=subMesh.getRenderingMesh(),scene=this._scene,engine=scene.getEngine(),material=subMesh.getMaterial();if(material){engine.setState(material.backFaceCulling);var batch=mesh._getInstancesRenderList(subMesh._id);if(!batch.mustReturn){var hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id]&&void 0!==batch.visibleInstances[subMesh._id];if(this.isReady(subMesh,hardwareInstancedRendering)){if(engine.enableEffect(this._effect),mesh._bind(subMesh,this._effect,BABYLON.Material.TriangleFillMode),this._effect.setFloat2("biasAndScale",this.bias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this._effect.setVector3("lightPosition",this.getLight().position),scene.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(scene.activeCamera),this.getLight().getDepthMinZ(scene.activeCamera)+this.getLight().getDepthMaxZ(scene.activeCamera)),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(this._effect.setTexture("diffuseSampler",alphaTexture),this._effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix()||this._defaultTextureMatrix))}mesh.useBones&&mesh.computeBonesUsingShaders&&this._effect.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh)),this.forceBackFacesOnly&&engine.setState(!0,0,!1,!0),mesh._processRendering(subMesh,this._effect,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){return _this._effect.setMatrix("world",world)}),this.forceBackFacesOnly&&engine.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},ShadowGenerator.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===ShadowGenerator.FILTER_NONE?this._shadowMap.updateSamplingMode(BABYLON.Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(BABYLON.Texture.BILINEAR_SAMPLINGMODE))},ShadowGenerator.prototype.forceCompilation=function(onCompiled,options){var _this=this,localOptions=__assign({useInstances:!1},options),shadowMap=this.getShadowMap();if(shadowMap){var renderList=shadowMap.renderList;if(renderList){for(var subMeshes=new Array,_i=0,renderList_1=renderList;_i<renderList_1.length;_i++){var mesh=renderList_1[_i];subMeshes.push.apply(subMeshes,mesh.subMeshes)}if(0!==subMeshes.length){var currentIndex=0,checkReady=function(){if(_this._scene&&_this._scene.getEngine()){for(;_this.isReady(subMeshes[currentIndex],localOptions.useInstances);)if(++currentIndex>=subMeshes.length)return void(onCompiled&&onCompiled(_this));setTimeout(checkReady,16)}};checkReady()}else onCompiled&&onCompiled(this)}else onCompiled&&onCompiled(this)}else onCompiled&&onCompiled(this)},ShadowGenerator.prototype.isReady=function(subMesh,useInstances){var defines=[];this._textureType!==BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT&&defines.push("#define FLOAT"),(this.useExponentialShadowMap||this.useBlurExponentialShadowMap)&&defines.push("#define ESM");var attribs=[BABYLON.VertexBuffer.PositionKind],mesh=subMesh.getMesh(),material=subMesh.getMaterial();if(material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&1===alphaTexture.coordinatesIndex&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2")))}mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton.bones.length+1))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._effect=this._scene.getEngine().createEffect("shadowMap",attribs,["world","mBones","viewProjection","diffuseMatrix","lightPosition","depthValues","biasAndScale"],["diffuseSampler"],join)),this._effect.isReady()},ShadowGenerator.prototype.prepareDefines=function(defines,lightIndex){var scene=this._scene,light=this._light;scene.shadowsEnabled&&light.shadowEnabled&&(defines["SHADOW"+lightIndex]=!0,this.usePoissonSampling?defines["SHADOWPCF"+lightIndex]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?defines["SHADOWESM"+lightIndex]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(defines["SHADOWCLOSEESM"+lightIndex]=!0),light.needCube()&&(defines["SHADOWCUBE"+lightIndex]=!0))},ShadowGenerator.prototype.bindShadowLight=function(lightIndex,effect){var light=this._light,scene=this._scene;if(scene.shadowsEnabled&&light.shadowEnabled){var camera=scene.activeCamera;if(camera){var shadowMap=this.getShadowMap();shadowMap&&(light.needCube()||effect.setMatrix("lightMatrix"+lightIndex,this.getTransformMatrix()),effect.setTexture("shadowSampler"+lightIndex,this.getShadowMapForRendering()),light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/shadowMap.getSize().width,this.depthScale,this.frustumEdgeFalloff,lightIndex),light._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(camera),this.getLight().getDepthMinZ(camera)+this.getLight().getDepthMaxZ(camera),lightIndex))}}},ShadowGenerator.prototype.getTransformMatrix=function(){var scene=this._scene;if(this._currentRenderID===scene.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=scene.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var lightPosition=this._light.position;if(this._light.computeTransformedInformation()&&(lightPosition=this._light.transformedPosition),BABYLON.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(BABYLON.Vector3.Dot(this._lightDirection,BABYLON.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!lightPosition.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition=lightPosition.clone(),this._cachedDirection=this._lightDirection.clone(),BABYLON.Matrix.LookAtLHToRef(lightPosition,lightPosition.add(this._lightDirection),BABYLON.Vector3.Up(),this._viewMatrix);var shadowMap=this.getShadowMap();if(shadowMap){var renderList=shadowMap.renderList;renderList&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,renderList)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},ShadowGenerator.prototype.recreateShadowMap=function(){var shadowMap=this._shadowMap;if(shadowMap){var renderList=shadowMap.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=renderList}},ShadowGenerator.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._downSamplePostprocess&&(this._downSamplePostprocess.dispose(),this._downSamplePostprocess=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},ShadowGenerator.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},ShadowGenerator.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},ShadowGenerator.prototype.serialize=function(){var serializationObject={},shadowMap=this.getShadowMap();if(!shadowMap)return serializationObject;if(serializationObject.lightId=this._light.id,serializationObject.mapSize=shadowMap.getRenderSize(),serializationObject.useExponentialShadowMap=this.useExponentialShadowMap,serializationObject.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,serializationObject.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,serializationObject.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,serializationObject.usePoissonSampling=this.usePoissonSampling,serializationObject.forceBackFacesOnly=this.forceBackFacesOnly,serializationObject.depthScale=this.depthScale,serializationObject.darkness=this.getDarkness(),serializationObject.blurBoxOffset=this.blurBoxOffset,serializationObject.blurKernel=this.blurKernel,serializationObject.blurScale=this.blurScale,serializationObject.useKernelBlur=this.useKernelBlur,serializationObject.transparencyShadow=this._transparencyShadow,serializationObject.renderList=[],shadowMap.renderList)for(var meshIndex=0;meshIndex<shadowMap.renderList.length;meshIndex++){var mesh=shadowMap.renderList[meshIndex];serializationObject.renderList.push(mesh.id)}return serializationObject},ShadowGenerator.Parse=function(parsedShadowGenerator,scene){for(var light=scene.getLightByID(parsedShadowGenerator.lightId),shadowGenerator=new ShadowGenerator(parsedShadowGenerator.mapSize,light),shadowMap=shadowGenerator.getShadowMap(),meshIndex=0;meshIndex<parsedShadowGenerator.renderList.length;meshIndex++)scene.getMeshesByID(parsedShadowGenerator.renderList[meshIndex]).forEach(function(mesh){shadowMap&&(shadowMap.renderList||(shadowMap.renderList=[]),shadowMap.renderList.push(mesh))});return parsedShadowGenerator.usePoissonSampling?shadowGenerator.usePoissonSampling=!0:parsedShadowGenerator.useExponentialShadowMap?shadowGenerator.useExponentialShadowMap=!0:parsedShadowGenerator.useBlurExponentialShadowMap?shadowGenerator.useBlurExponentialShadowMap=!0:parsedShadowGenerator.useCloseExponentialShadowMap?shadowGenerator.useCloseExponentialShadowMap=!0:parsedShadowGenerator.useBlurCloseExponentialShadowMap?shadowGenerator.useBlurCloseExponentialShadowMap=!0:parsedShadowGenerator.useVarianceShadowMap?shadowGenerator.useExponentialShadowMap=!0:parsedShadowGenerator.useBlurVarianceShadowMap&&(shadowGenerator.useBlurExponentialShadowMap=!0),parsedShadowGenerator.depthScale&&(shadowGenerator.depthScale=parsedShadowGenerator.depthScale),parsedShadowGenerator.blurScale&&(shadowGenerator.blurScale=parsedShadowGenerator.blurScale),parsedShadowGenerator.blurBoxOffset&&(shadowGenerator.blurBoxOffset=parsedShadowGenerator.blurBoxOffset),parsedShadowGenerator.useKernelBlur&&(shadowGenerator.useKernelBlur=parsedShadowGenerator.useKernelBlur),parsedShadowGenerator.blurKernel&&(shadowGenerator.blurKernel=parsedShadowGenerator.blurKernel),void 0!==parsedShadowGenerator.bias&&(shadowGenerator.bias=parsedShadowGenerator.bias),parsedShadowGenerator.darkness&&shadowGenerator.setDarkness(parsedShadowGenerator.darkness),parsedShadowGenerator.transparencyShadow&&shadowGenerator.setTransparencyShadow(!0),shadowGenerator.forceBackFacesOnly=parsedShadowGenerator.forceBackFacesOnly,shadowGenerator},ShadowGenerator._FILTER_NONE=0,ShadowGenerator._FILTER_EXPONENTIALSHADOWMAP=1,ShadowGenerator._FILTER_POISSONSAMPLING=2,ShadowGenerator._FILTER_BLUREXPONENTIALSHADOWMAP=3,ShadowGenerator._FILTER_CLOSEEXPONENTIALSHADOWMAP=4,ShadowGenerator._FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,ShadowGenerator}();BABYLON.ShadowGenerator=ShadowGenerator}(BABYLON||(BABYLON={}));!function(BABYLON){var DefaultLoadingScreen=function(){function DefaultLoadingScreen(_renderingCanvas,_loadingText,_loadingDivBackgroundColor){void 0===_loadingText&&(_loadingText=""),void 0===_loadingDivBackgroundColor&&(_loadingDivBackgroundColor="black");var _this=this;this._renderingCanvas=_renderingCanvas,this._loadingText=_loadingText,this._loadingDivBackgroundColor=_loadingDivBackgroundColor,this._resizeLoadingUI=function(){var canvasRect=_this._renderingCanvas.getBoundingClientRect(),canvasPositioning=window.getComputedStyle(_this._renderingCanvas).position;_this._loadingDiv&&(_this._loadingDiv.style.position="fixed"===canvasPositioning?"fixed":"absolute",_this._loadingDiv.style.left=canvasRect.left+"px",_this._loadingDiv.style.top=canvasRect.top+"px",_this._loadingDiv.style.width=canvasRect.width+"px",_this._loadingDiv.style.height=canvasRect.height+"px")}}return DefaultLoadingScreen.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var style=document.createElement("style");style.type="text/css";style.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(style);var imgBack=new Image;imgBack.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC",imgBack.style.position="absolute",imgBack.style.left="50%",imgBack.style.top="50%",imgBack.style.marginLeft="-60px",imgBack.style.marginTop="-60px",imgBack.style.animation="spin1 2s infinite ease-in-out",imgBack.style.webkitAnimation="spin1 2s infinite ease-in-out",imgBack.style.transformOrigin="50% 50%",imgBack.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(imgBack),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},DefaultLoadingScreen.prototype.hideLoadingUI=function(){var _this=this;if(this._loadingDiv){this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){_this._loadingDiv&&(document.body.removeChild(_this._loadingDiv),window.removeEventListener("resize",_this._resizeLoadingUI),_this._loadingDiv=null)})}},Object.defineProperty(DefaultLoadingScreen.prototype,"loadingUIText",{set:function(text){this._loadingText=text,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultLoadingScreen.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(color){this._loadingDivBackgroundColor=color,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),DefaultLoadingScreen}();BABYLON.DefaultLoadingScreen=DefaultLoadingScreen}(BABYLON||(BABYLON={}));!function(BABYLON){var SceneLoader=function(){function SceneLoader(){}return Object.defineProperty(SceneLoader,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"ForceFullSceneLoadingForIncremental",{get:function(){return SceneLoader._ForceFullSceneLoadingForIncremental},set:function(value){SceneLoader._ForceFullSceneLoadingForIncremental=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"ShowLoadingScreen",{get:function(){return SceneLoader._ShowLoadingScreen},set:function(value){SceneLoader._ShowLoadingScreen=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"loggingLevel",{get:function(){return SceneLoader._loggingLevel},set:function(value){SceneLoader._loggingLevel=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneLoader,"CleanBoneMatrixWeights",{get:function(){return SceneLoader._CleanBoneMatrixWeights},set:function(value){SceneLoader._CleanBoneMatrixWeights=value},enumerable:!0,configurable:!0}),SceneLoader._getDefaultPlugin=function(){return SceneLoader._registeredPlugins[".babylon"]},SceneLoader._getPluginForExtension=function(extension){var registeredPlugin=SceneLoader._registeredPlugins[extension];return registeredPlugin||(BABYLON.Tools.Warn("Unable to find a plugin to load "+extension+" files. Trying to use .babylon default plugin."),SceneLoader._getDefaultPlugin())},SceneLoader._getPluginForDirectLoad=function(data){for(var extension in SceneLoader._registeredPlugins){var plugin=SceneLoader._registeredPlugins[extension].plugin;if(plugin.canDirectLoad&&plugin.canDirectLoad(data))return SceneLoader._registeredPlugins[extension]}return SceneLoader._getDefaultPlugin()},SceneLoader._getPluginForFilename=function(sceneFilename){sceneFilename.name&&(sceneFilename=sceneFilename.name);var queryStringPosition=sceneFilename.indexOf("?");-1!==queryStringPosition&&(sceneFilename=sceneFilename.substring(0,queryStringPosition));var dotPosition=sceneFilename.lastIndexOf("."),extension=sceneFilename.substring(dotPosition,sceneFilename.length).toLowerCase();return SceneLoader._getPluginForExtension(extension)},SceneLoader._getDirectLoad=function(sceneFilename){return sceneFilename.substr&&"data:"===sceneFilename.substr(0,5)?sceneFilename.substr(5):null},SceneLoader._loadData=function(rootUrl,sceneFilename,scene,onSuccess,onProgress,onError,pluginExtension){var plugin,directLoad=SceneLoader._getDirectLoad(sceneFilename),registeredPlugin=pluginExtension?SceneLoader._getPluginForExtension(pluginExtension):directLoad?SceneLoader._getPluginForDirectLoad(sceneFilename):SceneLoader._getPluginForFilename(sceneFilename);plugin=registeredPlugin.plugin.createPlugin?registeredPlugin.plugin.createPlugin():registeredPlugin.plugin;var database,useArrayBuffer=registeredPlugin.isBinary;SceneLoader.OnPluginActivatedObservable.notifyObservers(plugin);var dataCallback=function(data,responseURL){if(scene.isDisposed)onError("Scene has been disposed");else{scene.database=database;try{onSuccess(plugin,data,responseURL)}catch(e){onError(null,e)}}},manifestChecked=function(success){BABYLON.Tools.LoadFile(rootUrl+sceneFilename,dataCallback,onProgress,database,useArrayBuffer,function(request){request&&onError(request.status+" "+request.statusText)})};if(directLoad)return dataCallback(directLoad),plugin;if(-1===rootUrl.indexOf("file:"))scene.getEngine().enableOfflineSupport?database=new BABYLON.Database(rootUrl+sceneFilename,manifestChecked):manifestChecked();else{var fileOrString=sceneFilename;fileOrString.name?BABYLON.Tools.ReadFile(fileOrString,dataCallback,onProgress,useArrayBuffer):BABYLON.FilesInput.FilesToLoad[sceneFilename]?BABYLON.Tools.ReadFile(BABYLON.FilesInput.FilesToLoad[sceneFilename],dataCallback,onProgress,useArrayBuffer):onError("Unable to find file named "+sceneFilename)}return plugin},SceneLoader.GetPluginForExtension=function(extension){return SceneLoader._getPluginForExtension(extension).plugin},SceneLoader.RegisterPlugin=function(plugin){if("string"==typeof plugin.extensions){var extension=plugin.extensions;SceneLoader._registeredPlugins[extension.toLowerCase()]={plugin:plugin,isBinary:!1}}else{var extensions=plugin.extensions;Object.keys(extensions).forEach(function(extension){SceneLoader._registeredPlugins[extension.toLowerCase()]={plugin:plugin,isBinary:extensions[extension].isBinary}})}},SceneLoader.ImportMesh=function(meshNames,rootUrl,sceneFilename,scene,onSuccess,onProgress,onError,pluginExtension){if(void 0===onSuccess&&(onSuccess=null),void 0===onProgress&&(onProgress=null),void 0===onError&&(onError=null),sceneFilename.substr&&"/"===sceneFilename.substr(0,1))return BABYLON.Tools.Error("Wrong sceneFilename parameter"),null;var loadingToken={};scene._addPendingData(loadingToken);var errorHandler=function(message,exception){var errorMessage="Unable to import meshes from "+rootUrl+sceneFilename+(message?": "+message:"");onError?onError(scene,errorMessage,exception):BABYLON.Tools.Error(errorMessage),scene._removePendingData(loadingToken)},progressHandler=function(event){onProgress&&onProgress(event)};return SceneLoader._loadData(rootUrl,sceneFilename,scene,function(plugin,data,responseURL){if(plugin.rewriteRootURL&&(rootUrl=plugin.rewriteRootURL(rootUrl,responseURL)),plugin.importMesh){var syncedPlugin=plugin,meshes=new Array,particleSystems=new Array,skeletons=new Array;if(!syncedPlugin.importMesh(meshNames,scene,data,rootUrl,meshes,particleSystems,skeletons,errorHandler))return;if(onSuccess)try{scene.importedMeshesFiles.push(rootUrl+sceneFilename),onSuccess(meshes,particleSystems,skeletons),scene._removePendingData(loadingToken)}catch(e){errorHandler("Error in onSuccess callback.",e)}}else plugin.importMeshAsync(meshNames,scene,data,rootUrl,function(meshes,particleSystems,skeletons){if(onSuccess)try{scene.importedMeshesFiles.push(rootUrl+sceneFilename),onSuccess(meshes,particleSystems,skeletons),scene._removePendingData(loadingToken)}catch(e){errorHandler("Error in onSuccess callback.",e)}},progressHandler,errorHandler)},progressHandler,errorHandler,pluginExtension)},SceneLoader.Load=function(rootUrl,sceneFilename,engine,onSuccess,onProgress,onError,pluginExtension){return SceneLoader.Append(rootUrl,sceneFilename,new BABYLON.Scene(engine),onSuccess,onProgress,onError,pluginExtension)},SceneLoader.Append=function(rootUrl,sceneFilename,scene,onSuccess,onProgress,onError,pluginExtension){if(sceneFilename.substr&&"/"===sceneFilename.substr(0,1))return BABYLON.Tools.Error("Wrong sceneFilename parameter"),null;SceneLoader.ShowLoadingScreen&&scene.getEngine().displayLoadingUI();var loadingToken={};scene._addPendingData(loadingToken);var errorHandler=function(message,exception){var errorMessage="Unable to load from "+rootUrl+sceneFilename+(message?": "+message:"");onError?onError(scene,errorMessage,exception):BABYLON.Tools.Error(errorMessage),scene._removePendingData(loadingToken),scene.getEngine().hideLoadingUI()},progressHandler=function(event){onProgress&&onProgress(event)};return SceneLoader._loadData(rootUrl,sceneFilename,scene,function(plugin,data,responseURL){if(plugin.load){if(!plugin.load(scene,data,rootUrl,errorHandler))return;if(onSuccess)try{onSuccess(scene)}catch(e){errorHandler("Error in onSuccess callback",e)}scene.loadingPluginName=plugin.name,scene._removePendingData(loadingToken)}else plugin.loadAsync(scene,data,rootUrl,function(){onSuccess&&onSuccess(scene),scene.loadingPluginName=plugin.name,scene._removePendingData(loadingToken)},progressHandler,errorHandler);SceneLoader.ShowLoadingScreen&&scene.executeWhenReady(function(){scene.getEngine().hideLoadingUI()})},progressHandler,errorHandler,pluginExtension)},SceneLoader._ForceFullSceneLoadingForIncremental=!1,SceneLoader._ShowLoadingScreen=!0,SceneLoader._CleanBoneMatrixWeights=!1,SceneLoader._loggingLevel=SceneLoader.NO_LOGGING,SceneLoader.OnPluginActivatedObservable=new BABYLON.Observable,SceneLoader._registeredPlugins={},SceneLoader}();BABYLON.SceneLoader=SceneLoader}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var parseMaterialById=function(id,parsedData,scene,rootUrl){for(var index=0,cache=parsedData.materials.length;index<cache;index++){var parsedMaterial=parsedData.materials[index];if(parsedMaterial.id===id)return BABYLON.Material.Parse(parsedMaterial,scene,rootUrl)}return null},isDescendantOf=function(mesh,names,hierarchyIds){for(var i in names)if(mesh.name===names[i])return hierarchyIds.push(mesh.id),!0;return!(!mesh.parentId||-1===hierarchyIds.indexOf(mesh.parentId))&&(hierarchyIds.push(mesh.id),!0)},logOperation=function(operation,producer){return operation+" of "+(producer?producer.file+" from "+producer.name+" version: "+producer.version+", exporter version: "+producer.exporter_version:"unknown")};BABYLON.SceneLoader.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(data){return-1!==data.indexOf("babylon")},importMesh:function(meshesNames,scene,data,rootUrl,meshes,particleSystems,skeletons,onError){var log="importMesh has failed JSON parse";try{var parsedData=JSON.parse(data);log="";var fullDetails=BABYLON.SceneLoader.loggingLevel===BABYLON.SceneLoader.DETAILED_LOGGING;meshesNames?Array.isArray(meshesNames)||(meshesNames=[meshesNames]):meshesNames=null;var hierarchyIds=new Array;if(void 0!==parsedData.meshes&&null!==parsedData.meshes){var index,cache,loadedSkeletonsIds=[],loadedMaterialsIds=[];for(index=0,cache=parsedData.meshes.length;index<cache;index++){var parsedMesh=parsedData.meshes[index];if(null===meshesNames||isDescendantOf(parsedMesh,meshesNames,hierarchyIds)){if(null!==meshesNames&&delete meshesNames[meshesNames.indexOf(parsedMesh.name)],void 0!==parsedMesh.geometryId&&null!==parsedMesh.geometryId&&void 0!==parsedData.geometries&&null!==parsedData.geometries){var found=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(geometryType){!0!==found&&parsedData.geometries[geometryType]&&Array.isArray(parsedData.geometries[geometryType])&&parsedData.geometries[geometryType].forEach(function(parsedGeometryData){if(parsedGeometryData.id===parsedMesh.geometryId){switch(geometryType){case"boxes":BABYLON.Geometry.Primitives.Box.Parse(parsedGeometryData,scene);break;case"spheres":BABYLON.Geometry.Primitives.Sphere.Parse(parsedGeometryData,scene);break;case"cylinders":BABYLON.Geometry.Primitives.Cylinder.Parse(parsedGeometryData,scene);break;case"toruses":BABYLON.Geometry.Primitives.Torus.Parse(parsedGeometryData,scene);break;case"grounds":BABYLON.Geometry.Primitives.Ground.Parse(parsedGeometryData,scene);break;case"planes":BABYLON.Geometry.Primitives.Plane.Parse(parsedGeometryData,scene);break;case"torusKnots":BABYLON.Geometry.Primitives.TorusKnot.Parse(parsedGeometryData,scene);break;case"vertexData":BABYLON.Geometry.Parse(parsedGeometryData,scene,rootUrl)}found=!0}})}),!1===found&&BABYLON.Tools.Warn("Geometry not found for mesh "+parsedMesh.id)}if(parsedMesh.materialId){var materialFound=-1!==loadedMaterialsIds.indexOf(parsedMesh.materialId);if(!1===materialFound&&void 0!==parsedData.multiMaterials&&null!==parsedData.multiMaterials)for(var multimatIndex=0,multimatCache=parsedData.multiMaterials.length;multimatIndex<multimatCache;multimatIndex++){var parsedMultiMaterial=parsedData.multiMaterials[multimatIndex];if(parsedMultiMaterial.id===parsedMesh.materialId){for(var matIndex=0,matCache=parsedMultiMaterial.materials.length;matIndex<matCache;matIndex++){var subMatId=parsedMultiMaterial.materials[matIndex];loadedMaterialsIds.push(subMatId);var mat=parseMaterialById(subMatId,parsedData,scene,rootUrl);log+="\n\tMaterial "+mat.toString(fullDetails)}loadedMaterialsIds.push(parsedMultiMaterial.id);var mmat=BABYLON.Material.ParseMultiMaterial(parsedMultiMaterial,scene);materialFound=!0,log+="\n\tMulti-Material "+mmat.toString(fullDetails);break}}!1===materialFound&&(loadedMaterialsIds.push(parsedMesh.materialId),(mat=parseMaterialById(parsedMesh.materialId,parsedData,scene,rootUrl))?log+="\n\tMaterial "+mat.toString(fullDetails):BABYLON.Tools.Warn("Material not found for mesh "+parsedMesh.id))}if(parsedMesh.skeletonId>-1&&void 0!==parsedData.skeletons&&null!==parsedData.skeletons&&!1===loadedSkeletonsIds.indexOf(parsedMesh.skeletonId)>-1)for(var skeletonIndex=0,skeletonCache=parsedData.skeletons.length;skeletonIndex<skeletonCache;skeletonIndex++){var parsedSkeleton=parsedData.skeletons[skeletonIndex];if(parsedSkeleton.id===parsedMesh.skeletonId){var skeleton=BABYLON.Skeleton.Parse(parsedSkeleton,scene);skeletons.push(skeleton),loadedSkeletonsIds.push(parsedSkeleton.id),log+="\n\tSkeleton "+skeleton.toString(fullDetails)}}var mesh=BABYLON.Mesh.Parse(parsedMesh,scene,rootUrl);meshes.push(mesh),log+="\n\tMesh "+mesh.toString(fullDetails)}}var currentMesh;for(index=0,cache=scene.meshes.length;index<cache;index++)(currentMesh=scene.meshes[index])._waitingParentId&&(currentMesh.parent=scene.getLastEntryByID(currentMesh._waitingParentId),currentMesh._waitingParentId=null);for(index=0,cache=scene.meshes.length;index<cache;index++)(currentMesh=scene.meshes[index])._waitingFreezeWorldMatrix?(currentMesh.freezeWorldMatrix(),currentMesh._waitingFreezeWorldMatrix=null):currentMesh.computeWorldMatrix(!0)}if(void 0!==parsedData.particleSystems&&null!==parsedData.particleSystems)for(index=0,cache=parsedData.particleSystems.length;index<cache;index++){var parsedParticleSystem=parsedData.particleSystems[index];-1!==hierarchyIds.indexOf(parsedParticleSystem.emitterId)&&particleSystems.push(BABYLON.ParticleSystem.Parse(parsedParticleSystem,scene,rootUrl))}return!0}catch(err){var msg=logOperation("importMesh",parsedData?parsedData.producer:"Unknown")+log;if(!onError)throw BABYLON.Tools.Log(msg),err;onError(msg,err)}finally{null!==log&&BABYLON.SceneLoader.loggingLevel!==BABYLON.SceneLoader.NO_LOGGING&&BABYLON.Tools.Log(logOperation("importMesh",parsedData?parsedData.producer:"Unknown")+(BABYLON.SceneLoader.loggingLevel!==BABYLON.SceneLoader.MINIMAL_LOGGING?log:""))}return!1},load:function(scene,data,rootUrl,onError){var log="importScene has failed JSON parse";try{var parsedData=JSON.parse(data);log="";var fullDetails=BABYLON.SceneLoader.loggingLevel===BABYLON.SceneLoader.DETAILED_LOGGING;if(void 0!==parsedData.useDelayedTextureLoading&&null!==parsedData.useDelayedTextureLoading&&(scene.useDelayedTextureLoading=parsedData.useDelayedTextureLoading&&!BABYLON.SceneLoader.ForceFullSceneLoadingForIncremental),void 0!==parsedData.autoClear&&null!==parsedData.autoClear&&(scene.autoClear=parsedData.autoClear),void 0!==parsedData.clearColor&&null!==parsedData.clearColor&&(scene.clearColor=BABYLON.Color4.FromArray(parsedData.clearColor)),void 0!==parsedData.ambientColor&&null!==parsedData.ambientColor&&(scene.ambientColor=BABYLON.Color3.FromArray(parsedData.ambientColor)),void 0!==parsedData.gravity&&null!==parsedData.gravity&&(scene.gravity=BABYLON.Vector3.FromArray(parsedData.gravity)),parsedData.fogMode&&0!==parsedData.fogMode)switch(scene.fogMode=parsedData.fogMode,scene.fogColor=BABYLON.Color3.FromArray(parsedData.fogColor),scene.fogStart=parsedData.fogStart,scene.fogEnd=parsedData.fogEnd,scene.fogDensity=parsedData.fogDensity,log+="\tFog mode for scene:  ",scene.fogMode){case 1:log+="exp\n";break;case 2:log+="exp2\n";break;case 3:log+="linear\n"}if(parsedData.physicsEnabled){var physicsPlugin;"cannon"===parsedData.physicsEngine?physicsPlugin=new BABYLON.CannonJSPlugin:"oimo"===parsedData.physicsEngine&&(physicsPlugin=new BABYLON.OimoJSPlugin),log="\tPhysics engine "+(parsedData.physicsEngine?parsedData.physicsEngine:"oimo")+" enabled\n";var physicsGravity=parsedData.physicsGravity?BABYLON.Vector3.FromArray(parsedData.physicsGravity):null;scene.enablePhysics(physicsGravity,physicsPlugin)}void 0!==parsedData.metadata&&null!==parsedData.metadata&&(scene.metadata=parsedData.metadata),void 0!==parsedData.collisionsEnabled&&null!==parsedData.collisionsEnabled&&(scene.collisionsEnabled=parsedData.collisionsEnabled),scene.workerCollisions=!!parsedData.workerCollisions;var index,cache;if(void 0!==parsedData.lights&&null!==parsedData.lights)for(index=0,cache=parsedData.lights.length;index<cache;index++){var parsedLight=parsedData.lights[index],light=BABYLON.Light.Parse(parsedLight,scene);light&&(log+=0===index?"\n\tLights:":"",log+="\n\t\t"+light.toString(fullDetails))}if(void 0!==parsedData.animations&&null!==parsedData.animations)for(index=0,cache=parsedData.animations.length;index<cache;index++){var parsedAnimation=parsedData.animations[index],animation=BABYLON.Animation.Parse(parsedAnimation);scene.animations.push(animation),log+=0===index?"\n\tAnimations:":"",log+="\n\t\t"+animation.toString(fullDetails)}if(parsedData.autoAnimate&&scene.beginAnimation(scene,parsedData.autoAnimateFrom,parsedData.autoAnimateTo,parsedData.autoAnimateLoop,parsedData.autoAnimateSpeed||1),void 0!==parsedData.materials&&null!==parsedData.materials)for(index=0,cache=parsedData.materials.length;index<cache;index++){var parsedMaterial=parsedData.materials[index],mat=BABYLON.Material.Parse(parsedMaterial,scene,rootUrl);log+=0===index?"\n\tMaterials:":"",log+="\n\t\t"+mat.toString(fullDetails)}if(void 0!==parsedData.multiMaterials&&null!==parsedData.multiMaterials)for(index=0,cache=parsedData.multiMaterials.length;index<cache;index++){var parsedMultiMaterial=parsedData.multiMaterials[index],mmat=BABYLON.Material.ParseMultiMaterial(parsedMultiMaterial,scene);log+=0===index?"\n\tMultiMaterials:":"",log+="\n\t\t"+mmat.toString(fullDetails)}if(void 0!==parsedData.morphTargetManagers&&null!==parsedData.morphTargetManagers)for(var _i=0,_a=parsedData.morphTargetManagers;_i<_a.length;_i++){var managerData=_a[_i];BABYLON.MorphTargetManager.Parse(managerData,scene)}if(void 0!==parsedData.skeletons&&null!==parsedData.skeletons)for(index=0,cache=parsedData.skeletons.length;index<cache;index++){var parsedSkeleton=parsedData.skeletons[index],skeleton=BABYLON.Skeleton.Parse(parsedSkeleton,scene);log+=0===index?"\n\tSkeletons:":"",log+="\n\t\t"+skeleton.toString(fullDetails)}var geometries=parsedData.geometries;if(void 0!==geometries&&null!==geometries){var boxes=geometries.boxes;if(void 0!==boxes&&null!==boxes)for(index=0,cache=boxes.length;index<cache;index++){var parsedBox=boxes[index];BABYLON.Geometry.Primitives.Box.Parse(parsedBox,scene)}var spheres=geometries.spheres;if(void 0!==spheres&&null!==spheres)for(index=0,cache=spheres.length;index<cache;index++){var parsedSphere=spheres[index];BABYLON.Geometry.Primitives.Sphere.Parse(parsedSphere,scene)}var cylinders=geometries.cylinders;if(void 0!==cylinders&&null!==cylinders)for(index=0,cache=cylinders.length;index<cache;index++){var parsedCylinder=cylinders[index];BABYLON.Geometry.Primitives.Cylinder.Parse(parsedCylinder,scene)}var toruses=geometries.toruses;if(void 0!==toruses&&null!==toruses)for(index=0,cache=toruses.length;index<cache;index++){var parsedTorus=toruses[index];BABYLON.Geometry.Primitives.Torus.Parse(parsedTorus,scene)}var grounds=geometries.grounds;if(void 0!==grounds&&null!==grounds)for(index=0,cache=grounds.length;index<cache;index++){var parsedGround=grounds[index];BABYLON.Geometry.Primitives.Ground.Parse(parsedGround,scene)}var planes=geometries.planes;if(void 0!==planes&&null!==planes)for(index=0,cache=planes.length;index<cache;index++){var parsedPlane=planes[index];BABYLON.Geometry.Primitives.Plane.Parse(parsedPlane,scene)}var torusKnots=geometries.torusKnots;if(void 0!==torusKnots&&null!==torusKnots)for(index=0,cache=torusKnots.length;index<cache;index++){var parsedTorusKnot=torusKnots[index];BABYLON.Geometry.Primitives.TorusKnot.Parse(parsedTorusKnot,scene)}var vertexData=geometries.vertexData;if(void 0!==vertexData&&null!==vertexData)for(index=0,cache=vertexData.length;index<cache;index++){var parsedVertexData=vertexData[index];BABYLON.Geometry.Parse(parsedVertexData,scene,rootUrl)}}if(void 0!==parsedData.transformNodes&&null!==parsedData.transformNodes)for(index=0,cache=parsedData.transformNodes.length;index<cache;index++){var parsedTransformNode=parsedData.transformNodes[index];BABYLON.TransformNode.Parse(parsedTransformNode,scene,rootUrl)}if(void 0!==parsedData.meshes&&null!==parsedData.meshes)for(index=0,cache=parsedData.meshes.length;index<cache;index++){var parsedMesh=parsedData.meshes[index],mesh=BABYLON.Mesh.Parse(parsedMesh,scene,rootUrl);log+=0===index?"\n\tMeshes:":"",log+="\n\t\t"+mesh.toString(fullDetails)}if(void 0!==parsedData.cameras&&null!==parsedData.cameras)for(index=0,cache=parsedData.cameras.length;index<cache;index++){var parsedCamera=parsedData.cameras[index],camera=BABYLON.Camera.Parse(parsedCamera,scene);log+=0===index?"\n\tCameras:":"",log+="\n\t\t"+camera.toString(fullDetails)}for(void 0!==parsedData.activeCameraID&&null!==parsedData.activeCameraID&&scene.setActiveCameraByID(parsedData.activeCameraID),index=0,cache=scene.cameras.length;index<cache;index++)(camera=scene.cameras[index])._waitingParentId&&(camera.parent=scene.getLastEntryByID(camera._waitingParentId),camera._waitingParentId=null);for(index=0,cache=scene.lights.length;index<cache;index++){var light_1=scene.lights[index];light_1&&light_1._waitingParentId&&(light_1.parent=scene.getLastEntryByID(light_1._waitingParentId),light_1._waitingParentId=null)}var loadedSound,loadedSounds=[];if(BABYLON.AudioEngine&&void 0!==parsedData.sounds&&null!==parsedData.sounds)for(index=0,cache=parsedData.sounds.length;index<cache;index++){var parsedSound=parsedData.sounds[index];BABYLON.Engine.audioEngine.canUseWebAudio?(parsedSound.url||(parsedSound.url=parsedSound.name),loadedSounds[parsedSound.url]?BABYLON.Sound.Parse(parsedSound,scene,rootUrl,loadedSounds[parsedSound.url]):(loadedSound=BABYLON.Sound.Parse(parsedSound,scene,rootUrl),loadedSounds[parsedSound.url]=loadedSound)):new BABYLON.Sound(parsedSound.name,null,scene)}for(loadedSounds=[],index=0,cache=scene.transformNodes.length;index<cache;index++){var transformNode=scene.transformNodes[index];transformNode._waitingParentId&&(transformNode.parent=scene.getLastEntryByID(transformNode._waitingParentId),transformNode._waitingParentId=null)}for(index=0,cache=scene.meshes.length;index<cache;index++)(mesh=scene.meshes[index])._waitingParentId&&(mesh.parent=scene.getLastEntryByID(mesh._waitingParentId),mesh._waitingParentId=null),mesh._waitingActions&&(BABYLON.ActionManager.Parse(mesh._waitingActions,mesh,scene),mesh._waitingActions=null);for(index=0,cache=scene.meshes.length;index<cache;index++){var currentMesh=scene.meshes[index];currentMesh._waitingFreezeWorldMatrix?(currentMesh.freezeWorldMatrix(),currentMesh._waitingFreezeWorldMatrix=null):currentMesh.computeWorldMatrix(!0)}if(void 0!==parsedData.particleSystems&&null!==parsedData.particleSystems)for(index=0,cache=parsedData.particleSystems.length;index<cache;index++){var parsedParticleSystem=parsedData.particleSystems[index];BABYLON.ParticleSystem.Parse(parsedParticleSystem,scene,rootUrl)}if(void 0!==parsedData.environmentTexture&&null!==parsedData.environmentTexture&&(scene.environmentTexture=BABYLON.CubeTexture.CreateFromPrefilteredData(rootUrl+parsedData.environmentTexture,scene),!0===parsedData.createDefaultSkybox)){var skyboxScale=void 0!==scene.activeCamera&&null!==scene.activeCamera?(scene.activeCamera.maxZ-scene.activeCamera.minZ)/2:1e3,skyboxBlurLevel=parsedData.skyboxBlurLevel||0;scene.createDefaultSkybox(void 0,!0,skyboxScale,skyboxBlurLevel)}if(void 0!==parsedData.lensFlareSystems&&null!==parsedData.lensFlareSystems)for(index=0,cache=parsedData.lensFlareSystems.length;index<cache;index++){var parsedLensFlareSystem=parsedData.lensFlareSystems[index];BABYLON.LensFlareSystem.Parse(parsedLensFlareSystem,scene,rootUrl)}if(void 0!==parsedData.shadowGenerators&&null!==parsedData.shadowGenerators)for(index=0,cache=parsedData.shadowGenerators.length;index<cache;index++){var parsedShadowGenerator=parsedData.shadowGenerators[index];BABYLON.ShadowGenerator.Parse(parsedShadowGenerator,scene)}for(index=0,cache=scene.lights.length;index<cache;index++){var light_2=scene.lights[index];if(light_2._excludedMeshesIds.length>0){for(var excludedIndex=0;excludedIndex<light_2._excludedMeshesIds.length;excludedIndex++){var excludedMesh=scene.getMeshByID(light_2._excludedMeshesIds[excludedIndex]);excludedMesh&&light_2.excludedMeshes.push(excludedMesh)}light_2._excludedMeshesIds=[]}if(light_2._includedOnlyMeshesIds.length>0){for(var includedOnlyIndex=0;includedOnlyIndex<light_2._includedOnlyMeshesIds.length;includedOnlyIndex++){var includedOnlyMesh=scene.getMeshByID(light_2._includedOnlyMeshesIds[includedOnlyIndex]);includedOnlyMesh&&light_2.includedOnlyMeshes.push(includedOnlyMesh)}light_2._includedOnlyMeshesIds=[]}}return void 0!==parsedData.actions&&null!==parsedData.actions&&BABYLON.ActionManager.Parse(parsedData.actions,null,scene),!0}catch(err){var msg=logOperation("importScene",parsedData?parsedData.producer:"Unknown")+log;if(!onError)throw BABYLON.Tools.Log(msg),err;onError(msg,err)}finally{null!==log&&BABYLON.SceneLoader.loggingLevel!==BABYLON.SceneLoader.NO_LOGGING&&BABYLON.Tools.Log(logOperation("importScene",parsedData?parsedData.producer:"Unknown")+(BABYLON.SceneLoader.loggingLevel!==BABYLON.SceneLoader.MINIMAL_LOGGING?log:""))}return!1}})}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var FilesInput=function(){function FilesInput(engine,scene,sceneLoadedCallback,progressCallback,additionalRenderLoopLogicCallback,textureLoadingCallback,startingProcessingFilesCallback,onReloadCallback,errorCallback){this.onProcessFileCallback=function(){return!0},this._engine=engine,this._currentScene=scene,this._sceneLoadedCallback=sceneLoadedCallback,this._progressCallback=progressCallback,this._additionalRenderLoopLogicCallback=additionalRenderLoopLogicCallback,this._textureLoadingCallback=textureLoadingCallback,this._startingProcessingFilesCallback=startingProcessingFilesCallback,this._onReloadCallback=onReloadCallback,this._errorCallback=errorCallback}return FilesInput.prototype.monitorElementForDragNDrop=function(elementToMonitor){var _this=this;elementToMonitor&&(this._elementToMonitor=elementToMonitor,this._dragEnterHandler=function(e){_this.drag(e)},this._dragOverHandler=function(e){_this.drag(e)},this._dropHandler=function(e){_this.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},FilesInput.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},FilesInput.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var remaining=this._currentScene.getWaitingItemsCount();remaining>0&&this._textureLoadingCallback(remaining)}this._currentScene.render()}},FilesInput.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},FilesInput.prototype.drop=function(eventDrop){eventDrop.stopPropagation(),eventDrop.preventDefault(),this.loadFiles(eventDrop)},FilesInput.prototype._traverseFolder=function(folder,files,remaining,callback){var _this=this,reader=folder.createReader(),relativePath=folder.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");reader.readEntries(function(entries){remaining.count+=entries.length;for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var entry=entries_1[_i];entry.isFile?entry.file(function(file){file.correctName=relativePath+file.name,files.push(file),0==--remaining.count&&callback()}):entry.isDirectory&&_this._traverseFolder(entry,files,remaining,callback)}--remaining.count&&callback()})},FilesInput.prototype._processFiles=function(files){for(var skippedFiles=0,i=0;i<files.length;i++){var name=files[i].correctName.toLowerCase(),extension=name.split(".").pop();this.onProcessFileCallback(files[i],name,extension)?"babylon"!==extension&&"stl"!==extension&&"obj"!==extension&&"gltf"!==extension&&"glb"!==extension||-1!==name.indexOf(".binary.babylon")||-1!==name.indexOf(".incremental.babylon")?FilesInput.FilesToLoad[name]=files[i]:this._sceneFileToLoad=files[i]:skippedFiles++}this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):skippedFiles<files.length&&this.reload()},FilesInput.prototype.loadFiles=function(event){var _this=this;if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),event&&event.dataTransfer&&event.dataTransfer.files&&(this._filesToLoad=event.dataTransfer.files),event&&event.target&&event.target.files&&(this._filesToLoad=event.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var files_1=new Array,folders=[],items=event.dataTransfer?event.dataTransfer.items:null,i=0;i<this._filesToLoad.length;i++){var fileToLoad=this._filesToLoad[i],name_1=fileToLoad.name.toLowerCase(),entry=void 0;if(fileToLoad.correctName=name_1,items){var item=items[i];item.getAsEntry?entry=item.getAsEntry():item.webkitGetAsEntry&&(entry=item.webkitGetAsEntry())}entry&&entry.isDirectory?folders.push(entry):files_1.push(fileToLoad)}if(0===folders.length)this._processFiles(files_1);else for(var remaining={count:folders.length},_i=0,folders_1=folders;_i<folders_1.length;_i++){var folder=folders_1[_i];this._traverseFolder(folder,files_1,remaining,function(){_this._processFiles(files_1)})}}},FilesInput.prototype.reload=function(){var _this=this;this._sceneFileToLoad?(this._currentScene&&(BABYLON.Tools.errorsCount>0&&(BABYLON.Tools.ClearLogCache(),BABYLON.Tools.Log("Babylon.js engine (v"+BABYLON.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),BABYLON.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(newScene){_this._currentScene=newScene,_this._sceneLoadedCallback&&_this._sceneLoadedCallback(_this._sceneFileToLoad,_this._currentScene),_this._currentScene.executeWhenReady(function(){_this._engine.runRenderLoop(function(){_this.renderFunction()})})},function(progress){_this._progressCallback&&_this._progressCallback(progress)},function(scene,message){_this._currentScene=scene,_this._errorCallback&&_this._errorCallback(_this._sceneFileToLoad,_this._currentScene,message)})):BABYLON.Tools.Error("Please provide a valid .babylon file.")},FilesInput.FilesToLoad={},FilesInput}();BABYLON.FilesInput=FilesInput}(BABYLON||(BABYLON={}));!function(BABYLON){var StringDictionary=function(){function StringDictionary(){this._count=0,this._data={}}return StringDictionary.prototype.copyFrom=function(source){var _this=this;this.clear(),source.forEach(function(t,v){return _this.add(t,v)})},StringDictionary.prototype.get=function(key){var val=this._data[key];if(void 0!==val)return val},StringDictionary.prototype.getOrAddWithFactory=function(key,factory){var val=this.get(key);return void 0!==val?val:((val=factory(key))&&this.add(key,val),val)},StringDictionary.prototype.getOrAdd=function(key,val){var curVal=this.get(key);return void 0!==curVal?curVal:(this.add(key,val),val)},StringDictionary.prototype.contains=function(key){return void 0!==this._data[key]},StringDictionary.prototype.add=function(key,value){return void 0===this._data[key]&&(this._data[key]=value,++this._count,!0)},StringDictionary.prototype.set=function(key,value){return void 0!==this._data[key]&&(this._data[key]=value,!0)},StringDictionary.prototype.getAndRemove=function(key){var val=this.get(key);return void 0!==val?(delete this._data[key],--this._count,val):null},StringDictionary.prototype.remove=function(key){return!!this.contains(key)&&(delete this._data[key],--this._count,!0)},StringDictionary.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(StringDictionary.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),StringDictionary.prototype.forEach=function(callback){for(var cur in this._data)callback(cur,this._data[cur])},StringDictionary.prototype.first=function(callback){for(var cur in this._data){var res=callback(cur,this._data[cur]);if(res)return res}return null},StringDictionary}();BABYLON.StringDictionary=StringDictionary}(BABYLON||(BABYLON={}));!function(BABYLON){var Tags=function(){function Tags(){}return Tags.EnableFor=function(obj){obj._tags=obj._tags||{},obj.hasTags=function(){return Tags.HasTags(obj)},obj.addTags=function(tagsString){return Tags.AddTagsTo(obj,tagsString)},obj.removeTags=function(tagsString){return Tags.RemoveTagsFrom(obj,tagsString)},obj.matchesTagsQuery=function(tagsQuery){return Tags.MatchesQuery(obj,tagsQuery)}},Tags.DisableFor=function(obj){delete obj._tags,delete obj.hasTags,delete obj.addTags,delete obj.removeTags,delete obj.matchesTagsQuery},Tags.HasTags=function(obj){return!!obj._tags&&!BABYLON.Tools.IsEmpty(obj._tags)},Tags.GetTags=function(obj,asString){if(void 0===asString&&(asString=!0),!obj._tags)return null;if(asString){var tagsArray=[];for(var tag in obj._tags)obj._tags.hasOwnProperty(tag)&&!0===obj._tags[tag]&&tagsArray.push(tag);return tagsArray.join(" ")}return obj._tags},Tags.AddTagsTo=function(obj,tagsString){tagsString&&"string"==typeof tagsString&&tagsString.split(" ").forEach(function(tag,index,array){Tags._AddTagTo(obj,tag)})},Tags._AddTagTo=function(obj,tag){""!==(tag=tag.trim())&&"true"!==tag&&"false"!==tag&&(tag.match(/[\s]/)||tag.match(/^([!]|([|]|[&]){2})/)||(Tags.EnableFor(obj),obj._tags[tag]=!0))},Tags.RemoveTagsFrom=function(obj,tagsString){if(Tags.HasTags(obj)){var tags=tagsString.split(" ");for(var t in tags)Tags._RemoveTagFrom(obj,tags[t])}},Tags._RemoveTagFrom=function(obj,tag){delete obj._tags[tag]},Tags.MatchesQuery=function(obj,tagsQuery){return void 0===tagsQuery||(""===tagsQuery?Tags.HasTags(obj):BABYLON.Internals.AndOrNotEvaluator.Eval(tagsQuery,function(r){return Tags.HasTags(obj)&&obj._tags[r]}))},Tags}();BABYLON.Tags=Tags}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var AndOrNotEvaluator=function(){function AndOrNotEvaluator(){}return AndOrNotEvaluator.Eval=function(query,evaluateCallback){return"true"===(query=query.match(/\([^\(\)]*\)/g)?query.replace(/\([^\(\)]*\)/g,function(r){return r=r.slice(1,r.length-1),AndOrNotEvaluator._HandleParenthesisContent(r,evaluateCallback)}):AndOrNotEvaluator._HandleParenthesisContent(query,evaluateCallback))||"false"!==query&&AndOrNotEvaluator.Eval(query,evaluateCallback)},AndOrNotEvaluator._HandleParenthesisContent=function(parenthesisContent,evaluateCallback){evaluateCallback=evaluateCallback||function(r){return"true"===r};var result,or=parenthesisContent.split("||");for(var i in or)if(or.hasOwnProperty(i)){var ori=AndOrNotEvaluator._SimplifyNegation(or[i].trim()),and=ori.split("&&");if(and.length>1)for(var j=0;j<and.length;++j){var andj=AndOrNotEvaluator._SimplifyNegation(and[j].trim());if(!(result="true"!==andj&&"false"!==andj?"!"===andj[0]?!evaluateCallback(andj.substring(1)):evaluateCallback(andj):"true"===andj)){ori="false";break}}if(result||"true"===ori){result=!0;break}result="true"!==ori&&"false"!==ori?"!"===ori[0]?!evaluateCallback(ori.substring(1)):evaluateCallback(ori):"true"===ori}return result?"true":"false"},AndOrNotEvaluator._SimplifyNegation=function(booleanString){return booleanString=booleanString.replace(/^[\s!]+/,function(r){return(r=r.replace(/[\s]/g,function(){return""})).length%2?"!":""}),"!true"===(booleanString=booleanString.trim())?booleanString="false":"!false"===booleanString&&(booleanString="true"),booleanString},AndOrNotEvaluator}();Internals.AndOrNotEvaluator=AndOrNotEvaluator}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var Database=function(){function Database(urlToScene,callbackManifestChecked){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=callbackManifestChecked,this.currentSceneUrl=Database.ReturnFullUrlLocation(urlToScene),this.db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,Database.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return Object.defineProperty(Database.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(Database.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),Database.prototype.checkManifestFile=function(){var _this=this,noManifestFile=function(){_this._enableSceneOffline=!1,_this._enableTexturesOffline=!1,_this.callbackManifestChecked(!1)},timeStampUsed=!1,manifestURL=this.currentSceneUrl+".manifest",xhr=new XMLHttpRequest;navigator.onLine&&(timeStampUsed=!0,manifestURL=manifestURL+(null==manifestURL.match(/\?/)?"?":"&")+(new Date).getTime()),xhr.open("GET",manifestURL,!0),xhr.addEventListener("load",function(){if(200===xhr.status||BABYLON.Tools.ValidateXHRData(xhr,1))try{var manifestFile=JSON.parse(xhr.response);_this._enableSceneOffline=manifestFile.enableSceneOffline,_this._enableTexturesOffline=manifestFile.enableTexturesOffline,manifestFile.version&&!isNaN(parseInt(manifestFile.version))&&(_this.manifestVersionFound=manifestFile.version),_this.callbackManifestChecked&&_this.callbackManifestChecked(!0)}catch(ex){noManifestFile()}else noManifestFile()},!1),xhr.addEventListener("error",function(event){if(timeStampUsed){timeStampUsed=!1;var retryManifestURL=_this.currentSceneUrl+".manifest";xhr.open("GET",retryManifestURL,!0),xhr.send()}else noManifestFile()},!1);try{xhr.send()}catch(ex){BABYLON.Tools.Error("Error on XHR send request."),this.callbackManifestChecked(!1)}},Database.prototype.openAsync=function(successCallback,errorCallback){var _this=this,handleError=function(){_this.isSupported=!1,errorCallback&&errorCallback()};if(this.idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this.db)successCallback&&successCallback();else{this.hasReachedQuota=!1,this.isSupported=!0;var request=this.idbFactory.open("babylonjs",1);request.onerror=function(event){handleError()},request.onblocked=function(event){BABYLON.Tools.Error("IDB request blocked. Please reload the page."),handleError()},request.onsuccess=function(event){_this.db=request.result,successCallback()},request.onupgradeneeded=function(event){if(_this.db=event.target.result,_this.db)try{_this.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),_this.db.createObjectStore("versions",{keyPath:"sceneUrl"}),_this.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(ex){BABYLON.Tools.Error("Error while creating object stores. Exception: "+ex.message),handleError()}}}else this.isSupported=!1,errorCallback&&errorCallback()},Database.prototype.loadImageFromDB=function(url,image){var _this=this,completeURL=Database.ReturnFullUrlLocation(url),saveAndLoadImage=function(){_this.hasReachedQuota||null===_this.db?image.src=url:_this._saveImageIntoDBAsync(completeURL,image)};this.mustUpdateRessources?saveAndLoadImage():this._loadImageFromDBAsync(completeURL,image,saveAndLoadImage)},Database.prototype._loadImageFromDBAsync=function(url,image,notInDBCallback){if(this.isSupported&&null!==this.db){var texture,transaction=this.db.transaction(["textures"]);transaction.onabort=function(event){image.src=url},transaction.oncomplete=function(event){var blobTextureURL;if(texture){var URL=window.URL||window.webkitURL;blobTextureURL=URL.createObjectURL(texture.data,{oneTimeOnly:!0}),image.onerror=function(){BABYLON.Tools.Error("Error loading image from blob URL: "+blobTextureURL+" switching back to web url: "+url),image.src=url},image.src=blobTextureURL}else notInDBCallback()};var getRequest=transaction.objectStore("textures").get(url);getRequest.onsuccess=function(event){texture=event.target.result},getRequest.onerror=function(event){BABYLON.Tools.Error("Error loading texture "+url+" from DB."),image.src=url}}else BABYLON.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),image.src=url},Database.prototype._saveImageIntoDBAsync=function(url,image){var _this=this;if(this.isSupported){var generateBlobUrl=function(){var blobTextureURL;if(blob){var URL=window.URL||window.webkitURL;try{blobTextureURL=URL.createObjectURL(blob,{oneTimeOnly:!0})}catch(ex){blobTextureURL=URL.createObjectURL(blob)}}blobTextureURL&&(image.src=blobTextureURL)};if(Database.IsUASupportingBlobStorage){var blob,xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.addEventListener("load",function(){if(200===xhr.status&&_this.db){blob=xhr.response;var transaction=_this.db.transaction(["textures"],"readwrite");transaction.onabort=function(event){try{var error=(event.srcElement||event.target).error;error&&"QuotaExceededError"===error.name&&(_this.hasReachedQuota=!0)}catch(ex){}generateBlobUrl()},transaction.oncomplete=function(event){generateBlobUrl()};var newTexture={textureUrl:url,data:blob};try{var addRequest=transaction.objectStore("textures").put(newTexture);addRequest.onsuccess=function(event){},addRequest.onerror=function(event){generateBlobUrl()}}catch(ex){25===ex.code&&(Database.IsUASupportingBlobStorage=!1),image.src=url}}else image.src=url},!1),xhr.addEventListener("error",function(event){BABYLON.Tools.Error("Error in XHR request in BABYLON.Database."),image.src=url},!1),xhr.send()}else image.src=url}else BABYLON.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),image.src=url},Database.prototype._checkVersionFromDB=function(url,versionLoaded){var _this=this;this._loadVersionFromDBAsync(url,versionLoaded,function(){_this._saveVersionIntoDBAsync(url,versionLoaded)})},Database.prototype._loadVersionFromDBAsync=function(url,callback,updateInDBCallback){var _this=this;if(this.isSupported&&this.db){var version;try{var transaction=this.db.transaction(["versions"]);transaction.oncomplete=function(event){version?_this.manifestVersionFound!=version.data?(_this.mustUpdateRessources=!0,updateInDBCallback()):callback(version.data):(_this.mustUpdateRessources=!0,updateInDBCallback())},transaction.onabort=function(event){callback(-1)};var getRequest=transaction.objectStore("versions").get(url);getRequest.onsuccess=function(event){version=event.target.result},getRequest.onerror=function(event){BABYLON.Tools.Error("Error loading version for scene "+url+" from DB."),callback(-1)}}catch(ex){BABYLON.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+ex.message),callback(-1)}}else BABYLON.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),callback(-1)},Database.prototype._saveVersionIntoDBAsync=function(url,callback){var _this=this;if(this.isSupported&&!this.hasReachedQuota&&this.db)try{var transaction=this.db.transaction(["versions"],"readwrite");transaction.onabort=function(event){try{var error=event.srcElement.error;error&&"QuotaExceededError"===error.name&&(_this.hasReachedQuota=!0)}catch(ex){}callback(-1)},transaction.oncomplete=function(event){callback(_this.manifestVersionFound)};var newVersion={sceneUrl:url,data:this.manifestVersionFound},addRequest=transaction.objectStore("versions").put(newVersion);addRequest.onsuccess=function(event){},addRequest.onerror=function(event){BABYLON.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(ex){BABYLON.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+ex.message),callback(-1)}else callback(-1)},Database.prototype.loadFileFromDB=function(url,sceneLoaded,progressCallBack,errorCallback,useArrayBuffer){var _this=this,completeUrl=Database.ReturnFullUrlLocation(url),saveAndLoadFile=function(){_this._saveFileIntoDBAsync(completeUrl,sceneLoaded,progressCallBack)};this._checkVersionFromDB(completeUrl,function(version){-1!==version?_this.mustUpdateRessources?_this._saveFileIntoDBAsync(completeUrl,sceneLoaded,progressCallBack,useArrayBuffer):_this._loadFileFromDBAsync(completeUrl,sceneLoaded,saveAndLoadFile,useArrayBuffer):errorCallback&&errorCallback()})},Database.prototype._loadFileFromDBAsync=function(url,callback,notInDBCallback,useArrayBuffer){if(this.isSupported&&this.db){var targetStore;targetStore=-1!==url.indexOf(".babylon")?"scenes":"textures";var file,transaction=this.db.transaction([targetStore]);transaction.oncomplete=function(event){file?callback(file.data):notInDBCallback()},transaction.onabort=function(event){notInDBCallback()};var getRequest=transaction.objectStore(targetStore).get(url);getRequest.onsuccess=function(event){file=event.target.result},getRequest.onerror=function(event){BABYLON.Tools.Error("Error loading file "+url+" from DB."),notInDBCallback()}}else BABYLON.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),callback()},Database.prototype._saveFileIntoDBAsync=function(url,callback,progressCallback,useArrayBuffer){var _this=this;if(this.isSupported){var targetStore;targetStore=-1!==url.indexOf(".babylon")?"scenes":"textures";var fileData,xhr=new XMLHttpRequest;xhr.open("GET",url+"?"+Date.now(),!0),useArrayBuffer&&(xhr.responseType="arraybuffer"),progressCallback&&(xhr.onprogress=progressCallback),xhr.addEventListener("load",function(){if(200===xhr.status||BABYLON.Tools.ValidateXHRData(xhr,useArrayBuffer?6:1))if(fileData=useArrayBuffer?xhr.response:xhr.responseText,!_this.hasReachedQuota&&_this.db){var transaction=_this.db.transaction([targetStore],"readwrite");transaction.onabort=function(event){try{var error=event.srcElement.error;error&&"QuotaExceededError"===error.name&&(_this.hasReachedQuota=!0)}catch(ex){}callback(fileData)},transaction.oncomplete=function(event){callback(fileData)};var newFile;newFile="scenes"===targetStore?{sceneUrl:url,data:fileData,version:_this.manifestVersionFound}:{textureUrl:url,data:fileData};try{var addRequest=transaction.objectStore(targetStore).put(newFile);addRequest.onsuccess=function(event){},addRequest.onerror=function(event){BABYLON.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(ex){callback(fileData)}}else callback(fileData);else callback()},!1),xhr.addEventListener("error",function(event){BABYLON.Tools.Error("error on XHR request."),callback()},!1),xhr.send()}else BABYLON.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),callback()},Database.IsUASupportingBlobStorage=!0,Database.IDBStorageEnabled=!0,Database.parseURL=function(url){document.createElement("a").href=url;var urlWithoutHash=url.substring(0,url.lastIndexOf("#")),fileName=url.substring(urlWithoutHash.lastIndexOf("/")+1,url.length);return url.substring(0,url.indexOf(fileName,0))},Database.ReturnFullUrlLocation=function(url){return-1===url.indexOf("http:/")&&-1===url.indexOf("https:/")?Database.parseURL(window.location.href)+url:url},Database}();BABYLON.Database=Database}(BABYLON||(BABYLON={}));!function(BABYLON){var FresnelParameters=function(){function FresnelParameters(){this._isEnabled=!0,this.leftColor=BABYLON.Color3.White(),this.rightColor=BABYLON.Color3.Black(),this.bias=0,this.power=1}return Object.defineProperty(FresnelParameters.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(value){this._isEnabled!==value&&(this._isEnabled=value,BABYLON.Engine.MarkAllMaterialsAsDirty(BABYLON.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),FresnelParameters.prototype.clone=function(){var newFresnelParameters=new FresnelParameters;return BABYLON.Tools.DeepCopy(this,newFresnelParameters),newFresnelParameters},FresnelParameters.prototype.serialize=function(){var serializationObject={};return serializationObject.isEnabled=this.isEnabled,serializationObject.leftColor=this.leftColor,serializationObject.rightColor=this.rightColor,serializationObject.bias=this.bias,serializationObject.power=this.power,serializationObject},FresnelParameters.Parse=function(parsedFresnelParameters){var fresnelParameters=new FresnelParameters;return fresnelParameters.isEnabled=parsedFresnelParameters.isEnabled,fresnelParameters.leftColor=BABYLON.Color3.FromArray(parsedFresnelParameters.leftColor),fresnelParameters.rightColor=BABYLON.Color3.FromArray(parsedFresnelParameters.rightColor),fresnelParameters.bias=parsedFresnelParameters.bias,fresnelParameters.power=parsedFresnelParameters.power||1,fresnelParameters},FresnelParameters}();BABYLON.FresnelParameters=FresnelParameters}(BABYLON||(BABYLON={}));!function(BABYLON){var MultiMaterial=function(_super){function MultiMaterial(name,scene){var _this=_super.call(this,name,scene,!0)||this;return scene.multiMaterials.push(_this),_this.subMaterials=new Array,_this.storeEffectOnSubMeshes=!0,_this}return __extends(MultiMaterial,_super),Object.defineProperty(MultiMaterial.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(value){this._subMaterials=value,this._hookArray(value)},enumerable:!0,configurable:!0}),MultiMaterial.prototype._hookArray=function(array){var _this=this,oldPush=array.push;array.push=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var result=oldPush.apply(array,items);return _this._markAllSubMeshesAsTexturesDirty(),result};var oldSplice=array.splice;array.splice=function(index,deleteCount){var deleted=oldSplice.apply(array,[index,deleteCount]);return _this._markAllSubMeshesAsTexturesDirty(),deleted}},MultiMaterial.prototype.getSubMaterial=function(index){return index<0||index>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[index]},MultiMaterial.prototype.getActiveTextures=function(){return(_a=_super.prototype.getActiveTextures.call(this)).concat.apply(_a,this.subMaterials.map(function(subMaterial){return subMaterial?subMaterial.getActiveTextures():[]}));var _a},MultiMaterial.prototype.getClassName=function(){return"MultiMaterial"},MultiMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){for(var index=0;index<this.subMaterials.length;index++){var subMaterial=this.subMaterials[index];if(subMaterial){if(subMaterial.storeEffectOnSubMeshes){if(!subMaterial.isReadyForSubMesh(mesh,subMesh,useInstances))return!1;continue}if(!subMaterial.isReady(mesh))return!1}}return!0},MultiMaterial.prototype.clone=function(name,cloneChildren){for(var newMultiMaterial=new MultiMaterial(name,this.getScene()),index=0;index<this.subMaterials.length;index++){var subMaterial=null,current=this.subMaterials[index];subMaterial=cloneChildren&&current?current.clone(name+"-"+current.name):this.subMaterials[index],newMultiMaterial.subMaterials.push(subMaterial)}return newMultiMaterial},MultiMaterial.prototype.serialize=function(){var serializationObject={};serializationObject.name=this.name,serializationObject.id=this.id,BABYLON.Tags&&(serializationObject.tags=BABYLON.Tags.GetTags(this)),serializationObject.materials=[];for(var matIndex=0;matIndex<this.subMaterials.length;matIndex++){var subMat=this.subMaterials[matIndex];subMat?serializationObject.materials.push(subMat.id):serializationObject.materials.push(null)}return serializationObject},MultiMaterial.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){var scene=this.getScene();if(scene){var index=scene.multiMaterials.indexOf(this);index>=0&&scene.multiMaterials.splice(index,1),_super.prototype.dispose.call(this,forceDisposeEffect,forceDisposeTextures)}},MultiMaterial}(BABYLON.Material);BABYLON.MultiMaterial=MultiMaterial}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraTouchInput=function(){function FreeCameraTouchInput(){this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250}return FreeCameraTouchInput.prototype.attachControl=function(element,noPreventDefault){var _this=this,previousPosition=null;void 0===this._pointerInput&&(this._onLostFocus=function(evt){_this._offsetX=null,_this._offsetY=null},this._pointerInput=function(p,s){var evt=p.event;if("mouse"!==evt.pointerType)if(p.type===BABYLON.PointerEventTypes.POINTERDOWN){if(noPreventDefault||evt.preventDefault(),_this._pointerPressed.push(evt.pointerId),1!==_this._pointerPressed.length)return;previousPosition={x:evt.clientX,y:evt.clientY}}else if(p.type===BABYLON.PointerEventTypes.POINTERUP){if(noPreventDefault||evt.preventDefault(),-1===(index=_this._pointerPressed.indexOf(evt.pointerId)))return;if(_this._pointerPressed.splice(index,1),0!=index)return;previousPosition=null,_this._offsetX=null,_this._offsetY=null}else if(p.type===BABYLON.PointerEventTypes.POINTERMOVE){if(noPreventDefault||evt.preventDefault(),!previousPosition)return;var index=_this._pointerPressed.indexOf(evt.pointerId);if(0!=index)return;_this._offsetX=evt.clientX-previousPosition.x,_this._offsetY=-(evt.clientY-previousPosition.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,BABYLON.PointerEventTypes.POINTERDOWN|BABYLON.PointerEventTypes.POINTERUP|BABYLON.PointerEventTypes.POINTERMOVE),this._onLostFocus&&element.addEventListener("blur",this._onLostFocus)},FreeCameraTouchInput.prototype.detachControl=function(element){this._pointerInput&&element&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(element.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},FreeCameraTouchInput.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var camera=this.camera;if(camera.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)camera.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var speed=camera._computeLocalCameraSpeed(),direction=new BABYLON.Vector3(0,0,speed*this._offsetY/this.touchMoveSensibility);BABYLON.Matrix.RotationYawPitchRollToRef(camera.rotation.y,camera.rotation.x,0,camera._cameraRotationMatrix),camera.cameraDirection.addInPlace(BABYLON.Vector3.TransformCoordinates(direction,camera._cameraRotationMatrix))}}},FreeCameraTouchInput.prototype.getClassName=function(){return"FreeCameraTouchInput"},FreeCameraTouchInput.prototype.getSimpleName=function(){return"touch"},__decorate([BABYLON.serialize()],FreeCameraTouchInput.prototype,"touchAngularSensibility",void 0),__decorate([BABYLON.serialize()],FreeCameraTouchInput.prototype,"touchMoveSensibility",void 0),FreeCameraTouchInput}();BABYLON.FreeCameraTouchInput=FreeCameraTouchInput,BABYLON.CameraInputTypes.FreeCameraTouchInput=FreeCameraTouchInput}(BABYLON||(BABYLON={}));!function(BABYLON){var TouchCamera=function(_super){function TouchCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this.inputs.addTouch(),_this._setupInputs(),_this}return __extends(TouchCamera,_super),Object.defineProperty(TouchCamera.prototype,"touchAngularSensibility",{get:function(){var touch=this.inputs.attached.touch;return touch?touch.touchAngularSensibility:0},set:function(value){var touch=this.inputs.attached.touch;touch&&(touch.touchAngularSensibility=value)},enumerable:!0,configurable:!0}),Object.defineProperty(TouchCamera.prototype,"touchMoveSensibility",{get:function(){var touch=this.inputs.attached.touch;return touch?touch.touchMoveSensibility:0},set:function(value){var touch=this.inputs.attached.touch;touch&&(touch.touchMoveSensibility=value)},enumerable:!0,configurable:!0}),TouchCamera.prototype.getClassName=function(){return"TouchCamera"},TouchCamera.prototype._setupInputs=function(){var mouse=this.inputs.attached.mouse;mouse&&(mouse.touchEnabled=!1)},TouchCamera}(BABYLON.FreeCamera);BABYLON.TouchCamera=TouchCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var ProceduralTexture=function(_super){function ProceduralTexture(name,size,fragment,scene,fallbackTexture,generateMipMaps,isCube){void 0===fallbackTexture&&(fallbackTexture=null),void 0===generateMipMaps&&(generateMipMaps=!0),void 0===isCube&&(isCube=!1);var _this=_super.call(this,null,scene,!generateMipMaps)||this;_this.isCube=isCube,_this.isEnabled=!0,_this._currentRefreshId=-1,_this._refreshRate=1,_this._vertexBuffers={},_this._uniforms=new Array,_this._samplers=new Array,_this._textures={},_this._floats={},_this._floatsArrays={},_this._colors3={},_this._colors4={},_this._vectors2={},_this._vectors3={},_this._matrices={},_this._fallbackTextureUsed=!1,scene._proceduralTextures.push(_this),_this._engine=scene.getEngine(),_this.name=name,_this.isRenderTarget=!0,_this._size=size,_this._generateMipMaps=generateMipMaps,_this.setFragment(fragment),_this._fallbackTexture=fallbackTexture,isCube?(_this._texture=_this._engine.createRenderTargetCubeTexture(size,{generateMipMaps:generateMipMaps}),_this.setFloat("face",0)):_this._texture=_this._engine.createRenderTargetTexture(size,generateMipMaps);var vertices=[];return vertices.push(1,1),vertices.push(-1,1),vertices.push(-1,-1),vertices.push(1,-1),_this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=new BABYLON.VertexBuffer(_this._engine,vertices,BABYLON.VertexBuffer.PositionKind,!1,!1,2),_this._createIndexBuffer(),_this}return __extends(ProceduralTexture,_super),ProceduralTexture.prototype._createIndexBuffer=function(){var engine=this._engine,indices=[];indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),this._indexBuffer=engine.createIndexBuffer(indices)},ProceduralTexture.prototype._rebuild=function(){var vb=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vb&&vb._rebuild(),this._createIndexBuffer(),this.refreshRate===BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)},ProceduralTexture.prototype.reset=function(){void 0!==this._effect&&this._engine._releaseEffect(this._effect)},ProceduralTexture.prototype.isReady=function(){var shaders,_this=this,engine=this._engine;return!!this._fragment&&(!!this._fallbackTextureUsed||(shaders=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=engine.createEffect(shaders,[BABYLON.VertexBuffer.PositionKind],this._uniforms,this._samplers,"",void 0,void 0,function(){_this.releaseInternalTexture(),_this._fallbackTexture&&(_this._texture=_this._fallbackTexture._texture,_this._texture&&_this._texture.incrementReferences()),_this._fallbackTextureUsed=!0}),this._effect.isReady()))},ProceduralTexture.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},ProceduralTexture.prototype.setFragment=function(fragment){this._fragment=fragment},Object.defineProperty(ProceduralTexture.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(value){this._refreshRate=value,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),ProceduralTexture.prototype._shouldRender=function(){return!!(this.isEnabled&&this.isReady()&&this._texture)&&(!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)))},ProceduralTexture.prototype.getRenderSize=function(){return this._size},ProceduralTexture.prototype.resize=function(size,generateMipMaps){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(size,generateMipMaps))},ProceduralTexture.prototype._checkUniform=function(uniformName){-1===this._uniforms.indexOf(uniformName)&&this._uniforms.push(uniformName)},ProceduralTexture.prototype.setTexture=function(name,texture){return-1===this._samplers.indexOf(name)&&this._samplers.push(name),this._textures[name]=texture,this},ProceduralTexture.prototype.setFloat=function(name,value){return this._checkUniform(name),this._floats[name]=value,this},ProceduralTexture.prototype.setFloats=function(name,value){return this._checkUniform(name),this._floatsArrays[name]=value,this},ProceduralTexture.prototype.setColor3=function(name,value){return this._checkUniform(name),this._colors3[name]=value,this},ProceduralTexture.prototype.setColor4=function(name,value){return this._checkUniform(name),this._colors4[name]=value,this},ProceduralTexture.prototype.setVector2=function(name,value){return this._checkUniform(name),this._vectors2[name]=value,this},ProceduralTexture.prototype.setVector3=function(name,value){return this._checkUniform(name),this._vectors3[name]=value,this},ProceduralTexture.prototype.setMatrix=function(name,value){return this._checkUniform(name),this._matrices[name]=value,this},ProceduralTexture.prototype.render=function(useCameraPostProcess){var scene=this.getScene();if(scene){var engine=this._engine;engine.enableEffect(this._effect),engine.setState(!1);for(var name in this._textures)this._effect.setTexture(name,this._textures[name]);for(name in this._floats)this._effect.setFloat(name,this._floats[name]);for(name in this._floatsArrays)this._effect.setArray(name,this._floatsArrays[name]);for(name in this._colors3)this._effect.setColor3(name,this._colors3[name]);for(name in this._colors4){var color=this._colors4[name];this._effect.setFloat4(name,color.r,color.g,color.b,color.a)}for(name in this._vectors2)this._effect.setVector2(name,this._vectors2[name]);for(name in this._vectors3)this._effect.setVector3(name,this._vectors3[name]);for(name in this._matrices)this._effect.setMatrix(name,this._matrices[name]);if(this._texture){if(this.isCube)for(var face=0;face<6;face++)engine.bindFramebuffer(this._texture,face,void 0,void 0,!0),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",face),engine.clear(scene.clearColor,!0,!0,!0),engine.draw(!0,0,6),5===face&&engine.generateMipMapsForCubemap(this._texture);else engine.bindFramebuffer(this._texture,0,void 0,void 0,!0),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),engine.clear(scene.clearColor,!0,!0,!0),engine.draw(!0,0,6);engine.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated()}}},ProceduralTexture.prototype.clone=function(){var textureSize=this.getSize(),newTexture=new ProceduralTexture(this.name,textureSize.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return newTexture.hasAlpha=this.hasAlpha,newTexture.level=this.level,newTexture.coordinatesMode=this.coordinatesMode,newTexture},ProceduralTexture.prototype.dispose=function(){var scene=this.getScene();if(scene){var index=scene._proceduralTextures.indexOf(this);index>=0&&scene._proceduralTextures.splice(index,1);var vertexBuffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vertexBuffer&&(vertexBuffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),_super.prototype.dispose.call(this)}},ProceduralTexture}(BABYLON.Texture);BABYLON.ProceduralTexture=ProceduralTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var CustomProceduralTexture=function(_super){function CustomProceduralTexture(name,texturePath,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,null,scene,fallbackTexture,generateMipMaps)||this;return _this._animate=!0,_this._time=0,_this._texturePath=texturePath,_this.loadJson(texturePath),_this.refreshRate=1,_this}return __extends(CustomProceduralTexture,_super),CustomProceduralTexture.prototype.loadJson=function(jsonUrl){var _this=this,noConfigFile=function(){BABYLON.Tools.Log("No config file found in "+jsonUrl+" trying to use ShadersStore or DOM element");try{_this.setFragment(_this._texturePath)}catch(ex){BABYLON.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},configFileUrl=jsonUrl+"/config.json",xhr=new XMLHttpRequest;xhr.open("GET",configFileUrl,!0),xhr.addEventListener("load",function(){if(200===xhr.status||BABYLON.Tools.ValidateXHRData(xhr,1))try{_this._config=JSON.parse(xhr.response),_this.updateShaderUniforms(),_this.updateTextures(),_this.setFragment(_this._texturePath+"/custom"),_this._animate=_this._config.animate,_this.refreshRate=_this._config.refreshrate}catch(ex){noConfigFile()}else noConfigFile()},!1),xhr.addEventListener("error",function(){noConfigFile()},!1);try{xhr.send()}catch(ex){BABYLON.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},CustomProceduralTexture.prototype.isReady=function(){if(!_super.prototype.isReady.call(this))return!1;for(var name in this._textures)if(!this._textures[name].isReady())return!1;return!0},CustomProceduralTexture.prototype.render=function(useCameraPostProcess){var scene=this.getScene();this._animate&&scene&&(this._time+=.03*scene.getAnimationRatio(),this.updateShaderUniforms()),_super.prototype.render.call(this,useCameraPostProcess)},CustomProceduralTexture.prototype.updateTextures=function(){for(var i=0;i<this._config.sampler2Ds.length;i++)this.setTexture(this._config.sampler2Ds[i].sample2Dname,new BABYLON.Texture(this._texturePath+"/"+this._config.sampler2Ds[i].textureRelativeUrl,this.getScene()))},CustomProceduralTexture.prototype.updateShaderUniforms=function(){if(this._config)for(var j=0;j<this._config.uniforms.length;j++){var uniform=this._config.uniforms[j];switch(uniform.type){case"float":this.setFloat(uniform.name,uniform.value);break;case"color3":this.setColor3(uniform.name,new BABYLON.Color3(uniform.r,uniform.g,uniform.b));break;case"color4":this.setColor4(uniform.name,new BABYLON.Color4(uniform.r,uniform.g,uniform.b,uniform.a));break;case"vector2":this.setVector2(uniform.name,new BABYLON.Vector2(uniform.x,uniform.y));break;case"vector3":this.setVector3(uniform.name,new BABYLON.Vector3(uniform.x,uniform.y,uniform.z))}}this.setFloat("time",this._time)},Object.defineProperty(CustomProceduralTexture.prototype,"animate",{get:function(){return this._animate},set:function(value){this._animate=value},enumerable:!0,configurable:!0}),CustomProceduralTexture}(BABYLON.ProceduralTexture);BABYLON.CustomProceduralTexture=CustomProceduralTexture}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraGamepadInput=function(){function FreeCameraGamepadInput(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=BABYLON.Matrix.Identity(),this._deltaTransform=BABYLON.Vector3.Zero(),this._vector3=BABYLON.Vector3.Zero(),this._vector2=BABYLON.Vector2.Zero()}return FreeCameraGamepadInput.prototype.attachControl=function(element,noPreventDefault){var _this=this,manager=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=manager.onGamepadConnectedObservable.add(function(gamepad){gamepad.type!==BABYLON.Gamepad.POSE_ENABLED&&(_this.gamepad&&gamepad.type!==BABYLON.Gamepad.XBOX||(_this.gamepad=gamepad))}),this._onGamepadDisconnectedObserver=manager.onGamepadDisconnectedObservable.add(function(gamepad){_this.gamepad===gamepad&&(_this.gamepad=null)}),this.gamepad=manager.getGamepadByType(BABYLON.Gamepad.XBOX)},FreeCameraGamepadInput.prototype.detachControl=function(element){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},FreeCameraGamepadInput.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var camera=this.camera,LSValues=this.gamepad.leftStick,normalizedLX=LSValues.x/this.gamepadMoveSensibility,normalizedLY=LSValues.y/this.gamepadMoveSensibility;LSValues.x=Math.abs(normalizedLX)>.005?0+normalizedLX:0,LSValues.y=Math.abs(normalizedLY)>.005?0+normalizedLY:0;var RSValues=this.gamepad.rightStick;if(RSValues){var normalizedRX=RSValues.x/this.gamepadAngularSensibility,normalizedRY=RSValues.y/this.gamepadAngularSensibility;RSValues.x=Math.abs(normalizedRX)>.001?0+normalizedRX:0,RSValues.y=Math.abs(normalizedRY)>.001?0+normalizedRY:0}else RSValues={x:0,y:0};camera.rotationQuaternion?camera.rotationQuaternion.toRotationMatrix(this._cameraTransform):BABYLON.Matrix.RotationYawPitchRollToRef(camera.rotation.y,camera.rotation.x,0,this._cameraTransform);var speed=50*camera._computeLocalCameraSpeed();this._vector3.copyFromFloats(LSValues.x*speed,0,-LSValues.y*speed),BABYLON.Vector3.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),camera.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(RSValues.y,RSValues.x),camera.cameraRotation.addInPlace(this._vector2)}},FreeCameraGamepadInput.prototype.getClassName=function(){return"FreeCameraGamepadInput"},FreeCameraGamepadInput.prototype.getSimpleName=function(){return"gamepad"},__decorate([BABYLON.serialize()],FreeCameraGamepadInput.prototype,"gamepadAngularSensibility",void 0),__decorate([BABYLON.serialize()],FreeCameraGamepadInput.prototype,"gamepadMoveSensibility",void 0),FreeCameraGamepadInput}();BABYLON.FreeCameraGamepadInput=FreeCameraGamepadInput,BABYLON.CameraInputTypes.FreeCameraGamepadInput=FreeCameraGamepadInput}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraGamepadInput=function(){function ArcRotateCameraGamepadInput(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return ArcRotateCameraGamepadInput.prototype.attachControl=function(element,noPreventDefault){var _this=this,manager=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=manager.onGamepadConnectedObservable.add(function(gamepad){gamepad.type!==BABYLON.Gamepad.POSE_ENABLED&&(_this.gamepad&&gamepad.type!==BABYLON.Gamepad.XBOX||(_this.gamepad=gamepad))}),this._onGamepadDisconnectedObserver=manager.onGamepadDisconnectedObservable.add(function(gamepad){_this.gamepad===gamepad&&(_this.gamepad=null)}),this.gamepad=manager.getGamepadByType(BABYLON.Gamepad.XBOX)},ArcRotateCameraGamepadInput.prototype.detachControl=function(element){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},ArcRotateCameraGamepadInput.prototype.checkInputs=function(){if(this.gamepad){var camera=this.camera,RSValues=this.gamepad.rightStick;if(RSValues){if(0!=RSValues.x){var normalizedRX=RSValues.x/this.gamepadRotationSensibility;0!=normalizedRX&&Math.abs(normalizedRX)>.005&&(camera.inertialAlphaOffset+=normalizedRX)}if(0!=RSValues.y){var normalizedRY=RSValues.y/this.gamepadRotationSensibility;0!=normalizedRY&&Math.abs(normalizedRY)>.005&&(camera.inertialBetaOffset+=normalizedRY)}}var LSValues=this.gamepad.leftStick;if(LSValues&&0!=LSValues.y){var normalizedLY=LSValues.y/this.gamepadMoveSensibility;0!=normalizedLY&&Math.abs(normalizedLY)>.005&&(this.camera.inertialRadiusOffset-=normalizedLY)}}},ArcRotateCameraGamepadInput.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},ArcRotateCameraGamepadInput.prototype.getSimpleName=function(){return"gamepad"},__decorate([BABYLON.serialize()],ArcRotateCameraGamepadInput.prototype,"gamepadRotationSensibility",void 0),__decorate([BABYLON.serialize()],ArcRotateCameraGamepadInput.prototype,"gamepadMoveSensibility",void 0),ArcRotateCameraGamepadInput}();BABYLON.ArcRotateCameraGamepadInput=ArcRotateCameraGamepadInput,BABYLON.CameraInputTypes.ArcRotateCameraGamepadInput=ArcRotateCameraGamepadInput}(BABYLON||(BABYLON={}));!function(BABYLON){var GamepadManager=function(){function GamepadManager(_scene){var _this=this;this._scene=_scene,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new BABYLON.Observable,BABYLON.Tools.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new BABYLON.Observable(function(observer){for(var i in _this._babylonGamepads){var gamepad=_this._babylonGamepads[i];gamepad&&gamepad._isConnected&&_this.onGamepadConnectedObservable.notifyObserver(observer,gamepad)}}),this._onGamepadConnectedEvent=function(evt){var gamepad=evt.gamepad;if(!(gamepad.index in _this._babylonGamepads&&_this._babylonGamepads[gamepad.index].isConnected)){var newGamepad;_this._babylonGamepads[gamepad.index]?((newGamepad=_this._babylonGamepads[gamepad.index]).browserGamepad=gamepad,newGamepad._isConnected=!0):newGamepad=_this._addNewGamepad(gamepad),_this.onGamepadConnectedObservable.notifyObservers(newGamepad),_this._startMonitoringGamepads()}},this._onGamepadDisconnectedEvent=function(evt){var gamepad=evt.gamepad;for(var i in _this._babylonGamepads)if(_this._babylonGamepads[i].index===gamepad.index){var disconnectedGamepad=_this._babylonGamepads[i];disconnectedGamepad._isConnected=!1,_this.onGamepadDisconnectedObservable.notifyObservers(disconnectedGamepad);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(GamepadManager.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),GamepadManager.prototype.getGamepadByType=function(type){void 0===type&&(type=BABYLON.Gamepad.XBOX);for(var _i=0,_a=this._babylonGamepads;_i<_a.length;_i++){var gamepad=_a[_i];if(gamepad&&gamepad.type===type)return gamepad}return null},GamepadManager.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(gamepad){gamepad.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},GamepadManager.prototype._addNewGamepad=function(gamepad){this._oneGamepadConnected||(this._oneGamepadConnected=!0);var newGamepad,xboxOne=-1!==gamepad.id.search("Xbox One");return newGamepad=xboxOne||-1!==gamepad.id.search("Xbox 360")||-1!==gamepad.id.search("xinput")?new BABYLON.Xbox360Pad(gamepad.id,gamepad.index,gamepad,xboxOne):gamepad.pose?BABYLON.PoseEnabledControllerHelper.InitiateController(gamepad):new BABYLON.GenericPad(gamepad.id,gamepad.index,gamepad),this._babylonGamepads[newGamepad.index]=newGamepad,newGamepad},GamepadManager.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},GamepadManager.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},GamepadManager.prototype._checkGamepadsStatus=function(){var _this=this;this._updateGamepadObjects();for(var i in this._babylonGamepads){var gamepad=this._babylonGamepads[i];gamepad&&gamepad.isConnected&&gamepad.update()}this._isMonitoring&&!this._scene&&BABYLON.Tools.QueueNewFrame(function(){_this._checkGamepadsStatus()})},GamepadManager.prototype._updateGamepadObjects=function(){for(var gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],i=0;i<gamepads.length;i++)if(gamepads[i])if(this._babylonGamepads[gamepads[i].index])this._babylonGamepads[i].browserGamepad=gamepads[i],this._babylonGamepads[i].isConnected||(this._babylonGamepads[i]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[i]));else{var newGamepad=this._addNewGamepad(gamepads[i]);this.onGamepadConnectedObservable.notifyObservers(newGamepad)}},GamepadManager}();BABYLON.GamepadManager=GamepadManager}(BABYLON||(BABYLON={}));!function(BABYLON){var StickValues=function(){return function(x,y){this.x=x,this.y=y}}();BABYLON.StickValues=StickValues;var Gamepad=function(){function Gamepad(id,index,browserGamepad,leftStickX,leftStickY,rightStickX,rightStickY){void 0===leftStickX&&(leftStickX=0),void 0===leftStickY&&(leftStickY=1),void 0===rightStickX&&(rightStickX=2),void 0===rightStickY&&(rightStickY=3),this.id=id,this.index=index,this.browserGamepad=browserGamepad,this._isConnected=!0,this._invertLeftStickY=!1,this.type=Gamepad.GAMEPAD,this._leftStickAxisX=leftStickX,this._leftStickAxisY=leftStickY,this._rightStickAxisX=rightStickX,this._rightStickAxisY=rightStickY,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(Gamepad.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Gamepad.prototype.onleftstickchanged=function(callback){this._onleftstickchanged=callback},Gamepad.prototype.onrightstickchanged=function(callback){this._onrightstickchanged=callback},Object.defineProperty(Gamepad.prototype,"leftStick",{get:function(){return this._leftStick},set:function(newValues){!this._onleftstickchanged||this._leftStick.x===newValues.x&&this._leftStick.y===newValues.y||this._onleftstickchanged(newValues),this._leftStick=newValues},enumerable:!0,configurable:!0}),Object.defineProperty(Gamepad.prototype,"rightStick",{get:function(){return this._rightStick},set:function(newValues){!this._onrightstickchanged||this._rightStick.x===newValues.x&&this._rightStick.y===newValues.y||this._onrightstickchanged(newValues),this._rightStick=newValues},enumerable:!0,configurable:!0}),Gamepad.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},Gamepad.prototype.dispose=function(){},Gamepad.GAMEPAD=0,Gamepad.GENERIC=1,Gamepad.XBOX=2,Gamepad.POSE_ENABLED=3,Gamepad}();BABYLON.Gamepad=Gamepad;var GenericPad=function(_super){function GenericPad(id,index,browserGamepad){var _this=_super.call(this,id,index,browserGamepad)||this;return _this.onButtonDownObservable=new BABYLON.Observable,_this.onButtonUpObservable=new BABYLON.Observable,_this.type=Gamepad.GENERIC,_this._buttons=new Array(browserGamepad.buttons.length),_this}return __extends(GenericPad,_super),GenericPad.prototype.onbuttondown=function(callback){this._onbuttondown=callback},GenericPad.prototype.onbuttonup=function(callback){this._onbuttonup=callback},GenericPad.prototype._setButtonValue=function(newValue,currentValue,buttonIndex){return newValue!==currentValue&&(1===newValue&&(this._onbuttondown&&this._onbuttondown(buttonIndex),this.onButtonDownObservable.notifyObservers(buttonIndex)),0===newValue&&(this._onbuttonup&&this._onbuttonup(buttonIndex),this.onButtonUpObservable.notifyObservers(buttonIndex))),newValue},GenericPad.prototype.update=function(){_super.prototype.update.call(this);for(var index=0;index<this._buttons.length;index++)this._buttons[index]=this._setButtonValue(this.browserGamepad.buttons[index].value,this._buttons[index],index)},GenericPad.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},GenericPad}(Gamepad);BABYLON.GenericPad=GenericPad}(BABYLON||(BABYLON={}));!function(BABYLON){var Xbox360Button;!function(Xbox360Button){Xbox360Button[Xbox360Button.A=0]="A",Xbox360Button[Xbox360Button.B=1]="B",Xbox360Button[Xbox360Button.X=2]="X",Xbox360Button[Xbox360Button.Y=3]="Y",Xbox360Button[Xbox360Button.Start=4]="Start",Xbox360Button[Xbox360Button.Back=5]="Back",Xbox360Button[Xbox360Button.LB=6]="LB",Xbox360Button[Xbox360Button.RB=7]="RB",Xbox360Button[Xbox360Button.LeftStick=8]="LeftStick",Xbox360Button[Xbox360Button.RightStick=9]="RightStick"}(Xbox360Button=BABYLON.Xbox360Button||(BABYLON.Xbox360Button={}));var Xbox360Dpad;!function(Xbox360Dpad){Xbox360Dpad[Xbox360Dpad.Up=0]="Up",Xbox360Dpad[Xbox360Dpad.Down=1]="Down",Xbox360Dpad[Xbox360Dpad.Left=2]="Left",Xbox360Dpad[Xbox360Dpad.Right=3]="Right"}(Xbox360Dpad=BABYLON.Xbox360Dpad||(BABYLON.Xbox360Dpad={}));var Xbox360Pad=function(_super){function Xbox360Pad(id,index,gamepad,xboxOne){void 0===xboxOne&&(xboxOne=!1);var _this=_super.call(this,id,index,gamepad,0,1,2,3)||this;return _this._leftTrigger=0,_this._rightTrigger=0,_this.onButtonDownObservable=new BABYLON.Observable,_this.onButtonUpObservable=new BABYLON.Observable,_this.onPadDownObservable=new BABYLON.Observable,_this.onPadUpObservable=new BABYLON.Observable,_this._buttonA=0,_this._buttonB=0,_this._buttonX=0,_this._buttonY=0,_this._buttonBack=0,_this._buttonStart=0,_this._buttonLB=0,_this._buttonRB=0,_this._buttonLeftStick=0,_this._buttonRightStick=0,_this._dPadUp=0,_this._dPadDown=0,_this._dPadLeft=0,_this._dPadRight=0,_this._isXboxOnePad=!1,_this.type=BABYLON.Gamepad.XBOX,_this._isXboxOnePad=xboxOne,_this}return __extends(Xbox360Pad,_super),Xbox360Pad.prototype.onlefttriggerchanged=function(callback){this._onlefttriggerchanged=callback},Xbox360Pad.prototype.onrighttriggerchanged=function(callback){this._onrighttriggerchanged=callback},Object.defineProperty(Xbox360Pad.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(newValue){this._onlefttriggerchanged&&this._leftTrigger!==newValue&&this._onlefttriggerchanged(newValue),this._leftTrigger=newValue},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(newValue){this._onrighttriggerchanged&&this._rightTrigger!==newValue&&this._onrighttriggerchanged(newValue),this._rightTrigger=newValue},enumerable:!0,configurable:!0}),Xbox360Pad.prototype.onbuttondown=function(callback){this._onbuttondown=callback},Xbox360Pad.prototype.onbuttonup=function(callback){this._onbuttonup=callback},Xbox360Pad.prototype.ondpaddown=function(callback){this._ondpaddown=callback},Xbox360Pad.prototype.ondpadup=function(callback){this._ondpadup=callback},Xbox360Pad.prototype._setButtonValue=function(newValue,currentValue,buttonType){return newValue!==currentValue&&(1===newValue&&(this._onbuttondown&&this._onbuttondown(buttonType),this.onButtonDownObservable.notifyObservers(buttonType)),0===newValue&&(this._onbuttonup&&this._onbuttonup(buttonType),this.onButtonUpObservable.notifyObservers(buttonType))),newValue},Xbox360Pad.prototype._setDPadValue=function(newValue,currentValue,buttonType){return newValue!==currentValue&&(1===newValue&&(this._ondpaddown&&this._ondpaddown(buttonType),this.onPadDownObservable.notifyObservers(buttonType)),0===newValue&&(this._ondpadup&&this._ondpadup(buttonType),this.onPadUpObservable.notifyObservers(buttonType))),newValue},Object.defineProperty(Xbox360Pad.prototype,"buttonA",{get:function(){return this._buttonA},set:function(value){this._buttonA=this._setButtonValue(value,this._buttonA,Xbox360Button.A)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonB",{get:function(){return this._buttonB},set:function(value){this._buttonB=this._setButtonValue(value,this._buttonB,Xbox360Button.B)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonX",{get:function(){return this._buttonX},set:function(value){this._buttonX=this._setButtonValue(value,this._buttonX,Xbox360Button.X)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonY",{get:function(){return this._buttonY},set:function(value){this._buttonY=this._setButtonValue(value,this._buttonY,Xbox360Button.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(value){this._buttonStart=this._setButtonValue(value,this._buttonStart,Xbox360Button.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(value){this._buttonBack=this._setButtonValue(value,this._buttonBack,Xbox360Button.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(value){this._buttonLB=this._setButtonValue(value,this._buttonLB,Xbox360Button.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(value){this._buttonRB=this._setButtonValue(value,this._buttonRB,Xbox360Button.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(value){this._buttonLeftStick=this._setButtonValue(value,this._buttonLeftStick,Xbox360Button.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(value){this._buttonRightStick=this._setButtonValue(value,this._buttonRightStick,Xbox360Button.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(value){this._dPadUp=this._setDPadValue(value,this._dPadUp,Xbox360Dpad.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(value){this._dPadDown=this._setDPadValue(value,this._dPadDown,Xbox360Dpad.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(value){this._dPadLeft=this._setDPadValue(value,this._dPadLeft,Xbox360Dpad.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(Xbox360Pad.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(value){this._dPadRight=this._setDPadValue(value,this._dPadRight,Xbox360Dpad.Right)},enumerable:!0,configurable:!0}),Xbox360Pad.prototype.update=function(){_super.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},Xbox360Pad.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},Xbox360Pad}(BABYLON.Gamepad);BABYLON.Xbox360Pad=Xbox360Pad}(BABYLON||(BABYLON={}));!function(BABYLON){var PoseEnabledControllerType;!function(PoseEnabledControllerType){PoseEnabledControllerType[PoseEnabledControllerType.VIVE=0]="VIVE",PoseEnabledControllerType[PoseEnabledControllerType.OCULUS=1]="OCULUS",PoseEnabledControllerType[PoseEnabledControllerType.WINDOWS=2]="WINDOWS",PoseEnabledControllerType[PoseEnabledControllerType.GENERIC=3]="GENERIC"}(PoseEnabledControllerType=BABYLON.PoseEnabledControllerType||(BABYLON.PoseEnabledControllerType={}));var PoseEnabledControllerHelper=function(){function PoseEnabledControllerHelper(){}return PoseEnabledControllerHelper.InitiateController=function(vrGamepad){return-1!==vrGamepad.id.indexOf("Oculus Touch")?new BABYLON.OculusTouchController(vrGamepad):0===vrGamepad.id.indexOf(BABYLON.WindowsMotionController.GAMEPAD_ID_PREFIX)?new BABYLON.WindowsMotionController(vrGamepad):-1!==vrGamepad.id.toLowerCase().indexOf("openvr")?new BABYLON.ViveController(vrGamepad):new BABYLON.GenericController(vrGamepad)},PoseEnabledControllerHelper}();BABYLON.PoseEnabledControllerHelper=PoseEnabledControllerHelper;var PoseEnabledController=function(_super){function PoseEnabledController(browserGamepad){var _this=_super.call(this,browserGamepad.id,browserGamepad.index,browserGamepad)||this;return _this._deviceRoomPosition=BABYLON.Vector3.Zero(),_this._deviceRoomRotationQuaternion=new BABYLON.Quaternion,_this.devicePosition=BABYLON.Vector3.Zero(),_this.deviceRotationQuaternion=new BABYLON.Quaternion,_this.deviceScaleFactor=1,_this._leftHandSystemQuaternion=new BABYLON.Quaternion,_this._deviceToWorld=BABYLON.Matrix.Identity(),_this._workingMatrix=BABYLON.Matrix.Identity(),_this.type=BABYLON.Gamepad.POSE_ENABLED,_this.controllerType=PoseEnabledControllerType.GENERIC,_this.position=BABYLON.Vector3.Zero(),_this.rotationQuaternion=new BABYLON.Quaternion,_this._calculatedPosition=BABYLON.Vector3.Zero(),_this._calculatedRotation=new BABYLON.Quaternion,BABYLON.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,_this._leftHandSystemQuaternion),_this}return __extends(PoseEnabledController,_super),PoseEnabledController.prototype.update=function(){_super.prototype.update.call(this);var pose=this.browserGamepad.pose;this.updateFromDevice(pose),BABYLON.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),BABYLON.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},PoseEnabledController.prototype.updateFromDevice=function(poseData){if(poseData){this.rawPose=poseData,poseData.position&&(this._deviceRoomPosition.copyFromFloats(poseData.position[0],poseData.position[1],-poseData.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var pose=this.rawPose;poseData.orientation&&pose.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(pose.orientation[0],pose.orientation[1],-pose.orientation[2],-pose.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},PoseEnabledController.prototype.attachToMesh=function(mesh){this._mesh&&(this._mesh.parent=null),this._mesh=mesh,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new BABYLON.Quaternion)},PoseEnabledController.prototype.attachToPoseControlledCamera=function(camera){this._poseControlledCamera=camera,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},PoseEnabledController.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,_super.prototype.dispose.call(this)},Object.defineProperty(PoseEnabledController.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),PoseEnabledController.prototype.getForwardRay=function(length){if(void 0===length&&(length=100),!this.mesh)return new BABYLON.Ray(BABYLON.Vector3.Zero(),new BABYLON.Vector3(0,0,1),length);var m=this.mesh.getWorldMatrix(),origin=m.getTranslation(),forward=new BABYLON.Vector3(0,0,-1),forwardWorld=BABYLON.Vector3.TransformNormal(forward,m),direction=BABYLON.Vector3.Normalize(forwardWorld);return new BABYLON.Ray(origin,direction,length)},PoseEnabledController}(BABYLON.Gamepad);BABYLON.PoseEnabledController=PoseEnabledController}(BABYLON||(BABYLON={}));!function(BABYLON){var WebVRController=function(_super){function WebVRController(vrGamepad){var _this=_super.call(this,vrGamepad)||this;return _this.onTriggerStateChangedObservable=new BABYLON.Observable,_this.onMainButtonStateChangedObservable=new BABYLON.Observable,_this.onSecondaryButtonStateChangedObservable=new BABYLON.Observable,_this.onPadStateChangedObservable=new BABYLON.Observable,_this.onPadValuesChangedObservable=new BABYLON.Observable,_this.pad={x:0,y:0},_this._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},_this._buttons=new Array(vrGamepad.buttons.length),_this.hand=vrGamepad.hand,_this}return __extends(WebVRController,_super),WebVRController.prototype.onButtonStateChange=function(callback){this._onButtonStateChange=callback},Object.defineProperty(WebVRController.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),WebVRController.prototype.update=function(){_super.prototype.update.call(this);for(var index=0;index<this._buttons.length;index++)this._setButtonValue(this.browserGamepad.buttons[index],this._buttons[index],index);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},WebVRController.prototype._setButtonValue=function(newState,currentState,buttonIndex){newState||(newState={pressed:!1,touched:!1,value:0}),currentState?(this._checkChanges(newState,currentState),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,buttonIndex,newState),this.handleButtonChange(buttonIndex,newState,this._changes)),this._buttons[buttonIndex].pressed=newState.pressed,this._buttons[buttonIndex].touched=newState.touched,this._buttons[buttonIndex].value=newState.value<1e-8?0:newState.value):this._buttons[buttonIndex]={pressed:newState.pressed,touched:newState.touched,value:newState.value}},WebVRController.prototype._checkChanges=function(newState,currentState){return this._changes.pressChanged=newState.pressed!==currentState.pressed,this._changes.touchChanged=newState.touched!==currentState.touched,this._changes.valueChanged=newState.value!==currentState.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},WebVRController.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},WebVRController}(BABYLON.PoseEnabledController);BABYLON.WebVRController=WebVRController}(BABYLON||(BABYLON={}));!function(BABYLON){var OculusTouchController=function(_super){function OculusTouchController(vrGamepad){var _this=_super.call(this,vrGamepad)||this;return _this.onSecondaryTriggerStateChangedObservable=new BABYLON.Observable,_this.onThumbRestChangedObservable=new BABYLON.Observable,_this.controllerType=BABYLON.PoseEnabledControllerType.OCULUS,_this}return __extends(OculusTouchController,_super),OculusTouchController.prototype.initControllerMesh=function(scene,meshLoaded){var meshName,_this=this;meshName="left"===this.hand?OculusTouchController.MODEL_LEFT_FILENAME:OculusTouchController.MODEL_RIGHT_FILENAME,BABYLON.SceneLoader.ImportMesh("",OculusTouchController.MODEL_BASE_URL,meshName,scene,function(newMeshes){_this._defaultModel=newMeshes[1],_this.attachToMesh(_this._defaultModel),meshLoaded&&meshLoaded(_this._defaultModel)})},Object.defineProperty(OculusTouchController.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(OculusTouchController.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(OculusTouchController.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(OculusTouchController.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),OculusTouchController.prototype.handleButtonChange=function(buttonIdx,state,changes){var notifyObject=state,triggerDirection="right"===this.hand?-1:1;switch(buttonIdx){case 0:return void this.onPadStateChangedObservable.notifyObservers(notifyObject);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-notifyObject.value,this._defaultModel.getChildren()[3].position.y=.005*-notifyObject.value,this._defaultModel.getChildren()[3].position.z=.005*-notifyObject.value),void this.onTriggerStateChangedObservable.notifyObservers(notifyObject);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=triggerDirection*notifyObject.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(notifyObject);case 3:return this._defaultModel&&(notifyObject.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(notifyObject);case 4:return this._defaultModel&&(notifyObject.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(notifyObject);case 5:return void this.onThumbRestChangedObservable.notifyObservers(notifyObject)}},OculusTouchController.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",OculusTouchController.MODEL_LEFT_FILENAME="left.babylon",OculusTouchController.MODEL_RIGHT_FILENAME="right.babylon",OculusTouchController}(BABYLON.WebVRController);BABYLON.OculusTouchController=OculusTouchController}(BABYLON||(BABYLON={}));!function(BABYLON){var ViveController=function(_super){function ViveController(vrGamepad){var _this=_super.call(this,vrGamepad)||this;return _this.controllerType=BABYLON.PoseEnabledControllerType.VIVE,_this._invertLeftStickY=!0,_this}return __extends(ViveController,_super),ViveController.prototype.initControllerMesh=function(scene,meshLoaded){var _this=this;BABYLON.SceneLoader.ImportMesh("",ViveController.MODEL_BASE_URL,ViveController.MODEL_FILENAME,scene,function(newMeshes){_this._defaultModel=newMeshes[1],_this.attachToMesh(_this._defaultModel),meshLoaded&&meshLoaded(_this._defaultModel)})},Object.defineProperty(ViveController.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(ViveController.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(ViveController.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),ViveController.prototype.handleButtonChange=function(buttonIdx,state,changes){var notifyObject=state;switch(buttonIdx){case 0:return void this.onPadStateChangedObservable.notifyObservers(notifyObject);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-notifyObject.value),void this.onTriggerStateChangedObservable.notifyObservers(notifyObject);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(notifyObject);case 3:return this._defaultModel&&(notifyObject.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(notifyObject)}},ViveController.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",ViveController.MODEL_FILENAME="wand.babylon",ViveController}(BABYLON.WebVRController);BABYLON.ViveController=ViveController}(BABYLON||(BABYLON={}));!function(BABYLON){var GenericController=function(_super){function GenericController(vrGamepad){return _super.call(this,vrGamepad)||this}return __extends(GenericController,_super),GenericController.prototype.initControllerMesh=function(scene,meshLoaded){var _this=this;BABYLON.SceneLoader.ImportMesh("",GenericController.MODEL_BASE_URL,GenericController.MODEL_FILENAME,scene,function(newMeshes){_this._defaultModel=newMeshes[1],_this.attachToMesh(_this._defaultModel),meshLoaded&&meshLoaded(_this._defaultModel)})},GenericController.prototype.handleButtonChange=function(buttonIdx,state,changes){console.log("Button id: "+buttonIdx+"state: "),console.dir(state)},GenericController.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",GenericController.MODEL_FILENAME="generic.babylon",GenericController}(BABYLON.WebVRController);BABYLON.GenericController=GenericController}(BABYLON||(BABYLON={}));!function(BABYLON){var LoadedMeshInfo=function(){return function(){this.buttonMeshes={},this.axisMeshes={}}}(),WindowsMotionController=function(_super){function WindowsMotionController(vrGamepad){var _this=_super.call(this,vrGamepad)||this;return _this._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:"POINTING_POSE"},_this.onTrackpadChangedObservable=new BABYLON.Observable,_this.onTrackpadValuesChangedObservable=new BABYLON.Observable,_this.trackpad={x:0,y:0},_this.controllerType=BABYLON.PoseEnabledControllerType.WINDOWS,_this._loadedMeshInfo=null,_this}return __extends(WindowsMotionController,_super),Object.defineProperty(WindowsMotionController.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(WindowsMotionController.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(WindowsMotionController.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(WindowsMotionController.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(WindowsMotionController.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(WindowsMotionController.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),WindowsMotionController.prototype.update=function(){if(_super.prototype.update.call(this),this._loadedMeshInfo&&this.browserGamepad.axes){this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad));for(var axis=0;axis<this._mapping.axisMeshNames.length;axis++)this.lerpAxisTransform(axis,this.browserGamepad.axes[axis])}},WindowsMotionController.prototype.handleButtonChange=function(buttonIdx,state,changes){var buttonName=this._mapping.buttons[buttonIdx];if(buttonName){var observable=this[this._mapping.buttonObservableNames[buttonName]];observable&&observable.notifyObservers(state),this.lerpButtonTransform(buttonName,state.value)}},WindowsMotionController.prototype.lerpButtonTransform=function(buttonName,buttonValue){if(this._loadedMeshInfo){var meshInfo=this._loadedMeshInfo.buttonMeshes[buttonName];meshInfo.unpressed.rotationQuaternion&&meshInfo.pressed.rotationQuaternion&&meshInfo.value.rotationQuaternion&&(BABYLON.Quaternion.SlerpToRef(meshInfo.unpressed.rotationQuaternion,meshInfo.pressed.rotationQuaternion,buttonValue,meshInfo.value.rotationQuaternion),BABYLON.Vector3.LerpToRef(meshInfo.unpressed.position,meshInfo.pressed.position,buttonValue,meshInfo.value.position))}},WindowsMotionController.prototype.lerpAxisTransform=function(axis,axisValue){if(this._loadedMeshInfo){var meshInfo=this._loadedMeshInfo.axisMeshes[axis];if(meshInfo&&meshInfo.min.rotationQuaternion&&meshInfo.max.rotationQuaternion&&meshInfo.value.rotationQuaternion){var lerpValue=.5*axisValue+.5;BABYLON.Quaternion.SlerpToRef(meshInfo.min.rotationQuaternion,meshInfo.max.rotationQuaternion,lerpValue,meshInfo.value.rotationQuaternion),BABYLON.Vector3.LerpToRef(meshInfo.min.position,meshInfo.max.position,lerpValue,meshInfo.value.position)}}},WindowsMotionController.prototype.initControllerMesh=function(scene,meshLoaded,forceDefault){var _this=this;void 0===forceDefault&&(forceDefault=!1);var path,filename;if(BABYLON.SceneLoader.GetPluginForExtension("glb")){var device="default";if(this.id&&!forceDefault){var match=this.id.match(WindowsMotionController.GAMEPAD_ID_PATTERN);device=match&&match[0]||device}filename="left"===this.hand?WindowsMotionController.MODEL_LEFT_FILENAME:WindowsMotionController.MODEL_RIGHT_FILENAME,path=WindowsMotionController.MODEL_BASE_URL+device+"/"}else BABYLON.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),path=BABYLON.GenericController.MODEL_BASE_URL,filename=BABYLON.GenericController.MODEL_FILENAME;BABYLON.SceneLoader.ImportMesh("",path,filename,scene,function(meshes){_this._loadedMeshInfo=_this.processModel(scene,meshes),_this._loadedMeshInfo&&(_this._defaultModel=_this._loadedMeshInfo.rootNode,_this.attachToMesh(_this._defaultModel),meshLoaded&&meshLoaded(_this._defaultModel))},null,function(scene,message){BABYLON.Tools.Log(message),BABYLON.Tools.Warn("Failed to retrieve controller model from the remote server: "+path+filename),forceDefault||_this.initControllerMesh(scene,meshLoaded,!0)})},WindowsMotionController.prototype.processModel=function(scene,meshes){for(var loadedMeshInfo=null,parentMesh=new BABYLON.Mesh(this.id+" "+this.hand,scene),childMesh=null,i=0;i<meshes.length;i++){var mesh=meshes[i];if(!mesh.parent){mesh.isPickable=!1,childMesh=mesh;break}}return childMesh?(childMesh.setParent(parentMesh),loadedMeshInfo=this.createMeshInfo(parentMesh)):BABYLON.Tools.Warn("Could not find root node in model file."),loadedMeshInfo},WindowsMotionController.prototype.createMeshInfo=function(rootNode){function getChildByName(node,name){return node.getChildMeshes(!1,function(n){return n.name===name})[0]}function getImmediateChildByName(node,name){return node.getChildMeshes(!0,function(n){return n.name==name})[0]}var i,loadedMeshInfo=new LoadedMeshInfo;for(loadedMeshInfo.rootNode=rootNode,loadedMeshInfo.buttonMeshes={},loadedMeshInfo.axisMeshes={},i=0;i<this._mapping.buttons.length;i++){var buttonMeshName=this._mapping.buttonMeshNames[this._mapping.buttons[i]];if(buttonMeshName){var buttonMesh=getChildByName(rootNode,buttonMeshName);if(buttonMesh){var buttonMeshInfo={index:i,value:getImmediateChildByName(buttonMesh,"VALUE"),pressed:getImmediateChildByName(buttonMesh,"PRESSED"),unpressed:getImmediateChildByName(buttonMesh,"UNPRESSED")};buttonMeshInfo.value&&buttonMeshInfo.pressed&&buttonMeshInfo.unpressed?loadedMeshInfo.buttonMeshes[this._mapping.buttons[i]]=buttonMeshInfo:BABYLON.Tools.Warn("Missing button submesh under mesh with name: "+buttonMeshName+"(VALUE: "+!!buttonMeshInfo.value+", PRESSED: "+!!buttonMeshInfo.pressed+", UNPRESSED:"+!!buttonMeshInfo.unpressed+")")}else BABYLON.Tools.Warn("Missing button mesh with name: "+buttonMeshName)}else BABYLON.Tools.Log("Skipping unknown button at index: "+i+" with mapped name: "+this._mapping.buttons[i])}for(i=0;i<this._mapping.axisMeshNames.length;i++){var axisMeshName=this._mapping.axisMeshNames[i];if(axisMeshName){var axisMesh=getChildByName(rootNode,axisMeshName);if(axisMesh){var axisMeshInfo={index:i,value:getImmediateChildByName(axisMesh,"VALUE"),min:getImmediateChildByName(axisMesh,"MIN"),max:getImmediateChildByName(axisMesh,"MAX")};axisMeshInfo.value&&axisMeshInfo.min&&axisMeshInfo.max?loadedMeshInfo.axisMeshes[i]=axisMeshInfo:BABYLON.Tools.Warn("Missing axis submesh under mesh with name: "+axisMeshName+"(VALUE: "+!!axisMeshInfo.value+", MIN: "+!!axisMeshInfo.min+", MAX:"+!!axisMeshInfo.max+")")}else BABYLON.Tools.Warn("Missing axis mesh with name: "+axisMeshName)}else BABYLON.Tools.Log("Skipping unknown axis at index: "+i)}return loadedMeshInfo.pointingPoseNode=getChildByName(rootNode,this._mapping.pointingPoseMeshName),loadedMeshInfo.pointingPoseNode||BABYLON.Tools.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),loadedMeshInfo},WindowsMotionController.prototype.getForwardRay=function(length){if(void 0===length&&(length=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return _super.prototype.getForwardRay.call(this,length);var m=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),origin=m.getTranslation(),forward=new BABYLON.Vector3(0,0,-1),forwardWorld=BABYLON.Vector3.TransformNormal(forward,m),direction=BABYLON.Vector3.Normalize(forwardWorld);return new BABYLON.Ray(origin,direction,length)},WindowsMotionController.prototype.dispose=function(){_super.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},WindowsMotionController.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",WindowsMotionController.MODEL_LEFT_FILENAME="left.glb",WindowsMotionController.MODEL_RIGHT_FILENAME="right.glb",WindowsMotionController.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",WindowsMotionController.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,WindowsMotionController}(BABYLON.WebVRController);BABYLON.WindowsMotionController=WindowsMotionController}(BABYLON||(BABYLON={}));!function(BABYLON){var FollowCamera=function(_super){function FollowCamera(name,position,scene,lockedTarget){void 0===lockedTarget&&(lockedTarget=null);var _this=_super.call(this,name,position,scene)||this;return _this.radius=12,_this.rotationOffset=0,_this.heightOffset=4,_this.cameraAcceleration=.05,_this.maxCameraSpeed=20,_this.lockedTarget=lockedTarget,_this}return __extends(FollowCamera,_super),FollowCamera.prototype.getRadians=function(degrees){return degrees*Math.PI/180},FollowCamera.prototype.follow=function(cameraTarget){if(cameraTarget){var yRotation;if(cameraTarget.rotationQuaternion){var rotMatrix=new BABYLON.Matrix;cameraTarget.rotationQuaternion.toRotationMatrix(rotMatrix),yRotation=Math.atan2(rotMatrix.m[8],rotMatrix.m[10])}else yRotation=cameraTarget.rotation.y;var radians=this.getRadians(this.rotationOffset)+yRotation,targetPosition=cameraTarget.getAbsolutePosition(),targetX=targetPosition.x+Math.sin(radians)*this.radius,targetZ=targetPosition.z+Math.cos(radians)*this.radius,dx=targetX-this.position.x,dy=targetPosition.y+this.heightOffset-this.position.y,dz=targetZ-this.position.z,vx=dx*this.cameraAcceleration*2,vy=dy*this.cameraAcceleration,vz=dz*this.cameraAcceleration*2;(vx>this.maxCameraSpeed||vx<-this.maxCameraSpeed)&&(vx=vx<1?-this.maxCameraSpeed:this.maxCameraSpeed),(vy>this.maxCameraSpeed||vy<-this.maxCameraSpeed)&&(vy=vy<1?-this.maxCameraSpeed:this.maxCameraSpeed),(vz>this.maxCameraSpeed||vz<-this.maxCameraSpeed)&&(vz=vz<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new BABYLON.Vector3(this.position.x+vx,this.position.y+vy,this.position.z+vz),this.setTarget(targetPosition)}},FollowCamera.prototype._checkInputs=function(){_super.prototype._checkInputs.call(this),this.lockedTarget&&this.follow(this.lockedTarget)},FollowCamera.prototype.getClassName=function(){return"FollowCamera"},__decorate([BABYLON.serialize()],FollowCamera.prototype,"radius",void 0),__decorate([BABYLON.serialize()],FollowCamera.prototype,"rotationOffset",void 0),__decorate([BABYLON.serialize()],FollowCamera.prototype,"heightOffset",void 0),__decorate([BABYLON.serialize()],FollowCamera.prototype,"cameraAcceleration",void 0),__decorate([BABYLON.serialize()],FollowCamera.prototype,"maxCameraSpeed",void 0),__decorate([BABYLON.serializeAsMeshReference("lockedTargetId")],FollowCamera.prototype,"lockedTarget",void 0),FollowCamera}(BABYLON.TargetCamera);BABYLON.FollowCamera=FollowCamera;var ArcFollowCamera=function(_super){function ArcFollowCamera(name,alpha,beta,radius,target,scene){var _this=_super.call(this,name,BABYLON.Vector3.Zero(),scene)||this;return _this.alpha=alpha,_this.beta=beta,_this.radius=radius,_this.target=target,_this._cartesianCoordinates=BABYLON.Vector3.Zero(),_this.follow(),_this}return __extends(ArcFollowCamera,_super),ArcFollowCamera.prototype.follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var targetPosition=this.target.getAbsolutePosition();this.position=targetPosition.add(this._cartesianCoordinates),this.setTarget(targetPosition)}},ArcFollowCamera.prototype._checkInputs=function(){_super.prototype._checkInputs.call(this),this.follow()},ArcFollowCamera.prototype.getClassName=function(){return"ArcFollowCamera"},ArcFollowCamera}(BABYLON.TargetCamera);BABYLON.ArcFollowCamera=ArcFollowCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var UniversalCamera=function(_super){function UniversalCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this.inputs.addGamepad(),_this}return __extends(UniversalCamera,_super),Object.defineProperty(UniversalCamera.prototype,"gamepadAngularSensibility",{get:function(){var gamepad=this.inputs.attached.gamepad;return gamepad?gamepad.gamepadAngularSensibility:0},set:function(value){var gamepad=this.inputs.attached.gamepad;gamepad&&(gamepad.gamepadAngularSensibility=value)},enumerable:!0,configurable:!0}),Object.defineProperty(UniversalCamera.prototype,"gamepadMoveSensibility",{get:function(){var gamepad=this.inputs.attached.gamepad;return gamepad?gamepad.gamepadMoveSensibility:0},set:function(value){var gamepad=this.inputs.attached.gamepad;gamepad&&(gamepad.gamepadMoveSensibility=value)},enumerable:!0,configurable:!0}),UniversalCamera.prototype.getClassName=function(){return"UniversalCamera"},UniversalCamera}(BABYLON.TouchCamera);BABYLON.UniversalCamera=UniversalCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var GamepadCamera=function(_super){function GamepadCamera(name,position,scene){return _super.call(this,name,position,scene)||this}return __extends(GamepadCamera,_super),Object.defineProperty(GamepadCamera.prototype,"gamepadAngularSensibility",{get:function(){var gamepad=this.inputs.attached.gamepad;return gamepad?gamepad.gamepadAngularSensibility:0},set:function(value){var gamepad=this.inputs.attached.gamepad;gamepad&&(gamepad.gamepadAngularSensibility=value)},enumerable:!0,configurable:!0}),Object.defineProperty(GamepadCamera.prototype,"gamepadMoveSensibility",{get:function(){var gamepad=this.inputs.attached.gamepad;return gamepad?gamepad.gamepadMoveSensibility:0},set:function(value){var gamepad=this.inputs.attached.gamepad;gamepad&&(gamepad.gamepadMoveSensibility=value)},enumerable:!0,configurable:!0}),GamepadCamera.prototype.getClassName=function(){return"GamepadCamera"},GamepadCamera}(BABYLON.UniversalCamera);BABYLON.GamepadCamera=GamepadCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcessRenderPipelineManager=function(){function PostProcessRenderPipelineManager(){this._renderPipelines={}}return PostProcessRenderPipelineManager.prototype.addPipeline=function(renderPipeline){this._renderPipelines[renderPipeline._name]=renderPipeline},PostProcessRenderPipelineManager.prototype.attachCamerasToRenderPipeline=function(renderPipelineName,cameras,unique){void 0===unique&&(unique=!1);var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._attachCameras(cameras,unique)},PostProcessRenderPipelineManager.prototype.detachCamerasFromRenderPipeline=function(renderPipelineName,cameras){var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._detachCameras(cameras)},PostProcessRenderPipelineManager.prototype.enableEffectInPipeline=function(renderPipelineName,renderEffectName,cameras){var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._enableEffect(renderEffectName,cameras)},PostProcessRenderPipelineManager.prototype.disableEffectInPipeline=function(renderPipelineName,renderEffectName,cameras){var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._disableEffect(renderEffectName,cameras)},PostProcessRenderPipelineManager.prototype.enableDisplayOnlyPassInPipeline=function(renderPipelineName,passName,cameras){var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._enableDisplayOnlyPass(passName,cameras)},PostProcessRenderPipelineManager.prototype.disableDisplayOnlyPassInPipeline=function(renderPipelineName,cameras){var renderPipeline=this._renderPipelines[renderPipelineName];renderPipeline&&renderPipeline._disableDisplayOnlyPass(cameras)},PostProcessRenderPipelineManager.prototype.update=function(){for(var renderPipelineName in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(renderPipelineName)){var pipeline=this._renderPipelines[renderPipelineName];pipeline.isSupported?pipeline._update():(pipeline.dispose(),delete this._renderPipelines[renderPipelineName])}},PostProcessRenderPipelineManager.prototype._rebuild=function(){for(var renderPipelineName in this._renderPipelines)this._renderPipelines.hasOwnProperty(renderPipelineName)&&this._renderPipelines[renderPipelineName]._rebuild()},PostProcessRenderPipelineManager.prototype.dispose=function(){for(var renderPipelineName in this._renderPipelines)this._renderPipelines.hasOwnProperty(renderPipelineName)&&this._renderPipelines[renderPipelineName].dispose()},PostProcessRenderPipelineManager}();BABYLON.PostProcessRenderPipelineManager=PostProcessRenderPipelineManager}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcessRenderPass=function(){function PostProcessRenderPass(scene,name,size,renderList,beforeRender,afterRender){this._refCount=0,this._name=name,this._renderTexture=new BABYLON.RenderTargetTexture(name,size,scene),this.setRenderList(renderList),this._renderTexture.onBeforeRenderObservable.add(beforeRender),this._renderTexture.onAfterRenderObservable.add(afterRender),this._scene=scene,this._renderList=renderList}return PostProcessRenderPass.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},PostProcessRenderPass.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},PostProcessRenderPass.prototype._update=function(){this.setRenderList(this._renderList)},PostProcessRenderPass.prototype.setRenderList=function(renderList){this._renderTexture.renderList=renderList},PostProcessRenderPass.prototype.getRenderTexture=function(){return this._renderTexture},PostProcessRenderPass}();BABYLON.PostProcessRenderPass=PostProcessRenderPass}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcessRenderEffect=function(){function PostProcessRenderEffect(engine,name,getPostProcess,singleInstance){this._name=name,this._singleInstance=singleInstance||!0,this._getPostProcess=getPostProcess,this._cameras={},this._indicesForCamera={},this._postProcesses={},this._renderPasses={},this._renderEffectAsPasses={}}return Object.defineProperty(PostProcessRenderEffect.prototype,"isSupported",{get:function(){for(var index in this._postProcesses)if(!this._postProcesses[index].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),PostProcessRenderEffect.prototype._update=function(){for(var renderPassName in this._renderPasses)this._renderPasses[renderPassName]._update()},PostProcessRenderEffect.prototype.addPass=function(renderPass){this._renderPasses[renderPass._name]=renderPass,this._linkParameters()},PostProcessRenderEffect.prototype.removePass=function(renderPass){delete this._renderPasses[renderPass._name],this._linkParameters()},PostProcessRenderEffect.prototype.addRenderEffectAsPass=function(renderEffect){this._renderEffectAsPasses[renderEffect._name]=renderEffect,this._linkParameters()},PostProcessRenderEffect.prototype.getPass=function(passName){for(var renderPassName in this._renderPasses)if(renderPassName===passName)return this._renderPasses[passName];return null},PostProcessRenderEffect.prototype.emptyPasses=function(){this._renderPasses={},this._linkParameters()},PostProcessRenderEffect.prototype._attachCameras=function(cameras){var cameraKey,cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams){for(var i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.name;cameraKey=this._singleInstance?0:cameraName,this._postProcesses[cameraKey]=this._postProcesses[cameraKey]||this._getPostProcess();var index=camera.attachPostProcess(this._postProcesses[cameraKey]);this._indicesForCamera[cameraName]||(this._indicesForCamera[cameraName]=[]),this._indicesForCamera[cameraName].push(index),this._cameras[cameraName]||(this._cameras[cameraName]=camera);for(var passName in this._renderPasses)this._renderPasses[passName]._incRefCount()}this._linkParameters()}},PostProcessRenderEffect.prototype._detachCameras=function(cameras){var cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams)for(var i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.name;camera.detachPostProcess(this._postProcesses[this._singleInstance?0:cameraName]),this._cameras[cameraName]&&(this._cameras[cameraName]=null);for(var passName in this._renderPasses)this._renderPasses[passName]._decRefCount()}},PostProcessRenderEffect.prototype._enable=function(cameras){var cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams)for(var i=0;i<cams.length;i++){for(var camera=cams[i],cameraName=camera.name,j=0;j<this._indicesForCamera[cameraName].length;j++)void 0===camera._postProcesses[this._indicesForCamera[cameraName][j]]&&cameras[i].attachPostProcess(this._postProcesses[this._singleInstance?0:cameraName],this._indicesForCamera[cameraName][j]);for(var passName in this._renderPasses)this._renderPasses[passName]._incRefCount()}},PostProcessRenderEffect.prototype._disable=function(cameras){var cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams)for(var i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.Name;camera.detachPostProcess(this._postProcesses[this._singleInstance?0:cameraName]);for(var passName in this._renderPasses)this._renderPasses[passName]._decRefCount()}},PostProcessRenderEffect.prototype.getPostProcess=function(camera){return this._singleInstance?this._postProcesses[0]:camera?this._postProcesses[camera.name]:null},PostProcessRenderEffect.prototype._linkParameters=function(){var _this=this;for(var index in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[index]),this._postProcesses[index].onBeforeRenderObservable.add(function(effect){_this._linkTextures(effect)})},PostProcessRenderEffect.prototype._linkTextures=function(effect){for(var renderPassName in this._renderPasses)effect.setTexture(renderPassName,this._renderPasses[renderPassName].getRenderTexture());for(var renderEffectName in this._renderEffectAsPasses)effect.setTextureFromPostProcess(renderEffectName+"Sampler",this._renderEffectAsPasses[renderEffectName].getPostProcess())},PostProcessRenderEffect}();BABYLON.PostProcessRenderEffect=PostProcessRenderEffect}(BABYLON||(BABYLON={}));!function(BABYLON){var PostProcessRenderPipeline=function(){function PostProcessRenderPipeline(engine,name){this._engine=engine,this._name=name,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return PostProcessRenderPipeline.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(PostProcessRenderPipeline.prototype,"isSupported",{get:function(){for(var renderEffectName in this._renderEffects)if(this._renderEffects.hasOwnProperty(renderEffectName)&&!this._renderEffects[renderEffectName].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),PostProcessRenderPipeline.prototype.addEffect=function(renderEffect){this._renderEffects[renderEffect._name]=renderEffect},PostProcessRenderPipeline.prototype._rebuild=function(){},PostProcessRenderPipeline.prototype._enableEffect=function(renderEffectName,cameras){var renderEffects=this._renderEffects[renderEffectName];renderEffects&&renderEffects._enable(BABYLON.Tools.MakeArray(cameras||this._cameras))},PostProcessRenderPipeline.prototype._disableEffect=function(renderEffectName,cameras){var renderEffects=this._renderEffects[renderEffectName];renderEffects&&renderEffects._disable(BABYLON.Tools.MakeArray(cameras||this._cameras))},PostProcessRenderPipeline.prototype._attachCameras=function(cameras,unique){var cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams){var i,indicesToDelete=[];for(i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.name;-1===this._cameras.indexOf(camera)?this._cameras[cameraName]=camera:unique&&indicesToDelete.push(i)}for(i=0;i<indicesToDelete.length;i++)cameras.splice(indicesToDelete[i],1);for(var renderEffectName in this._renderEffects)this._renderEffects.hasOwnProperty(renderEffectName)&&this._renderEffects[renderEffectName]._attachCameras(cams)}},PostProcessRenderPipeline.prototype._detachCameras=function(cameras){var cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams){for(var renderEffectName in this._renderEffects)this._renderEffects.hasOwnProperty(renderEffectName)&&this._renderEffects[renderEffectName]._detachCameras(cams);for(var i=0;i<cams.length;i++)this._cameras.splice(this._cameras.indexOf(cams[i]),1)}},PostProcessRenderPipeline.prototype._enableDisplayOnlyPass=function(passName,cameras){var _this=this,cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams){var renderEffectName,pass=null;for(renderEffectName in this._renderEffects)if(this._renderEffects.hasOwnProperty(renderEffectName)&&null!=(pass=this._renderEffects[renderEffectName].getPass(passName)))break;if(null!==pass){for(renderEffectName in this._renderEffects)this._renderEffects.hasOwnProperty(renderEffectName)&&this._renderEffects[renderEffectName]._disable(cams);pass._name=PostProcessRenderPipeline.PASS_SAMPLER_NAME;for(var i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.name;this._renderEffectsForIsolatedPass[cameraName]=this._renderEffectsForIsolatedPass[cameraName]||new BABYLON.PostProcessRenderEffect(this._engine,PostProcessRenderPipeline.PASS_EFFECT_NAME,function(){return new BABYLON.DisplayPassPostProcess(PostProcessRenderPipeline.PASS_EFFECT_NAME,1,null,void 0,_this._engine,!0)}),this._renderEffectsForIsolatedPass[cameraName].emptyPasses(),this._renderEffectsForIsolatedPass[cameraName].addPass(pass),this._renderEffectsForIsolatedPass[cameraName]._attachCameras(camera)}}}},PostProcessRenderPipeline.prototype._disableDisplayOnlyPass=function(cameras){var _this=this,cams=BABYLON.Tools.MakeArray(cameras||this._cameras);if(cams){for(var i=0;i<cams.length;i++){var camera=cams[i],cameraName=camera.name;this._renderEffectsForIsolatedPass[cameraName]=this._renderEffectsForIsolatedPass[cameraName]||new BABYLON.PostProcessRenderEffect(this._engine,PostProcessRenderPipeline.PASS_EFFECT_NAME,function(){return new BABYLON.DisplayPassPostProcess(PostProcessRenderPipeline.PASS_EFFECT_NAME,1,null,void 0,_this._engine,!0)}),this._renderEffectsForIsolatedPass[cameraName]._disable(camera)}for(var renderEffectName in this._renderEffects)this._renderEffects.hasOwnProperty(renderEffectName)&&this._renderEffects[renderEffectName]._enable(cams)}},PostProcessRenderPipeline.prototype._update=function(){for(var renderEffectName in this._renderEffects)this._renderEffects.hasOwnProperty(renderEffectName)&&this._renderEffects[renderEffectName]._update();for(var i=0;i<this._cameras.length;i++){var cameraName=this._cameras[i].name;this._renderEffectsForIsolatedPass[cameraName]&&this._renderEffectsForIsolatedPass[cameraName]._update()}},PostProcessRenderPipeline.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},PostProcessRenderPipeline.prototype.dispose=function(){},PostProcessRenderPipeline.PASS_EFFECT_NAME="passEffect",PostProcessRenderPipeline.PASS_SAMPLER_NAME="passSampler",__decorate([BABYLON.serialize()],PostProcessRenderPipeline.prototype,"_name",void 0),PostProcessRenderPipeline}();BABYLON.PostProcessRenderPipeline=PostProcessRenderPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var DepthRenderer=function(){function DepthRenderer(scene,type){void 0===type&&(type=BABYLON.Engine.TEXTURETYPE_FLOAT);var _this=this;this._scene=scene;var engine=scene.getEngine();this._depthMap=new BABYLON.RenderTargetTexture("depthMap",{width:engine.getRenderWidth(),height:engine.getRenderHeight()},this._scene,!1,!0,type),this._depthMap.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClearObservable.add(function(engine){engine.clear(new BABYLON.Color4(1,1,1,1),!0,!0,!0)});var renderSubMesh=function(subMesh){var mesh=subMesh.getRenderingMesh(),scene=_this._scene,engine=scene.getEngine(),material=subMesh.getMaterial();if(material){engine.setState(material.backFaceCulling,0,!1,scene.useRightHandedSystem);var batch=mesh._getInstancesRenderList(subMesh._id);if(!batch.mustReturn){var hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id];if(_this.isReady(subMesh,hardwareInstancedRendering)&&scene.activeCamera){if(engine.enableEffect(_this._effect),mesh._bind(subMesh,_this._effect,BABYLON.Material.TriangleFillMode),_this._effect.setMatrix("viewProjection",scene.getTransformMatrix()),_this._effect.setFloat2("depthValues",scene.activeCamera.minZ,scene.activeCamera.minZ+scene.activeCamera.maxZ),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(_this._effect.setTexture("diffuseSampler",alphaTexture),_this._effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix()))}mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton&&_this._effect.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh)),mesh._processRendering(subMesh,_this._effect,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){return _this._effect.setMatrix("world",world)})}}}};this._depthMap.customRenderFunction=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index;if(depthOnlySubMeshes.length){for(engine.setColorWrite(!1),index=0;index<depthOnlySubMeshes.length;index++)renderSubMesh(depthOnlySubMeshes.data[index]);engine.setColorWrite(!0)}for(index=0;index<opaqueSubMeshes.length;index++)renderSubMesh(opaqueSubMeshes.data[index]);for(index=0;index<alphaTestSubMeshes.length;index++)renderSubMesh(alphaTestSubMeshes.data[index])}}return DepthRenderer.prototype.isReady=function(subMesh,useInstances){var material=subMesh.getMaterial();if(material.disableDepthWrite)return!1;var defines=[],attribs=[BABYLON.VertexBuffer.PositionKind],mesh=subMesh.getMesh();material&&material.needAlphaTesting()&&(defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2"))),mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._effect=this._scene.getEngine().createEffect("depth",attribs,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],join)),this._effect.isReady()},DepthRenderer.prototype.getDepthMap=function(){return this._depthMap},DepthRenderer.prototype.dispose=function(){this._depthMap.dispose()},DepthRenderer}();BABYLON.DepthRenderer=DepthRenderer}(BABYLON||(BABYLON={}));!function(BABYLON){var SSAORenderingPipeline=function(_super){function SSAORenderingPipeline(name,scene,ratio,cameras){var _this=_super.call(this,scene.getEngine(),name)||this;_this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",_this.SSAORenderEffect="SSAORenderEffect",_this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",_this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",_this.SSAOCombineRenderEffect="SSAOCombineRenderEffect",_this.totalStrength=1,_this.radius=1e-4,_this.area=.0075,_this.fallOff=1e-6,_this.base=.5,_this._firstUpdate=!0,_this._scene=scene,_this._createRandomTexture(),_this._depthTexture=scene.enableDepthRenderer().getDepthMap();var ssaoRatio=ratio.ssaoRatio||ratio,combineRatio=ratio.combineRatio||ratio;return _this._originalColorPostProcess=new BABYLON.PassPostProcess("SSAOOriginalSceneColor",combineRatio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1),_this._createSSAOPostProcess(ssaoRatio),_this._createBlurPostProcess(ssaoRatio),_this._createSSAOCombinePostProcess(combineRatio),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOOriginalSceneColorEffect,function(){return _this._originalColorPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAORenderEffect,function(){return _this._ssaoPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOBlurHRenderEffect,function(){return _this._blurHPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOBlurVRenderEffect,function(){return _this._blurVPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOCombineRenderEffect,function(){return _this._ssaoCombinePostProcess},!0)),scene.postProcessRenderPipelineManager.addPipeline(_this),cameras&&scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(name,cameras),_this}return __extends(SSAORenderingPipeline,_super),SSAORenderingPipeline.prototype.dispose=function(disableDepthRender){void 0===disableDepthRender&&(disableDepthRender=!1);for(var i=0;i<this._scene.cameras.length;i++){var camera=this._scene.cameras[i];this._originalColorPostProcess.dispose(camera),this._ssaoPostProcess.dispose(camera),this._blurHPostProcess.dispose(camera),this._blurVPostProcess.dispose(camera),this._ssaoCombinePostProcess.dispose(camera)}this._randomTexture.dispose(),disableDepthRender&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),_super.prototype.dispose.call(this)},SSAORenderingPipeline.prototype._createBlurPostProcess=function(ratio){var _this=this;this._blurHPostProcess=new BABYLON.BlurPostProcess("BlurH",new BABYLON.Vector2(1,0),16,ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new BABYLON.BlurPostProcess("BlurV",new BABYLON.Vector2(0,1),16,ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var dw=_this._blurHPostProcess.width/_this._scene.getEngine().getRenderWidth();_this._blurHPostProcess.kernel=16*dw}),this._blurVPostProcess.onActivateObservable.add(function(){var dw=_this._blurVPostProcess.height/_this._scene.getEngine().getRenderHeight();_this._blurVPostProcess.kernel=16*dw})},SSAORenderingPipeline.prototype._rebuild=function(){this._firstUpdate=!0,_super.prototype._rebuild.call(this)},SSAORenderingPipeline.prototype._createSSAOPostProcess=function(ratio){var _this=this,sampleSphere=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new BABYLON.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(effect){_this._firstUpdate&&(effect.setArray3("sampleSphere",sampleSphere),effect.setFloat("samplesFactor",1/16),effect.setFloat("randTextureTiles",4)),effect.setFloat("totalStrength",_this.totalStrength),effect.setFloat("radius",_this.radius),effect.setFloat("area",_this.area),effect.setFloat("fallOff",_this.fallOff),effect.setFloat("base",_this.base),effect.setTexture("textureSampler",_this._depthTexture),effect.setTexture("randomSampler",_this._randomTexture)}},SSAORenderingPipeline.prototype._createSSAOCombinePostProcess=function(ratio){var _this=this;this._ssaoCombinePostProcess=new BABYLON.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(effect){effect.setTextureFromPostProcess("originalColor",_this._originalColorPostProcess)}},SSAORenderingPipeline.prototype._createRandomTexture=function(){this._randomTexture=new BABYLON.DynamicTexture("SSAORandomTexture",512,this._scene,!1,BABYLON.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=BABYLON.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=BABYLON.Texture.WRAP_ADDRESSMODE;for(var context=this._randomTexture.getContext(),rand=function(min,max){return Math.random()*(max-min)+min},randVector=BABYLON.Vector3.Zero(),x=0;x<512;x++)for(var y=0;y<512;y++)randVector.x=Math.floor(255*rand(-1,1)),randVector.y=Math.floor(255*rand(-1,1)),randVector.z=Math.floor(255*rand(-1,1)),context.fillStyle="rgb("+randVector.x+", "+randVector.y+", "+randVector.z+")",context.fillRect(x,y,1,1);this._randomTexture.update(!1)},__decorate([BABYLON.serialize()],SSAORenderingPipeline.prototype,"totalStrength",void 0),__decorate([BABYLON.serialize()],SSAORenderingPipeline.prototype,"radius",void 0),__decorate([BABYLON.serialize()],SSAORenderingPipeline.prototype,"area",void 0),__decorate([BABYLON.serialize()],SSAORenderingPipeline.prototype,"fallOff",void 0),__decorate([BABYLON.serialize()],SSAORenderingPipeline.prototype,"base",void 0),SSAORenderingPipeline}(BABYLON.PostProcessRenderPipeline);BABYLON.SSAORenderingPipeline=SSAORenderingPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var SSAO2RenderingPipeline=function(_super){function SSAO2RenderingPipeline(name,scene,ratio,cameras){var _this=_super.call(this,scene.getEngine(),name)||this;if(_this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",_this.SSAORenderEffect="SSAORenderEffect",_this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",_this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",_this.SSAOCombineRenderEffect="SSAOCombineRenderEffect",_this.totalStrength=1,_this.maxZ=100,_this.minZAspect=.2,_this._samples=8,_this._expensiveBlur=!0,_this.radius=2,_this.base=.1,_this._firstUpdate=!0,_this._scene=scene,!_this.isSupported)return BABYLON.Tools.Error("SSAO 2 needs WebGL 2 support."),_this;var ssaoRatio=ratio.ssaoRatio||ratio,blurRatio=ratio.blurRatio||ratio,geometryBufferRenderer=scene.enableGeometryBufferRenderer();return _this._createRandomTexture(),_this._depthTexture=geometryBufferRenderer.getGBuffer().textures[0],_this._normalTexture=geometryBufferRenderer.getGBuffer().textures[1],_this._originalColorPostProcess=new BABYLON.PassPostProcess("SSAOOriginalSceneColor",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1),_this._createSSAOPostProcess(1),_this._createBlurPostProcess(ssaoRatio,blurRatio),_this._createSSAOCombinePostProcess(blurRatio),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOOriginalSceneColorEffect,function(){return _this._originalColorPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAORenderEffect,function(){return _this._ssaoPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOBlurHRenderEffect,function(){return _this._blurHPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOBlurVRenderEffect,function(){return _this._blurVPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.SSAOCombineRenderEffect,function(){return _this._ssaoCombinePostProcess},!0)),scene.postProcessRenderPipelineManager.addPipeline(_this),cameras&&scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(name,cameras),_this}return __extends(SSAO2RenderingPipeline,_super),Object.defineProperty(SSAO2RenderingPipeline.prototype,"samples",{get:function(){return this._samples},set:function(n){this._ssaoPostProcess.updateEffect("#define SAMPLES "+n+"\n#define SSAO"),this._samples=n,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(SSAO2RenderingPipeline.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(b){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(b?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(b?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=b,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(SSAO2RenderingPipeline,"IsSupported",{get:function(){var engine=BABYLON.Engine.LastCreatedEngine;return!!engine&&engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),SSAO2RenderingPipeline.prototype.dispose=function(disableGeometryBufferRenderer){void 0===disableGeometryBufferRenderer&&(disableGeometryBufferRenderer=!1);for(var i=0;i<this._scene.cameras.length;i++){var camera=this._scene.cameras[i];this._originalColorPostProcess.dispose(camera),this._ssaoPostProcess.dispose(camera),this._blurHPostProcess.dispose(camera),this._blurVPostProcess.dispose(camera),this._ssaoCombinePostProcess.dispose(camera)}this._randomTexture.dispose(),disableGeometryBufferRenderer&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),_super.prototype.dispose.call(this)},SSAO2RenderingPipeline.prototype._createBlurPostProcess=function(ssaoRatio,blurRatio){var _this=this;this._samplerOffsets=[];for(var expensive=this.expensiveBlur,i=-8;i<8;i++)this._samplerOffsets.push(2*i+.5);this._blurHPostProcess=new BABYLON.PostProcess("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],ssaoRatio,null,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(expensive?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(effect){_this._scene.activeCamera&&(effect.setFloat("outSize",_this._ssaoCombinePostProcess.width>0?_this._ssaoCombinePostProcess.width:_this._originalColorPostProcess.width),effect.setFloat("near",_this._scene.activeCamera.minZ),effect.setFloat("far",_this._scene.activeCamera.maxZ),effect.setFloat("radius",_this.radius),effect.setTexture("depthSampler",_this._depthTexture),_this._firstUpdate&&effect.setArray("samplerOffsets",_this._samplerOffsets))},this._blurVPostProcess=new BABYLON.PostProcess("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],blurRatio,null,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(expensive?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(effect){_this._scene.activeCamera&&(effect.setFloat("outSize",_this._ssaoCombinePostProcess.height>0?_this._ssaoCombinePostProcess.height:_this._originalColorPostProcess.height),effect.setFloat("near",_this._scene.activeCamera.minZ),effect.setFloat("far",_this._scene.activeCamera.maxZ),effect.setFloat("radius",_this.radius),effect.setTexture("depthSampler",_this._depthTexture),_this._firstUpdate&&(effect.setArray("samplerOffsets",_this._samplerOffsets),_this._firstUpdate=!1))}},SSAO2RenderingPipeline.prototype._rebuild=function(){this._firstUpdate=!0,_super.prototype._rebuild.call(this)},SSAO2RenderingPipeline.prototype._generateHemisphere=function(){for(var vector,scale,numSamples=this.samples,result=[],rand=function(min,max){return Math.random()*(max-min)+min},i=0;i<numSamples;)(vector=new BABYLON.Vector3(rand(-1,1),rand(-1,1),rand(.3,1))).normalize(),scale=i/numSamples,scale=BABYLON.Scalar.Lerp(.1,1,scale*scale),vector.scaleInPlace(scale),result.push(vector.x,vector.y,vector.z),i++;return result},SSAO2RenderingPipeline.prototype._createSSAOPostProcess=function(ratio){var _this=this,numSamples=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new BABYLON.PostProcess("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+numSamples+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(effect){_this._firstUpdate&&(effect.setArray3("sampleSphere",_this._sampleSphere),effect.setFloat("randTextureTiles",4)),_this._scene.activeCamera&&(effect.setFloat("samplesFactor",1/_this.samples),effect.setFloat("totalStrength",_this.totalStrength),effect.setFloat2("texelSize",1/_this._ssaoPostProcess.width,1/_this._ssaoPostProcess.height),effect.setFloat("radius",_this.radius),effect.setFloat("maxZ",_this.maxZ),effect.setFloat("minZAspect",_this.minZAspect),effect.setFloat("base",_this.base),effect.setFloat("near",_this._scene.activeCamera.minZ),effect.setFloat("far",_this._scene.activeCamera.maxZ),effect.setFloat("xViewport",Math.tan(_this._scene.activeCamera.fov/2)*_this._scene.getEngine().getAspectRatio(_this._scene.activeCamera,!0)),effect.setFloat("yViewport",Math.tan(_this._scene.activeCamera.fov/2)),effect.setMatrix("projection",_this._scene.getProjectionMatrix()),effect.setTexture("textureSampler",_this._depthTexture),effect.setTexture("normalSampler",_this._normalTexture),effect.setTexture("randomSampler",_this._randomTexture))}},SSAO2RenderingPipeline.prototype._createSSAOCombinePostProcess=function(ratio){var _this=this;this._ssaoCombinePostProcess=new BABYLON.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(effect){effect.setTextureFromPostProcess("originalColor",_this._originalColorPostProcess)}},SSAO2RenderingPipeline.prototype._createRandomTexture=function(){this._randomTexture=new BABYLON.DynamicTexture("SSAORandomTexture",512,this._scene,!1,BABYLON.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=BABYLON.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=BABYLON.Texture.WRAP_ADDRESSMODE;for(var context=this._randomTexture.getContext(),rand=function(min,max){return Math.random()*(max-min)+min},randVector=BABYLON.Vector3.Zero(),x=0;x<512;x++)for(var y=0;y<512;y++)randVector.x=rand(0,1),randVector.y=rand(0,1),randVector.z=0,randVector.normalize(),randVector.scaleInPlace(255),randVector.x=Math.floor(randVector.x),randVector.y=Math.floor(randVector.y),context.fillStyle="rgb("+randVector.x+", "+randVector.y+", "+randVector.z+")",context.fillRect(x,y,1,1);this._randomTexture.update(!1)},__decorate([BABYLON.serialize()],SSAO2RenderingPipeline.prototype,"totalStrength",void 0),__decorate([BABYLON.serialize()],SSAO2RenderingPipeline.prototype,"maxZ",void 0),__decorate([BABYLON.serialize()],SSAO2RenderingPipeline.prototype,"minZAspect",void 0),__decorate([BABYLON.serialize("samples")],SSAO2RenderingPipeline.prototype,"_samples",void 0),__decorate([BABYLON.serialize("expensiveBlur")],SSAO2RenderingPipeline.prototype,"_expensiveBlur",void 0),__decorate([BABYLON.serialize()],SSAO2RenderingPipeline.prototype,"radius",void 0),__decorate([BABYLON.serialize()],SSAO2RenderingPipeline.prototype,"base",void 0),SSAO2RenderingPipeline}(BABYLON.PostProcessRenderPipeline);BABYLON.SSAO2RenderingPipeline=SSAO2RenderingPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var LensRenderingPipeline=function(_super){function LensRenderingPipeline(name,parameters,scene,ratio,cameras){void 0===ratio&&(ratio=1);var _this=_super.call(this,scene.getEngine(),name)||this;return _this.LensChromaticAberrationEffect="LensChromaticAberrationEffect",_this.HighlightsEnhancingEffect="HighlightsEnhancingEffect",_this.LensDepthOfFieldEffect="LensDepthOfFieldEffect",_this._scene=scene,_this._depthTexture=scene.enableDepthRenderer().getDepthMap(),parameters.grain_texture?_this._grainTexture=parameters.grain_texture:_this._createGrainTexture(),_this._edgeBlur=parameters.edge_blur?parameters.edge_blur:0,_this._grainAmount=parameters.grain_amount?parameters.grain_amount:0,_this._chromaticAberration=parameters.chromatic_aberration?parameters.chromatic_aberration:0,_this._distortion=parameters.distortion?parameters.distortion:0,_this._highlightsGain=void 0!==parameters.dof_gain?parameters.dof_gain:-1,_this._highlightsThreshold=parameters.dof_threshold?parameters.dof_threshold:1,_this._dofDistance=void 0!==parameters.dof_focus_distance?parameters.dof_focus_distance:-1,_this._dofAperture=parameters.dof_aperture?parameters.dof_aperture:1,_this._dofDarken=parameters.dof_darken?parameters.dof_darken:0,_this._dofPentagon=void 0===parameters.dof_pentagon||parameters.dof_pentagon,_this._blurNoise=void 0===parameters.blur_noise||parameters.blur_noise,_this._createChromaticAberrationPostProcess(ratio),_this._createHighlightsPostProcess(ratio),_this._createDepthOfFieldPostProcess(ratio/4),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.LensChromaticAberrationEffect,function(){return _this._chromaticAberrationPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.HighlightsEnhancingEffect,function(){return _this._highlightsPostProcess},!0)),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),_this.LensDepthOfFieldEffect,function(){return _this._depthOfFieldPostProcess},!0)),-1===_this._highlightsGain&&_this._disableEffect(_this.HighlightsEnhancingEffect,null),scene.postProcessRenderPipelineManager.addPipeline(_this),cameras&&scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(name,cameras),_this}return __extends(LensRenderingPipeline,_super),LensRenderingPipeline.prototype.setEdgeBlur=function(amount){this._edgeBlur=amount},LensRenderingPipeline.prototype.disableEdgeBlur=function(){this._edgeBlur=0},LensRenderingPipeline.prototype.setGrainAmount=function(amount){this._grainAmount=amount},LensRenderingPipeline.prototype.disableGrain=function(){this._grainAmount=0},LensRenderingPipeline.prototype.setChromaticAberration=function(amount){this._chromaticAberration=amount},LensRenderingPipeline.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},LensRenderingPipeline.prototype.setEdgeDistortion=function(amount){this._distortion=amount},LensRenderingPipeline.prototype.disableEdgeDistortion=function(){this._distortion=0},LensRenderingPipeline.prototype.setFocusDistance=function(amount){this._dofDistance=amount},LensRenderingPipeline.prototype.disableDepthOfField=function(){this._dofDistance=-1},LensRenderingPipeline.prototype.setAperture=function(amount){this._dofAperture=amount},LensRenderingPipeline.prototype.setDarkenOutOfFocus=function(amount){this._dofDarken=amount},LensRenderingPipeline.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},LensRenderingPipeline.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},LensRenderingPipeline.prototype.enableNoiseBlur=function(){this._blurNoise=!0},LensRenderingPipeline.prototype.disableNoiseBlur=function(){this._blurNoise=!1},LensRenderingPipeline.prototype.setHighlightsGain=function(amount){this._highlightsGain=amount},LensRenderingPipeline.prototype.setHighlightsThreshold=function(amount){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=amount},LensRenderingPipeline.prototype.disableHighlights=function(){this._highlightsGain=-1},LensRenderingPipeline.prototype.dispose=function(disableDepthRender){void 0===disableDepthRender&&(disableDepthRender=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),disableDepthRender&&this._scene.disableDepthRenderer()},LensRenderingPipeline.prototype._createChromaticAberrationPostProcess=function(ratio){var _this=this;this._chromaticAberrationPostProcess=new BABYLON.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],ratio,null,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(effect){effect.setFloat("chromatic_aberration",_this._chromaticAberration),effect.setFloat("screen_width",_this._scene.getEngine().getRenderWidth()),effect.setFloat("screen_height",_this._scene.getEngine().getRenderHeight())}},LensRenderingPipeline.prototype._createHighlightsPostProcess=function(ratio){var _this=this;this._highlightsPostProcess=new BABYLON.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],ratio,null,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(effect){effect.setFloat("gain",_this._highlightsGain),effect.setFloat("threshold",_this._highlightsThreshold),effect.setTextureFromPostProcess("textureSampler",_this._chromaticAberrationPostProcess),effect.setFloat("screen_width",_this._scene.getEngine().getRenderWidth()),effect.setFloat("screen_height",_this._scene.getEngine().getRenderHeight())}},LensRenderingPipeline.prototype._createDepthOfFieldPostProcess=function(ratio){var _this=this;this._depthOfFieldPostProcess=new BABYLON.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],ratio,null,BABYLON.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(effect){effect.setTexture("depthSampler",_this._depthTexture),effect.setTexture("grainSampler",_this._grainTexture),effect.setTextureFromPostProcess("textureSampler",_this._highlightsPostProcess),effect.setTextureFromPostProcess("highlightsSampler",_this._depthOfFieldPostProcess),effect.setFloat("grain_amount",_this._grainAmount),effect.setBool("blur_noise",_this._blurNoise),effect.setFloat("screen_width",_this._scene.getEngine().getRenderWidth()),effect.setFloat("screen_height",_this._scene.getEngine().getRenderHeight()),effect.setFloat("distortion",_this._distortion),effect.setBool("dof_enabled",-1!==_this._dofDistance),effect.setFloat("screen_distance",1/(.1-1/_this._dofDistance)),effect.setFloat("aperture",_this._dofAperture),effect.setFloat("darken",_this._dofDarken),effect.setFloat("edge_blur",_this._edgeBlur),effect.setBool("highlights",-1!==_this._highlightsGain),_this._scene.activeCamera&&(effect.setFloat("near",_this._scene.activeCamera.minZ),effect.setFloat("far",_this._scene.activeCamera.maxZ))}},LensRenderingPipeline.prototype._createGrainTexture=function(){this._grainTexture=new BABYLON.DynamicTexture("LensNoiseTexture",512,this._scene,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=BABYLON.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=BABYLON.Texture.WRAP_ADDRESSMODE;for(var value,context=this._grainTexture.getContext(),x=0;x<512;x++)for(var y=0;y<512;y++)value=Math.floor(255*function(min,max){return Math.random()*(max-min)+min}(.42,.58)),context.fillStyle="rgb("+value+", "+value+", "+value+")",context.fillRect(x,y,1,1);this._grainTexture.update(!1)},LensRenderingPipeline}(BABYLON.PostProcessRenderPipeline);BABYLON.LensRenderingPipeline=LensRenderingPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var StandardRenderingPipeline=function(_super){function StandardRenderingPipeline(name,scene,ratio,originalPostProcess,cameras){void 0===originalPostProcess&&(originalPostProcess=null);var _this=_super.call(this,scene.getEngine(),name)||this;return _this.downSampleX4PostProcess=null,_this.brightPassPostProcess=null,_this.blurHPostProcesses=[],_this.blurVPostProcesses=[],_this.textureAdderPostProcess=null,_this.volumetricLightPostProcess=null,_this.volumetricLightSmoothXPostProcess=null,_this.volumetricLightSmoothYPostProcess=null,_this.volumetricLightMergePostProces=null,_this.volumetricLightFinalPostProcess=null,_this.luminancePostProcess=null,_this.luminanceDownSamplePostProcesses=[],_this.hdrPostProcess=null,_this.textureAdderFinalPostProcess=null,_this.lensFlareFinalPostProcess=null,_this.hdrFinalPostProcess=null,_this.lensFlarePostProcess=null,_this.lensFlareComposePostProcess=null,_this.motionBlurPostProcess=null,_this.depthOfFieldPostProcess=null,_this.brightThreshold=1,_this.blurWidth=512,_this.horizontalBlur=!1,_this.exposure=1,_this.lensTexture=null,_this.volumetricLightCoefficient=.2,_this.volumetricLightPower=4,_this.volumetricLightBlurScale=64,_this.sourceLight=null,_this.hdrMinimumLuminance=1,_this.hdrDecreaseRate=.5,_this.hdrIncreaseRate=.5,_this.lensColorTexture=null,_this.lensFlareStrength=20,_this.lensFlareGhostDispersal=1.4,_this.lensFlareHaloWidth=.7,_this.lensFlareDistortionStrength=16,_this.lensStarTexture=null,_this.lensFlareDirtTexture=null,_this.depthOfFieldDistance=10,_this.depthOfFieldBlurWidth=64,_this.motionStrength=1,_this.animations=[],_this._currentDepthOfFieldSource=null,_this._hdrCurrentLuminance=1,_this._bloomEnabled=!0,_this._depthOfFieldEnabled=!1,_this._vlsEnabled=!1,_this._lensFlareEnabled=!1,_this._hdrEnabled=!1,_this._motionBlurEnabled=!1,_this._motionBlurSamples=64,_this._volumetricLightStepsCount=50,_this._cameras=cameras||[],_this._scene=scene,_this._basePostProcess=originalPostProcess,_this._ratio=ratio,_this._floatTextureType=scene.getEngine().getCaps().textureFloatRender?BABYLON.Engine.TEXTURETYPE_FLOAT:BABYLON.Engine.TEXTURETYPE_HALF_FLOAT,scene.postProcessRenderPipelineManager.addPipeline(_this),_this._buildPipeline(),_this}return __extends(StandardRenderingPipeline,_super),Object.defineProperty(StandardRenderingPipeline.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(enabled){this._bloomEnabled!==enabled&&(this._bloomEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(enabled){this._depthOfFieldEnabled!==enabled&&(this._depthOfFieldEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(enabled){this._lensFlareEnabled!==enabled&&(this._lensFlareEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(enabled){this._hdrEnabled!==enabled&&(this._hdrEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(enabled){this._vlsEnabled!==enabled&&(!enabled||this._scene.enableGeometryBufferRenderer()?(this._vlsEnabled=enabled,this._buildPipeline()):BABYLON.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline"))},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(enabled){this._motionBlurEnabled!==enabled&&(this._motionBlurEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(count){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+count.toFixed(1)),this._volumetricLightStepsCount=count},enumerable:!0,configurable:!0}),Object.defineProperty(StandardRenderingPipeline.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(samples){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+samples.toFixed(1)),this._motionBlurSamples=samples},enumerable:!0,configurable:!0}),StandardRenderingPipeline.prototype._buildPipeline=function(){var _this=this,ratio=this._ratio,scene=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new BABYLON.PostProcess("HDRPass","standard",[],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(effect){_this._currentDepthOfFieldSource=_this.originalPostProcess}),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRPassPostProcess",function(){return _this.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._vlsEnabled&&(this._createVolumetricLightPostProcess(scene,ratio),this.volumetricLightFinalPostProcess=new BABYLON.PostProcess("HDRVLSFinal","standard",[],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define PASS_POST_PROCESS",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRVLSFinal",function(){return _this.volumetricLightFinalPostProcess},!0))),this._bloomEnabled&&(this._createDownSampleX4PostProcess(scene,ratio/2),this._createBrightPassPostProcess(scene,ratio/2),this._createBlurPostProcesses(scene,ratio/4,1),this._createTextureAdderPostProcess(scene,ratio),this.textureAdderFinalPostProcess=new BABYLON.PostProcess("HDRDepthOfFieldSource","standard",[],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define PASS_POST_PROCESS",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRBaseDepthOfFieldSource",function(){return _this.textureAdderFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(scene,ratio),this.lensFlareFinalPostProcess=new BABYLON.PostProcess("HDRPostLensFlareDepthOfFieldSource","standard",[],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define PASS_POST_PROCESS",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return _this.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(scene,this._floatTextureType),this._createHdrPostProcess(scene,ratio),this.hdrFinalPostProcess=new BABYLON.PostProcess("HDRPostHDReDepthOfFieldSource","standard",[],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define PASS_POST_PROCESS",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return _this.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(scene,ratio/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(scene,ratio)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(scene,ratio),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras)},StandardRenderingPipeline.prototype._createDownSampleX4PostProcess=function(scene,ratio){var _this=this,downSampleX4Offsets=new Array(32);this.downSampleX4PostProcess=new BABYLON.PostProcess("HDRDownSampleX4","standard",["dsOffsets"],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define DOWN_SAMPLE_X4",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(effect){for(var id=0,width=_this.downSampleX4PostProcess.width,height=_this.downSampleX4PostProcess.height,i=-2;i<2;i++)for(var j=-2;j<2;j++)downSampleX4Offsets[id]=(i+.5)*(1/width),downSampleX4Offsets[id+1]=(j+.5)*(1/height),id+=2;effect.setArray2("dsOffsets",downSampleX4Offsets)},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRDownSampleX4",function(){return _this.downSampleX4PostProcess},!0))},StandardRenderingPipeline.prototype._createBrightPassPostProcess=function(scene,ratio){var _this=this,brightOffsets=new Array(8);this.brightPassPostProcess=new BABYLON.PostProcess("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define BRIGHT_PASS",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(effect){var sU=1/_this.brightPassPostProcess.width,sV=1/_this.brightPassPostProcess.height;brightOffsets[0]=-.5*sU,brightOffsets[1]=.5*sV,brightOffsets[2]=.5*sU,brightOffsets[3]=.5*sV,brightOffsets[4]=-.5*sU,brightOffsets[5]=-.5*sV,brightOffsets[6]=.5*sU,brightOffsets[7]=-.5*sV,effect.setArray2("dsOffsets",brightOffsets),effect.setFloat("brightThreshold",_this.brightThreshold)},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRBrightPass",function(){return _this.brightPassPostProcess},!0))},StandardRenderingPipeline.prototype._createBlurPostProcesses=function(scene,ratio,indice,blurWidthKey){var _this=this;void 0===blurWidthKey&&(blurWidthKey="blurWidth");var engine=scene.getEngine(),blurX=new BABYLON.BlurPostProcess("HDRBlurH_"+indice,new BABYLON.Vector2(1,0),this[blurWidthKey],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),blurY=new BABYLON.BlurPostProcess("HDRBlurV_"+indice,new BABYLON.Vector2(0,1),this[blurWidthKey],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);blurX.onActivateObservable.add(function(){var dw=blurX.width/engine.getRenderWidth();blurX.kernel=_this[blurWidthKey]*dw}),blurY.onActivateObservable.add(function(){var dw=blurY.height/engine.getRenderHeight();blurY.kernel=_this.horizontalBlur?64*dw:_this[blurWidthKey]*dw}),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRBlurH"+indice,function(){return blurX},!0)),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRBlurV"+indice,function(){return blurY},!0)),this.blurHPostProcesses.push(blurX),this.blurVPostProcesses.push(blurY)},StandardRenderingPipeline.prototype._createTextureAdderPostProcess=function(scene,ratio){var _this=this;this.textureAdderPostProcess=new BABYLON.PostProcess("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define TEXTURE_ADDER",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(effect){effect.setTextureFromPostProcess("otherSampler",_this._vlsEnabled?_this._currentDepthOfFieldSource:_this.originalPostProcess),effect.setTexture("lensSampler",_this.lensTexture),effect.setFloat("exposure",_this.exposure),_this._currentDepthOfFieldSource=_this.textureAdderFinalPostProcess},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRTextureAdder",function(){return _this.textureAdderPostProcess},!0))},StandardRenderingPipeline.prototype._createVolumetricLightPostProcess=function(scene,ratio){var _this=this,geometryRenderer=scene.enableGeometryBufferRenderer();geometryRenderer.enablePosition=!0;var geometry=geometryRenderer.getGBuffer();this.volumetricLightPostProcess=new BABYLON.PostProcess("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],ratio/8,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var depthValues=BABYLON.Vector2.Zero();this.volumetricLightPostProcess.onApply=function(effect){if(_this.sourceLight&&_this.sourceLight.getShadowGenerator()&&_this._scene.activeCamera){var generator=_this.sourceLight.getShadowGenerator();effect.setTexture("shadowMapSampler",generator.getShadowMap()),effect.setTexture("positionSampler",geometry.textures[2]),effect.setColor3("sunColor",_this.sourceLight.diffuse),effect.setVector3("sunDirection",_this.sourceLight.getShadowDirection()),effect.setVector3("cameraPosition",_this._scene.activeCamera.globalPosition),effect.setMatrix("shadowViewProjection",generator.getTransformMatrix()),effect.setFloat("scatteringCoefficient",_this.volumetricLightCoefficient),effect.setFloat("scatteringPower",_this.volumetricLightPower),depthValues.x=generator.getLight().getDepthMinZ(_this._scene.activeCamera),depthValues.y=generator.getLight().getDepthMaxZ(_this._scene.activeCamera),effect.setVector2("depthValues",depthValues)}},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRVLS",function(){return _this.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(scene,ratio/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new BABYLON.PostProcess("HDRVLSMerge","standard",[],["originalSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(effect){effect.setTextureFromPostProcess("originalSampler",_this.originalPostProcess),_this._currentDepthOfFieldSource=_this.volumetricLightFinalPostProcess},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRVLSMerge",function(){return _this.volumetricLightMergePostProces},!0))},StandardRenderingPipeline.prototype._createLuminancePostProcesses=function(scene,textureType){var _this=this,size=Math.pow(3,StandardRenderingPipeline.LuminanceSteps);this.luminancePostProcess=new BABYLON.PostProcess("HDRLuminance","standard",["lumOffsets"],[],{width:size,height:size},null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define LUMINANCE",textureType);var offsets=[];this.luminancePostProcess.onApply=function(effect){var sU=1/_this.luminancePostProcess.width,sV=1/_this.luminancePostProcess.height;offsets[0]=-.5*sU,offsets[1]=.5*sV,offsets[2]=.5*sU,offsets[3]=.5*sV,offsets[4]=-.5*sU,offsets[5]=-.5*sV,offsets[6]=.5*sU,offsets[7]=-.5*sV,effect.setArray2("lumOffsets",offsets)},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRLuminance",function(){return _this.luminancePostProcess},!0));for(var i=StandardRenderingPipeline.LuminanceSteps-1;i>=0;i--){var size=Math.pow(3,i),defines="#define LUMINANCE_DOWN_SAMPLE\n";0===i&&(defines+="#define FINAL_DOWN_SAMPLER");var postProcess=new BABYLON.PostProcess("HDRLuminanceDownSample"+i,"standard",["dsOffsets","halfDestPixelSize"],[],{width:size,height:size},null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,defines,textureType);this.luminanceDownSamplePostProcesses.push(postProcess)}var lastLuminance=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(pp,index){var downSampleOffsets=new Array(18);pp.onApply=function(effect){if(lastLuminance){for(var id=0,x=-1;x<2;x++)for(var y=-1;y<2;y++)downSampleOffsets[id]=x/lastLuminance.width,downSampleOffsets[id+1]=y/lastLuminance.height,id+=2;effect.setArray2("dsOffsets",downSampleOffsets),effect.setFloat("halfDestPixelSize",.5/lastLuminance.width),lastLuminance=index===_this.luminanceDownSamplePostProcesses.length-1?_this.luminancePostProcess:pp}},index===_this.luminanceDownSamplePostProcesses.length-1&&(pp.onAfterRender=function(effect){var pixel=scene.getEngine().readPixels(0,0,1,1),bit_shift=new BABYLON.Vector4(1/16581375,1/65025,1/255,1);_this._hdrCurrentLuminance=(pixel[0]*bit_shift.x+pixel[1]*bit_shift.y+pixel[2]*bit_shift.z+pixel[3]*bit_shift.w)/100}),_this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRLuminanceDownSample"+index,function(){return pp},!0))})},StandardRenderingPipeline.prototype._createHdrPostProcess=function(scene,ratio){var _this=this;this.hdrPostProcess=new BABYLON.PostProcess("HDR","standard",["averageLuminance"],["textureAdderSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define HDR",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var outputLiminance=1,time=0,lastTime=0;this.hdrPostProcess.onApply=function(effect){if(effect.setTextureFromPostProcess("textureAdderSampler",_this._currentDepthOfFieldSource),time+=scene.getEngine().getDeltaTime(),outputLiminance<0)outputLiminance=_this._hdrCurrentLuminance;else{var dt=(lastTime-time)/1e3;_this._hdrCurrentLuminance<outputLiminance+_this.hdrDecreaseRate*dt?outputLiminance+=_this.hdrDecreaseRate*dt:_this._hdrCurrentLuminance>outputLiminance-_this.hdrIncreaseRate*dt?outputLiminance-=_this.hdrIncreaseRate*dt:outputLiminance=_this._hdrCurrentLuminance}outputLiminance=BABYLON.Scalar.Clamp(outputLiminance,_this.hdrMinimumLuminance,1e20),effect.setFloat("averageLuminance",outputLiminance),lastTime=time,_this._currentDepthOfFieldSource=_this.hdrFinalPostProcess},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDR",function(){return _this.hdrPostProcess},!0))},StandardRenderingPipeline.prototype._createLensFlarePostProcess=function(scene,ratio){var _this=this;this.lensFlarePostProcess=new BABYLON.PostProcess("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],ratio/2,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define LENS_FLARE",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRLensFlare",function(){return _this.lensFlarePostProcess},!0)),this._createBlurPostProcesses(scene,ratio/4,2),this.lensFlareComposePostProcess=new BABYLON.PostProcess("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define LENS_FLARE_COMPOSE",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRLensFlareCompose",function(){return _this.lensFlareComposePostProcess},!0));var resolution=new BABYLON.Vector2(0,0);this.lensFlarePostProcess.onApply=function(effect){effect.setTextureFromPostProcess("textureSampler",_this._bloomEnabled?_this.blurHPostProcesses[0]:_this.originalPostProcess),effect.setTexture("lensColorSampler",_this.lensColorTexture),effect.setFloat("strength",_this.lensFlareStrength),effect.setFloat("ghostDispersal",_this.lensFlareGhostDispersal),effect.setFloat("haloWidth",_this.lensFlareHaloWidth),resolution.x=_this.lensFlarePostProcess.width,resolution.y=_this.lensFlarePostProcess.height,effect.setVector2("resolution",resolution),effect.setFloat("distortionStrength",_this.lensFlareDistortionStrength)};var scaleBias1=BABYLON.Matrix.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),scaleBias2=BABYLON.Matrix.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(effect){if(_this._scene.activeCamera){effect.setTextureFromPostProcess("otherSampler",_this._currentDepthOfFieldSource),effect.setTexture("lensDirtSampler",_this.lensFlareDirtTexture),effect.setTexture("lensStarSampler",_this.lensStarTexture);var camerax=_this._scene.activeCamera.getViewMatrix().getRow(0),cameraz=_this._scene.activeCamera.getViewMatrix().getRow(2),camRot=BABYLON.Vector3.Dot(camerax.toVector3(),new BABYLON.Vector3(1,0,0))+BABYLON.Vector3.Dot(cameraz.toVector3(),new BABYLON.Vector3(0,0,1));camRot*=4;var starRotation=BABYLON.Matrix.FromValues(.5*Math.cos(camRot),-Math.sin(camRot),0,0,Math.sin(camRot),.5*Math.cos(camRot),0,0,0,0,1,0,0,0,0,1),lensStarMatrix=scaleBias2.multiply(starRotation).multiply(scaleBias1);effect.setMatrix("lensStarMatrix",lensStarMatrix),_this._currentDepthOfFieldSource=_this.lensFlareFinalPostProcess}}},StandardRenderingPipeline.prototype._createDepthOfFieldPostProcess=function(scene,ratio){var _this=this;this.depthOfFieldPostProcess=new BABYLON.PostProcess("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define DEPTH_OF_FIELD",BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(effect){effect.setTextureFromPostProcess("otherSampler",_this._currentDepthOfFieldSource),effect.setTexture("depthSampler",_this._getDepthTexture()),effect.setFloat("distance",_this.depthOfFieldDistance)},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRDepthOfField",function(){return _this.depthOfFieldPostProcess},!0))},StandardRenderingPipeline.prototype._createMotionBlurPostProcess=function(scene,ratio){var _this=this;this.motionBlurPostProcess=new BABYLON.PostProcess("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],ratio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,scene.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var motionScale=0,prevViewProjection=BABYLON.Matrix.Identity(),invViewProjection=BABYLON.Matrix.Identity(),viewProjection=BABYLON.Matrix.Identity(),screenSize=BABYLON.Vector2.Zero();this.motionBlurPostProcess.onApply=function(effect){(viewProjection=scene.getProjectionMatrix().multiply(scene.getViewMatrix())).invertToRef(invViewProjection),effect.setMatrix("inverseViewProjection",invViewProjection),effect.setMatrix("prevViewProjection",prevViewProjection),prevViewProjection=viewProjection,screenSize.x=_this.motionBlurPostProcess.width,screenSize.y=_this.motionBlurPostProcess.height,effect.setVector2("screenSize",screenSize),motionScale=scene.getEngine().getFps()/60,effect.setFloat("motionScale",motionScale),effect.setFloat("motionStrength",_this.motionStrength),effect.setTexture("depthSampler",_this._getDepthTexture())},this.addEffect(new BABYLON.PostProcessRenderEffect(scene.getEngine(),"HDRMotionBlur",function(){return _this.motionBlurPostProcess},!0))},StandardRenderingPipeline.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},StandardRenderingPipeline.prototype._disposePostProcesses=function(){for(var i=0;i<this._cameras.length;i++){var camera=this._cameras[i];this.originalPostProcess&&this.originalPostProcess.dispose(camera),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(camera),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(camera),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(camera),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(camera),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(camera),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(camera),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(camera),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(camera),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(camera),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(camera),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(camera);for(j=0;j<this.luminanceDownSamplePostProcesses.length;j++)this.luminanceDownSamplePostProcesses[j].dispose(camera);this.luminancePostProcess&&this.luminancePostProcess.dispose(camera),this.hdrPostProcess&&this.hdrPostProcess.dispose(camera),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(camera),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(camera),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(camera);for(j=0;j<this.blurHPostProcesses.length;j++)this.blurHPostProcesses[j].dispose(camera);for(var j=0;j<this.blurVPostProcesses.length;j++)this.blurVPostProcesses[j].dispose(camera)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},StandardRenderingPipeline.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),_super.prototype.dispose.call(this)},StandardRenderingPipeline.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="StandardRenderingPipeline",serializationObject},StandardRenderingPipeline.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new StandardRenderingPipeline(source._name,scene,source._ratio)},source,scene,rootUrl)},StandardRenderingPipeline.LuminanceSteps=6,__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"brightThreshold",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"blurWidth",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"horizontalBlur",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"exposure",void 0),__decorate([BABYLON.serializeAsTexture("lensTexture")],StandardRenderingPipeline.prototype,"lensTexture",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"volumetricLightCoefficient",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"volumetricLightPower",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"volumetricLightBlurScale",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"hdrMinimumLuminance",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"hdrDecreaseRate",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"hdrIncreaseRate",void 0),__decorate([BABYLON.serializeAsTexture("lensColorTexture")],StandardRenderingPipeline.prototype,"lensColorTexture",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"lensFlareStrength",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"lensFlareGhostDispersal",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"lensFlareHaloWidth",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"lensFlareDistortionStrength",void 0),__decorate([BABYLON.serializeAsTexture("lensStarTexture")],StandardRenderingPipeline.prototype,"lensStarTexture",void 0),__decorate([BABYLON.serializeAsTexture("lensFlareDirtTexture")],StandardRenderingPipeline.prototype,"lensFlareDirtTexture",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"depthOfFieldDistance",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"depthOfFieldBlurWidth",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"motionStrength",void 0),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"BloomEnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"DepthOfFieldEnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"LensFlareEnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"HDREnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"VLSEnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"MotionBlurEnabled",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"volumetricLightStepsCount",null),__decorate([BABYLON.serialize()],StandardRenderingPipeline.prototype,"motionBlurSamples",null),StandardRenderingPipeline}(BABYLON.PostProcessRenderPipeline);BABYLON.StandardRenderingPipeline=StandardRenderingPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var FxaaPostProcess=function(_super){function FxaaPostProcess(name,options,camera,samplingMode,engine,reusable,textureType){void 0===camera&&(camera=null),void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var _this=_super.call(this,name,"fxaa",["texelSize"],null,options,camera,samplingMode||BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,reusable,null,textureType,"fxaa")||this;return _this.onApplyObservable.add(function(effect){var texelSize=_this.texelSize;effect.setFloat2("texelSize",texelSize.x,texelSize.y)}),_this}return __extends(FxaaPostProcess,_super),FxaaPostProcess}(BABYLON.PostProcess);BABYLON.FxaaPostProcess=FxaaPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var DefaultRenderingPipeline=function(_super){function DefaultRenderingPipeline(name,hdr,scene,cameras,automaticBuild){void 0===automaticBuild&&(automaticBuild=!0);var _this=_super.call(this,scene.getEngine(),name)||this;_this.PassPostProcessId="PassPostProcessEffect",_this.HighLightsPostProcessId="HighLightsPostProcessEffect",_this.BlurXPostProcessId="BlurXPostProcessEffect",_this.BlurYPostProcessId="BlurYPostProcessEffect",_this.CopyBackPostProcessId="CopyBackPostProcessEffect",_this.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",_this.FxaaPostProcessId="FxaaPostProcessEffect",_this.FinalMergePostProcessId="FinalMergePostProcessEffect",_this.animations=[],_this._bloomEnabled=!1,_this._fxaaEnabled=!1,_this._imageProcessingEnabled=!0,_this._bloomScale=.6,_this._buildAllowed=!0,_this.bloomKernel=64,_this._bloomWeight=.15,_this._cameras=cameras||[],_this._buildAllowed=automaticBuild,_this._scene=scene;var caps=_this._scene.getEngine().getCaps();return _this._hdr=hdr&&(caps.textureHalfFloatRender||caps.textureFloatRender),_this._hdr?caps.textureHalfFloatRender?_this._defaultPipelineTextureType=BABYLON.Engine.TEXTURETYPE_HALF_FLOAT:caps.textureFloatRender&&(_this._defaultPipelineTextureType=BABYLON.Engine.TEXTURETYPE_FLOAT):_this._defaultPipelineTextureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,scene.postProcessRenderPipelineManager.addPipeline(_this),_this._buildPipeline(),_this}return __extends(DefaultRenderingPipeline,_super),Object.defineProperty(DefaultRenderingPipeline.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(value){this._bloomWeight!==value&&(this._bloomWeight=value,this._hdr&&this.copyBack&&(this.copyBack.alphaConstants=new BABYLON.Color4(value,value,value,value)))},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultRenderingPipeline.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(value){this._bloomScale!==value&&(this._bloomScale=value,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultRenderingPipeline.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(enabled){this._bloomEnabled!==enabled&&(this._bloomEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultRenderingPipeline.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(enabled){this._fxaaEnabled!==enabled&&(this._fxaaEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultRenderingPipeline.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(enabled){this._imageProcessingEnabled!==enabled&&(this._imageProcessingEnabled=enabled,this._buildPipeline())},enumerable:!0,configurable:!0}),DefaultRenderingPipeline.prototype.prepare=function(){var previousState=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=previousState},DefaultRenderingPipeline.prototype._buildPipeline=function(){var _this=this;if(this._buildAllowed){var engine=this._scene.getEngine();if(this._disposePostProcesses(),this._reset(),this.bloomEnabled){if(this.pass=new BABYLON.PassPostProcess("sceneRenderTarget",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.PassPostProcessId,function(){return _this.pass},!0)),this._hdr||(this.highlights=new BABYLON.HighlightsPostProcess("highlights",this.bloomScale,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.HighLightsPostProcessId,function(){return _this.highlights},!0)),this.highlights.autoClear=!1,this.highlights.alwaysForcePOT=!0),this.blurX=new BABYLON.BlurPostProcess("horizontal blur",new BABYLON.Vector2(1,0),10,this.bloomScale,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.BlurXPostProcessId,function(){return _this.blurX},!0)),this.blurX.alwaysForcePOT=!0,this.blurX.autoClear=!1,this.blurX.onActivateObservable.add(function(){var dw=_this.blurX.width/engine.getRenderWidth(!0);_this.blurX.kernel=_this.bloomKernel*dw}),this.blurY=new BABYLON.BlurPostProcess("vertical blur",new BABYLON.Vector2(0,1),10,this.bloomScale,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.BlurYPostProcessId,function(){return _this.blurY},!0)),this.blurY.alwaysForcePOT=!0,this.blurY.autoClear=!1,this.blurY.onActivateObservable.add(function(){var dh=_this.blurY.height/engine.getRenderHeight(!0);_this.blurY.kernel=_this.bloomKernel*dh}),this.copyBack=new BABYLON.PassPostProcess("bloomBlendBlit",this.bloomScale,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.CopyBackPostProcessId,function(){return _this.copyBack},!0)),this.copyBack.alwaysForcePOT=!0,this._hdr){this.copyBack.alphaMode=BABYLON.Engine.ALPHA_INTERPOLATE;var w=this.bloomWeight;this.copyBack.alphaConstants=new BABYLON.Color4(w,w,w,w)}else this.copyBack.alphaMode=BABYLON.Engine.ALPHA_SCREENMODE;this.copyBack.autoClear=!1}this._imageProcessingEnabled&&(this.imageProcessing=new BABYLON.ImageProcessingPostProcess("imageProcessing",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this._hdr?this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.ImageProcessingPostProcessId,function(){return _this.imageProcessing},!0)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.fxaaEnabled?(this.fxaa=new BABYLON.FxaaPostProcess("fxaa",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.FxaaPostProcessId,function(){return _this.fxaa},!0)),this.fxaa.autoClear=!(this.bloomEnabled||this._hdr&&this.imageProcessing)):this._hdr&&this.imageProcessing?this.finalMerge=this.imageProcessing:(this.finalMerge=new BABYLON.PassPostProcess("finalMerge",1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,engine,!1,this._defaultPipelineTextureType),this.addEffect(new BABYLON.PostProcessRenderEffect(engine,this.FinalMergePostProcessId,function(){return _this.finalMerge},!0)),this.finalMerge.autoClear=!(this.bloomEnabled||this._hdr&&this.imageProcessing)),this.bloomEnabled&&(this._hdr?(this.copyBack.shareOutputWith(this.blurX),this.imageProcessing?(this.imageProcessing.shareOutputWith(this.pass),this.imageProcessing.autoClear=!1):this.fxaa?this.fxaa.shareOutputWith(this.pass):this.finalMerge.shareOutputWith(this.pass)):this.fxaa?this.fxaa.shareOutputWith(this.pass):this.finalMerge.shareOutputWith(this.pass)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras)}},DefaultRenderingPipeline.prototype._disposePostProcesses=function(){for(var i=0;i<this._cameras.length;i++){var camera=this._cameras[i];this.pass&&this.pass.dispose(camera),this.highlights&&this.highlights.dispose(camera),this.blurX&&this.blurX.dispose(camera),this.blurY&&this.blurY.dispose(camera),this.copyBack&&this.copyBack.dispose(camera),this.imageProcessing&&this.imageProcessing.dispose(camera),this.fxaa&&this.fxaa.dispose(camera),this.finalMerge&&this.finalMerge.dispose(camera)}this.pass=null,this.highlights=null,this.blurX=null,this.blurY=null,this.copyBack=null,this.imageProcessing=null,this.fxaa=null,this.finalMerge=null},DefaultRenderingPipeline.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),_super.prototype.dispose.call(this)},DefaultRenderingPipeline.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="DefaultRenderingPipeline",serializationObject},DefaultRenderingPipeline.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new DefaultRenderingPipeline(source._name,source._name._hdr,scene)},source,scene,rootUrl)},__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"bloomKernel",void 0),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"_bloomWeight",void 0),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"_hdr",void 0),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"bloomWeight",null),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"bloomScale",null),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"bloomEnabled",null),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"fxaaEnabled",null),__decorate([BABYLON.serialize()],DefaultRenderingPipeline.prototype,"imageProcessingEnabled",null),DefaultRenderingPipeline}(BABYLON.PostProcessRenderPipeline);BABYLON.DefaultRenderingPipeline=DefaultRenderingPipeline}(BABYLON||(BABYLON={}));!function(BABYLON){var GeometryBufferRenderer=function(){function GeometryBufferRenderer(scene,ratio){void 0===ratio&&(ratio=1),this._enablePosition=!1,this._scene=scene,this._ratio=ratio,this._createRenderTargets()}return Object.defineProperty(GeometryBufferRenderer.prototype,"renderList",{set:function(meshes){this._multiRenderTarget.renderList=meshes},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryBufferRenderer.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryBufferRenderer.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(enable){this._enablePosition=enable,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),GeometryBufferRenderer.prototype.isReady=function(subMesh,useInstances){var material=subMesh.getMaterial();if(material&&material.disableDepthWrite)return!1;var defines=[],attribs=[BABYLON.VertexBuffer.PositionKind,BABYLON.VertexBuffer.NormalKind],mesh=subMesh.getMesh();material&&material.needAlphaTesting()&&(defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2"))),this._enablePosition&&defines.push("#define POSITION"),mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._effect=this._scene.getEngine().createEffect("geometry",attribs,["world","mBones","viewProjection","diffuseMatrix","view"],["diffuseSampler"],join,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},GeometryBufferRenderer.prototype.getGBuffer=function(){return this._multiRenderTarget},GeometryBufferRenderer.prototype.dispose=function(){this.getGBuffer().dispose()},GeometryBufferRenderer.prototype._createRenderTargets=function(){var _this=this,engine=this._scene.getEngine(),count=this._enablePosition?3:2;if(this._multiRenderTarget=new BABYLON.MultiRenderTarget("gBuffer",{width:engine.getRenderWidth()*this._ratio,height:engine.getRenderHeight()*this._ratio},count,this._scene,{generateMipMaps:!1,generateDepthTexture:!0}),this.isSupported){this._multiRenderTarget.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(engine){engine.clear(new BABYLON.Color4(0,0,0,1),!0,!0,!0)});var renderSubMesh=function(subMesh){var mesh=subMesh.getRenderingMesh(),scene=_this._scene,engine=scene.getEngine(),material=subMesh.getMaterial();if(material){engine.setState(material.backFaceCulling);var batch=mesh._getInstancesRenderList(subMesh._id);if(!batch.mustReturn){var hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id];if(_this.isReady(subMesh,hardwareInstancedRendering)){if(engine.enableEffect(_this._effect),mesh._bind(subMesh,_this._effect,BABYLON.Material.TriangleFillMode),_this._effect.setMatrix("viewProjection",scene.getTransformMatrix()),_this._effect.setMatrix("view",scene.getViewMatrix()),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(_this._effect.setTexture("diffuseSampler",alphaTexture),_this._effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix()))}mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton&&_this._effect.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh)),mesh._processRendering(subMesh,_this._effect,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){return _this._effect.setMatrix("world",world)})}}}};this._multiRenderTarget.customRenderFunction=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index;if(depthOnlySubMeshes.length){for(engine.setColorWrite(!1),index=0;index<depthOnlySubMeshes.length;index++)renderSubMesh(depthOnlySubMeshes.data[index]);engine.setColorWrite(!0)}for(index=0;index<opaqueSubMeshes.length;index++)renderSubMesh(opaqueSubMeshes.data[index]);for(index=0;index<alphaTestSubMeshes.length;index++)renderSubMesh(alphaTestSubMeshes.data[index])}}},GeometryBufferRenderer}();BABYLON.GeometryBufferRenderer=GeometryBufferRenderer}(BABYLON||(BABYLON={}));!function(BABYLON){var RefractionPostProcess=function(_super){function RefractionPostProcess(name,refractionTextureUrl,color,depth,colorLevel,options,camera,samplingMode,engine,reusable){var _this=_super.call(this,name,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],options,camera,samplingMode,engine,reusable)||this;return _this.color=color,_this.depth=depth,_this.colorLevel=colorLevel,_this.onActivateObservable.add(function(cam){_this._refRexture=_this._refRexture||new BABYLON.Texture(refractionTextureUrl,cam.getScene())}),_this.onApplyObservable.add(function(effect){effect.setColor3("baseColor",_this.color),effect.setFloat("depth",_this.depth),effect.setFloat("colorLevel",_this.colorLevel),effect.setTexture("refractionSampler",_this._refRexture)}),_this}return __extends(RefractionPostProcess,_super),RefractionPostProcess.prototype.dispose=function(camera){this._refRexture&&this._refRexture.dispose(),_super.prototype.dispose.call(this,camera)},RefractionPostProcess}(BABYLON.PostProcess);BABYLON.RefractionPostProcess=RefractionPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var BlackAndWhitePostProcess=function(_super){function BlackAndWhitePostProcess(name,options,camera,samplingMode,engine,reusable){var _this=_super.call(this,name,"blackAndWhite",["degree"],null,options,camera,samplingMode,engine,reusable)||this;return _this.degree=1,_this.onApplyObservable.add(function(effect){effect.setFloat("degree",_this.degree)}),_this}return __extends(BlackAndWhitePostProcess,_super),BlackAndWhitePostProcess}(BABYLON.PostProcess);BABYLON.BlackAndWhitePostProcess=BlackAndWhitePostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var ConvolutionPostProcess=function(_super){function ConvolutionPostProcess(name,kernel,options,camera,samplingMode,engine,reusable){var _this=_super.call(this,name,"convolution",["kernel","screenSize"],null,options,camera,samplingMode,engine,reusable)||this;return _this.kernel=kernel,_this.onApply=function(effect){effect.setFloat2("screenSize",_this.width,_this.height),effect.setArray("kernel",_this.kernel)},_this}return __extends(ConvolutionPostProcess,_super),ConvolutionPostProcess.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],ConvolutionPostProcess.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],ConvolutionPostProcess.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],ConvolutionPostProcess.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],ConvolutionPostProcess.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],ConvolutionPostProcess.GaussianKernel=[0,1,0,1,1,1,0,1,0],ConvolutionPostProcess}(BABYLON.PostProcess);BABYLON.ConvolutionPostProcess=ConvolutionPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var FilterPostProcess=function(_super){function FilterPostProcess(name,kernelMatrix,options,camera,samplingMode,engine,reusable){var _this=_super.call(this,name,"filter",["kernelMatrix"],null,options,camera,samplingMode,engine,reusable)||this;return _this.kernelMatrix=kernelMatrix,_this.onApply=function(effect){effect.setMatrix("kernelMatrix",_this.kernelMatrix)},_this}return __extends(FilterPostProcess,_super),FilterPostProcess}(BABYLON.PostProcess);BABYLON.FilterPostProcess=FilterPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var VolumetricLightScatteringPostProcess=function(_super){function VolumetricLightScatteringPostProcess(name,ratio,camera,mesh,samples,samplingMode,engine,reusable,scene){void 0===samples&&(samples=100),void 0===samplingMode&&(samplingMode=BABYLON.Texture.BILINEAR_SAMPLINGMODE);var _this=_super.call(this,name,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],ratio.postProcessRatio||ratio,camera,samplingMode,engine,reusable,"#define NUM_SAMPLES "+samples)||this;return _this._screenCoordinates=BABYLON.Vector2.Zero(),_this.customMeshPosition=BABYLON.Vector3.Zero(),_this.useCustomMeshPosition=!1,_this.invert=!0,_this.excludedMeshes=new Array,_this.exposure=.3,_this.decay=.96815,_this.weight=.58767,_this.density=.926,scene=null===camera?scene:camera.getScene(),engine=scene.getEngine(),_this._viewPort=new BABYLON.Viewport(0,0,1,1).toGlobal(engine.getRenderWidth(),engine.getRenderHeight()),_this.mesh=null!==mesh?mesh:VolumetricLightScatteringPostProcess.CreateDefaultMesh("VolumetricLightScatteringMesh",scene),_this._createPass(scene,ratio.passRatio||ratio),_this.onActivate=function(camera){_this.isSupported||_this.dispose(camera),_this.onActivate=null},_this.onApplyObservable.add(function(effect){_this._updateMeshScreenCoordinates(scene),effect.setTexture("lightScatteringSampler",_this._volumetricLightScatteringRTT),effect.setFloat("exposure",_this.exposure),effect.setFloat("decay",_this.decay),effect.setFloat("weight",_this.weight),effect.setFloat("density",_this.density),effect.setVector2("meshPositionOnScreen",_this._screenCoordinates)}),_this}return __extends(VolumetricLightScatteringPostProcess,_super),Object.defineProperty(VolumetricLightScatteringPostProcess.prototype,"useDiffuseColor",{get:function(){return BABYLON.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(useDiffuseColor){BABYLON.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),VolumetricLightScatteringPostProcess.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},VolumetricLightScatteringPostProcess.prototype.isReady=function(subMesh,useInstances){var mesh=subMesh.getMesh();if(mesh===this.mesh&&mesh.material)return mesh.material.isReady(mesh);var defines=[],attribs=[BABYLON.VertexBuffer.PositionKind],material=subMesh.getMaterial();material&&(material.needAlphaTesting()&&defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2"))),mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._volumetricLightScatteringPass=mesh.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},attribs,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],join)),this._volumetricLightScatteringPass.isReady()},VolumetricLightScatteringPostProcess.prototype.setCustomMeshPosition=function(position){this.customMeshPosition=position},VolumetricLightScatteringPostProcess.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},VolumetricLightScatteringPostProcess.prototype.dispose=function(camera){var rttIndex=camera.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==rttIndex&&camera.getScene().customRenderTargets.splice(rttIndex,1),this._volumetricLightScatteringRTT.dispose(),_super.prototype.dispose.call(this,camera)},VolumetricLightScatteringPostProcess.prototype.getPass=function(){return this._volumetricLightScatteringRTT},VolumetricLightScatteringPostProcess.prototype._meshExcluded=function(mesh){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(mesh)},VolumetricLightScatteringPostProcess.prototype._createPass=function(scene,ratio){var _this=this,engine=scene.getEngine();this._volumetricLightScatteringRTT=new BABYLON.RenderTargetTexture("volumetricLightScatteringMap",{width:engine.getRenderWidth()*ratio,height:engine.getRenderHeight()*ratio},scene,!1,!0,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1;var camera=this.getCamera();camera?camera.customRenderTargets.push(this._volumetricLightScatteringRTT):scene.customRenderTargets.push(this._volumetricLightScatteringRTT);var savedSceneClearColor,renderSubMesh=function(subMesh){var mesh=subMesh.getRenderingMesh();if(!_this._meshExcluded(mesh)){var material=subMesh.getMaterial();if(material){var scene=mesh.getScene(),engine=scene.getEngine();engine.setState(material.backFaceCulling);var batch=mesh._getInstancesRenderList(subMesh._id);if(!batch.mustReturn){var hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id];if(_this.isReady(subMesh,hardwareInstancedRendering)){var effect=_this._volumetricLightScatteringPass;if(mesh===_this.mesh&&(effect=subMesh.effect?subMesh.effect:material.getEffect()),engine.enableEffect(effect),mesh._bind(subMesh,effect,BABYLON.Material.TriangleFillMode),mesh===_this.mesh)material.bind(mesh.getWorldMatrix(),mesh);else{if(_this._volumetricLightScatteringPass.setMatrix("viewProjection",scene.getTransformMatrix()),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();_this._volumetricLightScatteringPass.setTexture("diffuseSampler",alphaTexture),alphaTexture&&_this._volumetricLightScatteringPass.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix())}mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton&&_this._volumetricLightScatteringPass.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh))}mesh._processRendering(subMesh,_this._volumetricLightScatteringPass,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){return effect.setMatrix("world",world)})}}}}},sceneClearColor=new BABYLON.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){savedSceneClearColor=scene.clearColor,scene.clearColor=sceneClearColor}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){scene.clearColor=savedSceneClearColor}),this._volumetricLightScatteringRTT.customRenderFunction=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index,engine=scene.getEngine();if(depthOnlySubMeshes.length){for(engine.setColorWrite(!1),index=0;index<depthOnlySubMeshes.length;index++)renderSubMesh(depthOnlySubMeshes.data[index]);engine.setColorWrite(!0)}for(index=0;index<opaqueSubMeshes.length;index++)renderSubMesh(opaqueSubMeshes.data[index]);for(engine.setAlphaTesting(!0),index=0;index<alphaTestSubMeshes.length;index++)renderSubMesh(alphaTestSubMeshes.data[index]);if(engine.setAlphaTesting(!1),transparentSubMeshes.length){for(index=0;index<transparentSubMeshes.length;index++){var submesh=transparentSubMeshes.data[index],boundingInfo=submesh.getBoundingInfo();boundingInfo&&scene.activeCamera&&(submesh._alphaIndex=submesh.getMesh().alphaIndex,submesh._distanceToCamera=boundingInfo.boundingSphere.centerWorld.subtract(scene.activeCamera.position).length())}var sortedArray=transparentSubMeshes.data.slice(0,transparentSubMeshes.length);for(sortedArray.sort(function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<b._alphaIndex?-1:a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0}),engine.setAlphaMode(BABYLON.Engine.ALPHA_COMBINE),index=0;index<sortedArray.length;index++)renderSubMesh(sortedArray[index]);engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE)}}},VolumetricLightScatteringPostProcess.prototype._updateMeshScreenCoordinates=function(scene){var meshPosition,transform=scene.getTransformMatrix();meshPosition=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var pos=BABYLON.Vector3.Project(meshPosition,BABYLON.Matrix.Identity(),transform,this._viewPort);this._screenCoordinates.x=pos.x/this._viewPort.width,this._screenCoordinates.y=pos.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},VolumetricLightScatteringPostProcess.CreateDefaultMesh=function(name,scene){var mesh=BABYLON.Mesh.CreatePlane(name,1,scene);mesh.billboardMode=BABYLON.AbstractMesh.BILLBOARDMODE_ALL;var material=new BABYLON.StandardMaterial(name+"Material",scene);return material.emissiveColor=new BABYLON.Color3(1,1,1),mesh.material=material,mesh},__decorate([BABYLON.serializeAsVector3()],VolumetricLightScatteringPostProcess.prototype,"customMeshPosition",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"useCustomMeshPosition",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"invert",void 0),__decorate([BABYLON.serializeAsMeshReference()],VolumetricLightScatteringPostProcess.prototype,"mesh",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"excludedMeshes",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"exposure",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"decay",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"weight",void 0),__decorate([BABYLON.serialize()],VolumetricLightScatteringPostProcess.prototype,"density",void 0),VolumetricLightScatteringPostProcess}(BABYLON.PostProcess);BABYLON.VolumetricLightScatteringPostProcess=VolumetricLightScatteringPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var ColorCorrectionPostProcess=function(_super){function ColorCorrectionPostProcess(name,colorTableUrl,options,camera,samplingMode,engine,reusable){var _this=_super.call(this,name,"colorCorrection",null,["colorTable"],options,camera,samplingMode,engine,reusable)||this;return _this._colorTableTexture=new BABYLON.Texture(colorTableUrl,camera.getScene(),!0,!1,BABYLON.Texture.TRILINEAR_SAMPLINGMODE),_this._colorTableTexture.anisotropicFilteringLevel=1,_this._colorTableTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,_this._colorTableTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,_this.onApply=function(effect){effect.setTexture("colorTable",_this._colorTableTexture)},_this}return __extends(ColorCorrectionPostProcess,_super),ColorCorrectionPostProcess}(BABYLON.PostProcess);BABYLON.ColorCorrectionPostProcess=ColorCorrectionPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var TonemappingOperator;!function(TonemappingOperator){TonemappingOperator[TonemappingOperator.Hable=0]="Hable",TonemappingOperator[TonemappingOperator.Reinhard=1]="Reinhard",TonemappingOperator[TonemappingOperator.HejiDawson=2]="HejiDawson",TonemappingOperator[TonemappingOperator.Photographic=3]="Photographic"}(TonemappingOperator=BABYLON.TonemappingOperator||(BABYLON.TonemappingOperator={}));var TonemapPostProcess=function(_super){function TonemapPostProcess(name,_operator,exposureAdjustment,camera,samplingMode,engine,textureFormat){void 0===samplingMode&&(samplingMode=BABYLON.Texture.BILINEAR_SAMPLINGMODE),void 0===textureFormat&&(textureFormat=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var _this=_super.call(this,name,"tonemap",["_ExposureAdjustment"],null,1,camera,samplingMode,engine,!0,null,textureFormat)||this;_this._operator=_operator,_this.exposureAdjustment=exposureAdjustment;var defines="#define ";return _this._operator===TonemappingOperator.Hable?defines+="HABLE_TONEMAPPING":_this._operator===TonemappingOperator.Reinhard?defines+="REINHARD_TONEMAPPING":_this._operator===TonemappingOperator.HejiDawson?defines+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":_this._operator===TonemappingOperator.Photographic&&(defines+="PHOTOGRAPHIC_TONEMAPPING"),_this.updateEffect(defines),_this.onApply=function(effect){effect.setFloat("_ExposureAdjustment",_this.exposureAdjustment)},_this}return __extends(TonemapPostProcess,_super),TonemapPostProcess}(BABYLON.PostProcess);BABYLON.TonemapPostProcess=TonemapPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var DisplayPassPostProcess=function(_super){function DisplayPassPostProcess(name,options,camera,samplingMode,engine,reusable){return _super.call(this,name,"displayPass",["passSampler"],["passSampler"],options,camera,samplingMode,engine,reusable)||this}return __extends(DisplayPassPostProcess,_super),DisplayPassPostProcess}(BABYLON.PostProcess);BABYLON.DisplayPassPostProcess=DisplayPassPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var HighlightsPostProcess=function(_super){function HighlightsPostProcess(name,options,camera,samplingMode,engine,reusable,textureType){return void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),_super.call(this,name,"highlights",null,null,options,camera,samplingMode,engine,reusable,null,textureType)||this}return __extends(HighlightsPostProcess,_super),HighlightsPostProcess}(BABYLON.PostProcess);BABYLON.HighlightsPostProcess=HighlightsPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var ImageProcessingPostProcess=function(_super){function ImageProcessingPostProcess(name,options,camera,samplingMode,engine,reusable,textureType,imageProcessingConfiguration){void 0===camera&&(camera=null),void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var _this=_super.call(this,name,"imageProcessing",[],[],options,camera,samplingMode,engine,reusable,null,textureType,"postprocess",null,!0)||this;return _this._fromLinearSpace=!0,_this._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},imageProcessingConfiguration?(imageProcessingConfiguration.applyByPostProcess=!0,_this._attachImageProcessingConfiguration(imageProcessingConfiguration,!0),_this.fromLinearSpace=!1):(_this._attachImageProcessingConfiguration(null,!0),_this.imageProcessingConfiguration.applyByPostProcess=!0),_this.onApply=function(effect){_this.imageProcessingConfiguration.bind(effect,_this.aspectRatio)},_this}return __extends(ImageProcessingPostProcess,_super),Object.defineProperty(ImageProcessingPostProcess.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(value){this._attachImageProcessingConfiguration(value)},enumerable:!0,configurable:!0}),ImageProcessingPostProcess.prototype._attachImageProcessingConfiguration=function(configuration,doNotBuild){var _this=this;if(void 0===doNotBuild&&(doNotBuild=!1),configuration!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),configuration)this._imageProcessingConfiguration=configuration;else{var scene=null,engine=this.getEngine(),camera=this.getCamera();if(camera)scene=camera.getScene();else if(engine&&engine.scenes){var scenes=engine.scenes;scene=scenes[scenes.length-1]}else scene=BABYLON.Engine.LastCreatedScene;this._imageProcessingConfiguration=scene.imageProcessingConfiguration}this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(conf){_this._updateParameters()}),doNotBuild||this._updateParameters()}},Object.defineProperty(ImageProcessingPostProcess.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(value){this.imageProcessingConfiguration.colorCurves=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(value){this.imageProcessingConfiguration.colorCurvesEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(value){this.imageProcessingConfiguration.colorGradingTexture=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(value){this.imageProcessingConfiguration.colorGradingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(value){this.imageProcessingConfiguration.exposure=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(value){this._imageProcessingConfiguration.toneMappingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(value){this.imageProcessingConfiguration.contrast=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(value){this.imageProcessingConfiguration.vignetteStretch=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(value){this.imageProcessingConfiguration.vignetteCentreX=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(value){this.imageProcessingConfiguration.vignetteCentreY=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(value){this.imageProcessingConfiguration.vignetteWeight=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(value){this.imageProcessingConfiguration.vignetteColor=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(value){this.imageProcessingConfiguration.vignetteCameraFov=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(value){this.imageProcessingConfiguration.vignetteBlendMode=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(value){this.imageProcessingConfiguration.vignetteEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(ImageProcessingPostProcess.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(value){this._fromLinearSpace!==value&&(this._fromLinearSpace=value,this._updateParameters())},enumerable:!0,configurable:!0}),ImageProcessingPostProcess.prototype.getClassName=function(){return"ImageProcessingPostProcess"},ImageProcessingPostProcess.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var defines="";for(var define in this._defines)this._defines[define]&&(defines+="#define "+define+";\r\n");var samplers=["textureSampler"];BABYLON.ImageProcessingConfiguration.PrepareSamplers(samplers,this._defines);var uniforms=["scale"];BABYLON.ImageProcessingConfiguration.PrepareUniforms(uniforms,this._defines),this.updateEffect(defines,uniforms,samplers)},ImageProcessingPostProcess.prototype.dispose=function(camera){_super.prototype.dispose.call(this,camera),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this.imageProcessingConfiguration.applyByPostProcess=!1},__decorate([BABYLON.serialize()],ImageProcessingPostProcess.prototype,"_fromLinearSpace",void 0),ImageProcessingPostProcess}(BABYLON.PostProcess);BABYLON.ImageProcessingPostProcess=ImageProcessingPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var BlurPostProcess=function(_super){function BlurPostProcess(name,direction,kernel,options,camera,samplingMode,engine,reusable,textureType){void 0===samplingMode&&(samplingMode=BABYLON.Texture.BILINEAR_SAMPLINGMODE),void 0===textureType&&(textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);var _this=_super.call(this,name,"kernelBlur",["delta","direction"],null,options,camera,samplingMode,engine,reusable,null,textureType,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return _this.direction=direction,_this._packedFloat=!1,_this.onApplyObservable.add(function(effect){effect.setFloat2("delta",1/_this.width*_this.direction.x,1/_this.height*_this.direction.y)}),_this.kernel=kernel,_this}return __extends(BlurPostProcess,_super),Object.defineProperty(BlurPostProcess.prototype,"kernel",{get:function(){return this._idealKernel},set:function(v){this._idealKernel!==v&&(v=Math.max(v,1),this._idealKernel=v,this._kernel=this._nearestBestKernel(v),this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(BlurPostProcess.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(v){this._packedFloat!==v&&(this._packedFloat=v,this._updateParameters())},enumerable:!0,configurable:!0}),BlurPostProcess.prototype._updateParameters=function(){for(var N=this._kernel,centerIndex=(N-1)/2,offsets=[],weights=[],totalWeight=0,i=0;i<N;i++){var u=i/(N-1),w=this._gaussianWeight(2*u-1);offsets[i]=i-centerIndex,weights[i]=w,totalWeight+=w}for(i=0;i<weights.length;i++)weights[i]/=totalWeight;for(var linearSamplingWeights=[],linearSamplingOffsets=[],linearSamplingMap=[],i=0;i<=centerIndex;i+=2){var j=Math.min(i+1,Math.floor(centerIndex));if(i===j)linearSamplingMap.push({o:offsets[i],w:weights[i]});else{var sharedCell=j===centerIndex,weightLinear=weights[i]+weights[j]*(sharedCell?.5:1),offsetLinear=offsets[i]+1/(1+weights[i]/weights[j]);0===offsetLinear?(linearSamplingMap.push({o:offsets[i],w:weights[i]}),linearSamplingMap.push({o:offsets[i+1],w:weights[i+1]})):(linearSamplingMap.push({o:offsetLinear,w:weightLinear}),linearSamplingMap.push({o:-offsetLinear,w:weightLinear}))}}for(i=0;i<linearSamplingMap.length;i++)linearSamplingOffsets[i]=linearSamplingMap[i].o,linearSamplingWeights[i]=linearSamplingMap[i].w;offsets=linearSamplingOffsets,weights=linearSamplingWeights;for(var maxVaryingRows=this.getEngine().getCaps().maxVaryingVectors,freeVaryingVec2=Math.max(maxVaryingRows,0)-1,varyingCount=Math.min(offsets.length,freeVaryingVec2),defines="",i=0;i<varyingCount;i++)defines+="#define KERNEL_OFFSET"+i+" "+this._glslFloat(offsets[i])+"\r\n",defines+="#define KERNEL_WEIGHT"+i+" "+this._glslFloat(weights[i])+"\r\n";for(var depCount=0,i=freeVaryingVec2;i<offsets.length;i++)defines+="#define KERNEL_DEP_OFFSET"+depCount+" "+this._glslFloat(offsets[i])+"\r\n",defines+="#define KERNEL_DEP_WEIGHT"+depCount+" "+this._glslFloat(weights[i])+"\r\n",depCount++;this.packedFloat&&(defines+="#define PACKEDFLOAT 1"),this.updateEffect(defines,null,null,{varyingCount:varyingCount,depCount:depCount})},BlurPostProcess.prototype._nearestBestKernel=function(idealKernel){for(var v=Math.round(idealKernel),_i=0,_a=[v,v-1,v+1,v-2,v+2];_i<_a.length;_i++){var k=_a[_i];if(k%2!=0&&Math.floor(k/2)%2==0&&k>0)return Math.max(k,3)}return Math.max(v,3)},BlurPostProcess.prototype._gaussianWeight=function(x){var exponent=-x*x/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(exponent)},BlurPostProcess.prototype._glslFloat=function(x,decimalFigures){return void 0===decimalFigures&&(decimalFigures=8),x.toFixed(decimalFigures).replace(/0+$/,"")},BlurPostProcess}(BABYLON.PostProcess);BABYLON.BlurPostProcess=BlurPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var Bone=function(_super){function Bone(name,skeleton,parentBone,localMatrix,restPose,baseMatrix,index){void 0===parentBone&&(parentBone=null),void 0===localMatrix&&(localMatrix=null),void 0===restPose&&(restPose=null),void 0===baseMatrix&&(baseMatrix=null),void 0===index&&(index=null);var _this=_super.call(this,name,skeleton.getScene())||this;return _this.name=name,_this.children=new Array,_this.animations=new Array,_this._index=null,_this._worldTransform=new BABYLON.Matrix,_this._absoluteTransform=new BABYLON.Matrix,_this._invertedAbsoluteTransform=new BABYLON.Matrix,_this._scaleMatrix=BABYLON.Matrix.Identity(),_this._scaleVector=BABYLON.Vector3.One(),_this._negateScaleChildren=BABYLON.Vector3.One(),_this._scalingDeterminant=1,_this._skeleton=skeleton,_this._localMatrix=localMatrix||BABYLON.Matrix.Identity(),_this._restPose=restPose||_this._localMatrix.clone(),_this._baseMatrix=baseMatrix||_this._localMatrix.clone(),_this._index=index,_this._frozen=!1,skeleton.bones.push(_this),_this.setParent(parentBone,!1),_this._updateDifferenceMatrix(),_this}return __extends(Bone,_super),Object.defineProperty(Bone.prototype,"_matrix",{get:function(){return this._localMatrix},set:function(val){this._localMatrix?this._localMatrix.copyFrom(val):this._localMatrix=val},enumerable:!0,configurable:!0}),Bone.prototype.getSkeleton=function(){return this._skeleton},Bone.prototype.getParent=function(){return this._parent},Bone.prototype.setParent=function(parent,updateDifferenceMatrix){if(void 0===updateDifferenceMatrix&&(updateDifferenceMatrix=!0),this._parent!==parent){if(this._parent){var index=this._parent.children.indexOf(this);-1!==index&&this._parent.children.splice(index,1)}this._parent=parent,this._parent&&this._parent.children.push(this),updateDifferenceMatrix&&this._updateDifferenceMatrix()}},Bone.prototype.getLocalMatrix=function(){return this._localMatrix},Bone.prototype.getBaseMatrix=function(){return this._baseMatrix},Bone.prototype.getRestPose=function(){return this._restPose},Bone.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},Bone.prototype.getWorldMatrix=function(){return this._worldTransform},Bone.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},Bone.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},Object.defineProperty(Bone.prototype,"position",{get:function(){return this.getPosition()},set:function(newPosition){this.setPosition(newPosition)},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"rotation",{get:function(){return this.getRotation()},set:function(newRotation){this.setRotation(newRotation)},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"rotationQuaternion",{get:function(){return this.getRotationQuaternion()},set:function(newRotation){this.setRotationQuaternion(newRotation)},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"scaling",{get:function(){return this.getScale()},set:function(newScaling){this.setScale(newScaling.x,newScaling.y,newScaling.z)},enumerable:!0,configurable:!0}),Bone.prototype.updateMatrix=function(matrix,updateDifferenceMatrix){void 0===updateDifferenceMatrix&&(updateDifferenceMatrix=!0),this._baseMatrix=matrix.clone(),this._localMatrix=matrix.clone(),this._skeleton._markAsDirty(),updateDifferenceMatrix&&this._updateDifferenceMatrix()},Bone.prototype._updateDifferenceMatrix=function(rootMatrix){rootMatrix||(rootMatrix=this._baseMatrix),this._parent?rootMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(rootMatrix),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var index=0;index<this.children.length;index++)this.children[index]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},Bone.prototype.markAsDirty=function(){this._currentRenderId++,this._skeleton._markAsDirty()},Bone.prototype.copyAnimationRange=function(source,rangeName,frameOffset,rescaleAsRequired,skelDimensionsRatio){void 0===rescaleAsRequired&&(rescaleAsRequired=!1),void 0===skelDimensionsRatio&&(skelDimensionsRatio=null),0===this.animations.length&&(this.animations.push(new BABYLON.Animation(this.name,"_matrix",source.animations[0].framePerSecond,BABYLON.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var sourceRange=source.animations[0].getRange(rangeName);if(!sourceRange)return!1;for(var orig,origTranslation,mat,from=sourceRange.from,to=sourceRange.to,sourceKeys=source.animations[0].getKeys(),sourceBoneLength=source.length,sourceParent=source.getParent(),parent=this.getParent(),parentScalingReqd=rescaleAsRequired&&sourceParent&&sourceBoneLength&&this.length&&sourceBoneLength!==this.length,parentRatio=parentScalingReqd&&parent&&sourceParent?parent.length/sourceParent.length:1,dimensionsScalingReqd=rescaleAsRequired&&!parent&&skelDimensionsRatio&&(1!==skelDimensionsRatio.x||1!==skelDimensionsRatio.y||1!==skelDimensionsRatio.z),destKeys=this.animations[0].getKeys(),key=0,nKeys=sourceKeys.length;key<nKeys;key++)(orig=sourceKeys[key]).frame>=from&&orig.frame<=to&&(rescaleAsRequired?(mat=orig.value.clone(),parentScalingReqd?(origTranslation=mat.getTranslation(),mat.setTranslation(origTranslation.scaleInPlace(parentRatio))):dimensionsScalingReqd&&skelDimensionsRatio?(origTranslation=mat.getTranslation(),mat.setTranslation(origTranslation.multiplyInPlace(skelDimensionsRatio))):mat=orig.value):mat=orig.value,destKeys.push({frame:orig.frame+frameOffset,value:mat}));return this.animations[0].createRange(rangeName,from+frameOffset,to+frameOffset),!0},Bone.prototype.translate=function(vec,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var lm=this.getLocalMatrix();if(space==BABYLON.Space.LOCAL)lm.m[12]+=vec.x,lm.m[13]+=vec.y,lm.m[14]+=vec.z;else{var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var tmat=Bone._tmpMats[0],tvec=Bone._tmpVecs[0];this._parent&&(mesh&&wm?(tmat.copyFrom(this._parent.getAbsoluteTransform()),tmat.multiplyToRef(wm,tmat)):tmat.copyFrom(this._parent.getAbsoluteTransform())),tmat.m[12]=0,tmat.m[13]=0,tmat.m[14]=0,tmat.invert(),BABYLON.Vector3.TransformCoordinatesToRef(vec,tmat,tvec),lm.m[12]+=tvec.x,lm.m[13]+=tvec.y,lm.m[14]+=tvec.z}this.markAsDirty()},Bone.prototype.setPosition=function(position,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var lm=this.getLocalMatrix();if(space==BABYLON.Space.LOCAL)lm.m[12]=position.x,lm.m[13]=position.y,lm.m[14]=position.z;else{var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var tmat=Bone._tmpMats[0],vec=Bone._tmpVecs[0];this._parent&&(mesh&&wm?(tmat.copyFrom(this._parent.getAbsoluteTransform()),tmat.multiplyToRef(wm,tmat)):tmat.copyFrom(this._parent.getAbsoluteTransform())),tmat.invert(),BABYLON.Vector3.TransformCoordinatesToRef(position,tmat,vec),lm.m[12]=vec.x,lm.m[13]=vec.y,lm.m[14]=vec.z}this.markAsDirty()},Bone.prototype.setAbsolutePosition=function(position,mesh){this.setPosition(position,BABYLON.Space.WORLD,mesh)},Bone.prototype.setScale=function(x,y,z,scaleChildren){void 0===scaleChildren&&(scaleChildren=!1),this.animations[0]&&!this.animations[0].hasRunningRuntimeAnimations&&(scaleChildren||(this._negateScaleChildren.x=1/x,this._negateScaleChildren.y=1/y,this._negateScaleChildren.z=1/z),this._syncScaleVector()),this.scale(x/this._scaleVector.x,y/this._scaleVector.y,z/this._scaleVector.z,scaleChildren)},Bone.prototype.scale=function(x,y,z,scaleChildren){void 0===scaleChildren&&(scaleChildren=!1);var locMat=this.getLocalMatrix(),origLocMat=Bone._tmpMats[0];origLocMat.copyFrom(locMat);var origLocMatInv=Bone._tmpMats[1];origLocMatInv.copyFrom(origLocMat),origLocMatInv.invert();var scaleMat=Bone._tmpMats[2];BABYLON.Matrix.FromValuesToRef(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1,scaleMat),this._scaleMatrix.multiplyToRef(scaleMat,this._scaleMatrix),this._scaleVector.x*=x,this._scaleVector.y*=y,this._scaleVector.z*=z,locMat.multiplyToRef(origLocMatInv,locMat),locMat.multiplyToRef(scaleMat,locMat),locMat.multiplyToRef(origLocMat,locMat);var parent=this.getParent();parent?locMat.multiplyToRef(parent.getAbsoluteTransform(),this.getAbsoluteTransform()):this.getAbsoluteTransform().copyFrom(locMat);var len=this.children.length;scaleMat.invert();for(i=0;i<len;i++){var child=this.children[i],cm=child.getLocalMatrix();cm.multiplyToRef(scaleMat,cm);var lm=child.getLocalMatrix();lm.m[12]*=x,lm.m[13]*=y,lm.m[14]*=z}if(this.computeAbsoluteTransforms(),scaleChildren)for(var i=0;i<len;i++)this.children[i].scale(x,y,z,scaleChildren);this.markAsDirty()},Bone.prototype.setYawPitchRoll=function(yaw,pitch,roll,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var rotMat=Bone._tmpMats[0];BABYLON.Matrix.RotationYawPitchRollToRef(yaw,pitch,roll,rotMat);var rotMatInv=Bone._tmpMats[1];this._getNegativeRotationToRef(rotMatInv,space,mesh),rotMatInv.multiplyToRef(rotMat,rotMat),this._rotateWithMatrix(rotMat,space,mesh)},Bone.prototype.rotate=function(axis,amount,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var rmat=Bone._tmpMats[0];rmat.m[12]=0,rmat.m[13]=0,rmat.m[14]=0,BABYLON.Matrix.RotationAxisToRef(axis,amount,rmat),this._rotateWithMatrix(rmat,space,mesh)},Bone.prototype.setAxisAngle=function(axis,angle,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var rotMat=Bone._tmpMats[0];BABYLON.Matrix.RotationAxisToRef(axis,angle,rotMat);var rotMatInv=Bone._tmpMats[1];this._getNegativeRotationToRef(rotMatInv,space,mesh),rotMatInv.multiplyToRef(rotMat,rotMat),this._rotateWithMatrix(rotMat,space,mesh)},Bone.prototype.setRotation=function(rotation,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL),this.setYawPitchRoll(rotation.y,rotation.x,rotation.z,space,mesh)},Bone.prototype.setRotationQuaternion=function(quat,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var rotMatInv=Bone._tmpMats[0];this._getNegativeRotationToRef(rotMatInv,space,mesh);var rotMat=Bone._tmpMats[1];BABYLON.Matrix.FromQuaternionToRef(quat,rotMat),rotMatInv.multiplyToRef(rotMat,rotMat),this._rotateWithMatrix(rotMat,space,mesh)},Bone.prototype.setRotationMatrix=function(rotMat,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var rotMatInv=Bone._tmpMats[0];this._getNegativeRotationToRef(rotMatInv,space,mesh);var rotMat2=Bone._tmpMats[1];rotMat2.copyFrom(rotMat),rotMatInv.multiplyToRef(rotMat,rotMat2),this._rotateWithMatrix(rotMat2,space,mesh)},Bone.prototype._rotateWithMatrix=function(rmat,space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var lmat=this.getLocalMatrix(),lx=lmat.m[12],ly=lmat.m[13],lz=lmat.m[14],parent=this.getParent(),parentScale=Bone._tmpMats[3],parentScaleInv=Bone._tmpMats[4];parent?(space==BABYLON.Space.WORLD?mesh?(parentScale.copyFrom(mesh.getWorldMatrix()),parent.getAbsoluteTransform().multiplyToRef(parentScale,parentScale)):parentScale.copyFrom(parent.getAbsoluteTransform()):parentScale=parent._scaleMatrix,parentScaleInv.copyFrom(parentScale),parentScaleInv.invert(),lmat.multiplyToRef(parentScale,lmat),lmat.multiplyToRef(rmat,lmat),lmat.multiplyToRef(parentScaleInv,lmat)):space==BABYLON.Space.WORLD&&mesh?(parentScale.copyFrom(mesh.getWorldMatrix()),parentScaleInv.copyFrom(parentScale),parentScaleInv.invert(),lmat.multiplyToRef(parentScale,lmat),lmat.multiplyToRef(rmat,lmat),lmat.multiplyToRef(parentScaleInv,lmat)):lmat.multiplyToRef(rmat,lmat),lmat.m[12]=lx,lmat.m[13]=ly,lmat.m[14]=lz,this.computeAbsoluteTransforms(),this.markAsDirty()},Bone.prototype._getNegativeRotationToRef=function(rotMatInv,space,mesh){if(void 0===space&&(space=BABYLON.Space.LOCAL),space==BABYLON.Space.WORLD){if((scaleMatrix=Bone._tmpMats[2]).copyFrom(this._scaleMatrix),rotMatInv.copyFrom(this.getAbsoluteTransform()),mesh){rotMatInv.multiplyToRef(mesh.getWorldMatrix(),rotMatInv);var meshScale=Bone._tmpMats[3];BABYLON.Matrix.ScalingToRef(mesh.scaling.x,mesh.scaling.y,mesh.scaling.z,meshScale),scaleMatrix.multiplyToRef(meshScale,scaleMatrix)}rotMatInv.invert(),scaleMatrix.m[0]*=this._scalingDeterminant,rotMatInv.multiplyToRef(scaleMatrix,rotMatInv)}else{rotMatInv.copyFrom(this.getLocalMatrix()),rotMatInv.invert();var scaleMatrix=Bone._tmpMats[2];if(scaleMatrix.copyFrom(this._scaleMatrix),this._parent){var pscaleMatrix=Bone._tmpMats[3];pscaleMatrix.copyFrom(this._parent._scaleMatrix),pscaleMatrix.invert(),pscaleMatrix.multiplyToRef(rotMatInv,rotMatInv)}else scaleMatrix.m[0]*=this._scalingDeterminant;rotMatInv.multiplyToRef(scaleMatrix,rotMatInv)}},Bone.prototype.getScale=function(){return this._scaleVector.clone()},Bone.prototype.getScaleToRef=function(result){result.copyFrom(this._scaleVector)},Bone.prototype.getPosition=function(space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL),void 0===mesh&&(mesh=null);var pos=BABYLON.Vector3.Zero();return this.getPositionToRef(space,mesh,pos),pos},Bone.prototype.getPositionToRef=function(space,mesh,result){if(void 0===space&&(space=BABYLON.Space.LOCAL),space==BABYLON.Space.LOCAL){var lm=this.getLocalMatrix();result.x=lm.m[12],result.y=lm.m[13],result.z=lm.m[14]}else{var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var tmat=Bone._tmpMats[0];mesh&&wm?(tmat.copyFrom(this.getAbsoluteTransform()),tmat.multiplyToRef(wm,tmat)):tmat=this.getAbsoluteTransform(),result.x=tmat.m[12],result.y=tmat.m[13],result.z=tmat.m[14]}},Bone.prototype.getAbsolutePosition=function(mesh){void 0===mesh&&(mesh=null);var pos=BABYLON.Vector3.Zero();return this.getPositionToRef(BABYLON.Space.WORLD,mesh,pos),pos},Bone.prototype.getAbsolutePositionToRef=function(mesh,result){this.getPositionToRef(BABYLON.Space.WORLD,mesh,result)},Bone.prototype.computeAbsoluteTransforms=function(){if(this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var poseMatrix=this._skeleton.getPoseMatrix();poseMatrix&&this._absoluteTransform.multiplyToRef(poseMatrix,this._absoluteTransform)}for(var children=this.children,len=children.length,i=0;i<len;i++)children[i].computeAbsoluteTransforms()},Bone.prototype._syncScaleVector=function(){var lm=this.getLocalMatrix(),xsq=lm.m[0]*lm.m[0]+lm.m[1]*lm.m[1]+lm.m[2]*lm.m[2],ysq=lm.m[4]*lm.m[4]+lm.m[5]*lm.m[5]+lm.m[6]*lm.m[6],zsq=lm.m[8]*lm.m[8]+lm.m[9]*lm.m[9]+lm.m[10]*lm.m[10],xs=lm.m[0]*lm.m[1]*lm.m[2]*lm.m[3]<0?-1:1,ys=lm.m[4]*lm.m[5]*lm.m[6]*lm.m[7]<0?-1:1,zs=lm.m[8]*lm.m[9]*lm.m[10]*lm.m[11]<0?-1:1;this._scaleVector.x=xs*Math.sqrt(xsq),this._scaleVector.y=ys*Math.sqrt(ysq),this._scaleVector.z=zs*Math.sqrt(zsq),this._parent&&(this._scaleVector.x/=this._parent._negateScaleChildren.x,this._scaleVector.y/=this._parent._negateScaleChildren.y,this._scaleVector.z/=this._parent._negateScaleChildren.z),BABYLON.Matrix.FromValuesToRef(this._scaleVector.x,0,0,0,0,this._scaleVector.y,0,0,0,0,this._scaleVector.z,0,0,0,0,1,this._scaleMatrix)},Bone.prototype.getDirection=function(localAxis,mesh){void 0===mesh&&(mesh=null);var result=BABYLON.Vector3.Zero();return this.getDirectionToRef(localAxis,mesh,result),result},Bone.prototype.getDirectionToRef=function(localAxis,mesh,result){void 0===mesh&&(mesh=null);var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var mat=Bone._tmpMats[0];mat.copyFrom(this.getAbsoluteTransform()),mesh&&wm&&mat.multiplyToRef(wm,mat),BABYLON.Vector3.TransformNormalToRef(localAxis,mat,result),result.normalize()},Bone.prototype.getRotation=function(space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL),void 0===mesh&&(mesh=null);var result=BABYLON.Vector3.Zero();return this.getRotationToRef(space,mesh,result),result},Bone.prototype.getRotationToRef=function(space,mesh,result){void 0===space&&(space=BABYLON.Space.LOCAL),void 0===mesh&&(mesh=null);var quat=Bone._tmpQuat;this.getRotationQuaternionToRef(space,mesh,quat),quat.toEulerAnglesToRef(result)},Bone.prototype.getRotationQuaternion=function(space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL),void 0===mesh&&(mesh=null);var result=BABYLON.Quaternion.Identity();return this.getRotationQuaternionToRef(space,mesh,result),result},Bone.prototype.getRotationQuaternionToRef=function(space,mesh,result){if(void 0===space&&(space=BABYLON.Space.LOCAL),void 0===mesh&&(mesh=null),space==BABYLON.Space.LOCAL)this.getLocalMatrix().decompose(Bone._tmpVecs[0],result,Bone._tmpVecs[1]);else{var mat=Bone._tmpMats[0],amat=this.getAbsoluteTransform();mesh?amat.multiplyToRef(mesh.getWorldMatrix(),mat):mat.copyFrom(amat),mat.m[0]*=this._scalingDeterminant,mat.m[1]*=this._scalingDeterminant,mat.m[2]*=this._scalingDeterminant,mat.decompose(Bone._tmpVecs[0],result,Bone._tmpVecs[1])}},Bone.prototype.getRotationMatrix=function(space,mesh){void 0===space&&(space=BABYLON.Space.LOCAL);var result=BABYLON.Matrix.Identity();return this.getRotationMatrixToRef(space,mesh,result),result},Bone.prototype.getRotationMatrixToRef=function(space,mesh,result){if(void 0===space&&(space=BABYLON.Space.LOCAL),space==BABYLON.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(result);else{var mat=Bone._tmpMats[0],amat=this.getAbsoluteTransform();mesh?amat.multiplyToRef(mesh.getWorldMatrix(),mat):mat.copyFrom(amat),mat.m[0]*=this._scalingDeterminant,mat.m[1]*=this._scalingDeterminant,mat.m[2]*=this._scalingDeterminant,mat.getRotationMatrixToRef(result)}},Bone.prototype.getAbsolutePositionFromLocal=function(position,mesh){void 0===mesh&&(mesh=null);var result=BABYLON.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(position,mesh,result),result},Bone.prototype.getAbsolutePositionFromLocalToRef=function(position,mesh,result){void 0===mesh&&(mesh=null);var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var tmat=Bone._tmpMats[0];mesh&&wm?(tmat.copyFrom(this.getAbsoluteTransform()),tmat.multiplyToRef(wm,tmat)):tmat=this.getAbsoluteTransform(),BABYLON.Vector3.TransformCoordinatesToRef(position,tmat,result)},Bone.prototype.getLocalPositionFromAbsolute=function(position,mesh){void 0===mesh&&(mesh=null);var result=BABYLON.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(position,mesh,result),result},Bone.prototype.getLocalPositionFromAbsoluteToRef=function(position,mesh,result){void 0===mesh&&(mesh=null);var wm=null;mesh&&(wm=mesh.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var tmat=Bone._tmpMats[0];tmat.copyFrom(this.getAbsoluteTransform()),mesh&&wm&&tmat.multiplyToRef(wm,tmat),tmat.invert(),BABYLON.Vector3.TransformCoordinatesToRef(position,tmat,result)},Bone._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Bone._tmpQuat=BABYLON.Quaternion.Identity(),Bone._tmpMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],Bone}(BABYLON.Node);BABYLON.Bone=Bone}(BABYLON||(BABYLON={}));!function(BABYLON){var BoneIKController=function(){function BoneIKController(mesh,bone,options){if(this.targetPosition=BABYLON.Vector3.Zero(),this.poleTargetPosition=BABYLON.Vector3.Zero(),this.poleTargetLocalOffset=BABYLON.Vector3.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=BABYLON.Quaternion.Identity(),this._bone1Mat=BABYLON.Matrix.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=BABYLON.Vector3.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=bone,this._bone1=bone.getParent(),this._bone1){this.mesh=mesh;var bonePos=bone.getPosition();if(bone.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,bonePos.x>bonePos.y&&bonePos.x>bonePos.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var boneScale1=this._bone1.getScale(),boneScale2=this._bone2.getScale();this._bone1Length=this._bone1.length*boneScale1.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*boneScale2.y*this.mesh.scaling.y}else if(this._bone1.children[0]){mesh.computeWorldMatrix(!0);var pos1=this._bone2.children[0].getAbsolutePosition(mesh),pos2=this._bone2.getAbsolutePosition(mesh),pos3=this._bone1.getAbsolutePosition(mesh);this._bone1Length=BABYLON.Vector3.Distance(pos1,pos2),this._bone2Length=BABYLON.Vector3.Distance(pos2,pos3)}this._bone1.getRotationMatrixToRef(BABYLON.Space.WORLD,mesh,this._bone1Mat),this.maxAngle=Math.PI,options&&(options.targetMesh&&(this.targetMesh=options.targetMesh,this.targetMesh.computeWorldMatrix(!0)),options.poleTargetMesh?(this.poleTargetMesh=options.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):options.poleTargetBone?this.poleTargetBone=options.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),options.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(options.poleTargetLocalOffset),options.poleAngle&&(this.poleAngle=options.poleAngle),options.bendAxis&&this._bendAxis.copyFrom(options.bendAxis),options.maxAngle&&(this.maxAngle=options.maxAngle),options.slerpAmount&&(this.slerpAmount=options.slerpAmount))}}return Object.defineProperty(BoneIKController.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(value){this._setMaxAngle(value)},enumerable:!0,configurable:!0}),BoneIKController.prototype._setMaxAngle=function(ang){ang<0&&(ang=0),(ang>Math.PI||void 0==ang)&&(ang=Math.PI),this._maxAngle=ang;var a=this._bone1Length,b=this._bone2Length;this._maxReach=Math.sqrt(a*a+b*b-2*a*b*Math.cos(ang))},BoneIKController.prototype.update=function(){var bone1=this._bone1;if(bone1){var target=this.targetPosition,poleTarget=this.poleTargetPosition,mat1=BoneIKController._tmpMats[0],mat2=BoneIKController._tmpMats[1];this.targetMesh&&target.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,poleTarget):this.poleTargetMesh&&BABYLON.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),poleTarget);var bonePos=BoneIKController._tmpVecs[0],zaxis=BoneIKController._tmpVecs[1],xaxis=BoneIKController._tmpVecs[2],yaxis=BoneIKController._tmpVecs[3],upAxis=BoneIKController._tmpVecs[4],_tmpQuat=BoneIKController._tmpQuat;bone1.getAbsolutePositionToRef(this.mesh,bonePos),poleTarget.subtractToRef(bonePos,upAxis),0==upAxis.x&&0==upAxis.y&&0==upAxis.z?upAxis.y=1:upAxis.normalize(),target.subtractToRef(bonePos,yaxis),yaxis.normalize(),BABYLON.Vector3.CrossToRef(yaxis,upAxis,zaxis),zaxis.normalize(),BABYLON.Vector3.CrossToRef(yaxis,zaxis,xaxis),xaxis.normalize(),BABYLON.Matrix.FromXYZAxesToRef(xaxis,yaxis,zaxis,mat1);var a=this._bone1Length,b=this._bone2Length,c=BABYLON.Vector3.Distance(bonePos,target);this._maxReach>0&&(c=Math.min(this._maxReach,c));var acosa=(b*b+c*c-a*a)/(2*b*c),acosb=(c*c+a*a-b*b)/(2*c*a);acosa>1&&(acosa=1),acosb>1&&(acosb=1),acosa<-1&&(acosa=-1),acosb<-1&&(acosb=-1);var angA=Math.acos(acosa),angB=Math.acos(acosb),angC=-angA-angB;if(this._rightHandedSystem)BABYLON.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,mat2),mat2.multiplyToRef(mat1,mat1),BABYLON.Matrix.RotationAxisToRef(this._bendAxis,angB,mat2),mat2.multiplyToRef(mat1,mat1);else{var _tmpVec=BoneIKController._tmpVecs[5];_tmpVec.copyFrom(this._bendAxis),_tmpVec.x*=-1,BABYLON.Matrix.RotationAxisToRef(_tmpVec,-angB,mat2),mat2.multiplyToRef(mat1,mat1)}this.poleAngle&&(BABYLON.Matrix.RotationAxisToRef(yaxis,this.poleAngle,mat2),mat1.multiplyToRef(mat2,mat1)),this._bone1&&(this.slerpAmount<1?(this._slerping||BABYLON.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),BABYLON.Quaternion.FromRotationMatrixToRef(mat1,_tmpQuat),BABYLON.Quaternion.SlerpToRef(this._bone1Quat,_tmpQuat,this.slerpAmount,this._bone1Quat),angC=this._bone2Ang*(1-this.slerpAmount)+angC*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,BABYLON.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(mat1,BABYLON.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(mat1),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,angC,BABYLON.Space.LOCAL),this._bone2Ang=angC}},BoneIKController._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],BoneIKController._tmpQuat=BABYLON.Quaternion.Identity(),BoneIKController._tmpMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],BoneIKController}();BABYLON.BoneIKController=BoneIKController}(BABYLON||(BABYLON={}));!function(BABYLON){var BoneLookController=function(){function BoneLookController(mesh,bone,target,options){if(this.upAxis=BABYLON.Vector3.Up(),this.upAxisSpace=BABYLON.Space.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=BABYLON.Quaternion.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=BABYLON.Vector3.Forward(),this.mesh=mesh,this.bone=bone,this.target=target,options&&(options.adjustYaw&&(this.adjustYaw=options.adjustYaw),options.adjustPitch&&(this.adjustPitch=options.adjustPitch),options.adjustRoll&&(this.adjustRoll=options.adjustRoll),null!=options.maxYaw?this.maxYaw=options.maxYaw:this.maxYaw=Math.PI,null!=options.minYaw?this.minYaw=options.minYaw:this.minYaw=-Math.PI,null!=options.maxPitch?this.maxPitch=options.maxPitch:this.maxPitch=Math.PI,null!=options.minPitch?this.minPitch=options.minPitch:this.minPitch=-Math.PI,null!=options.slerpAmount&&(this.slerpAmount=options.slerpAmount),null!=options.upAxis&&(this.upAxis=options.upAxis),null!=options.upAxisSpace&&(this.upAxisSpace=options.upAxisSpace),null!=options.yawAxis||null!=options.pitchAxis)){var newYawAxis=BABYLON.Axis.Y,newPitchAxis=BABYLON.Axis.X;null!=options.yawAxis&&(newYawAxis=options.yawAxis.clone()).normalize(),null!=options.pitchAxis&&(newPitchAxis=options.pitchAxis.clone()).normalize();var newRollAxis=BABYLON.Vector3.Cross(newPitchAxis,newYawAxis);this._transformYawPitch=BABYLON.Matrix.Identity(),BABYLON.Matrix.FromXYZAxesToRef(newPitchAxis,newYawAxis,newRollAxis,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}bone.getParent()||this.upAxisSpace!=BABYLON.Space.BONE||(this.upAxisSpace=BABYLON.Space.LOCAL)}return Object.defineProperty(BoneLookController.prototype,"minYaw",{get:function(){return this._minYaw},set:function(value){this._minYaw=value,this._minYawSin=Math.sin(value),this._minYawCos=Math.cos(value),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(BoneLookController.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(value){this._maxYaw=value,this._maxYawSin=Math.sin(value),this._maxYawCos=Math.cos(value),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(BoneLookController.prototype,"minPitch",{get:function(){return this._minPitch},set:function(value){this._minPitch=value,this._minPitchTan=Math.tan(value)},enumerable:!0,configurable:!0}),Object.defineProperty(BoneLookController.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(value){this._maxPitch=value,this._maxPitchTan=Math.tan(value)},enumerable:!0,configurable:!0}),BoneLookController.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var bone=this.bone,bonePos=BoneLookController._tmpVecs[0];bone.getAbsolutePositionToRef(this.mesh,bonePos);var target=this.target,_tmpMat1=BoneLookController._tmpMats[0],_tmpMat2=BoneLookController._tmpMats[1],mesh=this.mesh,parentBone=bone.getParent(),upAxis=BoneLookController._tmpVecs[1];upAxis.copyFrom(this.upAxis),this.upAxisSpace==BABYLON.Space.BONE&&parentBone?(this._transformYawPitch&&BABYLON.Vector3.TransformCoordinatesToRef(upAxis,this._transformYawPitchInv,upAxis),parentBone.getDirectionToRef(upAxis,this.mesh,upAxis)):this.upAxisSpace==BABYLON.Space.LOCAL&&(mesh.getDirectionToRef(upAxis,upAxis),1==mesh.scaling.x&&1==mesh.scaling.y&&1==mesh.scaling.z||upAxis.normalize());var checkYaw=!1,checkPitch=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(checkYaw=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(checkPitch=!0),checkYaw||checkPitch){var spaceMat=BoneLookController._tmpMats[2],spaceMatInv=BoneLookController._tmpMats[3];if(this.upAxisSpace==BABYLON.Space.BONE&&1==upAxis.y&&parentBone)parentBone.getRotationMatrixToRef(BABYLON.Space.WORLD,this.mesh,spaceMat);else if(this.upAxisSpace!=BABYLON.Space.LOCAL||1!=upAxis.y||parentBone){(forwardAxis=BoneLookController._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&BABYLON.Vector3.TransformCoordinatesToRef(forwardAxis,this._transformYawPitchInv,forwardAxis),parentBone?parentBone.getDirectionToRef(forwardAxis,this.mesh,forwardAxis):mesh.getDirectionToRef(forwardAxis,forwardAxis);var rightAxis=BABYLON.Vector3.Cross(upAxis,forwardAxis);rightAxis.normalize();var forwardAxis=BABYLON.Vector3.Cross(rightAxis,upAxis);BABYLON.Matrix.FromXYZAxesToRef(rightAxis,upAxis,forwardAxis,spaceMat)}else spaceMat.copyFrom(mesh.getWorldMatrix());spaceMat.invertToRef(spaceMatInv);var xzlen=null;if(checkPitch){localTarget=BoneLookController._tmpVecs[3];target.subtractToRef(bonePos,localTarget),BABYLON.Vector3.TransformCoordinatesToRef(localTarget,spaceMatInv,localTarget),xzlen=Math.sqrt(localTarget.x*localTarget.x+localTarget.z*localTarget.z);var pitch=Math.atan2(localTarget.y,xzlen),newPitch=pitch;pitch>this._maxPitch?(localTarget.y=this._maxPitchTan*xzlen,newPitch=this._maxPitch):pitch<this._minPitch&&(localTarget.y=this._minPitchTan*xzlen,newPitch=this._minPitch),pitch!=newPitch&&(BABYLON.Vector3.TransformCoordinatesToRef(localTarget,spaceMat,localTarget),localTarget.addInPlace(bonePos),target=localTarget)}if(checkYaw){var localTarget=BoneLookController._tmpVecs[4];target.subtractToRef(bonePos,localTarget),BABYLON.Vector3.TransformCoordinatesToRef(localTarget,spaceMatInv,localTarget);var yaw=Math.atan2(localTarget.x,localTarget.z),newYaw=yaw;if((yaw>this._maxYaw||yaw<this._minYaw)&&(null==xzlen&&(xzlen=Math.sqrt(localTarget.x*localTarget.x+localTarget.z*localTarget.z)),this._yawRange>Math.PI?this._isAngleBetween(yaw,this._maxYaw,this._midYawConstraint)?(localTarget.z=this._maxYawCos*xzlen,localTarget.x=this._maxYawSin*xzlen,newYaw=this._maxYaw):this._isAngleBetween(yaw,this._midYawConstraint,this._minYaw)&&(localTarget.z=this._minYawCos*xzlen,localTarget.x=this._minYawSin*xzlen,newYaw=this._minYaw):yaw>this._maxYaw?(localTarget.z=this._maxYawCos*xzlen,localTarget.x=this._maxYawSin*xzlen,newYaw=this._maxYaw):yaw<this._minYaw&&(localTarget.z=this._minYawCos*xzlen,localTarget.x=this._minYawSin*xzlen,newYaw=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var boneFwd=BoneLookController._tmpVecs[8];boneFwd.copyFrom(BABYLON.Axis.Z),this._transformYawPitch&&BABYLON.Vector3.TransformCoordinatesToRef(boneFwd,this._transformYawPitchInv,boneFwd);var boneRotMat=BABYLON.BoneLookController._tmpMats[4];this._boneQuat.toRotationMatrix(boneRotMat),this.mesh.getWorldMatrix().multiplyToRef(boneRotMat,boneRotMat),BABYLON.Vector3.TransformCoordinatesToRef(boneFwd,boneRotMat,boneFwd),BABYLON.Vector3.TransformCoordinatesToRef(boneFwd,spaceMatInv,boneFwd);var boneYaw=Math.atan2(boneFwd.x,boneFwd.z);if(this._getAngleBetween(boneYaw,yaw)>this._getAngleBetween(boneYaw,this._midYawConstraint)){null==xzlen&&(xzlen=Math.sqrt(localTarget.x*localTarget.x+localTarget.z*localTarget.z));var angBtwMax=this._getAngleBetween(boneYaw,this._maxYaw);this._getAngleBetween(boneYaw,this._minYaw)<angBtwMax?(newYaw=boneYaw+.75*Math.PI,localTarget.z=Math.cos(newYaw)*xzlen,localTarget.x=Math.sin(newYaw)*xzlen):(newYaw=boneYaw-.75*Math.PI,localTarget.z=Math.cos(newYaw)*xzlen,localTarget.x=Math.sin(newYaw)*xzlen)}}yaw!=newYaw&&(BABYLON.Vector3.TransformCoordinatesToRef(localTarget,spaceMat,localTarget),localTarget.addInPlace(bonePos),target=localTarget)}}var zaxis=BoneLookController._tmpVecs[5],xaxis=BoneLookController._tmpVecs[6],yaxis=BoneLookController._tmpVecs[7],_tmpQuat=BoneLookController._tmpQuat;target.subtractToRef(bonePos,zaxis),zaxis.normalize(),BABYLON.Vector3.CrossToRef(upAxis,zaxis,xaxis),xaxis.normalize(),BABYLON.Vector3.CrossToRef(zaxis,xaxis,yaxis),yaxis.normalize(),BABYLON.Matrix.FromXYZAxesToRef(xaxis,yaxis,zaxis,_tmpMat1),0===xaxis.x&&0===xaxis.y&&0===xaxis.z||0===yaxis.x&&0===yaxis.y&&0===yaxis.z||0===zaxis.x&&0===zaxis.y&&0===zaxis.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(BABYLON.Matrix.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,_tmpMat2),_tmpMat2.multiplyToRef(_tmpMat1,_tmpMat1)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(BABYLON.Space.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(_tmpMat1,_tmpMat1),BABYLON.Quaternion.FromRotationMatrixToRef(_tmpMat1,_tmpQuat),BABYLON.Quaternion.SlerpToRef(this._boneQuat,_tmpQuat,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,BABYLON.Space.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(_tmpMat1,_tmpMat1),this.bone.setRotationMatrix(_tmpMat1,BABYLON.Space.WORLD,this.mesh),this._slerping=!1))}},BoneLookController.prototype._getAngleDiff=function(ang1,ang2){var angDiff=ang2-ang1;return(angDiff%=2*Math.PI)>Math.PI?angDiff-=2*Math.PI:angDiff<-Math.PI&&(angDiff+=2*Math.PI),angDiff},BoneLookController.prototype._getAngleBetween=function(ang1,ang2){var ab=0;return(ab=(ang1=(ang1%=2*Math.PI)<0?ang1+2*Math.PI:ang1)<(ang2=(ang2%=2*Math.PI)<0?ang2+2*Math.PI:ang2)?ang2-ang1:ang1-ang2)>Math.PI&&(ab=2*Math.PI-ab),ab},BoneLookController.prototype._isAngleBetween=function(ang,ang1,ang2){if(ang%=2*Math.PI,ang=ang<0?ang+2*Math.PI:ang,ang1%=2*Math.PI,ang1=ang1<0?ang1+2*Math.PI:ang1,ang2%=2*Math.PI,ang2=ang2<0?ang2+2*Math.PI:ang2,ang1<ang2){if(ang>ang1&&ang<ang2)return!0}else if(ang>ang2&&ang<ang1)return!0;return!1},BoneLookController._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],BoneLookController._tmpQuat=BABYLON.Quaternion.Identity(),BoneLookController._tmpMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],BoneLookController}();BABYLON.BoneLookController=BoneLookController}(BABYLON||(BABYLON={}));!function(BABYLON){var Skeleton=function(){function Skeleton(name,id,scene){this.name=name,this.id=id,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=BABYLON.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this.onBeforeComputeObservable=new BABYLON.Observable,this.bones=[],this._scene=scene||BABYLON.Engine.LastCreatedScene,scene.skeletons.push(this),this._isDirty=!0}return Skeleton.prototype.getTransformMatrices=function(mesh){return this.needInitialSkinMatrix&&mesh._bonesTransformMatrices?mesh._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},Skeleton.prototype.getScene=function(){return this._scene},Skeleton.prototype.toString=function(fullDetails){var ret="Name: "+this.name+", nBones: "+this.bones.length;if(ret+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),fullDetails){ret+=", Ranges: {";var first=!0;for(var name_1 in this._ranges)first&&(ret+=", ",first=!1),ret+=name_1;ret+="}"}return ret},Skeleton.prototype.getBoneIndexByName=function(name){for(var boneIndex=0,cache=this.bones.length;boneIndex<cache;boneIndex++)if(this.bones[boneIndex].name===name)return boneIndex;return-1},Skeleton.prototype.createAnimationRange=function(name,from,to){if(!this._ranges[name]){this._ranges[name]=new BABYLON.AnimationRange(name,from,to);for(var i=0,nBones=this.bones.length;i<nBones;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(name,from,to)}},Skeleton.prototype.deleteAnimationRange=function(name,deleteFrames){void 0===deleteFrames&&(deleteFrames=!0);for(var i=0,nBones=this.bones.length;i<nBones;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(name,deleteFrames);this._ranges[name]=null},Skeleton.prototype.getAnimationRange=function(name){return this._ranges[name]},Skeleton.prototype.getAnimationRanges=function(){var name,animationRanges=[],i=0;for(name in this._ranges)animationRanges[i]=this._ranges[name],i++;return animationRanges},Skeleton.prototype.copyAnimationRange=function(source,name,rescaleAsRequired){if(void 0===rescaleAsRequired&&(rescaleAsRequired=!1),this._ranges[name]||!source.getAnimationRange(name))return!1;var nBones,i,ret=!0,frameOffset=this._getHighestAnimationFrame()+1,boneDict={},sourceBones=source.bones;for(i=0,nBones=sourceBones.length;i<nBones;i++)boneDict[sourceBones[i].name]=sourceBones[i];this.bones.length!==sourceBones.length&&(BABYLON.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+sourceBones.length),ret=!1);var skelDimensionsRatio=rescaleAsRequired&&this.dimensionsAtRest&&source.dimensionsAtRest?this.dimensionsAtRest.divide(source.dimensionsAtRest):null;for(i=0,nBones=this.bones.length;i<nBones;i++){var boneName=this.bones[i].name,sourceBone=boneDict[boneName];sourceBone?ret=ret&&this.bones[i].copyAnimationRange(sourceBone,name,frameOffset,rescaleAsRequired,skelDimensionsRatio):(BABYLON.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+boneName),ret=!1)}var range=source.getAnimationRange(name);return range&&(this._ranges[name]=new BABYLON.AnimationRange(name,range.from+frameOffset,range.to+frameOffset)),ret},Skeleton.prototype.returnToRest=function(){for(var index=0;index<this.bones.length;index++)this.bones[index].returnToRest()},Skeleton.prototype._getHighestAnimationFrame=function(){for(var ret=0,i=0,nBones=this.bones.length;i<nBones;i++)if(this.bones[i].animations[0]){var highest=this.bones[i].animations[0].getHighestFrame();ret<highest&&(ret=highest)}return ret},Skeleton.prototype.beginAnimation=function(name,loop,speedRatio,onAnimationEnd){var range=this.getAnimationRange(name);return range?this._scene.beginAnimation(this,range.from,range.to,loop,speedRatio,onAnimationEnd):null},Skeleton.prototype._markAsDirty=function(){this._isDirty=!0},Skeleton.prototype._registerMeshWithPoseMatrix=function(mesh){this._meshesWithPoseMatrix.push(mesh)},Skeleton.prototype._unregisterMeshWithPoseMatrix=function(mesh){var index=this._meshesWithPoseMatrix.indexOf(mesh);index>-1&&this._meshesWithPoseMatrix.splice(index,1)},Skeleton.prototype._computeTransformMatrices=function(targetMatrix,initialSkinMatrix){this.onBeforeComputeObservable.notifyObservers(this);for(var index=0;index<this.bones.length;index++){var bone=this.bones[index],parentBone=bone.getParent();if(parentBone?bone.getLocalMatrix().multiplyToRef(parentBone.getWorldMatrix(),bone.getWorldMatrix()):initialSkinMatrix?bone.getLocalMatrix().multiplyToRef(initialSkinMatrix,bone.getWorldMatrix()):bone.getWorldMatrix().copyFrom(bone.getLocalMatrix()),-1!==bone._index){var mappedIndex=null===bone._index?index:bone._index;bone.getInvertedAbsoluteTransform().multiplyToArray(bone.getWorldMatrix(),targetMatrix,16*mappedIndex)}}this._identity.copyToArray(targetMatrix,16*this.bones.length)},Skeleton.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var index=0;index<this._meshesWithPoseMatrix.length;index++){var mesh=this._meshesWithPoseMatrix[index],poseMatrix=mesh.getPoseMatrix();if(mesh._bonesTransformMatrices&&mesh._bonesTransformMatrices.length===16*(this.bones.length+1)||(mesh._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==mesh){this._synchronizedWithMesh=mesh;for(var boneIndex=0;boneIndex<this.bones.length;boneIndex++){var bone=this.bones[boneIndex];bone.getParent()||bone._frozen||(bone.getBaseMatrix().multiplyToRef(poseMatrix,BABYLON.Tmp.Matrix[1]),bone._updateDifferenceMatrix(BABYLON.Tmp.Matrix[1]))}}this._computeTransformMatrices(mesh._bonesTransformMatrices,poseMatrix)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},Skeleton.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var index=0;index<this.bones.length;index++)this._animatables.push(this.bones[index])}return this._animatables},Skeleton.prototype.clone=function(name,id){var result=new Skeleton(name,id||name,this._scene);result.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var index=0;index<this.bones.length;index++){var source=this.bones[index],parentBone=null,parent_1=source.getParent();if(parent_1){var parentIndex=this.bones.indexOf(parent_1);parentBone=result.bones[parentIndex]}var bone=new BABYLON.Bone(source.name,result,parentBone,source.getBaseMatrix().clone(),source.getRestPose().clone());BABYLON.Tools.DeepCopy(source.animations,bone.animations)}if(this._ranges){result._ranges={};for(var rangeName in this._ranges){var range=this._ranges[rangeName];range&&(result._ranges[rangeName]=range.clone())}}return this._isDirty=!0,result},Skeleton.prototype.enableBlending=function(blendingSpeed){void 0===blendingSpeed&&(blendingSpeed=.01),this.bones.forEach(function(bone){bone.animations.forEach(function(animation){animation.enableBlending=!0,animation.blendingSpeed=blendingSpeed})})},Skeleton.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},Skeleton.prototype.serialize=function(){var serializationObject={};serializationObject.name=this.name,serializationObject.id=this.id,serializationObject.dimensionsAtRest=this.dimensionsAtRest,serializationObject.bones=[],serializationObject.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var index=0;index<this.bones.length;index++){var bone=this.bones[index],parent_2=bone.getParent(),serializedBone={parentBoneIndex:parent_2?this.bones.indexOf(parent_2):-1,name:bone.name,matrix:bone.getBaseMatrix().toArray(),rest:bone.getRestPose().toArray()};serializationObject.bones.push(serializedBone),bone.length&&(serializedBone.length=bone.length),bone.animations&&bone.animations.length>0&&(serializedBone.animation=bone.animations[0].serialize()),serializationObject.ranges=[];for(var name in this._ranges){var source=this._ranges[name];if(source){var range={};range.name=name,range.from=source.from,range.to=source.to,serializationObject.ranges.push(range)}}}return serializationObject},Skeleton.Parse=function(parsedSkeleton,scene){var skeleton=new Skeleton(parsedSkeleton.name,parsedSkeleton.id,scene);parsedSkeleton.dimensionsAtRest&&(skeleton.dimensionsAtRest=BABYLON.Vector3.FromArray(parsedSkeleton.dimensionsAtRest)),skeleton.needInitialSkinMatrix=parsedSkeleton.needInitialSkinMatrix;var index;for(index=0;index<parsedSkeleton.bones.length;index++){var parsedBone=parsedSkeleton.bones[index],parentBone=null;parsedBone.parentBoneIndex>-1&&(parentBone=skeleton.bones[parsedBone.parentBoneIndex]);var rest=parsedBone.rest?BABYLON.Matrix.FromArray(parsedBone.rest):null,bone=new BABYLON.Bone(parsedBone.name,skeleton,parentBone,BABYLON.Matrix.FromArray(parsedBone.matrix),rest);parsedBone.length&&(bone.length=parsedBone.length),parsedBone.animation&&bone.animations.push(BABYLON.Animation.Parse(parsedBone.animation))}if(parsedSkeleton.ranges)for(index=0;index<parsedSkeleton.ranges.length;index++){var data=parsedSkeleton.ranges[index];skeleton.createAnimationRange(data.name,data.from,data.to)}return skeleton},Skeleton.prototype.computeAbsoluteTransforms=function(forceUpdate){void 0===forceUpdate&&(forceUpdate=!1);var renderId=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=renderId||forceUpdate)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=renderId)},Skeleton.prototype.getPoseMatrix=function(){var poseMatrix=null;return this._meshesWithPoseMatrix.length>0&&(poseMatrix=this._meshesWithPoseMatrix[0].getPoseMatrix()),poseMatrix},Skeleton.prototype.sortBones=function(){for(var bones=new Array,visited=new Array(this.bones.length),index=0;index<this.bones.length;index++)this._sortBones(index,bones,visited);this.bones=bones},Skeleton.prototype._sortBones=function(index,bones,visited){if(!visited[index]){visited[index]=!0;var bone=this.bones[index];void 0===bone._index&&(bone._index=index);var parentBone=bone.getParent();parentBone&&this._sortBones(this.bones.indexOf(parentBone),bones,visited),bones.push(bone)}},Skeleton}();BABYLON.Skeleton=Skeleton}(BABYLON||(BABYLON={}));!function(BABYLON){var SphericalPolynomial=function(){function SphericalPolynomial(){this.x=BABYLON.Vector3.Zero(),this.y=BABYLON.Vector3.Zero(),this.z=BABYLON.Vector3.Zero(),this.xx=BABYLON.Vector3.Zero(),this.yy=BABYLON.Vector3.Zero(),this.zz=BABYLON.Vector3.Zero(),this.xy=BABYLON.Vector3.Zero(),this.yz=BABYLON.Vector3.Zero(),this.zx=BABYLON.Vector3.Zero()}return SphericalPolynomial.prototype.addAmbient=function(color){var colorVector=new BABYLON.Vector3(color.r,color.g,color.b);this.xx=this.xx.add(colorVector),this.yy=this.yy.add(colorVector),this.zz=this.zz.add(colorVector)},SphericalPolynomial.getSphericalPolynomialFromHarmonics=function(harmonics){var result=new SphericalPolynomial;return result.x=harmonics.L11.scale(1.02333),result.y=harmonics.L1_1.scale(1.02333),result.z=harmonics.L10.scale(1.02333),result.xx=harmonics.L00.scale(.886277).subtract(harmonics.L20.scale(.247708)).add(harmonics.L22.scale(.429043)),result.yy=harmonics.L00.scale(.886277).subtract(harmonics.L20.scale(.247708)).subtract(harmonics.L22.scale(.429043)),result.zz=harmonics.L00.scale(.886277).add(harmonics.L20.scale(.495417)),result.yz=harmonics.L2_1.scale(.858086),result.zx=harmonics.L21.scale(.858086),result.xy=harmonics.L2_2.scale(.858086),result.scale(1/Math.PI),result},SphericalPolynomial.prototype.scale=function(scale){this.x=this.x.scale(scale),this.y=this.y.scale(scale),this.z=this.z.scale(scale),this.xx=this.xx.scale(scale),this.yy=this.yy.scale(scale),this.zz=this.zz.scale(scale),this.yz=this.yz.scale(scale),this.zx=this.zx.scale(scale),this.xy=this.xy.scale(scale)},SphericalPolynomial}();BABYLON.SphericalPolynomial=SphericalPolynomial;var SphericalHarmonics=function(){function SphericalHarmonics(){this.L00=BABYLON.Vector3.Zero(),this.L1_1=BABYLON.Vector3.Zero(),this.L10=BABYLON.Vector3.Zero(),this.L11=BABYLON.Vector3.Zero(),this.L2_2=BABYLON.Vector3.Zero(),this.L2_1=BABYLON.Vector3.Zero(),this.L20=BABYLON.Vector3.Zero(),this.L21=BABYLON.Vector3.Zero(),this.L22=BABYLON.Vector3.Zero()}return SphericalHarmonics.prototype.addLight=function(direction,color,deltaSolidAngle){var c=new BABYLON.Vector3(color.r,color.g,color.b).scale(deltaSolidAngle);this.L00=this.L00.add(c.scale(.282095)),this.L1_1=this.L1_1.add(c.scale(.488603*direction.y)),this.L10=this.L10.add(c.scale(.488603*direction.z)),this.L11=this.L11.add(c.scale(.488603*direction.x)),this.L2_2=this.L2_2.add(c.scale(1.092548*direction.x*direction.y)),this.L2_1=this.L2_1.add(c.scale(1.092548*direction.y*direction.z)),this.L21=this.L21.add(c.scale(1.092548*direction.x*direction.z)),this.L20=this.L20.add(c.scale(.315392*(3*direction.z*direction.z-1))),this.L22=this.L22.add(c.scale(.546274*(direction.x*direction.x-direction.y*direction.y)))},SphericalHarmonics.prototype.scale=function(scale){this.L00=this.L00.scale(scale),this.L1_1=this.L1_1.scale(scale),this.L10=this.L10.scale(scale),this.L11=this.L11.scale(scale),this.L2_2=this.L2_2.scale(scale),this.L2_1=this.L2_1.scale(scale),this.L20=this.L20.scale(scale),this.L21=this.L21.scale(scale),this.L22=this.L22.scale(scale)},SphericalHarmonics.prototype.convertIncidentRadianceToIrradiance=function(){this.L00=this.L00.scale(3.141593),this.L1_1=this.L1_1.scale(2.094395),this.L10=this.L10.scale(2.094395),this.L11=this.L11.scale(2.094395),this.L2_2=this.L2_2.scale(.785398),this.L2_1=this.L2_1.scale(.785398),this.L20=this.L20.scale(.785398),this.L21=this.L21.scale(.785398),this.L22=this.L22.scale(.785398)},SphericalHarmonics.prototype.convertIrradianceToLambertianRadiance=function(){this.scale(1/Math.PI)},SphericalHarmonics.getsphericalHarmonicsFromPolynomial=function(polynomial){var result=new SphericalHarmonics;return result.L00=polynomial.xx.scale(.376127).add(polynomial.yy.scale(.376127)).add(polynomial.zz.scale(.376126)),result.L1_1=polynomial.y.scale(.977204),result.L10=polynomial.z.scale(.977204),result.L11=polynomial.x.scale(.977204),result.L2_2=polynomial.xy.scale(1.16538),result.L2_1=polynomial.yz.scale(1.16538),result.L20=polynomial.zz.scale(1.34567).subtract(polynomial.xx.scale(.672834)).subtract(polynomial.yy.scale(.672834)),result.L21=polynomial.zx.scale(1.16538),result.L22=polynomial.xx.scale(1.16538).subtract(polynomial.yy.scale(1.16538)),result.scale(Math.PI),result},SphericalHarmonics}();BABYLON.SphericalHarmonics=SphericalHarmonics}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var FileFaceOrientation=function(){return function(name,worldAxisForNormal,worldAxisForFileX,worldAxisForFileY){this.name=name,this.worldAxisForNormal=worldAxisForNormal,this.worldAxisForFileX=worldAxisForFileX,this.worldAxisForFileY=worldAxisForFileY}}(),CubeMapToSphericalPolynomialTools=function(){function CubeMapToSphericalPolynomialTools(){}return CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial=function(texture){if(!texture.isCube)return null;var up,down,size=texture.getSize().width,right=texture.readPixels(0),left=texture.readPixels(1);texture.isRenderTarget?(up=texture.readPixels(3),down=texture.readPixels(2)):(up=texture.readPixels(2),down=texture.readPixels(3));var front=texture.readPixels(4),back=texture.readPixels(5),gammaSpace=texture.gammaSpace,format=BABYLON.Engine.TEXTUREFORMAT_RGBA,type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT;texture.textureType&&texture.textureType!==BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT&&(type=BABYLON.Engine.TEXTURETYPE_FLOAT);var cubeInfo={size:size,right:right,left:left,up:up,down:down,front:front,back:back,format:format,type:type,gammaSpace:gammaSpace};return this.ConvertCubeMapToSphericalPolynomial(cubeInfo)},CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial=function(cubeInfo){for(var sphericalHarmonics=new BABYLON.SphericalHarmonics,totalSolidAngle=0,du=2/cubeInfo.size,dv=du,minUV=.5*du-1,faceIndex=0;faceIndex<6;faceIndex++)for(var fileFace=this.FileFaces[faceIndex],dataArray=cubeInfo[fileFace.name],v=minUV,stride=cubeInfo.format===BABYLON.Engine.TEXTUREFORMAT_RGBA?4:3,y=0;y<cubeInfo.size;y++){for(var u=minUV,x=0;x<cubeInfo.size;x++){var worldDirection=fileFace.worldAxisForFileX.scale(u).add(fileFace.worldAxisForFileY.scale(v)).add(fileFace.worldAxisForNormal);worldDirection.normalize();var deltaSolidAngle=Math.pow(1+u*u+v*v,-1.5),r=dataArray[y*cubeInfo.size*stride+x*stride+0],g=dataArray[y*cubeInfo.size*stride+x*stride+1],b=dataArray[y*cubeInfo.size*stride+x*stride+2];cubeInfo.type===BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT&&(r/=255,g/=255,b/=255),cubeInfo.gammaSpace&&(r=Math.pow(BABYLON.Scalar.Clamp(r),BABYLON.ToLinearSpace),g=Math.pow(BABYLON.Scalar.Clamp(g),BABYLON.ToLinearSpace),b=Math.pow(BABYLON.Scalar.Clamp(b),BABYLON.ToLinearSpace));var color=new BABYLON.Color3(r,g,b);sphericalHarmonics.addLight(worldDirection,color,deltaSolidAngle),totalSolidAngle+=deltaSolidAngle,u+=du}v+=dv}var correctionFactor=6*(4*Math.PI)/6/totalSolidAngle;return sphericalHarmonics.scale(correctionFactor),sphericalHarmonics.convertIncidentRadianceToIrradiance(),sphericalHarmonics.convertIrradianceToLambertianRadiance(),BABYLON.SphericalPolynomial.getSphericalPolynomialFromHarmonics(sphericalHarmonics)},CubeMapToSphericalPolynomialTools.FileFaces=[new FileFaceOrientation("right",new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,0,-1),new BABYLON.Vector3(0,-1,0)),new FileFaceOrientation("left",new BABYLON.Vector3(-1,0,0),new BABYLON.Vector3(0,0,1),new BABYLON.Vector3(0,-1,0)),new FileFaceOrientation("up",new BABYLON.Vector3(0,1,0),new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,0,1)),new FileFaceOrientation("down",new BABYLON.Vector3(0,-1,0),new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,0,-1)),new FileFaceOrientation("front",new BABYLON.Vector3(0,0,1),new BABYLON.Vector3(1,0,0),new BABYLON.Vector3(0,-1,0)),new FileFaceOrientation("back",new BABYLON.Vector3(0,0,-1),new BABYLON.Vector3(-1,0,0),new BABYLON.Vector3(0,-1,0))],CubeMapToSphericalPolynomialTools}();Internals.CubeMapToSphericalPolynomialTools=CubeMapToSphericalPolynomialTools}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var PanoramaToCubeMapTools=function(){function PanoramaToCubeMapTools(){}return PanoramaToCubeMapTools.ConvertPanoramaToCubemap=function(float32Array,inputWidth,inputHeight,size){if(!float32Array)throw"ConvertPanoramaToCubemap: input cannot be null";if(float32Array.length!=inputWidth*inputHeight*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(size,this.FACE_FRONT,float32Array,inputWidth,inputHeight),back:this.CreateCubemapTexture(size,this.FACE_BACK,float32Array,inputWidth,inputHeight),left:this.CreateCubemapTexture(size,this.FACE_LEFT,float32Array,inputWidth,inputHeight),right:this.CreateCubemapTexture(size,this.FACE_RIGHT,float32Array,inputWidth,inputHeight),up:this.CreateCubemapTexture(size,this.FACE_UP,float32Array,inputWidth,inputHeight),down:this.CreateCubemapTexture(size,this.FACE_DOWN,float32Array,inputWidth,inputHeight),size:size,type:BABYLON.Engine.TEXTURETYPE_FLOAT,format:BABYLON.Engine.TEXTUREFORMAT_RGB,gammaSpace:!1}},PanoramaToCubeMapTools.CreateCubemapTexture=function(texSize,faceData,float32Array,inputWidth,inputHeight){for(var buffer=new ArrayBuffer(texSize*texSize*4*3),textureArray=new Float32Array(buffer),rotDX1=faceData[1].subtract(faceData[0]).scale(1/texSize),rotDX2=faceData[3].subtract(faceData[2]).scale(1/texSize),dy=1/texSize,fy=0,y=0;y<texSize;y++){for(var xv1=faceData[0],xv2=faceData[2],x=0;x<texSize;x++){var v=xv2.subtract(xv1).scale(fy).add(xv1);v.normalize();var color=this.CalcProjectionSpherical(v,float32Array,inputWidth,inputHeight);textureArray[y*texSize*3+3*x+0]=color.r,textureArray[y*texSize*3+3*x+1]=color.g,textureArray[y*texSize*3+3*x+2]=color.b,xv1=xv1.add(rotDX1),xv2=xv2.add(rotDX2)}fy+=dy}return textureArray},PanoramaToCubeMapTools.CalcProjectionSpherical=function(vDir,float32Array,inputWidth,inputHeight){for(var theta=Math.atan2(vDir.z,vDir.x),phi=Math.acos(vDir.y);theta<-Math.PI;)theta+=2*Math.PI;for(;theta>Math.PI;)theta-=2*Math.PI;var dx=theta/Math.PI,dy=phi/Math.PI;dx=.5*dx+.5;var px=Math.round(dx*inputWidth);px<0?px=0:px>=inputWidth&&(px=inputWidth-1);var py=Math.round(dy*inputHeight);py<0?py=0:py>=inputHeight&&(py=inputHeight-1);var inputY=inputHeight-py-1;return{r:float32Array[inputY*inputWidth*3+3*px+0],g:float32Array[inputY*inputWidth*3+3*px+1],b:float32Array[inputY*inputWidth*3+3*px+2]}},PanoramaToCubeMapTools.FACE_FRONT=[new BABYLON.Vector3(-1,-1,-1),new BABYLON.Vector3(1,-1,-1),new BABYLON.Vector3(-1,1,-1),new BABYLON.Vector3(1,1,-1)],PanoramaToCubeMapTools.FACE_BACK=[new BABYLON.Vector3(1,-1,1),new BABYLON.Vector3(-1,-1,1),new BABYLON.Vector3(1,1,1),new BABYLON.Vector3(-1,1,1)],PanoramaToCubeMapTools.FACE_RIGHT=[new BABYLON.Vector3(1,-1,-1),new BABYLON.Vector3(1,-1,1),new BABYLON.Vector3(1,1,-1),new BABYLON.Vector3(1,1,1)],PanoramaToCubeMapTools.FACE_LEFT=[new BABYLON.Vector3(-1,-1,1),new BABYLON.Vector3(-1,-1,-1),new BABYLON.Vector3(-1,1,1),new BABYLON.Vector3(-1,1,-1)],PanoramaToCubeMapTools.FACE_DOWN=[new BABYLON.Vector3(-1,1,-1),new BABYLON.Vector3(1,1,-1),new BABYLON.Vector3(-1,1,1),new BABYLON.Vector3(1,1,1)],PanoramaToCubeMapTools.FACE_UP=[new BABYLON.Vector3(-1,-1,1),new BABYLON.Vector3(1,-1,1),new BABYLON.Vector3(-1,-1,-1),new BABYLON.Vector3(1,-1,-1)],PanoramaToCubeMapTools}();Internals.PanoramaToCubeMapTools=PanoramaToCubeMapTools}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var HDRTools=function(){function HDRTools(){}return HDRTools.Ldexp=function(mantissa,exponent){return exponent>1023?mantissa*Math.pow(2,1023)*Math.pow(2,exponent-1023):exponent<-1074?mantissa*Math.pow(2,-1074)*Math.pow(2,exponent+1074):mantissa*Math.pow(2,exponent)},HDRTools.Rgbe2float=function(float32array,red,green,blue,exponent,index){exponent>0?(exponent=this.Ldexp(1,exponent-136),float32array[index+0]=red*exponent,float32array[index+1]=green*exponent,float32array[index+2]=blue*exponent):(float32array[index+0]=0,float32array[index+1]=0,float32array[index+2]=0)},HDRTools.readStringLine=function(uint8array,startIndex){for(var line="",character="",i=startIndex;i<uint8array.length-startIndex&&"\n"!=(character=String.fromCharCode(uint8array[i]));i++)line+=character;return line},HDRTools.RGBE_ReadHeader=function(uint8array){var height=0,width=0,line=this.readStringLine(uint8array,0);if("#"!=line[0]||"?"!=line[1])throw"Bad HDR Format.";var endOfHeader=!1,findFormat=!1,lineIndex=0;do{lineIndex+=line.length+1,"FORMAT=32-bit_rle_rgbe"==(line=this.readStringLine(uint8array,lineIndex))?findFormat=!0:0==line.length&&(endOfHeader=!0)}while(!endOfHeader);if(!findFormat)throw"HDR Bad header format, unsupported FORMAT";lineIndex+=line.length+1,line=this.readStringLine(uint8array,lineIndex);var match=/^\-Y (.*) \+X (.*)$/g.exec(line);if(!match||match.length<3)throw"HDR Bad header format, no size";if(width=parseInt(match[2]),height=parseInt(match[1]),width<8||width>32767)throw"HDR Bad header format, unsupported size";return lineIndex+=line.length+1,{height:height,width:width,dataPosition:lineIndex}},HDRTools.GetCubeMapTextureData=function(buffer,size){var uint8array=new Uint8Array(buffer),hdrInfo=this.RGBE_ReadHeader(uint8array),data=this.RGBE_ReadPixels_RLE(uint8array,hdrInfo);return Internals.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(data,hdrInfo.width,hdrInfo.height,size)},HDRTools.RGBE_ReadPixels=function(uint8array,hdrInfo){return this.RGBE_ReadPixels_RLE(uint8array,hdrInfo)},HDRTools.RGBE_ReadPixels_RLE=function(uint8array,hdrInfo){for(var a,b,c,d,count,num_scanlines=hdrInfo.height,scanline_width=hdrInfo.width,dataIndex=hdrInfo.dataPosition,index=0,endIndex=0,i=0,scanLineArrayBuffer=new ArrayBuffer(4*scanline_width),scanLineArray=new Uint8Array(scanLineArrayBuffer),resultBuffer=new ArrayBuffer(hdrInfo.width*hdrInfo.height*4*3),resultArray=new Float32Array(resultBuffer);num_scanlines>0;){if(a=uint8array[dataIndex++],b=uint8array[dataIndex++],c=uint8array[dataIndex++],d=uint8array[dataIndex++],2!=a||2!=b||128&c)throw"HDR Bad header format, not RLE";if((c<<8|d)!=scanline_width)throw"HDR Bad header format, wrong scan line width";for(index=0,i=0;i<4;i++)for(endIndex=(i+1)*scanline_width;index<endIndex;)if(a=uint8array[dataIndex++],b=uint8array[dataIndex++],a>128){if(0==(count=a-128)||count>endIndex-index)throw"HDR Bad Format, bad scanline data (run)";for(;count-- >0;)scanLineArray[index++]=b}else{if(0==(count=a)||count>endIndex-index)throw"HDR Bad Format, bad scanline data (non-run)";if(scanLineArray[index++]=b,--count>0)for(var j=0;j<count;j++)scanLineArray[index++]=uint8array[dataIndex++]}for(i=0;i<scanline_width;i++)a=scanLineArray[i],b=scanLineArray[i+scanline_width],c=scanLineArray[i+2*scanline_width],d=scanLineArray[i+3*scanline_width],this.Rgbe2float(resultArray,a,b,c,d,(hdrInfo.height-num_scanlines)*scanline_width*3+3*i);num_scanlines--}return resultArray},HDRTools}();Internals.HDRTools=HDRTools}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var HDRCubeTexture=function(_super){function HDRCubeTexture(url,scene,size,noMipmap,generateHarmonics,useInGammaSpace,usePMREMGenerator,onLoad,onError){void 0===noMipmap&&(noMipmap=!1),void 0===generateHarmonics&&(generateHarmonics=!0),void 0===useInGammaSpace&&(useInGammaSpace=!1),void 0===usePMREMGenerator&&(usePMREMGenerator=!1),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null);var _this=_super.call(this,scene)||this;if(_this._useInGammaSpace=!1,_this._generateHarmonics=!0,_this._isBABYLONPreprocessed=!1,_this._onLoad=null,_this._onError=null,_this.coordinatesMode=BABYLON.Texture.CUBIC_MODE,_this.isPMREM=!1,_this._isBlocking=!0,!url)return _this;_this.name=url,_this.url=url,_this.hasAlpha=!1,_this.isCube=!0,_this._textureMatrix=BABYLON.Matrix.Identity(),_this._onLoad=onLoad,_this._onError=onError,_this.gammaSpace=!1;var caps=scene.getEngine().getCaps();return size?(_this._isBABYLONPreprocessed=!1,_this._noMipmap=noMipmap,_this._size=size,_this._useInGammaSpace=useInGammaSpace,_this._usePMREMGenerator=usePMREMGenerator&&caps.textureLOD&&caps.textureFloat&&!_this._useInGammaSpace):(_this._isBABYLONPreprocessed=!0,_this._noMipmap=!1,_this._useInGammaSpace=!1,_this._usePMREMGenerator=caps.textureLOD&&caps.textureFloat&&!_this._useInGammaSpace),_this.isPMREM=_this._usePMREMGenerator,_this._texture=_this._getFromCache(url,_this._noMipmap),_this._texture||(scene.useDelayedTextureLoading?_this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_NOTLOADED:_this.loadTexture()),_this}return __extends(HDRCubeTexture,_super),Object.defineProperty(HDRCubeTexture.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(value){this._isBlocking=value},enumerable:!0,configurable:!0}),HDRCubeTexture.prototype.loadBabylonTexture=function(){var _this=this,mipLevels=0,floatArrayView=null,scene=this.getScene(),mipmapGenerator=!this._useInGammaSpace&&scene&&scene.getEngine().getCaps().textureFloat?function(data){var mips=new Array;if(!floatArrayView)return mips;for(var startIndex=30,level=0;level<mipLevels;level++){mips.push([]);for(var faceSize=3*Math.pow(_this._size>>level,2),faceIndex=0;faceIndex<6;faceIndex++){var faceData=floatArrayView.subarray(startIndex,startIndex+faceSize);mips[level].push(faceData),startIndex+=faceSize}}return mips}:null;scene&&(this._texture=scene.getEngine().createRawCubeTextureFromUrl(this.url,scene,this._size,BABYLON.Engine.TEXTUREFORMAT_RGB,scene.getEngine().getCaps().textureFloat?BABYLON.Engine.TEXTURETYPE_FLOAT:BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(buffer){var scene=_this.getScene();if(!scene)return null;var intArrayView=new Int32Array(buffer);floatArrayView=new Float32Array(buffer);var version=intArrayView[0];if(_this._size=intArrayView[1],!_this._texture)return null;_this._texture.updateSize(_this._size,_this._size);var sphericalPolynomial=new BABYLON.SphericalPolynomial;sphericalPolynomial.x.copyFromFloats(floatArrayView[2],floatArrayView[3],floatArrayView[4]),sphericalPolynomial.y.copyFromFloats(floatArrayView[5],floatArrayView[6],floatArrayView[7]),sphericalPolynomial.z.copyFromFloats(floatArrayView[8],floatArrayView[9],floatArrayView[10]),sphericalPolynomial.xx.copyFromFloats(floatArrayView[11],floatArrayView[12],floatArrayView[13]),sphericalPolynomial.yy.copyFromFloats(floatArrayView[14],floatArrayView[15],floatArrayView[16]),sphericalPolynomial.zz.copyFromFloats(floatArrayView[17],floatArrayView[18],floatArrayView[19]),sphericalPolynomial.xy.copyFromFloats(floatArrayView[20],floatArrayView[21],floatArrayView[22]),sphericalPolynomial.yz.copyFromFloats(floatArrayView[23],floatArrayView[24],floatArrayView[25]),sphericalPolynomial.zx.copyFromFloats(floatArrayView[26],floatArrayView[27],floatArrayView[28]),_this.sphericalPolynomial=sphericalPolynomial,mipLevels=intArrayView[29];for(var startIndex=30,data=[],faceSize=3*Math.pow(_this._size,2),faceIndex=0;faceIndex<6;faceIndex++)data.push(floatArrayView.subarray(startIndex,startIndex+faceSize)),startIndex+=faceSize;for(var results=[],byteArray=null,k=0;k<6;k++){var dataFace=null;if(1===version&&(dataFace=data[[0,2,4,1,3,5][k]]),!mipmapGenerator&&dataFace){if(!scene.getEngine().getCaps().textureFloat){var byteBuffer=new ArrayBuffer(faceSize);byteArray=new Uint8Array(byteBuffer)}for(var i=0;i<_this._size*_this._size;i++)if(_this._useInGammaSpace&&(dataFace[3*i+0]=Math.pow(dataFace[3*i+0],BABYLON.ToGammaSpace),dataFace[3*i+1]=Math.pow(dataFace[3*i+1],BABYLON.ToGammaSpace),dataFace[3*i+2]=Math.pow(dataFace[3*i+2],BABYLON.ToGammaSpace)),byteArray){var r=Math.max(255*dataFace[3*i+0],0),g=Math.max(255*dataFace[3*i+1],0),b=Math.max(255*dataFace[3*i+2],0),max=Math.max(Math.max(r,g),b);if(max>255){var scale=255/max;r*=scale,g*=scale,b*=scale}byteArray[3*i+0]=r,byteArray[3*i+1]=g,byteArray[3*i+2]=b}}byteArray?results.push(byteArray):results.push(dataFace)}return results},mipmapGenerator,this._onLoad,this._onError))},HDRCubeTexture.prototype.loadHDRTexture=function(){var _this=this,scene=this.getScene();scene&&(this._texture=scene.getEngine().createRawCubeTextureFromUrl(this.url,scene,this._size,BABYLON.Engine.TEXTUREFORMAT_RGB,scene.getEngine().getCaps().textureFloat?BABYLON.Engine.TEXTURETYPE_FLOAT:BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(buffer){var scene=_this.getScene();if(!scene)return null;var data=BABYLON.Internals.HDRTools.GetCubeMapTextureData(buffer,_this._size);if(_this._generateHarmonics){var sphericalPolynomial=BABYLON.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(data);_this.sphericalPolynomial=sphericalPolynomial}for(var results=[],byteArray=null,j=0;j<6;j++){if(!scene.getEngine().getCaps().textureFloat){var byteBuffer=new ArrayBuffer(_this._size*_this._size*3);byteArray=new Uint8Array(byteBuffer)}var dataFace=data[HDRCubeTexture._facesMapping[j]];if(_this._useInGammaSpace||byteArray)for(var i=0;i<_this._size*_this._size;i++)if(_this._useInGammaSpace&&(dataFace[3*i+0]=Math.pow(dataFace[3*i+0],BABYLON.ToGammaSpace),dataFace[3*i+1]=Math.pow(dataFace[3*i+1],BABYLON.ToGammaSpace),dataFace[3*i+2]=Math.pow(dataFace[3*i+2],BABYLON.ToGammaSpace)),byteArray){var r=Math.max(255*dataFace[3*i+0],0),g=Math.max(255*dataFace[3*i+1],0),b=Math.max(255*dataFace[3*i+2],0),max=Math.max(Math.max(r,g),b);if(max>255){var scale=255/max;r*=scale,g*=scale,b*=scale}byteArray[3*i+0]=r,byteArray[3*i+1]=g,byteArray[3*i+2]=b}byteArray?results.push(byteArray):results.push(dataFace)}return results},null,this._onLoad,this._onError))},HDRCubeTexture.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},HDRCubeTexture.prototype.clone=function(){var scene=this.getScene();if(!scene)return this;var size=this._isBABYLONPreprocessed?null:this._size,newTexture=new HDRCubeTexture(this.url,scene,size,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);return newTexture.level=this.level,newTexture.wrapU=this.wrapU,newTexture.wrapV=this.wrapV,newTexture.coordinatesIndex=this.coordinatesIndex,newTexture.coordinatesMode=this.coordinatesMode,newTexture},HDRCubeTexture.prototype.delayLoad=function(){this.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=BABYLON.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},HDRCubeTexture.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},HDRCubeTexture.prototype.setReflectionTextureMatrix=function(value){this._textureMatrix=value},HDRCubeTexture.Parse=function(parsedTexture,scene,rootUrl){var texture=null;if(parsedTexture.name&&!parsedTexture.isRenderTarget){var size=parsedTexture.isBABYLONPreprocessed?null:parsedTexture.size;(texture=new BABYLON.HDRCubeTexture(rootUrl+parsedTexture.name,scene,size,parsedTexture.noMipmap,parsedTexture.generateHarmonics,parsedTexture.useInGammaSpace,parsedTexture.usePMREMGenerator)).name=parsedTexture.name,texture.hasAlpha=parsedTexture.hasAlpha,texture.level=parsedTexture.level,texture.coordinatesMode=parsedTexture.coordinatesMode,texture.isBlocking=parsedTexture.isBlocking}return texture},HDRCubeTexture.prototype.serialize=function(){if(!this.name)return null;var serializationObject={};return serializationObject.name=this.name,serializationObject.hasAlpha=this.hasAlpha,serializationObject.isCube=!0,serializationObject.level=this.level,serializationObject.size=this._size,serializationObject.coordinatesMode=this.coordinatesMode,serializationObject.useInGammaSpace=this._useInGammaSpace,serializationObject.generateHarmonics=this._generateHarmonics,serializationObject.usePMREMGenerator=this._usePMREMGenerator,serializationObject.isBABYLONPreprocessed=this._isBABYLONPreprocessed,serializationObject.customType="BABYLON.HDRCubeTexture",serializationObject.noMipmap=this._noMipmap,serializationObject.isBlocking=this._isBlocking,serializationObject},HDRCubeTexture.generateBabylonHDROnDisk=function(url,size,onError){void 0===onError&&(onError=null);HDRCubeTexture.generateBabylonHDR(url,size,function(buffer){var data=new Blob([buffer],{type:"application/octet-stream"}),objUrl=window.URL.createObjectURL(data),a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=objUrl,a.download="envmap.babylon.hdr",a.click()},onError)},HDRCubeTexture.generateBabylonHDR=function(url,size,callback,onError){void 0===onError&&(onError=null),url&&BABYLON.Tools.IsExponentOfTwo(size)&&BABYLON.Tools.Error("Generation of Babylon HDR is coming back in 3.2.")},HDRCubeTexture._facesMapping=["right","left","up","down","front","back"],HDRCubeTexture}(BABYLON.BaseTexture);BABYLON.HDRCubeTexture=HDRCubeTexture}(BABYLON||(BABYLON={}));var Earcut;!function(Earcut){function linkedList(data,start,end,dim,clockwise){var i,last=null;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)return;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(ear){!pass&&size&&indexCurve(ear,minX,minY,size);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,size?isEarHashed(ear,minX,minY,size):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,size,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,size):earcutLinked(filterPoints(ear,void 0),triangles,dim,minX,minY,size,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,size,void 0),void earcutLinked(c,triangles,dim,minX,minY,size,void 0)}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=findHoleBridge(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;for(p=m.next;p!==stop;)hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}function indexCurve(start,minX,minY,size){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,size)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0===pSize?(e=q,q=q.nextZ,qSize--):0!==qSize&&q?p.z<=q.z?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--):(e=p,p=p.nextZ,pSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){return x=32767*(x-minX)/size,y=32767*(y-minY)/size,x=16711935&(x|x<<8),x=252645135&(x|x<<4),x=858993459&(x|x<<2),x=1431655765&(x|x<<1),y=16711935&(y|y<<8),y=252645135&(y|y<<4),y=858993459&(y|y<<2),y=1431655765&(y|y<<1),x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{p.x<leftmost.x&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))||area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}Earcut.earcut=function(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=new Array;if(!outerNode)return triangles;var maxX,maxY,x,y,minX=0,minY=0,size=0;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);size=Math.max(maxX-minX,maxY-minY)}return earcutLinked(outerNode,triangles,dim,minX,minY,size,0),triangles};var Node=function(){return function(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}();Earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},Earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:new Array,holes:new Array,dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}}(Earcut||(Earcut={}));!function(BABYLON){var IndexedVector2=function(_super){function IndexedVector2(original,index){var _this=_super.call(this,original.x,original.y)||this;return _this.index=index,_this}return __extends(IndexedVector2,_super),IndexedVector2}(BABYLON.Vector2),PolygonPoints=function(){function PolygonPoints(){this.elements=new Array}return PolygonPoints.prototype.add=function(originalPoints){var _this=this,result=new Array;return originalPoints.forEach(function(point){if(0===result.length||!point.equalsWithEpsilon(result[0])){var newPoint=new IndexedVector2(point,_this.elements.length);result.push(newPoint),_this.elements.push(newPoint)}}),result},PolygonPoints.prototype.computeBounds=function(){var lmin=new BABYLON.Vector2(this.elements[0].x,this.elements[0].y),lmax=new BABYLON.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(point){point.x<lmin.x?lmin.x=point.x:point.x>lmax.x&&(lmax.x=point.x),point.y<lmin.y?lmin.y=point.y:point.y>lmax.y&&(lmax.y=point.y)}),{min:lmin,max:lmax,width:lmax.x-lmin.x,height:lmax.y-lmin.y}},PolygonPoints}(),Polygon=function(){function Polygon(){}return Polygon.Rectangle=function(xmin,ymin,xmax,ymax){return[new BABYLON.Vector2(xmin,ymin),new BABYLON.Vector2(xmax,ymin),new BABYLON.Vector2(xmax,ymax),new BABYLON.Vector2(xmin,ymax)]},Polygon.Circle=function(radius,cx,cy,numberOfSides){void 0===cx&&(cx=0),void 0===cy&&(cy=0),void 0===numberOfSides&&(numberOfSides=32);for(var result=new Array,angle=0,increment=2*Math.PI/numberOfSides,i=0;i<numberOfSides;i++)result.push(new BABYLON.Vector2(cx+Math.cos(angle)*radius,cy+Math.sin(angle)*radius)),angle-=increment;return result},Polygon.Parse=function(input){var i,floats=input.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(val){return!isNaN(val)}),result=[];for(i=0;i<(2147483646&floats.length);i+=2)result.push(new BABYLON.Vector2(floats[i],floats[i+1]));return result},Polygon.StartingAt=function(x,y){return BABYLON.Path2.StartingAt(x,y)},Polygon}();BABYLON.Polygon=Polygon;var PolygonMeshBuilder=function(){function PolygonMeshBuilder(name,contours,scene){this._points=new PolygonPoints,this._outlinepoints=new PolygonPoints,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this._name=name,this._scene=scene;var points;points=contours instanceof BABYLON.Path2?contours.getPoints():contours,this._addToepoint(points),this._points.add(points),this._outlinepoints.add(points)}return PolygonMeshBuilder.prototype._addToepoint=function(points){for(var _i=0,points_1=points;_i<points_1.length;_i++){var p=points_1[_i];this._epoints.push(p.x,p.y)}},PolygonMeshBuilder.prototype.addHole=function(hole){this._points.add(hole);var holepoints=new PolygonPoints;return holepoints.add(hole),this._holes.push(holepoints),this._eholes.push(this._epoints.length/2),this._addToepoint(hole),this},PolygonMeshBuilder.prototype.build=function(updatable,depth){var _this=this;void 0===updatable&&(updatable=!1),void 0===depth&&(depth=0);var result=new BABYLON.Mesh(this._name,this._scene),normals=new Array,positions=new Array,uvs=new Array,bounds=this._points.computeBounds();this._points.elements.forEach(function(p){normals.push(0,1,0),positions.push(p.x,0,p.y),uvs.push((p.x-bounds.min.x)/bounds.width,(p.y-bounds.min.y)/bounds.height)});for(var indices=new Array,res=Earcut.earcut(this._epoints,this._eholes,2),i=0;i<res.length;i++)indices.push(res[i]);if(depth>0){var positionscount=positions.length/3;this._points.elements.forEach(function(p){normals.push(0,-1,0),positions.push(p.x,-depth,p.y),uvs.push(1-(p.x-bounds.min.x)/bounds.width,1-(p.y-bounds.min.y)/bounds.height)});for(var totalCount=indices.length,i=0;i<totalCount;i+=3){var i0=indices[i+0],i1=indices[i+1],i2=indices[i+2];indices.push(i2+positionscount),indices.push(i1+positionscount),indices.push(i0+positionscount)}this.addSide(positions,normals,uvs,indices,bounds,this._outlinepoints,depth,!1),this._holes.forEach(function(hole){_this.addSide(positions,normals,uvs,indices,bounds,hole,depth,!0)})}return result.setVerticesData(BABYLON.VertexBuffer.PositionKind,positions,updatable),result.setVerticesData(BABYLON.VertexBuffer.NormalKind,normals,updatable),result.setVerticesData(BABYLON.VertexBuffer.UVKind,uvs,updatable),result.setIndices(indices),result},PolygonMeshBuilder.prototype.addSide=function(positions,normals,uvs,indices,bounds,points,depth,flip){for(var StartIndex=positions.length/3,ulength=0,i=0;i<points.elements.length;i++){var p1,p=points.elements[i];p1=i+1>points.elements.length-1?points.elements[0]:points.elements[i+1],positions.push(p.x,0,p.y),positions.push(p.x,-depth,p.y),positions.push(p1.x,0,p1.y),positions.push(p1.x,-depth,p1.y);var v1=new BABYLON.Vector3(p.x,0,p.y),v3=new BABYLON.Vector3(p1.x,0,p1.y).subtract(v1),v4=new BABYLON.Vector3(0,1,0),vn=BABYLON.Vector3.Cross(v3,v4);vn=vn.normalize(),uvs.push(ulength/bounds.width,0),uvs.push(ulength/bounds.width,1),ulength+=v3.length(),uvs.push(ulength/bounds.width,0),uvs.push(ulength/bounds.width,1),flip?(normals.push(vn.x,vn.y,vn.z),normals.push(vn.x,vn.y,vn.z),normals.push(vn.x,vn.y,vn.z),normals.push(vn.x,vn.y,vn.z),indices.push(StartIndex),indices.push(StartIndex+2),indices.push(StartIndex+1),indices.push(StartIndex+1),indices.push(StartIndex+2),indices.push(StartIndex+3)):(normals.push(-vn.x,-vn.y,-vn.z),normals.push(-vn.x,-vn.y,-vn.z),normals.push(-vn.x,-vn.y,-vn.z),normals.push(-vn.x,-vn.y,-vn.z),indices.push(StartIndex),indices.push(StartIndex+1),indices.push(StartIndex+2),indices.push(StartIndex+1),indices.push(StartIndex+3),indices.push(StartIndex+2)),StartIndex+=4}},PolygonMeshBuilder}();BABYLON.PolygonMeshBuilder=PolygonMeshBuilder}(BABYLON||(BABYLON={}));!function(BABYLON){var currentCSGMeshId=0,Vertex=function(){function Vertex(pos,normal,uv){this.pos=pos,this.normal=normal,this.uv=uv}return Vertex.prototype.clone=function(){return new Vertex(this.pos.clone(),this.normal.clone(),this.uv.clone())},Vertex.prototype.flip=function(){this.normal=this.normal.scale(-1)},Vertex.prototype.interpolate=function(other,t){return new Vertex(BABYLON.Vector3.Lerp(this.pos,other.pos,t),BABYLON.Vector3.Lerp(this.normal,other.normal,t),BABYLON.Vector2.Lerp(this.uv,other.uv,t))},Vertex}(),Plane=function(){function Plane(normal,w){this.normal=normal,this.w=w}return Plane.FromPoints=function(a,b,c){var v0=c.subtract(a),v1=b.subtract(a);if(0===v0.lengthSquared()||0===v1.lengthSquared())return null;var n=BABYLON.Vector3.Normalize(BABYLON.Vector3.Cross(v0,v1));return new Plane(n,BABYLON.Vector3.Dot(n,a))},Plane.prototype.clone=function(){return new Plane(this.normal.clone(),this.w)},Plane.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},Plane.prototype.splitPolygon=function(polygon,coplanarFront,coplanarBack,front,back){var i,t,polygonType=0,types=[];for(i=0;i<polygon.vertices.length;i++){var type=(t=BABYLON.Vector3.Dot(this.normal,polygon.vertices[i].pos)-this.w)<-Plane.EPSILON?2:t>Plane.EPSILON?1:0;polygonType|=type,types.push(type)}switch(polygonType){case 0:(BABYLON.Vector3.Dot(this.normal,polygon.plane.normal)>0?coplanarFront:coplanarBack).push(polygon);break;case 1:front.push(polygon);break;case 2:back.push(polygon);break;case 3:var f=[],b=[];for(i=0;i<polygon.vertices.length;i++){var j=(i+1)%polygon.vertices.length,ti=types[i],tj=types[j],vi=polygon.vertices[i],vj=polygon.vertices[j];if(2!==ti&&f.push(vi),1!==ti&&b.push(2!==ti?vi.clone():vi),3==(ti|tj)){t=(this.w-BABYLON.Vector3.Dot(this.normal,vi.pos))/BABYLON.Vector3.Dot(this.normal,vj.pos.subtract(vi.pos));var v=vi.interpolate(vj,t);f.push(v),b.push(v.clone())}}var poly;f.length>=3&&(poly=new Polygon(f,polygon.shared)).plane&&front.push(poly),b.length>=3&&(poly=new Polygon(b,polygon.shared)).plane&&back.push(poly)}},Plane.EPSILON=1e-5,Plane}(),Polygon=function(){function Polygon(vertices,shared){this.vertices=vertices,this.shared=shared,this.plane=Plane.FromPoints(vertices[0].pos,vertices[1].pos,vertices[2].pos)}return Polygon.prototype.clone=function(){return new Polygon(this.vertices.map(function(v){return v.clone()}),this.shared)},Polygon.prototype.flip=function(){this.vertices.reverse().map(function(v){v.flip()}),this.plane.flip()},Polygon}(),Node=function(){function Node(polygons){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,polygons&&this.build(polygons)}return Node.prototype.clone=function(){var node=new Node;return node.plane=this.plane&&this.plane.clone(),node.front=this.front&&this.front.clone(),node.back=this.back&&this.back.clone(),node.polygons=this.polygons.map(function(p){return p.clone()}),node},Node.prototype.invert=function(){for(var i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var temp=this.front;this.front=this.back,this.back=temp},Node.prototype.clipPolygons=function(polygons){if(!this.plane)return polygons.slice();for(var front=new Array,back=new Array,i=0;i<polygons.length;i++)this.plane.splitPolygon(polygons[i],front,back,front,back);return this.front&&(front=this.front.clipPolygons(front)),back=this.back?this.back.clipPolygons(back):[],front.concat(back)},Node.prototype.clipTo=function(bsp){this.polygons=bsp.clipPolygons(this.polygons),this.front&&this.front.clipTo(bsp),this.back&&this.back.clipTo(bsp)},Node.prototype.allPolygons=function(){var polygons=this.polygons.slice();return this.front&&(polygons=polygons.concat(this.front.allPolygons())),this.back&&(polygons=polygons.concat(this.back.allPolygons())),polygons},Node.prototype.build=function(polygons){if(polygons.length){this.plane||(this.plane=polygons[0].plane.clone());for(var front=new Array,back=new Array,i=0;i<polygons.length;i++)this.plane.splitPolygon(polygons[i],this.polygons,this.polygons,front,back);front.length&&(this.front||(this.front=new Node),this.front.build(front)),back.length&&(this.back||(this.back=new Node),this.back.build(back))}},Node}(),CSG=function(){function CSG(){this.polygons=new Array}return CSG.FromMesh=function(mesh){var vertex,normal,uv,position,polygon,vertices,matrix,meshPosition,meshRotation,meshScaling,polygons=new Array,meshRotationQuaternion=null;if(!(mesh instanceof BABYLON.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";mesh.computeWorldMatrix(!0),matrix=mesh.getWorldMatrix(),meshPosition=mesh.position.clone(),meshRotation=mesh.rotation.clone(),mesh.rotationQuaternion&&(meshRotationQuaternion=mesh.rotationQuaternion.clone()),meshScaling=mesh.scaling.clone();for(var indices=mesh.getIndices(),positions=mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),normals=mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind),uvs=mesh.getVerticesData(BABYLON.VertexBuffer.UVKind),subMeshes=mesh.subMeshes,sm=0,sml=subMeshes.length;sm<sml;sm++)for(var i=subMeshes[sm].indexStart,il=subMeshes[sm].indexCount+subMeshes[sm].indexStart;i<il;i+=3){vertices=[];for(var j=0;j<3;j++){var sourceNormal=new BABYLON.Vector3(normals[3*indices[i+j]],normals[3*indices[i+j]+1],normals[3*indices[i+j]+2]);uv=new BABYLON.Vector2(uvs[2*indices[i+j]],uvs[2*indices[i+j]+1]);var sourcePosition=new BABYLON.Vector3(positions[3*indices[i+j]],positions[3*indices[i+j]+1],positions[3*indices[i+j]+2]);position=BABYLON.Vector3.TransformCoordinates(sourcePosition,matrix),normal=BABYLON.Vector3.TransformNormal(sourceNormal,matrix),vertex=new Vertex(position,normal,uv),vertices.push(vertex)}(polygon=new Polygon(vertices,{subMeshId:sm,meshId:currentCSGMeshId,materialIndex:subMeshes[sm].materialIndex})).plane&&polygons.push(polygon)}var csg=CSG.FromPolygons(polygons);return csg.matrix=matrix,csg.position=meshPosition,csg.rotation=meshRotation,csg.scaling=meshScaling,csg.rotationQuaternion=meshRotationQuaternion,currentCSGMeshId++,csg},CSG.FromPolygons=function(polygons){var csg=new CSG;return csg.polygons=polygons,csg},CSG.prototype.clone=function(){var csg=new CSG;return csg.polygons=this.polygons.map(function(p){return p.clone()}),csg.copyTransformAttributes(this),csg},CSG.prototype.union=function(csg){var a=new Node(this.clone().polygons),b=new Node(csg.clone().polygons);return a.clipTo(b),b.clipTo(a),b.invert(),b.clipTo(a),b.invert(),a.build(b.allPolygons()),CSG.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},CSG.prototype.unionInPlace=function(csg){var a=new Node(this.polygons),b=new Node(csg.polygons);a.clipTo(b),b.clipTo(a),b.invert(),b.clipTo(a),b.invert(),a.build(b.allPolygons()),this.polygons=a.allPolygons()},CSG.prototype.subtract=function(csg){var a=new Node(this.clone().polygons),b=new Node(csg.clone().polygons);return a.invert(),a.clipTo(b),b.clipTo(a),b.invert(),b.clipTo(a),b.invert(),a.build(b.allPolygons()),a.invert(),CSG.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},CSG.prototype.subtractInPlace=function(csg){var a=new Node(this.polygons),b=new Node(csg.polygons);a.invert(),a.clipTo(b),b.clipTo(a),b.invert(),b.clipTo(a),b.invert(),a.build(b.allPolygons()),a.invert(),this.polygons=a.allPolygons()},CSG.prototype.intersect=function(csg){var a=new Node(this.clone().polygons),b=new Node(csg.clone().polygons);return a.invert(),b.clipTo(a),b.invert(),a.clipTo(b),b.clipTo(a),a.build(b.allPolygons()),a.invert(),CSG.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},CSG.prototype.intersectInPlace=function(csg){var a=new Node(this.polygons),b=new Node(csg.polygons);a.invert(),b.clipTo(a),b.invert(),a.clipTo(b),b.clipTo(a),a.build(b.allPolygons()),a.invert(),this.polygons=a.allPolygons()},CSG.prototype.inverse=function(){var csg=this.clone();return csg.inverseInPlace(),csg},CSG.prototype.inverseInPlace=function(){this.polygons.map(function(p){p.flip()})},CSG.prototype.copyTransformAttributes=function(csg){return this.matrix=csg.matrix,this.position=csg.position,this.rotation=csg.rotation,this.scaling=csg.scaling,this.rotationQuaternion=csg.rotationQuaternion,this},CSG.prototype.buildMeshGeometry=function(name,scene,keepSubMeshes){var matrix=this.matrix.clone();matrix.invert();var polygon,vertex_idx,subMesh_obj,mesh=new BABYLON.Mesh(name,scene),vertices=[],indices=[],normals=[],uvs=[],vertex=BABYLON.Vector3.Zero(),normal=BABYLON.Vector3.Zero(),uv=BABYLON.Vector2.Zero(),polygons=this.polygons,polygonIndices=[0,0,0],vertice_dict={},currentIndex=0,subMesh_dict={};keepSubMeshes&&polygons.sort(function(a,b){return a.shared.meshId===b.shared.meshId?a.shared.subMeshId-b.shared.subMeshId:a.shared.meshId-b.shared.meshId});for(var i=0,il=polygons.length;i<il;i++){subMesh_dict[(polygon=polygons[i]).shared.meshId]||(subMesh_dict[polygon.shared.meshId]={}),subMesh_dict[polygon.shared.meshId][polygon.shared.subMeshId]||(subMesh_dict[polygon.shared.meshId][polygon.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:polygon.shared.materialIndex}),subMesh_obj=subMesh_dict[polygon.shared.meshId][polygon.shared.subMeshId];for(var j=2,jl=polygon.vertices.length;j<jl;j++){polygonIndices[0]=0,polygonIndices[1]=j-1,polygonIndices[2]=j;for(var k=0;k<3;k++){vertex.copyFrom(polygon.vertices[polygonIndices[k]].pos),normal.copyFrom(polygon.vertices[polygonIndices[k]].normal),uv.copyFrom(polygon.vertices[polygonIndices[k]].uv);var localVertex=BABYLON.Vector3.TransformCoordinates(vertex,matrix),localNormal=BABYLON.Vector3.TransformNormal(normal,matrix);void 0!==(vertex_idx=vertice_dict[localVertex.x+","+localVertex.y+","+localVertex.z])&&normals[3*vertex_idx]===localNormal.x&&normals[3*vertex_idx+1]===localNormal.y&&normals[3*vertex_idx+2]===localNormal.z&&uvs[2*vertex_idx]===uv.x&&uvs[2*vertex_idx+1]===uv.y||(vertices.push(localVertex.x,localVertex.y,localVertex.z),uvs.push(uv.x,uv.y),normals.push(normal.x,normal.y,normal.z),vertex_idx=vertice_dict[localVertex.x+","+localVertex.y+","+localVertex.z]=vertices.length/3-1),indices.push(vertex_idx),subMesh_obj.indexStart=Math.min(currentIndex,subMesh_obj.indexStart),subMesh_obj.indexEnd=Math.max(currentIndex,subMesh_obj.indexEnd),currentIndex++}}}if(mesh.setVerticesData(BABYLON.VertexBuffer.PositionKind,vertices),mesh.setVerticesData(BABYLON.VertexBuffer.NormalKind,normals),mesh.setVerticesData(BABYLON.VertexBuffer.UVKind,uvs),mesh.setIndices(indices,null),keepSubMeshes){var materialMaxIndex,materialIndexOffset=0;mesh.subMeshes=new Array;for(var m in subMesh_dict){materialMaxIndex=-1;for(var sm in subMesh_dict[m])subMesh_obj=subMesh_dict[m][sm],BABYLON.SubMesh.CreateFromIndices(subMesh_obj.materialIndex+materialIndexOffset,subMesh_obj.indexStart,subMesh_obj.indexEnd-subMesh_obj.indexStart+1,mesh),materialMaxIndex=Math.max(subMesh_obj.materialIndex,materialMaxIndex);materialIndexOffset+=++materialMaxIndex}}return mesh},CSG.prototype.toMesh=function(name,material,scene,keepSubMeshes){var mesh=this.buildMeshGeometry(name,scene,keepSubMeshes);return mesh.material=material,mesh.position.copyFrom(this.position),mesh.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(mesh.rotationQuaternion=this.rotationQuaternion.clone()),mesh.scaling.copyFrom(this.scaling),mesh.computeWorldMatrix(!0),mesh},CSG}();BABYLON.CSG=CSG}(BABYLON||(BABYLON={}));!function(BABYLON){var LensFlare=function(){function LensFlare(size,position,color,imgUrl,system){this.size=size,this.position=position,this.alphaMode=BABYLON.Engine.ALPHA_ONEONE,this.color=color||new BABYLON.Color3(1,1,1),this.texture=imgUrl?new BABYLON.Texture(imgUrl,system.getScene(),!0):null,this._system=system,system.lensFlares.push(this)}return LensFlare.AddFlare=function(size,position,color,imgUrl,system){return new LensFlare(size,position,color,imgUrl,system)},LensFlare.prototype.dispose=function(){this.texture&&this.texture.dispose();var index=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(index,1)},LensFlare}();BABYLON.LensFlare=LensFlare}(BABYLON||(BABYLON={}));!function(BABYLON){var LensFlareSystem=function(){function LensFlareSystem(name,emitter,scene){this.name=name,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=scene||BABYLON.Engine.LastCreatedScene,this._emitter=emitter,this.id=name,scene.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(m){return scene.activeCamera&&m.material&&m.isVisible&&m.isEnabled()&&m.isBlocker&&0!=(m.layerMask&scene.activeCamera.layerMask)};var engine=scene.getEngine(),vertices=[];vertices.push(1,1),vertices.push(-1,1),vertices.push(-1,-1),vertices.push(1,-1),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=new BABYLON.VertexBuffer(engine,vertices,BABYLON.VertexBuffer.PositionKind,!1,!1,2);var indices=[];indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),this._indexBuffer=engine.createIndexBuffer(indices),this._effect=engine.createEffect("lensFlare",[BABYLON.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(LensFlareSystem.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(value){this._isEnabled=value},enumerable:!0,configurable:!0}),LensFlareSystem.prototype.getScene=function(){return this._scene},LensFlareSystem.prototype.getEmitter=function(){return this._emitter},LensFlareSystem.prototype.setEmitter=function(newEmitter){this._emitter=newEmitter},LensFlareSystem.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},LensFlareSystem.prototype.computeEffectivePosition=function(globalViewport){var position=this.getEmitterPosition();return position=BABYLON.Vector3.Project(position,BABYLON.Matrix.Identity(),this._scene.getTransformMatrix(),globalViewport),this._positionX=position.x,this._positionY=position.y,position=BABYLON.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(globalViewport.x-=this.viewportBorder,globalViewport.y-=this.viewportBorder,globalViewport.width+=2*this.viewportBorder,globalViewport.height+=2*this.viewportBorder,position.x+=this.viewportBorder,position.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),position.z>0&&(this._positionX>globalViewport.x&&this._positionX<globalViewport.x+globalViewport.width&&this._positionY>globalViewport.y&&(this._positionY,globalViewport.y,globalViewport.height),!0)},LensFlareSystem.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var direction=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),distance=direction.length();direction.normalize();var ray=new BABYLON.Ray(this._scene.activeCamera.globalPosition,direction),pickInfo=this._scene.pickWithRay(ray,this.meshesSelectionPredicate,!0);return!pickInfo||!pickInfo.hit||pickInfo.distance>distance},LensFlareSystem.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var engine=this._scene.getEngine(),globalViewport=this._scene.activeCamera.viewport.toGlobal(engine.getRenderWidth(!0),engine.getRenderHeight(!0));if(!this.computeEffectivePosition(globalViewport))return!1;if(!this._isVisible())return!1;var awayX,awayY,away=(awayX=this._positionX<this.borderLimit+globalViewport.x?this.borderLimit+globalViewport.x-this._positionX:this._positionX>globalViewport.x+globalViewport.width-this.borderLimit?this._positionX-globalViewport.x-globalViewport.width+this.borderLimit:0)>(awayY=this._positionY<this.borderLimit+globalViewport.y?this.borderLimit+globalViewport.y-this._positionY:this._positionY>globalViewport.y+globalViewport.height-this.borderLimit?this._positionY-globalViewport.y-globalViewport.height+this.borderLimit:0)?awayX:awayY;(away-=this.viewportBorder)>this.borderLimit&&(away=this.borderLimit);var intensity=1-away/this.borderLimit;if(intensity<0)return!1;intensity>1&&(intensity=1),this.viewportBorder>0&&(globalViewport.x+=this.viewportBorder,globalViewport.y+=this.viewportBorder,globalViewport.width-=2*this.viewportBorder,globalViewport.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var centerX=globalViewport.x+globalViewport.width/2,centerY=globalViewport.y+globalViewport.height/2,distX=centerX-this._positionX,distY=centerY-this._positionY;engine.enableEffect(this._effect),engine.setState(!1),engine.setDepthBuffer(!1),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var index=0;index<this.lensFlares.length;index++){var flare=this.lensFlares[index];engine.setAlphaMode(flare.alphaMode);var x=centerX-distX*flare.position,y=centerY-distY*flare.position,cw=flare.size,ch=flare.size*engine.getAspectRatio(this._scene.activeCamera,!0),cx=x/(globalViewport.width+2*globalViewport.x)*2-1,cy=1-y/(globalViewport.height+2*globalViewport.y)*2,viewportMatrix=BABYLON.Matrix.FromValues(cw/2,0,0,0,0,ch/2,0,0,0,0,1,0,cx,cy,0,1);this._effect.setMatrix("viewportMatrix",viewportMatrix),this._effect.setTexture("textureSampler",flare.texture),this._effect.setFloat4("color",flare.color.r*intensity,flare.color.g*intensity,flare.color.b*intensity,1),engine.draw(!0,0,6)}return engine.setDepthBuffer(!0),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE),!0},LensFlareSystem.prototype.dispose=function(){var vertexBuffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];for(vertexBuffer&&(vertexBuffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var index=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(index,1)},LensFlareSystem.Parse=function(parsedLensFlareSystem,scene,rootUrl){var emitter=scene.getLastEntryByID(parsedLensFlareSystem.emitterId),name=parsedLensFlareSystem.name||"lensFlareSystem#"+parsedLensFlareSystem.emitterId,lensFlareSystem=new LensFlareSystem(name,emitter,scene);lensFlareSystem.id=parsedLensFlareSystem.id||name,lensFlareSystem.borderLimit=parsedLensFlareSystem.borderLimit;for(var index=0;index<parsedLensFlareSystem.flares.length;index++){var parsedFlare=parsedLensFlareSystem.flares[index];BABYLON.LensFlare.AddFlare(parsedFlare.size,parsedFlare.position,BABYLON.Color3.FromArray(parsedFlare.color),parsedFlare.textureName?rootUrl+parsedFlare.textureName:"",lensFlareSystem)}return lensFlareSystem},LensFlareSystem.prototype.serialize=function(){var serializationObject={};serializationObject.id=this.id,serializationObject.name=this.name,serializationObject.emitterId=this.getEmitter().id,serializationObject.borderLimit=this.borderLimit,serializationObject.flares=[];for(var index=0;index<this.lensFlares.length;index++){var flare=this.lensFlares[index];serializationObject.flares.push({size:flare.size,position:flare.position,color:flare.color.asArray(),textureName:BABYLON.Tools.GetFilename(flare.texture?flare.texture.name:"")})}return serializationObject},LensFlareSystem}();BABYLON.LensFlareSystem=LensFlareSystem}(BABYLON||(BABYLON={}));!function(BABYLON){var PhysicsJoint=function(){function PhysicsJoint(type,jointData){this.type=type,this.jointData=jointData,jointData.nativeParams=jointData.nativeParams||{}}return Object.defineProperty(PhysicsJoint.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(newJoint){this._physicsJoint,this._physicsJoint=newJoint},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsJoint.prototype,"physicsPlugin",{set:function(physicsPlugin){this._physicsPlugin=physicsPlugin},enumerable:!0,configurable:!0}),PhysicsJoint.prototype.executeNativeFunction=function(func){func(this._physicsPlugin.world,this._physicsJoint)},PhysicsJoint.DistanceJoint=0,PhysicsJoint.HingeJoint=1,PhysicsJoint.BallAndSocketJoint=2,PhysicsJoint.WheelJoint=3,PhysicsJoint.SliderJoint=4,PhysicsJoint.PrismaticJoint=5,PhysicsJoint.UniversalJoint=6,PhysicsJoint.Hinge2Joint=PhysicsJoint.WheelJoint,PhysicsJoint.PointToPointJoint=8,PhysicsJoint.SpringJoint=9,PhysicsJoint.LockJoint=10,PhysicsJoint}();BABYLON.PhysicsJoint=PhysicsJoint;var DistanceJoint=function(_super){function DistanceJoint(jointData){return _super.call(this,PhysicsJoint.DistanceJoint,jointData)||this}return __extends(DistanceJoint,_super),DistanceJoint.prototype.updateDistance=function(maxDistance,minDistance){this._physicsPlugin.updateDistanceJoint(this,maxDistance,minDistance)},DistanceJoint}(PhysicsJoint);BABYLON.DistanceJoint=DistanceJoint;var MotorEnabledJoint=function(_super){function MotorEnabledJoint(type,jointData){return _super.call(this,type,jointData)||this}return __extends(MotorEnabledJoint,_super),MotorEnabledJoint.prototype.setMotor=function(force,maxForce){this._physicsPlugin.setMotor(this,force||0,maxForce)},MotorEnabledJoint.prototype.setLimit=function(upperLimit,lowerLimit){this._physicsPlugin.setLimit(this,upperLimit,lowerLimit)},MotorEnabledJoint}(PhysicsJoint);BABYLON.MotorEnabledJoint=MotorEnabledJoint;var HingeJoint=function(_super){function HingeJoint(jointData){return _super.call(this,PhysicsJoint.HingeJoint,jointData)||this}return __extends(HingeJoint,_super),HingeJoint.prototype.setMotor=function(force,maxForce){this._physicsPlugin.setMotor(this,force||0,maxForce)},HingeJoint.prototype.setLimit=function(upperLimit,lowerLimit){this._physicsPlugin.setLimit(this,upperLimit,lowerLimit)},HingeJoint}(MotorEnabledJoint);BABYLON.HingeJoint=HingeJoint;var Hinge2Joint=function(_super){function Hinge2Joint(jointData){return _super.call(this,PhysicsJoint.Hinge2Joint,jointData)||this}return __extends(Hinge2Joint,_super),Hinge2Joint.prototype.setMotor=function(force,maxForce,motorIndex){void 0===motorIndex&&(motorIndex=0),this._physicsPlugin.setMotor(this,force||0,maxForce,motorIndex)},Hinge2Joint.prototype.setLimit=function(upperLimit,lowerLimit,motorIndex){void 0===motorIndex&&(motorIndex=0),this._physicsPlugin.setLimit(this,upperLimit,lowerLimit,motorIndex)},Hinge2Joint}(MotorEnabledJoint);BABYLON.Hinge2Joint=Hinge2Joint}(BABYLON||(BABYLON={}));!function(BABYLON){var PhysicsImpostor=function(){function PhysicsImpostor(object,type,_options,_scene){void 0===_options&&(_options={mass:0});var _this=this;this.object=object,this.type=type,this._options=_options,this._scene=_scene,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=BABYLON.Vector3.Zero(),this._isDisposed=!1,this._tmpQuat=new BABYLON.Quaternion,this._tmpQuat2=new BABYLON.Quaternion,this.beforeStep=function(){_this._physicsEngine&&(_this.object.translate(_this._deltaPosition,-1),_this._deltaRotationConjugated&&_this.object.rotationQuaternion&&_this.object.rotationQuaternion.multiplyToRef(_this._deltaRotationConjugated,_this.object.rotationQuaternion),_this.object.computeWorldMatrix(!1),_this.object.parent&&_this.object.rotationQuaternion?(_this.getParentsRotation(),_this._tmpQuat.multiplyToRef(_this.object.rotationQuaternion,_this._tmpQuat)):_this._tmpQuat.copyFrom(_this.object.rotationQuaternion||new BABYLON.Quaternion),_this._options.disableBidirectionalTransformation||_this.object.rotationQuaternion&&_this._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(_this,_this.object.getAbsolutePivotPoint(),_this._tmpQuat),_this._onBeforePhysicsStepCallbacks.forEach(function(func){func(_this)}))},this.afterStep=function(){_this._physicsEngine&&(_this._onAfterPhysicsStepCallbacks.forEach(function(func){func(_this)}),_this._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(_this),_this.object.parent&&_this.object.rotationQuaternion&&(_this.getParentsRotation(),_this._tmpQuat.conjugateInPlace(),_this._tmpQuat.multiplyToRef(_this.object.rotationQuaternion,_this.object.rotationQuaternion)),_this.object.setAbsolutePosition(_this.object.position),_this._deltaRotation&&_this.object.rotationQuaternion&&_this.object.rotationQuaternion.multiplyToRef(_this._deltaRotation,_this.object.rotationQuaternion),_this.object.translate(_this._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((_this._onPhysicsCollideCallbacks.length||_this.onCollideEvent)&&_this._physicsEngine){var otherImpostor=_this._physicsEngine.getImpostorWithPhysicsBody(e.body);otherImpostor&&(_this.onCollideEvent&&_this.onCollideEvent(_this,otherImpostor),_this._onPhysicsCollideCallbacks.filter(function(obj){return-1!==obj.otherImpostors.indexOf(otherImpostor)}).forEach(function(obj){obj.callback(_this,otherImpostor)}))}},this.object?(!this._scene&&object.getScene&&(this._scene=object.getScene()),this._scene&&(this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new BABYLON.Quaternion),this._options.mass=void 0===_options.mass?0:_options.mass,this._options.friction=void 0===_options.friction?.2:_options.friction,this._options.restitution=void 0===_options.restitution?.2:_options.restitution,this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&BABYLON.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")):BABYLON.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):BABYLON.Tools.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(PhysicsImpostor.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsImpostor.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(value){this.setMass(value)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsImpostor.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(value){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,value)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsImpostor.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(value){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,value)},enumerable:!0,configurable:!0}),PhysicsImpostor.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},PhysicsImpostor.prototype._getPhysicsParent=function(){return this.object.parent instanceof BABYLON.AbstractMesh?this.object.parent.physicsImpostor:null},PhysicsImpostor.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},PhysicsImpostor.prototype.setScalingUpdated=function(updated){this.forceUpdate()},PhysicsImpostor.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(PhysicsImpostor.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(physicsBody){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=physicsBody,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsImpostor.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(value){this._parent=value},enumerable:!0,configurable:!0}),PhysicsImpostor.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},PhysicsImpostor.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var q=this.object.rotationQuaternion;this.object.rotationQuaternion=PhysicsImpostor.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var size=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=q,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),size}return PhysicsImpostor.DEFAULT_OBJECT_SIZE},PhysicsImpostor.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},PhysicsImpostor.prototype.getParam=function(paramName){return this._options[paramName]},PhysicsImpostor.prototype.setParam=function(paramName,value){this._options[paramName]=value,this._bodyUpdateRequired=!0},PhysicsImpostor.prototype.setMass=function(mass){this.getParam("mass")!==mass&&this.setParam("mass",mass),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,mass)},PhysicsImpostor.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):BABYLON.Vector3.Zero()},PhysicsImpostor.prototype.setLinearVelocity=function(velocity){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,velocity)},PhysicsImpostor.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):BABYLON.Vector3.Zero()},PhysicsImpostor.prototype.setAngularVelocity=function(velocity){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,velocity)},PhysicsImpostor.prototype.executeNativeFunction=function(func){this._physicsEngine&&func(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},PhysicsImpostor.prototype.registerBeforePhysicsStep=function(func){this._onBeforePhysicsStepCallbacks.push(func)},PhysicsImpostor.prototype.unregisterBeforePhysicsStep=function(func){var index=this._onBeforePhysicsStepCallbacks.indexOf(func);index>-1?this._onBeforePhysicsStepCallbacks.splice(index,1):BABYLON.Tools.Warn("Function to remove was not found")},PhysicsImpostor.prototype.registerAfterPhysicsStep=function(func){this._onAfterPhysicsStepCallbacks.push(func)},PhysicsImpostor.prototype.unregisterAfterPhysicsStep=function(func){var index=this._onAfterPhysicsStepCallbacks.indexOf(func);index>-1?this._onAfterPhysicsStepCallbacks.splice(index,1):BABYLON.Tools.Warn("Function to remove was not found")},PhysicsImpostor.prototype.registerOnPhysicsCollide=function(collideAgainst,func){var collidedAgainstList=collideAgainst instanceof Array?collideAgainst:[collideAgainst];this._onPhysicsCollideCallbacks.push({callback:func,otherImpostors:collidedAgainstList})},PhysicsImpostor.prototype.unregisterOnPhysicsCollide=function(collideAgainst,func){var collidedAgainstList=collideAgainst instanceof Array?collideAgainst:[collideAgainst],index=this._onPhysicsCollideCallbacks.indexOf({callback:func,otherImpostors:collidedAgainstList});index>-1?this._onPhysicsCollideCallbacks.splice(index,1):BABYLON.Tools.Warn("Function to remove was not found")},PhysicsImpostor.prototype.getParentsRotation=function(){var parent=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);parent;)parent.rotationQuaternion?this._tmpQuat2.copyFrom(parent.rotationQuaternion):BABYLON.Quaternion.RotationYawPitchRollToRef(parent.rotation.y,parent.rotation.x,parent.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),parent=parent.parent;return this._tmpQuat},PhysicsImpostor.prototype.applyForce=function(force,contactPoint){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,force,contactPoint),this},PhysicsImpostor.prototype.applyImpulse=function(force,contactPoint){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,force,contactPoint),this},PhysicsImpostor.prototype.createJoint=function(otherImpostor,jointType,jointData){var joint=new BABYLON.PhysicsJoint(jointType,jointData);return this.addJoint(otherImpostor,joint),this},PhysicsImpostor.prototype.addJoint=function(otherImpostor,joint){return this._joints.push({otherImpostor:otherImpostor,joint:joint}),this._physicsEngine&&this._physicsEngine.addJoint(this,otherImpostor,joint),this},PhysicsImpostor.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},PhysicsImpostor.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},PhysicsImpostor.prototype.clone=function(newObject){return newObject?new PhysicsImpostor(newObject,this.type,this._options,this._scene):null},PhysicsImpostor.prototype.dispose=function(){var _this=this;this._physicsEngine&&(this._joints.forEach(function(j){_this._physicsEngine&&_this._physicsEngine.removeJoint(_this,j.otherImpostor,j.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},PhysicsImpostor.prototype.setDeltaPosition=function(position){this._deltaPosition.copyFrom(position)},PhysicsImpostor.prototype.setDeltaRotation=function(rotation){this._deltaRotation||(this._deltaRotation=new BABYLON.Quaternion),this._deltaRotation.copyFrom(rotation),this._deltaRotationConjugated=this._deltaRotation.conjugate()},PhysicsImpostor.prototype.getBoxSizeToRef=function(result){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,result),this},PhysicsImpostor.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},PhysicsImpostor.prototype.syncBoneWithImpostor=function(bone,boneMesh,jointPivot,distToJoint,adjustRotation){var tempVec=PhysicsImpostor._tmpVecs[0],mesh=this.object;if(mesh.rotationQuaternion)if(adjustRotation){var tempQuat=PhysicsImpostor._tmpQuat;mesh.rotationQuaternion.multiplyToRef(adjustRotation,tempQuat),bone.setRotationQuaternion(tempQuat,BABYLON.Space.WORLD,boneMesh)}else bone.setRotationQuaternion(mesh.rotationQuaternion,BABYLON.Space.WORLD,boneMesh);tempVec.x=0,tempVec.y=0,tempVec.z=0,jointPivot&&(tempVec.x=jointPivot.x,tempVec.y=jointPivot.y,tempVec.z=jointPivot.z,bone.getDirectionToRef(tempVec,boneMesh,tempVec),void 0!==distToJoint&&null!==distToJoint||(distToJoint=jointPivot.length()),tempVec.x*=distToJoint,tempVec.y*=distToJoint,tempVec.z*=distToJoint),bone.getParent()?(tempVec.addInPlace(mesh.getAbsolutePosition()),bone.setAbsolutePosition(tempVec,boneMesh)):(boneMesh.setAbsolutePosition(mesh.getAbsolutePosition()),boneMesh.position.x-=tempVec.x,boneMesh.position.y-=tempVec.y,boneMesh.position.z-=tempVec.z)},PhysicsImpostor.prototype.syncImpostorWithBone=function(bone,boneMesh,jointPivot,distToJoint,adjustRotation,boneAxis){var mesh=this.object;if(mesh.rotationQuaternion)if(adjustRotation){var tempQuat=PhysicsImpostor._tmpQuat;bone.getRotationQuaternionToRef(BABYLON.Space.WORLD,boneMesh,tempQuat),tempQuat.multiplyToRef(adjustRotation,mesh.rotationQuaternion)}else bone.getRotationQuaternionToRef(BABYLON.Space.WORLD,boneMesh,mesh.rotationQuaternion);var pos=PhysicsImpostor._tmpVecs[0],boneDir=PhysicsImpostor._tmpVecs[1];boneAxis||((boneAxis=PhysicsImpostor._tmpVecs[2]).x=0,boneAxis.y=1,boneAxis.z=0),bone.getDirectionToRef(boneAxis,boneMesh,boneDir),bone.getAbsolutePositionToRef(boneMesh,pos),void 0!==distToJoint&&null!==distToJoint||!jointPivot||(distToJoint=jointPivot.length()),void 0!==distToJoint&&null!==distToJoint&&(pos.x+=boneDir.x*distToJoint,pos.y+=boneDir.y*distToJoint,pos.z+=boneDir.z*distToJoint),mesh.setAbsolutePosition(pos)},PhysicsImpostor.DEFAULT_OBJECT_SIZE=new BABYLON.Vector3(1,1,1),PhysicsImpostor.IDENTITY_QUATERNION=BABYLON.Quaternion.Identity(),PhysicsImpostor._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],PhysicsImpostor._tmpQuat=BABYLON.Quaternion.Identity(),PhysicsImpostor.NoImpostor=0,PhysicsImpostor.SphereImpostor=1,PhysicsImpostor.BoxImpostor=2,PhysicsImpostor.PlaneImpostor=3,PhysicsImpostor.MeshImpostor=4,PhysicsImpostor.CylinderImpostor=7,PhysicsImpostor.ParticleImpostor=8,PhysicsImpostor.HeightmapImpostor=9,PhysicsImpostor}();BABYLON.PhysicsImpostor=PhysicsImpostor}(BABYLON||(BABYLON={}));!function(BABYLON){var PhysicsEngine=function(){function PhysicsEngine(gravity,_physicsPlugin){if(void 0===_physicsPlugin&&(_physicsPlugin=new BABYLON.CannonJSPlugin),this._physicsPlugin=_physicsPlugin,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");gravity=gravity||new BABYLON.Vector3(0,-9.807,0),this.setGravity(gravity),this.setTimeStep()}return PhysicsEngine.prototype.setGravity=function(gravity){this.gravity=gravity,this._physicsPlugin.setGravity(this.gravity)},PhysicsEngine.prototype.setTimeStep=function(newTimeStep){void 0===newTimeStep&&(newTimeStep=1/60),this._physicsPlugin.setTimeStep(newTimeStep)},PhysicsEngine.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},PhysicsEngine.prototype.dispose=function(){this._impostors.forEach(function(impostor){impostor.dispose()}),this._physicsPlugin.dispose()},PhysicsEngine.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},PhysicsEngine.prototype.addImpostor=function(impostor){impostor.uniqueId=this._impostors.push(impostor),impostor.parent||this._physicsPlugin.generatePhysicsBody(impostor)},PhysicsEngine.prototype.removeImpostor=function(impostor){var index=this._impostors.indexOf(impostor);if(index>-1){var removed=this._impostors.splice(index,1);removed.length&&(removed[0].physicsBody=null)}},PhysicsEngine.prototype.addJoint=function(mainImpostor,connectedImpostor,joint){var impostorJoint={mainImpostor:mainImpostor,connectedImpostor:connectedImpostor,joint:joint};joint.physicsPlugin=this._physicsPlugin,this._joints.push(impostorJoint),this._physicsPlugin.generateJoint(impostorJoint)},PhysicsEngine.prototype.removeJoint=function(mainImpostor,connectedImpostor,joint){var matchingJoints=this._joints.filter(function(impostorJoint){return impostorJoint.connectedImpostor===connectedImpostor&&impostorJoint.joint===joint&&impostorJoint.mainImpostor===mainImpostor});matchingJoints.length&&this._physicsPlugin.removeJoint(matchingJoints[0])},PhysicsEngine.prototype._step=function(delta){var _this=this;this._impostors.forEach(function(impostor){impostor.isBodyInitRequired()&&_this._physicsPlugin.generatePhysicsBody(impostor)}),delta>.1?delta=.1:delta<=0&&(delta=1/60),this._physicsPlugin.executeStep(delta,this._impostors)},PhysicsEngine.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},PhysicsEngine.prototype.getImpostors=function(){return this._impostors},PhysicsEngine.prototype.getImpostorForPhysicsObject=function(object){for(var i=0;i<this._impostors.length;++i)if(this._impostors[i].object===object)return this._impostors[i];return null},PhysicsEngine.prototype.getImpostorWithPhysicsBody=function(body){for(var i=0;i<this._impostors.length;++i)if(this._impostors[i].physicsBody===body)return this._impostors[i];return null},PhysicsEngine.Epsilon=.001,PhysicsEngine}();BABYLON.PhysicsEngine=PhysicsEngine}(BABYLON||(BABYLON={}));!function(BABYLON){var PhysicsRadialImpulseFalloff;!function(PhysicsRadialImpulseFalloff){PhysicsRadialImpulseFalloff[PhysicsRadialImpulseFalloff.Constant=0]="Constant",PhysicsRadialImpulseFalloff[PhysicsRadialImpulseFalloff.Linear=1]="Linear"}(PhysicsRadialImpulseFalloff=BABYLON.PhysicsRadialImpulseFalloff||(BABYLON.PhysicsRadialImpulseFalloff={}));var PhysicsUpdraftMode;!function(PhysicsUpdraftMode){PhysicsUpdraftMode[PhysicsUpdraftMode.Center=0]="Center",PhysicsUpdraftMode[PhysicsUpdraftMode.Perpendicular=1]="Perpendicular"}(PhysicsUpdraftMode=BABYLON.PhysicsUpdraftMode||(BABYLON.PhysicsUpdraftMode={}));var PhysicsHelper=function(){function PhysicsHelper(scene){this._scene=scene,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||BABYLON.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return PhysicsHelper.prototype.applyRadialExplosionImpulse=function(origin,radius,strength,falloff){if(void 0===falloff&&(falloff=PhysicsRadialImpulseFalloff.Constant),!this._physicsEngine)return BABYLON.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var impostors=this._physicsEngine.getImpostors();if(0===impostors.length)return null;var event=new PhysicsRadialExplosionEvent(this._scene);return impostors.forEach(function(impostor){var impostorForceAndContactPoint=event.getImpostorForceAndContactPoint(impostor,origin,radius,strength,falloff);impostorForceAndContactPoint&&impostor.applyImpulse(impostorForceAndContactPoint.force,impostorForceAndContactPoint.contactPoint)}),event.dispose(!1),event},PhysicsHelper.prototype.applyRadialExplosionForce=function(origin,radius,strength,falloff){if(void 0===falloff&&(falloff=PhysicsRadialImpulseFalloff.Constant),!this._physicsEngine)return BABYLON.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var impostors=this._physicsEngine.getImpostors();if(0===impostors.length)return null;var event=new PhysicsRadialExplosionEvent(this._scene);return impostors.forEach(function(impostor){var impostorForceAndContactPoint=event.getImpostorForceAndContactPoint(impostor,origin,radius,strength,falloff);impostorForceAndContactPoint&&impostor.applyForce(impostorForceAndContactPoint.force,impostorForceAndContactPoint.contactPoint)}),event.dispose(!1),event},PhysicsHelper.prototype.gravitationalField=function(origin,radius,strength,falloff){if(void 0===falloff&&(falloff=PhysicsRadialImpulseFalloff.Constant),!this._physicsEngine)return BABYLON.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var event=new PhysicsGravitationalFieldEvent(this,this._scene,origin,radius,strength,falloff);return event.dispose(!1),event},PhysicsHelper.prototype.updraft=function(origin,radius,strength,height,updraftMode){if(!this._physicsEngine)return BABYLON.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var event=new PhysicsUpdraftEvent(this._physicsEngine,this._scene,origin,radius,strength,height,updraftMode);return event.dispose(!1),event},PhysicsHelper}();BABYLON.PhysicsHelper=PhysicsHelper;var PhysicsRadialExplosionEvent=function(){function PhysicsRadialExplosionEvent(scene){this._sphereOptions={segments:32,diameter:1},this._rays=[],this._dataFetched=!1,this._scene=scene}return PhysicsRadialExplosionEvent.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere,rays:this._rays}},PhysicsRadialExplosionEvent.prototype.getImpostorForceAndContactPoint=function(impostor,origin,radius,strength,falloff){if(0===impostor.mass)return null;if(!this._intersectsWithSphere(impostor,origin,radius))return null;var impostorObject=impostor.object,direction=impostor.getObjectCenter().subtract(origin),ray=new BABYLON.Ray(origin,direction,radius);this._rays.push(ray);var contactPoint=ray.intersectsMesh(impostorObject).pickedPoint;if(!contactPoint)return null;var distanceFromOrigin=BABYLON.Vector3.Distance(origin,contactPoint);if(distanceFromOrigin>radius)return null;var multiplier=falloff===PhysicsRadialImpulseFalloff.Constant?strength:strength*(1-distanceFromOrigin/radius);return{force:direction.multiplyByFloats(multiplier,multiplier,multiplier),contactPoint:contactPoint}},PhysicsRadialExplosionEvent.prototype.dispose=function(force){var _this=this;void 0===force&&(force=!0),force?this._sphere.dispose():setTimeout(function(){_this._dataFetched||_this._sphere.dispose()},0)},PhysicsRadialExplosionEvent.prototype._prepareSphere=function(){this._sphere||(this._sphere=BABYLON.MeshBuilder.CreateSphere("radialExplosionEventSphere",this._sphereOptions,this._scene),this._sphere.isVisible=!1)},PhysicsRadialExplosionEvent.prototype._intersectsWithSphere=function(impostor,origin,radius){var impostorObject=impostor.object;return this._prepareSphere(),this._sphere.position=origin,this._sphere.scaling=new BABYLON.Vector3(2*radius,2*radius,2*radius),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(impostorObject,!0)},PhysicsRadialExplosionEvent}();BABYLON.PhysicsRadialExplosionEvent=PhysicsRadialExplosionEvent;var PhysicsGravitationalFieldEvent=function(){function PhysicsGravitationalFieldEvent(physicsHelper,scene,origin,radius,strength,falloff){void 0===falloff&&(falloff=PhysicsRadialImpulseFalloff.Constant),this._dataFetched=!1,this._physicsHelper=physicsHelper,this._scene=scene,this._origin=origin,this._radius=radius,this._strength=strength,this._falloff=falloff,this._tickCallback=this._tick.bind(this)}return PhysicsGravitationalFieldEvent.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},PhysicsGravitationalFieldEvent.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},PhysicsGravitationalFieldEvent.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},PhysicsGravitationalFieldEvent.prototype.dispose=function(force){var _this=this;void 0===force&&(force=!0),force?this._sphere.dispose():setTimeout(function(){_this._dataFetched||_this._sphere.dispose()},0)},PhysicsGravitationalFieldEvent.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);else{var radialExplosionEvent=this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);radialExplosionEvent&&(this._sphere=radialExplosionEvent.getData().sphere.clone("radialExplosionEventSphereClone"))}},PhysicsGravitationalFieldEvent}();BABYLON.PhysicsGravitationalFieldEvent=PhysicsGravitationalFieldEvent;var PhysicsUpdraftEvent=function(){function PhysicsUpdraftEvent(physicsEngine,scene,origin,radius,strength,height,updraftMode){this._originTop=BABYLON.Vector3.Zero(),this._originDirection=BABYLON.Vector3.Zero(),this._cylinderPosition=BABYLON.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=physicsEngine,this._scene=scene,this._origin=origin,this._radius=radius,this._strength=strength,this._height=height,this._updraftMode=updraftMode,this._origin.addToRef(new BABYLON.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new BABYLON.Vector3(0,this._height,0),this._originTop),this._updraftMode===PhysicsUpdraftMode.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this)}return PhysicsUpdraftEvent.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},PhysicsUpdraftEvent.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},PhysicsUpdraftEvent.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},PhysicsUpdraftEvent.prototype.dispose=function(force){var _this=this;void 0===force&&(force=!0),force?this._cylinder.dispose():setTimeout(function(){_this._dataFetched||_this._cylinder.dispose()},0)},PhysicsUpdraftEvent.prototype.getImpostorForceAndContactPoint=function(impostor){if(0===impostor.mass)return null;if(!this._intersectsWithCylinder(impostor))return null;var impostorObjectCenter=impostor.getObjectCenter();if(this._updraftMode===PhysicsUpdraftMode.Perpendicular)direction=this._originDirection;else var direction=impostorObjectCenter.subtract(this._originTop);var multiplier=-1*this._strength;return{force:direction.multiplyByFloats(multiplier,multiplier,multiplier),contactPoint:impostorObjectCenter}},PhysicsUpdraftEvent.prototype._tick=function(){var _this=this;this._physicsEngine.getImpostors().forEach(function(impostor){var impostorForceAndContactPoint=_this.getImpostorForceAndContactPoint(impostor);impostorForceAndContactPoint&&impostor.applyForce(impostorForceAndContactPoint.force,impostorForceAndContactPoint.contactPoint)})},PhysicsUpdraftEvent.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=BABYLON.MeshBuilder.CreateCylinder("updraftEventCylinder",{height:this._height,diameter:2*this._radius},this._scene),this._cylinder.isVisible=!1)},PhysicsUpdraftEvent.prototype._intersectsWithCylinder=function(impostor){var impostorObject=impostor.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(impostorObject,!0)},PhysicsUpdraftEvent}();BABYLON.PhysicsUpdraftEvent=PhysicsUpdraftEvent}(BABYLON||(BABYLON={}));!function(BABYLON){var CannonJSPlugin=function(){function CannonJSPlugin(_useDeltaForWorldStep,iterations){void 0===_useDeltaForWorldStep&&(_useDeltaForWorldStep=!0),void 0===iterations&&(iterations=10),this._useDeltaForWorldStep=_useDeltaForWorldStep,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this.BJSCANNON="undefined"!=typeof CANNON?CANNON:"undefined"!=typeof require?require("cannon"):void 0,this._minus90X=new BABYLON.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new BABYLON.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=BABYLON.Vector3.Zero(),this._tmpDeltaPosition=BABYLON.Vector3.Zero(),this._tmpUnityRotation=new BABYLON.Quaternion,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=iterations):BABYLON.Tools.Error("CannonJS is not available. Please make sure you included the js file.")}return CannonJSPlugin.prototype.setGravity=function(gravity){this.world.gravity.copy(gravity)},CannonJSPlugin.prototype.setTimeStep=function(timeStep){this._fixedTimeStep=timeStep},CannonJSPlugin.prototype.getTimeStep=function(){return this._fixedTimeStep},CannonJSPlugin.prototype.executeStep=function(delta,impostors){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?delta:0,3)},CannonJSPlugin.prototype.applyImpulse=function(impostor,force,contactPoint){var worldPoint=new this.BJSCANNON.Vec3(contactPoint.x,contactPoint.y,contactPoint.z),impulse=new this.BJSCANNON.Vec3(force.x,force.y,force.z);impostor.physicsBody.applyImpulse(impulse,worldPoint)},CannonJSPlugin.prototype.applyForce=function(impostor,force,contactPoint){var worldPoint=new this.BJSCANNON.Vec3(contactPoint.x,contactPoint.y,contactPoint.z),impulse=new this.BJSCANNON.Vec3(force.x,force.y,force.z);impostor.physicsBody.applyForce(impulse,worldPoint)},CannonJSPlugin.prototype.generatePhysicsBody=function(impostor){if(impostor.parent)impostor.physicsBody&&(this.removePhysicsBody(impostor),impostor.forceUpdate());else{if(impostor.isBodyInitRequired()){var shape=this._createShape(impostor),oldBody=impostor.physicsBody;oldBody&&this.removePhysicsBody(impostor);var material=this._addMaterial("mat-"+impostor.uniqueId,impostor.getParam("friction"),impostor.getParam("restitution")),bodyCreationObject={mass:impostor.getParam("mass"),material:material},nativeOptions=impostor.getParam("nativeOptions");for(var key in nativeOptions)nativeOptions.hasOwnProperty(key)&&(bodyCreationObject[key]=nativeOptions[key]);impostor.physicsBody=new this.BJSCANNON.Body(bodyCreationObject),impostor.physicsBody.addEventListener("collide",impostor.onCollide),this.world.addEventListener("preStep",impostor.beforeStep),this.world.addEventListener("postStep",impostor.afterStep),impostor.physicsBody.addShape(shape),this.world.add(impostor.physicsBody),oldBody&&["force","torque","velocity","angularVelocity"].forEach(function(param){impostor.physicsBody[param].copy(oldBody[param])}),this._processChildMeshes(impostor)}this._updatePhysicsBodyTransformation(impostor)}},CannonJSPlugin.prototype._processChildMeshes=function(mainImpostor){var _this=this,meshChildren=mainImpostor.object.getChildMeshes?mainImpostor.object.getChildMeshes(!0):[],currentRotation=mainImpostor.object.rotationQuaternion;if(meshChildren.length){var processMesh=function(localPosition,mesh){if(currentRotation&&mesh.rotationQuaternion){var childImpostor=mesh.getPhysicsImpostor();if(childImpostor&&childImpostor.parent!==mainImpostor){var pPosition=mesh.getAbsolutePosition().subtract(mainImpostor.object.getAbsolutePosition()),localRotation=mesh.rotationQuaternion.multiply(BABYLON.Quaternion.Inverse(currentRotation));childImpostor.physicsBody&&(_this.removePhysicsBody(childImpostor),childImpostor.physicsBody=null),childImpostor.parent=mainImpostor,childImpostor.resetUpdateFlags(),mainImpostor.physicsBody.addShape(_this._createShape(childImpostor),new _this.BJSCANNON.Vec3(pPosition.x,pPosition.y,pPosition.z),new _this.BJSCANNON.Quaternion(localRotation.x,localRotation.y,localRotation.z,localRotation.w)),mainImpostor.physicsBody.mass+=childImpostor.getParam("mass")}currentRotation.multiplyInPlace(mesh.rotationQuaternion),mesh.getChildMeshes(!0).filter(function(m){return!!m.physicsImpostor}).forEach(processMesh.bind(_this,mesh.getAbsolutePosition()))}};meshChildren.filter(function(m){return!!m.physicsImpostor}).forEach(processMesh.bind(this,mainImpostor.object.getAbsolutePosition()))}},CannonJSPlugin.prototype.removePhysicsBody=function(impostor){impostor.physicsBody.removeEventListener("collide",impostor.onCollide),this.world.removeEventListener("preStep",impostor.beforeStep),this.world.removeEventListener("postStep",impostor.afterStep),this.world.remove(impostor.physicsBody)},CannonJSPlugin.prototype.generateJoint=function(impostorJoint){var mainBody=impostorJoint.mainImpostor.physicsBody,connectedBody=impostorJoint.connectedImpostor.physicsBody;if(mainBody&&connectedBody){var constraint,jointData=impostorJoint.joint.jointData,constraintData={pivotA:jointData.mainPivot?(new this.BJSCANNON.Vec3).copy(jointData.mainPivot):null,pivotB:jointData.connectedPivot?(new this.BJSCANNON.Vec3).copy(jointData.connectedPivot):null,axisA:jointData.mainAxis?(new this.BJSCANNON.Vec3).copy(jointData.mainAxis):null,axisB:jointData.connectedAxis?(new this.BJSCANNON.Vec3).copy(jointData.connectedAxis):null,maxForce:jointData.nativeParams.maxForce,collideConnected:!!jointData.collision};switch(impostorJoint.joint.type){case BABYLON.PhysicsJoint.HingeJoint:case BABYLON.PhysicsJoint.Hinge2Joint:constraint=new this.BJSCANNON.HingeConstraint(mainBody,connectedBody,constraintData);break;case BABYLON.PhysicsJoint.DistanceJoint:constraint=new this.BJSCANNON.DistanceConstraint(mainBody,connectedBody,jointData.maxDistance||2);break;case BABYLON.PhysicsJoint.SpringJoint:var springData=jointData;constraint=new this.BJSCANNON.Spring(mainBody,connectedBody,{restLength:springData.length,stiffness:springData.stiffness,damping:springData.damping,localAnchorA:constraintData.pivotA,localAnchorB:constraintData.pivotB});break;case BABYLON.PhysicsJoint.LockJoint:constraint=new this.BJSCANNON.LockConstraint(mainBody,connectedBody,constraintData);break;case BABYLON.PhysicsJoint.PointToPointJoint:case BABYLON.PhysicsJoint.BallAndSocketJoint:default:constraint=new this.BJSCANNON.PointToPointConstraint(mainBody,constraintData.pivotA,connectedBody,constraintData.pivotA,constraintData.maxForce)}constraint.collideConnected=!!jointData.collision,impostorJoint.joint.physicsJoint=constraint,impostorJoint.joint.type!==BABYLON.PhysicsJoint.SpringJoint?this.world.addConstraint(constraint):impostorJoint.mainImpostor.registerAfterPhysicsStep(function(){constraint.applyForce()})}},CannonJSPlugin.prototype.removeJoint=function(impostorJoint){this.world.removeConstraint(impostorJoint.joint.physicsJoint)},CannonJSPlugin.prototype._addMaterial=function(name,friction,restitution){var index,mat;for(index=0;index<this._physicsMaterials.length;index++)if((mat=this._physicsMaterials[index]).friction===friction&&mat.restitution===restitution)return mat;var currentMat=new this.BJSCANNON.Material(name);return currentMat.friction=friction,currentMat.restitution=restitution,this._physicsMaterials.push(currentMat),currentMat},CannonJSPlugin.prototype._checkWithEpsilon=function(value){return value<BABYLON.PhysicsEngine.Epsilon?BABYLON.PhysicsEngine.Epsilon:value},CannonJSPlugin.prototype._createShape=function(impostor){var returnValue,object=impostor.object,extendSize=impostor.getObjectExtendSize();switch(impostor.type){case BABYLON.PhysicsImpostor.SphereImpostor:var radiusX=extendSize.x,radiusY=extendSize.y,radiusZ=extendSize.z;returnValue=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(radiusX),this._checkWithEpsilon(radiusY),this._checkWithEpsilon(radiusZ))/2);break;case BABYLON.PhysicsImpostor.CylinderImpostor:returnValue=new this.BJSCANNON.Cylinder(this._checkWithEpsilon(extendSize.x)/2,this._checkWithEpsilon(extendSize.x)/2,this._checkWithEpsilon(extendSize.y),16);break;case BABYLON.PhysicsImpostor.BoxImpostor:var box=extendSize.scale(.5);returnValue=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(box.x),this._checkWithEpsilon(box.y),this._checkWithEpsilon(box.z)));break;case BABYLON.PhysicsImpostor.PlaneImpostor:BABYLON.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),returnValue=new this.BJSCANNON.Plane;break;case BABYLON.PhysicsImpostor.MeshImpostor:var rawVerts=object.getVerticesData?object.getVerticesData(BABYLON.VertexBuffer.PositionKind):[],rawFaces=object.getIndices?object.getIndices():[];if(!rawVerts)return;var oldPosition=object.position.clone(),oldRotation=object.rotation&&object.rotation.clone(),oldQuaternion=object.rotationQuaternion&&object.rotationQuaternion.clone();object.position.copyFromFloats(0,0,0),object.rotation&&object.rotation.copyFromFloats(0,0,0),object.rotationQuaternion&&object.rotationQuaternion.copyFrom(impostor.getParentsRotation()),object.rotationQuaternion&&object.parent&&object.rotationQuaternion.conjugateInPlace();var index,transform=object.computeWorldMatrix(!0),temp=new Array;for(index=0;index<rawVerts.length;index+=3)BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.FromArray(rawVerts,index),transform).toArray(temp,index);BABYLON.Tools.Warn("MeshImpostor only collides against spheres."),returnValue=new this.BJSCANNON.Trimesh(temp,rawFaces),object.position.copyFrom(oldPosition),oldRotation&&object.rotation&&object.rotation.copyFrom(oldRotation),oldQuaternion&&object.rotationQuaternion&&object.rotationQuaternion.copyFrom(oldQuaternion);break;case BABYLON.PhysicsImpostor.HeightmapImpostor:var oldPosition2=object.position.clone(),oldRotation2=object.rotation&&object.rotation.clone(),oldQuaternion2=object.rotationQuaternion&&object.rotationQuaternion.clone();object.position.copyFromFloats(0,0,0),object.rotation&&object.rotation.copyFromFloats(0,0,0),object.rotationQuaternion&&object.rotationQuaternion.copyFrom(impostor.getParentsRotation()),object.rotationQuaternion&&object.parent&&object.rotationQuaternion.conjugateInPlace(),object.rotationQuaternion&&object.rotationQuaternion.multiplyInPlace(this._minus90X),returnValue=this._createHeightmap(object),object.position.copyFrom(oldPosition2),oldRotation2&&object.rotation&&object.rotation.copyFrom(oldRotation2),oldQuaternion2&&object.rotationQuaternion&&object.rotationQuaternion.copyFrom(oldQuaternion2),object.computeWorldMatrix(!0);break;case BABYLON.PhysicsImpostor.ParticleImpostor:returnValue=new this.BJSCANNON.Particle}return returnValue},CannonJSPlugin.prototype._createHeightmap=function(object,pointDepth){var index,pos=object.getVerticesData(BABYLON.VertexBuffer.PositionKind),transform=object.computeWorldMatrix(!0),temp=new Array;for(index=0;index<pos.length;index+=3)BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.FromArray(pos,index),transform).toArray(temp,index);pos=temp;for(var matrix=new Array,arraySize=pointDepth||~~(Math.sqrt(pos.length/3)-1),boundingInfo=object.getBoundingInfo(),dim=Math.min(boundingInfo.boundingBox.extendSizeWorld.x,boundingInfo.boundingBox.extendSizeWorld.y),minY=boundingInfo.boundingBox.extendSizeWorld.z,elementSize=2*dim/arraySize,i=0;i<pos.length;i+=3){var x=Math.round(pos[i+0]/elementSize+arraySize/2),z=Math.round(-1*(pos[i+1]/elementSize-arraySize/2)),y=-pos[i+2]+minY;matrix[x]||(matrix[x]=[]),matrix[x][z]||(matrix[x][z]=y),matrix[x][z]=Math.max(y,matrix[x][z])}for(x=0;x<=arraySize;++x){if(!matrix[x]){for(loc=1;!matrix[(x+loc)%arraySize];)loc++;matrix[x]=matrix[(x+loc)%arraySize].slice()}for(z=0;z<=arraySize;++z)if(!matrix[x][z]){for(var newValue,loc=1;void 0===newValue;)newValue=matrix[x][(z+loc++)%arraySize];matrix[x][z]=newValue}}var shape=new this.BJSCANNON.Heightfield(matrix,{elementSize:elementSize});return shape.minY=minY,shape},CannonJSPlugin.prototype._updatePhysicsBodyTransformation=function(impostor){var object=impostor.object;if(object.computeWorldMatrix&&object.computeWorldMatrix(!0),object.getBoundingInfo()){var center=impostor.getObjectCenter();this._tmpDeltaPosition.copyFrom(object.getAbsolutePivotPoint().subtract(center)),this._tmpPosition.copyFrom(center);var quaternion=object.rotationQuaternion;if(quaternion){if(impostor.type!==BABYLON.PhysicsImpostor.PlaneImpostor&&impostor.type!==BABYLON.PhysicsImpostor.HeightmapImpostor&&impostor.type!==BABYLON.PhysicsImpostor.CylinderImpostor||(quaternion=quaternion.multiply(this._minus90X),impostor.setDeltaRotation(this._plus90X)),impostor.type===BABYLON.PhysicsImpostor.HeightmapImpostor){var mesh=object,boundingInfo=mesh.getBoundingInfo(),rotationQuaternion=mesh.rotationQuaternion;mesh.rotationQuaternion=this._tmpUnityRotation,mesh.computeWorldMatrix(!0);var c=center.clone(),oldPivot=mesh.getPivotMatrix()||BABYLON.Matrix.Translation(0,0,0),p=BABYLON.Matrix.Translation(boundingInfo.boundingBox.extendSizeWorld.x,0,-boundingInfo.boundingBox.extendSizeWorld.z);mesh.setPivotMatrix(p),mesh.computeWorldMatrix(!0);var translation=boundingInfo.boundingBox.centerWorld.subtract(center).subtract(mesh.position).negate();this._tmpPosition.copyFromFloats(translation.x,translation.y-boundingInfo.boundingBox.extendSizeWorld.y,translation.z),this._tmpDeltaPosition.copyFrom(boundingInfo.boundingBox.centerWorld.subtract(c)),this._tmpDeltaPosition.y+=boundingInfo.boundingBox.extendSizeWorld.y,mesh.rotationQuaternion=rotationQuaternion,mesh.setPivotMatrix(oldPivot),mesh.computeWorldMatrix(!0)}else impostor.type===BABYLON.PhysicsImpostor.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);impostor.setDeltaPosition(this._tmpDeltaPosition),impostor.physicsBody.position.copy(this._tmpPosition),impostor.physicsBody.quaternion.copy(quaternion)}}},CannonJSPlugin.prototype.setTransformationFromPhysicsBody=function(impostor){impostor.object.position.copyFrom(impostor.physicsBody.position),impostor.object.rotationQuaternion&&impostor.object.rotationQuaternion.copyFrom(impostor.physicsBody.quaternion)},CannonJSPlugin.prototype.setPhysicsBodyTransformation=function(impostor,newPosition,newRotation){impostor.physicsBody.position.copy(newPosition),impostor.physicsBody.quaternion.copy(newRotation)},CannonJSPlugin.prototype.isSupported=function(){return void 0!==this.BJSCANNON},CannonJSPlugin.prototype.setLinearVelocity=function(impostor,velocity){impostor.physicsBody.velocity.copy(velocity)},CannonJSPlugin.prototype.setAngularVelocity=function(impostor,velocity){impostor.physicsBody.angularVelocity.copy(velocity)},CannonJSPlugin.prototype.getLinearVelocity=function(impostor){var v=impostor.physicsBody.velocity;return v?new BABYLON.Vector3(v.x,v.y,v.z):null},CannonJSPlugin.prototype.getAngularVelocity=function(impostor){var v=impostor.physicsBody.angularVelocity;return v?new BABYLON.Vector3(v.x,v.y,v.z):null},CannonJSPlugin.prototype.setBodyMass=function(impostor,mass){impostor.physicsBody.mass=mass,impostor.physicsBody.updateMassProperties()},CannonJSPlugin.prototype.getBodyMass=function(impostor){return impostor.physicsBody.mass},CannonJSPlugin.prototype.getBodyFriction=function(impostor){return impostor.physicsBody.material.friction},CannonJSPlugin.prototype.setBodyFriction=function(impostor,friction){impostor.physicsBody.material.friction=friction},CannonJSPlugin.prototype.getBodyRestitution=function(impostor){return impostor.physicsBody.material.restitution},CannonJSPlugin.prototype.setBodyRestitution=function(impostor,restitution){impostor.physicsBody.material.restitution=restitution},CannonJSPlugin.prototype.sleepBody=function(impostor){impostor.physicsBody.sleep()},CannonJSPlugin.prototype.wakeUpBody=function(impostor){impostor.physicsBody.wakeUp()},CannonJSPlugin.prototype.updateDistanceJoint=function(joint,maxDistance,minDistance){joint.physicsJoint.distance=maxDistance},CannonJSPlugin.prototype.setMotor=function(joint,speed,maxForce,motorIndex){motorIndex||(joint.physicsJoint.enableMotor(),joint.physicsJoint.setMotorSpeed(speed),maxForce&&this.setLimit(joint,maxForce))},CannonJSPlugin.prototype.setLimit=function(joint,upperLimit,lowerLimit){joint.physicsJoint.motorEquation.maxForce=upperLimit,joint.physicsJoint.motorEquation.minForce=void 0===lowerLimit?-upperLimit:lowerLimit},CannonJSPlugin.prototype.syncMeshWithImpostor=function(mesh,impostor){var body=impostor.physicsBody;mesh.position.x=body.position.x,mesh.position.y=body.position.y,mesh.position.z=body.position.z,mesh.rotationQuaternion&&(mesh.rotationQuaternion.x=body.quaternion.x,mesh.rotationQuaternion.y=body.quaternion.y,mesh.rotationQuaternion.z=body.quaternion.z,mesh.rotationQuaternion.w=body.quaternion.w)},CannonJSPlugin.prototype.getRadius=function(impostor){return impostor.physicsBody.shapes[0].boundingSphereRadius},CannonJSPlugin.prototype.getBoxSizeToRef=function(impostor,result){var shape=impostor.physicsBody.shapes[0];result.x=2*shape.halfExtents.x,result.y=2*shape.halfExtents.y,result.z=2*shape.halfExtents.z},CannonJSPlugin.prototype.dispose=function(){},CannonJSPlugin.prototype._extendNamespace=function(){var step_tmp1=new this.BJSCANNON.Vec3,Engine=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(dt,timeSinceLastCalled,maxSubSteps){if(maxSubSteps=maxSubSteps||10,0===(timeSinceLastCalled=timeSinceLastCalled||0))this.internalStep(dt),this.time+=dt;else{var internalSteps=Math.floor((this.time+timeSinceLastCalled)/dt)-Math.floor(this.time/dt);internalSteps=Math.min(internalSteps,maxSubSteps)||1;for(var t0=performance.now(),i=0;i!==internalSteps&&(this.internalStep(dt),!(performance.now()-t0>1e3*dt));i++);this.time+=timeSinceLastCalled;for(var h_div_dt=this.time%dt/dt,interpvelo=step_tmp1,bodies=this.bodies,j=0;j!==bodies.length;j++){var b=bodies[j];b.type!==Engine.Body.STATIC&&b.sleepState!==Engine.Body.SLEEPING?(b.position.vsub(b.previousPosition,interpvelo),interpvelo.scale(h_div_dt,interpvelo),b.position.vadd(interpvelo,b.interpolatedPosition)):(b.interpolatedPosition.copy(b.position),b.interpolatedQuaternion.copy(b.quaternion))}}}},CannonJSPlugin}();BABYLON.CannonJSPlugin=CannonJSPlugin}(BABYLON||(BABYLON={}));!function(BABYLON){var OimoJSPlugin=function(){function OimoJSPlugin(iterations){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=BABYLON.Vector3.Zero(),this.BJSOIMO="undefined"!=typeof OIMO?OIMO:"undefined"!=typeof require?require("./Oimo"):void 0,this.world=new this.BJSOIMO.World(1/60,2,iterations,!0),this.world.worldscale(1),this.world.clear(),this.world.isNoStat=!0}return OimoJSPlugin.prototype.setGravity=function(gravity){this.world.gravity.copy(gravity)},OimoJSPlugin.prototype.setTimeStep=function(timeStep){this.world.timeStep=timeStep},OimoJSPlugin.prototype.getTimeStep=function(){return this.world.timeStep},OimoJSPlugin.prototype.executeStep=function(delta,impostors){var _this=this;impostors.forEach(function(impostor){impostor.beforeStep()}),this.world.step(),impostors.forEach(function(impostor){impostor.afterStep(),_this._tmpImpostorsArray[impostor.uniqueId]=impostor});for(var contact=this.world.contacts;null!==contact;)if(!contact.touching||contact.body1.sleeping||contact.body2.sleeping){var mainImpostor=this._tmpImpostorsArray[+contact.body1.name],collidingImpostor=this._tmpImpostorsArray[+contact.body2.name];mainImpostor&&collidingImpostor?(mainImpostor.onCollide({body:collidingImpostor.physicsBody}),collidingImpostor.onCollide({body:mainImpostor.physicsBody}),contact=contact.next):contact=contact.next}else contact=contact.next},OimoJSPlugin.prototype.applyImpulse=function(impostor,force,contactPoint){var mass=impostor.physicsBody.massInfo.mass;impostor.physicsBody.applyImpulse(contactPoint.scale(this.BJSOIMO.INV_SCALE),force.scale(this.BJSOIMO.INV_SCALE*mass))},OimoJSPlugin.prototype.applyForce=function(impostor,force,contactPoint){BABYLON.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(impostor,force,contactPoint)},OimoJSPlugin.prototype.generatePhysicsBody=function(impostor){var _this=this;if(impostor.parent)impostor.physicsBody&&(this.removePhysicsBody(impostor),impostor.forceUpdate());else{if(impostor.isBodyInitRequired()){var bodyConfig={name:impostor.uniqueId,config:[impostor.getParam("mass")||1,impostor.getParam("friction"),impostor.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==impostor.getParam("mass"),world:this.world},impostors=[impostor];!function(parent){parent.getChildMeshes&&parent.getChildMeshes().forEach(function(m){m.physicsImpostor&&impostors.push(m.physicsImpostor)})}(impostor.object);var checkWithEpsilon_1=function(value){return Math.max(value,BABYLON.PhysicsEngine.Epsilon)};impostors.forEach(function(i){if(impostor.object.rotationQuaternion){var oldQuaternion=i.object.rotationQuaternion,rot=(new _this.BJSOIMO.Euler).setFromQuaternion({x:impostor.object.rotationQuaternion.x,y:impostor.object.rotationQuaternion.y,z:impostor.object.rotationQuaternion.z,s:impostor.object.rotationQuaternion.w}),extendSize=i.getObjectExtendSize();if(i===impostor){var center=impostor.getObjectCenter();impostor.object.position.subtractToRef(center,_this._tmpPositionVector),bodyConfig.pos.push(center.x),bodyConfig.pos.push(center.y),bodyConfig.pos.push(center.z),bodyConfig.rot.push(rot.x/(_this.BJSOIMO.degtorad||_this.BJSOIMO.TO_RAD)),bodyConfig.rot.push(rot.y/(_this.BJSOIMO.degtorad||_this.BJSOIMO.TO_RAD)),bodyConfig.rot.push(rot.z/(_this.BJSOIMO.degtorad||_this.BJSOIMO.TO_RAD))}else{var localPosition=i.object.getAbsolutePosition().subtract(impostor.object.getAbsolutePosition());bodyConfig.pos.push(localPosition.x),bodyConfig.pos.push(localPosition.y),bodyConfig.pos.push(localPosition.z),bodyConfig.rot.push(0),bodyConfig.rot.push(0),bodyConfig.rot.push(0)}switch(i.type){case BABYLON.PhysicsImpostor.ParticleImpostor:BABYLON.Tools.Warn("No Particle support in this.BJSOIMO.js. using SphereImpostor instead");case BABYLON.PhysicsImpostor.SphereImpostor:var radiusX=extendSize.x,radiusY=extendSize.y,radiusZ=extendSize.z,size=Math.max(checkWithEpsilon_1(radiusX),checkWithEpsilon_1(radiusY),checkWithEpsilon_1(radiusZ))/2;bodyConfig.type.push("sphere"),bodyConfig.size.push(size),bodyConfig.size.push(size),bodyConfig.size.push(size);break;case BABYLON.PhysicsImpostor.CylinderImpostor:var sizeX=checkWithEpsilon_1(extendSize.x)/2,sizeY=checkWithEpsilon_1(extendSize.y);bodyConfig.type.push("cylinder"),bodyConfig.size.push(sizeX),bodyConfig.size.push(sizeY),bodyConfig.size.push(sizeY);break;case BABYLON.PhysicsImpostor.PlaneImpostor:case BABYLON.PhysicsImpostor.BoxImpostor:default:var sizeX=checkWithEpsilon_1(extendSize.x),sizeY=checkWithEpsilon_1(extendSize.y),sizeZ=checkWithEpsilon_1(extendSize.z);bodyConfig.type.push("box"),bodyConfig.size.push(sizeX),bodyConfig.size.push(sizeY),bodyConfig.size.push(sizeZ)}i.object.rotationQuaternion=oldQuaternion}}),impostor.physicsBody=new this.BJSOIMO.Body(bodyConfig).body}else this._tmpPositionVector.copyFromFloats(0,0,0);impostor.setDeltaPosition(this._tmpPositionVector)}},OimoJSPlugin.prototype.removePhysicsBody=function(impostor){this.world.removeRigidBody(impostor.physicsBody)},OimoJSPlugin.prototype.generateJoint=function(impostorJoint){var mainBody=impostorJoint.mainImpostor.physicsBody,connectedBody=impostorJoint.connectedImpostor.physicsBody;if(mainBody&&connectedBody){var type,jointData=impostorJoint.joint.jointData,options=jointData.nativeParams||{},nativeJointData={body1:mainBody,body2:connectedBody,axe1:options.axe1||(jointData.mainAxis?jointData.mainAxis.asArray():null),axe2:options.axe2||(jointData.connectedAxis?jointData.connectedAxis.asArray():null),pos1:options.pos1||(jointData.mainPivot?jointData.mainPivot.asArray():null),pos2:options.pos2||(jointData.connectedPivot?jointData.connectedPivot.asArray():null),min:options.min,max:options.max,collision:options.collision||jointData.collision,spring:options.spring,world:this.world};switch(impostorJoint.joint.type){case BABYLON.PhysicsJoint.BallAndSocketJoint:type="jointBall";break;case BABYLON.PhysicsJoint.SpringJoint:BABYLON.Tools.Warn("this.BJSOIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var springData=jointData;nativeJointData.min=springData.length||nativeJointData.min,nativeJointData.max=Math.max(nativeJointData.min,nativeJointData.max);case BABYLON.PhysicsJoint.DistanceJoint:type="jointDistance",nativeJointData.max=jointData.maxDistance;break;case BABYLON.PhysicsJoint.PrismaticJoint:type="jointPrisme";break;case BABYLON.PhysicsJoint.SliderJoint:type="jointSlide";break;case BABYLON.PhysicsJoint.WheelJoint:type="jointWheel";break;case BABYLON.PhysicsJoint.HingeJoint:default:type="jointHinge"}nativeJointData.type=type,impostorJoint.joint.physicsJoint=new this.BJSOIMO.Link(nativeJointData).joint}},OimoJSPlugin.prototype.removeJoint=function(impostorJoint){try{this.world.removeJoint(impostorJoint.joint.physicsJoint)}catch(e){BABYLON.Tools.Warn(e)}},OimoJSPlugin.prototype.isSupported=function(){return void 0!==this.BJSOIMO},OimoJSPlugin.prototype.setTransformationFromPhysicsBody=function(impostor){if(!impostor.physicsBody.sleeping){if(impostor.physicsBody.shapes.next){var parentShape=this._getLastShape(impostor.physicsBody);impostor.object.position.x=parentShape.position.x*this.BJSOIMO.WORLD_SCALE,impostor.object.position.y=parentShape.position.y*this.BJSOIMO.WORLD_SCALE,impostor.object.position.z=parentShape.position.z*this.BJSOIMO.WORLD_SCALE}else impostor.object.position.copyFrom(impostor.physicsBody.getPosition());impostor.object.rotationQuaternion&&(impostor.object.rotationQuaternion.copyFrom(impostor.physicsBody.getQuaternion()),impostor.object.rotationQuaternion.normalize())}},OimoJSPlugin.prototype.setPhysicsBodyTransformation=function(impostor,newPosition,newRotation){var body=impostor.physicsBody;body.position.init(newPosition.x*this.BJSOIMO.INV_SCALE,newPosition.y*this.BJSOIMO.INV_SCALE,newPosition.z*this.BJSOIMO.INV_SCALE),body.orientation.init(newRotation.w,newRotation.x,newRotation.y,newRotation.z),body.syncShapes(),body.awake()},OimoJSPlugin.prototype._getLastShape=function(body){for(var lastShape=body.shapes;lastShape.next;)lastShape=lastShape.next;return lastShape},OimoJSPlugin.prototype.setLinearVelocity=function(impostor,velocity){impostor.physicsBody.linearVelocity.init(velocity.x,velocity.y,velocity.z)},OimoJSPlugin.prototype.setAngularVelocity=function(impostor,velocity){impostor.physicsBody.angularVelocity.init(velocity.x,velocity.y,velocity.z)},OimoJSPlugin.prototype.getLinearVelocity=function(impostor){var v=impostor.physicsBody.linearVelocity;return v?new BABYLON.Vector3(v.x,v.y,v.z):null},OimoJSPlugin.prototype.getAngularVelocity=function(impostor){var v=impostor.physicsBody.angularVelocity;return v?new BABYLON.Vector3(v.x,v.y,v.z):null},OimoJSPlugin.prototype.setBodyMass=function(impostor,mass){var staticBody=0===mass;impostor.physicsBody.shapes.density=staticBody?1:mass,impostor.physicsBody.setupMass(staticBody?2:1)},OimoJSPlugin.prototype.getBodyMass=function(impostor){return impostor.physicsBody.shapes.density},OimoJSPlugin.prototype.getBodyFriction=function(impostor){return impostor.physicsBody.shapes.friction},OimoJSPlugin.prototype.setBodyFriction=function(impostor,friction){impostor.physicsBody.shapes.friction=friction},OimoJSPlugin.prototype.getBodyRestitution=function(impostor){return impostor.physicsBody.shapes.restitution},OimoJSPlugin.prototype.setBodyRestitution=function(impostor,restitution){impostor.physicsBody.shapes.restitution=restitution},OimoJSPlugin.prototype.sleepBody=function(impostor){impostor.physicsBody.sleep()},OimoJSPlugin.prototype.wakeUpBody=function(impostor){impostor.physicsBody.awake()},OimoJSPlugin.prototype.updateDistanceJoint=function(joint,maxDistance,minDistance){joint.physicsJoint.limitMotor.upperLimit=maxDistance,void 0!==minDistance&&(joint.physicsJoint.limitMotor.lowerLimit=minDistance)},OimoJSPlugin.prototype.setMotor=function(joint,speed,maxForce,motorIndex){var motor=motorIndex?joint.physicsJoint.rotationalLimitMotor2:joint.physicsJoint.rotationalLimitMotor1||joint.physicsJoint.rotationalLimitMotor||joint.physicsJoint.limitMotor;motor&&motor.setMotor(speed,maxForce)},OimoJSPlugin.prototype.setLimit=function(joint,upperLimit,lowerLimit,motorIndex){var motor=motorIndex?joint.physicsJoint.rotationalLimitMotor2:joint.physicsJoint.rotationalLimitMotor1||joint.physicsJoint.rotationalLimitMotor||joint.physicsJoint.limitMotor;motor&&motor.setLimit(upperLimit,void 0===lowerLimit?-upperLimit:lowerLimit)},OimoJSPlugin.prototype.syncMeshWithImpostor=function(mesh,impostor){var body=impostor.physicsBody;mesh.position.x=body.position.x,mesh.position.y=body.position.y,mesh.position.z=body.position.z,mesh.rotationQuaternion&&(mesh.rotationQuaternion.x=body.orientation.x,mesh.rotationQuaternion.y=body.orientation.y,mesh.rotationQuaternion.z=body.orientation.z,mesh.rotationQuaternion.w=body.orientation.s)},OimoJSPlugin.prototype.getRadius=function(impostor){return impostor.physicsBody.shapes.radius},OimoJSPlugin.prototype.getBoxSizeToRef=function(impostor,result){var shape=impostor.physicsBody.shapes;result.x=2*shape.halfWidth,result.y=2*shape.halfHeight,result.z=2*shape.halfDepth},OimoJSPlugin.prototype.dispose=function(){this.world.clear()},OimoJSPlugin}();BABYLON.OimoJSPlugin=OimoJSPlugin}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var TGATools=function(){function TGATools(){}return TGATools.GetTGAHeader=function(data){var offset=0;return{id_length:data[offset++],colormap_type:data[offset++],image_type:data[offset++],colormap_index:data[offset++]|data[offset++]<<8,colormap_length:data[offset++]|data[offset++]<<8,colormap_size:data[offset++],origin:[data[offset++]|data[offset++]<<8,data[offset++]|data[offset++]<<8],width:data[offset++]|data[offset++]<<8,height:data[offset++]|data[offset++]<<8,pixel_size:data[offset++],flags:data[offset++]}},TGATools.UploadContent=function(gl,data){if(data.length<19)BABYLON.Tools.Error("Unable to load TGA file - Not enough data to contain header");else{var offset=18,header=TGATools.GetTGAHeader(data);if(header.id_length+offset>data.length)BABYLON.Tools.Error("Unable to load TGA file - Not enough data");else{offset+=header.id_length;var use_rle=!1,use_pal=!1,use_grey=!1;switch(header.image_type){case TGATools._TYPE_RLE_INDEXED:use_rle=!0;case TGATools._TYPE_INDEXED:use_pal=!0;break;case TGATools._TYPE_RLE_RGB:use_rle=!0;case TGATools._TYPE_RGB:break;case TGATools._TYPE_RLE_GREY:use_rle=!0;case TGATools._TYPE_GREY:use_grey=!0}var pixel_data,palettes,pixel_size=header.pixel_size>>3,pixel_total=header.width*header.height*pixel_size;if(use_pal&&(palettes=data.subarray(offset,offset+=header.colormap_length*(header.colormap_size>>3))),use_rle){pixel_data=new Uint8Array(pixel_total);for(var c,count,i,localOffset=0,pixels=new Uint8Array(pixel_size);offset<pixel_total&&localOffset<pixel_total;)if(c=data[offset++],count=1+(127&c),128&c){for(i=0;i<pixel_size;++i)pixels[i]=data[offset++];for(i=0;i<count;++i)pixel_data.set(pixels,localOffset+i*pixel_size);localOffset+=pixel_size*count}else{for(count*=pixel_size,i=0;i<count;++i)pixel_data[localOffset+i]=data[offset++];localOffset+=count}}else pixel_data=data.subarray(offset,offset+=use_pal?header.width*header.height:pixel_total);var x_start,y_start,x_step,y_step,y_end,x_end;switch((header.flags&TGATools._ORIGIN_MASK)>>TGATools._ORIGIN_SHIFT){default:case TGATools._ORIGIN_UL:x_start=0,x_step=1,x_end=header.width,y_start=0,y_step=1,y_end=header.height;break;case TGATools._ORIGIN_BL:x_start=0,x_step=1,x_end=header.width,y_start=header.height-1,y_step=-1,y_end=-1;break;case TGATools._ORIGIN_UR:x_start=header.width-1,x_step=-1,x_end=-1,y_start=0,y_step=1,y_end=header.height;break;case TGATools._ORIGIN_BR:x_start=header.width-1,x_step=-1,x_end=-1,y_start=header.height-1,y_step=-1,y_end=-1}var imageData=TGATools["_getImageData"+(use_grey?"Grey":"")+header.pixel_size+"bits"](header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,header.width,header.height,0,gl.RGBA,gl.UNSIGNED_BYTE,imageData)}}},TGATools._getImageData8bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var color,x,y,image=pixel_data,colormap=palettes,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i++)color=image[i],imageData[4*(x+width*y)+3]=255,imageData[4*(x+width*y)+2]=colormap[3*color+0],imageData[4*(x+width*y)+1]=colormap[3*color+1],imageData[4*(x+width*y)+0]=colormap[3*color+2];return imageData},TGATools._getImageData16bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var color,x,y,image=pixel_data,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=2)color=image[i+0]+(image[i+1]<<8),imageData[4*(x+width*y)+0]=(31744&color)>>7,imageData[4*(x+width*y)+1]=(992&color)>>2,imageData[4*(x+width*y)+2]=(31&color)>>3,imageData[4*(x+width*y)+3]=32768&color?0:255;return imageData},TGATools._getImageData24bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var x,y,image=pixel_data,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=3)imageData[4*(x+width*y)+3]=255,imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+1]=image[i+1],imageData[4*(x+width*y)+0]=image[i+2];return imageData},TGATools._getImageData32bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var x,y,image=pixel_data,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=4)imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+1]=image[i+1],imageData[4*(x+width*y)+0]=image[i+2],imageData[4*(x+width*y)+3]=image[i+3];return imageData},TGATools._getImageDataGrey8bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var color,x,y,image=pixel_data,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i++)color=image[i],imageData[4*(x+width*y)+0]=color,imageData[4*(x+width*y)+1]=color,imageData[4*(x+width*y)+2]=color,imageData[4*(x+width*y)+3]=255;return imageData},TGATools._getImageDataGrey16bits=function(header,palettes,pixel_data,y_start,y_step,y_end,x_start,x_step,x_end){var x,y,image=pixel_data,width=header.width,height=header.height,i=0,imageData=new Uint8Array(width*height*4);for(y=y_start;y!==y_end;y+=y_step)for(x=x_start;x!==x_end;x+=x_step,i+=2)imageData[4*(x+width*y)+0]=image[i+0],imageData[4*(x+width*y)+1]=image[i+0],imageData[4*(x+width*y)+2]=image[i+0],imageData[4*(x+width*y)+3]=image[i+1];return imageData},TGATools._TYPE_INDEXED=1,TGATools._TYPE_RGB=2,TGATools._TYPE_GREY=3,TGATools._TYPE_RLE_INDEXED=9,TGATools._TYPE_RLE_RGB=10,TGATools._TYPE_RLE_GREY=11,TGATools._ORIGIN_MASK=48,TGATools._ORIGIN_SHIFT=4,TGATools._ORIGIN_BL=0,TGATools._ORIGIN_BR=1,TGATools._ORIGIN_UL=2,TGATools._ORIGIN_UR=3,TGATools}();Internals.TGATools=TGATools}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){function FourCCToInt32(value){return value.charCodeAt(0)+(value.charCodeAt(1)<<8)+(value.charCodeAt(2)<<16)+(value.charCodeAt(3)<<24)}function Int32ToFourCC(value){return String.fromCharCode(255&value,value>>8&255,value>>16&255,value>>24&255)}var FOURCC_DXT1=FourCCToInt32("DXT1"),FOURCC_DXT3=FourCCToInt32("DXT3"),FOURCC_DXT5=FourCCToInt32("DXT5"),FOURCC_DX10=FourCCToInt32("DX10"),DDSTools=function(){function DDSTools(){}return DDSTools.GetDDSInfo=function(arrayBuffer){var header=new Int32Array(arrayBuffer,0,31),extendedHeader=new Int32Array(arrayBuffer,0,35),mipmapCount=1;131072&header[2]&&(mipmapCount=Math.max(1,header[7]));var fourCC=header[21],dxgiFormat=fourCC===FOURCC_DX10?extendedHeader[32]:0,textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT;switch(fourCC){case 113:textureType=BABYLON.Engine.TEXTURETYPE_HALF_FLOAT;break;case 116:textureType=BABYLON.Engine.TEXTURETYPE_FLOAT;break;case FOURCC_DX10:if(10===dxgiFormat){textureType=BABYLON.Engine.TEXTURETYPE_HALF_FLOAT;break}}return{width:header[4],height:header[3],mipmapCount:mipmapCount,isFourCC:4==(4&header[20]),isRGB:64==(64&header[20]),isLuminance:131072==(131072&header[20]),isCube:512==(512&header[28]),isCompressed:fourCC===FOURCC_DXT1||fourCC===FOURCC_DXT3||fourCC===FOURCC_DXT5,dxgiFormat:dxgiFormat,textureType:textureType}},DDSTools._ToHalfFloat=function(value){DDSTools._FloatView||(DDSTools._FloatView=new Float32Array(1),DDSTools._Int32View=new Int32Array(DDSTools._FloatView.buffer)),DDSTools._FloatView[0]=value;var x=DDSTools._Int32View[0],bits=x>>16&32768,m=x>>12&2047,e=x>>23&255;return e<103?bits:e>142?(bits|=31744,bits|=(255==e?0:1)&&8388607&x):e<113?(m|=2048,bits|=(m>>114-e)+(m>>113-e&1)):(bits|=e-112<<10|m>>1,bits+=1&m)},DDSTools._FromHalfFloat=function(value){var s=(32768&value)>>15,e=(31744&value)>>10,f=1023&value;return 0===e?(s?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):31==e?f?NaN:1/0*(s?-1:1):(s?-1:1)*Math.pow(2,e-15)*(1+f/Math.pow(2,10))},DDSTools._GetHalfFloatAsFloatRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer,lod){for(var destArray=new Float32Array(dataLength),srcData=new Uint16Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);destArray[index]=DDSTools._FromHalfFloat(srcData[srcPos]),destArray[index+1]=DDSTools._FromHalfFloat(srcData[srcPos+1]),destArray[index+2]=DDSTools._FromHalfFloat(srcData[srcPos+2]),destArray[index+3]=DDSTools.StoreLODInAlphaChannel?lod:DDSTools._FromHalfFloat(srcData[srcPos+3]),index+=4}return destArray},DDSTools._GetHalfFloatRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer,lod){if(DDSTools.StoreLODInAlphaChannel){for(var destArray=new Uint16Array(dataLength),srcData=new Uint16Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);destArray[index]=srcData[srcPos],destArray[index+1]=srcData[srcPos+1],destArray[index+2]=srcData[srcPos+2],destArray[index+3]=DDSTools._ToHalfFloat(lod),index+=4}return destArray}return new Uint16Array(arrayBuffer,dataOffset,dataLength)},DDSTools._GetFloatRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer,lod){if(DDSTools.StoreLODInAlphaChannel){for(var destArray=new Float32Array(dataLength),srcData=new Float32Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);destArray[index]=srcData[srcPos],destArray[index+1]=srcData[srcPos+1],destArray[index+2]=srcData[srcPos+2],destArray[index+3]=lod,index+=4}return destArray}return new Float32Array(arrayBuffer,dataOffset,dataLength)},DDSTools._GetFloatAsUIntRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer,lod){for(var destArray=new Uint8Array(dataLength),srcData=new Float32Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);destArray[index]=255*BABYLON.Scalar.Clamp(srcData[srcPos]),destArray[index+1]=255*BABYLON.Scalar.Clamp(srcData[srcPos+1]),destArray[index+2]=255*BABYLON.Scalar.Clamp(srcData[srcPos+2]),destArray[index+3]=DDSTools.StoreLODInAlphaChannel?lod:255*BABYLON.Scalar.Clamp(srcData[srcPos+3]),index+=4}return destArray},DDSTools._GetHalfFloatAsUIntRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer,lod){for(var destArray=new Uint8Array(dataLength),srcData=new Uint16Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);destArray[index]=255*BABYLON.Scalar.Clamp(DDSTools._FromHalfFloat(srcData[srcPos])),destArray[index+1]=255*BABYLON.Scalar.Clamp(DDSTools._FromHalfFloat(srcData[srcPos+1])),destArray[index+2]=255*BABYLON.Scalar.Clamp(DDSTools._FromHalfFloat(srcData[srcPos+2])),destArray[index+3]=DDSTools.StoreLODInAlphaChannel?lod:255*BABYLON.Scalar.Clamp(DDSTools._FromHalfFloat(srcData[srcPos+3])),index+=4}return destArray},DDSTools._GetRGBAArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer){for(var byteArray=new Uint8Array(dataLength),srcData=new Uint8Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=4*(x+y*width);byteArray[index]=srcData[srcPos+2],byteArray[index+1]=srcData[srcPos+1],byteArray[index+2]=srcData[srcPos],byteArray[index+3]=srcData[srcPos+3],index+=4}return byteArray},DDSTools._GetRGBArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer){for(var byteArray=new Uint8Array(dataLength),srcData=new Uint8Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=3*(x+y*width);byteArray[index]=srcData[srcPos+2],byteArray[index+1]=srcData[srcPos+1],byteArray[index+2]=srcData[srcPos],index+=3}return byteArray},DDSTools._GetLuminanceArrayBuffer=function(width,height,dataOffset,dataLength,arrayBuffer){for(var byteArray=new Uint8Array(dataLength),srcData=new Uint8Array(arrayBuffer,dataOffset),index=0,y=0;y<height;y++)for(var x=0;x<width;x++){var srcPos=x+y*width;byteArray[index]=srcData[srcPos],index++}return byteArray},DDSTools.UploadDDSLevels=function(engine,gl,arrayBuffer,info,loadMipmaps,faces,lodIndex,currentFace){void 0===lodIndex&&(lodIndex=-1);var fourCC,width,height,dataOffset,byteArray,mipmapCount,mip,ext=engine.getCaps().s3tc,header=new Int32Array(arrayBuffer,0,31),dataLength=0,internalFormat=0,format=0,blockBytes=1;if(542327876===header[0])if(info.isFourCC||info.isRGB||info.isLuminance)if(!info.isCompressed||ext){var bpp=header[22];dataOffset=header[1]+4;var computeFormats=!1;if(info.isFourCC)switch(fourCC=header[21]){case FOURCC_DXT1:blockBytes=8,internalFormat=ext.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case FOURCC_DXT3:blockBytes=16,internalFormat=ext.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case FOURCC_DXT5:blockBytes=16,internalFormat=ext.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:computeFormats=!0;break;case FOURCC_DX10:dataOffset+=20;var supported=!1;switch(info.dxgiFormat){case 10:computeFormats=!0,supported=!0;break;case 88:info.isRGB=!0,info.isFourCC=!1,bpp=32,supported=!0}if(supported)break;default:return void console.error("Unsupported FourCC code:",Int32ToFourCC(fourCC))}computeFormats&&(format=engine._getWebGLTextureType(info.textureType),internalFormat=engine._getRGBABufferInternalSizedFormat(info.textureType)),mipmapCount=1,131072&header[2]&&!1!==loadMipmaps&&(mipmapCount=Math.max(1,header[7]));for(var face=0;face<faces;face++){var sampler=1===faces?gl.TEXTURE_2D:gl.TEXTURE_CUBE_MAP_POSITIVE_X+face+(currentFace||0);for(width=header[4],height=header[3],mip=0;mip<mipmapCount;++mip){if(-1===lodIndex||lodIndex===mip){var i=-1===lodIndex?mip:0;if(!info.isCompressed&&info.isFourCC){dataLength=width*height*4;var floatArray=null;engine.badOS||engine.badDesktopOS||!engine.getCaps().textureHalfFloat&&!engine.getCaps().textureFloat?(128===bpp?floatArray=DDSTools._GetFloatAsUIntRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer,i):64===bpp&&(floatArray=DDSTools._GetHalfFloatAsUIntRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer,i)),info.textureType=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,format=engine._getWebGLTextureType(info.textureType),internalFormat=engine._getRGBABufferInternalSizedFormat(info.textureType)):128===bpp?floatArray=DDSTools._GetFloatRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer,i):64!==bpp||engine.getCaps().textureHalfFloat?floatArray=DDSTools._GetHalfFloatRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer,i):(floatArray=DDSTools._GetHalfFloatAsFloatRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer,i),info.textureType=BABYLON.Engine.TEXTURETYPE_FLOAT,format=engine._getWebGLTextureType(info.textureType),internalFormat=engine._getRGBABufferInternalSizedFormat(info.textureType)),floatArray&&engine._uploadDataToTexture(sampler,i,internalFormat,width,height,gl.RGBA,format,floatArray)}else if(info.isRGB)24===bpp?(dataLength=width*height*3,byteArray=DDSTools._GetRGBArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer),engine._uploadDataToTexture(sampler,i,gl.RGB,width,height,gl.RGB,gl.UNSIGNED_BYTE,byteArray)):(dataLength=width*height*4,byteArray=DDSTools._GetRGBAArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer),engine._uploadDataToTexture(sampler,i,gl.RGBA,width,height,gl.RGBA,gl.UNSIGNED_BYTE,byteArray));else if(info.isLuminance){var unpackAlignment=gl.getParameter(gl.UNPACK_ALIGNMENT),unpaddedRowSize=width;dataLength=Math.floor((width+unpackAlignment-1)/unpackAlignment)*unpackAlignment*(height-1)+unpaddedRowSize,byteArray=DDSTools._GetLuminanceArrayBuffer(width,height,dataOffset,dataLength,arrayBuffer),engine._uploadDataToTexture(sampler,i,gl.LUMINANCE,width,height,gl.LUMINANCE,gl.UNSIGNED_BYTE,byteArray)}else dataLength=Math.max(4,width)/4*Math.max(4,height)/4*blockBytes,byteArray=new Uint8Array(arrayBuffer,dataOffset,dataLength),engine._uploadCompressedDataToTexture(sampler,i,internalFormat,width,height,byteArray)}dataOffset+=bpp?width*height*(bpp/8):dataLength,width*=.5,height*=.5,width=Math.max(1,width),height=Math.max(1,height)}if(void 0!==currentFace)break}}else BABYLON.Tools.Error("Compressed textures are not supported on this platform.");else BABYLON.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else BABYLON.Tools.Error("Invalid magic number in DDS header")},DDSTools.StoreLODInAlphaChannel=!1,DDSTools}();Internals.DDSTools=DDSTools}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var KhronosTextureContainer=function(){function KhronosTextureContainer(arrayBuffer,facesExpected,threeDExpected,textureArrayExpected){this.arrayBuffer=arrayBuffer;var identifier=new Uint8Array(this.arrayBuffer,0,12);if(171===identifier[0]&&75===identifier[1]&&84===identifier[2]&&88===identifier[3]&&32===identifier[4]&&49===identifier[5]&&49===identifier[6]&&187===identifier[7]&&13===identifier[8]&&10===identifier[9]&&26===identifier[10]&&10===identifier[11]){var header=new Int32Array(this.arrayBuffer,12,13),oppositeEndianess=16909060===header[0];this.glType=oppositeEndianess?this.switchEndainness(header[1]):header[1],this.glTypeSize=oppositeEndianess?this.switchEndainness(header[2]):header[2],this.glFormat=oppositeEndianess?this.switchEndainness(header[3]):header[3],this.glInternalFormat=oppositeEndianess?this.switchEndainness(header[4]):header[4],this.glBaseInternalFormat=oppositeEndianess?this.switchEndainness(header[5]):header[5],this.pixelWidth=oppositeEndianess?this.switchEndainness(header[6]):header[6],this.pixelHeight=oppositeEndianess?this.switchEndainness(header[7]):header[7],this.pixelDepth=oppositeEndianess?this.switchEndainness(header[8]):header[8],this.numberOfArrayElements=oppositeEndianess?this.switchEndainness(header[9]):header[9],this.numberOfFaces=oppositeEndianess?this.switchEndainness(header[10]):header[10],this.numberOfMipmapLevels=oppositeEndianess?this.switchEndainness(header[11]):header[11],this.bytesOfKeyValueData=oppositeEndianess?this.switchEndainness(header[12]):header[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===facesExpected?this.loadType=KhronosTextureContainer.COMPRESSED_2D:BABYLON.Tools.Error("number of faces expected"+facesExpected+", but found "+this.numberOfFaces):BABYLON.Tools.Error("texture arrays not currently supported"):BABYLON.Tools.Error("only 2D textures currently supported")):BABYLON.Tools.Error("only compressed formats currently supported")}else BABYLON.Tools.Error("texture missing KTX identifier")}return KhronosTextureContainer.prototype.switchEndainness=function(val){return(255&val)<<24|(65280&val)<<8|val>>8&65280|val>>24&255},KhronosTextureContainer.prototype.uploadLevels=function(gl,loadMipmaps){switch(this.loadType){case KhronosTextureContainer.COMPRESSED_2D:this._upload2DCompressedLevels(gl,loadMipmaps);break;case KhronosTextureContainer.TEX_2D:case KhronosTextureContainer.COMPRESSED_3D:case KhronosTextureContainer.TEX_3D:}},KhronosTextureContainer.prototype._upload2DCompressedLevels=function(gl,loadMipmaps){for(var dataOffset=KhronosTextureContainer.HEADER_LEN+this.bytesOfKeyValueData,width=this.pixelWidth,height=this.pixelHeight,mipmapCount=loadMipmaps?this.numberOfMipmapLevels:1,level=0;level<mipmapCount;level++){for(var imageSize=new Int32Array(this.arrayBuffer,dataOffset,1)[0],face=0;face<this.numberOfFaces;face++){var sampler=1===this.numberOfFaces?gl.TEXTURE_2D:gl.TEXTURE_CUBE_MAP_POSITIVE_X+face,byteArray=new Uint8Array(this.arrayBuffer,dataOffset+4,imageSize);gl.compressedTexImage2D(sampler,level,this.glInternalFormat,width,height,0,byteArray),dataOffset+=imageSize+4,dataOffset+=3-(imageSize+3)%4}width=Math.max(1,.5*width),height=Math.max(1,.5*height)}},KhronosTextureContainer.HEADER_LEN=64,KhronosTextureContainer.COMPRESSED_2D=0,KhronosTextureContainer.COMPRESSED_3D=1,KhronosTextureContainer.TEX_2D=2,KhronosTextureContainer.TEX_3D=3,KhronosTextureContainer}();Internals.KhronosTextureContainer=KhronosTextureContainer}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Debug){var SkeletonViewer=function(){function SkeletonViewer(skeleton,mesh,scene,autoUpdateBonesMatrices,renderingGroupId){void 0===autoUpdateBonesMatrices&&(autoUpdateBonesMatrices=!0),void 0===renderingGroupId&&(renderingGroupId=1),this.skeleton=skeleton,this.mesh=mesh,this.autoUpdateBonesMatrices=autoUpdateBonesMatrices,this.renderingGroupId=renderingGroupId,this.color=BABYLON.Color3.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=scene,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(SkeletonViewer.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(value){this._isEnabled!==value&&(this._isEnabled=value,value?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),SkeletonViewer.prototype._getBonePosition=function(position,bone,meshMat,x,y,z){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0);var tmat=BABYLON.Tmp.Matrix[0],parentBone=bone.getParent();if(tmat.copyFrom(bone.getLocalMatrix()),0!==x||0!==y||0!==z){var tmat2=BABYLON.Tmp.Matrix[1];BABYLON.Matrix.IdentityToRef(tmat2),tmat2.m[12]=x,tmat2.m[13]=y,tmat2.m[14]=z,tmat2.multiplyToRef(tmat,tmat)}parentBone&&tmat.multiplyToRef(parentBone.getAbsoluteTransform(),tmat),tmat.multiplyToRef(meshMat,tmat),position.x=tmat.m[12],position.y=tmat.m[13],position.z=tmat.m[14]},SkeletonViewer.prototype._getLinesForBonesWithLength=function(bones,meshMat){for(var len=bones.length,meshPos=this.mesh.position,i=0;i<len;i++){var bone=bones[i],points=this._debugLines[i];points||(points=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this._debugLines[i]=points),this._getBonePosition(points[0],bone,meshMat),this._getBonePosition(points[1],bone,meshMat,0,bone.length,0),points[0].subtractInPlace(meshPos),points[1].subtractInPlace(meshPos)}},SkeletonViewer.prototype._getLinesForBonesNoLength=function(bones,meshMat){for(var len=bones.length,boneNum=0,meshPos=this.mesh.position,i=len-1;i>=0;i--){var childBone=bones[i],parentBone=childBone.getParent();if(parentBone){var points=this._debugLines[boneNum];points||(points=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this._debugLines[boneNum]=points),childBone.getAbsolutePositionToRef(this.mesh,points[0]),parentBone.getAbsolutePositionToRef(this.mesh,points[1]),points[0].subtractInPlace(meshPos),points[1].subtractInPlace(meshPos),boneNum++}}},SkeletonViewer.prototype.update=function(){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?BABYLON.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=BABYLON.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color},SkeletonViewer.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},SkeletonViewer}();Debug.SkeletonViewer=SkeletonViewer}(BABYLON.Debug||(BABYLON.Debug={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Debug){var AxesViewer=function(){function AxesViewer(scene,scaleLines){void 0===scaleLines&&(scaleLines=1),this._xline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this._yline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this._zline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.scaleLines=1,this.scaleLines=scaleLines,this._xmesh=BABYLON.Mesh.CreateLines("xline",this._xline,scene,!0),this._ymesh=BABYLON.Mesh.CreateLines("yline",this._yline,scene,!0),this._zmesh=BABYLON.Mesh.CreateLines("zline",this._zline,scene,!0),this._xmesh.renderingGroupId=2,this._ymesh.renderingGroupId=2,this._zmesh.renderingGroupId=2,this._xmesh.material.checkReadyOnlyOnce=!0,this._xmesh.color=new BABYLON.Color3(1,0,0),this._ymesh.material.checkReadyOnlyOnce=!0,this._ymesh.color=new BABYLON.Color3(0,1,0),this._zmesh.material.checkReadyOnlyOnce=!0,this._zmesh.color=new BABYLON.Color3(0,0,1),this.scene=scene}return AxesViewer.prototype.update=function(position,xaxis,yaxis,zaxis){var scaleLines=this.scaleLines;this._xmesh&&this._xmesh.position.copyFrom(position),this._ymesh&&this._ymesh.position.copyFrom(position),this._zmesh&&this._zmesh.position.copyFrom(position);var point2=this._xline[1];point2.x=xaxis.x*scaleLines,point2.y=xaxis.y*scaleLines,point2.z=xaxis.z*scaleLines,BABYLON.Mesh.CreateLines("",this._xline,null,!1,this._xmesh),(point2=this._yline[1]).x=yaxis.x*scaleLines,point2.y=yaxis.y*scaleLines,point2.z=yaxis.z*scaleLines,BABYLON.Mesh.CreateLines("",this._yline,null,!1,this._ymesh),(point2=this._zline[1]).x=zaxis.x*scaleLines,point2.y=zaxis.y*scaleLines,point2.z=zaxis.z*scaleLines,BABYLON.Mesh.CreateLines("",this._zline,null,!1,this._zmesh)},AxesViewer.prototype.dispose=function(){this._xmesh&&this._xmesh.dispose(),this._ymesh&&this._ymesh.dispose(),this._zmesh&&this._zmesh.dispose(),this._xmesh=null,this._ymesh=null,this._zmesh=null,this.scene=null},AxesViewer}();Debug.AxesViewer=AxesViewer}(BABYLON.Debug||(BABYLON.Debug={}))}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Debug){var BoneAxesViewer=function(_super){function BoneAxesViewer(scene,bone,mesh,scaleLines){void 0===scaleLines&&(scaleLines=1);var _this=_super.call(this,scene,scaleLines)||this;return _this.pos=BABYLON.Vector3.Zero(),_this.xaxis=BABYLON.Vector3.Zero(),_this.yaxis=BABYLON.Vector3.Zero(),_this.zaxis=BABYLON.Vector3.Zero(),_this.mesh=mesh,_this.bone=bone,_this}return __extends(BoneAxesViewer,_super),BoneAxesViewer.prototype.update=function(){if(this.mesh&&this.bone){var bone=this.bone;bone.getAbsolutePositionToRef(this.mesh,this.pos),bone.getDirectionToRef(BABYLON.Axis.X,this.mesh,this.xaxis),bone.getDirectionToRef(BABYLON.Axis.Y,this.mesh,this.yaxis),bone.getDirectionToRef(BABYLON.Axis.Z,this.mesh,this.zaxis),_super.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},BoneAxesViewer.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,_super.prototype.dispose.call(this))},BoneAxesViewer}(Debug.AxesViewer);Debug.BoneAxesViewer=BoneAxesViewer}(BABYLON.Debug||(BABYLON.Debug={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var RayHelper=function(){function RayHelper(ray){this.ray=ray}return RayHelper.CreateAndShow=function(ray,scene,color){var helper=new RayHelper(ray);return helper.show(scene,color),helper},RayHelper.prototype.show=function(scene,color){if(!this._renderFunction&&this.ray){var ray=this.ray;this._renderFunction=this._render.bind(this),this._scene=scene,this._renderPoints=[ray.origin,ray.origin.add(ray.direction.scale(ray.length))],this._renderLine=BABYLON.Mesh.CreateLines("ray",this._renderPoints,scene,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}color&&this._renderLine&&this._renderLine.color.copyFrom(color)},RayHelper.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},RayHelper.prototype._render=function(){var ray=this.ray;if(ray){var point=this._renderPoints[1],len=Math.min(ray.length,1e6);point.copyFrom(ray.direction),point.scaleInPlace(len),point.addInPlace(ray.origin),BABYLON.Mesh.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},RayHelper.prototype.attachToMesh=function(mesh,meshSpaceDirection,meshSpaceOrigin,length){this._attachedToMesh=mesh;var ray=this.ray;ray&&(ray.direction||(ray.direction=BABYLON.Vector3.Zero()),ray.origin||(ray.origin=BABYLON.Vector3.Zero()),length&&(ray.length=length),meshSpaceOrigin||(meshSpaceOrigin=BABYLON.Vector3.Zero()),meshSpaceDirection||(meshSpaceDirection=new BABYLON.Vector3(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(meshSpaceDirection),this._meshSpaceOrigin.copyFrom(meshSpaceOrigin)):(this._meshSpaceDirection=meshSpaceDirection.clone(),this._meshSpaceOrigin=meshSpaceOrigin.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},RayHelper.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},RayHelper.prototype._updateToMesh=function(){var ray=this.ray;this._attachedToMesh&&ray&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,ray.direction),BABYLON.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),ray.origin)))},RayHelper.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},RayHelper}();BABYLON.RayHelper=RayHelper}(BABYLON||(BABYLON={}));!function(BABYLON){var DebugLayer=function(){function DebugLayer(scene){this.BJSINSPECTOR="undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this._scene=scene}return DebugLayer.prototype._createInspector=function(config){void 0===config&&(config={});var popup=config.popup||!1,initialTab=config.initialTab||0,parentElement=config.parentElement||null;this._inspector||(this.BJSINSPECTOR=this.BJSINSPECTOR||"undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this._inspector=new this.BJSINSPECTOR.Inspector(this._scene,popup,initialTab,parentElement,config.newColors))},DebugLayer.prototype.isVisible=function(){return!!this._inspector},DebugLayer.prototype.hide=function(){if(this._inspector){try{this._inspector.dispose()}catch(e){}this._inspector=null}},DebugLayer.prototype.show=function(config){void 0===config&&(config={}),void 0===this.BJSINSPECTOR?BABYLON.Tools.LoadScript(DebugLayer.InspectorURL,this._createInspector.bind(this,config)):this._createInspector(config)},DebugLayer.InspectorURL="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",DebugLayer}();BABYLON.DebugLayer=DebugLayer}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Debug){var PhysicsViewer=function(){function PhysicsViewer(scene){this._impostors=[],this._meshes=[],this._numMeshes=0,this._scene=scene||BABYLON.Engine.LastCreatedScene;var physicEngine=this._scene.getPhysicsEngine();physicEngine&&(this._physicsEnginePlugin=physicEngine.getPhysicsPlugin())}return PhysicsViewer.prototype._updateDebugMeshes=function(){for(var plugin=this._physicsEnginePlugin,i=0;i<this._numMeshes;i++){var impostor=this._impostors[i];if(impostor)if(impostor.isDisposed)this.hideImpostor(this._impostors[i--]);else{var mesh=this._meshes[i];mesh&&plugin&&plugin.syncMeshWithImpostor(mesh,impostor)}}},PhysicsViewer.prototype.showImpostor=function(impostor){if(this._scene){for(var i=0;i<this._numMeshes;i++)if(this._impostors[i]==impostor)return;var debugMesh=this._getDebugMesh(impostor,this._scene);debugMesh&&(this._impostors[this._numMeshes]=impostor,this._meshes[this._numMeshes]=debugMesh,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++)}},PhysicsViewer.prototype.hideImpostor=function(impostor){if(impostor&&this._scene){for(var removed=!1,i=0;i<this._numMeshes;i++)if(this._impostors[i]==impostor){var mesh=this._meshes[i];if(!mesh)continue;this._scene.removeMesh(mesh),mesh.dispose(),this._numMeshes--,this._numMeshes>0?(this._meshes[i]=this._meshes[this._numMeshes],this._impostors[i]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),removed=!0;break}removed&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},PhysicsViewer.prototype._getDebugMaterial=function(scene){return this._debugMaterial||(this._debugMaterial=new BABYLON.StandardMaterial("",scene),this._debugMaterial.wireframe=!0),this._debugMaterial},PhysicsViewer.prototype._getDebugBoxMesh=function(scene){return this._debugBoxMesh||(this._debugBoxMesh=BABYLON.MeshBuilder.CreateBox("physicsBodyBoxViewMesh",{size:1},scene),this._debugBoxMesh.renderingGroupId=1,this._debugBoxMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(scene),scene.removeMesh(this._debugBoxMesh)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},PhysicsViewer.prototype._getDebugSphereMesh=function(scene){return this._debugSphereMesh||(this._debugSphereMesh=BABYLON.MeshBuilder.CreateSphere("physicsBodySphereViewMesh",{diameter:1},scene),this._debugSphereMesh.renderingGroupId=1,this._debugSphereMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(scene),scene.removeMesh(this._debugSphereMesh)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},PhysicsViewer.prototype._getDebugMesh=function(impostor,scene){var mesh=null;if(impostor.type==BABYLON.PhysicsImpostor.BoxImpostor)mesh=this._getDebugBoxMesh(scene),impostor.getBoxSizeToRef(mesh.scaling);else if(impostor.type==BABYLON.PhysicsImpostor.SphereImpostor){mesh=this._getDebugSphereMesh(scene);var radius=impostor.getRadius();mesh.scaling.x=2*radius,mesh.scaling.y=2*radius,mesh.scaling.z=2*radius}return mesh},PhysicsViewer.prototype.dispose=function(){for(var i=0;i<this._numMeshes;i++)this.hideImpostor(this._impostors[i]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null},PhysicsViewer}();Debug.PhysicsViewer=PhysicsViewer}(BABYLON.Debug||(BABYLON.Debug={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var BoundingBoxRenderer=function(){function BoundingBoxRenderer(scene){this.frontColor=new BABYLON.Color3(1,1,1),this.backColor=new BABYLON.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new BABYLON.SmartArray(32),this._vertexBuffers={},this._scene=scene}return BoundingBoxRenderer.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new BABYLON.ShaderMaterial("colorShader",this._scene,"color",{attributes:[BABYLON.VertexBuffer.PositionKind],uniforms:["world","viewProjection","color"]});var engine=this._scene.getEngine(),boxdata=BABYLON.VertexData.CreateBox({size:1});this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=new BABYLON.VertexBuffer(engine,boxdata.positions,BABYLON.VertexBuffer.PositionKind,!1),this._createIndexBuffer()}},BoundingBoxRenderer.prototype._createIndexBuffer=function(){var engine=this._scene.getEngine();this._indexBuffer=engine.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},BoundingBoxRenderer.prototype._rebuild=function(){var vb=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vb&&vb._rebuild(),this._createIndexBuffer()},BoundingBoxRenderer.prototype.reset=function(){this.renderList.reset()},BoundingBoxRenderer.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var engine=this._scene.getEngine();engine.setDepthWrite(!1),this._colorShader._preBind();for(var boundingBoxIndex=0;boundingBoxIndex<this.renderList.length;boundingBoxIndex++){var boundingBox=this.renderList.data[boundingBoxIndex],min=boundingBox.minimum,diff=boundingBox.maximum.subtract(min),median=min.add(diff.scale(.5)),worldMatrix=BABYLON.Matrix.Scaling(diff.x,diff.y,diff.z).multiply(BABYLON.Matrix.Translation(median.x,median.y,median.z)).multiply(boundingBox.getWorldMatrix());engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(engine.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(worldMatrix),engine.draw(!1,0,24)),engine.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(worldMatrix),engine.draw(!1,0,24)}this._colorShader.unbind(),engine.setDepthFunctionToLessOrEqual(),engine.setDepthWrite(!0)}},BoundingBoxRenderer.prototype.renderOcclusionBoundingBox=function(mesh){if(this._prepareRessources(),this._colorShader.isReady()&&mesh._boundingInfo){var engine=this._scene.getEngine();engine.setDepthWrite(!1),engine.setColorWrite(!1),this._colorShader._preBind();var boundingBox=mesh._boundingInfo.boundingBox,min=boundingBox.minimum,diff=boundingBox.maximum.subtract(min),median=min.add(diff.scale(.5)),worldMatrix=BABYLON.Matrix.Scaling(diff.x,diff.y,diff.z).multiply(BABYLON.Matrix.Translation(median.x,median.y,median.z)).multiply(boundingBox.getWorldMatrix());engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),engine.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.bind(worldMatrix),engine.draw(!1,0,24),this._colorShader.unbind(),engine.setDepthFunctionToLessOrEqual(),engine.setDepthWrite(!0),engine.setColorWrite(!0)}},BoundingBoxRenderer.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var buffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];buffer&&(buffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},BoundingBoxRenderer}();BABYLON.BoundingBoxRenderer=BoundingBoxRenderer}(BABYLON||(BABYLON={}));!function(BABYLON){var MorphTarget=function(){function MorphTarget(name,influence){void 0===influence&&(influence=0),this.name=name,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new BABYLON.Observable,this.influence=influence}return Object.defineProperty(MorphTarget.prototype,"influence",{get:function(){return this._influence},set:function(influence){if(this._influence!==influence){var previous=this._influence;this._influence=influence,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===previous||0===influence)}},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTarget.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTarget.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTarget.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),MorphTarget.prototype.setPositions=function(data){this._positions=data},MorphTarget.prototype.getPositions=function(){return this._positions},MorphTarget.prototype.setNormals=function(data){this._normals=data},MorphTarget.prototype.getNormals=function(){return this._normals},MorphTarget.prototype.setTangents=function(data){this._tangents=data},MorphTarget.prototype.getTangents=function(){return this._tangents},MorphTarget.prototype.serialize=function(){var serializationObject={};return serializationObject.name=this.name,serializationObject.influence=this.influence,serializationObject.positions=Array.prototype.slice.call(this.getPositions()),this.hasNormals&&(serializationObject.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(serializationObject.tangents=Array.prototype.slice.call(this.getTangents())),BABYLON.Animation.AppendSerializedAnimations(this,serializationObject),serializationObject},MorphTarget.Parse=function(serializationObject){var result=new MorphTarget(serializationObject.name,serializationObject.influence);if(result.setPositions(serializationObject.positions),serializationObject.normals&&result.setNormals(serializationObject.normals),serializationObject.tangents&&result.setTangents(serializationObject.tangents),serializationObject.animations)for(var animationIndex=0;animationIndex<serializationObject.animations.length;animationIndex++){var parsedAnimation=serializationObject.animations[animationIndex];result.animations.push(BABYLON.Animation.Parse(parsedAnimation))}return result},MorphTarget.FromMesh=function(mesh,name,influence){name||(name=mesh.name);var result=new MorphTarget(name,influence);return result.setPositions(mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind)),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)&&result.setNormals(mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind)),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.TangentKind)&&result.setTangents(mesh.getVerticesData(BABYLON.VertexBuffer.TangentKind)),result},MorphTarget}();BABYLON.MorphTarget=MorphTarget}(BABYLON||(BABYLON={}));!function(BABYLON){var MorphTargetManager=function(){function MorphTargetManager(scene){void 0===scene&&(scene=null),this._targets=new Array,this._targetObservable=new Array,this._activeTargets=new BABYLON.SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,scene||(scene=BABYLON.Engine.LastCreatedScene),this._scene=scene,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(MorphTargetManager.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(MorphTargetManager.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),MorphTargetManager.prototype.getActiveTarget=function(index){return this._activeTargets.data[index]},MorphTargetManager.prototype.getTarget=function(index){return this._targets[index]},MorphTargetManager.prototype.addTarget=function(target){var _this=this;this._targets.push(target),this._targetObservable.push(target.onInfluenceChanged.add(function(needUpdate){_this._syncActiveTargets(needUpdate)})),this._syncActiveTargets(!0)},MorphTargetManager.prototype.removeTarget=function(target){var index=this._targets.indexOf(target);index>=0&&(this._targets.splice(index,1),target.onInfluenceChanged.remove(this._targetObservable.splice(index,1)[0]),this._syncActiveTargets(!0))},MorphTargetManager.prototype.serialize=function(){var serializationObject={};serializationObject.id=this.uniqueId,serializationObject.targets=[];for(var _i=0,_a=this._targets;_i<_a.length;_i++){var target=_a[_i];serializationObject.targets.push(target.serialize())}return serializationObject},MorphTargetManager.prototype._syncActiveTargets=function(needUpdate){var influenceCount=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var _i=0,_a=this._targets;_i<_a.length;_i++){var target=_a[_i];if(target.influence>0){this._activeTargets.push(target),this._tempInfluences[influenceCount++]=target.influence,this._supportsNormals=this._supportsNormals&&target.hasNormals,this._supportsTangents=this._supportsTangents&&target.hasTangents;var positions=target.getPositions();if(!positions)return void BABYLON.Tools.Error("Invalid target. Target must positions.");var vertexCount=positions.length/3;if(0===this._vertexCount)this._vertexCount=vertexCount;else if(this._vertexCount!==vertexCount)return void BABYLON.Tools.Error("Incompatible target. Targets must all have the same vertices count.")}}this._influences&&this._influences.length===influenceCount||(this._influences=new Float32Array(influenceCount));for(var index=0;index<influenceCount;index++)this._influences[index]=this._tempInfluences[index];if(needUpdate&&this._scene)for(var _b=0,_c=this._scene.meshes;_b<_c.length;_b++){var mesh=_c[_b];mesh.morphTargetManager===this&&mesh._syncGeometryWithMorphTargetManager()}},MorphTargetManager.Parse=function(serializationObject,scene){var result=new MorphTargetManager(scene);result._uniqueId=serializationObject.id;for(var _i=0,_a=serializationObject.targets;_i<_a.length;_i++){var targetData=_a[_i];result.addTarget(BABYLON.MorphTarget.Parse(targetData))}return result},MorphTargetManager}();BABYLON.MorphTargetManager=MorphTargetManager}(BABYLON||(BABYLON={}));!function(BABYLON){var Octree=function(){function Octree(creationFunc,maxBlockCapacity,maxDepth){void 0===maxDepth&&(maxDepth=2),this.maxDepth=maxDepth,this.dynamicContent=new Array,this._maxBlockCapacity=maxBlockCapacity||64,this._selectionContent=new BABYLON.SmartArrayNoDuplicate(1024),this._creationFunc=creationFunc}return Octree.prototype.update=function(worldMin,worldMax,entries){Octree._CreateBlocks(worldMin,worldMax,entries,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},Octree.prototype.addMesh=function(entry){for(var index=0;index<this.blocks.length;index++)this.blocks[index].addEntry(entry)},Octree.prototype.select=function(frustumPlanes,allowDuplicate){this._selectionContent.reset();for(var index=0;index<this.blocks.length;index++)this.blocks[index].select(frustumPlanes,this._selectionContent,allowDuplicate);return allowDuplicate?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Octree.prototype.intersects=function(sphereCenter,sphereRadius,allowDuplicate){this._selectionContent.reset();for(var index=0;index<this.blocks.length;index++)this.blocks[index].intersects(sphereCenter,sphereRadius,this._selectionContent,allowDuplicate);return allowDuplicate?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Octree.prototype.intersectsRay=function(ray){this._selectionContent.reset();for(var index=0;index<this.blocks.length;index++)this.blocks[index].intersectsRay(ray,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},Octree._CreateBlocks=function(worldMin,worldMax,entries,maxBlockCapacity,currentDepth,maxDepth,target,creationFunc){target.blocks=new Array;for(var blockSize=new BABYLON.Vector3((worldMax.x-worldMin.x)/2,(worldMax.y-worldMin.y)/2,(worldMax.z-worldMin.z)/2),x=0;x<2;x++)for(var y=0;y<2;y++)for(var z=0;z<2;z++){var localMin=worldMin.add(blockSize.multiplyByFloats(x,y,z)),localMax=worldMin.add(blockSize.multiplyByFloats(x+1,y+1,z+1)),block=new BABYLON.OctreeBlock(localMin,localMax,maxBlockCapacity,currentDepth+1,maxDepth,creationFunc);block.addEntries(entries),target.blocks.push(block)}},Octree.CreationFuncForMeshes=function(entry,block){var boundingInfo=entry.getBoundingInfo();!entry.isBlocked&&boundingInfo.boundingBox.intersectsMinMax(block.minPoint,block.maxPoint)&&block.entries.push(entry)},Octree.CreationFuncForSubMeshes=function(entry,block){entry.getBoundingInfo().boundingBox.intersectsMinMax(block.minPoint,block.maxPoint)&&block.entries.push(entry)},Octree}();BABYLON.Octree=Octree}(BABYLON||(BABYLON={}));!function(BABYLON){var OctreeBlock=function(){function OctreeBlock(minPoint,maxPoint,capacity,depth,maxDepth,creationFunc){this.entries=new Array,this._boundingVectors=new Array,this._capacity=capacity,this._depth=depth,this._maxDepth=maxDepth,this._creationFunc=creationFunc,this._minPoint=minPoint,this._maxPoint=maxPoint,this._boundingVectors.push(minPoint.clone()),this._boundingVectors.push(maxPoint.clone()),this._boundingVectors.push(minPoint.clone()),this._boundingVectors[2].x=maxPoint.x,this._boundingVectors.push(minPoint.clone()),this._boundingVectors[3].y=maxPoint.y,this._boundingVectors.push(minPoint.clone()),this._boundingVectors[4].z=maxPoint.z,this._boundingVectors.push(maxPoint.clone()),this._boundingVectors[5].z=minPoint.z,this._boundingVectors.push(maxPoint.clone()),this._boundingVectors[6].x=minPoint.x,this._boundingVectors.push(maxPoint.clone()),this._boundingVectors[7].y=minPoint.y}return Object.defineProperty(OctreeBlock.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(OctreeBlock.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(OctreeBlock.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),OctreeBlock.prototype.addEntry=function(entry){if(this.blocks)for(var index=0;index<this.blocks.length;index++)this.blocks[index].addEntry(entry);else this._creationFunc(entry,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},OctreeBlock.prototype.addEntries=function(entries){for(var index=0;index<entries.length;index++){var mesh=entries[index];this.addEntry(mesh)}},OctreeBlock.prototype.select=function(frustumPlanes,selection,allowDuplicate){if(BABYLON.BoundingBox.IsInFrustum(this._boundingVectors,frustumPlanes)){if(this.blocks){for(var index=0;index<this.blocks.length;index++)this.blocks[index].select(frustumPlanes,selection,allowDuplicate);return}allowDuplicate?selection.concat(this.entries):selection.concatWithNoDuplicate(this.entries)}},OctreeBlock.prototype.intersects=function(sphereCenter,sphereRadius,selection,allowDuplicate){if(BABYLON.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,sphereCenter,sphereRadius)){if(this.blocks){for(var index=0;index<this.blocks.length;index++)this.blocks[index].intersects(sphereCenter,sphereRadius,selection,allowDuplicate);return}allowDuplicate?selection.concat(this.entries):selection.concatWithNoDuplicate(this.entries)}},OctreeBlock.prototype.intersectsRay=function(ray,selection){if(ray.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var index=0;index<this.blocks.length;index++)this.blocks[index].intersectsRay(ray,selection);return}selection.concatWithNoDuplicate(this.entries)}},OctreeBlock.prototype.createInnerBlocks=function(){BABYLON.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},OctreeBlock}();BABYLON.OctreeBlock=OctreeBlock}(BABYLON||(BABYLON={}));!function(BABYLON){var SIMDVector3=function(){function SIMDVector3(){}return SIMDVector3.TransformCoordinatesToRefSIMD=function(vector,transformation,result){SIMDVector3.TransformCoordinatesFromFloatsToRefSIMD(vector.x,vector.y,vector.z,transformation,result)},SIMDVector3.TransformCoordinatesFromFloatsToRefSIMD=function(x,y,z,transformation,result){var m=transformation.m,m0=SIMD.Float32x4.load(m,0),m1=SIMD.Float32x4.load(m,4),m2=SIMD.Float32x4.load(m,8),m3=SIMD.Float32x4.load(m,12),r=SIMD.Float32x4.add(SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(x),m0),SIMD.Float32x4.mul(SIMD.Float32x4.splat(y),m1)),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(z),m2),m3));r=SIMD.Float32x4.div(r,SIMD.Float32x4.swizzle(r,3,3,3,3)),result.x=SIMD.Float32x4.extractLane(r,0),result.y=SIMD.Float32x4.extractLane(r,1),result.z=SIMD.Float32x4.extractLane(r,2)},SIMDVector3}(),SIMDMatrix=function(){function SIMDMatrix(){}return SIMDMatrix.prototype.multiplyToArraySIMD=function(other,result,offset){for(var tm=this.m,om=other.m,m0=SIMD.Float32x4.load(om,0),m1=SIMD.Float32x4.load(om,4),m2=SIMD.Float32x4.load(om,8),m3=SIMD.Float32x4.load(om,12),i=0;i<16;i+=4)SIMD.Float32x4.store(result,i+offset,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(tm[i]),m0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(tm[i+1]),m1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(tm[i+2]),m2),SIMD.Float32x4.mul(SIMD.Float32x4.splat(tm[i+3]),m3)))));return this},SIMDMatrix.prototype.invertToRefSIMD=function(other){var src=this.m,dest=other.m,src0=SIMD.Float32x4.load(src,0),src1=SIMD.Float32x4.load(src,4),src2=SIMD.Float32x4.load(src,8),src3=SIMD.Float32x4.load(src,12),tmp1=SIMD.Float32x4.shuffle(src0,src1,0,1,4,5),row1=SIMD.Float32x4.shuffle(src2,src3,0,1,4,5),row0=SIMD.Float32x4.shuffle(tmp1,row1,0,2,4,6);row1=SIMD.Float32x4.shuffle(row1,tmp1,1,3,5,7),tmp1=SIMD.Float32x4.shuffle(src0,src1,2,3,6,7);var row3=SIMD.Float32x4.shuffle(src2,src3,2,3,6,7),row2=SIMD.Float32x4.shuffle(tmp1,row3,0,2,4,6);row3=SIMD.Float32x4.shuffle(row3,tmp1,1,3,5,7),tmp1=SIMD.Float32x4.mul(row2,row3),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2);var minor0=SIMD.Float32x4.mul(row1,tmp1),minor1=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor0=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1,tmp1),minor0),minor1=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor1),minor1=SIMD.Float32x4.swizzle(minor1,2,3,0,1),tmp1=SIMD.Float32x4.mul(row1,row2),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2),minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor0);var minor3=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row3,tmp1)),minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor3),minor3=SIMD.Float32x4.swizzle(minor3,2,3,0,1),tmp1=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1,2,3,0,1),row3),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2),row2=SIMD.Float32x4.swizzle(row2,2,3,0,1),minor0=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor0);var minor2=SIMD.Float32x4.mul(row0,tmp1);tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor0=SIMD.Float32x4.sub(minor0,SIMD.Float32x4.mul(row2,tmp1)),minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0,tmp1),minor2),minor2=SIMD.Float32x4.swizzle(minor2,2,3,0,1),tmp1=SIMD.Float32x4.mul(row0,row1),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2),minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor2),minor3=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2,tmp1),minor3),tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor2=SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3,tmp1),minor2),minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row2,tmp1)),tmp1=SIMD.Float32x4.mul(row0,row3),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2),minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row2,tmp1)),minor2=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor2),tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row2,tmp1),minor1),minor2=SIMD.Float32x4.sub(minor2,SIMD.Float32x4.mul(row1,tmp1)),tmp1=SIMD.Float32x4.mul(row0,row2),tmp1=SIMD.Float32x4.swizzle(tmp1,1,0,3,2),minor1=SIMD.Float32x4.add(SIMD.Float32x4.mul(row3,tmp1),minor1),minor3=SIMD.Float32x4.sub(minor3,SIMD.Float32x4.mul(row1,tmp1)),tmp1=SIMD.Float32x4.swizzle(tmp1,2,3,0,1),minor1=SIMD.Float32x4.sub(minor1,SIMD.Float32x4.mul(row3,tmp1)),minor3=SIMD.Float32x4.add(SIMD.Float32x4.mul(row1,tmp1),minor3);var det=SIMD.Float32x4.mul(row0,minor0);return det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,2,3,0,1),det),det=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det,1,0,3,2),det),tmp1=SIMD.Float32x4.reciprocalApproximation(det),det=SIMD.Float32x4.sub(SIMD.Float32x4.add(tmp1,tmp1),SIMD.Float32x4.mul(det,SIMD.Float32x4.mul(tmp1,tmp1))),det=SIMD.Float32x4.swizzle(det,0,0,0,0),SIMD.Float32x4.store(dest,0,SIMD.Float32x4.mul(det,minor0)),SIMD.Float32x4.store(dest,4,SIMD.Float32x4.mul(det,minor1)),SIMD.Float32x4.store(dest,8,minor2=SIMD.Float32x4.mul(det,minor2)),SIMD.Float32x4.store(dest,12,SIMD.Float32x4.mul(det,minor3)),this},SIMDMatrix.LookAtLHToRefSIMD=function(eyeRef,targetRef,upRef,result){var out=result.m,center=SIMD.Float32x4(targetRef.x,targetRef.y,targetRef.z,0),eye=SIMD.Float32x4(eyeRef.x,eyeRef.y,eyeRef.z,0),up=SIMD.Float32x4(upRef.x,upRef.y,upRef.z,0),f=SIMD.Float32x4.sub(center,eye),tmp=SIMD.Float32x4.mul(f,f);tmp=SIMD.Float32x4.add(tmp,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(tmp,1,2,0,3),SIMD.Float32x4.swizzle(tmp,2,0,1,3))),f=SIMD.Float32x4.mul(f,SIMD.Float32x4.reciprocalSqrtApproximation(tmp)),tmp=SIMD.Float32x4.mul(up,up),tmp=SIMD.Float32x4.add(tmp,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(tmp,1,2,0,3),SIMD.Float32x4.swizzle(tmp,2,0,1,3))),up=SIMD.Float32x4.mul(up,SIMD.Float32x4.reciprocalSqrtApproximation(tmp));var s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,2,0,3),SIMD.Float32x4.swizzle(up,2,0,1,3)),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,0,1,3),SIMD.Float32x4.swizzle(up,1,2,0,3)));tmp=SIMD.Float32x4.mul(s,s),tmp=SIMD.Float32x4.add(tmp,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(tmp,1,2,0,3),SIMD.Float32x4.swizzle(tmp,2,0,1,3))),s=SIMD.Float32x4.mul(s,SIMD.Float32x4.reciprocalSqrtApproximation(tmp));var u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,2,0,3),SIMD.Float32x4.swizzle(f,2,0,1,3)),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,0,1,3),SIMD.Float32x4.swizzle(f,1,2,0,3)));tmp=SIMD.Float32x4.mul(s,s),tmp=SIMD.Float32x4.add(tmp,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(tmp,1,2,0,3),SIMD.Float32x4.swizzle(tmp,2,0,1,3))),s=SIMD.Float32x4.mul(s,SIMD.Float32x4.reciprocalSqrtApproximation(tmp));var zero=SIMD.Float32x4.splat(0);s=SIMD.Float32x4.neg(s);var tmp01=SIMD.Float32x4.shuffle(s,u,0,1,4,5),tmp23=SIMD.Float32x4.shuffle(f,zero,0,1,4,5),a0=SIMD.Float32x4.shuffle(tmp01,tmp23,0,2,4,6),a1=SIMD.Float32x4.shuffle(tmp01,tmp23,1,3,5,7),a2=SIMD.Float32x4.shuffle(SIMD.Float32x4.shuffle(s,u,2,3,6,7),SIMD.Float32x4.shuffle(f,zero,2,3,6,7),0,2,4,6),a3=SIMD.Float32x4(0,0,0,1),b=SIMD.Float32x4(1,0,0,0);SIMD.Float32x4.store(out,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),a3))))),b=SIMD.Float32x4(0,1,0,0),SIMD.Float32x4.store(out,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),a3))))),b=SIMD.Float32x4(0,0,1,0),SIMD.Float32x4.store(out,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),a3))))),b=SIMD.Float32x4.replaceLane(SIMD.Float32x4.neg(eye),3,1),SIMD.Float32x4.store(out,12,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),a0),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),a1),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),a2),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),a3)))))},SIMDMatrix}(),previousMultiplyToArray=BABYLON.Matrix.prototype.multiplyToArray,previousInvertToRef=BABYLON.Matrix.prototype.invertToRef,previousLookAtLHToRef=BABYLON.Matrix.LookAtLHToRef,previousTransformCoordinatesToRef=BABYLON.Vector3.TransformCoordinatesToRef,previousTransformCoordinatesFromFloatsToRef=BABYLON.Vector3.TransformCoordinatesFromFloatsToRef,SIMDHelper=function(){function SIMDHelper(){}return Object.defineProperty(SIMDHelper,"IsEnabled",{get:function(){return SIMDHelper._isEnabled},enumerable:!0,configurable:!0}),SIMDHelper.DisableSIMD=function(){BABYLON.Matrix.prototype.multiplyToArray=previousMultiplyToArray,BABYLON.Matrix.prototype.invertToRef=previousInvertToRef,BABYLON.Matrix.LookAtLHToRef=previousLookAtLHToRef,BABYLON.Vector3.TransformCoordinatesToRef=previousTransformCoordinatesToRef,BABYLON.Vector3.TransformCoordinatesFromFloatsToRef=previousTransformCoordinatesFromFloatsToRef,SIMDHelper._isEnabled=!1},SIMDHelper.EnableSIMD=function(){void 0!==self.SIMD&&(self.Math.fround||(self.Math.fround=function(array){return function(x){return array[0]=x,array[0]}}(new Float32Array(1))),self.Math.imul||(self.Math.imul=function(a,b){var al=65535&a,bl=65535&b;return al*bl+((a>>>16&65535)*bl+al*(b>>>16&65535)<<16>>>0)|0}),BABYLON.Matrix.prototype.multiplyToArray=SIMDMatrix.prototype.multiplyToArraySIMD,BABYLON.Matrix.prototype.invertToRef=SIMDMatrix.prototype.invertToRefSIMD,BABYLON.Matrix.LookAtLHToRef=SIMDMatrix.LookAtLHToRefSIMD,BABYLON.Vector3.TransformCoordinatesToRef=SIMDVector3.TransformCoordinatesToRefSIMD,BABYLON.Vector3.TransformCoordinatesFromFloatsToRef=SIMDVector3.TransformCoordinatesFromFloatsToRefSIMD,SIMDHelper._isEnabled=!0)},SIMDHelper._isEnabled=!1,SIMDHelper}();BABYLON.SIMDHelper=SIMDHelper}(BABYLON||(BABYLON={}));!function(BABYLON){var VRDistortionCorrectionPostProcess=function(_super){function VRDistortionCorrectionPostProcess(name,camera,isRightEye,vrMetrics){var _this=_super.call(this,name,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,vrMetrics.postProcessScaleFactor,camera,BABYLON.Texture.BILINEAR_SAMPLINGMODE)||this;return _this._isRightEye=isRightEye,_this._distortionFactors=vrMetrics.distortionK,_this._postProcessScaleFactor=vrMetrics.postProcessScaleFactor,_this._lensCenterOffset=vrMetrics.lensCenterOffset,_this.adaptScaleToCurrentViewport=!0,_this.onSizeChangedObservable.add(function(){_this.aspectRatio=.5*_this.width/_this.height,_this._scaleIn=new BABYLON.Vector2(2,2/_this.aspectRatio),_this._scaleFactor=new BABYLON.Vector2(1/_this._postProcessScaleFactor*.5,1/_this._postProcessScaleFactor*.5*_this.aspectRatio),_this._lensCenter=new BABYLON.Vector2(_this._isRightEye?.5-.5*_this._lensCenterOffset:.5+.5*_this._lensCenterOffset,.5)}),_this.onApplyObservable.add(function(effect){effect.setFloat2("LensCenter",_this._lensCenter.x,_this._lensCenter.y),effect.setFloat2("Scale",_this._scaleFactor.x,_this._scaleFactor.y),effect.setFloat2("ScaleIn",_this._scaleIn.x,_this._scaleIn.y),effect.setFloat4("HmdWarpParam",_this._distortionFactors[0],_this._distortionFactors[1],_this._distortionFactors[2],_this._distortionFactors[3])}),_this}return __extends(VRDistortionCorrectionPostProcess,_super),VRDistortionCorrectionPostProcess}(BABYLON.PostProcess);BABYLON.VRDistortionCorrectionPostProcess=VRDistortionCorrectionPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var AnaglyphPostProcess=function(_super){function AnaglyphPostProcess(name,options,rigCameras,samplingMode,engine,reusable){var _this=_super.call(this,name,"anaglyph",null,["leftSampler"],options,rigCameras[1],samplingMode,engine,reusable)||this;return _this._passedProcess=rigCameras[0]._rigPostProcess,_this.onApplyObservable.add(function(effect){effect.setTextureFromPostProcess("leftSampler",_this._passedProcess)}),_this}return __extends(AnaglyphPostProcess,_super),AnaglyphPostProcess}(BABYLON.PostProcess);BABYLON.AnaglyphPostProcess=AnaglyphPostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var StereoscopicInterlacePostProcess=function(_super){function StereoscopicInterlacePostProcess(name,rigCameras,isStereoscopicHoriz,samplingMode,engine,reusable){var _this=_super.call(this,name,"stereoscopicInterlace",["stepSize"],["camASampler"],1,rigCameras[1],samplingMode,engine,reusable,isStereoscopicHoriz?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return _this._passedProcess=rigCameras[0]._rigPostProcess,_this._stepSize=new BABYLON.Vector2(1/_this.width,1/_this.height),_this.onSizeChangedObservable.add(function(){_this._stepSize=new BABYLON.Vector2(1/_this.width,1/_this.height)}),_this.onApplyObservable.add(function(effect){effect.setTextureFromPostProcess("camASampler",_this._passedProcess),effect.setFloat2("stepSize",_this._stepSize.x,_this._stepSize.y)}),_this}return __extends(StereoscopicInterlacePostProcess,_super),StereoscopicInterlacePostProcess}(BABYLON.PostProcess);BABYLON.StereoscopicInterlacePostProcess=StereoscopicInterlacePostProcess}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraDeviceOrientationInput=function(){function FreeCameraDeviceOrientationInput(){var _this=this;this._screenOrientationAngle=0,this._screenQuaternion=new BABYLON.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){_this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,_this._screenOrientationAngle=-BABYLON.Tools.ToRadians(_this._screenOrientationAngle/2),_this._screenQuaternion.copyFromFloats(0,Math.sin(_this._screenOrientationAngle),0,Math.cos(_this._screenOrientationAngle))},this._deviceOrientation=function(evt){_this._alpha=null!==evt.alpha?evt.alpha:0,_this._beta=null!==evt.beta?evt.beta:0,_this._gamma=null!==evt.gamma?evt.gamma:0},this._constantTranform=new BABYLON.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(FreeCameraDeviceOrientationInput.prototype,"camera",{get:function(){return this._camera},set:function(camera){this._camera=camera,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new BABYLON.Quaternion)},enumerable:!0,configurable:!0}),FreeCameraDeviceOrientationInput.prototype.attachControl=function(element,noPreventDefault){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},FreeCameraDeviceOrientationInput.prototype.detachControl=function(element){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},FreeCameraDeviceOrientationInput.prototype.checkInputs=function(){this._alpha&&(BABYLON.Quaternion.RotationYawPitchRollToRef(BABYLON.Tools.ToRadians(this._alpha),BABYLON.Tools.ToRadians(this._beta),-BABYLON.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},FreeCameraDeviceOrientationInput.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},FreeCameraDeviceOrientationInput.prototype.getSimpleName=function(){return"deviceOrientation"},FreeCameraDeviceOrientationInput}();BABYLON.FreeCameraDeviceOrientationInput=FreeCameraDeviceOrientationInput,BABYLON.CameraInputTypes.FreeCameraDeviceOrientationInput=FreeCameraDeviceOrientationInput}(BABYLON||(BABYLON={}));!function(BABYLON){var ArcRotateCameraVRDeviceOrientationInput=function(){function ArcRotateCameraVRDeviceOrientationInput(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return ArcRotateCameraVRDeviceOrientationInput.prototype.attachControl=function(element,noPreventDefault){this.camera.attachControl(element,noPreventDefault),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},ArcRotateCameraVRDeviceOrientationInput.prototype._onOrientationEvent=function(evt){null!==evt.alpha&&(this._alpha=0|+evt.alpha),null!==evt.gamma&&(this._gamma=0|+evt.gamma),this._dirty=!0},ArcRotateCameraVRDeviceOrientationInput.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},ArcRotateCameraVRDeviceOrientationInput.prototype.detachControl=function(element){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},ArcRotateCameraVRDeviceOrientationInput.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},ArcRotateCameraVRDeviceOrientationInput.prototype.getSimpleName=function(){return"VRDeviceOrientation"},ArcRotateCameraVRDeviceOrientationInput}();BABYLON.ArcRotateCameraVRDeviceOrientationInput=ArcRotateCameraVRDeviceOrientationInput,BABYLON.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=ArcRotateCameraVRDeviceOrientationInput}(BABYLON||(BABYLON={}));!function(BABYLON){var VRCameraMetrics=function(){function VRCameraMetrics(){this.compensateDistortion=!0}return Object.defineProperty(VRCameraMetrics.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(VRCameraMetrics.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(VRCameraMetrics.prototype,"leftHMatrix",{get:function(){var h=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return BABYLON.Matrix.Translation(h,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(VRCameraMetrics.prototype,"rightHMatrix",{get:function(){var h=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return BABYLON.Matrix.Translation(-h,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(VRCameraMetrics.prototype,"leftPreViewMatrix",{get:function(){return BABYLON.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(VRCameraMetrics.prototype,"rightPreViewMatrix",{get:function(){return BABYLON.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),VRCameraMetrics.GetDefault=function(){var result=new VRCameraMetrics;return result.hResolution=1280,result.vResolution=800,result.hScreenSize=.149759993,result.vScreenSize=.0935999975,result.vScreenCenter=.0467999987,result.eyeToScreenDistance=.0410000011,result.lensSeparationDistance=.063500002,result.interpupillaryDistance=.064000003,result.distortionK=[1,.219999999,.239999995,0],result.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],result.postProcessScaleFactor=1.714605507808412,result.lensCenterOffset=.151976421,result},VRCameraMetrics}();BABYLON.VRCameraMetrics=VRCameraMetrics}(BABYLON||(BABYLON={}));!function(BABYLON){var WebVRFreeCamera=function(_super){function WebVRFreeCamera(name,position,scene,webVROptions){void 0===webVROptions&&(webVROptions={});var _this=_super.call(this,name,position,scene)||this;_this.webVROptions=webVROptions,_this._vrDevice=null,_this.rawPose=null,_this._specsVersion="1.1",_this._attached=!1,_this._descendants=[],_this._deviceRoomPosition=BABYLON.Vector3.Zero(),_this._deviceRoomRotationQuaternion=BABYLON.Quaternion.Identity(),_this._standingMatrix=null,_this.devicePosition=BABYLON.Vector3.Zero(),_this.deviceRotationQuaternion=BABYLON.Quaternion.Identity(),_this.deviceScaleFactor=1,_this._deviceToWorld=BABYLON.Matrix.Identity(),_this._worldToDevice=BABYLON.Matrix.Identity(),_this.controllers=[],_this.onControllersAttachedObservable=new BABYLON.Observable,_this.onControllerMeshLoadedObservable=new BABYLON.Observable,_this.rigParenting=!0,_this._defaultHeight=0,_this.deviceDistanceToRoomGround=function(){return _this._standingMatrix?(_this._standingMatrix.getTranslationToRef(_this._workingVector),_this._deviceRoomPosition.y+_this._workingVector.y):_this._defaultHeight},_this.useStandingMatrix=function(callback){void 0===callback&&(callback=function(bool){}),navigator&&navigator.getVRDisplays?navigator.getVRDisplays().then(function(displays){displays&&displays[0]&&displays[0].stageParameters&&displays[0].stageParameters.sittingToStandingTransform?(_this._standingMatrix=new BABYLON.Matrix,BABYLON.Matrix.FromFloat32ArrayToRefScaled(displays[0].stageParameters.sittingToStandingTransform,0,1,_this._standingMatrix),_this.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(num){_this._standingMatrix&&(_this._standingMatrix.m[num]*=-1)}),callback(!0)):callback(!1)}):callback(!1)},_this._workingVector=BABYLON.Vector3.Zero(),_this._oneVector=BABYLON.Vector3.One(),_this._workingMatrix=BABYLON.Matrix.Identity(),_this._cache.position=BABYLON.Vector3.Zero(),webVROptions.defaultHeight&&(_this._defaultHeight=webVROptions.defaultHeight,_this.position.y=_this._defaultHeight),_this.minZ=.1,5===arguments.length&&(_this.webVROptions=arguments[4]),void 0==_this.webVROptions.trackPosition&&(_this.webVROptions.trackPosition=!0),void 0==_this.webVROptions.controllerMeshes&&(_this.webVROptions.controllerMeshes=!0),void 0==_this.webVROptions.defaultLightingOnControllers&&(_this.webVROptions.defaultLightingOnControllers=!0),_this.rotationQuaternion=new BABYLON.Quaternion,_this.webVROptions&&_this.webVROptions.positionScale&&(_this.deviceScaleFactor=_this.webVROptions.positionScale);var engine=_this.getEngine();return _this._onVREnabled=function(success){success&&_this.initControllers()},engine.onVRRequestPresentComplete.add(_this._onVREnabled),engine.initWebVR().add(function(event){event.vrDisplay&&_this._vrDevice!==event.vrDisplay&&(_this._vrDevice=event.vrDisplay,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_WEBVR,{parentCamera:_this,vrDisplay:_this._vrDevice,frameData:_this._frameData,specs:_this._specsVersion}),_this._attached&&_this.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(_this._frameData=new VRFrameData),scene.onBeforeCameraRenderObservable.add(function(camera){camera.parent===_this&&_this.rigParenting&&(_this._descendants=_this.getDescendants(!0,function(n){var isController=_this.controllers.some(function(controller){return controller._mesh===n}),isRigCamera=-1!==_this._rigCameras.indexOf(n);return!isController&&!isRigCamera}),_this._descendants.forEach(function(node){node.parent=camera}))}),scene.onAfterCameraRenderObservable.add(function(camera){camera.parent===_this&&_this.rigParenting&&_this._descendants.forEach(function(node){node.parent=_this})}),_this}return __extends(WebVRFreeCamera,_super),WebVRFreeCamera.prototype.dispose=function(){this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),_super.prototype.dispose.call(this)},WebVRFreeCamera.prototype.getControllerByName=function(name){for(var _i=0,_a=this.controllers;_i<_a.length;_i++){var gp=_a[_i];if(gp.hand===name)return gp}return null},Object.defineProperty(WebVRFreeCamera.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(WebVRFreeCamera.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),WebVRFreeCamera.prototype.getForwardRay=function(length){return void 0===length&&(length=100),this.leftCamera?_super.prototype.getForwardRay.call(this,length,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):_super.prototype.getForwardRay.call(this,length)},WebVRFreeCamera.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),_super.prototype._checkInputs.call(this)},WebVRFreeCamera.prototype.updateFromDevice=function(poseData){poseData&&poseData.orientation&&(this.rawPose=poseData,this._deviceRoomRotationQuaternion.copyFromFloats(poseData.orientation[0],poseData.orientation[1],-poseData.orientation[2],-poseData.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)))},WebVRFreeCamera.prototype.attachControl=function(element,noPreventDefault){_super.prototype.attachControl.call(this,element,noPreventDefault),this._attached=!0,noPreventDefault=!BABYLON.Camera.ForceAttachControlToAlwaysPreventDefault&&noPreventDefault,this._vrDevice&&this.getEngine().enableVR()},WebVRFreeCamera.prototype.detachControl=function(element){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),_super.prototype.detachControl.call(this,element),this._attached=!1,this.getEngine().disableVR()},WebVRFreeCamera.prototype.getClassName=function(){return"WebVRFreeCamera"},WebVRFreeCamera.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},WebVRFreeCamera.prototype._updateRigCameras=function(){var camLeft=this._rigCameras[0],camRight=this._rigCameras[1];camLeft.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),camRight.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),camLeft.position.copyFrom(this._deviceRoomPosition),camRight.position.copyFrom(this._deviceRoomPosition)},WebVRFreeCamera.prototype._updateCache=function(ignoreParentClass){var _this=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.update(),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),BABYLON.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),BABYLON.Matrix.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(controller){controller._deviceToWorld=_this._deviceToWorld,controller.update()}),this.update()),ignoreParentClass||_super.prototype._updateCache.call(this)},WebVRFreeCamera.prototype.update=function(){BABYLON.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition),BABYLON.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),BABYLON.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),_super.prototype.update.call(this)},WebVRFreeCamera.prototype._getViewMatrix=function(){return BABYLON.Matrix.Identity()},WebVRFreeCamera.prototype._getWebVRViewMatrix=function(){var _this=this,viewArray=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;BABYLON.Matrix.FromArrayToRef(viewArray,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(num){_this._webvrViewMatrix.m[num]*=-1}),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),BABYLON.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget);var parentCamera=this._cameraRigParams.parentCamera;return 1!==parentCamera.deviceScaleFactor&&(this._webvrViewMatrix.invert(),parentCamera.deviceScaleFactor&&(this._webvrViewMatrix.m[12]*=parentCamera.deviceScaleFactor,this._webvrViewMatrix.m[13]*=parentCamera.deviceScaleFactor,this._webvrViewMatrix.m[14]*=parentCamera.deviceScaleFactor),this._webvrViewMatrix.invert()),parentCamera._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._webvrViewMatrix},WebVRFreeCamera.prototype._getWebVRProjectionMatrix=function(){var _this=this,parentCamera=this.parent;parentCamera._vrDevice.depthNear=parentCamera.minZ,parentCamera._vrDevice.depthFar=parentCamera.maxZ;var projectionArray=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return BABYLON.Matrix.FromArrayToRef(projectionArray,0,this._projectionMatrix),this.getScene().useRightHandedSystem||[8,9,10,11].forEach(function(num){_this._projectionMatrix.m[num]*=-1}),this._projectionMatrix},WebVRFreeCamera.prototype.initControllers=function(){var _this=this;this.controllers=[];var manager=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=manager.onGamepadDisconnectedObservable.add(function(gamepad){if(gamepad.type===BABYLON.Gamepad.POSE_ENABLED){var webVrController=gamepad;webVrController.defaultModel&&webVrController.defaultModel.setEnabled(!1),"right"===webVrController.hand&&(_this._rightController=null),"left"===webVrController.hand&&(_this._rightController=null);var controllerIndex=_this.controllers.indexOf(webVrController);-1!==controllerIndex&&_this.controllers.splice(controllerIndex,1)}}),this._onGamepadConnectedObserver=manager.onGamepadConnectedObservable.add(function(gamepad){if(gamepad.type===BABYLON.Gamepad.POSE_ENABLED){var webVrController_1=gamepad;if(webVrController_1._deviceToWorld=_this._deviceToWorld,_this.webVROptions.controllerMeshes&&(webVrController_1.defaultModel?webVrController_1.defaultModel.setEnabled(!0):webVrController_1.initControllerMesh(_this.getScene(),function(loadedMesh){if(_this.onControllerMeshLoadedObservable.notifyObservers(webVrController_1),_this.webVROptions.defaultLightingOnControllers){_this._lightOnControllers||(_this._lightOnControllers=new BABYLON.HemisphericLight("vrControllersLight",new BABYLON.Vector3(0,1,0),_this.getScene()));var activateLightOnSubMeshes_1=function(mesh,light){var children=mesh.getChildren();0!==children.length&&children.forEach(function(mesh){light.includedOnlyMeshes.push(mesh),activateLightOnSubMeshes_1(mesh,light)})};_this._lightOnControllers.includedOnlyMeshes.push(loadedMesh),activateLightOnSubMeshes_1(loadedMesh,_this._lightOnControllers)}})),webVrController_1.attachToPoseControlledCamera(_this),-1===_this.controllers.indexOf(webVrController_1)){_this.controllers.push(webVrController_1);for(var firstViveWandDetected=!1,i=0;i<_this.controllers.length;i++)_this.controllers[i].controllerType===BABYLON.PoseEnabledControllerType.VIVE&&(firstViveWandDetected?_this.controllers[i].hand="right":(firstViveWandDetected=!0,_this.controllers[i].hand="left"));_this.controllers.length>=2&&_this.onControllersAttachedObservable.notifyObservers(_this.controllers)}}})},WebVRFreeCamera}(BABYLON.FreeCamera);BABYLON.WebVRFreeCamera=WebVRFreeCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var DeviceOrientationCamera=function(_super){function DeviceOrientationCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this._quaternionCache=new BABYLON.Quaternion,_this.inputs.addDeviceOrientation(),_this}return __extends(DeviceOrientationCamera,_super),DeviceOrientationCamera.prototype.getClassName=function(){return"DeviceOrientationCamera"},DeviceOrientationCamera.prototype._checkInputs=function(){_super.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},DeviceOrientationCamera.prototype.resetToCurrentRotation=function(axis){var _this=this;void 0===axis&&(axis=BABYLON.Axis.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new BABYLON.Quaternion),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(axisName){axis[axisName]?_this._initialQuaternion[axisName]*=-1:_this._initialQuaternion[axisName]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},DeviceOrientationCamera}(BABYLON.FreeCamera);BABYLON.DeviceOrientationCamera=DeviceOrientationCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var VRDeviceOrientationFreeCamera=function(_super){function VRDeviceOrientationFreeCamera(name,position,scene,compensateDistortion,vrCameraMetrics){void 0===compensateDistortion&&(compensateDistortion=!0),void 0===vrCameraMetrics&&(vrCameraMetrics=BABYLON.VRCameraMetrics.GetDefault());var _this=_super.call(this,name,position,scene)||this;return vrCameraMetrics.compensateDistortion=compensateDistortion,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_VR,{vrCameraMetrics:vrCameraMetrics}),_this}return __extends(VRDeviceOrientationFreeCamera,_super),VRDeviceOrientationFreeCamera.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},VRDeviceOrientationFreeCamera}(BABYLON.DeviceOrientationCamera);BABYLON.VRDeviceOrientationFreeCamera=VRDeviceOrientationFreeCamera;var VRDeviceOrientationGamepadCamera=function(_super){function VRDeviceOrientationGamepadCamera(name,position,scene,compensateDistortion,vrCameraMetrics){void 0===compensateDistortion&&(compensateDistortion=!0),void 0===vrCameraMetrics&&(vrCameraMetrics=BABYLON.VRCameraMetrics.GetDefault());var _this=_super.call(this,name,position,scene,compensateDistortion,vrCameraMetrics)||this;return _this.inputs.addGamepad(),_this}return __extends(VRDeviceOrientationGamepadCamera,_super),VRDeviceOrientationGamepadCamera.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},VRDeviceOrientationGamepadCamera}(VRDeviceOrientationFreeCamera);BABYLON.VRDeviceOrientationGamepadCamera=VRDeviceOrientationGamepadCamera;var VRDeviceOrientationArcRotateCamera=function(_super){function VRDeviceOrientationArcRotateCamera(name,alpha,beta,radius,target,scene,compensateDistortion,vrCameraMetrics){void 0===compensateDistortion&&(compensateDistortion=!0),void 0===vrCameraMetrics&&(vrCameraMetrics=BABYLON.VRCameraMetrics.GetDefault());var _this=_super.call(this,name,alpha,beta,radius,target,scene)||this;return vrCameraMetrics.compensateDistortion=compensateDistortion,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_VR,{vrCameraMetrics:vrCameraMetrics}),_this.inputs.addVRDeviceOrientation(),_this}return __extends(VRDeviceOrientationArcRotateCamera,_super),VRDeviceOrientationArcRotateCamera.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},VRDeviceOrientationArcRotateCamera}(BABYLON.ArcRotateCamera);BABYLON.VRDeviceOrientationArcRotateCamera=VRDeviceOrientationArcRotateCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var AnaglyphFreeCamera=function(_super){function AnaglyphFreeCamera(name,position,interaxialDistance,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:interaxialDistance}),_this}return __extends(AnaglyphFreeCamera,_super),AnaglyphFreeCamera.prototype.getClassName=function(){return"AnaglyphFreeCamera"},AnaglyphFreeCamera}(BABYLON.FreeCamera);BABYLON.AnaglyphFreeCamera=AnaglyphFreeCamera;var AnaglyphArcRotateCamera=function(_super){function AnaglyphArcRotateCamera(name,alpha,beta,radius,target,interaxialDistance,scene){var _this=_super.call(this,name,alpha,beta,radius,target,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:interaxialDistance}),_this}return __extends(AnaglyphArcRotateCamera,_super),AnaglyphArcRotateCamera.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},AnaglyphArcRotateCamera}(BABYLON.ArcRotateCamera);BABYLON.AnaglyphArcRotateCamera=AnaglyphArcRotateCamera;var AnaglyphGamepadCamera=function(_super){function AnaglyphGamepadCamera(name,position,interaxialDistance,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:interaxialDistance}),_this}return __extends(AnaglyphGamepadCamera,_super),AnaglyphGamepadCamera.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},AnaglyphGamepadCamera}(BABYLON.GamepadCamera);BABYLON.AnaglyphGamepadCamera=AnaglyphGamepadCamera;var AnaglyphUniversalCamera=function(_super){function AnaglyphUniversalCamera(name,position,interaxialDistance,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.setCameraRigMode(BABYLON.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:interaxialDistance}),_this}return __extends(AnaglyphUniversalCamera,_super),AnaglyphUniversalCamera.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},AnaglyphUniversalCamera}(BABYLON.UniversalCamera);BABYLON.AnaglyphUniversalCamera=AnaglyphUniversalCamera;var StereoscopicFreeCamera=function(_super){function StereoscopicFreeCamera(name,position,interaxialDistance,isStereoscopicSideBySide,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.isStereoscopicSideBySide=isStereoscopicSideBySide,_this.setCameraRigMode(isStereoscopicSideBySide?BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:interaxialDistance}),_this}return __extends(StereoscopicFreeCamera,_super),StereoscopicFreeCamera.prototype.getClassName=function(){return"StereoscopicFreeCamera"},StereoscopicFreeCamera}(BABYLON.FreeCamera);BABYLON.StereoscopicFreeCamera=StereoscopicFreeCamera;var StereoscopicArcRotateCamera=function(_super){function StereoscopicArcRotateCamera(name,alpha,beta,radius,target,interaxialDistance,isStereoscopicSideBySide,scene){var _this=_super.call(this,name,alpha,beta,radius,target,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.isStereoscopicSideBySide=isStereoscopicSideBySide,_this.setCameraRigMode(isStereoscopicSideBySide?BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:interaxialDistance}),_this}return __extends(StereoscopicArcRotateCamera,_super),StereoscopicArcRotateCamera.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},StereoscopicArcRotateCamera}(BABYLON.ArcRotateCamera);BABYLON.StereoscopicArcRotateCamera=StereoscopicArcRotateCamera;var StereoscopicGamepadCamera=function(_super){function StereoscopicGamepadCamera(name,position,interaxialDistance,isStereoscopicSideBySide,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.isStereoscopicSideBySide=isStereoscopicSideBySide,_this.setCameraRigMode(isStereoscopicSideBySide?BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:interaxialDistance}),_this}return __extends(StereoscopicGamepadCamera,_super),StereoscopicGamepadCamera.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},StereoscopicGamepadCamera}(BABYLON.GamepadCamera);BABYLON.StereoscopicGamepadCamera=StereoscopicGamepadCamera;var StereoscopicUniversalCamera=function(_super){function StereoscopicUniversalCamera(name,position,interaxialDistance,isStereoscopicSideBySide,scene){var _this=_super.call(this,name,position,scene)||this;return _this.interaxialDistance=interaxialDistance,_this.isStereoscopicSideBySide=isStereoscopicSideBySide,_this.setCameraRigMode(isStereoscopicSideBySide?BABYLON.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:BABYLON.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:interaxialDistance}),_this}return __extends(StereoscopicUniversalCamera,_super),StereoscopicUniversalCamera.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},StereoscopicUniversalCamera}(BABYLON.UniversalCamera);BABYLON.StereoscopicUniversalCamera=StereoscopicUniversalCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var VRExperienceHelper=function(){function VRExperienceHelper(scene,webVROptions){void 0===webVROptions&&(webVROptions={});var _this=this;if(this.webVROptions=webVROptions,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVR=new BABYLON.Observable,this.onExitingVR=new BABYLON.Observable,this.onControllerMeshLoaded=new BABYLON.Observable,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportationEnabledOnLeftController=!1,this._teleportationEnabledOnRightController=!1,this._interactionsEnabledOnLeftController=!1,this._interactionsEnabledOnRightController=!1,this._leftControllerReady=!1,this._rightControllerReady=!1,this._floorMeshesCollection=[],this._teleportationAllowed=!1,this._rotationAllowed=!0,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this.teleportBackwardsVector=new BABYLON.Vector3(0,-1,-1),this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new BABYLON.Vector3(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this.onNewMeshSelected=new BABYLON.Observable,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationEnabled=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this._dpadPressed=!0,this._onResize=function(){_this.moveButtonToBottomRight(),_this._fullscreenVRpresenting&&_this._webVRready&&_this.exitVR()},this._onFullscreenChange=function(){void 0!==document.fullscreen?_this._fullscreenVRpresenting=document.fullscreen:void 0!==document.mozFullScreen?_this._fullscreenVRpresenting=document.mozFullScreen:void 0!==document.webkitIsFullScreen?_this._fullscreenVRpresenting=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(_this._fullscreenVRpresenting=document.msIsFullScreen),!_this._fullscreenVRpresenting&&_this._canvas&&(_this.exitVR(),_this._useCustomVRButton||(_this._btnVR.style.top=_this._canvas.offsetTop+_this._canvas.offsetHeight-70+"px",_this._btnVR.style.left=_this._canvas.offsetLeft+_this._canvas.offsetWidth-100+"px"))},this.beforeRender=function(){_this._castRayAndSelectObject()},this._onNewGamepadConnected=function(gamepad){if(gamepad.type!==BABYLON.Gamepad.POSE_ENABLED)gamepad.leftStick&&gamepad.onleftstickchanged(function(stickValues){_this._teleportationEnabled&&(!_this._leftLaserPointer&&!_this._rightLaserPointer||_this._leftLaserPointer&&!_this._leftLaserPointer.isVisible&&_this._rightLaserPointer&&!_this._rightLaserPointer.isVisible)&&(_this._checkTeleportWithRay(stickValues),_this._checkTeleportBackwards(stickValues))}),gamepad.rightStick&&gamepad.onrightstickchanged(function(stickValues){_this._teleportationEnabled&&_this._checkRotate(stickValues)}),gamepad.type===BABYLON.Gamepad.XBOX&&(gamepad.onbuttondown(function(buttonPressed){_this._interactionsEnabled&&buttonPressed===BABYLON.Xbox360Button.A&&_this._selectionPointerDown()}),gamepad.onbuttonup(function(buttonPressed){_this._interactionsEnabled&&buttonPressed===BABYLON.Xbox360Button.A&&_this._selectionPointerUp()}));else{var webVRController=gamepad;_this._tryEnableInteractionOnController(webVRController)}},this._tryEnableInteractionOnController=function(webVRController){"left"===webVRController.hand&&(_this._leftControllerReady=!0,_this._interactionsRequested&&!_this._interactionsEnabledOnLeftController&&_this._enableInteractionOnController(webVRController),_this._teleportationRequested&&!_this._teleportationEnabledOnLeftController&&_this._enableTeleportationOnController(webVRController)),"right"===webVRController.hand&&(_this._rightControllerReady=!0,_this._interactionsRequested&&!_this._interactionsEnabledOnRightController&&_this._enableInteractionOnController(webVRController),_this._teleportationRequested&&!_this._teleportationEnabledOnRightController&&_this._enableTeleportationOnController(webVRController))},this._onNewGamepadDisconnected=function(gamepad){gamepad instanceof BABYLON.WebVRController&&("left"===gamepad.hand&&(_this._interactionsEnabledOnLeftController=!1,_this._teleportationEnabledOnLeftController=!1,_this._leftControllerReady=!1,_this._leftLaserPointer&&_this._leftLaserPointer.dispose()),"right"===gamepad.hand&&(_this._interactionsEnabledOnRightController=!1,_this._teleportationEnabledOnRightController=!1,_this._rightControllerReady=!1,_this._rightLaserPointer&&_this._rightLaserPointer.dispose()))},this._workingVector=BABYLON.Vector3.Zero(),this._workingQuaternion=BABYLON.Quaternion.Identity(),this._workingMatrix=BABYLON.Matrix.Identity(),this._scene=scene,this._canvas=scene.getEngine().getRenderingCanvas(),void 0===webVROptions.createFallbackVRDeviceOrientationFreeCamera&&(webVROptions.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===webVROptions.createDeviceOrientationCamera&&(webVROptions.createDeviceOrientationCamera=!0),void 0===webVROptions.defaultHeight&&(webVROptions.defaultHeight=1.7),webVROptions.useCustomVRButton&&(this._useCustomVRButton=!0,webVROptions.customVRButton&&(this._btnVR=webVROptions.customVRButton)),webVROptions.rayLength&&(this._rayLength=webVROptions.rayLength),this._defaultHeight=webVROptions.defaultHeight,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new BABYLON.Vector3(0,this._defaultHeight,0),webVROptions.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new BABYLON.DeviceOrientationCamera("deviceOrientationVRHelper",this._position.clone(),scene),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof BABYLON.TargetCamera&&this._scene.activeCamera.rotation)){var targetCamera=this._scene.activeCamera;targetCamera.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(targetCamera.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(BABYLON.Quaternion.RotationYawPitchRoll(targetCamera.rotation.y,targetCamera.rotation.x,targetCamera.rotation.z)),this._deviceOrientationCamera.rotation=targetCamera.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(webVROptions.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new BABYLON.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper",this._position,this._scene)),this._webVRCamera=new BABYLON.WebVRFreeCamera("WebVRHelper",this._position,this._scene,webVROptions),this._webVRCamera.useStandingMatrix(),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var css=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";css+=".babylonVRicon.vrdisplaypresenting { display: none; }";var style=document.createElement("style");style.appendChild(document.createTextNode(css)),document.getElementsByTagName("head")[0].appendChild(style),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){_this.isInVRMode?_this.exitVR():_this.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),webVROptions.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(e){e.vrDisplay&&_this.displayVRButton()}),this._onKeyDown=function(event){27===event.keyCode&&_this.isInVRMode&&_this.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(pointerInfo,eventState){_this.isInVRMode&&(_this.exitVR(),_this._fullscreenVRpresenting&&_this._scene.getEngine().switchFullscreen(!0))},BABYLON.PointerEventTypes.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(eventArgs){return _this.onVRDisplayChanged(eventArgs)},this._onVrDisplayPresentChange=function(){return _this.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){_this._webVRrequesting=!0,_this.updateButtonVisibility()},this._onVRRequestPresentComplete=function(success){_this._webVRrequesting=!1,_this.updateButtonVisibility()},scene.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),scene.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),scene.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),scene.onDisposeObservable.add(function(){_this.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(webVRController){return _this._onDefaultMeshLoaded(webVRController)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new BABYLON.CircleEase,this._circleEase.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT)}return Object.defineProperty(VRExperienceHelper.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(value){value&&(value.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=value)},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(value){this._displayGaze=value,value||(this._gazeTracker.isVisible=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(value){this._displayLaserPointer=value,value?this._rightLaserPointer?this._rightLaserPointer.isVisible=!0:this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!0):(this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!1),this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(VRExperienceHelper.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),VRExperienceHelper.prototype._onDefaultMeshLoaded=function(webVRController){this._tryEnableInteractionOnController(webVRController);try{this.onControllerMeshLoaded.notifyObservers(webVRController)}catch(err){BABYLON.Tools.Warn("Error in your custom logic onControllerMeshLoaded: "+err)}},Object.defineProperty(VRExperienceHelper.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),VRExperienceHelper.prototype.onVrDisplayPresentChange=function(){var vrDisplay=this._scene.getEngine().getVRDevice();if(vrDisplay){var wasPresenting=this._webVRpresenting;this._webVRpresenting=vrDisplay.isPresenting,wasPresenting&&!this._webVRpresenting&&this.exitVR()}else BABYLON.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},VRExperienceHelper.prototype.onVRDisplayChanged=function(eventArgs){this._webVRsupported=eventArgs.vrSupported,this._webVRready=!!eventArgs.vrDisplay,this._webVRpresenting=eventArgs.vrDisplay&&eventArgs.vrDisplay.isPresenting,this.updateButtonVisibility()},VRExperienceHelper.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},VRExperienceHelper.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},VRExperienceHelper.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},VRExperienceHelper.prototype.enterVR=function(){if(this.onEnteringVR)try{this.onEnteringVR.notifyObservers(this)}catch(err){BABYLON.Tools.Warn("Error in your custom logic onEnteringVR: "+err)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().switchFullscreen(!0),this.updateButtonVisibility()),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas))},VRExperienceHelper.prototype.exitVR=function(){if(this.onExitingVR)try{this.onExitingVR.notifyObservers(this)}catch(err){BABYLON.Tools.Warn("Error in your custom logic onExitingVR: "+err)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera),this.updateButtonVisibility()},Object.defineProperty(VRExperienceHelper.prototype,"position",{get:function(){return this._position},set:function(value){this._position=value,this._scene.activeCamera&&(this._scene.activeCamera.position=value)},enumerable:!0,configurable:!0}),VRExperienceHelper.prototype.enableInteractions=function(){var _this=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftControllerReady&&this._webVRCamera.leftController&&this._enableInteractionOnController(this._webVRCamera.leftController),this._rightControllerReady&&this._webVRCamera.rightController&&this._enableInteractionOnController(this._webVRCamera.rightController),this._createGazeTracker(),this.raySelectionPredicate=function(mesh){return!0},this.meshSelectionPredicate=function(mesh){return!0},this._raySelectionPredicate=function(mesh){return!!(_this._isTeleportationFloor(mesh)||mesh.isVisible&&-1===mesh.name.indexOf("gazeTracker")&&-1===mesh.name.indexOf("teleportationTarget")&&-1===mesh.name.indexOf("torusTeleportation")&&-1===mesh.name.indexOf("laserPointer"))&&_this.raySelectionPredicate(mesh)},this._scene.registerBeforeRender(this.beforeRender),this._interactionsEnabled=!0)},VRExperienceHelper.prototype._isTeleportationFloor=function(mesh){for(var i=0;i<this._floorMeshesCollection.length;i++)if(this._floorMeshesCollection[i].id===mesh.id)return!0;return!(!this._floorMeshName||mesh.name!==this._floorMeshName)},VRExperienceHelper.prototype.addFloorMesh=function(floorMesh){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(floorMesh)>-1||this._floorMeshesCollection.push(floorMesh))},VRExperienceHelper.prototype.removeFloorMesh=function(floorMesh){if(this._floorMeshesCollection){var meshIndex=this._floorMeshesCollection.indexOf(floorMesh);-1!==meshIndex&&this._floorMeshesCollection.splice(meshIndex,1)}},VRExperienceHelper.prototype.enableTeleportation=function(vrTeleportationOptions){if(void 0===vrTeleportationOptions&&(vrTeleportationOptions={}),!this._teleportationEnabled){this._teleportationRequested=!0,this.enableInteractions(),vrTeleportationOptions&&(vrTeleportationOptions.floorMeshName&&(this._floorMeshName=vrTeleportationOptions.floorMeshName),vrTeleportationOptions.floorMeshes&&(this._floorMeshesCollection=vrTeleportationOptions.floorMeshes)),this._leftControllerReady&&this._webVRCamera.leftController&&this._enableTeleportationOnController(this._webVRCamera.leftController),this._rightControllerReady&&this._webVRCamera.rightController&&this._enableTeleportationOnController(this._webVRCamera.rightController);var imageProcessingConfiguration=new BABYLON.ImageProcessingConfiguration;imageProcessingConfiguration.vignetteColor=new BABYLON.Color4(0,0,0,0),imageProcessingConfiguration.vignetteEnabled=!0,this._postProcessMove=new BABYLON.ImageProcessingPostProcess("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,imageProcessingConfiguration),this._webVRCamera.detachPostProcess(this._postProcessMove),this._passProcessMove=new BABYLON.PassPostProcess("pass",1,this._webVRCamera),this._teleportationEnabled=!0,this._isDefaultTeleportationTarget&&this._createTeleportationCircles()}},VRExperienceHelper.prototype._enableInteractionOnController=function(webVRController){var _this=this,controllerMesh=webVRController.mesh;if(controllerMesh){var makeNotPick=function(root){root.name+=" laserPointer",root.getChildMeshes().forEach(function(c){makeNotPick(c)})};makeNotPick(controllerMesh);for(var childMeshes=controllerMesh.getChildMeshes(),i=0;i<childMeshes.length;i++)if(childMeshes[i].name&&childMeshes[i].name.indexOf("POINTING_POSE")>=0){controllerMesh=childMeshes[i];break}var laserPointer=BABYLON.Mesh.CreateCylinder("laserPointer",1,.004,2e-4,20,1,this._scene,!1),laserPointerMaterial=new BABYLON.StandardMaterial("laserPointerMat",this._scene);laserPointerMaterial.emissiveColor=new BABYLON.Color3(.7,.7,.7),laserPointerMaterial.alpha=.6,laserPointer.material=laserPointerMaterial,laserPointer.rotation.x=Math.PI/2,laserPointer.parent=controllerMesh,laserPointer.position.z=-.5,laserPointer.isVisible=!1,"left"===webVRController.hand?(this._leftLaserPointer=laserPointer,this._interactionsEnabledOnLeftController=!0,this._rightLaserPointer||(this._leftLaserPointer.isVisible=!0)):(this._rightLaserPointer=laserPointer,this._interactionsEnabledOnRightController=!0,this._leftLaserPointer||(this._rightLaserPointer.isVisible=!0)),webVRController.onMainButtonStateChangedObservable.add(function(stateObject){_this._displayLaserPointer&&1===stateObject.value&&(laserPointer.isVisible=!laserPointer.isVisible,"left"===webVRController.hand&&_this._rightLaserPointer?_this._rightLaserPointer.isVisible=!1:_this._leftLaserPointer&&(_this._leftLaserPointer.isVisible=!1))}),webVRController.onTriggerStateChangedObservable.add(function(stateObject){_this._pointerDownOnMeshAsked?stateObject.value<_this._padSensibilityDown&&_this._selectionPointerUp():stateObject.value>_this._padSensibilityUp&&_this._selectionPointerDown()})}},VRExperienceHelper.prototype._checkTeleportWithRay=function(stateObject,webVRController){void 0===webVRController&&(webVRController=null),this._teleportationRequestInitiated?(null==webVRController||"left"===webVRController.hand&&this._leftLaserPointer&&this._leftLaserPointer.isVisible||"right"===webVRController.hand&&this._rightLaserPointer&&this._rightLaserPointer.isVisible)&&Math.sqrt(stateObject.y*stateObject.y+stateObject.x*stateObject.x)<this._padSensibilityDown&&(this._teleportationAllowed&&(this._teleportationAllowed=!1,this._teleportCamera()),this._teleportationRequestInitiated=!1):stateObject.y<-this._padSensibilityUp&&this._dpadPressed&&(webVRController&&(this._displayLaserPointer&&"left"===webVRController.hand&&this._leftLaserPointer?(this._leftLaserPointer.isVisible=!0,this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!1)):this._displayLaserPointer&&this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!0,this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!1))),this._teleportationRequestInitiated=!0)},VRExperienceHelper.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentMeshSelected&&this._currentHit&&this._scene.simulatePointerDown(this._currentHit)},VRExperienceHelper.prototype._selectionPointerUp=function(){this._currentMeshSelected&&this._currentHit&&this._scene.simulatePointerUp(this._currentHit),this._pointerDownOnMeshAsked=!1},VRExperienceHelper.prototype._checkRotate=function(stateObject){this._teleportationRequestInitiated||(this._rotationLeftAsked?stateObject.x>-this._padSensibilityDown&&(this._rotationLeftAsked=!1):stateObject.x<-this._padSensibilityUp&&this._dpadPressed&&(this._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),this._rotationRightAsked?stateObject.x<this._padSensibilityDown&&(this._rotationRightAsked=!1):stateObject.x>this._padSensibilityUp&&this._dpadPressed&&(this._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},VRExperienceHelper.prototype._checkTeleportBackwards=function(stateObject){if(!this._teleportationRequestInitiated)if(stateObject.y>this._padSensibilityUp&&this._dpadPressed){if(!this._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var rotation=BABYLON.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),position=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(rotation=this.currentVRCamera.deviceRotationQuaternion,position=this.currentVRCamera.devicePosition),rotation.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,BABYLON.Quaternion.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),BABYLON.Vector3.TransformCoordinatesToRef(this.teleportBackwardsVector,this._workingMatrix,this._workingVector);var ray=new BABYLON.Ray(position,this._workingVector),hit=this._scene.pickWithRay(ray,this._raySelectionPredicate);hit&&hit.pickedPoint&&hit.pickedMesh&&this._isTeleportationFloor(hit.pickedMesh)&&hit.distance<5&&this._teleportCamera(hit.pickedPoint),this._teleportationBackRequestInitiated=!0}}else this._teleportationBackRequestInitiated=!1},VRExperienceHelper.prototype._enableTeleportationOnController=function(webVRController){var _this=this;webVRController.mesh&&("left"===webVRController.hand?(this._interactionsEnabledOnLeftController||this._enableInteractionOnController(webVRController),this._teleportationEnabledOnLeftController=!0):(this._interactionsEnabledOnRightController||this._enableInteractionOnController(webVRController),this._teleportationEnabledOnRightController=!0),webVRController.controllerType===BABYLON.PoseEnabledControllerType.VIVE&&(this._dpadPressed=!1,webVRController.onPadStateChangedObservable.add(function(stateObject){_this._dpadPressed=stateObject.pressed,_this._dpadPressed||(_this._rotationLeftAsked=!1,_this._rotationRightAsked=!1,_this._teleportationBackRequestInitiated=!1)})),webVRController.onPadValuesChangedObservable.add(function(stateObject){_this._checkTeleportBackwards(stateObject),_this._checkTeleportWithRay(stateObject,webVRController),_this._checkRotate(stateObject)}))},VRExperienceHelper.prototype._createGazeTracker=function(){this._gazeTracker=BABYLON.Mesh.CreateTorus("gazeTracker",.0035,.0025,20,this._scene,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var targetMat=new BABYLON.StandardMaterial("targetMat",this._scene);targetMat.specularColor=BABYLON.Color3.Black(),targetMat.emissiveColor=new BABYLON.Color3(.7,.7,.7),targetMat.backFaceCulling=!1,this._gazeTracker.material=targetMat},VRExperienceHelper.prototype._createTeleportationCircles=function(){this._teleportationTarget=BABYLON.Mesh.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var dynamicTexture=new BABYLON.DynamicTexture("DynamicTexture",512,this._scene,!0);dynamicTexture.hasAlpha=!0;var context=dynamicTexture.getContext();context.beginPath(),context.arc(256,256,200,0,2*Math.PI,!1),context.fillStyle=this._teleportationFillColor,context.fill(),context.lineWidth=10,context.strokeStyle=this._teleportationBorderColor,context.stroke(),context.closePath(),dynamicTexture.update();var teleportationCircleMaterial=new BABYLON.StandardMaterial("TextPlaneMaterial",this._scene);teleportationCircleMaterial.diffuseTexture=dynamicTexture,this._teleportationTarget.material=teleportationCircleMaterial;var torus=BABYLON.Mesh.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);torus.isPickable=!1,torus.parent=this._teleportationTarget;var animationInnerCircle=new BABYLON.Animation("animationInnerCircle","position.y",30,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),keys=[];keys.push({frame:0,value:0}),keys.push({frame:30,value:.4}),keys.push({frame:60,value:0}),animationInnerCircle.setKeys(keys);var easingFunction=new BABYLON.SineEase;easingFunction.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),animationInnerCircle.setEasingFunction(easingFunction),torus.animations=[],torus.animations.push(animationInnerCircle),this._scene.beginAnimation(torus,0,60,!0),this._hideTeleportationTarget()},VRExperienceHelper.prototype._displayTeleportationTarget=function(){this._teleportationEnabled&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},VRExperienceHelper.prototype._hideTeleportationTarget=function(){this._teleportationEnabled&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},VRExperienceHelper.prototype._rotateCamera=function(right){var _this=this;if(this.currentVRCamera instanceof BABYLON.FreeCamera){right?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var target=BABYLON.Quaternion.FromRotationMatrix(BABYLON.Matrix.RotationY(Math.PI/4*this._rotationAngle)),animationRotation=new BABYLON.Animation("animationRotation","rotationQuaternion",90,BABYLON.Animation.ANIMATIONTYPE_QUATERNION,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),animationRotationKeys=[];animationRotationKeys.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),animationRotationKeys.push({frame:6,value:target}),animationRotation.setKeys(animationRotationKeys),animationRotation.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(animationRotation),this._postProcessMove.animations=[];var animationPP=new BABYLON.Animation("animationPP","vignetteWeight",90,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),vignetteWeightKeys=[];vignetteWeightKeys.push({frame:0,value:0}),vignetteWeightKeys.push({frame:3,value:4}),vignetteWeightKeys.push({frame:6,value:0}),animationPP.setKeys(vignetteWeightKeys),animationPP.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(animationPP);var animationPP2=new BABYLON.Animation("animationPP2","vignetteStretch",90,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),vignetteStretchKeys=[];vignetteStretchKeys.push({frame:0,value:0}),vignetteStretchKeys.push({frame:3,value:10}),vignetteStretchKeys.push({frame:6,value:0}),animationPP2.setKeys(vignetteStretchKeys),animationPP2.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(animationPP2),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){_this._webVRCamera.detachPostProcess(_this._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},VRExperienceHelper.prototype._moveTeleportationSelectorTo=function(hit){if(hit.pickedPoint){this._teleportationAllowed=!0,this._teleportationRequestInitiated?this._displayTeleportationTarget():this._hideTeleportationTarget(),this._haloCenter.copyFrom(hit.pickedPoint),this._teleportationTarget.position.copyFrom(hit.pickedPoint);var pickNormal=hit.getNormal(!0,!1);if(pickNormal){var axis1=BABYLON.Vector3.Cross(BABYLON.Axis.Y,pickNormal),axis2=BABYLON.Vector3.Cross(pickNormal,axis1);BABYLON.Vector3.RotationFromAxisToRef(axis2,pickNormal,axis1,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},VRExperienceHelper.prototype._teleportCamera=function(location){var _this=this;if(void 0===location&&(location=null),this.currentVRCamera instanceof BABYLON.FreeCamera){location||(location=this._haloCenter),this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),location.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(location),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround():this._workingVector.y+=this._defaultHeight,this.currentVRCamera.animations=[];var animationCameraTeleportation=new BABYLON.Animation("animationCameraTeleportation","position",90,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),animationCameraTeleportationKeys=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];animationCameraTeleportation.setKeys(animationCameraTeleportationKeys),animationCameraTeleportation.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(animationCameraTeleportation),this._postProcessMove.animations=[];var animationPP=new BABYLON.Animation("animationPP","vignetteWeight",90,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),vignetteWeightKeys=[];vignetteWeightKeys.push({frame:0,value:0}),vignetteWeightKeys.push({frame:5,value:8}),vignetteWeightKeys.push({frame:11,value:0}),animationPP.setKeys(vignetteWeightKeys),this._postProcessMove.animations.push(animationPP);var animationPP2=new BABYLON.Animation("animationPP2","vignetteStretch",90,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),vignetteStretchKeys=[];vignetteStretchKeys.push({frame:0,value:0}),vignetteStretchKeys.push({frame:5,value:10}),vignetteStretchKeys.push({frame:11,value:0}),animationPP2.setKeys(vignetteStretchKeys),this._postProcessMove.animations.push(animationPP2),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){_this._webVRCamera.detachPostProcess(_this._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1)}},VRExperienceHelper.prototype._castRayAndSelectObject=function(){if(this.currentVRCamera instanceof BABYLON.FreeCamera){var ray;ray=this._leftLaserPointer&&this._leftLaserPointer.isVisible&&this.currentVRCamera.leftController?this.currentVRCamera.leftController.getForwardRay(this._rayLength):this._rightLaserPointer&&this._rightLaserPointer.isVisible&&this.currentVRCamera.rightController?this.currentVRCamera.rightController.getForwardRay(this._rayLength):this.currentVRCamera.getForwardRay(this._rayLength);var hit=this._scene.pickWithRay(ray,this._raySelectionPredicate);if(hit&&hit.pickedPoint){if(this._displayGaze){var multiplier=1;this._gazeTracker.isVisible=!0,this._isActionableMesh&&(multiplier=3),this._gazeTracker.scaling.x=hit.distance*multiplier,this._gazeTracker.scaling.y=hit.distance*multiplier,this._gazeTracker.scaling.z=hit.distance*multiplier;var pickNormal=hit.getNormal();if(pickNormal){var axis1=BABYLON.Vector3.Cross(BABYLON.Axis.Y,pickNormal),axis2=BABYLON.Vector3.Cross(pickNormal,axis1);BABYLON.Vector3.RotationFromAxisToRef(axis2,pickNormal,axis1,this._gazeTracker.rotation)}this._gazeTracker.position.copyFrom(hit.pickedPoint),this._gazeTracker.position.x<0?this._gazeTracker.position.x+=.002:this._gazeTracker.position.x-=.002,this._gazeTracker.position.y<0?this._gazeTracker.position.y+=.002:this._gazeTracker.position.y-=.002,this._gazeTracker.position.z<0?this._gazeTracker.position.z+=.002:this._gazeTracker.position.z-=.002}this._rightLaserPointer&&this._rightLaserPointer.isVisible&&(this._rightLaserPointer.scaling.y=hit.distance,this._rightLaserPointer.position.z=-hit.distance/2),this._leftLaserPointer&&this._leftLaserPointer.isVisible&&(this._leftLaserPointer.scaling.y=hit.distance,this._leftLaserPointer.position.z=-hit.distance/2)}else this._gazeTracker.isVisible=!1;if(hit&&hit.pickedMesh){if(this._currentHit=hit,this._pointerDownOnMeshAsked&&this._scene.simulatePointerMove(this._currentHit),this._teleportationEnabled&&this._isTeleportationFloor(hit.pickedMesh)&&hit.pickedPoint)return void this._moveTeleportationSelectorTo(hit);if(this._hideTeleportationTarget(),this._teleportationAllowed=!1,hit.pickedMesh!==this._currentMeshSelected)if(this.meshSelectionPredicate(hit.pickedMesh)){this._currentMeshSelected=hit.pickedMesh,hit.pickedMesh.isPickable&&hit.pickedMesh.actionManager?(this.changeGazeColor(new BABYLON.Color3(0,0,1)),this.changeLaserColor(new BABYLON.Color3(.2,.2,1)),this._isActionableMesh=!0):(this.changeGazeColor(new BABYLON.Color3(.7,.7,.7)),this.changeLaserColor(new BABYLON.Color3(.7,.7,.7)),this._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(this._currentMeshSelected)}catch(err){BABYLON.Tools.Warn("Error in your custom logic onNewMeshSelected: "+err)}}else this._currentMeshSelected=null,this.changeGazeColor(new BABYLON.Color3(.7,.7,.7)),this.changeLaserColor(new BABYLON.Color3(.7,.7,.7))}else this._currentHit=null,this._currentMeshSelected=null,this._teleportationAllowed=!1,this._hideTeleportationTarget(),this.changeGazeColor(new BABYLON.Color3(.7,.7,.7)),this.changeLaserColor(new BABYLON.Color3(.7,.7,.7))}},VRExperienceHelper.prototype.changeLaserColor=function(color){this._leftLaserPointer&&this._leftLaserPointer.material&&(this._leftLaserPointer.material.emissiveColor=color),this._rightLaserPointer&&this._rightLaserPointer.material&&(this._rightLaserPointer.material.emissiveColor=color)},VRExperienceHelper.prototype.changeGazeColor=function(color){this._gazeTracker.material&&(this._gazeTracker.material.emissiveColor=color)},VRExperienceHelper.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._passProcessMove&&this._passProcessMove.dispose(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._gazeTracker&&this._gazeTracker.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},VRExperienceHelper.prototype.getClassName=function(){return"VRExperienceHelper"},VRExperienceHelper}();BABYLON.VRExperienceHelper=VRExperienceHelper}(BABYLON||(BABYLON={}));!function(BABYLON){var JoystickAxis;!function(JoystickAxis){JoystickAxis[JoystickAxis.X=0]="X",JoystickAxis[JoystickAxis.Y=1]="Y",JoystickAxis[JoystickAxis.Z=2]="Z"}(JoystickAxis=BABYLON.JoystickAxis||(BABYLON.JoystickAxis={}));var VirtualJoystick=function(){function VirtualJoystick(leftJoystick){var _this=this;if(this._leftJoystick=!!leftJoystick,VirtualJoystick._globalJoystickIndex++,this._axisTargetedByLeftAndRight=JoystickAxis.X,this._axisTargetedByUpAndDown=JoystickAxis.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new BABYLON.StringDictionary,this.deltaPosition=BABYLON.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(evt){VirtualJoystick.vjCanvasWidth=window.innerWidth,VirtualJoystick.vjCanvasHeight=window.innerHeight,VirtualJoystick.vjCanvas&&(VirtualJoystick.vjCanvas.width=VirtualJoystick.vjCanvasWidth,VirtualJoystick.vjCanvas.height=VirtualJoystick.vjCanvasHeight),VirtualJoystick.halfWidth=VirtualJoystick.vjCanvasWidth/2},!VirtualJoystick.vjCanvas){window.addEventListener("resize",this._onResize,!1),VirtualJoystick.vjCanvas=document.createElement("canvas"),VirtualJoystick.vjCanvasWidth=window.innerWidth,VirtualJoystick.vjCanvasHeight=window.innerHeight,VirtualJoystick.vjCanvas.width=window.innerWidth,VirtualJoystick.vjCanvas.height=window.innerHeight,VirtualJoystick.vjCanvas.style.width="100%",VirtualJoystick.vjCanvas.style.height="100%",VirtualJoystick.vjCanvas.style.position="absolute",VirtualJoystick.vjCanvas.style.backgroundColor="transparent",VirtualJoystick.vjCanvas.style.top="0px",VirtualJoystick.vjCanvas.style.left="0px",VirtualJoystick.vjCanvas.style.zIndex="5",VirtualJoystick.vjCanvas.style.msTouchAction="none",VirtualJoystick.vjCanvas.setAttribute("touch-action","none");var context=VirtualJoystick.vjCanvas.getContext("2d");if(!context)throw new Error("Unable to create canvas for virtual joystick");VirtualJoystick.vjCanvasContext=context,VirtualJoystick.vjCanvasContext.strokeStyle="#ffffff",VirtualJoystick.vjCanvasContext.lineWidth=2,document.body.appendChild(VirtualJoystick.vjCanvas)}VirtualJoystick.halfWidth=VirtualJoystick.vjCanvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new BABYLON.Vector2(0,0),this._joystickPreviousPointerPos=new BABYLON.Vector2(0,0),this._joystickPointerStartPos=new BABYLON.Vector2(0,0),this._deltaJoystickVector=new BABYLON.Vector2(0,0),this._onPointerDownHandlerRef=function(evt){_this._onPointerDown(evt)},this._onPointerMoveHandlerRef=function(evt){_this._onPointerMove(evt)},this._onPointerUpHandlerRef=function(evt){_this._onPointerUp(evt)},VirtualJoystick.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),VirtualJoystick.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),VirtualJoystick.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),VirtualJoystick.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),VirtualJoystick.vjCanvas.addEventListener("contextmenu",function(evt){evt.preventDefault()},!1),requestAnimationFrame(function(){_this._drawVirtualJoystick()})}return VirtualJoystick.prototype.setJoystickSensibility=function(newJoystickSensibility){this._joystickSensibility=newJoystickSensibility,this._inversedSensibility=1/(this._joystickSensibility/1e3)},VirtualJoystick.prototype._onPointerDown=function(e){e.preventDefault(),(!0===this._leftJoystick?e.clientX<VirtualJoystick.halfWidth:e.clientX>VirtualJoystick.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):VirtualJoystick._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),{x:e.clientX,y:e.clientY,prevX:e.clientX,prevY:e.clientY}))},VirtualJoystick.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var deltaJoystickX=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case JoystickAxis.X:this.deltaPosition.x=Math.min(1,Math.max(-1,deltaJoystickX));break;case JoystickAxis.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,deltaJoystickX));break;case JoystickAxis.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,deltaJoystickX))}var deltaJoystickY=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case JoystickAxis.X:this.deltaPosition.x=Math.min(1,Math.max(-1,deltaJoystickY));break;case JoystickAxis.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,deltaJoystickY));break;case JoystickAxis.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,deltaJoystickY))}}else{var data=this._touches.get(e.pointerId.toString());data&&(data.x=e.clientX,data.y=e.clientY)}},VirtualJoystick.prototype._onPointerUp=function(e){if(this._joystickPointerID==e.pointerId)VirtualJoystick.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),VirtualJoystick.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var touch=this._touches.get(e.pointerId.toString());touch&&VirtualJoystick.vjCanvasContext.clearRect(touch.prevX-44,touch.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},VirtualJoystick.prototype.setJoystickColor=function(newColor){this._joystickColor=newColor},VirtualJoystick.prototype.setActionOnTouch=function(action){this._action=action},VirtualJoystick.prototype.setAxisForLeftRight=function(axis){switch(axis){case JoystickAxis.X:case JoystickAxis.Y:case JoystickAxis.Z:this._axisTargetedByLeftAndRight=axis;break;default:this._axisTargetedByLeftAndRight=JoystickAxis.X}},VirtualJoystick.prototype.setAxisForUpDown=function(axis){switch(axis){case JoystickAxis.X:case JoystickAxis.Y:case JoystickAxis.Z:this._axisTargetedByUpAndDown=axis;break;default:this._axisTargetedByUpAndDown=JoystickAxis.Y}},VirtualJoystick.prototype._drawVirtualJoystick=function(){var _this=this;this.pressed&&this._touches.forEach(function(key,touch){touch.pointerId===_this._joystickPointerID?(VirtualJoystick.vjCanvasContext.clearRect(_this._joystickPointerStartPos.x-64,_this._joystickPointerStartPos.y-64,128,128),VirtualJoystick.vjCanvasContext.clearRect(_this._joystickPreviousPointerPos.x-42,_this._joystickPreviousPointerPos.y-42,84,84),VirtualJoystick.vjCanvasContext.beginPath(),VirtualJoystick.vjCanvasContext.lineWidth=6,VirtualJoystick.vjCanvasContext.strokeStyle=_this._joystickColor,VirtualJoystick.vjCanvasContext.arc(_this._joystickPointerStartPos.x,_this._joystickPointerStartPos.y,40,0,2*Math.PI,!0),VirtualJoystick.vjCanvasContext.stroke(),VirtualJoystick.vjCanvasContext.closePath(),VirtualJoystick.vjCanvasContext.beginPath(),VirtualJoystick.vjCanvasContext.strokeStyle=_this._joystickColor,VirtualJoystick.vjCanvasContext.lineWidth=2,VirtualJoystick.vjCanvasContext.arc(_this._joystickPointerStartPos.x,_this._joystickPointerStartPos.y,60,0,2*Math.PI,!0),VirtualJoystick.vjCanvasContext.stroke(),VirtualJoystick.vjCanvasContext.closePath(),VirtualJoystick.vjCanvasContext.beginPath(),VirtualJoystick.vjCanvasContext.strokeStyle=_this._joystickColor,VirtualJoystick.vjCanvasContext.arc(_this._joystickPointerPos.x,_this._joystickPointerPos.y,40,0,2*Math.PI,!0),VirtualJoystick.vjCanvasContext.stroke(),VirtualJoystick.vjCanvasContext.closePath(),_this._joystickPreviousPointerPos=_this._joystickPointerPos.clone()):(VirtualJoystick.vjCanvasContext.clearRect(touch.prevX-44,touch.prevY-44,88,88),VirtualJoystick.vjCanvasContext.beginPath(),VirtualJoystick.vjCanvasContext.fillStyle="white",VirtualJoystick.vjCanvasContext.beginPath(),VirtualJoystick.vjCanvasContext.strokeStyle="red",VirtualJoystick.vjCanvasContext.lineWidth=6,VirtualJoystick.vjCanvasContext.arc(touch.x,touch.y,40,0,2*Math.PI,!0),VirtualJoystick.vjCanvasContext.stroke(),VirtualJoystick.vjCanvasContext.closePath(),touch.prevX=touch.x,touch.prevY=touch.y)}),requestAnimationFrame(function(){_this._drawVirtualJoystick()})},VirtualJoystick.prototype.releaseCanvas=function(){VirtualJoystick.vjCanvas&&(VirtualJoystick.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),VirtualJoystick.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),VirtualJoystick.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),VirtualJoystick.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(VirtualJoystick.vjCanvas),VirtualJoystick.vjCanvas=null)},VirtualJoystick._globalJoystickIndex=0,VirtualJoystick}();BABYLON.VirtualJoystick=VirtualJoystick}(BABYLON||(BABYLON={}));!function(BABYLON){var VirtualJoysticksCamera=function(_super){function VirtualJoysticksCamera(name,position,scene){var _this=_super.call(this,name,position,scene)||this;return _this.inputs.addVirtualJoystick(),_this}return __extends(VirtualJoysticksCamera,_super),VirtualJoysticksCamera.prototype.getClassName=function(){return"VirtualJoysticksCamera"},VirtualJoysticksCamera}(BABYLON.FreeCamera);BABYLON.VirtualJoysticksCamera=VirtualJoysticksCamera}(BABYLON||(BABYLON={}));!function(BABYLON){var FreeCameraVirtualJoystickInput=function(){function FreeCameraVirtualJoystickInput(){}return FreeCameraVirtualJoystickInput.prototype.getLeftJoystick=function(){return this._leftjoystick},FreeCameraVirtualJoystickInput.prototype.getRightJoystick=function(){return this._rightjoystick},FreeCameraVirtualJoystickInput.prototype.checkInputs=function(){if(this._leftjoystick){var camera=this.camera,speed=50*camera._computeLocalCameraSpeed(),cameraTransform=BABYLON.Matrix.RotationYawPitchRoll(camera.rotation.y,camera.rotation.x,0),deltaTransform=BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(this._leftjoystick.deltaPosition.x*speed,this._leftjoystick.deltaPosition.y*speed,this._leftjoystick.deltaPosition.z*speed),cameraTransform);camera.cameraDirection=camera.cameraDirection.add(deltaTransform),camera.cameraRotation=camera.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},FreeCameraVirtualJoystickInput.prototype.attachControl=function(element,noPreventDefault){this._leftjoystick=new BABYLON.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(BABYLON.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(BABYLON.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new BABYLON.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(BABYLON.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(BABYLON.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},FreeCameraVirtualJoystickInput.prototype.detachControl=function(element){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},FreeCameraVirtualJoystickInput.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},FreeCameraVirtualJoystickInput.prototype.getSimpleName=function(){return"virtualJoystick"},FreeCameraVirtualJoystickInput}();BABYLON.FreeCameraVirtualJoystickInput=FreeCameraVirtualJoystickInput,BABYLON.CameraInputTypes.FreeCameraVirtualJoystickInput=FreeCameraVirtualJoystickInput}(BABYLON||(BABYLON={}));!function(BABYLON){var SimplificationSettings=function(){return function(quality,distance,optimizeMesh){this.quality=quality,this.distance=distance,this.optimizeMesh=optimizeMesh}}();BABYLON.SimplificationSettings=SimplificationSettings;var SimplificationQueue=function(){function SimplificationQueue(){this.running=!1,this._simplificationArray=[]}return SimplificationQueue.prototype.addTask=function(task){this._simplificationArray.push(task)},SimplificationQueue.prototype.executeNext=function(){var task=this._simplificationArray.pop();task?(this.running=!0,this.runSimplification(task)):this.running=!1},SimplificationQueue.prototype.runSimplification=function(task){var _this=this;if(task.parallelProcessing)task.settings.forEach(function(setting){_this.getSimplifier(task).simplify(setting,function(newMesh){task.mesh.addLODLevel(setting.distance,newMesh),newMesh.isVisible=!0,setting.quality===task.settings[task.settings.length-1].quality&&task.successCallback&&task.successCallback(),_this.executeNext()})});else{var simplifier=this.getSimplifier(task),runDecimation=function(setting,callback){simplifier.simplify(setting,function(newMesh){task.mesh.addLODLevel(setting.distance,newMesh),newMesh.isVisible=!0,callback()})};BABYLON.AsyncLoop.Run(task.settings.length,function(loop){runDecimation(task.settings[loop.index],function(){loop.executeNext()})},function(){task.successCallback&&task.successCallback(),_this.executeNext()})}},SimplificationQueue.prototype.getSimplifier=function(task){switch(task.simplificationType){case SimplificationType.QUADRATIC:default:return new QuadraticErrorSimplification(task.mesh)}},SimplificationQueue}();BABYLON.SimplificationQueue=SimplificationQueue;var SimplificationType;!function(SimplificationType){SimplificationType[SimplificationType.QUADRATIC=0]="QUADRATIC"}(SimplificationType=BABYLON.SimplificationType||(BABYLON.SimplificationType={}));var DecimationTriangle=function(){return function(vertices){this.vertices=vertices,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}}();BABYLON.DecimationTriangle=DecimationTriangle;var DecimationVertex=function(){function DecimationVertex(position,id){this.position=position,this.id=id,this.isBorder=!0,this.q=new QuadraticMatrix,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return DecimationVertex.prototype.updatePosition=function(newPosition){this.position.copyFrom(newPosition)},DecimationVertex}();BABYLON.DecimationVertex=DecimationVertex;var QuadraticMatrix=function(){function QuadraticMatrix(data){this.data=new Array(10);for(var i=0;i<10;++i)data&&data[i]?this.data[i]=data[i]:this.data[i]=0}return QuadraticMatrix.prototype.det=function(a11,a12,a13,a21,a22,a23,a31,a32,a33){return this.data[a11]*this.data[a22]*this.data[a33]+this.data[a13]*this.data[a21]*this.data[a32]+this.data[a12]*this.data[a23]*this.data[a31]-this.data[a13]*this.data[a22]*this.data[a31]-this.data[a11]*this.data[a23]*this.data[a32]-this.data[a12]*this.data[a21]*this.data[a33]},QuadraticMatrix.prototype.addInPlace=function(matrix){for(var i=0;i<10;++i)this.data[i]+=matrix.data[i]},QuadraticMatrix.prototype.addArrayInPlace=function(data){for(var i=0;i<10;++i)this.data[i]+=data[i]},QuadraticMatrix.prototype.add=function(matrix){for(var m=new QuadraticMatrix,i=0;i<10;++i)m.data[i]=this.data[i]+matrix.data[i];return m},QuadraticMatrix.FromData=function(a,b,c,d){return new QuadraticMatrix(QuadraticMatrix.DataFromNumbers(a,b,c,d))},QuadraticMatrix.DataFromNumbers=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]},QuadraticMatrix}();BABYLON.QuadraticMatrix=QuadraticMatrix;var Reference=function(){return function(vertexId,triangleId){this.vertexId=vertexId,this.triangleId=triangleId}}();BABYLON.Reference=Reference;var QuadraticErrorSimplification=function(){function QuadraticErrorSimplification(_mesh){this._mesh=_mesh,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=BABYLON.Epsilon}return QuadraticErrorSimplification.prototype.simplify=function(settings,successCallback){var _this=this;this.initDecimatedMesh(),BABYLON.AsyncLoop.Run(this._mesh.subMeshes.length,function(loop){_this.initWithMesh(loop.index,function(){_this.runDecimation(settings,loop.index,function(){loop.executeNext()})},settings.optimizeMesh)},function(){setTimeout(function(){successCallback(_this._reconstructedMesh)},0)})},QuadraticErrorSimplification.prototype.runDecimation=function(settings,submeshIndex,successCallback){var _this=this,targetCount=~~(this.triangles.length*settings.quality),deletedTriangles=0,triangleCount=this.triangles.length,iterationFunction=function(iteration,callback){setTimeout(function(){iteration%5==0&&_this.updateMesh(0===iteration);for(var i=0;i<_this.triangles.length;++i)_this.triangles[i].isDirty=!1;var threshold=1e-9*Math.pow(iteration+3,_this.aggressiveness);BABYLON.AsyncLoop.SyncAsyncForLoop(_this.triangles.length,_this.syncIterations,function(i){var tIdx=~~((_this.triangles.length/2+i)%_this.triangles.length),t=_this.triangles[tIdx];if(t&&!(t.error[3]>threshold||t.deleted||t.isDirty))for(var j=0;j<3;++j)if(t.error[j]<threshold){var deleted0=[],deleted1=[],v0=t.vertices[j],v1=t.vertices[(j+1)%3];if(v0.isBorder||v1.isBorder)continue;var p=BABYLON.Vector3.Zero(),n=BABYLON.Vector3.Zero(),uv=BABYLON.Vector2.Zero(),color=new BABYLON.Color4(0,0,0,1);_this.calculateError(v0,v1,p,n,uv,color);var delTr=new Array;if(_this.isFlipped(v0,v1,p,deleted0,t.borderFactor,delTr))continue;if(_this.isFlipped(v1,v0,p,deleted1,t.borderFactor,delTr))continue;if(deleted0.indexOf(!0)<0||deleted1.indexOf(!0)<0)continue;var uniqueArray=new Array;if(delTr.forEach(function(deletedT){-1===uniqueArray.indexOf(deletedT)&&(deletedT.deletePending=!0,uniqueArray.push(deletedT))}),uniqueArray.length%2!=0)continue;v0.q=v1.q.add(v0.q),v0.updatePosition(p);var tStart=_this.references.length;deletedTriangles=_this.updateTriangles(v0,v0,deleted0,deletedTriangles),deletedTriangles=_this.updateTriangles(v0,v1,deleted1,deletedTriangles);var tCount=_this.references.length-tStart;if(tCount<=v0.triangleCount){if(tCount)for(var c=0;c<tCount;c++)_this.references[v0.triangleStart+c]=_this.references[tStart+c]}else v0.triangleStart=tStart;v0.triangleCount=tCount;break}},callback,function(){return triangleCount-deletedTriangles<=targetCount})},0)};BABYLON.AsyncLoop.Run(this.decimationIterations,function(loop){triangleCount-deletedTriangles<=targetCount?loop.breakLoop():iterationFunction(loop.index,function(){loop.executeNext()})},function(){setTimeout(function(){_this.reconstructMesh(submeshIndex),successCallback()},0)})},QuadraticErrorSimplification.prototype.initWithMesh=function(submeshIndex,callback,optimizeMesh){var _this=this;this.vertices=[],this.triangles=[];var positionData=this._mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),indices=this._mesh.getIndices(),submesh=this._mesh.subMeshes[submeshIndex],findInVertices=function(positionToSearch){if(optimizeMesh)for(var ii=0;ii<_this.vertices.length;++ii)if(_this.vertices[ii].position.equals(positionToSearch))return _this.vertices[ii];return null},vertexReferences=[],totalVertices=submesh.verticesCount;BABYLON.AsyncLoop.SyncAsyncForLoop(totalVertices,this.syncIterations/4>>0,function(i){if(positionData){var offset=i+submesh.verticesStart,position=BABYLON.Vector3.FromArray(positionData,3*offset),vertex=findInVertices(position)||new DecimationVertex(position,_this.vertices.length);vertex.originalOffsets.push(offset),vertex.id===_this.vertices.length&&_this.vertices.push(vertex),vertexReferences.push(vertex.id)}},function(){BABYLON.AsyncLoop.SyncAsyncForLoop(submesh.indexCount/3,_this.syncIterations,function(i){if(indices){var pos=3*(submesh.indexStart/3+i),i0=indices[pos+0],i1=indices[pos+1],i2=indices[pos+2],v0=_this.vertices[vertexReferences[i0-submesh.verticesStart]],v1=_this.vertices[vertexReferences[i1-submesh.verticesStart]],v2=_this.vertices[vertexReferences[i2-submesh.verticesStart]],triangle=new DecimationTriangle([v0,v1,v2]);triangle.originalOffset=pos,_this.triangles.push(triangle)}},function(){_this.init(callback)})})},QuadraticErrorSimplification.prototype.init=function(callback){var _this=this;BABYLON.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(i){var t=_this.triangles[i];t.normal=BABYLON.Vector3.Cross(t.vertices[1].position.subtract(t.vertices[0].position),t.vertices[2].position.subtract(t.vertices[0].position)).normalize();for(var j=0;j<3;j++)t.vertices[j].q.addArrayInPlace(QuadraticMatrix.DataFromNumbers(t.normal.x,t.normal.y,t.normal.z,-BABYLON.Vector3.Dot(t.normal,t.vertices[0].position)))},function(){BABYLON.AsyncLoop.SyncAsyncForLoop(_this.triangles.length,_this.syncIterations,function(i){for(var t=_this.triangles[i],j=0;j<3;++j)t.error[j]=_this.calculateError(t.vertices[j],t.vertices[(j+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])},function(){callback()})})},QuadraticErrorSimplification.prototype.reconstructMesh=function(submeshIndex){var i,newTriangles=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var t,j;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(t=this.triangles[i],j=0;j<3;++j)t.vertices[j].triangleCount=1;newTriangles.push(t)}var newPositionData=this._reconstructedMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind)||[],newNormalData=this._reconstructedMesh.getVerticesData(BABYLON.VertexBuffer.NormalKind)||[],newUVsData=this._reconstructedMesh.getVerticesData(BABYLON.VertexBuffer.UVKind)||[],newColorsData=this._reconstructedMesh.getVerticesData(BABYLON.VertexBuffer.ColorKind)||[],normalData=this._mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind),uvs=this._mesh.getVerticesData(BABYLON.VertexBuffer.UVKind),colorsData=this._mesh.getVerticesData(BABYLON.VertexBuffer.ColorKind),vertexCount=0;for(i=0;i<this.vertices.length;++i){var vertex=this.vertices[i];vertex.id=vertexCount,vertex.triangleCount&&vertex.originalOffsets.forEach(function(originalOffset){normalData&&(newPositionData.push(vertex.position.x),newPositionData.push(vertex.position.y),newPositionData.push(vertex.position.z),newNormalData.push(normalData[3*originalOffset]),newNormalData.push(normalData[3*originalOffset+1]),newNormalData.push(normalData[3*originalOffset+2]),uvs&&uvs.length?(newUVsData.push(uvs[2*originalOffset]),newUVsData.push(uvs[2*originalOffset+1])):colorsData&&colorsData.length&&(newColorsData.push(colorsData[4*originalOffset]),newColorsData.push(colorsData[4*originalOffset+1]),newColorsData.push(colorsData[4*originalOffset+2]),newColorsData.push(colorsData[4*originalOffset+3])),++vertexCount)})}var startingIndex=this._reconstructedMesh.getTotalIndices(),startingVertex=this._reconstructedMesh.getTotalVertices(),submeshesArray=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var newIndicesArray=this._reconstructedMesh.getIndices(),originalIndices=this._mesh.getIndices();for(i=0;i<newTriangles.length;++i)t=newTriangles[i],[0,1,2].forEach(function(idx){var id=originalIndices[t.originalOffset+idx],offset=t.vertices[idx].originalOffsets.indexOf(id);offset<0&&(offset=0),newIndicesArray.push(t.vertices[idx].id+offset+startingVertex)});this._reconstructedMesh.setIndices(newIndicesArray),this._reconstructedMesh.setVerticesData(BABYLON.VertexBuffer.PositionKind,newPositionData),this._reconstructedMesh.setVerticesData(BABYLON.VertexBuffer.NormalKind,newNormalData),newUVsData.length>0&&this._reconstructedMesh.setVerticesData(BABYLON.VertexBuffer.UVKind,newUVsData),newColorsData.length>0&&this._reconstructedMesh.setVerticesData(BABYLON.VertexBuffer.ColorKind,newColorsData);var originalSubmesh=this._mesh.subMeshes[submeshIndex];submeshIndex>0&&(this._reconstructedMesh.subMeshes=[],submeshesArray.forEach(function(submesh){BABYLON.SubMesh.AddToMesh(submesh.materialIndex,submesh.verticesStart,submesh.verticesCount,submesh.indexStart,submesh.indexCount,submesh.getMesh())}),BABYLON.SubMesh.AddToMesh(originalSubmesh.materialIndex,startingVertex,vertexCount,startingIndex,3*newTriangles.length,this._reconstructedMesh))},QuadraticErrorSimplification.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new BABYLON.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},QuadraticErrorSimplification.prototype.isFlipped=function(vertex1,vertex2,point,deletedArray,borderFactor,delTr){for(var i=0;i<vertex1.triangleCount;++i){var t=this.triangles[this.references[vertex1.triangleStart+i].triangleId];if(!t.deleted){var s=this.references[vertex1.triangleStart+i].vertexId,v1=t.vertices[(s+1)%3],v2=t.vertices[(s+2)%3];if(v1!==vertex2&&v2!==vertex2){var d1=v1.position.subtract(point);d1=d1.normalize();var d2=v2.position.subtract(point);if(d2=d2.normalize(),Math.abs(BABYLON.Vector3.Dot(d1,d2))>.999)return!0;var normal=BABYLON.Vector3.Cross(d1,d2).normalize();if(deletedArray[i]=!1,BABYLON.Vector3.Dot(normal,t.normal)<.2)return!0}else deletedArray[i]=!0,delTr.push(t)}}return!1},QuadraticErrorSimplification.prototype.updateTriangles=function(origVertex,vertex,deletedArray,deletedTriangles){for(var newDeleted=deletedTriangles,i=0;i<vertex.triangleCount;++i){var ref=this.references[vertex.triangleStart+i],t=this.triangles[ref.triangleId];t.deleted||(deletedArray[i]&&t.deletePending?(t.deleted=!0,newDeleted++):(t.vertices[ref.vertexId]=origVertex,t.isDirty=!0,t.error[0]=this.calculateError(t.vertices[0],t.vertices[1])+t.borderFactor/2,t.error[1]=this.calculateError(t.vertices[1],t.vertices[2])+t.borderFactor/2,t.error[2]=this.calculateError(t.vertices[2],t.vertices[0])+t.borderFactor/2,t.error[3]=Math.min(t.error[0],t.error[1],t.error[2]),this.references.push(ref)))}return newDeleted},QuadraticErrorSimplification.prototype.identifyBorder=function(){for(var i=0;i<this.vertices.length;++i){var j,vCount=[],vId=[],v=this.vertices[i];for(j=0;j<v.triangleCount;++j)for(var triangle=this.triangles[this.references[v.triangleStart+j].triangleId],ii=0;ii<3;ii++){for(var ofs=0,vv=triangle.vertices[ii];ofs<vCount.length&&vId[ofs]!==vv.id;)++ofs;ofs===vCount.length?(vCount.push(1),vId.push(vv.id)):vCount[ofs]++}for(j=0;j<vCount.length;++j)1===vCount[j]?this.vertices[vId[j]].isBorder=!0:this.vertices[vId[j]].isBorder=!1}},QuadraticErrorSimplification.prototype.updateMesh=function(identifyBorders){void 0===identifyBorders&&(identifyBorders=!1);var i;if(!identifyBorders){var newTrianglesVector=[];for(i=0;i<this.triangles.length;++i)this.triangles[i].deleted||newTrianglesVector.push(this.triangles[i]);this.triangles=newTrianglesVector}for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0,this.vertices[i].triangleStart=0;var t,j,v;for(i=0;i<this.triangles.length;++i)for(t=this.triangles[i],j=0;j<3;++j)(v=t.vertices[j]).triangleCount++;var tStart=0;for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleStart=tStart,tStart+=this.vertices[i].triangleCount,this.vertices[i].triangleCount=0;var newReferences=new Array(3*this.triangles.length);for(i=0;i<this.triangles.length;++i)for(t=this.triangles[i],j=0;j<3;++j)newReferences[(v=t.vertices[j]).triangleStart+v.triangleCount]=new Reference(j,i),v.triangleCount++;this.references=newReferences,identifyBorders&&this.identifyBorder()},QuadraticErrorSimplification.prototype.vertexError=function(q,point){var x=point.x,y=point.y,z=point.z;return q.data[0]*x*x+2*q.data[1]*x*y+2*q.data[2]*x*z+2*q.data[3]*x+q.data[4]*y*y+2*q.data[5]*y*z+2*q.data[6]*y+q.data[7]*z*z+2*q.data[8]*z+q.data[9]},QuadraticErrorSimplification.prototype.calculateError=function(vertex1,vertex2,pointResult,normalResult,uvResult,colorResult){var q=vertex1.q.add(vertex2.q),border=vertex1.isBorder&&vertex2.isBorder,error=0,qDet=q.det(0,1,2,1,4,5,2,5,7);if(0===qDet||border){var p3=vertex1.position.add(vertex2.position).divide(new BABYLON.Vector3(2,2,2)),error1=this.vertexError(q,vertex1.position),error2=this.vertexError(q,vertex2.position),error3=this.vertexError(q,p3);(error=Math.min(error1,error2,error3))===error1?pointResult&&pointResult.copyFrom(vertex1.position):error===error2?pointResult&&pointResult.copyFrom(vertex2.position):pointResult&&pointResult.copyFrom(p3)}else pointResult||(pointResult=BABYLON.Vector3.Zero()),pointResult.x=-1/qDet*q.det(1,2,3,4,5,6,5,7,8),pointResult.y=1/qDet*q.det(0,2,3,1,5,6,2,7,8),pointResult.z=-1/qDet*q.det(0,1,3,1,4,6,2,5,8),error=this.vertexError(q,pointResult);return error},QuadraticErrorSimplification}();BABYLON.QuadraticErrorSimplification=QuadraticErrorSimplification}(BABYLON||(BABYLON={}));!function(BABYLON){!function(Internals){var MeshLODLevel=function(){return function(distance,mesh){this.distance=distance,this.mesh=mesh}}();Internals.MeshLODLevel=MeshLODLevel}(BABYLON.Internals||(BABYLON.Internals={}))}(BABYLON||(BABYLON={}));!function(BABYLON){var SceneOptimization=function(){return function(priority){void 0===priority&&(priority=0),this.priority=priority,this.apply=function(scene){return!0}}}();BABYLON.SceneOptimization=SceneOptimization;var TextureOptimization=function(_super){function TextureOptimization(priority,maximumSize){void 0===priority&&(priority=0),void 0===maximumSize&&(maximumSize=1024);var _this=_super.call(this,priority)||this;return _this.priority=priority,_this.maximumSize=maximumSize,_this.apply=function(scene){for(var allDone=!0,index=0;index<scene.textures.length;index++){var texture=scene.textures[index];if(texture.canRescale&&!texture.getContext){var currentSize=texture.getSize();Math.max(currentSize.width,currentSize.height)>_this.maximumSize&&(texture.scale(.5),allDone=!1)}}return allDone},_this}return __extends(TextureOptimization,_super),TextureOptimization}(SceneOptimization);BABYLON.TextureOptimization=TextureOptimization;var HardwareScalingOptimization=function(_super){function HardwareScalingOptimization(priority,maximumScale){void 0===priority&&(priority=0),void 0===maximumScale&&(maximumScale=2);var _this=_super.call(this,priority)||this;return _this.priority=priority,_this.maximumScale=maximumScale,_this._currentScale=1,_this.apply=function(scene){return _this._currentScale++,scene.getEngine().setHardwareScalingLevel(_this._currentScale),_this._currentScale>=_this.maximumScale},_this}return __extends(HardwareScalingOptimization,_super),HardwareScalingOptimization}(SceneOptimization);BABYLON.HardwareScalingOptimization=HardwareScalingOptimization;var ShadowsOptimization=function(_super){function ShadowsOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.apply=function(scene){return scene.shadowsEnabled=!1,!0},_this}return __extends(ShadowsOptimization,_super),ShadowsOptimization}(SceneOptimization);BABYLON.ShadowsOptimization=ShadowsOptimization;var PostProcessesOptimization=function(_super){function PostProcessesOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.apply=function(scene){return scene.postProcessesEnabled=!1,!0},_this}return __extends(PostProcessesOptimization,_super),PostProcessesOptimization}(SceneOptimization);BABYLON.PostProcessesOptimization=PostProcessesOptimization;var LensFlaresOptimization=function(_super){function LensFlaresOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.apply=function(scene){return scene.lensFlaresEnabled=!1,!0},_this}return __extends(LensFlaresOptimization,_super),LensFlaresOptimization}(SceneOptimization);BABYLON.LensFlaresOptimization=LensFlaresOptimization;var ParticlesOptimization=function(_super){function ParticlesOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.apply=function(scene){return scene.particlesEnabled=!1,!0},_this}return __extends(ParticlesOptimization,_super),ParticlesOptimization}(SceneOptimization);BABYLON.ParticlesOptimization=ParticlesOptimization;var RenderTargetsOptimization=function(_super){function RenderTargetsOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.apply=function(scene){return scene.renderTargetsEnabled=!1,!0},_this}return __extends(RenderTargetsOptimization,_super),RenderTargetsOptimization}(SceneOptimization);BABYLON.RenderTargetsOptimization=RenderTargetsOptimization;var MergeMeshesOptimization=function(_super){function MergeMeshesOptimization(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this._canBeMerged=function(abstractMesh){if(!(abstractMesh instanceof BABYLON.Mesh))return!1;var mesh=abstractMesh;return!(!mesh.isVisible||!mesh.isEnabled())&&(!(mesh.instances.length>0)&&(!mesh.skeleton&&!mesh.hasLODLevels&&!mesh.parent))},_this.apply=function(scene,updateSelectionTree){for(var globalPool=scene.meshes.slice(0),globalLength=globalPool.length,index=0;index<globalLength;index++){var currentPool=new Array,current=globalPool[index];if(_this._canBeMerged(current)){currentPool.push(current);for(var subIndex=index+1;subIndex<globalLength;subIndex++){var otherMesh=globalPool[subIndex];_this._canBeMerged(otherMesh)&&(otherMesh.material===current.material&&otherMesh.checkCollisions===current.checkCollisions&&(currentPool.push(otherMesh),globalLength--,globalPool.splice(subIndex,1),subIndex--))}currentPool.length<2||BABYLON.Mesh.MergeMeshes(currentPool)}}return void 0!=updateSelectionTree?updateSelectionTree&&scene.createOrUpdateSelectionOctree():MergeMeshesOptimization.UpdateSelectionTree&&scene.createOrUpdateSelectionOctree(),!0},_this}return __extends(MergeMeshesOptimization,_super),Object.defineProperty(MergeMeshesOptimization,"UpdateSelectionTree",{get:function(){return MergeMeshesOptimization._UpdateSelectionTree},set:function(value){MergeMeshesOptimization._UpdateSelectionTree=value},enumerable:!0,configurable:!0}),MergeMeshesOptimization._UpdateSelectionTree=!1,MergeMeshesOptimization}(SceneOptimization);BABYLON.MergeMeshesOptimization=MergeMeshesOptimization;var SceneOptimizerOptions=function(){function SceneOptimizerOptions(targetFrameRate,trackerDuration){void 0===targetFrameRate&&(targetFrameRate=60),void 0===trackerDuration&&(trackerDuration=2e3),this.targetFrameRate=targetFrameRate,this.trackerDuration=trackerDuration,this.optimizations=new Array}return SceneOptimizerOptions.LowDegradationAllowed=function(targetFrameRate){var result=new SceneOptimizerOptions(targetFrameRate),priority=0;return result.optimizations.push(new MergeMeshesOptimization(priority)),result.optimizations.push(new ShadowsOptimization(priority)),result.optimizations.push(new LensFlaresOptimization(priority)),priority++,result.optimizations.push(new PostProcessesOptimization(priority)),result.optimizations.push(new ParticlesOptimization(priority)),priority++,result.optimizations.push(new TextureOptimization(priority,1024)),result},SceneOptimizerOptions.ModerateDegradationAllowed=function(targetFrameRate){var result=new SceneOptimizerOptions(targetFrameRate),priority=0;return result.optimizations.push(new MergeMeshesOptimization(priority)),result.optimizations.push(new ShadowsOptimization(priority)),result.optimizations.push(new LensFlaresOptimization(priority)),priority++,result.optimizations.push(new PostProcessesOptimization(priority)),result.optimizations.push(new ParticlesOptimization(priority)),priority++,result.optimizations.push(new TextureOptimization(priority,512)),priority++,result.optimizations.push(new RenderTargetsOptimization(priority)),priority++,result.optimizations.push(new HardwareScalingOptimization(priority,2)),result},SceneOptimizerOptions.HighDegradationAllowed=function(targetFrameRate){var result=new SceneOptimizerOptions(targetFrameRate),priority=0;return result.optimizations.push(new MergeMeshesOptimization(priority)),result.optimizations.push(new ShadowsOptimization(priority)),result.optimizations.push(new LensFlaresOptimization(priority)),priority++,result.optimizations.push(new PostProcessesOptimization(priority)),result.optimizations.push(new ParticlesOptimization(priority)),priority++,result.optimizations.push(new TextureOptimization(priority,256)),priority++,result.optimizations.push(new RenderTargetsOptimization(priority)),priority++,result.optimizations.push(new HardwareScalingOptimization(priority,4)),result},SceneOptimizerOptions}();BABYLON.SceneOptimizerOptions=SceneOptimizerOptions;var SceneOptimizer=function(){function SceneOptimizer(){}return SceneOptimizer._CheckCurrentState=function(scene,options,currentPriorityLevel,onSuccess,onFailure){if(scene.getEngine().getFps()>=options.targetFrameRate)onSuccess&&onSuccess();else{for(var allDone=!0,noOptimizationApplied=!0,index=0;index<options.optimizations.length;index++){var optimization=options.optimizations[index];optimization.priority===currentPriorityLevel&&(noOptimizationApplied=!1,allDone=allDone&&optimization.apply(scene))}noOptimizationApplied?onFailure&&onFailure():(allDone&&currentPriorityLevel++,scene.executeWhenReady(function(){setTimeout(function(){SceneOptimizer._CheckCurrentState(scene,options,currentPriorityLevel,onSuccess,onFailure)},options.trackerDuration)}))}},SceneOptimizer.OptimizeAsync=function(scene,options,onSuccess,onFailure){options||(options=SceneOptimizerOptions.ModerateDegradationAllowed()),scene.executeWhenReady(function(){setTimeout(function(){SceneOptimizer._CheckCurrentState(scene,options,0,onSuccess,onFailure)},options.trackerDuration)})},SceneOptimizer}();BABYLON.SceneOptimizer=SceneOptimizer}(BABYLON||(BABYLON={}));!function(BABYLON){var OutlineRenderer=function(){function OutlineRenderer(scene){this.zOffset=1,this._scene=scene}return OutlineRenderer.prototype.render=function(subMesh,batch,useOverlay){var _this=this;void 0===useOverlay&&(useOverlay=!1);var scene=this._scene,engine=this._scene.getEngine(),hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id]&&void 0!==batch.visibleInstances[subMesh._id];if(this.isReady(subMesh,hardwareInstancedRendering)){var mesh=subMesh.getRenderingMesh(),material=subMesh.getMaterial();if(material&&scene.activeCamera){if(engine.enableEffect(this._effect),material.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(scene.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",useOverlay?0:mesh.outlineWidth),this._effect.setColor4("color",useOverlay?mesh.overlayColor:mesh.outlineColor,useOverlay?mesh.overlayAlpha:material.alpha),this._effect.setMatrix("viewProjection",scene.getTransformMatrix()),mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton&&this._effect.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh)),mesh._bind(subMesh,this._effect,BABYLON.Material.TriangleFillMode),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(this._effect.setTexture("diffuseSampler",alphaTexture),this._effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix()))}engine.setZOffset(-this.zOffset),mesh._processRendering(subMesh,this._effect,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){_this._effect.setMatrix("world",world)}),engine.setZOffset(0)}}},OutlineRenderer.prototype.isReady=function(subMesh,useInstances){var defines=[],attribs=[BABYLON.VertexBuffer.PositionKind,BABYLON.VertexBuffer.NormalKind],mesh=subMesh.getMesh(),material=subMesh.getMaterial();material&&(material.needAlphaTesting()&&(defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2"))),material.useLogarithmicDepth&&defines.push("#define LOGARITHMICDEPTH")),mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._effect=this._scene.getEngine().createEffect("outline",attribs,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],join)),this._effect.isReady()},OutlineRenderer}();BABYLON.OutlineRenderer=OutlineRenderer}(BABYLON||(BABYLON={}));!function(BABYLON){var FaceAdjacencies=function(){return function(){this.edges=new Array,this.edgesConnectedCount=0}}(),EdgesRenderer=function(){function EdgesRenderer(source,epsilon,checkVerticesInsteadOfIndices){void 0===epsilon&&(epsilon=.95),void 0===checkVerticesInsteadOfIndices&&(checkVerticesInsteadOfIndices=!1),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this._source=source,this._checkVerticesInsteadOfIndices=checkVerticesInsteadOfIndices,this._epsilon=epsilon,this._prepareRessources(),this._generateEdgesLines()}return EdgesRenderer.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new BABYLON.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},EdgesRenderer.prototype._rebuild=function(){var buffer=this._buffers[BABYLON.VertexBuffer.PositionKind];buffer&&buffer._rebuild(),(buffer=this._buffers[BABYLON.VertexBuffer.NormalKind])&&buffer._rebuild();var engine=this._source.getScene().getEngine();this._ib=engine.createIndexBuffer(this._linesIndices)},EdgesRenderer.prototype.dispose=function(){var buffer=this._buffers[BABYLON.VertexBuffer.PositionKind];buffer&&(buffer.dispose(),this._buffers[BABYLON.VertexBuffer.PositionKind]=null),(buffer=this._buffers[BABYLON.VertexBuffer.NormalKind])&&(buffer.dispose(),this._buffers[BABYLON.VertexBuffer.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},EdgesRenderer.prototype._processEdgeForAdjacencies=function(pa,pb,p0,p1,p2){return pa===p0&&pb===p1||pa===p1&&pb===p0?0:pa===p1&&pb===p2||pa===p2&&pb===p1?1:pa===p2&&pb===p0||pa===p0&&pb===p2?2:-1},EdgesRenderer.prototype._processEdgeForAdjacenciesWithVertices=function(pa,pb,p0,p1,p2){return pa.equalsWithEpsilon(p0)&&pb.equalsWithEpsilon(p1)||pa.equalsWithEpsilon(p1)&&pb.equalsWithEpsilon(p0)?0:pa.equalsWithEpsilon(p1)&&pb.equalsWithEpsilon(p2)||pa.equalsWithEpsilon(p2)&&pb.equalsWithEpsilon(p1)?1:pa.equalsWithEpsilon(p2)&&pb.equalsWithEpsilon(p0)||pa.equalsWithEpsilon(p0)&&pb.equalsWithEpsilon(p2)?2:-1},EdgesRenderer.prototype._checkEdge=function(faceIndex,edge,faceNormals,p0,p1){if(void 0===edge||BABYLON.Vector3.Dot(faceNormals[faceIndex],faceNormals[edge])<this._epsilon){var offset=this._linesPositions.length/3;p0.subtract(p1).normalize(),this._linesPositions.push(p0.x),this._linesPositions.push(p0.y),this._linesPositions.push(p0.z),this._linesPositions.push(p0.x),this._linesPositions.push(p0.y),this._linesPositions.push(p0.z),this._linesPositions.push(p1.x),this._linesPositions.push(p1.y),this._linesPositions.push(p1.z),this._linesPositions.push(p1.x),this._linesPositions.push(p1.y),this._linesPositions.push(p1.z),this._linesNormals.push(p1.x),this._linesNormals.push(p1.y),this._linesNormals.push(p1.z),this._linesNormals.push(-1),this._linesNormals.push(p1.x),this._linesNormals.push(p1.y),this._linesNormals.push(p1.z),this._linesNormals.push(1),this._linesNormals.push(p0.x),this._linesNormals.push(p0.y),this._linesNormals.push(p0.z),this._linesNormals.push(-1),this._linesNormals.push(p0.x),this._linesNormals.push(p0.y),this._linesNormals.push(p0.z),this._linesNormals.push(1),this._linesIndices.push(offset),this._linesIndices.push(offset+1),this._linesIndices.push(offset+2),this._linesIndices.push(offset),this._linesIndices.push(offset+2),this._linesIndices.push(offset+3)}},EdgesRenderer.prototype._generateEdgesLines=function(){var positions=this._source.getVerticesData(BABYLON.VertexBuffer.PositionKind),indices=this._source.getIndices();if(indices&&positions){var index,faceAdjacencies,adjacencies=new Array,faceNormals=new Array;for(index=0;index<indices.length;index+=3){faceAdjacencies=new FaceAdjacencies;var p0Index=indices[index],p1Index=indices[index+1],p2Index=indices[index+2];faceAdjacencies.p0=new BABYLON.Vector3(positions[3*p0Index],positions[3*p0Index+1],positions[3*p0Index+2]),faceAdjacencies.p1=new BABYLON.Vector3(positions[3*p1Index],positions[3*p1Index+1],positions[3*p1Index+2]),faceAdjacencies.p2=new BABYLON.Vector3(positions[3*p2Index],positions[3*p2Index+1],positions[3*p2Index+2]);var faceNormal=BABYLON.Vector3.Cross(faceAdjacencies.p1.subtract(faceAdjacencies.p0),faceAdjacencies.p2.subtract(faceAdjacencies.p1));faceNormal.normalize(),faceNormals.push(faceNormal),adjacencies.push(faceAdjacencies)}for(index=0;index<adjacencies.length;index++){faceAdjacencies=adjacencies[index];for(var otherIndex=index+1;otherIndex<adjacencies.length;otherIndex++){var otherFaceAdjacencies=adjacencies[otherIndex];if(3===faceAdjacencies.edgesConnectedCount)break;if(3!==otherFaceAdjacencies.edgesConnectedCount)for(var otherP0=indices[3*otherIndex],otherP1=indices[3*otherIndex+1],otherP2=indices[3*otherIndex+2],edgeIndex=0;edgeIndex<3;edgeIndex++){var otherEdgeIndex=0;if(void 0===faceAdjacencies.edges[edgeIndex]){switch(edgeIndex){case 0:otherEdgeIndex=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(faceAdjacencies.p0,faceAdjacencies.p1,otherFaceAdjacencies.p0,otherFaceAdjacencies.p1,otherFaceAdjacencies.p2):this._processEdgeForAdjacencies(indices[3*index],indices[3*index+1],otherP0,otherP1,otherP2);break;case 1:otherEdgeIndex=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(faceAdjacencies.p1,faceAdjacencies.p2,otherFaceAdjacencies.p0,otherFaceAdjacencies.p1,otherFaceAdjacencies.p2):this._processEdgeForAdjacencies(indices[3*index+1],indices[3*index+2],otherP0,otherP1,otherP2);break;case 2:otherEdgeIndex=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(faceAdjacencies.p2,faceAdjacencies.p0,otherFaceAdjacencies.p0,otherFaceAdjacencies.p1,otherFaceAdjacencies.p2):this._processEdgeForAdjacencies(indices[3*index+2],indices[3*index],otherP0,otherP1,otherP2)}if(-1!==otherEdgeIndex&&(faceAdjacencies.edges[edgeIndex]=otherIndex,otherFaceAdjacencies.edges[otherEdgeIndex]=index,faceAdjacencies.edgesConnectedCount++,otherFaceAdjacencies.edgesConnectedCount++,3===faceAdjacencies.edgesConnectedCount))break}}}}for(index=0;index<adjacencies.length;index++){var current=adjacencies[index];this._checkEdge(index,current.edges[0],faceNormals,current.p0,current.p1),this._checkEdge(index,current.edges[1],faceNormals,current.p1,current.p2),this._checkEdge(index,current.edges[2],faceNormals,current.p2,current.p0)}var engine=this._source.getScene().getEngine();this._buffers[BABYLON.VertexBuffer.PositionKind]=new BABYLON.VertexBuffer(engine,this._linesPositions,BABYLON.VertexBuffer.PositionKind,!1),this._buffers[BABYLON.VertexBuffer.NormalKind]=new BABYLON.VertexBuffer(engine,this._linesNormals,BABYLON.VertexBuffer.NormalKind,!1,!1,4),this._ib=engine.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},EdgesRenderer.prototype.render=function(){var scene=this._source.getScene();if(this._lineShader.isReady()&&scene.activeCamera){var engine=scene.getEngine();this._lineShader._preBind(),engine.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),scene.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),scene.activeCamera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",engine.getAspectRatio(scene.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),engine.draw(!0,0,this._indicesCount),this._lineShader.unbind(),engine.setDepthWrite(!0)}},EdgesRenderer}();BABYLON.EdgesRenderer=EdgesRenderer}(BABYLON||(BABYLON={}));!function(BABYLON){var GlowBlurPostProcess=function(_super){function GlowBlurPostProcess(name,direction,kernel,options,camera,samplingMode,engine,reusable){void 0===samplingMode&&(samplingMode=BABYLON.Texture.BILINEAR_SAMPLINGMODE);var _this=_super.call(this,name,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,options,camera,samplingMode,engine,reusable)||this;return _this.direction=direction,_this.kernel=kernel,_this.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",_this.width,_this.height),effect.setVector2("direction",_this.direction),effect.setFloat("blurWidth",_this.kernel)}),_this}return __extends(GlowBlurPostProcess,_super),GlowBlurPostProcess}(BABYLON.PostProcess),HighlightLayer=function(){function HighlightLayer(name,scene,options){this.name=name,this._vertexBuffers={},this._mainTextureDesiredSize={width:0,height:0},this._meshes={},this._maxSize=0,this._shouldRender=!1,this._instanceGlowingMeshStencilReference=HighlightLayer.glowingMeshStencilReference++,this._excludedMeshes={},this.innerGlow=!0,this.outerGlow=!0,this.isEnabled=!0,this.onDisposeObservable=new BABYLON.Observable,this.onBeforeRenderMainTextureObservable=new BABYLON.Observable,this.onBeforeBlurObservable=new BABYLON.Observable,this.onAfterBlurObservable=new BABYLON.Observable,this.onBeforeComposeObservable=new BABYLON.Observable,this.onAfterComposeObservable=new BABYLON.Observable,this.onSizeChangedObservable=new BABYLON.Observable,this._scene=scene||BABYLON.Engine.LastCreatedScene;var engine=scene.getEngine();this._engine=engine,this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.highlightLayers.push(this),this._engine.isStencilEnable||BABYLON.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"),this._options=options||{mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:BABYLON.Engine.ALPHA_COMBINE,camera:null},this._options.mainTextureRatio=this._options.mainTextureRatio||.5,this._options.blurTextureSizeRatio=this._options.blurTextureSizeRatio||1,this._options.blurHorizontalSize=this._options.blurHorizontalSize||1,this._options.blurVerticalSize=this._options.blurVerticalSize||1,this._options.alphaBlendingMode=this._options.alphaBlendingMode||BABYLON.Engine.ALPHA_COMBINE;var vertices=[];vertices.push(1,1),vertices.push(-1,1),vertices.push(-1,-1),vertices.push(1,-1);var vertexBuffer=new BABYLON.VertexBuffer(engine,vertices,BABYLON.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=vertexBuffer,this._createIndexBuffer(),this._glowMapMergeEffect=engine.createEffect("glowMapMerge",[BABYLON.VertexBuffer.PositionKind],["offset"],["textureSampler"],""),this.setMainTextureSize(),this.createTextureAndPostProcesses()}return Object.defineProperty(HighlightLayer.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(value){this._horizontalBlurPostprocess.kernel=value},enumerable:!0,configurable:!0}),Object.defineProperty(HighlightLayer.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(value){this._verticalBlurPostprocess.kernel=value},enumerable:!0,configurable:!0}),Object.defineProperty(HighlightLayer.prototype,"camera",{get:function(){return this._options.camera},enumerable:!0,configurable:!0}),HighlightLayer.prototype._createIndexBuffer=function(){var engine=this._scene.getEngine(),indices=[];indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),this._indexBuffer=engine.createIndexBuffer(indices)},HighlightLayer.prototype._rebuild=function(){var vb=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vb&&vb._rebuild(),this._createIndexBuffer()},HighlightLayer.prototype.createTextureAndPostProcesses=function(){var _this=this,blurTextureWidth=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,blurTextureHeight=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;blurTextureWidth=this._engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(blurTextureWidth,this._maxSize):blurTextureWidth,blurTextureHeight=this._engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(blurTextureHeight,this._maxSize):blurTextureHeight,this._mainTexture=new BABYLON.RenderTargetTexture("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._options.camera,this._mainTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(BABYLON.Texture.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._blurTexture=new BABYLON.RenderTargetTexture("HighlightLayerBlurRTT",{width:blurTextureWidth,height:blurTextureHeight},this._scene,!1,!0,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurTexture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(BABYLON.Texture.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._downSamplePostprocess=new BABYLON.PassPostProcess("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(effect){effect.setTexture("textureSampler",_this._mainTexture)}),this._options.alphaBlendingMode===BABYLON.Engine.ALPHA_COMBINE?(this._horizontalBlurPostprocess=new GlowBlurPostProcess("HighlightLayerHBP",new BABYLON.Vector2(1,0),this._options.blurHorizontalSize,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",blurTextureWidth,blurTextureHeight)}),this._verticalBlurPostprocess=new GlowBlurPostProcess("HighlightLayerVBP",new BABYLON.Vector2(0,1),this._options.blurVerticalSize,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",blurTextureWidth,blurTextureHeight)})):(this._horizontalBlurPostprocess=new BABYLON.BlurPostProcess("HighlightLayerHBP",new BABYLON.Vector2(1,0),this._options.blurHorizontalSize,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",blurTextureWidth,blurTextureHeight)}),this._verticalBlurPostprocess=new BABYLON.BlurPostProcess("HighlightLayerVBP",new BABYLON.Vector2(0,1),this._options.blurVerticalSize,1,null,BABYLON.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",blurTextureWidth,blurTextureHeight)})),this._mainTexture.onAfterUnbindObservable.add(function(){_this.onBeforeBlurObservable.notifyObservers(_this);var internalTexture=_this._blurTexture.getInternalTexture();internalTexture&&_this._scene.postProcessManager.directRender([_this._downSamplePostprocess,_this._horizontalBlurPostprocess,_this._verticalBlurPostprocess],internalTexture,!0),_this.onAfterBlurObservable.notifyObservers(_this)});var renderSubMesh=function(subMesh){if(_this._meshes){var material=subMesh.getMaterial(),mesh=subMesh.getRenderingMesh(),scene=_this._scene,engine=scene.getEngine();if(material&&!material.needAlphaBlendingForMesh(mesh)){engine.setState(material.backFaceCulling);var batch=mesh._getInstancesRenderList(subMesh._id);if(!(batch.mustReturn||_this._excludedMeshes&&_this._excludedMeshes[mesh.uniqueId])){var hardwareInstancedRendering=engine.getCaps().instancedArrays&&null!==batch.visibleInstances[subMesh._id]&&void 0!==batch.visibleInstances[subMesh._id],highlightLayerMesh=_this._meshes[mesh.uniqueId],emissiveTexture=null;if(highlightLayerMesh&&highlightLayerMesh.glowEmissiveOnly&&material&&(emissiveTexture=material.emissiveTexture),_this.isReady(subMesh,hardwareInstancedRendering,emissiveTexture)){if(engine.enableEffect(_this._glowMapGenerationEffect),mesh._bind(subMesh,_this._glowMapGenerationEffect,BABYLON.Material.TriangleFillMode),_this._glowMapGenerationEffect.setMatrix("viewProjection",scene.getTransformMatrix()),highlightLayerMesh?_this._glowMapGenerationEffect.setFloat4("color",highlightLayerMesh.color.r,highlightLayerMesh.color.g,highlightLayerMesh.color.b,1):_this._glowMapGenerationEffect.setFloat4("color",HighlightLayer.neutralColor.r,HighlightLayer.neutralColor.g,HighlightLayer.neutralColor.b,HighlightLayer.neutralColor.a),material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();if(alphaTexture){_this._glowMapGenerationEffect.setTexture("diffuseSampler",alphaTexture);var textureMatrix=alphaTexture.getTextureMatrix();textureMatrix&&_this._glowMapGenerationEffect.setMatrix("diffuseMatrix",textureMatrix)}}emissiveTexture&&(_this._glowMapGenerationEffect.setTexture("emissiveSampler",emissiveTexture),_this._glowMapGenerationEffect.setMatrix("emissiveMatrix",emissiveTexture.getTextureMatrix())),mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton&&_this._glowMapGenerationEffect.setMatrices("mBones",mesh.skeleton.getTransformMatrices(mesh)),mesh._processRendering(subMesh,_this._glowMapGenerationEffect,BABYLON.Material.TriangleFillMode,batch,hardwareInstancedRendering,function(isInstance,world){return _this._glowMapGenerationEffect.setMatrix("world",world)})}else _this._mainTexture.resetRefreshCounter()}}}};this._mainTexture.customRenderFunction=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){_this.onBeforeRenderMainTextureObservable.notifyObservers(_this);var index,engine=_this._scene.getEngine();if(depthOnlySubMeshes.length){for(engine.setColorWrite(!1),index=0;index<depthOnlySubMeshes.length;index++)renderSubMesh(depthOnlySubMeshes.data[index]);engine.setColorWrite(!0)}for(index=0;index<opaqueSubMeshes.length;index++)renderSubMesh(opaqueSubMeshes.data[index]);for(index=0;index<alphaTestSubMeshes.length;index++)renderSubMesh(alphaTestSubMeshes.data[index]);for(index=0;index<transparentSubMeshes.length;index++)renderSubMesh(transparentSubMeshes.data[index])},this._mainTexture.onClearObservable.add(function(engine){engine.clear(HighlightLayer.neutralColor,!0,!0,!0)})},HighlightLayer.prototype.isReady=function(subMesh,useInstances,emissiveTexture){var material=subMesh.getMaterial();if(!material)return!1;if(!material.isReady(subMesh.getMesh(),useInstances))return!1;var defines=[],attribs=[BABYLON.VertexBuffer.PositionKind],mesh=subMesh.getMesh(),uv1=!1,uv2=!1;if(material&&material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();alphaTexture&&(defines.push("#define ALPHATEST"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&1===alphaTexture.coordinatesIndex?(defines.push("#define DIFFUSEUV2"),uv2=!0):mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(defines.push("#define DIFFUSEUV1"),uv1=!0))}emissiveTexture&&(defines.push("#define EMISSIVE"),mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UV2Kind)&&1===emissiveTexture.coordinatesIndex?(defines.push("#define EMISSIVEUV2"),uv2=!0):mesh.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind)&&(defines.push("#define EMISSIVEUV1"),uv1=!0)),uv1&&(attribs.push(BABYLON.VertexBuffer.UVKind),defines.push("#define UV1")),uv2&&(attribs.push(BABYLON.VertexBuffer.UV2Kind),defines.push("#define UV2")),mesh.useBones&&mesh.computeBonesUsingShaders?(attribs.push(BABYLON.VertexBuffer.MatricesIndicesKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsKind),mesh.numBoneInfluencers>4&&(attribs.push(BABYLON.VertexBuffer.MatricesIndicesExtraKind),attribs.push(BABYLON.VertexBuffer.MatricesWeightsExtraKind)),defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers),defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0))):defines.push("#define NUM_BONE_INFLUENCERS 0"),useInstances&&(defines.push("#define INSTANCES"),attribs.push("world0"),attribs.push("world1"),attribs.push("world2"),attribs.push("world3"));var join=defines.join("\n");return this._cachedDefines!==join&&(this._cachedDefines=join,this._glowMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",attribs,["world","mBones","viewProjection","diffuseMatrix","color","emissiveMatrix"],["diffuseSampler","emissiveSampler"],join)),this._glowMapGenerationEffect.isReady()},HighlightLayer.prototype.render=function(){var currentEffect=this._glowMapMergeEffect;if(currentEffect.isReady()&&this._blurTexture.isReady()){var engine=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),engine.enableEffect(currentEffect),engine.setState(!1);var previousStencilBuffer=engine.getStencilBuffer(),previousStencilFunction=engine.getStencilFunction(),previousStencilMask=engine.getStencilMask(),previousStencilOperationPass=engine.getStencilOperationPass(),previousStencilOperationFail=engine.getStencilOperationFail(),previousStencilOperationDepthFail=engine.getStencilOperationDepthFail(),previousAlphaMode=engine.getAlphaMode();currentEffect.setTexture("textureSampler",this._blurTexture),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,currentEffect),engine.setStencilOperationPass(BABYLON.Engine.REPLACE),engine.setStencilOperationFail(BABYLON.Engine.KEEP),engine.setStencilOperationDepthFail(BABYLON.Engine.KEEP),engine.setAlphaMode(this._options.alphaBlendingMode),engine.setStencilMask(0),engine.setStencilBuffer(!0),engine.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(currentEffect.setFloat("offset",0),engine.setStencilFunction(BABYLON.Engine.NOTEQUAL),engine.draw(!0,0,6)),this.innerGlow&&(currentEffect.setFloat("offset",1),engine.setStencilFunction(BABYLON.Engine.EQUAL),engine.draw(!0,0,6)),engine.setStencilFunction(previousStencilFunction),engine.setStencilMask(previousStencilMask),engine.setAlphaMode(previousAlphaMode),engine.setStencilBuffer(previousStencilBuffer),engine.setStencilOperationPass(previousStencilOperationPass),engine.setStencilOperationFail(previousStencilOperationFail),engine.setStencilOperationDepthFail(previousStencilOperationDepthFail),engine._stencilState.reset(),this.onAfterComposeObservable.notifyObservers(this);var size=this._mainTexture.getSize();this.setMainTextureSize(),size.width===this._mainTextureDesiredSize.width&&size.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this.disposeTextureAndPostProcesses(),this.createTextureAndPostProcesses())}},HighlightLayer.prototype.addExcludedMesh=function(mesh){this._excludedMeshes&&(this._excludedMeshes[mesh.uniqueId]||(this._excludedMeshes[mesh.uniqueId]={mesh:mesh,beforeRender:mesh.onBeforeRenderObservable.add(function(mesh){mesh.getEngine().setStencilBuffer(!1)}),afterRender:mesh.onAfterRenderObservable.add(function(mesh){mesh.getEngine().setStencilBuffer(!0)})}))},HighlightLayer.prototype.removeExcludedMesh=function(mesh){if(this._excludedMeshes){var meshExcluded=this._excludedMeshes[mesh.uniqueId];meshExcluded&&(meshExcluded.beforeRender&&mesh.onBeforeRenderObservable.remove(meshExcluded.beforeRender),meshExcluded.afterRender&&mesh.onAfterRenderObservable.remove(meshExcluded.afterRender)),this._excludedMeshes[mesh.uniqueId]=null}},HighlightLayer.prototype.addMesh=function(mesh,color,glowEmissiveOnly){var _this=this;if(void 0===glowEmissiveOnly&&(glowEmissiveOnly=!1),this._meshes){var meshHighlight=this._meshes[mesh.uniqueId];meshHighlight?meshHighlight.color=color:this._meshes[mesh.uniqueId]={mesh:mesh,color:color,observerHighlight:mesh.onBeforeRenderObservable.add(function(mesh){_this._excludedMeshes&&_this._excludedMeshes[mesh.uniqueId]?_this.defaultStencilReference(mesh):mesh.getScene().getEngine().setStencilFunctionReference(_this._instanceGlowingMeshStencilReference)}),observerDefault:mesh.onAfterRenderObservable.add(this.defaultStencilReference),glowEmissiveOnly:glowEmissiveOnly},this._shouldRender=!0}},HighlightLayer.prototype.removeMesh=function(mesh){if(this._meshes){var meshHighlight=this._meshes[mesh.uniqueId];meshHighlight&&(meshHighlight.observerHighlight&&mesh.onBeforeRenderObservable.remove(meshHighlight.observerHighlight),meshHighlight.observerDefault&&mesh.onAfterRenderObservable.remove(meshHighlight.observerDefault)),this._meshes[mesh.uniqueId]=null,this._shouldRender=!1;for(var meshHighlightToCheck in this._meshes)if(this._meshes[meshHighlightToCheck]){this._shouldRender=!0;break}}},HighlightLayer.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},HighlightLayer.prototype.setMainTextureSize=function(){this._options.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._options.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._options.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._options.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._options.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?BABYLON.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height)},HighlightLayer.prototype.defaultStencilReference=function(mesh){mesh.getScene().getEngine().setStencilFunctionReference(HighlightLayer.normalMeshStencilReference)},HighlightLayer.prototype.disposeTextureAndPostProcesses=function(){this._blurTexture.dispose(),this._mainTexture.dispose(),this._downSamplePostprocess.dispose(),this._horizontalBlurPostprocess.dispose(),this._verticalBlurPostprocess.dispose()},HighlightLayer.prototype.dispose=function(){var vertexBuffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];if(vertexBuffer&&(vertexBuffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.disposeTextureAndPostProcesses(),this._meshes){for(var id in this._meshes)(meshHighlight=this._meshes[id])&&meshHighlight.mesh&&(meshHighlight.observerHighlight&&meshHighlight.mesh.onBeforeRenderObservable.remove(meshHighlight.observerHighlight),meshHighlight.observerDefault&&meshHighlight.mesh.onAfterRenderObservable.remove(meshHighlight.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var id in this._excludedMeshes){var meshHighlight=this._excludedMeshes[id];meshHighlight&&(meshHighlight.beforeRender&&meshHighlight.mesh.onBeforeRenderObservable.remove(meshHighlight.beforeRender),meshHighlight.afterRender&&meshHighlight.mesh.onAfterRenderObservable.remove(meshHighlight.afterRender))}this._excludedMeshes=null}var index=this._scene.highlightLayers.indexOf(this,0);index>-1&&this._scene.highlightLayers.splice(index,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeBlurObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},HighlightLayer.neutralColor=new BABYLON.Color4(0,0,0,0),HighlightLayer.glowingMeshStencilReference=2,HighlightLayer.normalMeshStencilReference=1,HighlightLayer}();BABYLON.HighlightLayer=HighlightLayer}(BABYLON||(BABYLON={}));!function(BABYLON){var AssetTaskState;!function(AssetTaskState){AssetTaskState[AssetTaskState.INIT=0]="INIT",AssetTaskState[AssetTaskState.RUNNING=1]="RUNNING",AssetTaskState[AssetTaskState.DONE=2]="DONE",AssetTaskState[AssetTaskState.ERROR=3]="ERROR"}(AssetTaskState=BABYLON.AssetTaskState||(BABYLON.AssetTaskState={}));var AbstractAssetTask=function(){function AbstractAssetTask(name){this.name=name,this.isCompleted=!1,this.taskState=AssetTaskState.INIT}return AbstractAssetTask.prototype.run=function(scene,onSuccess,onError){var _this=this;this.taskState=AssetTaskState.RUNNING,this.runTask(scene,function(){_this.onDoneCallback(onSuccess,onError)},function(msg,exception){_this.onErrorCallback(onError,msg,exception)})},AbstractAssetTask.prototype.runTask=function(scene,onSuccess,onError){throw new Error("runTask is not implemented")},AbstractAssetTask.prototype.onErrorCallback=function(onError,message,exception){this.taskState=AssetTaskState.ERROR,this.errorObject={message:message,exception:exception},this.onError&&this.onError(this,message,exception),onError()},AbstractAssetTask.prototype.onDoneCallback=function(onSuccess,onError){try{this.taskState=AssetTaskState.DONE,this.isCompleted=!0,this.onSuccess&&this.onSuccess(this),onSuccess()}catch(e){this.onErrorCallback(onError,"Task is done, error executing success callback(s)",e)}},AbstractAssetTask}();BABYLON.AbstractAssetTask=AbstractAssetTask;var AssetsProgressEvent=function(){return function(remainingCount,totalCount,task){this.remainingCount=remainingCount,this.totalCount=totalCount,this.task=task}}();BABYLON.AssetsProgressEvent=AssetsProgressEvent;var MeshAssetTask=function(_super){function MeshAssetTask(name,meshesNames,rootUrl,sceneFilename){var _this=_super.call(this,name)||this;return _this.name=name,_this.meshesNames=meshesNames,_this.rootUrl=rootUrl,_this.sceneFilename=sceneFilename,_this}return __extends(MeshAssetTask,_super),MeshAssetTask.prototype.runTask=function(scene,onSuccess,onError){var _this=this;BABYLON.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,scene,function(meshes,particleSystems,skeletons){_this.loadedMeshes=meshes,_this.loadedParticleSystems=particleSystems,_this.loadedSkeletons=skeletons,onSuccess()},null,function(scene,message,exception){onError(message,exception)})},MeshAssetTask}(AbstractAssetTask);BABYLON.MeshAssetTask=MeshAssetTask;var TextFileAssetTask=function(_super){function TextFileAssetTask(name,url){var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this}return __extends(TextFileAssetTask,_super),TextFileAssetTask.prototype.runTask=function(scene,onSuccess,onError){var _this=this;BABYLON.Tools.LoadFile(this.url,function(data){_this.text=data,onSuccess()},void 0,scene.database,!1,function(request,exception){request&&onError(request.status+" "+request.statusText,exception)})},TextFileAssetTask}(AbstractAssetTask);BABYLON.TextFileAssetTask=TextFileAssetTask;var BinaryFileAssetTask=function(_super){function BinaryFileAssetTask(name,url){var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this}return __extends(BinaryFileAssetTask,_super),BinaryFileAssetTask.prototype.runTask=function(scene,onSuccess,onError){var _this=this;BABYLON.Tools.LoadFile(this.url,function(data){_this.data=data,onSuccess()},void 0,scene.database,!0,function(request,exception){request&&onError(request.status+" "+request.statusText,exception)})},BinaryFileAssetTask}(AbstractAssetTask);BABYLON.BinaryFileAssetTask=BinaryFileAssetTask;var ImageAssetTask=function(_super){function ImageAssetTask(name,url){var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this}return __extends(ImageAssetTask,_super),ImageAssetTask.prototype.runTask=function(scene,onSuccess,onError){var _this=this,img=new Image;BABYLON.Tools.SetCorsBehavior(this.url,img),img.onload=function(){_this.image=img,onSuccess()},img.onerror=function(err){onError("Error loading image",err)},img.src=this.url},ImageAssetTask}(AbstractAssetTask);BABYLON.ImageAssetTask=ImageAssetTask;var TextureAssetTask=function(_super){function TextureAssetTask(name,url,noMipmap,invertY,samplingMode){void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this.noMipmap=noMipmap,_this.invertY=invertY,_this.samplingMode=samplingMode,_this}return __extends(TextureAssetTask,_super),TextureAssetTask.prototype.runTask=function(scene,onSuccess,onError){this.texture=new BABYLON.Texture(this.url,scene,this.noMipmap,this.invertY,this.samplingMode,function(){onSuccess()},function(message,exception){onError(message,exception)})},TextureAssetTask}(AbstractAssetTask);BABYLON.TextureAssetTask=TextureAssetTask;var CubeTextureAssetTask=function(_super){function CubeTextureAssetTask(name,url,extensions,noMipmap,files){var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this.extensions=extensions,_this.noMipmap=noMipmap,_this.files=files,_this}return __extends(CubeTextureAssetTask,_super),CubeTextureAssetTask.prototype.runTask=function(scene,onSuccess,onError){this.texture=new BABYLON.CubeTexture(this.url,scene,this.extensions,this.noMipmap,this.files,function(){onSuccess()},function(message,exception){onError(message,exception)})},CubeTextureAssetTask}(AbstractAssetTask);BABYLON.CubeTextureAssetTask=CubeTextureAssetTask;var HDRCubeTextureAssetTask=function(_super){function HDRCubeTextureAssetTask(name,url,size,noMipmap,generateHarmonics,useInGammaSpace,usePMREMGenerator){void 0===noMipmap&&(noMipmap=!1),void 0===generateHarmonics&&(generateHarmonics=!0),void 0===useInGammaSpace&&(useInGammaSpace=!1),void 0===usePMREMGenerator&&(usePMREMGenerator=!1);var _this=_super.call(this,name)||this;return _this.name=name,_this.url=url,_this.size=size,_this.noMipmap=noMipmap,_this.generateHarmonics=generateHarmonics,_this.useInGammaSpace=useInGammaSpace,_this.usePMREMGenerator=usePMREMGenerator,_this}return __extends(HDRCubeTextureAssetTask,_super),HDRCubeTextureAssetTask.prototype.run=function(scene,onSuccess,onError){this.texture=new BABYLON.HDRCubeTexture(this.url,scene,this.size,this.noMipmap,this.generateHarmonics,this.useInGammaSpace,this.usePMREMGenerator,function(){onSuccess()},function(message,exception){onError(message,exception)})},HDRCubeTextureAssetTask}(AbstractAssetTask);BABYLON.HDRCubeTextureAssetTask=HDRCubeTextureAssetTask;var AssetsManager=function(){function AssetsManager(scene){this.tasks=new Array,this.waitingTasksCount=0,this.onTaskSuccessObservable=new BABYLON.Observable,this.onTaskErrorObservable=new BABYLON.Observable,this.onTasksDoneObservable=new BABYLON.Observable,this.onProgressObservable=new BABYLON.Observable,this.useDefaultLoadingScreen=!0,this._scene=scene}return AssetsManager.prototype.addMeshTask=function(taskName,meshesNames,rootUrl,sceneFilename){var task=new MeshAssetTask(taskName,meshesNames,rootUrl,sceneFilename);return this.tasks.push(task),task},AssetsManager.prototype.addTextFileTask=function(taskName,url){var task=new TextFileAssetTask(taskName,url);return this.tasks.push(task),task},AssetsManager.prototype.addBinaryFileTask=function(taskName,url){var task=new BinaryFileAssetTask(taskName,url);return this.tasks.push(task),task},AssetsManager.prototype.addImageTask=function(taskName,url){var task=new ImageAssetTask(taskName,url);return this.tasks.push(task),task},AssetsManager.prototype.addTextureTask=function(taskName,url,noMipmap,invertY,samplingMode){void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);var task=new TextureAssetTask(taskName,url,noMipmap,invertY,samplingMode);return this.tasks.push(task),task},AssetsManager.prototype.addCubeTextureTask=function(name,url,extensions,noMipmap,files){var task=new CubeTextureAssetTask(name,url,extensions,noMipmap,files);return this.tasks.push(task),task},AssetsManager.prototype.addHDRCubeTextureTask=function(name,url,size,noMipmap,generateHarmonics,useInGammaSpace,usePMREMGenerator){void 0===noMipmap&&(noMipmap=!1),void 0===generateHarmonics&&(generateHarmonics=!0),void 0===useInGammaSpace&&(useInGammaSpace=!1),void 0===usePMREMGenerator&&(usePMREMGenerator=!1);var task=new HDRCubeTextureAssetTask(name,url,size,noMipmap,generateHarmonics,useInGammaSpace,usePMREMGenerator);return this.tasks.push(task),task},AssetsManager.prototype._decreaseWaitingTasksCount=function(task){this.waitingTasksCount--;try{this.onProgress&&this.onProgress(this.waitingTasksCount,this.tasks.length,task),this.onProgressObservable.notifyObservers(new AssetsProgressEvent(this.waitingTasksCount,this.tasks.length,task))}catch(e){BABYLON.Tools.Error("Error running progress callbacks."),console.log(e)}if(0===this.waitingTasksCount){try{this.onFinish&&this.onFinish(this.tasks),this.onTasksDoneObservable.notifyObservers(this.tasks)}catch(e){BABYLON.Tools.Error("Error running tasks-done callbacks."),console.log(e)}this._scene.getEngine().hideLoadingUI()}},AssetsManager.prototype._runTask=function(task){var _this=this,error=function(message,exception){task.errorObject=task.errorObject||{message:message,exception:exception},_this.onTaskError&&_this.onTaskError(task),_this.onTaskErrorObservable.notifyObservers(task),_this._decreaseWaitingTasksCount(task)};task.run(this._scene,function(){try{_this.onTaskSuccess&&_this.onTaskSuccess(task),_this.onTaskSuccessObservable.notifyObservers(task),_this._decreaseWaitingTasksCount(task)}catch(e){error("Error executing task success callbacks",e)}},error)},AssetsManager.prototype.reset=function(){return this.tasks=new Array,this},AssetsManager.prototype.load=function(){if(this.waitingTasksCount=this.tasks.length,0===this.waitingTasksCount)return this.onFinish&&this.onFinish(this.tasks),this.onTasksDoneObservable.notifyObservers(this.tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var index=0;index<this.tasks.length;index++){var task=this.tasks[index];this._runTask(task)}return this},AssetsManager}();BABYLON.AssetsManager=AssetsManager}(BABYLON||(BABYLON={}));!function(BABYLON){var serializedGeometries=[],serializeGeometry=function(geometry,serializationGeometries){if(!serializedGeometries[geometry.id]&&!geometry.doNotSerialize){if(geometry instanceof BABYLON.Geometry.Primitives.Box)serializationGeometries.boxes.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.Sphere)serializationGeometries.spheres.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.Cylinder)serializationGeometries.cylinders.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.Torus)serializationGeometries.toruses.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.Ground)serializationGeometries.grounds.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.Plane)serializationGeometries.planes.push(geometry.serialize());else if(geometry instanceof BABYLON.Geometry.Primitives.TorusKnot)serializationGeometries.torusKnots.push(geometry.serialize());else{if(geometry instanceof BABYLON.Geometry.Primitives._Primitive)throw new Error("Unknown primitive type");serializationGeometries.vertexData.push(geometry.serializeVerticeData())}serializedGeometries[geometry.id]=!0}},serializeMesh=function(mesh,serializationScene){var serializationObject={},geometry=mesh._geometry;return geometry&&(mesh.getScene().getGeometryByID(geometry.id)||serializeGeometry(geometry,serializationScene.geometries)),mesh.serialize&&mesh.serialize(serializationObject),serializationObject},finalizeSingleMesh=function(mesh,serializationObject){if(mesh.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_LOADED||mesh.delayLoadState===BABYLON.Engine.DELAYLOADSTATE_NONE){mesh.material&&(mesh.material instanceof BABYLON.StandardMaterial?(serializationObject.materials=serializationObject.materials||[],serializationObject.materials.some(function(mat){return mat.id===mesh.material.id})||serializationObject.materials.push(mesh.material.serialize())):mesh.material instanceof BABYLON.MultiMaterial&&(serializationObject.multiMaterials=serializationObject.multiMaterials||[],serializationObject.multiMaterials.some(function(mat){return mat.id===mesh.material.id})||serializationObject.multiMaterials.push(mesh.material.serialize())));var geometry=mesh._geometry;geometry&&(serializationObject.geometries||(serializationObject.geometries={},serializationObject.geometries.boxes=[],serializationObject.geometries.spheres=[],serializationObject.geometries.cylinders=[],serializationObject.geometries.toruses=[],serializationObject.geometries.grounds=[],serializationObject.geometries.planes=[],serializationObject.geometries.torusKnots=[],serializationObject.geometries.vertexData=[]),serializeGeometry(geometry,serializationObject.geometries)),mesh.skeleton&&(serializationObject.skeletons=serializationObject.skeletons||[],serializationObject.skeletons.push(mesh.skeleton.serialize())),serializationObject.meshes=serializationObject.meshes||[],serializationObject.meshes.push(serializeMesh(mesh,serializationObject))}},SceneSerializer=function(){function SceneSerializer(){}return SceneSerializer.ClearCache=function(){serializedGeometries=[]},SceneSerializer.Serialize=function(scene){var serializationObject={};if(SceneSerializer.ClearCache(),serializationObject.useDelayedTextureLoading=scene.useDelayedTextureLoading,serializationObject.autoClear=scene.autoClear,serializationObject.clearColor=scene.clearColor.asArray(),serializationObject.ambientColor=scene.ambientColor.asArray(),serializationObject.gravity=scene.gravity.asArray(),serializationObject.collisionsEnabled=scene.collisionsEnabled,serializationObject.workerCollisions=scene.workerCollisions,scene.fogMode&&0!==scene.fogMode&&(serializationObject.fogMode=scene.fogMode,serializationObject.fogColor=scene.fogColor.asArray(),serializationObject.fogStart=scene.fogStart,serializationObject.fogEnd=scene.fogEnd,serializationObject.fogDensity=scene.fogDensity),scene.isPhysicsEnabled()){var physicEngine=scene.getPhysicsEngine();physicEngine&&(serializationObject.physicsEnabled=!0,serializationObject.physicsGravity=physicEngine.gravity.asArray(),serializationObject.physicsEngine=physicEngine.getPhysicsPluginName())}scene.metadata&&(serializationObject.metadata=scene.metadata),serializationObject.morphTargetManagers=[];for(var _i=0,_a=scene.meshes;_i<_a.length;_i++){var manager=(abstractMesh=_a[_i]).morphTargetManager;manager&&serializationObject.morphTargetManagers.push(manager.serialize())}serializationObject.lights=[];var index,light;for(index=0;index<scene.lights.length;index++)(light=scene.lights[index]).doNotSerialize||serializationObject.lights.push(light.serialize());for(serializationObject.cameras=[],index=0;index<scene.cameras.length;index++){var camera=scene.cameras[index];camera.doNotSerialize||serializationObject.cameras.push(camera.serialize())}scene.activeCamera&&(serializationObject.activeCameraID=scene.activeCamera.id),BABYLON.Animation.AppendSerializedAnimations(scene,serializationObject),serializationObject.materials=[],serializationObject.multiMaterials=[];var material;for(index=0;index<scene.materials.length;index++)(material=scene.materials[index]).doNotSerialize||serializationObject.materials.push(material.serialize());for(serializationObject.multiMaterials=[],index=0;index<scene.multiMaterials.length;index++){var multiMaterial=scene.multiMaterials[index];serializationObject.multiMaterials.push(multiMaterial.serialize())}for(serializationObject.skeletons=[],index=0;index<scene.skeletons.length;index++)serializationObject.skeletons.push(scene.skeletons[index].serialize());for(serializationObject.transformNodes=[],index=0;index<scene.transformNodes.length;index++)serializationObject.transformNodes.push(scene.transformNodes[index].serialize());serializationObject.geometries={},serializationObject.geometries.boxes=[],serializationObject.geometries.spheres=[],serializationObject.geometries.cylinders=[],serializationObject.geometries.toruses=[],serializationObject.geometries.grounds=[],serializationObject.geometries.planes=[],serializationObject.geometries.torusKnots=[],serializationObject.geometries.vertexData=[],serializedGeometries=[];var geometries=scene.getGeometries();for(index=0;index<geometries.length;index++){var geometry=geometries[index];geometry.isReady()&&serializeGeometry(geometry,serializationObject.geometries)}for(serializationObject.meshes=[],index=0;index<scene.meshes.length;index++){var abstractMesh=scene.meshes[index];if(abstractMesh instanceof BABYLON.Mesh){var mesh=abstractMesh;mesh.doNotSerialize||mesh.delayLoadState!==BABYLON.Engine.DELAYLOADSTATE_LOADED&&mesh.delayLoadState!==BABYLON.Engine.DELAYLOADSTATE_NONE||serializationObject.meshes.push(serializeMesh(mesh,serializationObject))}}for(serializationObject.particleSystems=[],index=0;index<scene.particleSystems.length;index++)serializationObject.particleSystems.push(scene.particleSystems[index].serialize());for(serializationObject.lensFlareSystems=[],index=0;index<scene.lensFlareSystems.length;index++)serializationObject.lensFlareSystems.push(scene.lensFlareSystems[index].serialize());for(serializationObject.shadowGenerators=[],index=0;index<scene.lights.length;index++){var shadowGenerator=(light=scene.lights[index]).getShadowGenerator();shadowGenerator&&serializationObject.shadowGenerators.push(shadowGenerator.serialize())}for(scene.actionManager&&(serializationObject.actions=scene.actionManager.serialize("scene")),serializationObject.sounds=[],index=0;index<scene.soundTracks.length;index++)for(var soundtrack=scene.soundTracks[index],soundId=0;soundId<soundtrack.soundCollection.length;soundId++)serializationObject.sounds.push(soundtrack.soundCollection[soundId].serialize());return serializationObject},SceneSerializer.SerializeMesh=function(toSerialize,withParents,withChildren){void 0===withParents&&(withParents=!1),void 0===withChildren&&(withChildren=!1);var serializationObject={};if(SceneSerializer.ClearCache(),toSerialize=toSerialize instanceof Array?toSerialize:[toSerialize],withParents||withChildren)for(var i=0;i<toSerialize.length;++i)withChildren&&toSerialize[i].getDescendants().forEach(function(node){node instanceof BABYLON.Mesh&&toSerialize.indexOf(node)<0&&toSerialize.push(node)}),withParents&&toSerialize[i].parent&&toSerialize.indexOf(toSerialize[i].parent)<0&&toSerialize.push(toSerialize[i].parent);return toSerialize.forEach(function(mesh){finalizeSingleMesh(mesh,serializationObject)}),serializationObject},SceneSerializer}();BABYLON.SceneSerializer=SceneSerializer}(BABYLON||(BABYLON={}));!function(BABYLON){var ReflectionProbe=function(){function ReflectionProbe(name,size,scene,generateMipMaps){void 0===generateMipMaps&&(generateMipMaps=!0);var _this=this;this.name=name,this._viewMatrix=BABYLON.Matrix.Identity(),this._target=BABYLON.Vector3.Zero(),this._add=BABYLON.Vector3.Zero(),this.invertYAxis=!1,this.position=BABYLON.Vector3.Zero(),this._scene=scene,this._scene.reflectionProbes.push(this),this._renderTargetTexture=new BABYLON.RenderTargetTexture(name,size,scene,generateMipMaps,!0,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(faceIndex){switch(faceIndex){case 0:_this._add.copyFromFloats(1,0,0);break;case 1:_this._add.copyFromFloats(-1,0,0);break;case 2:_this._add.copyFromFloats(0,_this.invertYAxis?1:-1,0);break;case 3:_this._add.copyFromFloats(0,_this.invertYAxis?-1:1,0);break;case 4:_this._add.copyFromFloats(0,0,1);break;case 5:_this._add.copyFromFloats(0,0,-1)}_this._attachedMesh&&_this.position.copyFrom(_this._attachedMesh.getAbsolutePosition()),_this.position.addToRef(_this._add,_this._target),BABYLON.Matrix.LookAtLHToRef(_this.position,_this._target,BABYLON.Vector3.Up(),_this._viewMatrix),scene.setTransformMatrix(_this._viewMatrix,_this._projectionMatrix),scene._forcedViewPosition=_this.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){scene._forcedViewPosition=null,scene.updateTransformMatrix(!0)}),scene.activeCamera&&(this._projectionMatrix=BABYLON.Matrix.PerspectiveFovLH(Math.PI/2,1,scene.activeCamera.minZ,scene.activeCamera.maxZ))}return Object.defineProperty(ReflectionProbe.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(value){this._renderTargetTexture.samples=value},enumerable:!0,configurable:!0}),Object.defineProperty(ReflectionProbe.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(value){this._renderTargetTexture.refreshRate=value},enumerable:!0,configurable:!0}),ReflectionProbe.prototype.getScene=function(){return this._scene},Object.defineProperty(ReflectionProbe.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(ReflectionProbe.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),ReflectionProbe.prototype.attachToMesh=function(mesh){this._attachedMesh=mesh},ReflectionProbe.prototype.setRenderingAutoClearDepthStencil=function(renderingGroupId,autoClearDepthStencil){this._renderTargetTexture.setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil)},ReflectionProbe.prototype.dispose=function(){var index=this._scene.reflectionProbes.indexOf(this);-1!==index&&this._scene.reflectionProbes.splice(index,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},ReflectionProbe}();BABYLON.ReflectionProbe=ReflectionProbe}(BABYLON||(BABYLON={}));!function(BABYLON){var Layer=function(){function Layer(name,imgUrl,scene,isBackground,color){this.name=name,this.scale=new BABYLON.Vector2(1,1),this.offset=new BABYLON.Vector2(0,0),this.alphaBlendingMode=BABYLON.Engine.ALPHA_COMBINE,this.layerMask=268435455,this._vertexBuffers={},this.onDisposeObservable=new BABYLON.Observable,this.onBeforeRenderObservable=new BABYLON.Observable,this.onAfterRenderObservable=new BABYLON.Observable,this.texture=imgUrl?new BABYLON.Texture(imgUrl,scene,!0):null,this.isBackground=void 0===isBackground||isBackground,this.color=void 0===color?new BABYLON.Color4(1,1,1,1):color,this._scene=scene||BABYLON.Engine.LastCreatedScene,this._scene.layers.push(this);var engine=this._scene.getEngine(),vertices=[];vertices.push(1,1),vertices.push(-1,1),vertices.push(-1,-1),vertices.push(1,-1);var vertexBuffer=new BABYLON.VertexBuffer(engine,vertices,BABYLON.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=vertexBuffer,this._createIndexBuffer(),this._effect=engine.createEffect("layer",[BABYLON.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=engine.createEffect("layer",[BABYLON.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(Layer.prototype,"onDispose",{set:function(callback){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"onBeforeRender",{set:function(callback){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"onAfterRender",{set:function(callback){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback)},enumerable:!0,configurable:!0}),Layer.prototype._createIndexBuffer=function(){var engine=this._scene.getEngine(),indices=[];indices.push(0),indices.push(1),indices.push(2),indices.push(0),indices.push(2),indices.push(3),this._indexBuffer=engine.createIndexBuffer(indices)},Layer.prototype._rebuild=function(){var vb=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vb&&vb._rebuild(),this._createIndexBuffer()},Layer.prototype.render=function(){var currentEffect=this.alphaTest?this._alphaTestEffect:this._effect;if(currentEffect.isReady()&&this.texture&&this.texture.isReady()){var engine=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),engine.enableEffect(currentEffect),engine.setState(!1),currentEffect.setTexture("textureSampler",this.texture),currentEffect.setMatrix("textureMatrix",this.texture.getTextureMatrix()),currentEffect.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),currentEffect.setVector2("offset",this.offset),currentEffect.setVector2("scale",this.scale),engine.bindBuffers(this._vertexBuffers,this._indexBuffer,currentEffect),this.alphaTest?engine.draw(!0,0,6):(engine.setAlphaMode(this.alphaBlendingMode),engine.draw(!0,0,6),engine.setAlphaMode(BABYLON.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},Layer.prototype.dispose=function(){var vertexBuffer=this._vertexBuffers[BABYLON.VertexBuffer.PositionKind];vertexBuffer&&(vertexBuffer.dispose(),this._vertexBuffers[BABYLON.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var index=this._scene.layers.indexOf(this);this._scene.layers.splice(index,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},Layer}();BABYLON.Layer=Layer}(BABYLON||(BABYLON={}));!function(BABYLON){var TextureTools=function(){function TextureTools(){}return TextureTools.CreateResizedCopy=function(texture,width,height,useBilinearMode){void 0===useBilinearMode&&(useBilinearMode=!0);var scene=texture.getScene(),engine=scene.getEngine(),rtt=new BABYLON.RenderTargetTexture("resized"+texture.name,{width:width,height:height},scene,!texture.noMipmap,!0,texture._texture.type,!1,texture._samplingMode,!1);rtt.wrapU=texture.wrapU,rtt.wrapV=texture.wrapV,rtt.uOffset=texture.uOffset,rtt.vOffset=texture.vOffset,rtt.uScale=texture.uScale,rtt.vScale=texture.vScale,rtt.uAng=texture.uAng,rtt.vAng=texture.vAng,rtt.wAng=texture.wAng,rtt.coordinatesIndex=texture.coordinatesIndex,rtt.level=texture.level,rtt.anisotropicFilteringLevel=texture.anisotropicFilteringLevel,rtt._texture.isReady=!1,texture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,texture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE;var passPostProcess=new BABYLON.PassPostProcess("pass",1,null,useBilinearMode?BABYLON.Texture.BILINEAR_SAMPLINGMODE:BABYLON.Texture.NEAREST_SAMPLINGMODE,engine,!1,BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT);return passPostProcess.getEffect().executeWhenCompiled(function(){passPostProcess.onApply=function(effect){effect.setTexture("textureSampler",texture)};var internalTexture=rtt.getInternalTexture();internalTexture&&(scene.postProcessManager.directRender([passPostProcess],internalTexture),engine.unBindFramebuffer(internalTexture),rtt.disposeFramebufferObjects(),passPostProcess.dispose(),internalTexture.isReady=!0)}),rtt},TextureTools.GetEnvironmentBRDFTexture=function(scene){if(!scene._environmentBRDFTexture){var texture=BABYLON.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",scene,!0,!1,BABYLON.Texture.BILINEAR_SAMPLINGMODE);texture.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,texture.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,scene._environmentBRDFTexture=texture}return scene._environmentBRDFTexture},TextureTools._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",TextureTools}();BABYLON.TextureTools=TextureTools}(BABYLON||(BABYLON={}));!function(BABYLON){var FramingBehavior=function(){function FramingBehavior(){this._mode=FramingBehavior.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(FramingBehavior.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"mode",{get:function(){return this._mode},set:function(mode){this._mode=mode},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(radius){this._radiusScale=radius},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"positionScale",{get:function(){return this._positionScale},set:function(scale){this._positionScale=scale},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(elevation){this._defaultElevation=elevation},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(speed){this._elevationReturnTime=speed},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(time){this._elevationReturnWaitTime=time},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(flag){this._zoomStopsAnimation=flag},enumerable:!0,configurable:!0}),Object.defineProperty(FramingBehavior.prototype,"framingTime",{get:function(){return this._framingTime},set:function(time){this._framingTime=time},enumerable:!0,configurable:!0}),FramingBehavior.prototype.init=function(){},FramingBehavior.prototype.attach=function(camera){var _this=this;this._attachedCamera=camera;var scene=this._attachedCamera.getScene();FramingBehavior.EasingFunction.setEasingMode(FramingBehavior.EasingMode),this._onPrePointerObservableObserver=scene.onPrePointerObservable.add(function(pointerInfoPre){pointerInfoPre.type!==BABYLON.PointerEventTypes.POINTERDOWN?pointerInfoPre.type===BABYLON.PointerEventTypes.POINTERUP&&(_this._isPointerDown=!1):_this._isPointerDown=!0}),this._onMeshTargetChangedObserver=camera.onMeshTargetChangedObservable.add(function(mesh){mesh&&_this.zoomOnMesh(mesh)}),this._onAfterCheckInputsObserver=camera.onAfterCheckInputsObservable.add(function(){_this._applyUserInteraction(),_this._maintainCameraAboveGround()})},FramingBehavior.prototype.detach=function(){if(this._attachedCamera){var scene=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&scene.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},FramingBehavior.prototype.zoomOnMesh=function(mesh,focusOnOriginXZ,onAnimationEnd){void 0===focusOnOriginXZ&&(focusOnOriginXZ=!1),void 0===onAnimationEnd&&(onAnimationEnd=null),mesh.computeWorldMatrix(!0);var boundingBox=mesh.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(boundingBox.minimumWorld,boundingBox.maximumWorld,focusOnOriginXZ,onAnimationEnd)},FramingBehavior.prototype.zoomOnMeshHierarchy=function(mesh,focusOnOriginXZ,onAnimationEnd){void 0===focusOnOriginXZ&&(focusOnOriginXZ=!1),void 0===onAnimationEnd&&(onAnimationEnd=null),mesh.computeWorldMatrix(!0);var boundingBox=mesh.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(boundingBox.min,boundingBox.max,focusOnOriginXZ,onAnimationEnd)},FramingBehavior.prototype.zoomOnMeshesHierarchy=function(meshes,focusOnOriginXZ,onAnimationEnd){void 0===focusOnOriginXZ&&(focusOnOriginXZ=!1),void 0===onAnimationEnd&&(onAnimationEnd=null);for(var min=new BABYLON.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),max=new BABYLON.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=0;i<meshes.length;i++){var boundingInfo=meshes[i].getHierarchyBoundingVectors(!0);BABYLON.Tools.CheckExtends(boundingInfo.min,min,max),BABYLON.Tools.CheckExtends(boundingInfo.max,min,max)}this.zoomOnBoundingInfo(min,max,focusOnOriginXZ,onAnimationEnd)},FramingBehavior.prototype.zoomOnBoundingInfo=function(minimumWorld,maximumWorld,focusOnOriginXZ,onAnimationEnd){var _this=this;void 0===focusOnOriginXZ&&(focusOnOriginXZ=!1),void 0===onAnimationEnd&&(onAnimationEnd=null);var zoomTarget;if(this._attachedCamera){var bottom=minimumWorld.y,zoomTargetY=bottom+(maximumWorld.y-bottom)*this._positionScale,radiusWorld=maximumWorld.subtract(minimumWorld).scale(.5);if(focusOnOriginXZ)zoomTarget=new BABYLON.Vector3(0,zoomTargetY,0);else{var centerWorld=minimumWorld.add(radiusWorld);zoomTarget=new BABYLON.Vector3(centerWorld.x,zoomTargetY,centerWorld.z)}this._vectorTransition||(this._vectorTransition=BABYLON.Animation.CreateAnimation("target",BABYLON.Animation.ANIMATIONTYPE_VECTOR3,60,FramingBehavior.EasingFunction)),this._betaIsAnimating=!0;var animatable=BABYLON.Animation.TransitionTo("target",zoomTarget,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);animatable&&this._animatables.push(animatable);var radius=0;if(this._mode===FramingBehavior.FitFrustumSidesMode){var position=this._calculateLowerRadiusFromModelBoundingSphere(minimumWorld,maximumWorld);this._attachedCamera.lowerRadiusLimit=radiusWorld.length()+this._attachedCamera.minZ,radius=position}else this._mode===FramingBehavior.IgnoreBoundsSizeMode&&(radius=this._calculateLowerRadiusFromModelBoundingSphere(minimumWorld,maximumWorld),null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));var extend=maximumWorld.subtract(minimumWorld).length();this._attachedCamera.panningSensibility=5e3/extend,this._attachedCamera.wheelPrecision=100/radius,this._radiusTransition||(this._radiusTransition=BABYLON.Animation.CreateAnimation("radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,60,FramingBehavior.EasingFunction)),(animatable=BABYLON.Animation.TransitionTo("radius",radius,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){onAnimationEnd&&onAnimationEnd(),_this._attachedCamera&&_this._attachedCamera.storeState()}))&&this._animatables.push(animatable)}},FramingBehavior.prototype._calculateLowerRadiusFromModelBoundingSphere=function(minimumWorld,maximumWorld){var boxVectorGlobalDiagonal=maximumWorld.subtract(minimumWorld).length(),frustumSlope=this._getFrustumSlope(),radius=.5*boxVectorGlobalDiagonal*this._radiusScale,distanceForHorizontalFrustum=radius*Math.sqrt(1+1/(frustumSlope.x*frustumSlope.x)),distanceForVerticalFrustum=radius*Math.sqrt(1+1/(frustumSlope.y*frustumSlope.y)),distance=Math.max(distanceForHorizontalFrustum,distanceForVerticalFrustum),camera=this._attachedCamera;return camera?(camera.lowerRadiusLimit&&this._mode===FramingBehavior.IgnoreBoundsSizeMode&&(distance=distance<camera.lowerRadiusLimit?camera.lowerRadiusLimit:distance),camera.upperRadiusLimit&&(distance=distance>camera.upperRadiusLimit?camera.upperRadiusLimit:distance),distance):0},FramingBehavior.prototype._maintainCameraAboveGround=function(){var _this=this;if(!(this._elevationReturnTime<0)){var timeSinceInteraction=BABYLON.Tools.Now-this._lastInteractionTime,defaultBeta=.5*Math.PI-this._defaultElevation,limitBeta=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>limitBeta&&timeSinceInteraction>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=BABYLON.Animation.CreateAnimation("beta",BABYLON.Animation.ANIMATIONTYPE_FLOAT,60,FramingBehavior.EasingFunction));var animatabe=BABYLON.Animation.TransitionTo("beta",defaultBeta,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){_this._clearAnimationLocks(),_this.stopAllAnimations()});animatabe&&this._animatables.push(animatabe)}}},FramingBehavior.prototype._getFrustumSlope=function(){var camera=this._attachedCamera;if(!camera)return BABYLON.Vector2.Zero();var aspectRatio=camera.getScene().getEngine().getAspectRatio(camera),frustumSlopeY=Math.tan(camera.fov/2),frustumSlopeX=frustumSlopeY*aspectRatio;return new BABYLON.Vector2(frustumSlopeX,frustumSlopeY)},FramingBehavior.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},FramingBehavior.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=BABYLON.Tools.Now,this.stopAllAnimations(),this._clearAnimationLocks())},FramingBehavior.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(FramingBehavior.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),FramingBehavior.EasingFunction=new BABYLON.ExponentialEase,FramingBehavior.EasingMode=BABYLON.EasingFunction.EASINGMODE_EASEINOUT,FramingBehavior.IgnoreBoundsSizeMode=0,FramingBehavior.FitFrustumSidesMode=1,FramingBehavior}();BABYLON.FramingBehavior=FramingBehavior}(BABYLON||(BABYLON={}));!function(BABYLON){var BouncingBehavior=function(){function BouncingBehavior(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(BouncingBehavior.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(BouncingBehavior.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(value){var _this=this;if(this._autoTransitionRange!==value){this._autoTransitionRange=value;var camera=this._attachedCamera;camera&&(value?this._onMeshTargetChangedObserver=camera.onMeshTargetChangedObservable.add(function(mesh){if(mesh){mesh.computeWorldMatrix(!0);var diagonal=mesh.getBoundingInfo().diagonalLength;_this.lowerRadiusTransitionRange=.05*diagonal,_this.upperRadiusTransitionRange=.05*diagonal}}):this._onMeshTargetChangedObserver&&camera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),BouncingBehavior.prototype.init=function(){},BouncingBehavior.prototype.attach=function(camera){var _this=this;this._attachedCamera=camera,this._onAfterCheckInputsObserver=camera.onAfterCheckInputsObservable.add(function(){_this._attachedCamera&&(_this._isRadiusAtLimit(_this._attachedCamera.lowerRadiusLimit)&&_this._applyBoundRadiusAnimation(_this.lowerRadiusTransitionRange),_this._isRadiusAtLimit(_this._attachedCamera.upperRadiusLimit)&&_this._applyBoundRadiusAnimation(_this.upperRadiusTransitionRange))})},BouncingBehavior.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},BouncingBehavior.prototype._isRadiusAtLimit=function(radiusLimit){return!!this._attachedCamera&&(this._attachedCamera.radius===radiusLimit&&!this._radiusIsAnimating)},BouncingBehavior.prototype._applyBoundRadiusAnimation=function(radiusDelta){var _this=this;if(this._attachedCamera){this._radiusBounceTransition||(BouncingBehavior.EasingFunction.setEasingMode(BouncingBehavior.EasingMode),this._radiusBounceTransition=BABYLON.Animation.CreateAnimation("radius",BABYLON.Animation.ANIMATIONTYPE_FLOAT,60,BouncingBehavior.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var animatable=BABYLON.Animation.TransitionTo("radius",this._attachedCamera.radius+radiusDelta,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return _this._clearAnimationLocks()});animatable&&this._animatables.push(animatable)}},BouncingBehavior.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},BouncingBehavior.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},BouncingBehavior.EasingFunction=new BABYLON.BackEase(.3),BouncingBehavior.EasingMode=BABYLON.EasingFunction.EASINGMODE_EASEOUT,BouncingBehavior}();BABYLON.BouncingBehavior=BouncingBehavior}(BABYLON||(BABYLON={}));!function(BABYLON){var AutoRotationBehavior=function(){function AutoRotationBehavior(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(AutoRotationBehavior.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(AutoRotationBehavior.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(flag){this._zoomStopsAnimation=flag},enumerable:!0,configurable:!0}),Object.defineProperty(AutoRotationBehavior.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(speed){this._idleRotationSpeed=speed},enumerable:!0,configurable:!0}),Object.defineProperty(AutoRotationBehavior.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(time){this._idleRotationWaitTime=time},enumerable:!0,configurable:!0}),Object.defineProperty(AutoRotationBehavior.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(time){this._idleRotationSpinupTime=time},enumerable:!0,configurable:!0}),Object.defineProperty(AutoRotationBehavior.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),AutoRotationBehavior.prototype.init=function(){},AutoRotationBehavior.prototype.attach=function(camera){var _this=this;this._attachedCamera=camera;var scene=this._attachedCamera.getScene();this._onPrePointerObservableObserver=scene.onPrePointerObservable.add(function(pointerInfoPre){pointerInfoPre.type!==BABYLON.PointerEventTypes.POINTERDOWN?pointerInfoPre.type===BABYLON.PointerEventTypes.POINTERUP&&(_this._isPointerDown=!1):_this._isPointerDown=!0}),this._onAfterCheckInputsObserver=camera.onAfterCheckInputsObservable.add(function(){var now=BABYLON.Tools.Now,dt=0;null!=_this._lastFrameTime&&(dt=now-_this._lastFrameTime),_this._lastFrameTime=now,_this._applyUserInteraction();var timeToRotation=now-_this._lastInteractionTime-_this._idleRotationWaitTime,scale=Math.max(Math.min(timeToRotation/_this._idleRotationSpinupTime,1),0);_this._cameraRotationSpeed=_this._idleRotationSpeed*scale,_this._attachedCamera&&(_this._attachedCamera.alpha-=_this._cameraRotationSpeed*(dt/1e3))})},AutoRotationBehavior.prototype.detach=function(){if(this._attachedCamera){var scene=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&scene.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},AutoRotationBehavior.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},AutoRotationBehavior.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var zoomHasHitLimit=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(zoomHasHitLimit=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?zoomHasHitLimit:this._userIsZooming()},AutoRotationBehavior.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=BABYLON.Tools.Now)},AutoRotationBehavior.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},AutoRotationBehavior}();BABYLON.AutoRotationBehavior=AutoRotationBehavior}(BABYLON||(BABYLON={}));!function(BABYLON){var NullEngineOptions=function(){return function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4}}();BABYLON.NullEngineOptions=NullEngineOptions;var NullEngine=function(_super){function NullEngine(options){void 0===options&&(options=new NullEngineOptions);var _this=_super.call(this,null)||this;return void 0===options.deterministicLockstep&&(options.deterministicLockstep=!1),void 0===options.lockstepMaxSteps&&(options.lockstepMaxSteps=4),_this._options=options,_this._caps=new BABYLON.EngineCapabilities,_this._caps.maxTexturesImageUnits=16,_this._caps.maxVertexTextureImageUnits=16,_this._caps.maxTextureSize=512,_this._caps.maxCubemapTextureSize=512,_this._caps.maxRenderTextureSize=512,_this._caps.maxVertexAttribs=16,_this._caps.maxVaryingVectors=16,_this._caps.maxFragmentUniformVectors=16,_this._caps.maxVertexUniformVectors=16,_this._caps.standardDerivatives=!1,_this._caps.astc=null,_this._caps.s3tc=null,_this._caps.pvrtc=null,_this._caps.etc1=null,_this._caps.etc2=null,_this._caps.textureAnisotropicFilterExtension=null,_this._caps.maxAnisotropy=0,_this._caps.uintIndices=!1,_this._caps.fragmentDepthSupported=!1,_this._caps.highPrecisionShaderSupported=!0,_this._caps.colorBufferFloat=!1,_this._caps.textureFloat=!1,_this._caps.textureFloatLinearFiltering=!1,_this._caps.textureFloatRender=!1,_this._caps.textureHalfFloat=!1,_this._caps.textureHalfFloatLinearFiltering=!1,_this._caps.textureHalfFloatRender=!1,_this._caps.textureLOD=!1,_this._caps.drawBuffersExtension=!1,_this._caps.depthTextureExtension=!1,_this._caps.vertexArrayObject=!1,_this._caps.instancedArrays=!1,BABYLON.Tools.Log("Babylon.js null engine (v"+BABYLON.Engine.Version+") launched"),"undefined"==typeof URL&&(URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(Blob=function(){}),_this}return __extends(NullEngine,_super),NullEngine.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},NullEngine.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},NullEngine.prototype.createVertexBuffer=function(vertices){return{capacity:0,references:1,is32Bits:!1}},NullEngine.prototype.createIndexBuffer=function(indices){return{capacity:0,references:1,is32Bits:!1}},NullEngine.prototype.clear=function(color,backBuffer,depth,stencil){void 0===stencil&&(stencil=!1)},NullEngine.prototype.getRenderWidth=function(useScreen){return void 0===useScreen&&(useScreen=!1),!useScreen&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},NullEngine.prototype.getRenderHeight=function(useScreen){return void 0===useScreen&&(useScreen=!1),!useScreen&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},NullEngine.prototype.setViewport=function(viewport,requiredWidth,requiredHeight){this._cachedViewport=viewport},NullEngine.prototype.createShaderProgram=function(vertexCode,fragmentCode,defines,context){return{transformFeedback:null,__SPECTOR_rebuildProgram:null}},NullEngine.prototype.getUniforms=function(shaderProgram,uniformsNames){return[]},NullEngine.prototype.getAttributes=function(shaderProgram,attributesNames){return[]},NullEngine.prototype.bindSamplers=function(effect){this._currentEffect=null},NullEngine.prototype.enableEffect=function(effect){this._currentEffect=effect,effect.onBind&&effect.onBind(effect),effect.onBindObservable.notifyObservers(effect)},NullEngine.prototype.setState=function(culling,zOffset,force,reverseSide){void 0===zOffset&&(zOffset=0),void 0===reverseSide&&(reverseSide=!1)},NullEngine.prototype.setIntArray=function(uniform,array){},NullEngine.prototype.setIntArray2=function(uniform,array){},NullEngine.prototype.setIntArray3=function(uniform,array){},NullEngine.prototype.setIntArray4=function(uniform,array){},NullEngine.prototype.setFloatArray=function(uniform,array){},NullEngine.prototype.setFloatArray2=function(uniform,array){},NullEngine.prototype.setFloatArray3=function(uniform,array){},NullEngine.prototype.setFloatArray4=function(uniform,array){},NullEngine.prototype.setArray=function(uniform,array){},NullEngine.prototype.setArray2=function(uniform,array){},NullEngine.prototype.setArray3=function(uniform,array){},NullEngine.prototype.setArray4=function(uniform,array){},NullEngine.prototype.setMatrices=function(uniform,matrices){},NullEngine.prototype.setMatrix=function(uniform,matrix){},NullEngine.prototype.setMatrix3x3=function(uniform,matrix){},NullEngine.prototype.setMatrix2x2=function(uniform,matrix){},NullEngine.prototype.setFloat=function(uniform,value){},NullEngine.prototype.setFloat2=function(uniform,x,y){},NullEngine.prototype.setFloat3=function(uniform,x,y,z){},NullEngine.prototype.setBool=function(uniform,bool){},NullEngine.prototype.setFloat4=function(uniform,x,y,z,w){},NullEngine.prototype.setColor3=function(uniform,color3){},NullEngine.prototype.setColor4=function(uniform,color3,alpha){},NullEngine.prototype.setAlphaMode=function(mode,noDepthWriteChange){void 0===noDepthWriteChange&&(noDepthWriteChange=!1),this._alphaMode!==mode&&(this._alphaState.alphaBlend=mode!==BABYLON.Engine.ALPHA_DISABLE,noDepthWriteChange||this.setDepthWrite(mode===BABYLON.Engine.ALPHA_DISABLE),this._alphaMode=mode)},NullEngine.prototype.bindBuffers=function(vertexBuffers,indexBuffer,effect){},NullEngine.prototype.wipeCaches=function(bruteForce){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,bruteForce&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},NullEngine.prototype.draw=function(useTriangles,indexStart,indexCount,instancesCount){},NullEngine.prototype._createTexture=function(){return{}},NullEngine.prototype.createTexture=function(urlArg,noMipmap,invertY,scene,samplingMode,onLoad,onError,buffer,fallBack,format){void 0===samplingMode&&(samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE),void 0===onLoad&&(onLoad=null),void 0===onError&&(onError=null),void 0===buffer&&(buffer=null);var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_URL),url=String(urlArg);return texture.url=url,texture.generateMipMaps=!noMipmap,texture.samplingMode=samplingMode,texture.invertY=invertY,texture.baseWidth=this._options.textureSize,texture.baseHeight=this._options.textureSize,texture.width=this._options.textureSize,texture.height=this._options.textureSize,format&&(texture.format=format),texture.isReady=!0,onLoad&&onLoad(),texture},NullEngine.prototype.createRenderTargetTexture=function(size,options){var fullOptions=new BABYLON.RenderTargetCreationOptions;void 0!==options&&"object"==typeof options?(fullOptions.generateMipMaps=options.generateMipMaps,fullOptions.generateDepthBuffer=void 0===options.generateDepthBuffer||options.generateDepthBuffer,fullOptions.generateStencilBuffer=fullOptions.generateDepthBuffer&&options.generateStencilBuffer,fullOptions.type=void 0===options.type?BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT:options.type,fullOptions.samplingMode=void 0===options.samplingMode?BABYLON.Texture.TRILINEAR_SAMPLINGMODE:options.samplingMode):(fullOptions.generateMipMaps=options,fullOptions.generateDepthBuffer=!0,fullOptions.generateStencilBuffer=!1,fullOptions.type=BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,fullOptions.samplingMode=BABYLON.Texture.TRILINEAR_SAMPLINGMODE);var texture=new BABYLON.InternalTexture(this,BABYLON.InternalTexture.DATASOURCE_RENDERTARGET),width=size.width||size,height=size.height||size;return texture._depthStencilBuffer={},texture._framebuffer={},texture.baseWidth=width,texture.baseHeight=height,texture.width=width,texture.height=height,texture.isReady=!0,texture.samples=1,texture.generateMipMaps=!!fullOptions.generateMipMaps,texture.samplingMode=fullOptions.samplingMode,texture.type=fullOptions.type,texture._generateDepthBuffer=fullOptions.generateDepthBuffer,texture._generateStencilBuffer=!!fullOptions.generateStencilBuffer,texture},NullEngine.prototype.updateTextureSamplingMode=function(samplingMode,texture){texture.samplingMode=samplingMode},NullEngine.prototype.bindFramebuffer=function(texture,faceIndex,requiredWidth,requiredHeight,forceFullscreenViewport){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=texture,this._currentFramebuffer=texture._MSAAFramebuffer?texture._MSAAFramebuffer:texture._framebuffer,this._cachedViewport&&!forceFullscreenViewport&&this.setViewport(this._cachedViewport,requiredWidth,requiredHeight)},NullEngine.prototype.unBindFramebuffer=function(texture,disableGenerateMipMaps,onBeforeUnbind){void 0===disableGenerateMipMaps&&(disableGenerateMipMaps=!1),this._currentRenderTarget=null,onBeforeUnbind&&(texture._MSAAFramebuffer&&(this._currentFramebuffer=texture._framebuffer),onBeforeUnbind()),this._currentFramebuffer=null},NullEngine.prototype.createDynamicVertexBuffer=function(vertices){return{capacity:1,references:1,is32Bits:!1}},NullEngine.prototype.updateDynamicIndexBuffer=function(indexBuffer,indices,offset){void 0===offset&&(offset=0)},NullEngine.prototype.updateDynamicVertexBuffer=function(vertexBuffer,vertices,offset,count){},NullEngine.prototype._bindTextureDirectly=function(target,texture){this._boundTexturesCache[this._activeTextureChannel]!==texture&&(this._boundTexturesCache[this._activeTextureChannel]=texture)},NullEngine.prototype._bindTexture=function(channel,texture){channel<0||this._bindTextureDirectly(0,texture)},NullEngine.prototype._releaseBuffer=function(buffer){return buffer.references--,0===buffer.references},NullEngine}(BABYLON.Engine);BABYLON.NullEngine=NullEngine}(BABYLON||(BABYLON={}));!function(BABYLON){var EngineInstrumentation=function(){function EngineInstrumentation(engine){this.engine=engine,this._captureGPUFrameTime=!1,this._gpuFrameTime=new BABYLON.PerfCounter,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new BABYLON.PerfCounter,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(EngineInstrumentation.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(EngineInstrumentation.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(value){var _this=this;value!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=value,value?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){_this._gpuFrameTimeToken||(_this._gpuFrameTimeToken=_this.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(_this._gpuFrameTimeToken){var time=_this.engine.endTimeQuery(_this._gpuFrameTimeToken);time>-1&&(_this._gpuFrameTimeToken=null,_this._gpuFrameTime.fetchNewFrame(),_this._gpuFrameTime.addCount(time,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(EngineInstrumentation.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(EngineInstrumentation.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(value){var _this=this;value!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=value,value?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){_this._shaderCompilationTime.fetchNewFrame(),_this._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){_this._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),EngineInstrumentation.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},EngineInstrumentation}();BABYLON.EngineInstrumentation=EngineInstrumentation}(BABYLON||(BABYLON={}));!function(BABYLON){var SceneInstrumentation=function(){function SceneInstrumentation(scene){var _this=this;this.scene=scene,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new BABYLON.PerfCounter,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new BABYLON.PerfCounter,this._captureFrameTime=!1,this._frameTime=new BABYLON.PerfCounter,this._captureRenderTime=!1,this._renderTime=new BABYLON.PerfCounter,this._captureInterFrameTime=!1,this._interFrameTime=new BABYLON.PerfCounter,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new BABYLON.PerfCounter,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new BABYLON.PerfCounter,this._capturePhysicsTime=!1,this._physicsTime=new BABYLON.PerfCounter,this._captureAnimationsTime=!1,this._animationsTime=new BABYLON.PerfCounter,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeAnimationsObserver=scene.onBeforeAnimationsObservable.add(function(){_this._captureActiveMeshesEvaluationTime&&_this._activeMeshesEvaluationTime.fetchNewFrame(),_this._captureRenderTargetsRenderTime&&_this._renderTargetsRenderTime.fetchNewFrame(),_this._captureFrameTime&&(BABYLON.Tools.StartPerformanceCounter("Scene rendering"),_this._frameTime.beginMonitoring()),_this._captureInterFrameTime&&_this._interFrameTime.endMonitoring(),_this._captureParticlesRenderTime&&_this._particlesRenderTime.fetchNewFrame(),_this._captureSpritesRenderTime&&_this._spritesRenderTime.fetchNewFrame(),_this._captureAnimationsTime&&_this._animationsTime.beginMonitoring(),_this.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=scene.onAfterRenderObservable.add(function(){_this._captureFrameTime&&(BABYLON.Tools.EndPerformanceCounter("Scene rendering"),_this._frameTime.endMonitoring()),_this._captureRenderTime&&_this._renderTime.endMonitoring(!1),_this._captureInterFrameTime&&_this._interFrameTime.beginMonitoring()})}return Object.defineProperty(SceneInstrumentation.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(value){var _this=this;value!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=value,value?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){BABYLON.Tools.StartPerformanceCounter("Active meshes evaluation"),_this._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){BABYLON.Tools.EndPerformanceCounter("Active meshes evaluation"),_this._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(value){var _this=this;value!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=value,value?(this._onBeforeRenderTargetsRenderObserver=this.scene.OnBeforeRenderTargetsRenderObservable.add(function(){BABYLON.Tools.StartPerformanceCounter("Render targets rendering"),_this._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.OnAfterRenderTargetsRenderObservable.add(function(){BABYLON.Tools.EndPerformanceCounter("Render targets rendering"),_this._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.OnBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.OnAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(value){var _this=this;value!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=value,value?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){BABYLON.Tools.StartPerformanceCounter("Particles"),_this._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){BABYLON.Tools.EndPerformanceCounter("Particles"),_this._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(value){var _this=this;value!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=value,value?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){BABYLON.Tools.StartPerformanceCounter("Sprites"),_this._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){BABYLON.Tools.EndPerformanceCounter("Sprites"),_this._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(value){var _this=this;value!==this._capturePhysicsTime&&(this._capturePhysicsTime=value,value?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){BABYLON.Tools.StartPerformanceCounter("Physics"),_this._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){BABYLON.Tools.EndPerformanceCounter("Physics"),_this._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(value){var _this=this;value!==this._captureAnimationsTime&&(this._captureAnimationsTime=value,value?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){_this._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(value){this._captureFrameTime=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(value){this._captureInterFrameTime=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(value){var _this=this;value!==this._captureRenderTime&&(this._captureRenderTime=value,value?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){_this._renderTime.beginMonitoring(),BABYLON.Tools.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){_this._renderTime.endMonitoring(!1),BABYLON.Tools.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(SceneInstrumentation.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),SceneInstrumentation.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.OnBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.OnAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null,this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null,this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene=null},SceneInstrumentation}();BABYLON.SceneInstrumentation=SceneInstrumentation}(BABYLON||(BABYLON={}));!function(BABYLON){var _TimeToken=function(){return function(){this._timeElapsedQueryEnded=!1}}();BABYLON._TimeToken=_TimeToken}(BABYLON||(BABYLON={}));!function(BABYLON){var BackgroundMaterialDefines=function(_super){function BackgroundMaterialDefines(){var _this=_super.call(this)||this;return _this.DIFFUSE=!1,_this.DIFFUSEDIRECTUV=0,_this.GAMMADIFFUSE=!1,_this.DIFFUSEHASALPHA=!1,_this.OPACITYFRESNEL=!1,_this.REFLECTIONBLUR=!1,_this.REFLECTIONFRESNEL=!1,_this.REFLECTIONFALLOFF=!1,_this.TEXTURELODSUPPORT=!1,_this.PREMULTIPLYALPHA=!1,_this.USERGBCOLOR=!1,_this.NOISE=!1,_this.IMAGEPROCESSING=!1,_this.VIGNETTE=!1,_this.VIGNETTEBLENDMODEMULTIPLY=!1,_this.VIGNETTEBLENDMODEOPAQUE=!1,_this.TONEMAPPING=!1,_this.CONTRAST=!1,_this.COLORCURVES=!1,_this.COLORGRADING=!1,_this.COLORGRADING3D=!1,_this.SAMPLER3DGREENDEPTH=!1,_this.SAMPLER3DBGRMAP=!1,_this.IMAGEPROCESSINGPOSTPROCESS=!1,_this.EXPOSURE=!1,_this.REFLECTION=!1,_this.REFLECTIONMAP_3D=!1,_this.REFLECTIONMAP_SPHERICAL=!1,_this.REFLECTIONMAP_PLANAR=!1,_this.REFLECTIONMAP_CUBIC=!1,_this.REFLECTIONMAP_PROJECTION=!1,_this.REFLECTIONMAP_SKYBOX=!1,_this.REFLECTIONMAP_EXPLICIT=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR=!1,_this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,_this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,_this.INVERTCUBICMAP=!1,_this.REFLECTIONMAP_OPPOSITEZ=!1,_this.LODINREFLECTIONALPHA=!1,_this.GAMMAREFLECTION=!1,_this.MAINUV1=!1,_this.MAINUV2=!1,_this.UV1=!1,_this.UV2=!1,_this.CLIPPLANE=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.NORMAL=!1,_this.NUM_BONE_INFLUENCERS=0,_this.BonesPerMesh=0,_this.INSTANCES=!1,_this.SHADOWFLOAT=!1,_this.rebuild(),_this}return __extends(BackgroundMaterialDefines,_super),BackgroundMaterialDefines}(BABYLON.MaterialDefines),BackgroundMaterial=function(_super){function BackgroundMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.primaryColor=BABYLON.Color3.White(),_this.primaryLevel=1,_this.secondaryColor=BABYLON.Color3.Gray(),_this.secondaryLevel=1,_this.tertiaryColor=BABYLON.Color3.Black(),_this.tertiaryLevel=1,_this.reflectionTexture=null,_this.reflectionBlur=0,_this.diffuseTexture=null,_this._shadowLights=null,_this.shadowLights=null,_this.shadowBlurScale=1,_this.shadowLevel=0,_this.sceneCenter=BABYLON.Vector3.Zero(),_this.opacityFresnel=!0,_this.reflectionFresnel=!1,_this.reflectionFalloffDistance=0,_this.reflectionAmount=1,_this.reflectionReflectance0=.05,_this.reflectionReflectance90=.5,_this.useRGBColor=!0,_this.enableNoise=!1,_this._maxSimultaneousLights=4,_this.maxSimultaneousLights=4,_this._imageProcessingObserver=null,_this._renderTargets=new BABYLON.SmartArray(16),_this._reflectionControls=BABYLON.Vector4.Zero(),_this._attachImageProcessingConfiguration(null),_this.getRenderTargetTextures=function(){return _this._renderTargets.reset(),_this._diffuseTexture&&_this._diffuseTexture.isRenderTarget&&_this._renderTargets.push(_this._diffuseTexture),_this._reflectionTexture&&_this._reflectionTexture.isRenderTarget&&_this._renderTargets.push(_this._reflectionTexture),_this._renderTargets},_this}return __extends(BackgroundMaterial,_super),Object.defineProperty(BackgroundMaterial.prototype,"reflectionStandardFresnelWeight",{set:function(value){var reflectionWeight=value;reflectionWeight<.5?(reflectionWeight*=2,this.reflectionReflectance0=BackgroundMaterial.standardReflectance0*reflectionWeight,this.reflectionReflectance90=BackgroundMaterial.standardReflectance90*reflectionWeight):(reflectionWeight=2*reflectionWeight-1,this.reflectionReflectance0=BackgroundMaterial.standardReflectance0+(1-BackgroundMaterial.standardReflectance0)*reflectionWeight,this.reflectionReflectance90=BackgroundMaterial.standardReflectance90+(1-BackgroundMaterial.standardReflectance90)*reflectionWeight)},enumerable:!0,configurable:!0}),BackgroundMaterial.prototype._attachImageProcessingConfiguration=function(configuration){var _this=this;configuration!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=configuration||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(conf){_this._markAllSubMeshesAsImageProcessingDirty()}))},Object.defineProperty(BackgroundMaterial.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(value){this._attachImageProcessingConfiguration(value),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(value){this.imageProcessingConfiguration.colorCurvesEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(value){this.imageProcessingConfiguration.colorGradingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(value){this._imageProcessingConfiguration.toneMappingEnabled=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(value){this._imageProcessingConfiguration.exposure=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(value){this._imageProcessingConfiguration.contrast=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(value){this.imageProcessingConfiguration.colorGradingTexture=value},enumerable:!0,configurable:!0}),Object.defineProperty(BackgroundMaterial.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(value){this.imageProcessingConfiguration.colorCurves=value},enumerable:!0,configurable:!0}),BackgroundMaterial.prototype.needAlphaTesting=function(){return!0},BackgroundMaterial.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},BackgroundMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){var _this=this;if(void 0===useInstances&&(useInstances=!1),subMesh.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;subMesh._materialDefines||(subMesh._materialDefines=new BackgroundMaterialDefines);var scene=this.getScene(),defines=subMesh._materialDefines;if(!this.checkReadyOnEveryCall&&subMesh.effect&&defines._renderId===scene.getRenderId())return!0;var engine=scene.getEngine();if(BABYLON.MaterialHelper.PrepareDefinesForLights(scene,mesh,defines,!1,this._maxSimultaneousLights),defines._needNormals=!0,defines._areTexturesDirty){if(defines._needUVs=!1,scene.texturesEnabled){if(scene.getEngine().getCaps().textureLOD&&(defines.TEXTURELODSUPPORT=!0),this._diffuseTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;BABYLON.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,defines,"DIFFUSE"),defines.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,defines.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,defines.OPACITYFRESNEL=this._opacityFresnel}else defines.DIFFUSE=!1,defines.DIFFUSEHASALPHA=!1,defines.GAMMADIFFUSE=!1,defines.OPACITYFRESNEL=!1;var reflectionTexture=this._reflectionTexture;if(reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled){if(!reflectionTexture.isReadyOrNotBlocking())return!1;switch(defines.REFLECTION=!0,defines.GAMMAREFLECTION=reflectionTexture.gammaSpace,defines.REFLECTIONBLUR=this._reflectionBlur>0,defines.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!reflectionTexture.invertZ:reflectionTexture.invertZ,defines.LODINREFLECTIONALPHA=reflectionTexture.lodLevelInAlpha,reflectionTexture.coordinatesMode===BABYLON.Texture.INVCUBIC_MODE&&(defines.INVERTCUBICMAP=!0),defines.REFLECTIONMAP_3D=reflectionTexture.isCube,reflectionTexture.coordinatesMode){case BABYLON.Texture.CUBIC_MODE:case BABYLON.Texture.INVCUBIC_MODE:defines.REFLECTIONMAP_CUBIC=!0;break;case BABYLON.Texture.EXPLICIT_MODE:defines.REFLECTIONMAP_EXPLICIT=!0;break;case BABYLON.Texture.PLANAR_MODE:defines.REFLECTIONMAP_PLANAR=!0;break;case BABYLON.Texture.PROJECTION_MODE:defines.REFLECTIONMAP_PROJECTION=!0;break;case BABYLON.Texture.SKYBOX_MODE:defines.REFLECTIONMAP_SKYBOX=!0;break;case BABYLON.Texture.SPHERICAL_MODE:defines.REFLECTIONMAP_SPHERICAL=!0;break;case BABYLON.Texture.EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case BABYLON.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0}this.reflectionFresnel?(defines.REFLECTIONFRESNEL=!0,defines.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(defines.REFLECTIONFRESNEL=!1,defines.REFLECTIONFALLOFF=!1)}else defines.REFLECTION=!1,defines.REFLECTIONFALLOFF=!1,defines.REFLECTIONBLUR=!1,defines.REFLECTIONMAP_3D=!1,defines.REFLECTIONMAP_SPHERICAL=!1,defines.REFLECTIONMAP_PLANAR=!1,defines.REFLECTIONMAP_CUBIC=!1,defines.REFLECTIONMAP_PROJECTION=!1,defines.REFLECTIONMAP_SKYBOX=!1,defines.REFLECTIONMAP_EXPLICIT=!1,defines.REFLECTIONMAP_EQUIRECTANGULAR=!1,defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,defines.INVERTCUBICMAP=!1,defines.REFLECTIONMAP_OPPOSITEZ=!1,defines.LODINREFLECTIONALPHA=!1,defines.GAMMAREFLECTION=!1}defines.PREMULTIPLYALPHA=this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===BABYLON.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,defines.USERGBCOLOR=this._useRGBColor,defines.NOISE=this._enableNoise}if(defines._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(defines)}if(BABYLON.MaterialHelper.PrepareDefinesForMisc(mesh,scene,!1,this.pointsCloud,this.fogEnabled,defines),BABYLON.MaterialHelper.PrepareDefinesForFrameBoundValues(scene,engine,defines,useInstances,!1),BABYLON.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!1,!0,!1)&&mesh&&(scene.getEngine().getCaps().standardDerivatives||mesh.isVerticesDataPresent(BABYLON.VertexBuffer.NormalKind)||(mesh.createNormals(!0),BABYLON.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: "+mesh.name))),defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new BABYLON.EffectFallbacks;defines.FOG&&fallbacks.addFallback(0,"FOG"),defines.POINTSIZE&&fallbacks.addFallback(1,"POINTSIZE"),BABYLON.MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this._maxSimultaneousLights),defines.NUM_BONE_INFLUENCERS>0&&fallbacks.addCPUSkinningFallback(0,mesh);var attribs=[BABYLON.VertexBuffer.PositionKind];defines.NORMAL&&attribs.push(BABYLON.VertexBuffer.NormalKind),defines.UV1&&attribs.push(BABYLON.VertexBuffer.UVKind),defines.UV2&&attribs.push(BABYLON.VertexBuffer.UV2Kind),BABYLON.MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks),BABYLON.MaterialHelper.PrepareAttributesForInstances(attribs,defines);var uniforms=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","mBones","vPrimaryColor","vSecondaryColor","vTertiaryColor","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],samplers=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],uniformBuffers=["Material","Scene"];BABYLON.ImageProcessingConfiguration.PrepareUniforms(uniforms,defines),BABYLON.ImageProcessingConfiguration.PrepareSamplers(samplers,defines),BABYLON.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this._maxSimultaneousLights});var join=defines.toString();subMesh.setEffect(scene.getEngine().createEffect("background",{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:function(effect){_this.onCompiled&&_this.onCompiled(effect),_this.bindSceneUniformBuffer(effect,scene.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},engine),defines),this.buildUniformLayout()}return!(!subMesh.effect||!subMesh.effect.isReady())&&(defines._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},BackgroundMaterial.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vSecondaryColor",4),this._uniformBuffer.addUniform("vTertiaryColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},BackgroundMaterial.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),_super.prototype.unbind.call(this)},BackgroundMaterial.prototype.bindOnlyWorldMatrix=function(world){this._activeEffect.setMatrix("world",world)},BackgroundMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var scene=this.getScene(),defines=subMesh._materialDefines;if(defines){var effect=subMesh.effect;if(effect){this._activeEffect=effect,this.bindOnlyWorldMatrix(world),BABYLON.MaterialHelper.BindBonesParameters(mesh,this._activeEffect);var mustRebind=this._mustRebind(scene,effect,mesh.visibility);if(mustRebind){this._uniformBuffer.bindToEffect(effect,"Material"),this.bindViewProjection(effect);var reflectionTexture=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(scene.texturesEnabled&&(this._diffuseTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),BABYLON.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",reflectionTexture.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",reflectionTexture.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",reflectionTexture.getSize().width,reflectionTexture.lodGenerationScale,reflectionTexture.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,this._primaryLevel),this._uniformBuffer.updateColor4("vSecondaryColor",this._secondaryColor,this._secondaryLevel),this._uniformBuffer.updateColor4("vTertiaryColor",this._tertiaryColor,this._tertiaryLevel)),scene.texturesEnabled&&(this._diffuseTexture&&BABYLON.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),reflectionTexture&&BABYLON.StandardMaterial.ReflectionTextureEnabled&&(defines.REFLECTIONBLUR&&defines.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",reflectionTexture):defines.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",reflectionTexture._lodTextureMid||reflectionTexture),this._uniformBuffer.setTexture("reflectionSamplerLow",reflectionTexture._lodTextureLow||reflectionTexture),this._uniformBuffer.setTexture("reflectionSamplerHigh",reflectionTexture._lodTextureHigh||reflectionTexture)):this._uniformBuffer.setTexture("reflectionSampler",reflectionTexture),defines.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),BABYLON.MaterialHelper.BindClipPlane(this._activeEffect,scene),BABYLON.MaterialHelper.BindEyePosition(effect,scene)}!mustRebind&&this.isFrozen||(scene.lightsEnabled&&BABYLON.MaterialHelper.BindLights(scene,mesh,this._activeEffect,defines,this._maxSimultaneousLights,!1),this.bindView(effect),BABYLON.MaterialHelper.BindFogParameters(scene,mesh,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(mesh)}}},BackgroundMaterial.prototype.dispose=function(forceDisposeEffect,forceDisposeTextures){void 0===forceDisposeEffect&&(forceDisposeEffect=!1),void 0===forceDisposeTextures&&(forceDisposeTextures=!1),forceDisposeTextures&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),_super.prototype.dispose.call(this,forceDisposeEffect)},BackgroundMaterial.prototype.clone=function(name){var _this=this;return BABYLON.SerializationHelper.Clone(function(){return new BackgroundMaterial(name,_this.getScene())},this)},BackgroundMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.BackgroundMaterial",serializationObject},BackgroundMaterial.prototype.getClassName=function(){return"BackgroundMaterial"},BackgroundMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new BackgroundMaterial(source.name,scene)},source,scene,rootUrl)},BackgroundMaterial.standardReflectance0=.05,BackgroundMaterial.standardReflectance90=.5,__decorate([BABYLON.serializeAsColor3()],BackgroundMaterial.prototype,"_primaryColor",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"primaryColor",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_primaryLevel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"primaryLevel",void 0),__decorate([BABYLON.serializeAsColor3()],BackgroundMaterial.prototype,"_secondaryColor",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"secondaryColor",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_secondaryLevel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"secondaryLevel",void 0),__decorate([BABYLON.serializeAsColor3()],BackgroundMaterial.prototype,"_tertiaryColor",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"tertiaryColor",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_tertiaryLevel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsLightsDirty")],BackgroundMaterial.prototype,"tertiaryLevel",void 0),__decorate([BABYLON.serializeAsTexture()],BackgroundMaterial.prototype,"_reflectionTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionTexture",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionBlur",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionBlur",void 0),__decorate([BABYLON.serializeAsTexture()],BackgroundMaterial.prototype,"_diffuseTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"diffuseTexture",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"shadowLights",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_shadowBlurScale",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"shadowBlurScale",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_shadowLevel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"shadowLevel",void 0),__decorate([BABYLON.serializeAsVector3()],BackgroundMaterial.prototype,"_sceneCenter",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"sceneCenter",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_opacityFresnel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"opacityFresnel",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionFresnel",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionFresnel",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionFalloffDistance",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionFalloffDistance",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionAmount",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionAmount",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionReflectance0",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionReflectance0",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_reflectionReflectance90",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"reflectionReflectance90",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_useRGBColor",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"useRGBColor",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_enableNoise",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"enableNoise",void 0),__decorate([BABYLON.serialize()],BackgroundMaterial.prototype,"_maxSimultaneousLights",void 0),__decorate([BABYLON.expandToProperty("_markAllSubMeshesAsTexturesDirty")],BackgroundMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([BABYLON.serializeAsImageProcessingConfiguration()],BackgroundMaterial.prototype,"_imageProcessingConfiguration",void 0),BackgroundMaterial}(BABYLON.PushMaterial);BABYLON.BackgroundMaterial=BackgroundMaterial}(BABYLON||(BABYLON={}));var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};!function(BABYLON){var EnvironmentHelper=function(){function EnvironmentHelper(options,scene){this._options=__assign({},EnvironmentHelper._getDefaultOptions(),options),this._scene=scene,this._setupBackground(),this._setupImageProcessing()}return EnvironmentHelper._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new BABYLON.Color3(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:BABYLON.Engine.TEXTURETYPE_UNSIGNED_INT,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new BABYLON.Color3(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:BABYLON.Vector3.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(EnvironmentHelper.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(EnvironmentHelper.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),EnvironmentHelper.prototype.updateOptions=function(options){var newOptions=__assign({},this._options,options);this._ground&&!newOptions.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!newOptions.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._options.groundTexture&&!newOptions.groundTexture&&this._groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!newOptions.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!newOptions.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._options.skyboxTexture&&!newOptions.skyboxTexture&&this._skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!newOptions.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._options.environmentTexture&&!newOptions.environmentTexture&&this._scene.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=newOptions,this._setupBackground(),this._setupImageProcessing()},EnvironmentHelper.prototype.setMainColor=function(color){this.groundMaterial&&(this.groundMaterial.primaryColor=color),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=color),this.groundMirror&&(this.groundMirror.clearColor=new BABYLON.Color4(color.r,color.g,color.b,1))},EnvironmentHelper.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},EnvironmentHelper.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof BABYLON.BaseTexture)this._scene.environmentTexture=this._options.environmentTexture;else{var environmentTexture=BABYLON.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=environmentTexture}},EnvironmentHelper.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new BABYLON.Mesh("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var sceneSize=this._getSceneSize();this._options.createGround&&(this._setupGround(sceneSize),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(sceneSize),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(sceneSize),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=sceneSize.rootPosition.x,this._rootMesh.position.z=sceneSize.rootPosition.z,this._rootMesh.position.y=sceneSize.rootPosition.y},EnvironmentHelper.prototype._getSceneSize=function(){var groundSize=this._options.groundSize,skyboxSize=this._options.skyboxSize,rootPosition=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:groundSize,skyboxSize:skyboxSize,rootPosition:rootPosition};var sceneExtends=this._scene.getWorldExtends(),sceneDiagonal=sceneExtends.max.subtract(sceneExtends.min),bias=1e-4;if(this._options.sizeAuto){this._scene.activeCamera instanceof BABYLON.ArcRotateCamera&&this._scene.activeCamera.upperRadiusLimit&&(groundSize=2*this._scene.activeCamera.upperRadiusLimit),this._scene.activeCamera&&(bias=(this._scene.activeCamera.maxZ-this._scene.activeCamera.minZ)/1e4);var sceneDiagonalLenght=sceneDiagonal.length();sceneDiagonalLenght>groundSize&&(groundSize=2*sceneDiagonalLenght),groundSize*=1.1,skyboxSize*=1.5,(rootPosition=sceneExtends.min.add(sceneDiagonal.scale(.5))).y=sceneExtends.min.y-bias}return{groundSize:groundSize,skyboxSize:skyboxSize,rootPosition:rootPosition}},EnvironmentHelper.prototype._setupGround=function(sceneSize){var _this=this;this._ground||(this._ground=BABYLON.Mesh.CreatePlane("BackgroundPlane",sceneSize.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){_this._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},EnvironmentHelper.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new BABYLON.BackgroundMaterial("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=BABYLON.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryLevel=1,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.secondaryLevel=0,this._groundMaterial.tertiaryLevel=0,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},EnvironmentHelper.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof BABYLON.BaseTexture)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var diffuseTexture=new BABYLON.Texture(this._options.groundTexture,this._scene);diffuseTexture.gammaSpace=!1,diffuseTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=diffuseTexture}},EnvironmentHelper.prototype._setupGroundMirrorTexture=function(sceneSize){var wrapping=BABYLON.Texture.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new BABYLON.MirrorTexture("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,BABYLON.Texture.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new BABYLON.Plane(0,-1,0,sceneSize.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=wrapping,this._groundMirror.wrapV=wrapping,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var i=0;i<this._scene.meshes.length;i++){var mesh=this._scene.meshes[i];mesh!==this._ground&&mesh!==this._skybox&&mesh!==this._rootMesh&&this._groundMirror.renderList.push(mesh)}this._groundMirror.clearColor=new BABYLON.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},EnvironmentHelper.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},EnvironmentHelper.prototype._setupSkybox=function(sceneSize){var _this=this;this._skybox||(this._skybox=BABYLON.Mesh.CreateBox("BackgroundSkybox",sceneSize.skyboxSize,this._scene,void 0,BABYLON.Mesh.BACKSIDE),this._skybox.onDisposeObservable.add(function(){_this._skybox=null})),this._skybox.parent=this._rootMesh},EnvironmentHelper.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new BABYLON.BackgroundMaterial("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryLevel=1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.secondaryLevel=0,this._skyboxMaterial.tertiaryLevel=0,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},EnvironmentHelper.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof BABYLON.BaseTexture?this._skyboxMaterial.reflectionTexture=this._skyboxTexture:(this._skyboxTexture=new BABYLON.CubeTexture(this._options.skyboxTexture,this._scene),this._skyboxTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},EnvironmentHelper.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},EnvironmentHelper._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",EnvironmentHelper._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",EnvironmentHelper._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.dds",EnvironmentHelper}();BABYLON.EnvironmentHelper=EnvironmentHelper}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={defaultVertexShader:"#include<__decl__defaultVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",defaultPixelShader:"#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY \n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\ngl_FragColor=color;\n}",pbrVertexShader:"precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif \n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif \n#if defined(ALBEDO) && ALBEDODIRECTUV == 0 \nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 \nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0 \nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 \nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 \nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 \nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0 \nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",pbrPixelShader:"#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2;\n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<=ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<=ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n#ifdef REFRACTION\nvec3 environmentRefraction=vec3(0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD).rgb;\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec3 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords).rgb;\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords).rgb,\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords).rgb,\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec3 environmentRadiance=vec3(0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD).rgb;\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec3 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords).rgb;\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords).rgb,\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords).rgb,\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance*=vReflectionInfos.x;\nenvironmentRadiance*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\nlightingInfo info;\nfloat shadow=1.; \nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(reflectionCoords,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction;\nfinalRefraction*=refractance;\n#endif\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n\n\n\nvec4 finalColor=vec4(finalDiffuse*ambientOcclusionColor*vLightingIntensity.x +\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}",spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\nattribute float cellIndex;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec3 particlesInfos; \n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",gpuRenderParticlesVertexShader:"#version 300 es\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 velocity;\nvoid main() {\ngl_PointSize=1.0;\ngl_Position=vec4(position,1.0);\n}",gpuRenderParticlesPixelShader:"void main() {\ngl_FragColor=vec4(1.0);\n}\n",gpuUpdateParticlesVertexShader:"#version 300 es\nuniform float timeDelta;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 velocity;\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec3 outVelocity;\nvoid main() {\nif (age>=life) {\n\noutPosition=vec3(0,0,0);\n\noutAge=0.0;\noutLife=life;\n\noutVelocity=vec3(0,1,0);\n} else {\noutPosition=position+velocity*timeDelta;\noutAge=age+timeDelta;\noutLife=life;\noutVelocity=velocity;\n}\n}",gpuUpdateParticlesPixelShader:"#version 300 es\nvoid main() {\ndiscard;\n}\n",colorVertexShader:"\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 viewProjection;\nuniform mat4 world;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}",colorPixelShader:"#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\nvoid main(void) {\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",shadowMapPixelShader:"#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec2 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.y*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n",ssao2PixelShader:"\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=abs(texture2D(textureSampler,vUV).r);\nvec3 normal=texture2D(normalSampler,vUV).rgb; \nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,1.0);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nif (depth>maxZ) {\ngl_FragColor=vec4(1.0,1.0,1.0,1.0);\nreturn;\n}\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=tbn*sampleSphere[i];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\nfloat rangeCheck=abs(depth-sampleDepth)<correctedRadius ? 1.0 : 0.0;\ndifference=samplePosition.z-sampleDepth;\n\nocclusion+=(difference>=1e-5 ? 1.0 : 0.0)*rangeCheck;\n}\n\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",standardPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n",fxaaVertexShader:"\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}",fxaaPixelShader:"uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\nreturn;\n}\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan) \n{\nlumaS=lumaE;\n}\nif (horzSpan) \n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan) \n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN) \n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) \n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN) \n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP) \n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan) \n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}",geometryVertexShader:"precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nvarying vec2 uv;\n#endif\n#ifdef UV2\nvarying vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",geometryPixelShader:"#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef POSITION\n#include<mrtFragmentDeclaration>[3]\n#else\n#include<mrtFragmentDeclaration>[2]\n#endif\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[2]=vec4(vPosition,1.0);\n#endif\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void) \n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11)); \nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",highlightsPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void) \n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a); \n}",imageProcessingPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}",kernelBlurVertexShader:"\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}",kernelBlurPixelShader:"\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\n#ifdef PACKEDFLOAT \nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}",glowBlurPostProcessPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",glowMapGenerationPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive);\n#else\ngl_FragColor=color;\n#endif\n}",glowMapGenerationVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",glowMapMergePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\nbaseColor.a=abs(offset-baseColor.a);\ngl_FragColor=baseColor;\n}",glowMapMergeVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",outlinePixelShader:"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",backgroundVertexShader:"precision highp float;\n#include<__decl__backgroundVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0 \nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",backgroundPixelShader:"#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2; \n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec3 reflectionColor=vec3(1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD).rgb;\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD,0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec3 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords).rgb;\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords).rgb,\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords).rgb,\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample.rgb;\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor=toLinearSpace(reflectionColor.rgb);\n#endif\n\nreflectionColor*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\nvec3 finalColor=colorBase.r*vPrimaryColor.rgb*vPrimaryColor.a;\nfinalColor+=colorBase.g*vSecondaryColor.rgb*vSecondaryColor.a;\nfinalColor+=colorBase.b*vTertiaryColor.rgb*vTertiaryColor.a;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(clamp(VdotN,0.0,1.0),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-clamp(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w,0.0,1.0);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor,clamp(reflectionAmount,0.,1.));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=clamp(viewAngleToFloor/startAngle,0.0,1.0);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb=dither(vPositionW.xy,color.rgb);\n#endif\ngl_FragColor=color;\n}"},BABYLON.Effect.IncludesShadersStore={depthPrePass:"#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif",bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",bumpVertexDeclaration:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying vec3 vFogDistance;\n#endif",morphTargetsVertexGlobalDeclaration:"#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif",morphTargetsVertexDeclaration:"#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",morphTargetsVertex:"#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpVertex:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",fogVertex:"#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",helperFunctions:"const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nvec3 applyEaseInOut(vec3 x){\nreturn x*x*(3.0-2.0*x);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nvec3 dither(vec2 seed,vec3 color) {\nfloat rand=getRand(seed);\ncolor.rgb+=mix(-0.5/255.0,0.5/255.0,rand);\nreturn color;\n}",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform sampler2D shadowSampler{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",lightUboDeclaration:"#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\n#endif\n#ifdef HEMILIGHT{X}\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform sampler2D shadowSampler{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif",defaultVertexDeclaration:"\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",defaultFragmentDeclaration:"uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_SKYBOX\n#else\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",defaultUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor; \nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix; \nvec4 vTangentSpaceParams;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nfloat pointSize; \n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",shadowsFragmentFunctions:"#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#endif\n",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",imageProcessingDeclaration:"#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif",imageProcessingFunctions:"#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=clamp(result.rgb,0.0,1.0);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=applyEaseInOut(result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}",bumpFragmentFunctions:"#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=vTangentSpaceParams.x;\nbitangent*=vTangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",bumpFragment:"vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else \nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif",lightFragment:"#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#else\n#ifdef SHADOWESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#else \n#ifdef SHADOWPCF{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPCFCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",pbrVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n",pbrFragmentDeclaration:"uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif",pbrUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec3 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec4 vRefractionInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 refractionMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nvec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);\nreturn fresnel*specTerm;\n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel*NdotL/PI;\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n\n\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=clamp(reflectance0*25.0,0.0,1.0);\nreturn reflectance90;\n}\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);\n}\nfloat environmentHorizonOcclusion(vec3 reflection,vec3 normal) {\n\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflection.z*=-1.0;\n#endif\nfloat temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);\nreturn square(temp);\n}",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){\nvec3 T=cross(Q.xyz,V);\nT+=Q.www*V;\nreturn cross(Q.xyz,T)+V;\n}\nvec3 environmentIrradianceJones(vec3 normal)\n{\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+directionToLightCenterW);\nNdotL=clamp(dot(vNormal,directionToLightCenterW),0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nNdotL=clamp(NdotL,0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}",mrtFragmentDeclaration:"#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",bones300Declaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nin vec4 matricesIndices;\nin vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nin vec4 matricesIndicesExtra;\nin vec4 matricesWeightsExtra;\n#endif\n#endif",instances300Declaration:"#ifdef INSTANCES\nin vec4 world0;\nin vec4 world1;\nin vec4 world2;\nin vec4 world3;\n#else\nuniform mat4 world;\n#endif",kernelBlurFragment:"#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*KERNEL_WEIGHT{X};\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*KERNEL_WEIGHT{X};\n#endif",kernelBlurFragment2:"#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*KERNEL_DEP_WEIGHT{X};\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*KERNEL_DEP_WEIGHT{X};\n#endif",kernelBlurVaryingDeclaration:"varying vec2 sampleCoord{X};",kernelBlurVertex:"sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",backgroundVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",backgroundFragmentDeclaration:" uniform vec4 vPrimaryColor;\nuniform vec4 vSecondaryColor;\nuniform vec4 vTertiaryColor;\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",backgroundUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vSecondaryColor;\nuniform vec4 vTertiaryColor;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"},function(root,factory){var f=factory();root&&root.BABYLON||(("undefined"!=typeof global?global:"undefined"!=typeof window?window:this).BABYLON=f,"object"==typeof exports&&"object"==typeof module?module.exports=f:"function"==typeof define&&define.amd?define(["BABYLON"],factory):"object"==typeof exports?exports.BABYLON=f:root.BABYLON=f)}(this,function(){return BABYLON});var BABYLON,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r};!function(BABYLON){var SkyMaterialDefines=function(_super){function SkyMaterialDefines(){var _this=_super.call(this)||this;return _this.CLIPPLANE=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.VERTEXCOLOR=!1,_this.VERTEXALPHA=!1,_this.rebuild(),_this}return __extends(SkyMaterialDefines,_super),SkyMaterialDefines}(BABYLON.MaterialDefines),SkyMaterial=function(_super){function SkyMaterial(name,scene){var _this=_super.call(this,name,scene)||this;return _this.luminance=1,_this.turbidity=10,_this.rayleigh=2,_this.mieCoefficient=.005,_this.mieDirectionalG=.8,_this.distance=500,_this.inclination=.49,_this.azimuth=.25,_this.sunPosition=new BABYLON.Vector3(0,100,0),_this.useSunPosition=!1,_this._cameraPosition=BABYLON.Vector3.Zero(),_this}return __extends(SkyMaterial,_super),SkyMaterial.prototype.needAlphaBlending=function(){return this.alpha<1},SkyMaterial.prototype.needAlphaTesting=function(){return!1},SkyMaterial.prototype.getAlphaTestTexture=function(){return null},SkyMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){if(this.isFrozen&&this._wasPreviouslyReady&&subMesh.effect)return!0;subMesh._materialDefines||(subMesh._materialDefines=new SkyMaterialDefines);var defines=subMesh._materialDefines,scene=this.getScene();if(!this.checkReadyOnEveryCall&&subMesh.effect&&this._renderId===scene.getRenderId())return!0;if(BABYLON.MaterialHelper.PrepareDefinesForMisc(mesh,scene,!1,this.pointsCloud,this.fogEnabled,defines),BABYLON.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!0,!1),defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new BABYLON.EffectFallbacks;defines.FOG&&fallbacks.addFallback(1,"FOG");var attribs=[BABYLON.VertexBuffer.PositionKind];defines.VERTEXCOLOR&&attribs.push(BABYLON.VertexBuffer.ColorKind);var join=defines.toString();subMesh.setEffect(scene.getEngine().createEffect("sky",attribs,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition"],[],join,fallbacks,this.onCompiled,this.onError),defines)}return!(!subMesh.effect||!subMesh.effect.isReady())&&(this._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},SkyMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var scene=this.getScene();if(subMesh._materialDefines){var effect=subMesh.effect;if(effect){if(this._activeEffect=effect,this.bindOnlyWorldMatrix(world),this._activeEffect.setMatrix("viewProjection",scene.getTransformMatrix()),this._mustRebind(scene,effect)){if(scene.clipPlane){var clipPlane=scene.clipPlane;this._activeEffect.setFloat4("vClipPlane",clipPlane.normal.x,clipPlane.normal.y,clipPlane.normal.z,clipPlane.d)}this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)}scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==BABYLON.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",scene.getViewMatrix()),BABYLON.MaterialHelper.BindFogParameters(scene,mesh,this._activeEffect);var camera=scene.activeCamera;if(camera){var cameraWorldMatrix=camera.getWorldMatrix();this._cameraPosition.x=cameraWorldMatrix.m[12],this._cameraPosition.y=cameraWorldMatrix.m[13],this._cameraPosition.z=cameraWorldMatrix.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var theta=Math.PI*(this.inclination-.5),phi=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(phi),this.sunPosition.y=this.distance*Math.sin(phi)*Math.sin(theta),this.sunPosition.z=this.distance*Math.sin(phi)*Math.cos(theta)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(mesh,this._activeEffect)}}},SkyMaterial.prototype.getAnimatables=function(){return[]},SkyMaterial.prototype.dispose=function(forceDisposeEffect){_super.prototype.dispose.call(this,forceDisposeEffect)},SkyMaterial.prototype.clone=function(name){var _this=this;return BABYLON.SerializationHelper.Clone(function(){return new SkyMaterial(name,_this.getScene())},this)},SkyMaterial.prototype.serialize=function(){var serializationObject=BABYLON.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.SkyMaterial",serializationObject},SkyMaterial.prototype.getClassName=function(){return"SkyMaterial"},SkyMaterial.Parse=function(source,scene,rootUrl){return BABYLON.SerializationHelper.Parse(function(){return new SkyMaterial(source.name,scene)},source,scene,rootUrl)},__decorate([BABYLON.serialize()],SkyMaterial.prototype,"luminance",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"turbidity",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"rayleigh",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"mieCoefficient",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"mieDirectionalG",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"distance",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"inclination",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"azimuth",void 0),__decorate([BABYLON.serializeAsVector3()],SkyMaterial.prototype,"sunPosition",void 0),__decorate([BABYLON.serialize()],SkyMaterial.prototype,"useSunPosition",void 0),SkyMaterial}(BABYLON.PushMaterial);BABYLON.SkyMaterial=SkyMaterial}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore.skyVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",BABYLON.Effect.ShadersStore.skyPixelShader="precision highp float;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\nuniform vec3 cameraPosition;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n\n#include<fogFragmentDeclaration>\n\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst vec3 up=vec3(0.0,1.0,0.0);\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\n\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0); \ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n\n\n\nvec3 retColor=curr*whiteScale;\n\n\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var Items=[{id:1001,name:"Ball Cap",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ballCap"},is_available:!0},{id:1002,name:"Boat Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boatHat"},is_available:!0},{id:1003,name:"Top Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_topHat"},is_available:!0},{id:1004,name:"Derby Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_derby"},is_available:!0},{id:1005,name:"Mountie Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mounty"},is_available:!0},{id:1006,name:"Sheriff Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowSheriff"},is_available:!0},{id:1007,name:"Blue Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaBlue"},is_available:!0},{id:1008,name:"Hero Mask",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batman"},is_available:!0},{id:1009,name:"Cop Hat",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cop"},is_available:!0},{id:1010,name:"Bad Egg 2",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg2"},is_available:!0},{id:1011,name:"Red Bandana",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaRed"},is_available:!0},{id:1012,name:"Pink Bow",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bowPink"},is_available:!0},{id:1013,name:"Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glasses"},is_available:!0},{id:1014,name:"Pompadour",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pompadour"},is_available:!0},{id:1015,name:"Plague Doctor Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_plagueDoctor"},is_available:!0},{id:1016,name:"Poop",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_poop"},is_available:!0},{id:1017,name:"Unicorn",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_unicorn"},is_available:!0},{id:1018,name:"Pimp",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pimp"},is_available:!0},{id:1019,name:"Pirate Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pirateHat"},is_available:!0},{id:1023,name:"Happy Gun Bear Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hunting"},is_available:!0},{id:1024,name:"Happy Gun Bear Hunting Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_huntingBear"},is_available:!0},{id:1025,name:"Crown",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crown"},is_available:!0},{id:1020,name:"ShellShockers Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shellshockers",unlock:"physical",physicalUnlockText:"Buy a REAL HAT to unlock this lid!",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/splat-hat"},is_available:!0},{id:1021,name:"Frying Pan",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fryingPan",unlock:"physical",physicalUnlockText:"Buy a REAL SHIRT to get this pan!",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/no-pans-tee"},is_available:!0},{id:1022,name:"Horns",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_horns",unlock:"physical",physicalUnlockText:"Buy a REAL SHIRT to rock these horns!",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/logo-tee"},is_available:!0},{id:1026,name:"Jack O' Lantern Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkin",tags:["Halloween"]},is_available:!0},{id:1027,name:"Bat Wings",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batWings",tags:["Halloween"]},is_available:!0},{id:1028,name:"Witch Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_witch",tags:["Halloween"]},is_available:!0},{id:1029,name:"Axe in Shell",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_axe",tags:["Halloween"]},is_available:!0},{id:1030,name:"Executioner's Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_executioner",tags:["Halloween"]},is_available:!0},{id:1031,name:"Devil Horns",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_devilHorns",tags:["Halloween"]},is_available:!0},{id:1032,name:"Angel Wings and Halo",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angel",tags:["Halloween"]},is_available:!0},{id:1033,name:"Hockey Mask",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hockeyMask",tags:["Halloween"]},is_available:!0},{id:2001,name:"Target",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:0},is_available:!0},{id:2002,name:"No Sign",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:0},is_available:!0},{id:2003,name:"Question Mark",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:0},is_available:!0},{id:2004,name:"Peace",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:0},is_available:!0},{id:2005,name:"Thumbs Up",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:0},is_available:!0},{id:2006,name:"Smiley",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:0},is_available:!0},{id:2007,name:"Skull & Crossbones",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:2},is_available:!0},{id:2008,name:"Tyrant",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:3},is_available:!0},{id:2009,name:"Shifty Eye",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:5},is_available:!0},{id:2010,name:"Arrow and Heart",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:6},is_available:!0},{id:2011,name:"Grade A Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:1},is_available:!0},{id:2012,name:"Anarchy Sign",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:1},is_available:!0},{id:2013,name:"Derp Face",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:2},is_available:!0},{id:2014,name:"Wolf",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:5},is_available:!0},{id:2015,name:"Chicken",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:6},is_available:!0},{id:2016,name:"Phoenix",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:7},is_available:!0},{id:2017,name:"Alien",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:7},is_available:!0},{id:2018,name:"Mustache",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:5},is_available:!0},{id:2019,name:"Happy Gun Bear",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:8},is_available:!0},{id:2020,name:"Ghost Face",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:8,tags:["Halloween"]},is_available:!0},{id:2021,name:"Jack Face",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:8,tags:["Halloween"]},is_available:!0},{id:2022,name:"Cracks",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:9,tags:["Halloween"]},is_available:!0},{id:2023,name:"Bat Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:9,tags:["Halloween"]},is_available:!0},{id:2024,name:"Cthulhu Fhtagn",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:9,tags:["Halloween"]},is_available:!0},{id:2025,name:"Elder Sign",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:9,tags:["Halloween"]},is_available:!0},{id:2026,name:"Scary Teeth",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:9,tags:["Halloween"]},is_available:!0},{id:2027,name:"Monster Tongue",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:9,tags:["Halloween"]},is_available:!0},{id:2028,name:"Spooky Lady",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:9,tags:["Halloween"]},is_available:!0},{id:2029,name:"Clown Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:10,tags:["Halloween"]},is_available:!0},{id:2030,name:"Stitch Face",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:10,tags:["Halloween"]},is_available:!0},{id:2031,name:"Devil Face",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:10,tags:["Halloween"]},is_available:!0},{id:2032,name:"Face Mask",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:10,tags:["Halloween"]},is_available:!0},{id:3100,name:"Eggk47",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{class:Eggk47,meshName:"gun_eggk47"},is_available:!0},{id:3101,name:"Eggk47 GOLD",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{class:Eggk47,meshName:"gun_eggk47_Gold"},is_available:!0},{id:3102,name:"Happy Gun Bear Eggk47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{class:Eggk47,meshName:"gun_eggk47_Bear"},is_available:!0},{id:3103,name:"Eggk47 Halloween",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{class:Eggk47,meshName:"gun_eggk47_Halloween",tags:["Halloween"]},is_available:!0},{id:3400,name:"CSG1",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{class:CSG1,meshName:"gun_csg1"},is_available:!0},{id:3401,name:"CSG1 GOLD",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{class:CSG1,meshName:"gun_csg1_Gold"},is_available:!0},{id:3402,name:"Happy Gun Bear CSG1",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{class:CSG1,meshName:"gun_csg1_Bear"},is_available:!0},{id:3403,name:"CSG1 Halloween",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{class:CSG1,meshName:"gun_csg1_Halloween",tags:["Halloween"]},is_available:!0},{id:3600,name:"Dozen Gauge",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{class:DozenGauge,meshName:"gun_dozenGauge"},is_available:!0},{id:3601,name:"Dozen Gauge GOLD",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{class:DozenGauge,meshName:"gun_dozenGauge_Gold"},is_available:!0},{id:3602,name:"Happy Gun Bear Dozen Gauge",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{class:DozenGauge,meshName:"gun_dozenGauge_Bear"},is_available:!0},{id:3603,name:"Dozen Gauge Halloween",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{class:DozenGauge,meshName:"gun_dozenGauge_Halloween",tags:["Halloween"]},is_available:!0},{id:3e3,name:"Cluck 9mm",price:0,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{class:Cluck9mm,meshName:"gun_cluck9mm"},is_available:!0},{id:3001,name:"Cluck 9mm GOLD",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{class:Cluck9mm,meshName:"gun_cluck9mm_Gold"},is_available:!0},{id:3002,name:"Happy Gun Bear Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{class:Cluck9mm,meshName:"gun_cluck9mm_Bear"},is_available:!0},{id:3003,name:"Cluck 9mm Halloween",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{class:Cluck9mm,meshName:"gun_cluck9mm_Halloween",tags:["Halloween"]},is_available:!0}];Bullet.prototype.remove=function(){munitionsManager.bulletPool.recycle(this),this.actor&&this.actor.remove()},Bullet.prototype.update=function(delta){this.ttl<=0||munitionsManager.projectileCollidesWithMap(this,this.collidesWithMapCallback)?this.remove():(this.x+=this.dx*delta,this.y+=this.dy*delta,this.z+=this.dz*delta,this.ttl-=delta,this.actor&&this.actor.update())},Bullet.prototype.fire=function(player,pos,dir,dmg,ttl,speed){this.player=player,this.x=pos.x,this.y=pos.y,this.z=pos.z,this.dx=dir.x*speed,this.dy=dir.y*speed,this.dz=dir.z*speed,this.ttl=ttl,this.damage=dmg,this.active=!0,this.actor&&this.actor.fire()},Bullet.prototype.collidesWithMapCallback=function(x,y,z){bulletHoleManager.addHole(0,x,y,z)};var Slot={Primary:0,Secondary:1},ItemType={Hat:1,Stamp:2,Primary:3,Secondary:4};catalog=new function(){if(void 0===Items||null===Items)throw"Items is undefined or null, cannot create Catalog";this.isSetup=!1,this.filterItems=function(itemList,filterFunc){for(var filteredItems=[],i=0;i<itemList.length;i++)filterFunc(itemList[i])&&filteredItems.push(itemList[i]);return filteredItems},this.findItemInListById=function(itemId,itemList){for(var i=0;i<itemList.length;i++)if(itemList[i]&&itemList[i].id===itemId)return itemList[i];return null},this.findItemById=function(itemId){return this.findItemInListById(itemId,Items)},this.findItemBy8BitItemId=function(itemType,classIdx,itemId8Bit){!1===this.isSetup&&this.setupCatalog();var realItemId=itemId8Bit;switch(itemType){case ItemType.Hat:return 0===itemId8Bit?null:(realItemId+=999,this.findItemInListById(realItemId,this.hats));case ItemType.Stamp:return 0===itemId8Bit?null:(realItemId+=1999,this.findItemInListById(realItemId,this.stamps));case ItemType.Primary:switch(realItemId+=3e3,classIdx){case Class.Soldier:realItemId+=100;break;case Class.Scrambler:realItemId+=600;break;case Class.Ranger:realItemId+=400}try{(void 0===this.forClass||null===this.forClass||this.forClass.length<=2)&&(console.log("catalog.forClass is not initialized properly: "+JSON.stringify(forClass)),console.log("itemType: "+itemType),console.log("classIdx: "+classIdx),console.log("itemId8Bit: "+itemId8Bit)),(void 0===classIdx||null===classIdx||classIdx<0||classIdx>2)&&(console.log("classIdx is invalid: "+classIdx),console.log("itemType: "+itemType),console.log("itemId8Bit: "+itemId8Bit))}catch(err){console.log("I heard you like errors so I put an error in your error: "+err.message)}return this.findItemInListById(realItemId,this.forClass[classIdx].forWeaponSlot[Slot.Primary]);case ItemType.Secondary:return realItemId+=3e3,this.findItemInListById(realItemId,this.forClass[classIdx].forWeaponSlot[Slot.Secondary])}},this.get8BitItemId=function(item,classIdx){if(null===item)return 0;!1===this.isSetup&&this.setupCatalog();var itemId8Bit=item.id;switch(item.item_type_id){case ItemType.Hat:itemId8Bit-=999;break;case ItemType.Stamp:itemId8Bit-=1999;break;case ItemType.Primary:switch(itemId8Bit-=3e3,classIdx){case Class.Soldier:itemId8Bit-=100;break;case Class.Scrambler:itemId8Bit-=600;break;case Class.Ranger:itemId8Bit-=400}break;case ItemType.Secondary:itemId8Bit-=3e3}return itemId8Bit},this.addWeaponFunctions=function(weaponItem){weaponItem.instantiateNew=function(avatar){var instance=new this.item_data.class(avatar,this.item_data.meshName);return avatar.actor&&avatar.actor.setWeaponSkeleton(instance.actor.skeleton),instance}},this.getTaggedItems=function(tag){return this.filterItems(Items,function(item){if(void 0!==item.item_data.tags&&null!==item.item_data.tags&&item.item_data.tags.length>0)for(var i=0;i<item.item_data.tags.length;i++)if(item.item_data.tags[i]===tag)return!0;return!1})},this.setupCatalog=function(){this.hats=[],this.stamps=[],this.primaryWeapons=[],this.secondaryWeapons=[],this.forClass=[];for(var i=0;i<Items.length;i++)switch(Items[i].item_type_id){case ItemType.Hat:this.hats.push(Items[i]);break;case ItemType.Stamp:this.stamps.push(Items[i]);break;case ItemType.Primary:this.primaryWeapons.push(Items[i]),this.addWeaponFunctions(Items[i]);break;case ItemType.Secondary:this.secondaryWeapons.push(Items[i]),this.addWeaponFunctions(Items[i])}for(var cIdx=0;cIdx<3;cIdx++){var isFreeSharedFunc=function(item){return 0===item.price&&null===item.exclusive_for_class},isFreeClassExclusiveFunc=function(item){return 0===item.price&&item.exclusive_for_class===cIdx},isPaidSharedFunc=function(item){return item.price>0&&null===item.exclusive_for_class},isPaidClassExclusiveFunc=function(item){return item.price>0&&item.exclusive_for_class===cIdx},outer=this,createClassWeaponListFunc=function(itemList){return itemList=outer.filterItems(itemList,isFreeSharedFunc).concat(outer.filterItems(itemList,isFreeClassExclusiveFunc)).concat(outer.filterItems(itemList,isPaidSharedFunc)).concat(outer.filterItems(itemList,isPaidClassExclusiveFunc))},classItems={primaryWeapons:createClassWeaponListFunc(this.primaryWeapons),secondaryWeapons:createClassWeaponListFunc(this.secondaryWeapons)};classItems.forWeaponSlot=[classItems.primaryWeapons,classItems.secondaryWeapons],this.forClass.push(classItems)}this.isSetup=!0},!1===this.isSetup&&this.setupCatalog()},Collider.prototype.playerCollidesWithMap=function(player){return this.meshCollidesWithMap(this.playerCollisionMesh,player)},Collider.prototype.meshCollidesWithMap=function(mesh,pos){for(var cellsChecked={},bbox=mesh.getBoundingInfo().boundingBox,i=0;i<bbox.vectors.length;i++){var cx=Math.floor(pos.x+bbox.vectors[i].x),cy=Math.floor(pos.y+bbox.vectors[i].y),cz=Math.floor(pos.z+bbox.vectors[i].z);if(cx<0||cx>=map.width||cz<0||cz>=map.depth||cy<0)return!0;var checkId=cx+1e3*cy+1e4*cz;if(cy<map.height&&!cellsChecked[checkId]){var res=this.meshCollidesWithCell(mesh,pos,cx,cy,cz);if(res)return res;cellsChecked[checkId]=!0}}return!1},Collider.prototype.meshCollidesWithCell=function(mesh,pos,cx,cy,cz){var cell=map.data[cx][cy][cz];if(cell.idx){var mapMesh=mapMeshes[cell.idx];switch(mapMesh.colliderType){case"full":return{x:cx,y:cy,z:cz,cell:cell};case"none":break;default:switch(mesh.position.x=pos.x-cx-.5,mesh.position.y=pos.y-cy-.5,mesh.position.z=pos.z-cz-.5,mesh.setPivotPoint(new BABYLON.Vector3(-mesh.position.x,-mesh.position.y,-mesh.position.z)),mesh.rotation.x=-cell.rx*Math.PI90,mesh.rotation.y=-cell.ry*Math.PI90,mesh.rotation.z=-cell.rz*Math.PI90,mesh.computeWorldMatrix(),mapMesh.colliderType){case"wedge":if(this.wedgeCollisionMesh.intersectsMesh(mesh,!0))return{x:cx,y:cy,z:cz,cell:cell};break;case"iwedge":if(this.iwedgeCollisionMesh.intersectsMesh(mesh,!0))return{x:cx,y:cy,z:cz,cell:cell};break;case"ladder":if("pc"!=mesh.name)break;case"aabb":if(mapMesh.colliderMesh.intersectsMesh(mesh,!1,!0))return{x:cx,y:cy,z:cz,cell:cell};break;case"obb":if(mapMesh.colliderMesh.intersectsMesh(mesh,!0,!0))return{x:cx,y:cy,z:cz,cell:cell}}}}return!1},Collider.prototype.projectileCollidesWithMap=function(pos,direction){pos.subtract(direction);for(var cells=[{x:pos.x,y:pos.y,z:pos.z}],cellsChecked={},i=0;i<cells.length;i++){var cx=Math.floor(cells[i].x),cy=Math.floor(cells[i].y),cz=Math.floor(cells[i].z);if(cx<0||cx>=map.width||cz<0||cz>=map.depth||cy<0)return!1;var checkId=cx+1e3*cy+1e4*cz;if(cy<map.height&&!cellsChecked[checkId]){cellsChecked[checkId]=!0;var res=this.meshCollidesWithCell(this.projectileCollisionBox,pos,cx,cy,cz);if(res&&"verysoft"!=mapMeshes[res.cell.idx].softness)return res}}return!1};var CloseCode={gameNotFound:4e3,gameFull:4001,badName:4002,mainMenu:4003,noMasterServer:4004},CommCode={gameJoined:0,addPlayer:1,removePlayer:2,chat:3,controlKeys:4,keyUp:5,sync:6,fire:7,jump:8,die:9,hitThem:10,hitMe:11,collectItem:12,spawnItem:13,respawn:14,startReload:15,reload:16,swapWeapon:17,fire:18,fireShot:19,joinGame:20,ping:21,pong:22,clientReady:23,requestRespawn:24,throwGrenade:25,joinPublicGame:26,joinPrivateGame:27,createPrivateGame:28,roundStart:29,switchTeam:30,firePrecise:31,notification:32,changeCharacter:33,playerCount:34,roundEnd:35,pause:36,announcement:37,updateBalance:38,info:255},GameType={ffa:0,teams:1},GameTypes=[{shortName:"FFA",longName:"Free For All"},{shortName:"Teams",longName:"Teams"}],FramesBetweenSyncs=Math.ceil(6),NextRoundTimeout=20,Reward={perKill:10},Class={Soldier:0,Scrambler:1,Ranger:2};Grenade.prototype.update=function(delta){if(this.ttl<=0)if(munitionsManager.grenadePool.recycle(this),this.actor){addExplosion(this.x,this.y,this.z,this.damage);pos=new BABYLON.Vector3(this.x,this.y,this.z);this.actor.explodeSound.setPosition(pos),this.actor.explodeSound.play(),this.actor.remove()}else for(var that=this,i=0;i<playerLimit;i++){var player=players[i];if(player&&player.playing&&(player.id==that.player.id||0==player.team||player.team!=that.player.team)){var dx=player.x-that.x,dy=player.y+.3-that.y,dz=player.z-that.z,distance=Math.length3(dx,dy,dz),damage=Math.max(0,that.damage-25*distance);if(damage>0){for(var dv=Math.normalize3({x:dx,y:dy,z:dz},.25),dirVec=new BABYLON.Vector3(dv.x,dv.y,dv.z),pos=new BABYLON.Vector3(player.x,player.y+.3,player.z),clear=!0,j=0;j<distance;j+=.25){var res=collider.projectileCollidesWithMap(pos,dirVec);if(res&&!mapMeshes[res.cell.idx].softness){clear=!1;break}pos.x-=dv.x,pos.y-=dv.y,pos.z-=dv.z}clear&&hitPlayer(that.player)}}}else{var pdx=this.dx,pdy=this.dy,pdz=this.dz;this.dy-=.003*delta;var ndx=.5*(this.dx+pdx)*delta,ndy=.5*(this.dy+pdy)*delta,ndz=.5*(this.dz+pdz)*delta;this.dx*=Math.pow(.99,delta),this.dz*=Math.pow(.99,delta),this.x+=ndx,this.collidesWithMap()&&(this.x-=ndx,this.dx*=-.5,this.dy*=.8,this.dz*=.8),this.y+=ndy,this.collidesWithMap()&&(this.y-=ndy,this.dx*=.8,this.dy*=-.5,this.dz*=.8),this.z+=ndz,this.collidesWithMap()&&(this.z-=ndz,this.dx*=.8,this.dy*=.8,this.dz*=-.5),this.ttl-=delta,this.actor&&this.actor.update()}},Grenade.prototype.throw=function(player,pos,vec){this.player=player,this.x=pos.x,this.y=pos.y,this.z=pos.z,this.dx=vec.x,this.dy=vec.y,this.dz=vec.z,this.ttl=150,this.damage=120,this.active=!0,this.actor&&this.actor.throw()},Grenade.prototype.collidesWithMap=function(){return!!collider.projectileCollidesWithMap(new BABYLON.Vector3(this.x,this.y-.07,this.z),new BABYLON.Vector3(this.dx,this.dy,this.dz))&&(this.actor&&this.actor.bounce(),!0)},Gun.prototype.update=function(delta){this.actor&&this.actor.update(delta)},Gun.prototype.collectAmmo=function(){return this.actor?(this.ammo.store=Math.min(this.ammo.storeMax,this.ammo.store+this.ammo.pickup),!0):this.ammo.store<this.ammo.storeMax&&(this.ammo.store=Math.min(this.ammo.storeMax,this.ammo.store+this.ammo.pickup),!0)},Gun.prototype.fire=function(){if(this.actor)this.actor.fire();else{var rotMat=BABYLON.Matrix.RotationYawPitchRoll(this.player.yaw,this.player.pitch,0),dirMat=BABYLON.Matrix.Translation(0,0,2e3).multiply(rotMat),dir=dirMat.getTranslation(),spread=.004*(this.player.shotSpread+this.subClass.accuracy);isNaN(spread)&&(console.log("NaN"),this.player.shotSpread=0,spread=0);var spreadMat=BABYLON.Matrix.RotationYawPitchRoll((Math.random()-.5)*spread,(Math.random()-.5)*spread,(Math.random()-.5)*spread);(dir=(dirMat=dirMat.multiply(spreadMat)).getTranslation()).normalize();var posMat=BABYLON.Matrix.Translation(0,.1,.4),pos=(posMat=(posMat=posMat.multiply(rotMat)).add(BABYLON.Matrix.Translation(this.player.x,this.player.y+.3,this.player.z))).getTranslation();Math.seed=Math.randomInt(0,256);var output=new Comm.output(15);output.packInt8(CommCode.fire),output.packInt8(this.player.id),output.packFloat(pos.x),output.packFloat(pos.y),output.packFloat(pos.z),output.packFloat(dir.x),output.packFloat(dir.y),output.packFloat(dir.z),output.packInt8(Math.seed),sendToAll(output.buffer),this.fireMunitions(pos,dir)}},Gun.prototype.equip=function(){this.player.weaponIdx=this.player.equipWeaponIdx,this.player.weapon=this.player.weapons[this.player.weaponIdx],this.player.weapon.actor.equip(),this.player.id==meId&&updateAmmoUi()},Eggk47.prototype=Object.create(Gun.prototype),Eggk47.prototype.constructor=Gun,Eggk47.weaponName="EggK-47",Eggk47.standardMeshName="eggk47",Eggk47.rof=3600/550,Eggk47.automatic=!0,Eggk47.accuracy=14,Eggk47.shotSpreadIncrement=42,Eggk47.accuracySettleFactor=.9,Eggk47.damage=45,Eggk47.totalDamage=45,Eggk47.ttl=30,Eggk47.velocity=.5,Eggk47.prototype.fireMunitions=function(pos,dir){munitionsManager.fireBullet(this.player,pos,dir,Eggk47.damage,Eggk47.ttl,Eggk47.velocity)},DozenGauge.prototype=Object.create(Gun.prototype),DozenGauge.prototype.constructor=Gun,DozenGauge.weaponName="Dozen Gauge",DozenGauge.standardMeshName="dozenGauge",DozenGauge.rof=15,DozenGauge.automatic=!1,DozenGauge.accuracy=30,DozenGauge.shotSpreadIncrement=120,DozenGauge.accuracySettleFactor=.89,DozenGauge.damage=10,DozenGauge.totalDamage=200,DozenGauge.ttl=15,DozenGauge.velocity=.45,DozenGauge.prototype.fireMunitions=function(pos,dir){for(var i=0;i<playerLimit;i++){var modDir=Math.normalize3({x:dir.x+Math.seededRandom(-.15,.15),y:dir.y+Math.seededRandom(-.1,.1),z:dir.z+Math.seededRandom(-.15,.15)});munitionsManager.fireBullet(this.player,pos,modDir,DozenGauge.damage,DozenGauge.ttl,DozenGauge.velocity)}},CSG1.prototype=Object.create(Gun.prototype),CSG1.prototype.constructor=Gun,CSG1.weaponName="CSG-1",CSG1.standardMeshName="csg1",CSG1.rof=60,CSG1.automatic=!1,CSG1.accuracy=0,CSG1.shotSpreadIncrement=180,CSG1.accuracySettleFactor=.95,CSG1.damage=250,CSG1.totalDamage=250,CSG1.ttl=80,CSG1.velocity=.6,CSG1.prototype.fireMunitions=function(pos,dir){munitionsManager.fireBullet(this.player,pos,dir,CSG1.damage,CSG1.ttl,CSG1.velocity)},Cluck9mm.prototype=Object.create(Gun.prototype),Cluck9mm.prototype.constructor=Gun,Cluck9mm.weaponName="Cluck 9mm",Cluck9mm.standardMeshName="cluck9mm",Cluck9mm.rof=6,Cluck9mm.automatic=!1,Cluck9mm.accuracy=30,Cluck9mm.shotSpreadIncrement=100,Cluck9mm.accuracySettleFactor=.85,Cluck9mm.damage=35,Cluck9mm.totalDamage=35,Cluck9mm.ttl=100,Cluck9mm.velocity=.45,Cluck9mm.prototype.fireMunitions=function(pos,dir){munitionsManager.fireBullet(this.player,pos,dir,Cluck9mm.damage,Cluck9mm.ttl,Cluck9mm.velocity)},RPEGG.prototype=Object.create(Gun.prototype),RPEGG.prototype.constructor=Gun,RPEGG.weaponName="RPEGG",RPEGG.standardMeshName="rpegg",RPEGG.rof=600,RPEGG.automatic=!1,RPEGG.accuracy=0,RPEGG.shotSpreadIncrement=100,RPEGG.accuracySettleFactor=.95,RPEGG.damage=120,RPEGG.totalDamage=120,RPEGG.ttl=100,RPEGG.velocity=.35,RPEGG.prototype.fireMunitions=function(pos,dir){munitionsManager.fireRocket(this.player,pos,dir,RPEGG.damage,RPEGG.ttl,RPEGG.velocity)};Math.PI2=2*Math.PI,Math.PI90=Math.PI/2,Math.mod=function(n,m){var remain=n%m;return remain>=0?remain:remain+m},Math.length2=function(x,y){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2))},Math.length3=function(x,y,z){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2)+Math.pow(z,2))},Math.capVector2=function(vec,len){var l=Math.length2(vec.x,vec.y);return l>len&&(vec.x*=len/l,vec.y*=len/l),vec},Math.capVector3=function(vec,len){var l=Math.length3(vec.x,vec.y,vec.z);return l>len&&(vec.x*=len/l,vec.y*=len/l,vec.z*=len/l),vec},Math.normalize2=function(vec,len){len=len||1;var l=Math.length2(vec.x,vec.y);return vec.x*=len/l,vec.y*=len/l,vec},Math.normalize3=function(vec,len){len=len||1;var l=Math.length3(vec.x,vec.y,vec.z);return vec.x*=len/l,vec.y*=len/l,vec.z*=len/l,vec},Math.clamp=function(v,min,max){return Math.max(Math.min(v,max),min)},Math.radAdd=function(a,b){return Math.mod(a+b,Math.PI2)},Math.radSub=function(a,b){return Math.mod(a-b,Math.PI2)},Math.radRange=function(n){return Math.mod(n,Math.PI2)},Math.radDifference=function(fromAngle,toAngle){var diff=(fromAngle-toAngle+Math.PI)%Math.PI2-Math.PI;return diff=diff<-Math.PI?diff+Math.PI2:diff},Math.cardVals=[0,Math.PI90,Math.PI,3*Math.PI90],Math.cardToRad=function(card){return Math.cardVals[card]},Math.randomInt=function(low,high){return Math.floor(Math.random()*(high-low)+low)},Math.seed=100,Math.seededRandom=function(min,max){return min=min||0,max=max||1,Math.seed=(9301*Math.seed+49297)%233280,min+Math.seed/233280*(max-min)},Math.seededRandomInt=function(min,max){return Math.floor(Math.seededRandom(min,max))},Math.diff=function(a,b,threshold){return b<a?threshold-a+b:b-a};var minMaps=[{fileVersion:1,data:{"castle.brick.full":[{x:0,y:0,z:0},{x:0,y:0,z:1,ry:3},{x:0,y:0,z:2,ry:1},{x:0,y:0,z:3,ry:3},{x:0,y:0,z:4,ry:1},{x:0,y:0,z:5,ry:3},{x:0,y:0,z:6,ry:1},{x:0,y:0,z:7,ry:3},{x:0,y:0,z:8,ry:1},{x:0,y:0,z:9,ry:3},{x:0,y:0,z:10,ry:1},{x:0,y:0,z:11,ry:3},{x:0,y:0,z:12,ry:1},{x:0,y:0,z:13,ry:3},{x:0,y:1,z:0,ry:2},{x:0,y:1,z:1,ry:1},{x:0,y:1,z:2,ry:3},{x:0,y:1,z:3,ry:1},{x:0,y:1,z:9,ry:1},{x:0,y:1,z:10,ry:3},{x:0,y:1,z:11,ry:1},{x:0,y:1,z:12,ry:3},{x:0,y:1,z:13,ry:2},{x:0,y:2,z:11,ry:3},{x:0,y:2,z:12,ry:1},{x:0,y:2,z:13},{x:0,y:3,z:11,ry:2},{x:0,y:3,z:12,ry:1},{x:0,y:3,z:13},{x:1,y:0,z:0,ry:1},{x:1,y:0,z:13,ry:2},{x:1,y:1,z:0,ry:3},{x:1,y:1,z:1,ry:1},{x:1,y:1,z:2,ry:1},{x:1,y:1,z:3,ry:1},{x:1,y:1,z:13},{x:1,y:2,z:2,ry:3},{x:1,y:2,z:3,ry:1},{x:1,y:2,z:11},{x:1,y:2,z:13,ry:2},{x:1,y:3,z:2,rx:2,ry:2,rz:2},{x:1,y:3,z:13,ry:2},{x:2,y:0,z:0,ry:2},{x:2,y:0,z:13},{x:2,y:1,z:0},{x:2,y:1,z:13,ry:2},{x:2,y:2,z:1},{x:2,y:2,z:11,ry:2},{x:2,y:2,z:13},{x:2,y:3,z:1,ry:2},{x:3,y:0,z:0},{x:3,y:0,z:13,ry:2},{x:3,y:1,z:13},{x:3,y:2,z:13,ry:2},{x:3,y:3,z:13,ry:2},{x:4,y:0,z:0,ry:2},{x:4,y:0,z:4},{x:4,y:0,z:5},{x:4,y:0,z:7},{x:4,y:0,z:8},{x:4,y:0,z:10},{x:4,y:0,z:11},{x:4,y:0,z:13},{x:4,y:1,z:12},{x:4,y:1,z:13,ry:2},{x:4,y:3,z:13},{x:5,y:0,z:0},{x:5,y:0,z:13,ry:2},{x:5,y:1,z:12,ry:2},{x:5,y:1,z:13},{x:5,y:2,z:13,ry:2},{x:5,y:3,z:13,ry:2},{x:6,y:0,z:0,ry:2},{x:6,y:0,z:9,ry:2},{x:6,y:0,z:10,ry:2},{x:6,y:0,z:13},{x:6,y:1,z:9,ry:1},{x:6,y:1,z:12},{x:6,y:1,z:13,ry:2},{x:6,y:2,z:12},{x:6,y:2,z:13},{x:7,y:0,z:0},{x:7,y:0,z:13,ry:2},{x:7,y:1,z:3},{x:7,y:1,z:12,ry:2},{x:7,y:1,z:13},{x:7,y:2,z:12,ry:1},{x:7,y:3,z:8,ry:2},{x:7,y:4,z:8},{x:8,y:0,z:3,ry:2},{x:8,y:0,z:4},{x:8,y:0,z:8},{x:8,y:0,z:9},{x:8,y:0,z:13},{x:8,y:1,z:1},{x:8,y:1,z:4,ry:1},{x:8,y:1,z:8,ry:1},{x:8,y:1,z:9},{x:8,y:1,z:12},{x:8,y:2,z:1},{x:9,y:0,z:3},{x:9,y:0,z:13,ry:2},{x:9,y:1,z:3},{x:9,y:1,z:9,rx:2,rz:2},{x:9,y:1,z:12,ry:2},{x:9,y:2,z:12},{x:10,y:0,z:13},{x:10,y:3,z:2,rx:2,ry:2,rz:2},{x:11,y:0,z:13,ry:2},{x:11,y:1,z:12,ry:2},{x:11,y:1,z:13},{x:11,y:2,z:12},{x:11,y:2,z:13,ry:2},{x:11,y:3,z:2,rx:2,rz:2},{x:12,y:0,z:13},{x:12,y:1,z:3},{x:12,y:1,z:9,rx:2,ry:1,rz:2},{x:12,y:1,z:13,ry:2},{x:12,y:2,z:13},{x:12,y:3,z:2,rx:2,ry:2,rz:2},{x:12,y:3,z:11},{x:13,y:2,z:13,ry:2},{x:14,y:0,z:0,ry:2},{x:14,y:0,z:13,ry:2},{x:14,y:1,z:0},{x:14,y:1,z:13,ry:2},{x:14,y:2,z:0},{x:14,y:2,z:13},{x:15,y:0,z:0},{x:15,y:1,z:0,ry:2},{x:15,y:1,z:2,ry:3},{x:15,y:1,z:3,ry:1},{x:15,y:2,z:0,ry:2},{x:15,y:2,z:3},{x:15,y:2,z:13,ry:2},{x:15,y:3,z:2,ry:2},{x:16,y:0,z:0,ry:2},{x:16,y:0,z:13},{x:16,y:1,z:2},{x:16,y:1,z:3,ry:1},{x:16,y:1,z:4,ry:3},{x:16,y:1,z:13,ry:2},{x:16,y:2,z:0},{x:16,y:2,z:3,ry:1},{x:16,y:2,z:13},{x:16,y:3,z:4,ry:1},{x:16,y:4,z:4,ry:3},{x:17,y:0,z:0},{x:17,y:0,z:3,ry:2},{x:17,y:0,z:11,ry:3},{x:17,y:0,z:13,ry:2},{x:17,y:1,z:0,rx:2,rz:2},{x:17,y:1,z:3,ry:3},{x:17,y:1,z:13},{x:17,y:2,z:0,ry:2},{x:17,y:2,z:13,ry:2},{x:18,y:0,z:0,ry:2},{x:18,y:0,z:3},{x:18,y:0,z:11,ry:3},{x:18,y:0,z:13},{x:18,y:1,z:13,ry:2},{x:18,y:2,z:0},{x:18,y:2,z:13},{x:19,y:0,z:13,ry:2},{x:19,y:1,z:12,ry:3},{x:19,y:1,z:13},{x:19,y:2,z:12,ry:3},{x:19,y:2,z:13,ry:2},{x:20,y:0,z:5,ry:2},{x:20,y:0,z:7,ry:2},{x:20,y:0,z:13,ry:1},{x:20,y:1,z:2,rx:2,ry:2,rz:2},{x:20,y:1,z:5,ry:2},{x:20,y:1,z:7},{x:20,y:1,z:13,ry:3},{x:20,y:2,z:2,ry:1},{x:20,y:2,z:13,ry:1},{x:21,y:0,z:2,ry:3},{x:21,y:0,z:3,ry:1},{x:21,y:0,z:4,ry:3},{x:21,y:0,z:5,ry:1},{x:21,y:0,z:7,ry:1},{x:21,y:0,z:8,ry:3},{x:21,y:0,z:9,ry:1},{x:21,y:0,z:10,ry:3},{x:21,y:0,z:11,ry:1},{x:21,y:0,z:12,ry:3},{x:21,y:0,z:13,ry:1},{x:21,y:1,z:2,ry:1},{x:21,y:1,z:3,ry:3},{x:21,y:1,z:4,ry:1},{x:21,y:1,z:5,ry:3},{x:21,y:1,z:7,ry:3},{x:21,y:1,z:8,ry:1},{x:21,y:1,z:9,ry:3},{x:21,y:1,z:10,ry:1},{x:21,y:1,z:11,ry:3},{x:21,y:1,z:12,ry:1},{x:21,y:1,z:13,ry:3},{x:21,y:2,z:2,ry:3},{x:21,y:2,z:3,ry:1},{x:21,y:2,z:4,ry:3},{x:21,y:2,z:5,ry:1},{x:21,y:2,z:7,ry:1},{x:21,y:2,z:8,ry:3},{x:21,y:2,z:9,ry:1},{x:21,y:2,z:10,ry:3},{x:21,y:2,z:11,ry:1},{x:21,y:2,z:12,ry:3},{x:21,y:2,z:13,ry:1}],"castle.brick-capped.full":[{x:0,y:1,z:4,ry:3},{x:0,y:1,z:5,ry:1},{x:0,y:1,z:6,ry:3},{x:0,y:1,z:7,ry:1},{x:0,y:1,z:8,ry:1},{x:0,y:2,z:0,ry:2},{x:0,y:2,z:1,ry:1},{x:0,y:2,z:2,ry:3},{x:0,y:2,z:3,ry:1},{x:0,y:2,z:9,ry:3},{x:0,y:2,z:10,ry:1},{x:0,y:4,z:11,ry:1},{x:0,y:4,z:12,ry:3},{x:0,y:4,z:13,ry:1},{x:1,y:1,z:6,ry:2},{x:1,y:2,z:0},{x:1,y:2,z:1,ry:3},{x:1,y:2,z:9,rx:2,ry:3,rz:2},{x:1,y:2,z:10,ry:3},{x:1,y:3,z:11},{x:1,y:3,z:12},{x:1,y:4,z:2},{x:1,y:4,z:13},{x:2,y:1,z:6,ry:1},{x:2,y:1,z:10},{x:2,y:2,z:0,ry:2},{x:2,y:3,z:10,ry:1},{x:2,y:3,z:11},{x:2,y:3,z:12},{x:2,y:3,z:13},{x:2,y:4,z:1,ry:2},{x:2,y:4,z:13,ry:2},{x:3,y:1,z:0,ry:2},{x:3,y:1,z:5,ry:1},{x:3,y:1,z:6,ry:1},{x:3,y:1,z:7,ry:1},{x:3,y:1,z:10},{x:3,y:2,z:1,ry:2},{x:3,y:2,z:11},{x:3,y:2,z:12,ry:2},{x:3,y:3,z:1},{x:3,y:4,z:1},{x:3,y:4,z:13},{x:4,y:0,z:6,rx:2,ry:2,rz:2},{x:4,y:1,z:0},{x:4,y:1,z:3},{x:4,y:1,z:4},{x:4,y:1,z:5,ry:1},{x:4,y:1,z:7,ry:3},{x:4,y:1,z:8},{x:4,y:1,z:9},{x:4,y:1,z:10},{x:4,y:1,z:11},{x:4,y:2,z:12},{x:4,y:2,z:13},{x:4,y:4,z:13,ry:2},{x:5,y:0,z:4,ry:2},{x:5,y:0,z:5,ry:1},{x:5,y:0,z:6,rx:2,rz:2},{x:5,y:0,z:7,ry:2},{x:5,y:0,z:8,ry:2},{x:5,y:0,z:11,rx:2,ry:2,rz:2},{x:5,y:1,z:0,ry:2},{x:5,y:1,z:2,rx:2,ry:3,rz:2},{x:5,y:1,z:3,rx:2,ry:3,rz:2},{x:5,y:1,z:9},{x:5,y:1,z:10},{x:5,y:1,z:11,rx:2,ry:2,rz:2},{x:5,y:2,z:12,ry:2},{x:5,y:4,z:13},{x:6,y:0,z:6,rx:2,ry:3,rz:2},{x:6,y:0,z:11,rx:2,ry:2,rz:2},{x:6,y:1,z:0},{x:6,y:1,z:2},{x:6,y:1,z:3,rx:2,rz:2},{x:6,y:1,z:10,rx:2,ry:1,rz:2},{x:6,y:2,z:3,rx:2,ry:2,rz:2},{x:6,y:2,z:9},{x:6,y:3,z:9,ry:3},{x:6,y:3,z:12,ry:3},{x:6,y:3,z:13},{x:6,y:4,z:13,ry:2},{x:7,y:0,z:6,rx:2,ry:2,rz:2},{x:7,y:0,z:9,rx:2,ry:3,rz:2},{x:7,y:0,z:10,rx:2,ry:3,rz:2},{x:7,y:0,z:11,rx:2,ry:2,rz:2},{x:7,y:1,z:0,ry:2},{x:7,y:1,z:1,ry:1},{x:7,y:1,z:2,ry:2},{x:7,y:2,z:3,rx:2,rz:2},{x:7,y:2,z:9,rx:2,rz:2},{x:7,y:2,z:10,rx:2,rz:2},{x:7,y:2,z:13,ry:2},{x:7,y:3,z:11,ry:2},{x:7,y:5,z:8},{x:8,y:0,z:0,ry:2},{x:8,y:0,z:2,ry:1},{x:8,y:0,z:5,rx:2,ry:2,rz:2},{x:8,y:0,z:6,rx:2,ry:1,rz:2},{x:8,y:0,z:7,rx:2,ry:2,rz:2},{x:8,y:0,z:10,rx:2,ry:3,rz:2},{x:8,y:0,z:11,rx:2,ry:2,rz:2},{x:8,y:1,z:3,ry:3},{x:8,y:1,z:13,ry:2},{x:8,y:2,z:3,rx:2,ry:2,rz:2},{x:8,y:2,z:4,rx:2,ry:3,rz:2},{x:8,y:2,z:8,rx:2,ry:1,rz:2},{x:8,y:2,z:9},{x:8,y:2,z:12,ry:2},{x:8,y:3,z:0},{x:8,y:3,z:1,ry:3},{x:8,y:3,z:11},{x:9,y:0,z:0},{x:9,y:0,z:1},{x:9,y:0,z:2,ry:1},{x:9,y:0,z:10,ry:2},{x:9,y:0,z:11,ry:3},{x:9,y:1,z:13},{x:9,y:2,z:3,rx:2,rz:2},{x:9,y:2,z:9,ry:2},{x:9,y:3,z:0,ry:2},{x:9,y:3,z:1,ry:2},{x:9,y:3,z:11,ry:2},{x:9,y:3,z:12},{x:10,y:0,z:0,ry:2},{x:10,y:0,z:1,ry:1},{x:10,y:0,z:2,ry:1},{x:10,y:0,z:3,rx:2,ry:1,rz:2},{x:10,y:0,z:11,ry:2},{x:10,y:0,z:12,ry:2},{x:10,y:1,z:13,ry:2},{x:10,y:3,z:0},{x:10,y:3,z:1,ry:2},{x:10,y:3,z:10,ry:2},{x:10,y:3,z:11},{x:10,y:4,z:0},{x:10,y:4,z:2,rx:2,rz:2},{x:11,y:0,z:0},{x:11,y:0,z:1,ry:1},{x:11,y:0,z:2,ry:1},{x:11,y:0,z:3,rx:2,ry:1,rz:2},{x:11,y:0,z:11,ry:2},{x:11,y:0,z:12,ry:1},{x:11,y:3,z:0,ry:2},{x:11,y:3,z:1,ry:2},{x:11,y:3,z:10},{x:11,y:3,z:11,ry:2},{x:11,y:3,z:12,ry:2},{x:11,y:3,z:13,ry:2},{x:11,y:4,z:2,rx:2,ry:2,rz:2},{x:12,y:0,z:0,rx:2,rz:2},{x:12,y:0,z:10,ry:2},{x:12,y:0,z:11,ry:2},{x:12,y:0,z:12,ry:1},{x:12,y:2,z:3,rx:2,ry:3,rz:2},{x:12,y:2,z:9,ry:3},{x:12,y:3,z:1,ry:2},{x:12,y:3,z:10,ry:2},{x:12,y:3,z:13},{x:12,y:4,z:2,rx:2,rz:2},{x:12,y:4,z:11,ry:1},{x:13,y:0,z:0,rx:2,ry:2,rz:2},{x:13,y:0,z:9},{x:13,y:0,z:10,ry:2},{x:13,y:0,z:11,ry:2},{x:13,y:0,z:12,ry:1},{x:13,y:0,z:13,ry:3},{x:13,y:3,z:1,rx:2,rz:2},{x:13,y:3,z:2,rx:2,ry:2,rz:2},{x:13,y:3,z:3},{x:13,y:3,z:10},{x:13,y:3,z:11,ry:2},{x:13,y:3,z:12},{x:13,y:3,z:13,ry:2},{x:13,y:4,z:11,ry:2},{x:13,y:4,z:12,ry:3},{x:14,y:0,z:9,ry:1},{x:14,y:0,z:10,ry:3},{x:14,y:0,z:11},{x:14,y:0,z:12,ry:1},{x:14,y:3,z:0},{x:14,y:3,z:1,rx:2,ry:2,rz:2},{x:14,y:3,z:2,rx:2,rz:2},{x:14,y:3,z:3,ry:2},{x:14,y:3,z:10,ry:2},{x:14,y:3,z:11,ry:2},{x:14,y:3,z:12,ry:2},{x:14,y:3,z:13},{x:15,y:0,z:10,ry:1},{x:15,y:0,z:11,ry:3},{x:15,y:0,z:12,ry:1},{x:15,y:0,z:13,ry:1},{x:15,y:1,z:9,ry:1},{x:15,y:2,z:2,ry:2},{x:15,y:3,z:0,rx:2,rz:2},{x:15,y:3,z:3},{x:15,y:3,z:10},{x:15,y:3,z:11,ry:2},{x:15,y:3,z:12},{x:15,y:3,z:13,ry:2},{x:15,y:4,z:2},{x:15,y:4,z:11,ry:2},{x:16,y:0,z:1,ry:3},{x:16,y:0,z:5,ry:2},{x:16,y:0,z:6,ry:2},{x:16,y:0,z:11},{x:16,y:0,z:12},{x:16,y:1,z:0,rx:2,ry:2,rz:2},{x:16,y:1,z:7,ry:3},{x:16,y:1,z:8,ry:1},{x:16,y:1,z:9,ry:1},{x:16,y:1,z:10,ry:1},{x:16,y:2,z:2,rx:2,ry:2,rz:2},{x:16,y:2,z:4,ry:1},{x:16,y:3,z:0},{x:16,y:3,z:2,ry:1},{x:16,y:3,z:3,ry:3},{x:16,y:3,z:11},{x:16,y:3,z:12},{x:16,y:3,z:13},{x:16,y:4,z:0},{x:16,y:5,z:4,ry:1},{x:17,y:0,z:1,ry:3},{x:17,y:0,z:4,ry:2},{x:17,y:0,z:5,ry:3},{x:17,y:0,z:6,ry:2},{x:17,y:0,z:7,ry:3},{x:17,y:0,z:8,ry:3},{x:17,y:0,z:12,ry:3},{x:17,y:1,z:1,rx:2,ry:2,rz:2},{x:17,y:1,z:2,ry:1},{x:17,y:1,z:7},{x:17,y:1,z:8,ry:3},{x:17,y:1,z:9,ry:1},{x:17,y:1,z:10,ry:2},{x:17,y:1,z:11},{x:17,y:2,z:7},{x:17,y:2,z:10,ry:3},{x:17,y:3,z:0,ry:2},{x:17,y:3,z:7},{x:17,y:3,z:8,ry:3},{x:17,y:3,z:9,ry:1},{x:17,y:3,z:10,ry:3},{x:17,y:3,z:11,ry:2},{x:17,y:3,z:12,ry:2},{x:17,y:3,z:13,ry:2},{x:17,y:4,z:0,ry:2},{x:18,y:0,z:1,ry:3},{x:18,y:0,z:4,ry:1},{x:18,y:0,z:5,ry:2},{x:18,y:0,z:6},{x:18,y:0,z:7,ry:3},{x:18,y:0,z:8,ry:3},{x:18,y:0,z:12},{x:18,y:1,z:0,rx:2,ry:2,rz:2},{x:18,y:1,z:2},{x:18,y:1,z:3,ry:2},{x:18,y:1,z:8,ry:1},{x:18,y:1,z:9,ry:2},{x:18,y:1,z:10,ry:2},{x:18,y:1,z:11,ry:2},{x:18,y:1,z:12,ry:1},{x:18,y:3,z:0},{x:18,y:3,z:7,ry:1},{x:18,y:3,z:8,ry:3},{x:18,y:3,z:9,ry:1},{x:18,y:3,z:12,ry:2},{x:18,y:3,z:13},{x:18,y:4,z:0},{x:18,y:4,z:13,ry:2},{x:19,y:0,z:0},{x:19,y:0,z:1,ry:3},{x:19,y:0,z:6,ry:1},{x:19,y:1,z:2,ry:2},{x:19,y:1,z:3,ry:3},{x:19,y:1,z:4,ry:1},{x:19,y:1,z:5,ry:1},{x:19,y:1,z:7,ry:1},{x:19,y:1,z:8,ry:1},{x:19,y:2,z:0,ry:2},{x:19,y:2,z:5,ry:2},{x:19,y:2,z:6,ry:3},{x:19,y:2,z:7,ry:1},{x:19,y:2,z:8,ry:3},{x:19,y:2,z:9,ry:1},{x:19,y:2,z:10,ry:3},{x:19,y:2,z:11,ry:1},{x:19,y:3,z:0,ry:2},{x:19,y:3,z:12,ry:1},{x:19,y:3,z:13,ry:2},{x:20,y:0,z:0,ry:2},{x:20,y:0,z:6,ry:1},{x:20,y:2,z:1,ry:3},{x:20,y:2,z:3,ry:3},{x:20,y:2,z:4,ry:1},{x:20,y:2,z:5,ry:2},{x:20,y:2,z:7,ry:1},{x:20,y:2,z:8,ry:3},{x:20,y:3,z:1,ry:1},{x:20,y:3,z:2,ry:1},{x:20,y:3,z:9,ry:3},{x:20,y:3,z:10,ry:1},{x:20,y:3,z:11,ry:3},{x:20,y:3,z:12,ry:1},{x:20,y:3,z:13,ry:1},{x:20,y:4,z:9,ry:3},{x:20,y:4,z:10,ry:1},{x:20,y:4,z:11,ry:3},{x:21,y:0,z:0},{x:21,y:0,z:1,ry:1},{x:21,y:0,z:6,ry:3},{x:21,y:1,z:6,ry:1},{x:21,y:2,z:6,ry:3},{x:21,y:3,z:2,ry:3},{x:21,y:3,z:3,ry:1},{x:21,y:3,z:4,ry:3},{x:21,y:3,z:5,ry:1},{x:21,y:3,z:6,ry:3},{x:21,y:3,z:7,ry:1},{x:21,y:3,z:8,ry:3},{x:21,y:3,z:9,ry:1},{x:21,y:3,z:10,ry:3},{x:21,y:3,z:11,ry:1},{x:21,y:3,z:12,ry:3},{x:21,y:3,z:13,ry:1}],"castle.stairs.wedge":[{x:0,y:2,z:4,ry:2},{x:0,y:2,z:8},{x:1,y:3,z:3,ry:1},{x:1,y:3,z:10,ry:1},{x:3,y:2,z:0,ry:3},{x:3,y:3,z:12,ry:3},{x:4,y:1,z:6,ry:3},{x:4,y:2,z:11},{x:5,y:1,z:4,ry:2},{x:5,y:1,z:8},{x:5,y:3,z:12,ry:1},{x:6,y:1,z:11,ry:3},{x:6,y:2,z:10,ry:1},{x:6,y:3,z:3,ry:3},{x:7,y:3,z:12,ry:2},{x:8,y:1,z:0,ry:3},{x:8,y:1,z:2,ry:3},{x:8,y:2,z:13,ry:3},{x:9,y:3,z:2,ry:2},{x:9,y:3,z:10,ry:1},{x:10,y:1,z:12},{x:12,y:3,z:3,ry:1},{x:15,y:1,z:10,ry:1},{x:16,y:1,z:1,ry:1},{x:17,y:1,z:12,ry:1},{x:17,y:2,z:3},{x:18,y:1,z:1,ry:3},{x:18,y:1,z:4,ry:1},{x:18,y:1,z:7},{x:19,y:3,z:11},{x:20,y:3,z:3,ry:2}],"castle.torch_1.obb":[{x:0,y:3,z:2,ry:3},{x:1,y:4,z:11,ry:1},{x:2,y:3,z:0,ry:2},{x:3,y:2,z:2},{x:4,y:3,z:12,ry:2},{x:5,y:2,z:9,ry:3},{x:7,y:1,z:4,ry:3},{x:7,y:1,z:8,ry:3},{x:7,y:3,z:10,ry:2},{x:8,y:4,z:13,ry:3},{x:9,y:1,z:2,ry:2},{x:9,y:1,z:4,rx:2,ry:3,rz:2},{x:9,y:1,z:8,rx:2,ry:3,rz:2},{x:9,y:2,z:13},{x:9,y:4,z:12,ry:2},{x:10,y:4,z:1},{x:10,y:4,z:13,ry:1},{x:11,y:3,z:3},{x:11,y:3,z:9,ry:2},{x:12,y:1,z:4},{x:12,y:4,z:10,ry:2},{x:13,y:3,z:9,ry:2},{x:14,y:1,z:2,ry:3},{x:14,y:1,z:12,ry:2},{x:15,y:1,z:4,ry:3},{x:15,y:1,z:7,ry:3},{x:15,y:2,z:1,ry:2},{x:15,y:4,z:3},{x:15,y:4,z:10,ry:2},{x:15,y:4,z:12},{x:16,y:2,z:10,ry:3},{x:16,y:4,z:1},{x:17,y:1,z:4,ry:1},{x:17,y:2,z:1,rx:2,ry:2,rz:2},{x:17,y:3,z:3,ry:1},{x:18,y:2,z:9,ry:1},{x:18,y:4,z:1},{x:18,y:4,z:12,ry:2},{x:20,y:3,z:5,ry:3},{x:20,y:3,z:7,ry:3},{x:21,y:4,z:9,ry:1}],"castle.brick-small.aabb":[{x:0,y:5,z:11},{x:1,y:4,z:4,rx:2,ry:1,rz:2},{x:1,y:5,z:2,ry:1},{x:2,y:5,z:13},{x:3,y:5,z:1,ry:2},{x:3,y:5,z:11},{x:4,y:2,z:5,ry:1},{x:4,y:2,z:7,ry:1},{x:4,y:5,z:13},{x:6,y:5,z:13},{x:7,y:6,z:8,ry:1},{x:9,y:5,z:0},{x:9,y:5,z:13},{x:10,y:5,z:2,ry:3},{x:11,y:5,z:0},{x:11,y:5,z:11,ry:3},{x:12,y:5,z:2,ry:1},{x:13,y:1,z:13,ry:3},{x:13,y:5,z:11,ry:1},{x:14,y:5,z:2,ry:1},{x:15,y:1,z:13,ry:3},{x:15,y:5,z:0,ry:1},{x:15,y:5,z:11,ry:1},{x:16,y:4,z:7,ry:3},{x:16,y:6,z:4,ry:1},{x:17,y:5,z:0,ry:1},{x:17,y:5,z:13,ry:1},{x:18,y:4,z:7,ry:3},{x:18,y:4,z:9,ry:3},{x:19,y:5,z:0,ry:1},{x:19,y:5,z:13,ry:1},{x:20,y:5,z:8,ry:3},{x:20,y:5,z:10,ry:3}],"SPECIAL.barrier.full.verysoft":[{x:0,y:5,z:12},{x:0,y:5,z:13},{x:0,y:6,z:11},{x:1,y:0,z:1},{x:1,y:0,z:2},{x:1,y:0,z:3},{x:1,y:0,z:4},{x:1,y:0,z:5},{x:1,y:0,z:6},{x:1,y:0,z:7},{x:1,y:0,z:8},{x:1,y:0,z:9},{x:1,y:0,z:10},{x:1,y:0,z:11},{x:1,y:0,z:12},{x:1,y:5,z:1},{x:1,y:5,z:12},{x:1,y:5,z:13},{x:1,y:6,z:2},{x:2,y:0,z:1},{x:2,y:0,z:2},{x:2,y:0,z:3},{x:2,y:0,z:4},{x:2,y:0,z:5},{x:2,y:0,z:6},{x:2,y:0,z:7},{x:2,y:0,z:8},{x:2,y:0,z:9},{x:2,y:0,z:10},{x:2,y:0,z:11},{x:2,y:0,z:12},{x:2,y:5,z:1},{x:2,y:6,z:13},{x:3,y:0,z:1},{x:3,y:0,z:2},{x:3,y:0,z:3},{x:3,y:0,z:4},{x:3,y:0,z:5},{x:3,y:0,z:6},{x:3,y:0,z:7},{x:3,y:0,z:8},{x:3,y:0,z:9},{x:3,y:0,z:10},{x:3,y:0,z:11},{x:3,y:0,z:12},{x:3,y:5,z:13},{x:3,y:6,z:1},{x:3,y:6,z:11},{x:4,y:0,z:1},{x:4,y:0,z:2},{x:4,y:0,z:3},{x:4,y:0,z:9},{x:4,y:0,z:12},{x:4,y:6,z:13},{x:5,y:0,z:1},{x:5,y:0,z:2},{x:5,y:0,z:3},{x:5,y:0,z:9},{x:5,y:0,z:10},{x:5,y:0,z:12},{x:5,y:5,z:13},{x:6,y:0,z:1},{x:6,y:0,z:2},{x:6,y:0,z:12},{x:6,y:6,z:13},{x:7,y:0,z:1},{x:7,y:0,z:2},{x:7,y:0,z:12},{x:7,y:7,z:8},{x:8,y:0,z:1},{x:8,y:0,z:12},{x:9,y:0,z:12},{x:9,y:6,z:0},{x:9,y:6,z:13},{x:10,y:5,z:0,ry:3},{x:10,y:6,z:0},{x:10,y:6,z:2},{x:11,y:5,z:2},{x:11,y:6,z:0},{x:11,y:6,z:11},{x:12,y:5,z:11},{x:12,y:6,z:2},{x:13,y:5,z:12},{x:13,y:6,z:11},{x:14,y:6,z:2},{x:15,y:5,z:2},{x:15,y:6,z:0},{x:15,y:6,z:11},{x:16,y:0,z:10},{x:16,y:5,z:0},{x:16,y:5,z:11,ry:2},{x:16,y:7,z:4},{x:17,y:0,z:2,ry:3},{x:17,y:0,z:9},{x:17,y:0,z:10},{x:17,y:6,z:0},{x:17,y:6,z:13},{x:18,y:0,z:2,ry:3},{x:18,y:0,z:9},{x:18,y:0,z:10},{x:18,y:5,z:0},{x:18,y:5,z:13},{x:19,y:0,z:2,ry:3},{x:19,y:0,z:3,ry:3},{x:19,y:0,z:4,ry:3},{x:19,y:0,z:5,ry:3},{x:19,y:0,z:7},{x:19,y:0,z:8},{x:19,y:0,z:9},{x:19,y:0,z:10},{x:19,y:0,z:11},{x:19,y:0,z:12},{x:19,y:6,z:0},{x:19,y:6,z:13},{x:20,y:0,z:2,ry:3},{x:20,y:0,z:3,ry:3},{x:20,y:0,z:4,ry:3},{x:20,y:0,z:8},{x:20,y:0,z:9},{x:20,y:0,z:10},{x:20,y:0,z:11},{x:20,y:0,z:12},{x:20,y:5,z:9,ry:1},{x:20,y:5,z:11},{x:20,y:6,z:8},{x:20,y:6,z:10}],"nature.ground_01.full":[{x:1,y:1,z:4,rx:1,ry:1,rz:1},{x:1,y:1,z:9,rx:2,ry:3,rz:2},{x:1,y:1,z:10,rx:2,ry:3,rz:2},{x:2,y:1,z:1,rx:2,ry:3,rz:2},{x:2,y:1,z:5,rx:2,ry:1,rz:3},{x:2,y:1,z:9,rz:3},{x:3,y:1,z:1,rx:2,ry:3,rz:2},{x:3,y:1,z:3,ry:1,rz:3},{x:3,y:1,z:8,rx:2,ry:2,rz:3},{x:4,y:1,z:1,rx:2,ry:2,rz:3},{x:4,y:1,z:2,rx:2,ry:1,rz:3},{x:5,y:1,z:1,rx:2,ry:2},{x:6,y:0,z:3,rx:2,ry:3,rz:3},{x:6,y:0,z:4,ry:3,rz:3},{x:6,y:0,z:7,rx:2,ry:3,rz:3},{x:7,y:0,z:5,rx:2,ry:1,rz:3},{x:7,y:0,z:8,rx:2,ry:1,rz:3},{x:9,y:0,z:5,rx:2,rz:3},{x:9,y:0,z:7,rx:2,ry:3,rz:3},{x:9,y:0,z:8,ry:3,rz:3},{x:10,y:0,z:4,rx:2,ry:2,rz:3},{x:10,y:0,z:5,rx:2,ry:1,rz:3},{x:10,y:0,z:6,rx:2,ry:2},{x:10,y:0,z:8,ry:1,rz:3},{x:10,y:0,z:10,rx:2,ry:3},{x:11,y:0,z:6,rx:2,rz:3},{x:11,y:0,z:7,rx:2,ry:3,rz:3},{x:11,y:0,z:9,rx:2,rz:3},{x:11,y:0,z:10,rx:2,ry:3},{x:12,y:0,z:1,rx:2,ry:2},{x:12,y:0,z:3,rx:2,ry:1},{x:12,y:0,z:4,ry:2,rz:3},{x:12,y:0,z:5,rx:2,ry:3,rz:2},{x:12,y:0,z:7,ry:2,rz:3},{x:12,y:0,z:9,rx:1,rz:2},{x:13,y:0,z:1,rx:2,ry:1},{x:13,y:0,z:2,rx:2,ry:1},{x:13,y:0,z:3,rx:2,ry:1},{x:13,y:0,z:4,rx:2,ry:2,rz:3},{x:13,y:0,z:6,rx:2,ry:1,rz:3},{x:13,y:0,z:7,rx:2,ry:2,rz:3},{x:14,y:0,z:1,rx:2,ry:1},{x:14,y:0,z:3,rx:2,ry:3},{x:14,y:0,z:5,rx:2,rz:3},{x:14,y:0,z:6,rx:2,ry:3,rz:3},{x:14,y:0,z:8,rx:2,rz:3},{x:15,y:0,z:1,rx:2,ry:1},{x:15,y:0,z:2,rx:2,ry:1},{x:15,y:0,z:3,rx:2,ry:1},{x:15,y:0,z:4,rx:2,ry:2,rz:3},{x:15,y:0,z:6,rx:2,ry:2,rz:3},{x:15,y:0,z:8,rx:2,ry:1,rz:3},{x:15,y:0,z:9,rx:2,ry:2,rz:3},{x:16,y:0,z:2,rx:2,ry:2,rz:3},{x:16,y:0,z:3,rx:2,rz:3},{x:16,y:0,z:4,rx:2,rz:3},{x:16,y:0,z:7,rx:2,ry:3,rz:3},{x:16,y:0,z:8,rx:2,ry:3,rz:3},{x:16,y:0,z:9,rx:2,ry:3,rz:3}],"nature.ground_02.full":[{x:1,y:1,z:5,rx:2,rz:3},{x:1,y:1,z:7,rx:2,ry:3,rz:3},{x:1,y:1,z:8,rx:2,ry:1,rz:1},{x:2,y:1,z:2,rx:2,ry:1,rz:2},{x:2,y:1,z:3,rx:2,ry:2,rz:2},{x:2,y:1,z:4,rx:1,rz:3},{x:2,y:1,z:7,rx:2,ry:2,rz:3},{x:2,y:1,z:8,rx:1,ry:2},{x:3,y:1,z:2,rx:1,rz:3},{x:3,y:1,z:4,rx:2,ry:1,rz:3},{x:3,y:1,z:9,rx:2,ry:1,rz:3},{x:6,y:0,z:5,rx:2,rz:3},{x:6,y:0,z:8,rx:2,rz:3},{x:6,y:1,z:1,rx:2,ry:3},{x:7,y:0,z:3,rx:2,ry:2,rz:3},{x:7,y:0,z:4,ry:1,rz:3},{x:7,y:0,z:7,rx:2,ry:2,rz:3},{x:9,y:0,z:4,rx:2,ry:3,rz:3},{x:9,y:0,z:6,rx:2,ry:2},{x:9,y:0,z:9,rx:2,rz:3},{x:10,y:0,z:7,rx:2,ry:2,rz:3},{x:10,y:0,z:9,rx:2,ry:1,rz:3},{x:11,y:0,z:4,rx:2,ry:3,rz:3},{x:11,y:0,z:5,ry:3,rz:3},{x:11,y:0,z:8,ry:3,rz:3},{x:12,y:0,z:2,rx:2,ry:2},{x:12,y:0,z:6,rx:3,rz:3},{x:12,y:0,z:8,rx:1,rz:3},{x:13,y:0,z:5,ry:1,rz:3},{x:13,y:0,z:8,rx:2,ry:1,rz:3},{x:14,y:0,z:2,rx:2,ry:3},{x:14,y:0,z:4,rx:2,ry:3,rz:3},{x:14,y:0,z:7,ry:3,rz:3},{x:15,y:0,z:5,rx:2,ry:1,rz:3},{x:15,y:0,z:7,ry:1,rz:3}],"castle.gray-brick-round-out.obb":[{x:1,y:2,z:4,ry:3},{x:1,y:3,z:1,ry:1},{x:1,y:3,z:4,ry:3},{x:1,y:3,z:9,ry:2},{x:1,y:4,z:1,ry:1},{x:1,y:4,z:12},{x:2,y:3,z:9},{x:3,y:3,z:11,ry:3},{x:3,y:4,z:11,ry:3},{x:6,y:3,z:8,ry:1},{x:6,y:3,z:11,ry:1},{x:8,y:3,z:2,ry:2},{x:8,y:3,z:12,ry:2},{x:9,y:4,z:0,ry:2},{x:9,y:4,z:13},{x:11,y:4,z:0,ry:3},{x:11,y:4,z:11,ry:1},{x:12,y:3,z:0},{x:14,y:4,z:2,ry:2},{x:15,y:2,z:9},{x:15,y:4,z:0,rx:2,rz:2},{x:16,y:1,z:11,ry:2},{x:16,y:2,z:7,ry:2},{x:16,y:3,z:7,ry:2},{x:16,y:4,z:11},{x:17,y:2,z:9,ry:1},{x:17,y:4,z:13,ry:1},{x:19,y:4,z:0,ry:3},{x:19,y:4,z:13},{x:20,y:2,z:0},{x:20,y:3,z:0},{x:20,y:3,z:8,ry:1},{x:20,y:4,z:8,ry:1}],"nature.tree-03.full.verysoft":[{x:1,y:2,z:8,ry:2},{x:2,y:2,z:2,ry:2},{x:12,y:1,z:5,rx:2,ry:1,rz:2},{x:12,y:1,z:8,ry:2}],"castle.brick-arch-center.aabb":[{x:2,y:3,z:3,rx:2,ry:1,rz:2},{x:3,y:3,z:3,rx:2,ry:1,rz:2},{x:4,y:3,z:3,rx:2,ry:1,rz:2},{x:5,y:3,z:3,rx:2,ry:1,rz:2},{x:8,y:2,z:6,rx:2,ry:2,rz:2}],"castle.blue-banner.none":[{x:3,y:4,z:10},{x:4,y:4,z:1,ry:3},{x:6,y:5,z:8,ry:1},{x:7,y:5,z:7},{x:7,y:5,z:9,ry:2},{x:8,y:5,z:8,ry:3}],"castle.wood-barricade.obb":[{x:7,y:1,z:5,ry:1},{x:7,y:1,z:7,ry:1},{x:16,y:3,z:6,ry:1}],"generic.metal-ladder.ladder":[{x:7,y:2,z:1,ry:1},{x:7,y:3,z:1,ry:1},{x:12,y:1,z:12,ry:3},{x:12,y:2,z:12,ry:3},{x:12,y:3,z:12,ry:3},{x:13,y:1,z:0,ry:1},{x:13,y:2,z:0,ry:1},{x:13,y:3,z:0,ry:1},{x:18,y:2,z:10,ry:3},{x:18,y:3,z:10,ry:3},{x:20,y:1,z:6,ry:1},{x:20,y:2,z:6,ry:1},{x:20,y:3,z:6,ry:1},{x:21,y:1,z:1},{x:21,y:2,z:1},{x:21,y:3,z:1}],"castle.gray-brick-half.aabb":[{x:7,y:2,z:11,ry:3},{x:8,y:2,z:10,ry:3},{x:8,y:2,z:11,ry:3},{x:9,y:2,z:10,ry:1},{x:9,y:2,z:11,ry:3},{x:9,y:3,z:13,ry:2},{x:10,y:3,z:12,ry:1},{x:10,y:3,z:13},{x:15,y:3,z:1,ry:1},{x:16,y:3,z:1,ry:1},{x:16,y:3,z:10,ry:2},{x:17,y:2,z:4},{x:17,y:2,z:5,ry:2},{x:17,y:2,z:6,ry:2},{x:17,y:3,z:1},{x:18,y:2,z:5},{x:18,y:2,z:6,ry:2},{x:18,y:3,z:1,ry:2},{x:19,y:3,z:1},{x:20,y:0,z:1}],"castle.brick-arch-side.aabb":[{x:8,y:2,z:5,rx:2,ry:1,rz:2},{x:8,y:2,z:7,rx:2,ry:3,rz:2},{x:10,y:2,z:3,rx:2,ry:2,rz:2},{x:10,y:2,z:9,rx:2,ry:2,rz:2},{x:11,y:2,z:3,ry:2},{x:11,y:2,z:9,rx:2,rz:2},{x:13,y:2,z:3},{x:13,y:2,z:9},{x:14,y:2,z:3,ry:2},{x:14,y:2,z:9,ry:2},{x:16,y:2,z:5,ry:3},{x:16,y:2,z:6,ry:1}],"nature.rocks-big.aabb":[{x:12,y:1,z:2,rx:2,ry:1,rz:2},{x:15,y:1,z:8,rx:2,ry:1,rz:2}],"castle.red-banner.none":[{x:15,y:5,z:4,ry:1},{x:16,y:5,z:3},{x:16,y:5,z:5,ry:2},{x:17,y:5,z:4,ry:3},{x:19,y:3,z:2,ry:1},{x:19,y:4,z:9,ry:1}]},palette:["castle.torch_1.obb","SPECIAL.barrier.full.verysoft","nature.rocks-big.aabb","nature.ground_02.full","castle.blue-banner.none","castle.brick.full","castle.brick-arch-center.aabb","generic.metal-ladder.ladder","nature.tree-03.full.verysoft","castle.red-banner.none"],width:22,height:8,depth:14,name:"",surfaceArea:421},{fileVersion:1,data:{"generic.siding.full":[{x:0,y:0,z:0},{x:0,y:0,z:1},{x:0,y:0,z:2,ry:1},{x:0,y:0,z:3},{x:0,y:0,z:4},{x:0,y:0,z:5},{x:0,y:0,z:6},{x:0,y:0,z:7},{x:0,y:0,z:8},{x:0,y:0,z:9},{x:0,y:0,z:10},{x:0,y:0,z:11},{x:0,y:0,z:12},{x:0,y:2,z:12},{x:0,y:2,z:13},{x:0,y:2,z:14},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:0,z:2,ry:1},{x:1,y:0,z:12},{x:1,y:0,z:13,ry:2},{x:1,y:0,z:14,ry:2},{x:1,y:0,z:15,ry:2},{x:1,y:0,z:16,ry:2},{x:1,y:1,z:4},{x:1,y:1,z:5},{x:1,y:1,z:6},{x:1,y:1,z:7},{x:1,y:1,z:8},{x:1,y:1,z:9},{x:1,y:1,z:10},{x:1,y:1,z:11},{x:1,y:2,z:12},{x:1,y:2,z:13},{x:1,y:2,z:14},{x:2,y:0,z:1,ry:1},{x:2,y:0,z:2,ry:1},{x:2,y:0,z:3,ry:1},{x:2,y:0,z:9},{x:2,y:0,z:12,ry:1},{x:2,y:0,z:15,ry:3},{x:2,y:1,z:4,ry:1},{x:2,y:1,z:8,ry:1},{x:2,y:1,z:11,ry:1},{x:2,y:2,z:12},{x:2,y:2,z:13},{x:2,y:2,z:14},{x:3,y:0,z:3,ry:1},{x:3,y:0,z:9,ry:1},{x:3,y:0,z:12,ry:1},{x:3,y:0,z:15,ry:3},{x:3,y:1,z:1},{x:3,y:1,z:4,ry:1},{x:3,y:1,z:8,ry:1},{x:3,y:1,z:11,ry:1},{x:3,y:2,z:1},{x:3,y:2,z:12},{x:3,y:2,z:13},{x:3,y:2,z:14},{x:3,y:2,z:15},{x:3,y:2,z:16},{x:3,y:2,z:17},{x:3,y:3,z:1,ry:1},{x:3,y:3,z:2,ry:1},{x:4,y:0,z:3,ry:1},{x:4,y:0,z:9,ry:1},{x:4,y:0,z:12,ry:1},{x:4,y:0,z:13,ry:1},{x:4,y:0,z:15,ry:3},{x:4,y:1,z:4,ry:1},{x:4,y:1,z:8,ry:1},{x:4,y:1,z:11},{x:4,y:2,z:12,ry:3},{x:4,y:2,z:14,ry:1},{x:4,y:2,z:15},{x:4,y:2,z:16},{x:4,y:2,z:17},{x:4,y:3,z:1},{x:4,y:3,z:2,ry:1},{x:5,y:0,z:3,ry:1},{x:5,y:0,z:9,ry:1},{x:5,y:0,z:12,ry:1},{x:5,y:0,z:13,ry:1},{x:5,y:0,z:15,ry:3},{x:5,y:1,z:4},{x:5,y:1,z:5},{x:5,y:1,z:6},{x:5,y:1,z:7},{x:5,y:1,z:8},{x:5,y:1,z:11},{x:5,y:2,z:11},{x:5,y:2,z:12},{x:5,y:2,z:13},{x:5,y:2,z:14},{x:5,y:2,z:15},{x:5,y:2,z:16},{x:5,y:2,z:17},{x:5,y:3,z:1,ry:1},{x:5,y:3,z:2,ry:1},{x:6,y:0,z:1,ry:1},{x:6,y:0,z:2},{x:6,y:0,z:3},{x:6,y:0,z:4},{x:6,y:0,z:5},{x:6,y:0,z:6},{x:6,y:0,z:7},{x:6,y:0,z:8},{x:6,y:0,z:9},{x:6,y:0,z:10},{x:6,y:0,z:11},{x:6,y:0,z:12,ry:1},{x:6,y:0,z:13,ry:1},{x:6,y:0,z:15,ry:3},{x:6,y:2,z:11},{x:6,y:2,z:15,ry:1},{x:6,y:2,z:16},{x:6,y:2,z:17},{x:6,y:3,z:1,ry:1},{x:6,y:3,z:2,ry:1},{x:7,y:0,z:1,ry:1},{x:7,y:0,z:6,ry:1},{x:7,y:0,z:10,ry:1},{x:7,y:0,z:11,ry:1},{x:7,y:0,z:12,ry:1},{x:7,y:0,z:13,ry:1},{x:7,y:0,z:15,ry:3},{x:7,y:2,z:11},{x:7,y:2,z:12},{x:7,y:2,z:15,ry:1},{x:7,y:2,z:16},{x:7,y:2,z:17,ry:1},{x:8,y:0,z:6,ry:3},{x:8,y:0,z:10,ry:1},{x:8,y:0,z:11,ry:2},{x:8,y:0,z:12},{x:8,y:0,z:13},{x:8,y:0,z:14},{x:8,y:0,z:15},{x:8,y:0,z:16},{x:8,y:2,z:12},{x:8,y:2,z:13},{x:8,y:2,z:15,ry:1},{x:8,y:2,z:17,ry:1},{x:9,y:0,z:6,ry:1},{x:9,y:0,z:10,ry:1},{x:9,y:0,z:15,ry:1},{x:9,y:1,z:12,ry:1},{x:9,y:1,z:13},{x:9,y:1,z:14},{x:9,y:2,z:0},{x:9,y:2,z:2},{x:9,y:2,z:3},{x:9,y:2,z:4},{x:9,y:2,z:5},{x:9,y:2,z:13},{x:9,y:2,z:14},{x:9,y:2,z:15,ry:1},{x:9,y:2,z:16},{x:9,y:2,z:17,ry:1},{x:9,y:3,z:0},{x:9,y:3,z:1},{x:9,y:3,z:2},{x:10,y:0,z:6},{x:10,y:0,z:7},{x:10,y:0,z:8},{x:10,y:0,z:9},{x:10,y:0,z:10},{x:10,y:0,z:15,ry:1},{x:10,y:1,z:11},{x:10,y:1,z:12},{x:10,y:1,z:13},{x:10,y:1,z:14},{x:10,y:2,z:0},{x:10,y:2,z:3},{x:10,y:2,z:5},{x:10,y:2,z:15,ry:1},{x:10,y:2,z:16},{x:10,y:2,z:17},{x:10,y:3,z:0},{x:10,y:3,z:2,ry:1},{x:11,y:0,z:4},{x:11,y:0,z:5},{x:11,y:0,z:6},{x:11,y:0,z:7},{x:11,y:0,z:15,ry:1},{x:11,y:1,z:8},{x:11,y:1,z:9},{x:11,y:1,z:10},{x:11,y:1,z:11},{x:11,y:1,z:12},{x:11,y:1,z:13},{x:11,y:1,z:14},{x:11,y:2,z:0},{x:11,y:2,z:1},{x:11,y:2,z:2},{x:11,y:2,z:3},{x:11,y:2,z:5},{x:11,y:2,z:15,ry:1},{x:11,y:2,z:16},{x:11,y:2,z:17},{x:11,y:3,z:0},{x:11,y:3,z:1,ry:1},{x:11,y:3,z:2,ry:1},{x:12,y:0,z:4},{x:12,y:0,z:15,ry:1},{x:12,y:1,z:5},{x:12,y:1,z:6},{x:12,y:1,z:7,ry:2},{x:12,y:1,z:8,ry:2},{x:12,y:1,z:12,ry:2},{x:12,y:1,z:13},{x:12,y:1,z:14},{x:12,y:2,z:0},{x:12,y:2,z:1},{x:12,y:2,z:2},{x:12,y:2,z:3},{x:12,y:2,z:5},{x:12,y:2,z:6},{x:12,y:2,z:13},{x:12,y:2,z:15},{x:12,y:2,z:16},{x:12,y:2,z:17,ry:3},{x:12,y:3,z:0},{x:12,y:3,z:1,ry:1},{x:12,y:3,z:15,ry:1},{x:12,y:3,z:16,ry:1},{x:12,y:3,z:17,ry:3},{x:13,y:0,z:4},{x:13,y:0,z:15,ry:1},{x:13,y:1,z:5},{x:13,y:1,z:6},{x:13,y:1,z:7},{x:13,y:1,z:8},{x:13,y:1,z:12,ry:2},{x:13,y:1,z:13},{x:13,y:1,z:14},{x:13,y:2,z:0},{x:13,y:2,z:1},{x:13,y:2,z:2},{x:13,y:2,z:3},{x:13,y:2,z:5},{x:13,y:2,z:13},{x:13,y:2,z:14},{x:13,y:2,z:15},{x:13,y:2,z:16},{x:13,y:2,z:17},{x:13,y:3,z:0},{x:13,y:3,z:1,ry:1},{x:13,y:3,z:15,ry:1},{x:13,y:3,z:16,ry:1},{x:13,y:3,z:17,ry:3},{x:14,y:0,z:1},{x:14,y:0,z:2},{x:14,y:0,z:3},{x:14,y:0,z:4},{x:14,y:0,z:15,ry:1},{x:14,y:1,z:5},{x:14,y:1,z:6},{x:14,y:1,z:7},{x:14,y:1,z:8},{x:14,y:1,z:12,ry:2},{x:14,y:1,z:14},{x:14,y:2,z:0},{x:14,y:2,z:1},{x:14,y:2,z:3},{x:14,y:2,z:5},{x:14,y:2,z:13},{x:14,y:2,z:14},{x:14,y:2,z:15},{x:14,y:2,z:16},{x:14,y:2,z:17,ry:3},{x:14,y:3,z:0},{x:14,y:3,z:1,ry:1},{x:14,y:3,z:16,ry:1},{x:14,y:3,z:17,ry:3},{x:15,y:0,z:4},{x:15,y:0,z:6},{x:15,y:0,z:7},{x:15,y:0,z:9},{x:15,y:0,z:10},{x:15,y:0,z:15,ry:1},{x:15,y:1,z:5},{x:15,y:1,z:8},{x:15,y:1,z:9},{x:15,y:1,z:10},{x:15,y:1,z:11},{x:15,y:1,z:12},{x:15,y:1,z:14},{x:15,y:2,z:0},{x:15,y:2,z:1},{x:15,y:2,z:2},{x:15,y:2,z:3},{x:15,y:2,z:5},{x:15,y:2,z:13},{x:15,y:2,z:14},{x:15,y:2,z:16},{x:15,y:2,z:17},{x:15,y:3,z:0},{x:15,y:3,z:1,ry:1},{x:15,y:3,z:15,ry:1},{x:15,y:3,z:16,ry:1},{x:15,y:3,z:17,ry:3},{x:16,y:0,z:4},{x:16,y:0,z:5},{x:16,y:0,z:6},{x:16,y:0,z:7},{x:16,y:0,z:9},{x:16,y:0,z:10},{x:16,y:0,z:15,ry:1},{x:16,y:1,z:8},{x:16,y:1,z:11,ry:1},{x:16,y:1,z:12,ry:2},{x:16,y:2,z:0},{x:16,y:2,z:1},{x:16,y:2,z:2},{x:16,y:2,z:3},{x:16,y:2,z:5},{x:16,y:2,z:8},{x:16,y:2,z:10},{x:16,y:2,z:13},{x:16,y:2,z:16},{x:16,y:2,z:17},{x:16,y:3,z:0,ry:3},{x:16,y:3,z:1,ry:2},{x:16,y:3,z:2},{x:16,y:3,z:15,ry:1},{x:16,y:3,z:16,ry:3},{x:16,y:3,z:17,ry:3},{x:17,y:0,z:7},{x:17,y:0,z:8},{x:17,y:0,z:9},{x:17,y:0,z:10},{x:17,y:0,z:11},{x:17,y:0,z:12},{x:17,y:0,z:15,ry:1},{x:17,y:1,z:13},{x:17,y:2,z:0,ry:3},{x:17,y:2,z:1},{x:17,y:2,z:2},{x:17,y:2,z:3},{x:17,y:2,z:5},{x:17,y:2,z:6},{x:17,y:2,z:7},{x:17,y:2,z:8,ry:2},{x:17,y:2,z:9},{x:17,y:2,z:10},{x:17,y:2,z:11},{x:17,y:2,z:12},{x:17,y:2,z:13},{x:17,y:2,z:16},{x:17,y:2,z:17},{x:17,y:3,z:0,ry:3},{x:17,y:3,z:1,ry:1},{x:17,y:3,z:2,ry:2},{x:17,y:3,z:15},{x:17,y:3,z:16,ry:3},{x:17,y:3,z:17,ry:3},{x:18,y:0,z:8},{x:18,y:0,z:11},{x:18,y:0,z:12},{x:18,y:0,z:13},{x:18,y:0,z:14,ry:1},{x:18,y:0,z:15,ry:1},{x:18,y:2,z:0},{x:18,y:2,z:1},{x:18,y:2,z:2},{x:18,y:2,z:3},{x:18,y:2,z:4},{x:18,y:2,z:5},{x:18,y:2,z:6},{x:18,y:2,z:10},{x:18,y:2,z:11},{x:18,y:2,z:12},{x:18,y:2,z:13},{x:18,y:2,z:16},{x:18,y:2,z:17},{x:18,y:3,z:0,ry:3},{x:18,y:3,z:1,ry:1},{x:18,y:3,z:2,ry:2},{x:18,y:3,z:11,ry:1},{x:18,y:3,z:12},{x:18,y:3,z:13,ry:1},{x:18,y:3,z:14,ry:1},{x:18,y:3,z:15,ry:1},{x:18,y:3,z:16,ry:3},{x:18,y:3,z:17,ry:3},{x:19,y:0,z:8},{x:19,y:0,z:14,ry:1},{x:19,y:2,z:0},{x:19,y:2,z:1},{x:19,y:2,z:2},{x:19,y:2,z:3},{x:19,y:2,z:4},{x:19,y:2,z:5},{x:19,y:2,z:6},{x:19,y:2,z:7},{x:19,y:2,z:8},{x:19,y:2,z:9},{x:19,y:2,z:10},{x:19,y:2,z:11},{x:19,y:2,z:12},{x:19,y:2,z:13},{x:19,y:2,z:16},{x:19,y:2,z:17},{x:19,y:3,z:0,ry:3},{x:19,y:3,z:1,ry:1},{x:19,y:3,z:2,ry:1},{x:19,y:3,z:3,ry:1},{x:19,y:3,z:4,ry:1},{x:19,y:3,z:5},{x:19,y:3,z:11,ry:1},{x:19,y:3,z:12,ry:1},{x:19,y:3,z:13,ry:1},{x:19,y:3,z:14,ry:1},{x:19,y:3,z:15,ry:1},{x:19,y:3,z:16,ry:3},{x:19,y:3,z:17,ry:3},{x:20,y:0,z:8},{x:20,y:0,z:14,ry:1},{x:20,y:2,z:0},{x:20,y:2,z:1},{x:20,y:2,z:2},{x:20,y:2,z:3},{x:20,y:2,z:5},{x:20,y:2,z:6},{x:20,y:2,z:7},{x:20,y:2,z:9},{x:20,y:2,z:10},{x:20,y:2,z:11},{x:20,y:2,z:13},{x:20,y:2,z:16},{x:20,y:2,z:17},{x:20,y:3,z:0,ry:3},{x:20,y:3,z:1},{x:20,y:3,z:2},{x:20,y:3,z:3},{x:20,y:3,z:4},{x:20,y:3,z:5},{x:20,y:3,z:11},{x:20,y:3,z:12},{x:20,y:3,z:13},{x:20,y:3,z:15,ry:1},{x:20,y:3,z:16,ry:3},{x:20,y:3,z:17,ry:3},{x:21,y:2,z:0},{x:21,y:2,z:1},{x:21,y:2,z:2},{x:21,y:2,z:3},{x:21,y:2,z:4},{x:21,y:2,z:5},{x:21,y:2,z:6},{x:21,y:2,z:7},{x:21,y:2,z:8},{x:21,y:2,z:9,ry:3},{x:21,y:2,z:10},{x:21,y:2,z:11},{x:21,y:2,z:12},{x:21,y:2,z:13},{x:21,y:2,z:14},{x:21,y:2,z:15},{x:21,y:2,z:16},{x:21,y:2,z:17},{x:21,y:3,z:0,ry:3},{x:21,y:3,z:1,ry:3},{x:21,y:3,z:2,ry:3},{x:21,y:3,z:3,ry:3},{x:21,y:3,z:4,ry:3},{x:21,y:3,z:5,ry:3},{x:21,y:3,z:6,ry:1},{x:21,y:3,z:10,ry:1},{x:21,y:3,z:11,ry:3},{x:21,y:3,z:12,ry:3},{x:21,y:3,z:13,ry:3},{x:21,y:3,z:14,ry:3},{x:21,y:3,z:15,ry:3},{x:21,y:3,z:16,ry:3},{x:21,y:3,z:17,ry:3}],"generic.grass.full":[{x:0,y:0,z:13},{x:0,y:0,z:14},{x:0,y:0,z:15},{x:0,y:0,z:16,ry:3},{x:0,y:0,z:17},{x:1,y:0,z:3},{x:1,y:0,z:4},{x:1,y:0,z:5},{x:1,y:0,z:6},{x:1,y:0,z:7},{x:1,y:0,z:8},{x:1,y:0,z:9},{x:1,y:0,z:10},{x:1,y:0,z:11},{x:1,y:0,z:17},{x:2,y:0,z:0},{x:2,y:0,z:4},{x:2,y:0,z:5},{x:2,y:0,z:6},{x:2,y:0,z:7},{x:2,y:0,z:8},{x:2,y:0,z:10},{x:2,y:0,z:11},{x:2,y:0,z:13},{x:2,y:0,z:14},{x:2,y:0,z:16},{x:2,y:0,z:17},{x:2,y:1,z:5},{x:2,y:1,z:6},{x:2,y:1,z:7},{x:3,y:0,z:0},{x:3,y:0,z:1},{x:3,y:0,z:2},{x:3,y:0,z:4},{x:3,y:0,z:5},{x:3,y:0,z:6},{x:3,y:0,z:7},{x:3,y:0,z:8},{x:3,y:0,z:10},{x:3,y:0,z:11},{x:3,y:0,z:13},{x:3,y:0,z:14},{x:3,y:0,z:16},{x:3,y:0,z:17},{x:3,y:1,z:5},{x:3,y:1,z:6},{x:3,y:1,z:7},{x:4,y:0,z:0},{x:4,y:0,z:1},{x:4,y:0,z:2},{x:4,y:0,z:4},{x:4,y:0,z:5},{x:4,y:0,z:6},{x:4,y:0,z:7},{x:4,y:0,z:8},{x:4,y:0,z:10},{x:4,y:0,z:11},{x:4,y:0,z:14},{x:4,y:0,z:16},{x:4,y:0,z:17},{x:4,y:1,z:5},{x:4,y:1,z:6},{x:4,y:1,z:7},{x:5,y:0,z:0},{x:5,y:0,z:1},{x:5,y:0,z:2},{x:5,y:0,z:4},{x:5,y:0,z:5},{x:5,y:0,z:6},{x:5,y:0,z:7},{x:5,y:0,z:8},{x:5,y:0,z:10},{x:5,y:0,z:11},{x:5,y:0,z:14},{x:5,y:0,z:16},{x:5,y:0,z:17},{x:6,y:0,z:0},{x:6,y:0,z:14},{x:6,y:0,z:16},{x:6,y:0,z:17},{x:6,y:2,z:12},{x:6,y:2,z:13},{x:6,y:2,z:14},{x:7,y:0,z:0},{x:7,y:0,z:2},{x:7,y:0,z:3},{x:7,y:0,z:4},{x:7,y:0,z:5},{x:7,y:0,z:7},{x:7,y:0,z:8},{x:7,y:0,z:9},{x:7,y:0,z:14},{x:7,y:0,z:16},{x:7,y:0,z:17},{x:7,y:2,z:13},{x:7,y:2,z:14},{x:8,y:0,z:0},{x:8,y:0,z:1},{x:8,y:0,z:2},{x:8,y:0,z:3},{x:8,y:0,z:4},{x:8,y:0,z:5},{x:8,y:0,z:7},{x:8,y:0,z:8},{x:8,y:0,z:9},{x:8,y:0,z:17},{x:8,y:2,z:14},{x:9,y:0,z:0},{x:9,y:0,z:1},{x:9,y:0,z:2},{x:9,y:0,z:3},{x:9,y:0,z:4},{x:9,y:0,z:5},{x:9,y:0,z:7},{x:9,y:0,z:8},{x:9,y:0,z:9},{x:9,y:0,z:11},{x:9,y:0,z:12},{x:9,y:0,z:13},{x:9,y:0,z:14},{x:9,y:0,z:16},{x:9,y:0,z:17},{x:10,y:0,z:0},{x:10,y:0,z:1,ry:3},{x:10,y:0,z:2},{x:10,y:0,z:3},{x:10,y:0,z:4},{x:10,y:0,z:5},{x:10,y:0,z:11},{x:10,y:0,z:12},{x:10,y:0,z:13},{x:10,y:0,z:14},{x:10,y:0,z:16},{x:10,y:0,z:17},{x:10,y:2,z:4},{x:11,y:0,z:0,ry:3},{x:11,y:0,z:1,ry:3},{x:11,y:0,z:2},{x:11,y:0,z:3},{x:11,y:0,z:8},{x:11,y:0,z:9},{x:11,y:0,z:10},{x:11,y:0,z:11},{x:11,y:0,z:12},{x:11,y:0,z:13},{x:11,y:0,z:14},{x:11,y:0,z:16},{x:11,y:0,z:17},{x:11,y:2,z:4},{x:12,y:0,z:0},{x:12,y:0,z:1},{x:12,y:0,z:2},{x:12,y:0,z:3},{x:12,y:0,z:5},{x:12,y:0,z:6},{x:12,y:0,z:7},{x:12,y:0,z:8},{x:12,y:0,z:9},{x:12,y:0,z:10},{x:12,y:0,z:11},{x:12,y:0,z:12},{x:12,y:0,z:13},{x:12,y:0,z:14},{x:12,y:0,z:16},{x:12,y:0,z:17},{x:12,y:1,z:9},{x:12,y:1,z:10},{x:12,y:1,z:11},{x:12,y:2,z:4},{x:13,y:0,z:0},{x:13,y:0,z:1},{x:13,y:0,z:2},{x:13,y:0,z:3},{x:13,y:0,z:5},{x:13,y:0,z:6},{x:13,y:0,z:7},{x:13,y:0,z:8},{x:13,y:0,z:9},{x:13,y:0,z:10},{x:13,y:0,z:11},{x:13,y:0,z:12},{x:13,y:0,z:13},{x:13,y:0,z:14,ry:1},{x:13,y:0,z:16},{x:13,y:0,z:17},{x:13,y:1,z:9},{x:13,y:1,z:10},{x:13,y:1,z:11},{x:13,y:2,z:4},{x:14,y:0,z:0},{x:14,y:0,z:5},{x:14,y:0,z:6},{x:14,y:0,z:8},{x:14,y:0,z:9},{x:14,y:0,z:10},{x:14,y:0,z:11},{x:14,y:0,z:12},{x:14,y:0,z:13},{x:14,y:0,z:14},{x:14,y:0,z:16},{x:14,y:0,z:17},{x:14,y:1,z:9},{x:14,y:1,z:10},{x:14,y:1,z:11},{x:14,y:1,z:13},{x:14,y:2,z:4},{x:15,y:0,z:0},{x:15,y:0,z:1},{x:15,y:0,z:2},{x:15,y:0,z:3,ry:3},{x:15,y:0,z:5},{x:15,y:0,z:8},{x:15,y:0,z:12},{x:15,y:0,z:13},{x:15,y:0,z:14},{x:15,y:0,z:16},{x:15,y:0,z:17},{x:15,y:1,z:13},{x:15,y:2,z:4},{x:16,y:0,z:0},{x:16,y:0,z:1},{x:16,y:0,z:2},{x:16,y:0,z:3},{x:16,y:0,z:8},{x:16,y:0,z:11},{x:16,y:0,z:12},{x:16,y:0,z:13},{x:16,y:0,z:14},{x:16,y:0,z:16},{x:16,y:0,z:17},{x:16,y:2,z:4},{x:17,y:0,z:0},{x:17,y:0,z:1},{x:17,y:0,z:2},{x:17,y:0,z:3},{x:17,y:0,z:4},{x:17,y:0,z:5},{x:17,y:0,z:6},{x:17,y:0,z:13},{x:17,y:0,z:14},{x:17,y:0,z:16},{x:17,y:0,z:17},{x:17,y:2,z:4},{x:18,y:0,z:0},{x:18,y:0,z:1},{x:18,y:0,z:2},{x:18,y:0,z:3},{x:18,y:0,z:4},{x:18,y:0,z:5},{x:18,y:0,z:6},{x:18,y:0,z:7},{x:18,y:0,z:9},{x:18,y:0,z:10},{x:18,y:0,z:16},{x:18,y:0,z:17},{x:18,y:2,z:7},{x:18,y:2,z:8},{x:18,y:2,z:9},{x:19,y:0,z:0},{x:19,y:0,z:1},{x:19,y:0,z:2},{x:19,y:0,z:3},{x:19,y:0,z:4},{x:19,y:0,z:5},{x:19,y:0,z:6},{x:19,y:0,z:7},{x:19,y:0,z:9},{x:19,y:0,z:10},{x:19,y:0,z:11},{x:19,y:0,z:12},{x:19,y:0,z:13},{x:19,y:0,z:15},{x:19,y:0,z:16},{x:19,y:0,z:17},{x:20,y:0,z:0},{x:20,y:0,z:1},{x:20,y:0,z:2},{x:20,y:0,z:3},{x:20,y:0,z:4},{x:20,y:0,z:5},{x:20,y:0,z:6},{x:20,y:0,z:7},{x:20,y:0,z:9},{x:20,y:0,z:10},{x:20,y:0,z:11},{x:20,y:0,z:12},{x:20,y:0,z:13},{x:20,y:0,z:15},{x:20,y:0,z:16},{x:20,y:0,z:17},{x:21,y:0,z:0},{x:21,y:0,z:1},{x:21,y:0,z:2},{x:21,y:0,z:3},{x:21,y:0,z:4},{x:21,y:0,z:5},{x:21,y:0,z:6,ry:3},{x:21,y:0,z:7},{x:21,y:0,z:8},{x:21,y:0,z:9},{x:21,y:0,z:10},{x:21,y:0,z:11},{x:21,y:0,z:12},{x:21,y:0,z:13},{x:21,y:0,z:14},{x:21,y:0,z:15},{x:21,y:0,z:16},{x:21,y:0,z:17}],"generic.metal-ladder.ladder":[{x:0,y:1,z:11,ry:1},{x:1,y:1,z:16},{x:1,y:2,z:16},{x:1,y:3,z:16},{x:2,y:1,z:1,ry:1},{x:2,y:2,z:1,ry:1},{x:2,y:3,z:1,ry:1},{x:3,y:4,z:1,ry:2},{x:4,y:1,z:13,ry:3},{x:4,y:2,z:13,ry:3},{x:7,y:5,z:0,ry:1},{x:8,y:1,z:16},{x:8,y:2,z:16},{x:9,y:4,z:1,ry:2},{x:9,y:5,z:1,ry:2},{x:10,y:2,z:1,ry:2},{x:10,y:3,z:1,ry:2},{x:11,y:1,z:7,ry:1},{x:11,y:3,z:15,ry:1},{x:14,y:1,z:2,ry:2},{x:14,y:2,z:2,ry:2},{x:14,y:3,z:15},{x:16,y:1,z:9,ry:3},{x:16,y:2,z:11,ry:1},{x:16,y:4,z:1},{x:16,y:5,z:1},{x:20,y:1,z:8,ry:1},{x:20,y:1,z:14,ry:2},{x:20,y:2,z:8,ry:1},{x:20,y:2,z:14,ry:2},{x:20,y:3,z:14,ry:2},{x:20,y:4,z:5,ry:3},{x:20,y:4,z:12,ry:1},{x:20,y:5,z:5,ry:3},{x:20,y:5,z:12,ry:1}],"generic.inset-blue.full":[{x:0,y:1,z:13},{x:0,y:1,z:14},{x:0,y:1,z:15},{x:0,y:1,z:16},{x:0,y:1,z:17,ry:1},{x:0,y:2,z:15},{x:0,y:2,z:16},{x:0,y:2,z:17,ry:1},{x:0,y:3,z:15},{x:0,y:3,z:16,ry:2},{x:0,y:3,z:17,ry:2},{x:1,y:1,z:17,ry:3},{x:1,y:2,z:15,ry:1},{x:1,y:2,z:17,ry:3},{x:1,y:3,z:15,ry:3},{x:1,y:3,z:17,ry:3},{x:2,y:1,z:0,ry:1},{x:2,y:1,z:13,ry:1},{x:2,y:1,z:14,ry:1},{x:2,y:1,z:16},{x:2,y:1,z:17,ry:1},{x:2,y:2,z:0,ry:1},{x:2,y:2,z:15},{x:2,y:2,z:16},{x:2,y:2,z:17,ry:1},{x:2,y:3,z:0,ry:1},{x:2,y:3,z:15,ry:3},{x:2,y:3,z:16,ry:2},{x:2,y:3,z:17,ry:2},{x:2,y:4,z:0,ry:1},{x:3,y:1,z:0,ry:1},{x:3,y:1,z:13,ry:3},{x:3,y:1,z:14,ry:3},{x:3,y:1,z:16,ry:3},{x:3,y:1,z:17,ry:3},{x:3,y:2,z:0,ry:1},{x:3,y:3,z:0,ry:3},{x:3,y:4,z:0,ry:1},{x:4,y:1,z:0,ry:1},{x:4,y:1,z:14,ry:1},{x:4,y:1,z:16,ry:3},{x:4,y:1,z:17,ry:3},{x:4,y:2,z:0,ry:1},{x:4,y:3,z:0,ry:3},{x:4,y:4,z:0},{x:4,y:4,z:1,ry:2},{x:5,y:1,z:0,ry:1},{x:5,y:1,z:14,ry:1},{x:5,y:1,z:16,ry:3},{x:5,y:1,z:17,ry:3},{x:5,y:2,z:0,ry:1},{x:5,y:3,z:0,ry:3},{x:5,y:4,z:0,ry:1},{x:6,y:1,z:0,ry:1},{x:6,y:1,z:14,ry:1},{x:6,y:1,z:16,ry:3},{x:6,y:1,z:17,ry:3},{x:6,y:2,z:0,ry:1},{x:6,y:3,z:0,ry:3},{x:6,y:4,z:0,ry:1},{x:7,y:1,z:0,ry:1},{x:7,y:1,z:14,ry:3},{x:7,y:1,z:16,ry:3},{x:7,y:1,z:17,ry:3},{x:7,y:2,z:0,ry:1},{x:7,y:3,z:0,ry:1},{x:7,y:4,z:0,ry:1},{x:8,y:1,z:0,ry:1},{x:8,y:1,z:17,ry:3},{x:8,y:2,z:0,ry:1},{x:8,y:3,z:0,ry:1},{x:8,y:4,z:0,ry:3},{x:8,y:5,z:0},{x:8,y:5,z:1},{x:8,y:5,z:2},{x:8,y:5,z:3,ry:1},{x:9,y:1,z:0,ry:3},{x:9,y:1,z:1,ry:3},{x:9,y:1,z:2,ry:1},{x:9,y:1,z:16},{x:9,y:1,z:17,ry:3},{x:9,y:4,z:0,ry:3},{x:9,y:5,z:0},{x:9,y:5,z:2},{x:9,y:5,z:3,ry:1},{x:10,y:1,z:0,ry:3},{x:10,y:1,z:1,ry:3},{x:10,y:1,z:2,ry:3},{x:10,y:1,z:16,ry:3},{x:10,y:1,z:17,ry:3},{x:10,y:5,z:0},{x:10,y:5,z:1},{x:10,y:5,z:2},{x:10,y:5,z:3,ry:1},{x:11,y:1,z:0,ry:3},{x:11,y:1,z:1,ry:3},{x:11,y:1,z:2,ry:3},{x:11,y:1,z:16,ry:3},{x:11,y:1,z:17,ry:3},{x:11,y:3,z:16},{x:11,y:3,z:17,ry:1},{x:11,y:4,z:16},{x:11,y:4,z:17,ry:2},{x:11,y:5,z:0},{x:11,y:5,z:1,ry:1},{x:11,y:6,z:0,ry:1},{x:12,y:1,z:0,ry:3},{x:12,y:1,z:1,ry:3},{x:12,y:1,z:2,ry:3},{x:12,y:1,z:16,ry:3},{x:12,y:1,z:17,ry:3},{x:12,y:4,z:0,ry:2},{x:12,y:5,z:0},{x:12,y:5,z:1,ry:1},{x:13,y:1,z:0,ry:3},{x:13,y:1,z:1,ry:3},{x:13,y:1,z:2,ry:3},{x:13,y:1,z:16,ry:3},{x:13,y:1,z:17,ry:3},{x:13,y:5,z:0},{x:13,y:5,z:1,ry:1},{x:14,y:1,z:0,ry:3},{x:14,y:1,z:1,ry:3},{x:14,y:1,z:16,ry:3},{x:14,y:1,z:17,ry:3},{x:14,y:5,z:0},{x:14,y:5,z:1,ry:1},{x:15,y:1,z:0,ry:3},{x:15,y:1,z:1,ry:3},{x:15,y:1,z:2,ry:1},{x:15,y:1,z:16,ry:3},{x:15,y:1,z:17,ry:3},{x:15,y:5,z:0},{x:15,y:5,z:1},{x:15,y:5,z:2,ry:1},{x:16,y:1,z:0,ry:3},{x:16,y:1,z:1,ry:3},{x:16,y:1,z:2,ry:3},{x:16,y:1,z:16,ry:3},{x:16,y:1,z:17,ry:3},{x:16,y:4,z:2,ry:2},{x:16,y:5,z:0,ry:1},{x:16,y:5,z:2},{x:16,y:5,z:3,ry:1},{x:17,y:1,z:0,ry:3},{x:17,y:1,z:1,ry:3},{x:17,y:1,z:2,ry:3},{x:17,y:1,z:16,ry:3},{x:17,y:1,z:17,ry:3},{x:17,y:5,z:0},{x:17,y:5,z:1},{x:17,y:5,z:2},{x:17,y:5,z:3,ry:1},{x:18,y:1,z:0,ry:3},{x:18,y:1,z:1,ry:3},{x:18,y:1,z:2,ry:3},{x:18,y:1,z:3},{x:18,y:1,z:4},{x:18,y:1,z:5},{x:18,y:1,z:6,ry:1},{x:18,y:1,z:16,ry:3},{x:18,y:1,z:17,ry:3},{x:18,y:5,z:0},{x:18,y:5,z:1},{x:18,y:5,z:2},{x:18,y:5,z:3},{x:18,y:5,z:4},{x:18,y:5,z:5,ry:1},{x:18,y:5,z:11},{x:18,y:5,z:12},{x:18,y:5,z:13,ry:1},{x:18,y:6,z:0,ry:1},{x:19,y:1,z:0,ry:3},{x:19,y:1,z:1,ry:3},{x:19,y:1,z:2,ry:3},{x:19,y:1,z:3,ry:3},{x:19,y:1,z:4,ry:3},{x:19,y:1,z:5,ry:3},{x:19,y:1,z:6,ry:3},{x:19,y:1,z:7,ry:1},{x:19,y:1,z:9,ry:1},{x:19,y:1,z:16,ry:3},{x:19,y:1,z:17,ry:3},{x:19,y:4,z:5,ry:1},{x:19,y:5,z:0},{x:19,y:5,z:1},{x:19,y:5,z:2},{x:19,y:5,z:3},{x:19,y:5,z:4},{x:19,y:5,z:5},{x:19,y:5,z:6,ry:1},{x:19,y:5,z:11},{x:19,y:5,z:12},{x:19,y:5,z:13,ry:1},{x:20,y:1,z:0,ry:3},{x:20,y:1,z:1,ry:3},{x:20,y:1,z:2,ry:3},{x:20,y:1,z:3,ry:3},{x:20,y:1,z:4,ry:3},{x:20,y:1,z:5,ry:3},{x:20,y:1,z:6,ry:3},{x:20,y:1,z:7,ry:3},{x:20,y:1,z:9,ry:3},{x:20,y:1,z:10},{x:20,y:1,z:11},{x:20,y:1,z:12},{x:20,y:1,z:13},{x:20,y:1,z:16,ry:3},{x:20,y:1,z:17,ry:3},{x:20,y:5,z:0,ry:1},{x:20,y:5,z:2},{x:20,y:5,z:3},{x:20,y:5,z:4},{x:20,y:5,z:6},{x:20,y:5,z:7},{x:20,y:5,z:8,ry:1},{x:20,y:5,z:9},{x:20,y:5,z:10},{x:20,y:5,z:11},{x:20,y:5,z:13,ry:1},{x:21,y:1,z:0,ry:3},{x:21,y:1,z:1,ry:3},{x:21,y:1,z:2,ry:3},{x:21,y:1,z:3,ry:3},{x:21,y:1,z:4,ry:3},{x:21,y:1,z:5,ry:3},{x:21,y:1,z:6,ry:3},{x:21,y:1,z:7,ry:3},{x:21,y:1,z:8},{x:21,y:1,z:9,ry:3},{x:21,y:1,z:10,ry:3},{x:21,y:1,z:11,ry:3},{x:21,y:1,z:12,ry:3},{x:21,y:1,z:13,ry:3},{x:21,y:1,z:14},{x:21,y:1,z:15},{x:21,y:1,z:16,ry:3},{x:21,y:1,z:17,ry:3},{x:21,y:4,z:0,ry:1},{x:21,y:4,z:6,ry:1},{x:21,y:4,z:10,ry:1},{x:21,y:4,z:12},{x:21,y:4,z:13,ry:2},{x:21,y:4,z:14,ry:2},{x:21,y:4,z:15,ry:2},{x:21,y:4,z:16,ry:2},{x:21,y:4,z:17,ry:2},{x:21,y:5,z:0},{x:21,y:5,z:1},{x:21,y:5,z:2},{x:21,y:5,z:3,ry:2},{x:21,y:5,z:4},{x:21,y:5,z:5},{x:21,y:5,z:6},{x:21,y:5,z:7,ry:2},{x:21,y:5,z:8,ry:2},{x:21,y:5,z:9},{x:21,y:5,z:10},{x:21,y:5,z:11},{x:21,y:5,z:12},{x:21,y:5,z:13,ry:2},{x:21,y:6,z:3,ry:1},{x:21,y:6,z:10,ry:1}],"generic.stairs.wedge":[{x:1,y:1,z:3},{x:2,y:1,z:9,ry:3},{x:4,y:2,z:11,ry:1},{x:8,y:1,z:1,ry:1},{x:9,y:1,z:11,ry:1},{x:9,y:2,z:12,ry:3},{x:12,y:2,z:14,ry:1},{x:12,y:3,z:2,ry:3},{x:13,y:2,z:6,ry:2},{x:15,y:1,z:7},{x:16,y:2,z:14,ry:3},{x:17,y:1,z:14,ry:3},{x:20,y:3,z:6,ry:2},{x:20,y:3,z:10},{x:20,y:4,z:17,ry:1},{x:21,y:5,z:14,ry:2}],"generic.barricade.aabb":[{x:1,y:4,z:15,ry:3},{x:2,y:4,z:15},{x:2,y:4,z:16,ry:3},{x:4,y:5,z:1},{x:7,y:3,z:11},{x:8,y:6,z:3},{x:9,y:3,z:13},{x:10,y:6,z:3},{x:12,y:3,z:6},{x:12,y:3,z:13},{x:16,y:3,z:8},{x:16,y:3,z:10},{x:16,y:6,z:3},{x:18,y:6,z:5},{x:18,y:6,z:11},{x:18,y:6,z:13}],"nature.tree-01.aabb":[{x:3,y:2,z:6},{x:8,y:1,z:8},{x:13,y:2,z:10}],"SPECIAL.barrier.full.verysoft":[{x:11,y:5,z:16},{x:11,y:5,z:17},{x:11,y:7,z:0},{x:18,y:7,z:0},{x:21,y:7,z:3},{x:21,y:7,z:10}],"generic.pavement.full":[{x:16,y:1,z:13},{x:16,y:1,z:14}],"generic.green-block.full":[{x:20,y:2,z:12}]},palette:["nature.rocks-big.aabb","nature.dirtwalk-center.full","generic.stairs.wedge","scifi.computer.obb",null,null,null,null,null,null],width:22,height:8,depth:18,name:"",surfaceArea:552},{skybox:"moonbase",fileVersion:1,data:{"SPECIAL.barrier.full.verysoft":[{x:0,y:0,z:0},{x:0,y:0,z:1},{x:0,y:0,z:2},{x:0,y:0,z:3},{x:0,y:0,z:4},{x:0,y:0,z:5},{x:0,y:0,z:11},{x:0,y:0,z:12},{x:0,y:0,z:13},{x:0,y:0,z:14},{x:0,y:0,z:15},{x:0,y:0,z:16},{x:0,y:2,z:3},{x:0,y:2,z:4},{x:0,y:2,z:5},{x:0,y:2,z:6},{x:0,y:2,z:7},{x:0,y:2,z:8},{x:0,y:2,z:9},{x:0,y:2,z:10},{x:0,y:3,z:2},{x:0,y:3,z:3},{x:0,y:3,z:4},{x:0,y:3,z:5},{x:0,y:4,z:2},{x:0,y:4,z:3},{x:0,y:4,z:4},{x:0,y:4,z:5},{x:0,y:4,z:6},{x:0,y:5,z:2},{x:0,y:5,z:3},{x:0,y:5,z:4},{x:0,y:5,z:5},{x:0,y:5,z:6},{x:0,y:5,z:7},{x:0,y:5,z:8},{x:0,y:6,z:3},{x:0,y:6,z:4},{x:0,y:6,z:5},{x:0,y:6,z:6},{x:0,y:6,z:7},{x:0,y:6,z:8},{x:0,y:6,z:9},{x:0,y:6,z:10},{x:0,y:6,z:11},{x:0,y:7,z:3},{x:0,y:7,z:4},{x:0,y:7,z:5},{x:0,y:7,z:6},{x:0,y:7,z:7},{x:0,y:7,z:8},{x:0,y:7,z:9},{x:0,y:7,z:10},{x:0,y:7,z:11},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:0,z:2},{x:1,y:0,z:3},{x:1,y:0,z:4},{x:1,y:0,z:5},{x:1,y:0,z:11},{x:1,y:0,z:12},{x:1,y:0,z:13},{x:1,y:0,z:14},{x:1,y:0,z:15},{x:1,y:0,z:16},{x:1,y:1,z:3},{x:1,y:1,z:4},{x:1,y:1,z:5},{x:1,y:2,z:2},{x:1,y:3,z:2},{x:1,y:4,z:2},{x:1,y:5,z:2},{x:1,y:6,z:3},{x:1,y:6,z:12},{x:1,y:6,z:13},{x:1,y:6,z:14},{x:1,y:6,z:15},{x:1,y:6,z:16},{x:1,y:7,z:2},{x:1,y:7,z:12},{x:1,y:7,z:13},{x:1,y:7,z:14},{x:1,y:7,z:15},{x:1,y:7,z:16},{x:1,y:8,z:11},{x:2,y:0,z:0},{x:2,y:0,z:1},{x:2,y:0,z:2},{x:2,y:0,z:3},{x:2,y:0,z:4},{x:2,y:0,z:5},{x:2,y:0,z:11},{x:2,y:0,z:12},{x:2,y:0,z:13},{x:2,y:0,z:14},{x:2,y:0,z:15},{x:2,y:0,z:16},{x:2,y:1,z:2},{x:2,y:1,z:3},{x:2,y:2,z:2},{x:2,y:3,z:2},{x:2,y:4,z:2},{x:2,y:5,z:0},{x:2,y:5,z:1},{x:2,y:5,z:2},{x:2,y:6,z:0,ry:2},{x:2,y:6,z:1},{x:2,y:6,z:2},{x:2,y:7,z:0},{x:2,y:7,z:1},{x:2,y:7,z:2},{x:2,y:8,z:11},{x:2,y:8,z:12},{x:2,y:8,z:13},{x:2,y:8,z:14},{x:2,y:8,z:15},{x:2,y:8,z:16},{x:3,y:7,z:5,ry:3},{x:3,y:7,z:6,ry:3},{x:3,y:7,z:7,ry:3},{x:3,y:7,z:8,ry:3},{x:4,y:7,z:6},{x:5,y:7,z:8,ry:3},{x:6,y:7,z:2},{x:6,y:7,z:5,ry:3},{x:6,y:7,z:6,ry:3},{x:6,y:7,z:8,ry:3},{x:6,y:8,z:11},{x:7,y:4,z:6,ry:3},{x:7,y:4,z:7,ry:3},{x:7,y:5,z:13,ry:3},{x:7,y:8,z:13},{x:8,y:7,z:4},{x:8,y:8,z:11},{x:9,y:4,z:3,ry:3},{x:9,y:8,z:13},{x:9,y:9,z:16},{x:10,y:8,z:11},{x:10,y:8,z:13},{x:10,y:9,z:16},{x:11,y:5,z:13,ry:3},{x:11,y:7,z:2},{x:11,y:7,z:3},{x:13,y:8,z:11},{x:15,y:5,z:2},{x:16,y:5,z:0}],"scifi.ground.full":[{x:0,y:0,z:6},{x:0,y:0,z:7},{x:0,y:0,z:8},{x:0,y:0,z:9},{x:0,y:0,z:10},{x:0,y:1,z:6,ry:1},{x:0,y:1,z:10,ry:1},{x:1,y:0,z:6},{x:1,y:0,z:10},{x:1,y:2,z:3},{x:1,y:2,z:4},{x:1,y:2,z:5},{x:1,y:2,z:6},{x:1,y:2,z:7},{x:1,y:2,z:8},{x:1,y:2,z:9},{x:1,y:2,z:10},{x:1,y:3,z:5},{x:1,y:3,z:6},{x:1,y:3,z:7},{x:1,y:3,z:8},{x:1,y:3,z:9},{x:1,y:3,z:10},{x:1,y:4,z:6},{x:1,y:4,z:7},{x:1,y:4,z:8},{x:1,y:4,z:9},{x:1,y:4,z:10},{x:1,y:5,z:7},{x:1,y:5,z:8},{x:1,y:5,z:9},{x:1,y:5,z:10},{x:1,y:6,z:9},{x:1,y:6,z:10},{x:1,y:6,z:11},{x:2,y:0,z:6},{x:2,y:0,z:7},{x:2,y:0,z:8},{x:2,y:0,z:9},{x:2,y:0,z:10},{x:2,y:1,z:4},{x:2,y:1,z:5},{x:2,y:2,z:3},{x:2,y:2,z:6},{x:2,y:2,z:7},{x:2,y:2,z:8},{x:2,y:2,z:9},{x:2,y:2,z:10},{x:2,y:3,z:7},{x:2,y:3,z:8},{x:2,y:3,z:10},{x:2,y:4,z:9},{x:2,y:4,z:10},{x:2,y:5,z:10},{x:2,y:6,z:11},{x:2,y:6,z:12},{x:2,y:6,z:13},{x:2,y:6,z:14},{x:2,y:6,z:15},{x:2,y:6,z:16},{x:3,y:0,z:0},{x:3,y:0,z:1},{x:3,y:0,z:2},{x:3,y:0,z:3},{x:3,y:0,z:4},{x:3,y:0,z:5},{x:3,y:0,z:7},{x:3,y:0,z:9},{x:3,y:0,z:11},{x:3,y:0,z:12},{x:3,y:0,z:13},{x:3,y:0,z:14},{x:3,y:0,z:15},{x:3,y:0,z:16},{x:3,y:1,z:0},{x:3,y:1,z:1},{x:3,y:1,z:2},{x:3,y:1,z:3},{x:3,y:1,z:4},{x:3,y:1,z:6},{x:3,y:1,z:10},{x:3,y:1,z:11},{x:3,y:1,z:12},{x:3,y:1,z:13},{x:3,y:1,z:14,ry:2},{x:3,y:1,z:15,ry:2},{x:3,y:1,z:16,ry:2},{x:3,y:2,z:0},{x:3,y:2,z:1},{x:3,y:2,z:2},{x:3,y:2,z:3},{x:3,y:2,z:5,ry:2},{x:3,y:2,z:6},{x:3,y:2,z:7},{x:3,y:2,z:8},{x:3,y:2,z:9},{x:3,y:2,z:10},{x:3,y:2,z:11},{x:3,y:2,z:12},{x:3,y:2,z:13},{x:3,y:2,z:14},{x:3,y:2,z:15},{x:3,y:2,z:16},{x:3,y:3,z:0},{x:3,y:3,z:1},{x:3,y:3,z:2},{x:3,y:3,z:3},{x:3,y:3,z:4},{x:3,y:3,z:5},{x:3,y:3,z:6},{x:3,y:3,z:11,ry:1},{x:3,y:3,z:12,ry:1},{x:3,y:3,z:13,ry:1},{x:3,y:3,z:14,ry:1},{x:3,y:3,z:15,ry:1},{x:3,y:3,z:16},{x:3,y:4,z:0},{x:3,y:4,z:1},{x:3,y:4,z:2},{x:3,y:4,z:3},{x:3,y:4,z:4,ry:1},{x:3,y:4,z:8,ry:1},{x:3,y:4,z:11,ry:2},{x:3,y:4,z:12,ry:1},{x:3,y:4,z:13,ry:1},{x:3,y:4,z:14,ry:1},{x:3,y:4,z:15,ry:1},{x:3,y:4,z:16},{x:3,y:5,z:2},{x:3,y:5,z:4},{x:3,y:5,z:5},{x:3,y:5,z:6},{x:3,y:5,z:7},{x:3,y:5,z:8},{x:3,y:5,z:9},{x:3,y:5,z:10},{x:3,y:5,z:11},{x:3,y:5,z:12},{x:3,y:5,z:13},{x:3,y:5,z:14},{x:3,y:5,z:15},{x:3,y:5,z:16},{x:4,y:0,z:0},{x:4,y:0,z:1},{x:4,y:0,z:2},{x:4,y:0,z:6},{x:4,y:0,z:7},{x:4,y:0,z:9},{x:4,y:0,z:10},{x:4,y:0,z:14},{x:4,y:0,z:15},{x:4,y:1,z:0},{x:4,y:1,z:3},{x:4,y:1,z:4},{x:4,y:1,z:5},{x:4,y:1,z:8},{x:4,y:1,z:11},{x:4,y:1,z:12},{x:4,y:1,z:13},{x:4,y:2,z:0},{x:4,y:2,z:8,ry:2},{x:4,y:3,z:0},{x:4,y:3,z:1},{x:4,y:3,z:2},{x:4,y:3,z:3},{x:4,y:3,z:4},{x:4,y:3,z:5},{x:4,y:3,z:6},{x:4,y:3,z:7},{x:4,y:3,z:9,ry:1},{x:4,y:3,z:10,ry:1},{x:4,y:4,z:0},{x:4,y:4,z:1},{x:4,y:4,z:3},{x:4,y:5,z:2},{x:4,y:5,z:3},{x:4,y:5,z:4},{x:4,y:5,z:5},{x:4,y:5,z:6},{x:4,y:5,z:7},{x:4,y:5,z:8},{x:4,y:5,z:9},{x:4,y:5,z:10},{x:4,y:5,z:11},{x:4,y:5,z:12},{x:4,y:5,z:13},{x:4,y:5,z:14},{x:4,y:5,z:15},{x:4,y:5,z:16},{x:5,y:0,z:0},{x:5,y:0,z:1},{x:5,y:0,z:2},{x:5,y:0,z:3},{x:5,y:0,z:6},{x:5,y:0,z:7},{x:5,y:0,z:14},{x:5,y:0,z:15},{x:5,y:0,z:16},{x:5,y:1,z:0},{x:5,y:1,z:4},{x:5,y:1,z:9},{x:5,y:1,z:10},{x:5,y:1,z:11},{x:5,y:1,z:12},{x:5,y:1,z:13},{x:5,y:1,z:16},{x:5,y:2,z:0},{x:5,y:2,z:3},{x:5,y:2,z:4,ry:2},{x:5,y:2,z:6},{x:5,y:2,z:7},{x:5,y:2,z:9},{x:5,y:2,z:10},{x:5,y:2,z:16},{x:5,y:3,z:1,ry:2},{x:5,y:3,z:2},{x:5,y:3,z:4},{x:5,y:3,z:10,ry:1},{x:5,y:3,z:16},{x:5,y:4,z:1},{x:5,y:4,z:4},{x:5,y:4,z:9,ry:3},{x:5,y:4,z:10,ry:3},{x:5,y:4,z:16},{x:5,y:5,z:2},{x:5,y:5,z:4},{x:5,y:5,z:5},{x:5,y:5,z:6},{x:5,y:5,z:7},{x:5,y:5,z:9},{x:5,y:5,z:10},{x:5,y:5,z:11},{x:5,y:5,z:12},{x:5,y:5,z:13},{x:5,y:5,z:14},{x:5,y:5,z:16},{x:6,y:0,z:0},{x:6,y:0,z:1},{x:6,y:0,z:3},{x:6,y:0,z:4},{x:6,y:0,z:5},{x:6,y:0,z:6},{x:6,y:0,z:7},{x:6,y:0,z:8},{x:6,y:0,z:10},{x:6,y:0,z:12},{x:6,y:0,z:13},{x:6,y:0,z:14},{x:6,y:0,z:15},{x:6,y:0,z:16,ry:2},{x:6,y:1,z:0},{x:6,y:1,z:16},{x:6,y:2,z:0},{x:6,y:2,z:1},{x:6,y:2,z:2},{x:6,y:2,z:3},{x:6,y:2,z:4},{x:6,y:2,z:5},{x:6,y:2,z:6},{x:6,y:2,z:7},{x:6,y:2,z:8},{x:6,y:2,z:9},{x:6,y:2,z:10},{x:6,y:2,z:11},{x:6,y:2,z:12},{x:6,y:2,z:13},{x:6,y:2,z:14},{x:6,y:2,z:15},{x:6,y:2,z:16},{x:6,y:3,z:11,ry:2},{x:6,y:3,z:16},{x:6,y:4,z:1},{x:6,y:4,z:11},{x:6,y:4,z:16},{x:6,y:5,z:2},{x:6,y:5,z:3},{x:6,y:5,z:4},{x:6,y:5,z:5},{x:6,y:5,z:6},{x:6,y:5,z:7},{x:6,y:5,z:8},{x:6,y:5,z:9},{x:6,y:5,z:10},{x:6,y:6,z:11,ry:3},{x:6,y:6,z:12,ry:3},{x:6,y:6,z:13,ry:3},{x:6,y:6,z:14,ry:3},{x:6,y:6,z:15,ry:3},{x:7,y:0,z:0},{x:7,y:0,z:2},{x:7,y:0,z:3},{x:7,y:0,z:4},{x:7,y:0,z:5},{x:7,y:0,z:7},{x:7,y:0,z:8},{x:7,y:0,z:9},{x:7,y:0,z:10},{x:7,y:0,z:11},{x:7,y:0,z:12},{x:7,y:0,z:13},{x:7,y:0,z:14},{x:7,y:0,z:15},{x:7,y:0,z:16},{x:7,y:2,z:0},{x:7,y:2,z:2},{x:7,y:2,z:3},{x:7,y:2,z:4},{x:7,y:2,z:5},{x:7,y:2,z:6},{x:7,y:2,z:7},{x:7,y:2,z:8},{x:7,y:2,z:9},{x:7,y:2,z:10},{x:7,y:2,z:11},{x:7,y:2,z:12},{x:7,y:2,z:13},{x:7,y:2,z:14},{x:7,y:2,z:15},{x:7,y:3,z:1,ry:1},{x:7,y:4,z:1},{x:7,y:4,z:11},{x:7,y:5,z:2},{x:7,y:5,z:3},{x:7,y:5,z:4},{x:7,y:5,z:5},{x:7,y:5,z:6},{x:7,y:5,z:7},{x:7,y:5,z:8},{x:7,y:5,z:9},{x:7,y:5,z:10},{x:7,y:5,z:11},{x:7,y:5,z:16,ry:3},{x:7,y:6,z:12,ry:3},{x:7,y:6,z:13,ry:3},{x:7,y:6,z:14,ry:3},{x:7,y:6,z:15,ry:3},{x:7,y:6,z:16,ry:3},{x:8,y:0,z:0},{x:8,y:0,z:1},{x:8,y:0,z:2},{x:8,y:0,z:3},{x:8,y:0,z:5},{x:8,y:0,z:6},{x:8,y:0,z:7},{x:8,y:0,z:8},{x:8,y:0,z:10},{x:8,y:0,z:12},{x:8,y:0,z:13},{x:8,y:0,z:14},{x:8,y:0,z:15},{x:8,y:0,z:16},{x:8,y:1,z:4},{x:8,y:1,z:9,ry:3},{x:8,y:2,z:1},{x:8,y:2,z:2},{x:8,y:2,z:3},{x:8,y:2,z:10},{x:8,y:2,z:12},{x:8,y:2,z:13},{x:8,y:2,z:14},{x:8,y:2,z:15},{x:8,y:3,z:1,ry:1},{x:8,y:3,z:11,ry:2},{x:8,y:4,z:1},{x:8,y:4,z:11},{x:8,y:5,z:3},{x:8,y:5,z:4},{x:8,y:5,z:5},{x:8,y:5,z:6},{x:8,y:5,z:7},{x:8,y:5,z:8},{x:8,y:5,z:9},{x:8,y:5,z:10},{x:8,y:5,z:11},{x:8,y:5,z:16,ry:3},{x:8,y:6,z:11,ry:3},{x:8,y:6,z:12,ry:3},{x:8,y:6,z:13,ry:3},{x:8,y:6,z:14,ry:3},{x:8,y:6,z:16,ry:3},{x:9,y:0,z:0},{x:9,y:0,z:1},{x:9,y:0,z:2},{x:9,y:0,z:4},{x:9,y:0,z:6},{x:9,y:0,z:8},{x:9,y:0,z:10},{x:9,y:0,z:11},{x:9,y:0,z:12},{x:9,y:0,z:14},{x:9,y:0,z:16},{x:9,y:1,z:4},{x:9,y:1,z:9},{x:9,y:1,z:16},{x:9,y:2,z:2},{x:9,y:2,z:3},{x:9,y:2,z:10},{x:9,y:2,z:11,ry:2},{x:9,y:2,z:12},{x:9,y:2,z:13},{x:9,y:3,z:0},{x:9,y:3,z:1,ry:2},{x:9,y:4,z:1},{x:9,y:5,z:2},{x:9,y:5,z:3},{x:9,y:5,z:4},{x:9,y:5,z:5},{x:9,y:5,z:6},{x:9,y:5,z:8},{x:9,y:5,z:9},{x:9,y:6,z:12,ry:3},{x:9,y:6,z:13,ry:3},{x:9,y:6,z:14,ry:3},{x:9,y:6,z:16,ry:3},{x:10,y:0,z:0},{x:10,y:0,z:1},{x:10,y:0,z:2},{x:10,y:0,z:5},{x:10,y:0,z:6},{x:10,y:0,z:7},{x:10,y:0,z:8},{x:10,y:0,z:10},{x:10,y:0,z:12},{x:10,y:0,z:13},{x:10,y:0,z:15},{x:10,y:0,z:16},{x:10,y:1,z:3,ry:2},{x:10,y:1,z:4},{x:10,y:1,z:9},{x:10,y:2,z:2},{x:10,y:2,z:10},{x:10,y:2,z:11,ry:2},{x:10,y:2,z:12},{x:10,y:2,z:13},{x:10,y:2,z:14},{x:10,y:2,z:15},{x:10,y:3,z:0},{x:10,y:3,z:1,ry:2},{x:10,y:3,z:11,ry:2},{x:10,y:4,z:1},{x:10,y:4,z:11},{x:10,y:5,z:2},{x:10,y:5,z:3},{x:10,y:5,z:4},{x:10,y:5,z:5},{x:10,y:5,z:6},{x:10,y:5,z:7},{x:10,y:5,z:8},{x:10,y:5,z:9},{x:10,y:5,z:10},{x:10,y:5,z:11},{x:10,y:5,z:16,ry:3},{x:10,y:6,z:11,ry:3},{x:10,y:6,z:12,ry:3},{x:10,y:6,z:13,ry:3},{x:10,y:6,z:14,ry:3},{x:10,y:6,z:16,ry:3},{x:11,y:0,z:0},{x:11,y:0,z:1},{x:11,y:0,z:3},{x:11,y:0,z:5},{x:11,y:0,z:7},{x:11,y:0,z:8},{x:11,y:0,z:10},{x:11,y:0,z:11},{x:11,y:0,z:13},{x:11,y:0,z:14},{x:11,y:0,z:15},{x:11,y:0,z:16},{x:11,y:1,z:2},{x:11,y:1,z:3},{x:11,y:1,z:4},{x:11,y:1,z:9},{x:11,y:2,z:2},{x:11,y:2,z:3},{x:11,y:2,z:6,ry:3},{x:11,y:2,z:10},{x:11,y:2,z:11},{x:11,y:2,z:12},{x:11,y:2,z:13},{x:11,y:2,z:14},{x:11,y:2,z:15},{x:11,y:3,z:0},{x:11,y:3,z:1,ry:2},{x:11,y:3,z:6},{x:11,y:4,z:1},{x:11,y:4,z:6},{x:11,y:4,z:11},{x:11,y:5,z:2},{x:11,y:5,z:3},{x:11,y:5,z:4},{x:11,y:5,z:5},{x:11,y:5,z:6},{x:11,y:5,z:7},{x:11,y:5,z:8},{x:11,y:5,z:9},{x:11,y:5,z:10},{x:11,y:5,z:11},{x:11,y:5,z:16,ry:3},{x:11,y:6,z:12,ry:3},{x:11,y:6,z:13,ry:3},{x:11,y:6,z:14,ry:3},{x:11,y:6,z:16,ry:3},{x:12,y:0,z:1},{x:12,y:0,z:2},{x:12,y:0,z:4},{x:12,y:0,z:7},{x:12,y:0,z:8},{x:12,y:0,z:11},{x:12,y:0,z:12},{x:12,y:0,z:13},{x:12,y:0,z:14},{x:12,y:0,z:16},{x:12,y:1,z:4},{x:12,y:1,z:5},{x:12,y:1,z:9},{x:12,y:1,z:10},{x:12,y:1,z:15},{x:12,y:1,z:16},{x:12,y:2,z:10},{x:12,y:2,z:11},{x:12,y:2,z:12},{x:12,y:2,z:13},{x:12,y:2,z:14},{x:12,y:2,z:15},{x:12,y:2,z:16},{x:12,y:3,z:0},{x:12,y:3,z:1,ry:2},{x:12,y:3,z:2},{x:12,y:3,z:6},{x:12,y:3,z:11,ry:2},{x:12,y:3,z:16},{x:12,y:4,z:1},{x:12,y:4,z:2},{x:12,y:4,z:3},{x:12,y:4,z:4},{x:12,y:4,z:5},{x:12,y:4,z:6},{x:12,y:4,z:11},{x:12,y:4,z:16},{x:12,y:5,z:6},{x:12,y:5,z:7},{x:12,y:5,z:8,ry:1},{x:12,y:5,z:10},{x:12,y:5,z:16,ry:1},{x:12,y:6,z:11,ry:3},{x:12,y:6,z:12,ry:3},{x:12,y:6,z:13,ry:3},{x:12,y:6,z:14,ry:3},{x:12,y:6,z:15,ry:3},{x:12,y:6,z:16,ry:3},{x:13,y:0,z:0},{x:13,y:0,z:1},{x:13,y:0,z:2},{x:13,y:0,z:3},{x:13,y:0,z:4},{x:13,y:0,z:10},{x:13,y:0,z:11},{x:13,y:0,z:12},{x:13,y:0,z:13},{x:13,y:0,z:16},{x:13,y:1,z:5},{x:13,y:1,z:6,ry:3},{x:13,y:1,z:7},{x:13,y:1,z:8},{x:13,y:1,z:9},{x:13,y:1,z:14},{x:13,y:1,z:15},{x:13,y:1,z:16},{x:13,y:2,z:3},{x:13,y:2,z:6},{x:13,y:2,z:12},{x:13,y:2,z:16},{x:13,y:3,z:0},{x:13,y:3,z:1},{x:13,y:3,z:2},{x:13,y:3,z:3},{x:13,y:3,z:4},{x:13,y:3,z:5},{x:13,y:3,z:6},{x:13,y:3,z:10},{x:13,y:3,z:11,ry:2},{x:13,y:3,z:16},{x:13,y:4,z:7},{x:13,y:4,z:8},{x:13,y:4,z:9},{x:13,y:4,z:11,ry:2},{x:13,y:4,z:16},{x:13,y:5,z:7},{x:13,y:5,z:8},{x:13,y:5,z:10},{x:13,y:6,z:11,ry:3},{x:13,y:6,z:12,ry:3},{x:13,y:6,z:14,ry:3},{x:13,y:6,z:15,ry:3},{x:14,y:0,z:0},{x:14,y:0,z:1},{x:14,y:0,z:3},{x:14,y:0,z:4},{x:14,y:0,z:5},{x:14,y:0,z:6},{x:14,y:0,z:12},{x:14,y:0,z:16},{x:14,y:1,z:8},{x:14,y:1,z:9},{x:14,y:1,z:10},{x:14,y:1,z:11},{x:14,y:1,z:14},{x:14,y:1,z:15},{x:14,y:1,z:16},{x:14,y:2,z:3},{x:14,y:2,z:7},{x:14,y:2,z:10},{x:14,y:2,z:11},{x:14,y:2,z:12},{x:14,y:2,z:16},{x:14,y:3,z:0},{x:14,y:3,z:1},{x:14,y:3,z:2},{x:14,y:3,z:3},{x:14,y:3,z:16},{x:14,y:4,z:7},{x:14,y:4,z:8},{x:14,y:4,z:9},{x:14,y:4,z:10},{x:14,y:4,z:11,ry:2},{x:14,y:4,z:12,ry:2},{x:14,y:4,z:13,ry:2},{x:14,y:4,z:14,ry:2},{x:14,y:4,z:15,ry:2},{x:14,y:4,z:16},{x:14,y:5,z:7},{x:14,y:5,z:8,ry:2},{x:14,y:5,z:10},{x:14,y:5,z:11},{x:14,y:5,z:12},{x:14,y:5,z:13},{x:14,y:5,z:14},{x:15,y:0,z:0},{x:15,y:0,z:1},{x:15,y:0,z:2},{x:15,y:0,z:3},{x:15,y:0,z:4},{x:15,y:0,z:5},{x:15,y:0,z:6},{x:15,y:0,z:7},{x:15,y:0,z:11},{x:15,y:0,z:12},{x:15,y:0,z:13},{x:15,y:0,z:14},{x:15,y:0,z:16},{x:15,y:1,z:8},{x:15,y:1,z:9},{x:15,y:1,z:10},{x:15,y:1,z:15},{x:15,y:1,z:16},{x:15,y:2,z:3},{x:15,y:2,z:4},{x:15,y:2,z:5},{x:15,y:2,z:6},{x:15,y:2,z:7},{x:15,y:2,z:16},{x:15,y:3,z:0},{x:15,y:3,z:1},{x:15,y:3,z:2},{x:15,y:3,z:3},{x:15,y:3,z:16},{x:15,y:4,z:7},{x:15,y:4,z:8},{x:15,y:4,z:9},{x:15,y:4,z:10},{x:15,y:4,z:11},{x:15,y:4,z:12},{x:15,y:4,z:13},{x:15,y:4,z:14},{x:15,y:4,z:15},{x:15,y:5,z:7},{x:15,y:5,z:8,ry:2},{x:16,y:0,z:0},{x:16,y:0,z:1},{x:16,y:0,z:2},{x:16,y:0,z:3},{x:16,y:0,z:4},{x:16,y:0,z:5},{x:16,y:0,z:6},{x:16,y:0,z:7},{x:16,y:0,z:8},{x:16,y:0,z:9},{x:16,y:0,z:10},{x:16,y:0,z:11},{x:16,y:0,z:12},{x:16,y:0,z:13},{x:16,y:0,z:14},{x:16,y:0,z:15},{x:16,y:0,z:16},{x:16,y:1,z:3},{x:16,y:1,z:4},{x:16,y:1,z:5},{x:16,y:1,z:6},{x:16,y:1,z:14},{x:16,y:1,z:15},{x:16,y:1,z:16},{x:16,y:2,z:4},{x:16,y:2,z:5},{x:16,y:2,z:6},{x:16,y:2,z:7},{x:16,y:2,z:14},{x:16,y:2,z:15},{x:16,y:2,z:16},{x:16,y:3,z:0},{x:16,y:3,z:1},{x:16,y:3,z:2},{x:16,y:3,z:3},{x:16,y:3,z:7},{x:16,y:3,z:14},{x:16,y:3,z:15},{x:16,y:3,z:16},{x:16,y:4,z:7},{x:16,y:4,z:8},{x:16,y:4,z:9},{x:16,y:4,z:10},{x:16,y:4,z:11},{x:16,y:4,z:12},{x:16,y:4,z:16},{x:16,y:5,z:7},{x:16,y:5,z:8,ry:2}],"scifi.detailcube-alt.full":[{x:0,y:1,z:7},{x:0,y:1,z:8},{x:0,y:1,z:9},{x:1,y:1,z:10,ry:1},{x:2,y:1,z:6,ry:2},{x:2,y:1,z:10},{x:3,y:0,z:8},{x:3,y:4,z:6},{x:3,y:4,z:7},{x:3,y:5,z:3},{x:4,y:4,z:10,ry:3},{x:4,y:4,z:16,ry:1},{x:4,y:6,z:6,ry:3},{x:5,y:4,z:2},{x:5,y:6,z:8,ry:2},{x:6,y:0,z:2},{x:6,y:0,z:11},{x:6,y:1,z:9,ry:3},{x:6,y:6,z:6,ry:3},{x:7,y:1,z:6},{x:7,y:3,z:13,ry:2},{x:8,y:7,z:11,ry:2},{x:9,y:0,z:5},{x:9,y:1,z:3},{x:9,y:3,z:11},{x:9,y:5,z:7,ry:2},{x:9,y:7,z:13,ry:1},{x:10,y:0,z:11},{x:10,y:0,z:14},{x:10,y:7,z:11,ry:2},{x:10,y:7,z:13,ry:3},{x:11,y:1,z:6,ry:3},{x:11,y:3,z:13,ry:2},{x:11,y:6,z:3},{x:11,y:6,z:7,ry:2},{x:12,y:1,z:6,ry:3},{x:12,y:2,z:6},{x:14,y:0,z:2},{x:14,y:0,z:7},{x:14,y:0,z:13},{x:15,y:4,z:16},{x:16,y:6,z:7,ry:2}],"scifi.detailcube.full":[{x:1,y:1,z:6,ry:3},{x:3,y:4,z:5},{x:3,y:6,z:11,ry:1},{x:3,y:6,z:16,ry:1},{x:4,y:4,z:5,ry:3},{x:4,y:4,z:8,ry:1},{x:12,y:3,z:3,ry:3}],"scifi.power-generator.aabb":[{x:1,y:1,z:7,ry:1},{x:1,y:1,z:8,ry:1},{x:1,y:1,z:9,ry:1},{x:2,y:7,z:12},{x:2,y:7,z:13},{x:2,y:7,z:14},{x:2,y:7,z:15},{x:2,y:7,z:16},{x:4,y:4,z:6,ry:3},{x:4,y:4,z:7,ry:3},{x:7,y:1,z:16,ry:3},{x:7,y:4,z:16},{x:8,y:1,z:16,ry:3},{x:8,y:4,z:16},{x:9,y:8,z:16},{x:10,y:1,z:16,ry:3},{x:10,y:4,z:16},{x:10,y:8,z:16},{x:11,y:1,z:16,ry:3},{x:11,y:4,z:16}],"scifi.roof.wedge":[{x:1,y:3,z:4},{x:1,y:4,z:5},{x:1,y:5,z:6},{x:1,y:6,z:8}],"scifi.crate.full":[{x:1,y:7,z:11},{x:2,y:7,z:11},{x:3,y:6,z:5},{x:3,y:6,z:6},{x:3,y:6,z:7},{x:3,y:6,z:8},{x:5,y:3,z:9,ry:3},{x:5,y:6,z:13,ry:1},{x:6,y:5,z:16},{x:6,y:6,z:2,ry:2},{x:6,y:6,z:5},{x:6,y:6,z:8},{x:6,y:7,z:11},{x:7,y:1,z:0},{x:7,y:3,z:6},{x:7,y:3,z:7},{x:7,y:4,z:13,ry:2},{x:7,y:7,z:13},{x:8,y:1,z:0},{x:8,y:2,z:0},{x:8,y:6,z:4,ry:2},{x:8,y:7,z:15},{x:8,y:7,z:16,ry:2},{x:9,y:1,z:13,ry:2},{x:9,y:3,z:3,ry:1},{x:9,y:4,z:16},{x:9,y:7,z:16},{x:10,y:7,z:16},{x:11,y:1,z:0},{x:11,y:2,z:0},{x:11,y:4,z:13,ry:2},{x:11,y:6,z:2},{x:11,y:6,z:8,ry:2},{x:11,y:7,z:15},{x:11,y:7,z:16,ry:2},{x:12,y:6,z:8},{x:13,y:1,z:0},{x:13,y:2,z:0},{x:13,y:6,z:8},{x:13,y:7,z:11},{x:13,y:7,z:15,ry:2},{x:14,y:6,z:8},{x:15,y:4,z:2,ry:2},{x:15,y:6,z:8},{x:16,y:1,z:0},{x:16,y:2,z:0},{x:16,y:2,z:3},{x:16,y:4,z:0,ry:2},{x:16,y:5,z:11,ry:2},{x:16,y:6,z:8}],"scifi.ramp.wedge":[{x:2,y:2,z:5},{x:2,y:3,z:6},{x:2,y:4,z:8},{x:2,y:5,z:9},{x:3,y:5,z:1},{x:4,y:1,z:2},{x:4,y:1,z:6,ry:2},{x:4,y:1,z:10},{x:4,y:1,z:14,ry:2},{x:5,y:2,z:12,ry:1},{x:6,y:6,z:16,ry:1},{x:7,y:6,z:11},{x:8,y:2,z:4,ry:3},{x:8,y:2,z:9,ry:3},{x:8,y:3,z:0,ry:1},{x:8,y:5,z:2},{x:9,y:3,z:12,ry:2},{x:9,y:4,z:11,ry:2},{x:9,y:5,z:10,ry:2},{x:10,y:2,z:3,ry:2},{x:11,y:1,z:5,ry:1},{x:11,y:6,z:11},{x:12,y:1,z:7,ry:1},{x:12,y:5,z:5},{x:12,y:5,z:9,ry:3},{x:13,y:1,z:4,ry:3},{x:13,y:1,z:10,ry:2},{x:13,y:2,z:14,ry:3},{x:13,y:4,z:1,ry:3},{x:13,y:6,z:13,ry:3},{x:14,y:5,z:15,ry:2},{x:15,y:1,z:11,ry:2},{x:15,y:1,z:14},{x:15,y:2,z:8,ry:2},{x:15,y:3,z:4,ry:2},{x:16,y:4,z:15}],"scifi.computer.obb":[{x:3,y:6,z:12,ry:3},{x:3,y:6,z:13,ry:3},{x:3,y:6,z:14,ry:3},{x:3,y:6,z:15,ry:3},{x:5,y:3,z:6,ry:3},{x:5,y:3,z:7,ry:3},{x:7,y:3,z:15},{x:8,y:3,z:15},{x:9,y:1,z:0,ry:2},{x:9,y:7,z:15},{x:10,y:1,z:0,ry:2},{x:10,y:3,z:15},{x:10,y:7,z:15},{x:11,y:3,z:15},{x:14,y:1,z:0,ry:2},{x:15,y:1,z:0,ry:2},{x:16,y:1,z:1,ry:1},{x:16,y:1,z:2,ry:1}],"scifi.pipes.full":[{x:4,y:0,z:16,ry:3},{x:4,y:1,z:16,ry:3},{x:4,y:2,z:16,ry:3},{x:4,y:3,z:16,ry:3},{x:5,y:0,z:5},{x:5,y:0,z:8,ry:3},{x:5,y:1,z:5},{x:5,y:1,z:8,ry:3},{x:5,y:2,z:5},{x:5,y:2,z:8,ry:3},{x:5,y:3,z:5},{x:5,y:3,z:8,ry:3},{x:5,y:4,z:5},{x:5,y:4,z:8,ry:3},{x:5,y:5,z:8,ry:3},{x:7,y:0,z:1},{x:7,y:1,z:1},{x:7,y:2,z:1},{x:8,y:0,z:11,ry:2},{x:8,y:1,z:11,ry:2},{x:8,y:2,z:11,ry:2},{x:9,y:0,z:7,ry:2},{x:9,y:0,z:15},{x:9,y:1,z:7,ry:2},{x:9,y:1,z:15},{x:9,y:2,z:7,ry:2},{x:9,y:2,z:15},{x:9,y:3,z:7,ry:2},{x:9,y:3,z:15},{x:9,y:4,z:7,ry:2},{x:9,y:4,z:15},{x:9,y:5,z:15},{x:9,y:6,z:15},{x:11,y:0,z:12,ry:2},{x:11,y:1,z:12,ry:2},{x:12,y:0,z:0},{x:12,y:0,z:3},{x:12,y:1,z:0},{x:12,y:1,z:3},{x:12,y:2,z:0},{x:12,y:2,z:3}],"scifi.pipe.aabb":[{x:4,y:4,z:11,ry:1},{x:4,y:4,z:12,ry:1},{x:4,y:4,z:13,ry:1},{x:4,y:4,z:14,ry:1},{x:4,y:4,z:15,ry:1},{x:6,y:4,z:2},{x:7,y:4,z:2},{x:8,y:4,z:2},{x:9,y:2,z:0,ry:2},{x:9,y:4,z:2},{x:10,y:2,z:0},{x:10,y:4,z:2},{x:11,y:4,z:2},{x:12,y:6,z:7,ry:2},{x:13,y:6,z:7,ry:2},{x:14,y:2,z:0,ry:2},{x:14,y:6,z:7,ry:2},{x:15,y:2,z:0},{x:15,y:6,z:7,ry:2},{x:16,y:2,z:1,ry:1},{x:16,y:2,z:2,ry:3}],"generic.metal-ladder.ladder":[{x:5,y:1,z:15},{x:5,y:2,z:15},{x:5,y:3,z:0,ry:3},{x:5,y:3,z:3,ry:3},{x:5,y:3,z:15},{x:5,y:4,z:0,ry:3},{x:5,y:4,z:3,ry:3},{x:5,y:4,z:15},{x:5,y:5,z:3,ry:3},{x:5,y:5,z:15},{x:9,y:1,z:14,ry:2},{x:9,y:2,z:14,ry:2},{x:13,y:4,z:6,ry:3},{x:13,y:5,z:6,ry:3},{x:13,y:5,z:16,ry:3},{x:13,y:6,z:16,ry:3},{x:14,y:1,z:6,ry:3},{x:14,y:2,z:6,ry:3},{x:14,y:3,z:6,ry:3},{x:16,y:1,z:13},{x:16,y:2,z:13},{x:16,y:3,z:13}],"scifi.ceiling.iwedge":[{x:6,y:4,z:4,ry:1},{x:6,y:4,z:9,ry:1},{x:6,y:5,z:13,ry:1},{x:6,y:5,z:14,ry:1},{x:7,y:4,z:10,ry:2},{x:7,y:5,z:12},{x:7,y:5,z:15,ry:2},{x:8,y:4,z:10,ry:2},{x:8,y:5,z:12},{x:8,y:5,z:15,ry:2},{x:9,y:4,z:10,ry:2},{x:10,y:4,z:10,ry:2},{x:10,y:5,z:12},{x:10,y:5,z:15,ry:2},{x:11,y:4,z:3,ry:3},{x:11,y:4,z:4,ry:3},{x:11,y:4,z:5,ry:3},{x:11,y:4,z:10,ry:2},{x:11,y:5,z:12},{x:11,y:5,z:15,ry:2},{x:12,y:4,z:7,ry:3},{x:12,y:4,z:8,ry:3},{x:12,y:4,z:9,ry:3},{x:12,y:5,z:12},{x:12,y:5,z:15,ry:2},{x:13,y:5,z:13,ry:3},{x:13,y:5,z:14,ry:3}],"scifi.ceiling-corner.obb":[{x:6,y:4,z:10,ry:2},{x:6,y:5,z:12,ry:1},{x:6,y:5,z:15,ry:2},{x:12,y:4,z:10,ry:3},{x:13,y:5,z:12},{x:13,y:5,z:15,ry:3}],"generic.pavement.full":[{x:7,y:2,z:16},{x:7,y:3,z:16},{x:8,y:2,z:16},{x:8,y:3,z:16},{x:9,y:2,z:16},{x:9,y:3,z:16},{x:9,y:5,z:16},{x:10,y:2,z:16},{x:10,y:3,z:16},{x:11,y:2,z:16},{x:11,y:3,z:16}],"scifi.robot-taxi.aabb":[{x:15,y:5,z:6}]},palette:["castle.torch_1.obb","SPECIAL.barrier.full.verysoft","nature.rocks-big.aabb","nature.ground_02.full","castle.blue-banner.none","castle.brick.full","castle.brick-arch-center.aabb","generic.metal-ladder.ladder","nature.tree-03.full.verysoft","castle.red-banner.none"],width:17,height:10,depth:17,name:"",surfaceArea:560},{fileVersion:1,data:{"generic.grass.full":[{x:0,y:0,z:0,ry:2},{x:0,y:0,z:1,ry:3},{x:0,y:0,z:2},{x:0,y:0,z:3,ry:1},{x:0,y:0,z:4,ry:2},{x:0,y:0,z:5},{x:0,y:0,z:6,ry:2},{x:0,y:0,z:7},{x:0,y:0,z:8,ry:1},{x:0,y:0,z:9,ry:1},{x:0,y:0,z:10,ry:1},{x:0,y:0,z:11},{x:0,y:0,z:12,ry:1},{x:0,y:0,z:13,ry:3},{x:0,y:0,z:14},{x:0,y:0,z:15,ry:3},{x:0,y:0,z:16,ry:3},{x:0,y:0,z:17,ry:1},{x:0,y:0,z:18,ry:1},{x:0,y:0,z:19},{x:1,y:0,z:0,ry:3},{x:1,y:0,z:1},{x:1,y:0,z:2,ry:3},{x:1,y:0,z:3,ry:1},{x:1,y:0,z:4,ry:3},{x:1,y:0,z:5,ry:2},{x:1,y:0,z:6,ry:3},{x:1,y:0,z:7,ry:3},{x:1,y:0,z:8,ry:3},{x:1,y:0,z:9,ry:1},{x:1,y:0,z:10,ry:1},{x:1,y:0,z:11,ry:2},{x:1,y:0,z:12,ry:2},{x:1,y:0,z:13,ry:3},{x:1,y:0,z:14,ry:3},{x:1,y:0,z:15,ry:2},{x:1,y:0,z:16,ry:3},{x:1,y:0,z:17,ry:1},{x:1,y:0,z:18,ry:1},{x:1,y:0,z:19,ry:3},{x:2,y:0,z:0},{x:2,y:0,z:1,ry:2},{x:2,y:0,z:6,ry:1},{x:2,y:0,z:15,ry:2},{x:2,y:0,z:16,ry:2},{x:2,y:0,z:17,ry:2},{x:2,y:0,z:18,ry:1},{x:2,y:0,z:19,ry:3},{x:3,y:0,z:0,ry:1},{x:3,y:0,z:1,ry:3},{x:3,y:0,z:6},{x:3,y:0,z:18,ry:1},{x:3,y:0,z:19},{x:4,y:0,z:0},{x:4,y:0,z:1,ry:2},{x:4,y:0,z:5},{x:4,y:0,z:6,ry:2},{x:4,y:0,z:12,ry:1},{x:4,y:0,z:16,ry:1},{x:4,y:0,z:18,ry:1},{x:4,y:0,z:19,ry:2},{x:5,y:0,z:0,ry:1},{x:5,y:0,z:1,ry:3},{x:5,y:0,z:18,ry:1},{x:5,y:0,z:19,ry:2},{x:6,y:0,z:0},{x:6,y:0,z:18,ry:2},{x:6,y:0,z:19,ry:3},{x:7,y:0,z:0},{x:7,y:0,z:18},{x:7,y:0,z:19},{x:8,y:0,z:0,ry:2},{x:8,y:0,z:18,ry:2},{x:8,y:0,z:19,ry:3},{x:9,y:0,z:0},{x:9,y:0,z:1,ry:2},{x:9,y:0,z:9,ry:3},{x:9,y:0,z:18,ry:3},{x:9,y:0,z:19},{x:10,y:0,z:0},{x:10,y:0,z:1,ry:2},{x:10,y:0,z:8,ry:3},{x:10,y:0,z:18,ry:3},{x:10,y:0,z:19,ry:1},{x:11,y:0,z:0,ry:1},{x:11,y:0,z:1,ry:2},{x:11,y:0,z:10},{x:11,y:0,z:18,ry:2},{x:11,y:0,z:19,ry:3},{x:12,y:0,z:0,ry:2},{x:12,y:0,z:1},{x:12,y:0,z:15,ry:3},{x:12,y:0,z:16,ry:2},{x:12,y:0,z:17},{x:12,y:0,z:18,ry:3},{x:12,y:0,z:19,ry:2},{x:13,y:0,z:0,ry:2},{x:13,y:0,z:1,ry:3},{x:13,y:0,z:15,ry:1},{x:13,y:0,z:16},{x:13,y:0,z:17},{x:13,y:0,z:18},{x:13,y:0,z:19},{x:14,y:0,z:0,ry:3},{x:14,y:0,z:1,ry:3},{x:14,y:0,z:18,ry:1},{x:14,y:0,z:19},{x:15,y:0,z:0,ry:1},{x:15,y:0,z:1},{x:15,y:0,z:2,ry:2},{x:15,y:0,z:3,ry:3},{x:15,y:0,z:18,ry:3},{x:15,y:0,z:19,ry:3},{x:16,y:0,z:0,ry:3},{x:16,y:0,z:1,ry:2},{x:16,y:0,z:2,ry:1},{x:16,y:0,z:3,ry:3},{x:16,y:0,z:13,ry:1},{x:16,y:0,z:18},{x:16,y:0,z:19,ry:1},{x:17,y:0,z:0,ry:3},{x:17,y:0,z:1,ry:2},{x:17,y:0,z:2},{x:17,y:0,z:3,ry:1},{x:17,y:0,z:18},{x:17,y:0,z:19,ry:1},{x:18,y:0,z:0},{x:18,y:0,z:1},{x:18,y:0,z:2,ry:1},{x:18,y:0,z:3,ry:1},{x:18,y:0,z:4},{x:18,y:0,z:5,ry:1},{x:18,y:0,z:6,ry:3},{x:18,y:0,z:7,ry:1},{x:18,y:0,z:13},{x:18,y:0,z:14},{x:18,y:0,z:15,ry:2},{x:18,y:0,z:16,ry:1},{x:18,y:0,z:17},{x:18,y:0,z:18},{x:18,y:0,z:19,ry:2},{x:19,y:0,z:0},{x:19,y:0,z:1,ry:1},{x:19,y:0,z:2,ry:2},{x:19,y:0,z:3,ry:2},{x:19,y:0,z:4,ry:2},{x:19,y:0,z:5,ry:1},{x:19,y:0,z:6,ry:2},{x:19,y:0,z:7,ry:3},{x:19,y:0,z:8,ry:2},{x:19,y:0,z:9},{x:19,y:0,z:10,ry:2},{x:19,y:0,z:11,ry:1},{x:19,y:0,z:12,ry:3},{x:19,y:0,z:13,ry:2},{x:19,y:0,z:14,ry:2},{x:19,y:0,z:15,ry:3},{x:19,y:0,z:16},{x:19,y:0,z:17,ry:1},{x:19,y:0,z:18},{x:19,y:0,z:19,ry:2}],"generic.stairs.wedge":[{x:0,y:1,z:1},{x:4,y:1,z:1},{x:4,y:1,z:5,ry:2},{x:4,y:1,z:12,ry:1},{x:4,y:1,z:16},{x:4,y:1,z:18,ry:2},{x:4,y:2,z:4,ry:2},{x:5,y:2,z:12,ry:1},{x:8,y:3,z:1},{x:10,y:1,z:8,ry:2},{x:10,y:1,z:15,ry:1},{x:10,y:2,z:7,ry:2},{x:11,y:1,z:5},{x:11,y:1,z:10,ry:1},{x:11,y:2,z:1,ry:3},{x:12,y:2,z:6,ry:1},{x:12,y:2,z:10,ry:1},{x:13,y:2,z:13,ry:2},{x:14,y:1,z:18,ry:2},{x:14,y:2,z:3},{x:14,y:2,z:17,ry:2},{x:16,y:1,z:13,ry:2},{x:16,y:2,z:12,ry:2}],"generic.inset-blue.full":[{x:0,y:1,z:2,ry:3},{x:0,y:1,z:3,ry:1},{x:0,y:1,z:4,ry:1},{x:0,y:1,z:5,ry:3},{x:1,y:1,z:2,ry:3},{x:1,y:1,z:3,ry:3},{x:1,y:1,z:4,ry:3},{x:1,y:1,z:5,ry:3},{x:2,y:1,z:2,ry:1},{x:2,y:1,z:5,ry:2},{x:2,y:1,z:7},{x:2,y:1,z:9,ry:3},{x:2,y:1,z:10},{x:2,y:1,z:11,ry:3},{x:2,y:1,z:13,ry:3},{x:2,y:1,z:14,ry:3},{x:2,y:2,z:3,ry:3},{x:2,y:2,z:4,ry:3},{x:2,y:2,z:7},{x:2,y:2,z:8},{x:2,y:2,z:9,ry:3},{x:2,y:2,z:10,ry:3},{x:2,y:2,z:11,ry:2},{x:2,y:2,z:13},{x:2,y:2,z:14,ry:1},{x:3,y:1,z:2,ry:1},{x:3,y:1,z:3,ry:3},{x:3,y:1,z:4,ry:3},{x:3,y:1,z:5,ry:3},{x:3,y:1,z:7,ry:2},{x:3,y:1,z:9,ry:1},{x:3,y:1,z:10,ry:3},{x:3,y:1,z:14,ry:2},{x:3,y:1,z:15},{x:3,y:1,z:16,ry:2},{x:3,y:1,z:17,ry:2},{x:3,y:2,z:7},{x:3,y:2,z:8,ry:2},{x:3,y:2,z:9,ry:2},{x:3,y:2,z:10,ry:2},{x:3,y:2,z:11},{x:3,y:2,z:13,ry:3},{x:3,y:2,z:14,ry:3},{x:4,y:1,z:2,ry:1},{x:4,y:1,z:4},{x:4,y:1,z:7,ry:1},{x:4,y:1,z:17},{x:4,y:2,z:3,ry:1},{x:4,y:2,z:7},{x:4,y:2,z:8,ry:3},{x:4,y:2,z:9,ry:2},{x:4,y:2,z:10},{x:4,y:2,z:11,ry:3},{x:4,y:2,z:13,ry:3},{x:4,y:2,z:14,ry:3},{x:5,y:1,z:0},{x:5,y:1,z:1,ry:1},{x:5,y:1,z:2,ry:2},{x:5,y:1,z:3,ry:2},{x:5,y:1,z:4},{x:5,y:1,z:5,ry:1},{x:5,y:1,z:6,ry:1},{x:5,y:1,z:7,ry:1},{x:5,y:1,z:12},{x:5,y:1,z:14,ry:1},{x:5,y:1,z:15},{x:5,y:1,z:16},{x:5,y:1,z:17},{x:5,y:2,z:0,ry:1},{x:5,y:2,z:1,ry:1},{x:5,y:2,z:2,ry:1},{x:5,y:2,z:3},{x:5,y:2,z:4,ry:3},{x:5,y:2,z:5},{x:5,y:2,z:6},{x:5,y:2,z:7},{x:5,y:2,z:8},{x:5,y:2,z:9},{x:5,y:2,z:10,ry:1},{x:5,y:2,z:11,ry:1},{x:5,y:2,z:13,ry:3},{x:5,y:2,z:14,ry:2},{x:5,y:3,z:6,ry:2},{x:5,y:3,z:7,ry:2},{x:5,y:3,z:8,ry:2},{x:5,y:4,z:6,ry:2},{x:5,y:4,z:7,ry:2},{x:5,y:4,z:8,ry:2},{x:6,y:1,z:0,ry:3},{x:6,y:1,z:12,ry:1},{x:6,y:1,z:14,ry:1},{x:6,y:1,z:17,ry:2},{x:6,y:2,z:0,ry:1},{x:6,y:2,z:1,ry:3},{x:6,y:2,z:2,ry:2},{x:6,y:2,z:3,ry:1},{x:6,y:2,z:4,ry:2},{x:6,y:2,z:5,ry:1},{x:6,y:2,z:6,ry:2},{x:6,y:2,z:8,ry:2},{x:6,y:2,z:9,ry:3},{x:6,y:2,z:10},{x:6,y:2,z:11,ry:2},{x:6,y:2,z:12,ry:3},{x:6,y:2,z:13,ry:2},{x:6,y:2,z:14,ry:1},{x:6,y:3,z:6,ry:2},{x:6,y:3,z:8,ry:2},{x:6,y:4,z:6,ry:2},{x:6,y:4,z:8,ry:2},{x:7,y:1,z:0,ry:1},{x:7,y:1,z:7,ry:3},{x:7,y:1,z:17},{x:7,y:2,z:0},{x:7,y:2,z:1,ry:1},{x:7,y:2,z:2},{x:7,y:2,z:3,ry:3},{x:7,y:2,z:4},{x:7,y:2,z:5},{x:7,y:2,z:6,ry:1},{x:7,y:2,z:7},{x:7,y:2,z:8,ry:2},{x:7,y:2,z:9,ry:1},{x:7,y:2,z:10},{x:7,y:2,z:11,ry:1},{x:7,y:2,z:12,ry:1},{x:7,y:2,z:13,ry:3},{x:7,y:2,z:14},{x:7,y:3,z:6,ry:2},{x:7,y:3,z:7,ry:2},{x:7,y:3,z:8,ry:2},{x:7,y:4,z:6,ry:2},{x:7,y:4,z:7,ry:2},{x:7,y:4,z:8,ry:2},{x:8,y:1,z:0,ry:1},{x:8,y:1,z:5},{x:8,y:1,z:6,ry:2},{x:8,y:1,z:7,ry:3},{x:8,y:1,z:12,ry:1},{x:8,y:1,z:14,ry:1},{x:8,y:1,z:17,ry:1},{x:8,y:2,z:0,ry:2},{x:8,y:2,z:1,ry:1},{x:8,y:2,z:2,ry:1},{x:8,y:2,z:3,ry:2},{x:8,y:2,z:4,ry:3},{x:8,y:2,z:5,ry:1},{x:8,y:2,z:6},{x:8,y:2,z:7,ry:3},{x:8,y:2,z:8,ry:1},{x:8,y:2,z:9},{x:8,y:2,z:10,ry:3},{x:8,y:2,z:11},{x:8,y:2,z:12,ry:3},{x:8,y:2,z:13,ry:2},{x:8,y:2,z:14,ry:1},{x:9,y:1,z:0,ry:1},{x:9,y:1,z:1},{x:9,y:1,z:2},{x:9,y:1,z:5},{x:9,y:1,z:8,ry:2},{x:9,y:1,z:9},{x:9,y:1,z:10,ry:3},{x:9,y:1,z:12},{x:9,y:1,z:17,ry:1},{x:9,y:2,z:0,ry:2},{x:9,y:2,z:1,ry:1},{x:9,y:2,z:2,ry:3},{x:9,y:2,z:3,ry:2},{x:9,y:2,z:4,ry:1},{x:9,y:2,z:5,ry:3},{x:9,y:2,z:6,ry:1},{x:9,y:2,z:7,ry:3},{x:9,y:2,z:8,ry:3},{x:9,y:2,z:9},{x:9,y:2,z:10},{x:9,y:2,z:11,ry:2},{x:9,y:2,z:12,ry:3},{x:10,y:1,z:0},{x:10,y:1,z:1},{x:10,y:1,z:2},{x:10,y:1,z:5},{x:10,y:1,z:7,ry:2},{x:10,y:1,z:17,ry:3},{x:10,y:2,z:0,ry:2},{x:10,y:2,z:1,ry:3},{x:10,y:2,z:2,ry:3},{x:10,y:2,z:3,ry:2},{x:10,y:2,z:4,ry:3},{x:10,y:2,z:5,ry:2},{x:10,y:2,z:6,ry:1},{x:10,y:2,z:11,ry:3},{x:10,y:2,z:12,ry:2},{x:11,y:1,z:0},{x:11,y:1,z:1,ry:2},{x:11,y:1,z:6,ry:3},{x:11,y:1,z:8,ry:2},{x:11,y:1,z:9,ry:2},{x:11,y:1,z:11,ry:2},{x:11,y:1,z:12},{x:11,y:1,z:13},{x:11,y:1,z:14,ry:1},{x:11,y:1,z:15,ry:2},{x:11,y:1,z:16,ry:1},{x:11,y:1,z:17,ry:2},{x:11,y:2,z:0},{x:11,y:2,z:7},{x:11,y:2,z:8,ry:2},{x:11,y:2,z:9,ry:1},{x:11,y:2,z:11,ry:3},{x:11,y:2,z:12,ry:1},{x:12,y:1,z:1,ry:1},{x:12,y:1,z:6},{x:12,y:1,z:7,ry:1},{x:12,y:1,z:10},{x:12,y:1,z:13,ry:1},{x:12,y:1,z:14,ry:1},{x:12,y:2,z:7,ry:2},{x:12,y:2,z:8,ry:2},{x:12,y:2,z:9},{x:12,y:2,z:11,ry:1},{x:12,y:2,z:12},{x:13,y:1,z:1,ry:2},{x:13,y:1,z:4},{x:13,y:1,z:8,ry:1},{x:13,y:1,z:9},{x:13,y:1,z:10,ry:3},{x:13,y:1,z:11,ry:1},{x:13,y:1,z:12},{x:13,y:1,z:13,ry:1},{x:13,y:1,z:14,ry:1},{x:13,y:2,z:4},{x:13,y:2,z:5,ry:2},{x:13,y:2,z:6,ry:3},{x:13,y:2,z:7,ry:2},{x:13,y:2,z:8,ry:2},{x:13,y:2,z:9},{x:13,y:2,z:10,ry:2},{x:13,y:2,z:11,ry:1},{x:13,y:2,z:12,ry:2},{x:14,y:1,z:1,ry:3},{x:14,y:1,z:2},{x:14,y:1,z:3,ry:1},{x:14,y:1,z:4,ry:2},{x:14,y:1,z:8},{x:14,y:1,z:12},{x:14,y:1,z:14,ry:1},{x:14,y:1,z:17,ry:2},{x:14,y:2,z:4,ry:1},{x:14,y:2,z:5,ry:3},{x:14,y:2,z:6},{x:14,y:2,z:7,ry:2},{x:14,y:2,z:8},{x:14,y:2,z:9,ry:1},{x:14,y:2,z:10,ry:3},{x:14,y:2,z:11,ry:1},{x:14,y:2,z:12},{x:14,y:2,z:13,ry:2},{x:14,y:2,z:14,ry:1},{x:14,y:2,z:15},{x:14,y:2,z:16,ry:2},{x:15,y:1,z:12,ry:1},{x:15,y:1,z:13,ry:1},{x:15,y:1,z:14,ry:1},{x:15,y:1,z:17,ry:1},{x:15,y:2,z:4,ry:3},{x:15,y:2,z:5,ry:2},{x:15,y:2,z:6,ry:2},{x:15,y:2,z:7,ry:3},{x:15,y:2,z:8,ry:2},{x:15,y:2,z:9,ry:3},{x:15,y:2,z:10,ry:1},{x:15,y:2,z:11},{x:15,y:2,z:12},{x:15,y:2,z:13,ry:1},{x:15,y:2,z:14,ry:2},{x:15,y:2,z:15,ry:1},{x:15,y:2,z:16},{x:15,y:2,z:17,ry:1},{x:16,y:1,z:4,ry:2},{x:16,y:1,z:8,ry:2},{x:16,y:1,z:12},{x:16,y:2,z:4,ry:3},{x:16,y:2,z:5,ry:1},{x:16,y:2,z:6},{x:16,y:2,z:7,ry:1},{x:16,y:2,z:8},{x:16,y:2,z:9,ry:2},{x:16,y:2,z:10,ry:2},{x:16,y:2,z:11,ry:2},{x:16,y:2,z:15},{x:16,y:2,z:16,ry:3},{x:16,y:2,z:17,ry:3},{x:17,y:1,z:4,ry:3},{x:17,y:1,z:5},{x:17,y:1,z:7,ry:3},{x:17,y:1,z:8,ry:1},{x:17,y:1,z:12},{x:17,y:1,z:13,ry:1},{x:17,y:1,z:14,ry:3},{x:17,y:1,z:16},{x:17,y:1,z:17,ry:1},{x:17,y:2,z:4,ry:3},{x:17,y:2,z:5,ry:2},{x:17,y:2,z:6,ry:1},{x:17,y:2,z:7},{x:17,y:2,z:8,ry:1},{x:17,y:2,z:9},{x:17,y:2,z:10,ry:3},{x:17,y:2,z:11,ry:2},{x:17,y:2,z:12,ry:1},{x:17,y:2,z:13,ry:2},{x:17,y:2,z:14},{x:17,y:2,z:15},{x:17,y:2,z:16},{x:17,y:2,z:17,ry:2},{x:18,y:1,z:8},{x:18,y:1,z:12}],"generic.barricade.aabb":[{x:1,y:1,z:16,ry:1},{x:1,y:1,z:18},{x:1,y:2,z:3,ry:2},{x:5,y:3,z:10,ry:1},{x:5,y:3,z:14,ry:1},{x:5,y:5,z:6,ry:2},{x:5,y:5,z:8,ry:2},{x:7,y:4,z:3,ry:2},{x:7,y:5,z:6,ry:2},{x:7,y:5,z:8,ry:2},{x:8,y:1,z:18,ry:1},{x:9,y:3,z:8,ry:2},{x:10,y:1,z:18,ry:1},{x:10,y:3,z:2,ry:1},{x:10,y:3,z:4,ry:1},{x:11,y:3,z:9,ry:2},{x:11,y:3,z:12,ry:1},{x:13,y:3,z:4,ry:2},{x:15,y:3,z:5,ry:2},{x:15,y:3,z:9,ry:2},{x:15,y:3,z:10,ry:2},{x:15,y:3,z:11,ry:2},{x:15,y:3,z:12,ry:2},{x:17,y:1,z:1,ry:3},{x:18,y:1,z:18,ry:3},{x:18,y:2,z:8,ry:2},{x:18,y:2,z:12,ry:2}],"generic.pavement.full":[{x:2,y:0,z:8},{x:2,y:0,z:11,ry:2},{x:2,y:0,z:12,ry:1},{x:2,y:0,z:13,ry:1},{x:3,y:0,z:8,ry:3},{x:3,y:0,z:11},{x:3,y:0,z:12,ry:2},{x:3,y:0,z:13,ry:3},{x:4,y:0,z:8,ry:1},{x:4,y:0,z:9,ry:2},{x:4,y:0,z:10,ry:3},{x:4,y:0,z:11,ry:3},{x:4,y:0,z:13,ry:3},{x:4,y:0,z:14},{x:4,y:0,z:15},{x:5,y:0,z:8},{x:5,y:0,z:9,ry:1},{x:5,y:0,z:10,ry:3},{x:5,y:0,z:11,ry:2},{x:5,y:0,z:13},{x:6,y:0,z:1},{x:6,y:0,z:2,ry:1},{x:6,y:0,z:3},{x:6,y:0,z:4,ry:2},{x:6,y:0,z:5},{x:6,y:0,z:6},{x:6,y:0,z:7,ry:1},{x:6,y:0,z:8,ry:3},{x:6,y:0,z:9,ry:2},{x:6,y:0,z:10,ry:2},{x:6,y:0,z:11,ry:1},{x:6,y:0,z:13,ry:1},{x:6,y:0,z:15},{x:6,y:0,z:16},{x:7,y:0,z:1,ry:3},{x:7,y:0,z:2,ry:1},{x:7,y:0,z:3,ry:3},{x:7,y:0,z:4,ry:3},{x:7,y:0,z:5,ry:1},{x:7,y:0,z:6,ry:1},{x:7,y:0,z:7,ry:2},{x:7,y:0,z:8,ry:3},{x:7,y:0,z:9,ry:2},{x:7,y:0,z:10,ry:3},{x:7,y:0,z:11},{x:7,y:0,z:12},{x:7,y:0,z:13,ry:1},{x:7,y:0,z:14,ry:3},{x:7,y:0,z:15,ry:3},{x:7,y:0,z:16,ry:2},{x:8,y:0,z:1,ry:3},{x:8,y:0,z:2},{x:8,y:0,z:3,ry:1},{x:8,y:0,z:4},{x:8,y:0,z:8},{x:8,y:0,z:9,ry:3},{x:8,y:0,z:10,ry:2},{x:8,y:0,z:11,ry:2},{x:8,y:0,z:13,ry:2},{x:8,y:0,z:15},{x:8,y:0,z:16},{x:9,y:0,z:3},{x:9,y:0,z:4},{x:9,y:0,z:11},{x:9,y:0,z:13,ry:1},{x:9,y:0,z:14,ry:3},{x:9,y:0,z:15},{x:9,y:0,z:16},{x:10,y:0,z:3,ry:3},{x:10,y:0,z:4},{x:10,y:0,z:9,ry:1},{x:10,y:0,z:10},{x:10,y:0,z:11,ry:1},{x:10,y:0,z:12,ry:1},{x:10,y:0,z:13,ry:1},{x:10,y:0,z:14,ry:2},{x:10,y:0,z:15,ry:2},{x:10,y:0,z:16,ry:2},{x:11,y:0,z:2,ry:1},{x:11,y:0,z:3,ry:3},{x:11,y:0,z:4,ry:3},{x:11,y:0,z:5},{x:12,y:0,z:2,ry:3},{x:12,y:0,z:3,ry:1},{x:12,y:0,z:4,ry:1},{x:12,y:0,z:5,ry:2},{x:12,y:0,z:6,ry:1},{x:13,y:0,z:2,ry:2},{x:13,y:0,z:3,ry:1},{x:13,y:0,z:4,ry:3},{x:13,y:0,z:5,ry:3},{x:13,y:0,z:6,ry:2},{x:13,y:0,z:7,ry:2},{x:14,y:0,z:5,ry:2},{x:14,y:0,z:6,ry:3},{x:14,y:0,z:7,ry:3},{x:14,y:0,z:9},{x:14,y:0,z:10,ry:1},{x:14,y:0,z:11,ry:2},{x:14,y:0,z:12},{x:14,y:0,z:13},{x:14,y:0,z:14,ry:3},{x:14,y:0,z:15,ry:1},{x:14,y:0,z:16,ry:2},{x:15,y:0,z:4},{x:15,y:0,z:5,ry:1},{x:15,y:0,z:6,ry:1},{x:15,y:0,z:7,ry:2},{x:15,y:0,z:8,ry:3},{x:15,y:0,z:9,ry:3},{x:15,y:0,z:10,ry:3},{x:15,y:0,z:11},{x:15,y:0,z:15,ry:2},{x:15,y:0,z:16},{x:16,y:0,z:4,ry:1},{x:16,y:0,z:5,ry:2},{x:16,y:0,z:6},{x:16,y:0,z:7,ry:3},{x:16,y:0,z:9},{x:16,y:0,z:10},{x:16,y:0,z:11,ry:3},{x:16,y:0,z:14,ry:3},{x:16,y:0,z:15,ry:3},{x:16,y:0,z:16,ry:3},{x:16,y:0,z:17,ry:2},{x:17,y:0,z:6,ry:2},{x:17,y:0,z:7,ry:1},{x:17,y:0,z:9},{x:17,y:0,z:10,ry:1},{x:17,y:0,z:11},{x:17,y:0,z:15,ry:3},{x:17,y:0,z:16,ry:2},{x:18,y:0,z:9,ry:1},{x:18,y:0,z:10,ry:1},{x:18,y:0,z:11,ry:1}],"shipyard.container-orange.full":[{x:4,y:3,z:11,ry:3},{x:4,y:3,z:13,ry:1},{x:5,y:3,z:11,ry:2},{x:5,y:3,z:13,ry:2},{x:6,y:3,z:11,ry:1},{x:6,y:3,z:13,ry:3},{x:7,y:3,z:2,ry:1},{x:7,y:3,z:3,ry:2},{x:8,y:3,z:2},{x:8,y:3,z:3,ry:3},{x:15,y:3,z:6},{x:15,y:3,z:7,ry:3},{x:15,y:3,z:8},{x:18,y:1,z:1,ry:3}],"generic.metal-ladder.ladder":[{x:6,y:1,z:7,ry:1},{x:6,y:2,z:7,ry:1},{x:6,y:3,z:7,ry:1},{x:6,y:4,z:7,ry:1}]},palette:["nature.rocks-big.aabb","nature.dirtwalk-center.full","generic.stairs.wedge","scifi.computer.obb",null,null,null,null,null,null],width:20,height:6,depth:20,name:"",surfaceArea:491},{fileVersion:1,data:{"generic.grass.full":[{x:0,y:0,z:0,ry:3},{x:0,y:0,z:1,ry:1},{x:0,y:0,z:2,ry:1},{x:0,y:0,z:3,ry:3},{x:0,y:0,z:4},{x:0,y:0,z:5,ry:1},{x:0,y:0,z:6},{x:0,y:0,z:7},{x:0,y:0,z:8},{x:0,y:0,z:9,ry:1},{x:0,y:0,z:10,ry:1},{x:0,y:0,z:11,ry:1},{x:1,y:0,z:0,ry:2},{x:1,y:0,z:1,ry:3},{x:1,y:0,z:2,ry:1},{x:1,y:0,z:3},{x:1,y:0,z:4,ry:1},{x:1,y:0,z:5,ry:2},{x:1,y:0,z:6,ry:1},{x:1,y:0,z:7,ry:3},{x:1,y:0,z:8,ry:1},{x:1,y:0,z:9,ry:2},{x:1,y:0,z:10,ry:2},{x:1,y:0,z:11},{x:2,y:0,z:0},{x:2,y:0,z:1,ry:3},{x:2,y:0,z:2},{x:2,y:0,z:3,ry:2},{x:2,y:0,z:4},{x:2,y:0,z:5},{x:2,y:0,z:6,ry:2},{x:2,y:0,z:7,ry:3},{x:2,y:0,z:8,ry:1},{x:2,y:0,z:9},{x:2,y:0,z:10,ry:1},{x:2,y:0,z:11,ry:1},{x:3,y:0,z:0,ry:2},{x:3,y:0,z:1,ry:1},{x:3,y:0,z:2,ry:1},{x:3,y:0,z:3,ry:3},{x:3,y:0,z:4,ry:3},{x:3,y:0,z:5,ry:2},{x:3,y:0,z:6},{x:3,y:0,z:7,ry:2},{x:3,y:0,z:8},{x:3,y:0,z:9,ry:3},{x:3,y:0,z:10,ry:2},{x:3,y:0,z:11,ry:3},{x:4,y:0,z:0},{x:4,y:0,z:1,ry:3},{x:4,y:0,z:2,ry:1},{x:4,y:0,z:3,ry:3},{x:4,y:0,z:4,ry:1},{x:4,y:0,z:5,ry:3},{x:4,y:0,z:6},{x:4,y:0,z:7,ry:2},{x:4,y:0,z:8},{x:4,y:0,z:9,ry:1},{x:4,y:0,z:10},{x:4,y:0,z:11,ry:1},{x:5,y:0,z:0},{x:5,y:0,z:1},{x:5,y:0,z:2,ry:3},{x:5,y:0,z:3,ry:3},{x:5,y:0,z:4},{x:5,y:0,z:5,ry:1},{x:5,y:0,z:6,ry:3},{x:5,y:0,z:7,ry:3},{x:5,y:0,z:8},{x:5,y:0,z:9,ry:1},{x:5,y:0,z:10},{x:5,y:0,z:11,ry:1},{x:6,y:0,z:0,ry:1},{x:6,y:0,z:1,ry:3},{x:6,y:0,z:2,ry:3},{x:6,y:0,z:3,ry:2},{x:6,y:0,z:4},{x:6,y:0,z:5,ry:3},{x:6,y:0,z:6},{x:6,y:0,z:7,ry:2},{x:6,y:0,z:8,ry:2},{x:6,y:0,z:9,ry:3},{x:6,y:0,z:10,ry:2},{x:6,y:0,z:11,ry:3},{x:7,y:0,z:0,ry:1},{x:7,y:0,z:1,ry:2},{x:7,y:0,z:2,ry:3},{x:7,y:0,z:3},{x:7,y:0,z:4,ry:3},{x:7,y:0,z:5,ry:3},{x:7,y:0,z:6,ry:1},{x:7,y:0,z:7,ry:3},{x:7,y:0,z:8,ry:2},{x:7,y:0,z:9,ry:3},{x:7,y:0,z:10},{x:7,y:0,z:11,ry:1},{x:8,y:0,z:0,ry:3},{x:8,y:0,z:1},{x:8,y:0,z:2,ry:1},{x:8,y:0,z:3,ry:2},{x:8,y:0,z:4,ry:3},{x:8,y:0,z:5,ry:1},{x:8,y:0,z:6,ry:3},{x:8,y:0,z:7,ry:1},{x:8,y:0,z:8,ry:2},{x:8,y:0,z:9,ry:2},{x:8,y:0,z:10,ry:2},{x:8,y:0,z:11,ry:1},{x:9,y:0,z:0,ry:2},{x:9,y:0,z:1,ry:3},{x:9,y:0,z:2,ry:1},{x:9,y:0,z:3},{x:9,y:0,z:4},{x:9,y:0,z:5,ry:2},{x:9,y:0,z:6,ry:2},{x:9,y:0,z:7,ry:1},{x:9,y:0,z:8},{x:9,y:0,z:9,ry:1},{x:9,y:0,z:10},{x:9,y:0,z:11,ry:2},{x:10,y:0,z:0},{x:10,y:0,z:1,ry:3},{x:10,y:0,z:2},{x:10,y:0,z:3},{x:10,y:0,z:4},{x:10,y:0,z:5,ry:2},{x:10,y:0,z:6,ry:2},{x:10,y:0,z:7,ry:3},{x:10,y:0,z:8,ry:3},{x:10,y:0,z:9},{x:10,y:0,z:10},{x:10,y:0,z:11,ry:3},{x:11,y:0,z:0},{x:11,y:0,z:1,ry:2},{x:11,y:0,z:2,ry:2},{x:11,y:0,z:3},{x:11,y:0,z:4,ry:1},{x:11,y:0,z:5,ry:3},{x:11,y:0,z:6,ry:1},{x:11,y:0,z:7,ry:2},{x:11,y:0,z:8,ry:2},{x:11,y:0,z:9,ry:1},{x:11,y:0,z:10,ry:2},{x:11,y:0,z:11,ry:3},{x:12,y:0,z:0,ry:1},{x:12,y:0,z:1,ry:3},{x:12,y:0,z:2,ry:1},{x:12,y:0,z:3},{x:12,y:0,z:4,ry:3},{x:12,y:0,z:5},{x:12,y:0,z:6,ry:3},{x:12,y:0,z:7,ry:3},{x:12,y:0,z:8,ry:3},{x:12,y:0,z:9,ry:3},{x:12,y:0,z:10,ry:1},{x:12,y:0,z:11},{x:13,y:0,z:0,ry:2},{x:13,y:0,z:1},{x:13,y:0,z:2,ry:3},{x:13,y:0,z:3,ry:2},{x:13,y:0,z:4,ry:3},{x:13,y:0,z:5},{x:13,y:0,z:6,ry:1},{x:13,y:0,z:7,ry:2},{x:13,y:0,z:8,ry:2},{x:13,y:0,z:9},{x:13,y:0,z:10,ry:2},{x:13,y:0,z:11,ry:1},{x:14,y:0,z:0},{x:14,y:0,z:1,ry:3},{x:14,y:0,z:2,ry:1},{x:14,y:0,z:3,ry:1},{x:14,y:0,z:4,ry:1},{x:14,y:0,z:5},{x:14,y:0,z:6,ry:2},{x:14,y:0,z:7,ry:1},{x:14,y:0,z:8,ry:1},{x:14,y:0,z:9,ry:3},{x:14,y:0,z:10,ry:1},{x:14,y:0,z:11},{x:15,y:0,z:0},{x:15,y:0,z:1,ry:1},{x:15,y:0,z:2,ry:3},{x:15,y:0,z:3,ry:3},{x:15,y:0,z:4},{x:15,y:0,z:5,ry:1},{x:15,y:0,z:6,ry:2},{x:15,y:0,z:7},{x:15,y:0,z:8,ry:2},{x:15,y:0,z:9,ry:3},{x:15,y:0,z:10,ry:1},{x:15,y:0,z:11},{x:16,y:0,z:0,ry:2},{x:16,y:0,z:1,ry:3},{x:16,y:0,z:2,ry:2},{x:16,y:0,z:3,ry:3},{x:16,y:0,z:4,ry:1},{x:16,y:0,z:5},{x:16,y:0,z:6,ry:2},{x:16,y:0,z:7,ry:3},{x:16,y:0,z:8},{x:16,y:0,z:9,ry:2},{x:16,y:0,z:10,ry:2},{x:16,y:0,z:11},{x:17,y:0,z:0,ry:3},{x:17,y:0,z:1,ry:3},{x:17,y:0,z:2,ry:2},{x:17,y:0,z:3},{x:17,y:0,z:4,ry:1},{x:17,y:0,z:5},{x:17,y:0,z:6,ry:2},{x:17,y:0,z:7},{x:17,y:0,z:8,ry:2},{x:17,y:0,z:9,ry:3},{x:17,y:0,z:10,ry:2},{x:17,y:0,z:11,ry:3},{x:18,y:0,z:0,ry:1},{x:18,y:0,z:1,ry:2},{x:18,y:0,z:2,ry:1},{x:18,y:0,z:3},{x:18,y:0,z:4},{x:18,y:0,z:5},{x:18,y:0,z:6},{x:18,y:0,z:7,ry:3},{x:18,y:0,z:8,ry:3},{x:18,y:0,z:9,ry:1},{x:18,y:0,z:10},{x:18,y:0,z:11,ry:3},{x:19,y:0,z:0,ry:2},{x:19,y:0,z:1},{x:19,y:0,z:2,ry:2},{x:19,y:0,z:3,ry:3},{x:19,y:0,z:4,ry:2},{x:19,y:0,z:5,ry:2},{x:19,y:0,z:6,ry:3},{x:19,y:0,z:7,ry:3},{x:19,y:0,z:8,ry:1},{x:19,y:0,z:9,ry:3},{x:19,y:0,z:10,ry:1},{x:19,y:0,z:11,ry:3},{x:20,y:0,z:0,ry:1},{x:20,y:0,z:1,ry:2},{x:20,y:0,z:2,ry:3},{x:20,y:0,z:3,ry:2},{x:20,y:0,z:4,ry:2},{x:20,y:0,z:5,ry:2},{x:20,y:0,z:6,ry:1},{x:20,y:0,z:7},{x:20,y:0,z:8,ry:2},{x:20,y:0,z:9,ry:2},{x:20,y:0,z:10,ry:2},{x:20,y:0,z:11,ry:1},{x:21,y:0,z:0},{x:21,y:0,z:1,ry:1},{x:21,y:0,z:2,ry:1},{x:21,y:0,z:3,ry:1},{x:21,y:0,z:4,ry:3},{x:21,y:0,z:5,ry:2},{x:21,y:0,z:6,ry:1},{x:21,y:0,z:7},{x:21,y:0,z:8,ry:3},{x:21,y:0,z:9,ry:2},{x:21,y:0,z:10,ry:1},{x:21,y:0,z:11,ry:1},{x:22,y:0,z:0,ry:3},{x:22,y:0,z:1},{x:22,y:0,z:2,ry:2},{x:22,y:0,z:3,ry:1},{x:22,y:0,z:4,ry:2},{x:22,y:0,z:5},{x:22,y:0,z:6,ry:2},{x:22,y:0,z:7,ry:2},{x:22,y:0,z:8},{x:22,y:0,z:9,ry:2},{x:22,y:0,z:10,ry:3},{x:22,y:0,z:11},{x:23,y:0,z:0,ry:1},{x:23,y:0,z:1,ry:3},{x:23,y:0,z:2,ry:2},{x:23,y:0,z:3,ry:3},{x:23,y:0,z:4,ry:3},{x:23,y:0,z:5,ry:3},{x:23,y:0,z:6,ry:2},{x:23,y:0,z:7},{x:23,y:0,z:8,ry:1},{x:23,y:0,z:9},{x:23,y:0,z:10,ry:1},{x:23,y:0,z:11,ry:2}],"generic.green-block.full":[{x:0,y:1,z:1,ry:1},{x:0,y:1,z:2},{x:0,y:1,z:3,ry:2},{x:0,y:2,z:1,ry:2},{x:0,y:2,z:2,ry:1},{x:0,y:2,z:3,ry:1},{x:0,y:2,z:4,ry:2},{x:1,y:2,z:1},{x:1,y:2,z:2,ry:3},{x:1,y:2,z:3},{x:1,y:2,z:4,ry:2},{x:2,y:1,z:1},{x:2,y:1,z:5,ry:2},{x:2,y:1,z:6},{x:2,y:1,z:7,ry:1},{x:2,y:1,z:8},{x:2,y:1,z:9},{x:2,y:1,z:10,ry:2},{x:2,y:2,z:1},{x:2,y:2,z:2},{x:2,y:2,z:3,ry:3},{x:2,y:2,z:4},{x:2,y:2,z:5,ry:2},{x:2,y:2,z:6,ry:3},{x:2,y:2,z:7,ry:3},{x:2,y:2,z:8,ry:3},{x:2,y:2,z:9},{x:2,y:2,z:10,ry:1},{x:2,y:3,z:5},{x:2,y:3,z:6,ry:3},{x:2,y:3,z:7},{x:2,y:3,z:8,ry:3},{x:2,y:3,z:9,ry:1},{x:2,y:3,z:10,ry:1},{x:3,y:1,z:1,ry:1},{x:3,y:1,z:2},{x:3,y:1,z:5,ry:1},{x:3,y:2,z:1,ry:2},{x:3,y:2,z:2},{x:3,y:2,z:3,ry:2},{x:3,y:2,z:4,ry:2},{x:3,y:2,z:5,ry:1},{x:3,y:3,z:1},{x:3,y:3,z:2},{x:3,y:3,z:3,ry:3},{x:3,y:3,z:4,ry:3},{x:3,y:3,z:5,ry:1},{x:3,y:3,z:6,ry:2},{x:3,y:3,z:7,ry:1},{x:3,y:3,z:8,ry:3},{x:3,y:3,z:9,ry:2},{x:3,y:3,z:10},{x:3,y:4,z:1,ry:1},{x:3,y:4,z:2,ry:2},{x:4,y:1,z:0,ry:3},{x:4,y:1,z:1},{x:4,y:1,z:2,ry:1},{x:4,y:1,z:5,ry:2},{x:4,y:2,z:1,ry:3},{x:4,y:2,z:2,ry:1},{x:4,y:2,z:3,ry:3},{x:4,y:2,z:4,ry:1},{x:4,y:2,z:5,ry:2},{x:4,y:3,z:1,ry:2},{x:4,y:3,z:2},{x:4,y:3,z:3},{x:4,y:3,z:4,ry:3},{x:4,y:3,z:5},{x:4,y:3,z:6,ry:1},{x:4,y:3,z:7},{x:4,y:3,z:9,ry:1},{x:4,y:3,z:10,ry:2},{x:4,y:4,z:1,ry:2},{x:4,y:4,z:2,ry:1},{x:4,y:4,z:5,ry:1},{x:4,y:4,z:6,ry:2},{x:4,y:4,z:7},{x:4,y:4,z:8,ry:3},{x:4,y:4,z:9,ry:2},{x:4,y:5,z:5},{x:4,y:5,z:7,ry:1},{x:4,y:5,z:8,ry:2},{x:4,y:5,z:9,ry:1},{x:4,y:6,z:5,ry:3},{x:4,y:6,z:6,ry:3},{x:4,y:6,z:7,ry:1},{x:4,y:6,z:8,ry:1},{x:4,y:6,z:9,ry:2},{x:4,y:7,z:5,ry:1},{x:4,y:7,z:9,ry:1},{x:5,y:1,z:0},{x:5,y:1,z:5,ry:1},{x:5,y:1,z:9,ry:3},{x:5,y:1,z:10,ry:1},{x:5,y:2,z:1,ry:3},{x:5,y:2,z:2},{x:5,y:2,z:3,ry:2},{x:5,y:2,z:4,ry:2},{x:5,y:2,z:9,ry:1},{x:5,y:2,z:10,ry:1},{x:5,y:3,z:1},{x:5,y:3,z:2,ry:2},{x:5,y:3,z:3,ry:1},{x:5,y:3,z:9,ry:3},{x:5,y:3,z:10,ry:2},{x:5,y:4,z:1},{x:5,y:4,z:2,ry:2},{x:5,y:4,z:3},{x:5,y:4,z:5,ry:3},{x:5,y:4,z:6,ry:1},{x:5,y:4,z:7},{x:5,y:4,z:8,ry:3},{x:5,y:4,z:9,ry:2},{x:5,y:5,z:5,ry:2},{x:5,y:5,z:9,ry:1},{x:5,y:6,z:5,ry:3},{x:5,y:6,z:6,ry:1},{x:5,y:6,z:7,ry:3},{x:5,y:6,z:9,ry:2},{x:5,y:7,z:5},{x:5,y:7,z:9,ry:1},{x:6,y:1,z:0,ry:3},{x:6,y:1,z:1,ry:2},{x:6,y:1,z:5,ry:2},{x:6,y:1,z:9,ry:1},{x:6,y:2,z:1,ry:1},{x:6,y:2,z:2,ry:2},{x:6,y:2,z:3,ry:3},{x:6,y:2,z:4},{x:6,y:2,z:9,ry:3},{x:6,y:3,z:1},{x:6,y:3,z:9,ry:3},{x:6,y:4,z:1},{x:6,y:4,z:2},{x:6,y:4,z:3,ry:2},{x:6,y:4,z:5,ry:3},{x:6,y:4,z:6},{x:6,y:4,z:7,ry:2},{x:6,y:4,z:8,ry:2},{x:6,y:4,z:9,ry:2},{x:6,y:5,z:5,ry:1},{x:6,y:5,z:9,ry:2},{x:6,y:6,z:5,ry:1},{x:6,y:6,z:6,ry:1},{x:6,y:6,z:7,ry:2},{x:6,y:6,z:9,ry:2},{x:6,y:7,z:5,ry:2},{x:6,y:7,z:9,ry:2},{x:7,y:1,z:0,ry:1},{x:7,y:1,z:1,ry:2},{x:7,y:1,z:5,ry:1},{x:7,y:1,z:9,ry:3},{x:7,y:2,z:1,ry:1},{x:7,y:2,z:2,ry:2},{x:7,y:2,z:3},{x:7,y:2,z:4,ry:2},{x:7,y:2,z:5,ry:3},{x:7,y:2,z:6},{x:7,y:2,z:7,ry:3},{x:7,y:2,z:8,ry:2},{x:7,y:2,z:9,ry:1},{x:7,y:3,z:1,ry:1},{x:7,y:4,z:1},{x:7,y:4,z:2,ry:3},{x:7,y:4,z:3,ry:2},{x:7,y:4,z:4,ry:1},{x:7,y:4,z:5},{x:7,y:4,z:6,ry:1},{x:7,y:4,z:7,ry:1},{x:7,y:4,z:8,ry:1},{x:7,y:4,z:9,ry:3},{x:7,y:5,z:8,ry:2},{x:7,y:5,z:9,ry:1},{x:7,y:6,z:5,ry:2},{x:7,y:6,z:6},{x:7,y:6,z:7,ry:2},{x:7,y:6,z:9,ry:2},{x:7,y:7,z:5,ry:3},{x:7,y:7,z:9,ry:3},{x:8,y:1,z:0,ry:3},{x:8,y:1,z:1,ry:2},{x:8,y:1,z:2,ry:1},{x:8,y:1,z:3,ry:1},{x:8,y:2,z:1,ry:2},{x:8,y:2,z:2,ry:1},{x:8,y:2,z:3,ry:3},{x:8,y:2,z:4,ry:1},{x:8,y:2,z:5,ry:1},{x:8,y:2,z:6,ry:2},{x:8,y:2,z:7},{x:8,y:2,z:8,ry:2},{x:8,y:2,z:9,ry:1},{x:8,y:3,z:1,ry:1},{x:8,y:3,z:2},{x:8,y:3,z:3,ry:3},{x:8,y:3,z:4},{x:8,y:3,z:9,ry:3},{x:8,y:4,z:1,ry:2},{x:8,y:4,z:2},{x:8,y:4,z:3},{x:8,y:4,z:4,ry:1},{x:8,y:4,z:5,ry:2},{x:8,y:4,z:6,ry:3},{x:8,y:4,z:7},{x:8,y:4,z:8},{x:8,y:4,z:9,ry:1},{x:8,y:5,z:5,ry:3},{x:8,y:5,z:8},{x:8,y:5,z:9,ry:3},{x:8,y:6,z:5,ry:2},{x:8,y:6,z:6,ry:3},{x:8,y:6,z:7,ry:1},{x:8,y:6,z:8},{x:8,y:6,z:9},{x:8,y:7,z:5,ry:2},{x:8,y:7,z:9,ry:3},{x:9,y:1,z:0,ry:2},{x:9,y:1,z:1,ry:2},{x:9,y:1,z:2,ry:1},{x:9,y:1,z:3},{x:9,y:1,z:7,ry:3},{x:9,y:1,z:8,ry:3},{x:9,y:1,z:9,ry:3},{x:9,y:2,z:2,ry:3},{x:9,y:2,z:3,ry:3},{x:9,y:2,z:4,ry:2},{x:9,y:2,z:5,ry:2},{x:9,y:2,z:6},{x:9,y:2,z:7,ry:3},{x:9,y:2,z:8,ry:1},{x:9,y:2,z:9,ry:2},{x:9,y:3,z:7,ry:1},{x:9,y:3,z:8,ry:1},{x:9,y:3,z:9,ry:3},{x:9,y:4,z:4,ry:3},{x:9,y:4,z:5,ry:1},{x:9,y:4,z:6,ry:2},{x:9,y:4,z:7},{x:9,y:4,z:8,ry:2},{x:9,y:4,z:9,ry:2},{x:9,y:5,z:5,ry:1},{x:9,y:5,z:6,ry:3},{x:9,y:5,z:8,ry:2},{x:9,y:5,z:9,ry:1},{x:9,y:6,z:5},{x:9,y:6,z:6,ry:1},{x:9,y:6,z:7},{x:9,y:6,z:8},{x:9,y:6,z:9,ry:1},{x:9,y:7,z:5},{x:9,y:7,z:6,ry:3},{x:9,y:7,z:7,ry:1},{x:9,y:7,z:8,ry:2},{x:9,y:7,z:9,ry:3},{x:10,y:1,z:0},{x:10,y:1,z:1,ry:2},{x:10,y:1,z:2},{x:10,y:1,z:8,ry:1},{x:10,y:2,z:2},{x:10,y:2,z:3},{x:10,y:2,z:4,ry:2},{x:10,y:2,z:5,ry:1},{x:10,y:2,z:6},{x:10,y:2,z:7,ry:1},{x:10,y:2,z:8,ry:1},{x:10,y:4,z:4,ry:1},{x:10,y:4,z:5,ry:2},{x:11,y:1,z:0,ry:3},{x:11,y:1,z:1,ry:3},{x:11,y:1,z:2,ry:3},{x:11,y:1,z:8},{x:11,y:2,z:0,ry:3},{x:11,y:2,z:1},{x:11,y:2,z:2,ry:1},{x:11,y:2,z:3,ry:1},{x:11,y:2,z:4,ry:2},{x:11,y:2,z:5},{x:11,y:2,z:6,ry:2},{x:11,y:2,z:7,ry:2},{x:11,y:2,z:8,ry:2},{x:11,y:3,z:0,ry:3},{x:11,y:3,z:1,ry:1},{x:11,y:3,z:2,ry:1},{x:11,y:3,z:7,ry:1},{x:11,y:3,z:8,ry:3},{x:11,y:4,z:0,ry:1},{x:11,y:4,z:1,ry:3},{x:11,y:4,z:2,ry:1},{x:11,y:4,z:3},{x:11,y:4,z:4,ry:3},{x:11,y:4,z:5,ry:3},{x:11,y:4,z:6,ry:1},{x:11,y:4,z:7,ry:3},{x:11,y:4,z:8,ry:1},{x:11,y:5,z:0,ry:3},{x:11,y:5,z:1},{x:11,y:5,z:3,ry:3},{x:11,y:5,z:4,ry:3},{x:11,y:6,z:0,ry:1},{x:11,y:6,z:1,ry:2},{x:11,y:6,z:2,ry:3},{x:11,y:6,z:3,ry:2},{x:11,y:6,z:4},{x:11,y:7,z:0},{x:11,y:7,z:1,ry:3},{x:11,y:7,z:3,ry:3},{x:11,y:7,z:4,ry:3},{x:11,y:8,z:0,ry:3},{x:11,y:8,z:1,ry:2},{x:11,y:8,z:2,ry:3},{x:11,y:8,z:3,ry:1},{x:11,y:8,z:4},{x:11,y:8,z:5,ry:3},{x:11,y:8,z:6,ry:2},{x:11,y:8,z:7,ry:1},{x:12,y:1,z:0,ry:3},{x:12,y:1,z:8,ry:3},{x:12,y:2,z:0,ry:1},{x:12,y:2,z:3,ry:1},{x:12,y:2,z:4,ry:1},{x:12,y:2,z:5},{x:12,y:2,z:6,ry:2},{x:12,y:2,z:8,ry:1},{x:12,y:3,z:0,ry:2},{x:12,y:3,z:8,ry:3},{x:12,y:4,z:0,ry:1},{x:12,y:4,z:1},{x:12,y:4,z:2,ry:1},{x:12,y:4,z:3,ry:2},{x:12,y:4,z:4},{x:12,y:4,z:5,ry:3},{x:12,y:4,z:6},{x:12,y:4,z:7,ry:2},{x:12,y:4,z:8,ry:2},{x:12,y:5,z:0,ry:2},{x:12,y:5,z:4,ry:3},{x:12,y:6,z:0,ry:2},{x:12,y:6,z:1},{x:12,y:6,z:2},{x:12,y:6,z:3,ry:1},{x:12,y:6,z:4,ry:2},{x:12,y:7,z:0,ry:2},{x:12,y:7,z:4,ry:2},{x:12,y:8,z:0},{x:12,y:8,z:1},{x:12,y:8,z:2,ry:3},{x:12,y:8,z:3},{x:12,y:8,z:4,ry:1},{x:12,y:8,z:5},{x:12,y:8,z:6,ry:3},{x:12,y:8,z:7,ry:1},{x:13,y:1,z:0,ry:3},{x:13,y:1,z:4,ry:1},{x:13,y:1,z:5,ry:3},{x:13,y:1,z:6,ry:1},{x:13,y:1,z:8,ry:2},{x:13,y:2,z:0,ry:1},{x:13,y:2,z:3,ry:3},{x:13,y:2,z:4,ry:3},{x:13,y:2,z:5,ry:2},{x:13,y:2,z:6,ry:2},{x:13,y:2,z:8,ry:2},{x:13,y:3,z:0,ry:1},{x:13,y:3,z:8,ry:1},{x:13,y:4,z:0,ry:2},{x:13,y:4,z:1,ry:3},{x:13,y:4,z:2,ry:1},{x:13,y:4,z:3},{x:13,y:4,z:5,ry:3},{x:13,y:4,z:6,ry:1},{x:13,y:4,z:7},{x:13,y:4,z:8,ry:1},{x:13,y:5,z:0,ry:3},{x:13,y:5,z:1,ry:1},{x:13,y:5,z:8,ry:2},{x:13,y:6,z:0,ry:2},{x:13,y:6,z:1,ry:1},{x:13,y:6,z:3,ry:3},{x:13,y:6,z:4,ry:3},{x:13,y:6,z:9,ry:3},{x:13,y:7,z:0,ry:1},{x:13,y:7,z:4,ry:2},{x:13,y:8,z:0,ry:1},{x:13,y:8,z:1},{x:13,y:8,z:2,ry:2},{x:13,y:8,z:3,ry:1},{x:13,y:8,z:4,ry:1},{x:13,y:8,z:5,ry:2},{x:13,y:8,z:6,ry:1},{x:13,y:8,z:7},{x:13,y:10,z:3,ry:1},{x:13,y:10,z:4,ry:2},{x:13,y:10,z:5},{x:13,y:10,z:6,ry:1},{x:13,y:10,z:7},{x:13,y:10,z:8,ry:1},{x:13,y:10,z:9,ry:3},{x:13,y:11,z:3,ry:1},{x:13,y:11,z:9,ry:1},{x:14,y:1,z:0,ry:3},{x:14,y:1,z:4,ry:1},{x:14,y:1,z:5,ry:3},{x:14,y:1,z:6,ry:3},{x:14,y:1,z:7,ry:2},{x:14,y:1,z:8},{x:14,y:2,z:0,ry:3},{x:14,y:2,z:3,ry:1},{x:14,y:2,z:4},{x:14,y:2,z:5,ry:3},{x:14,y:2,z:6,ry:3},{x:14,y:2,z:8,ry:1},{x:14,y:3,z:0},{x:14,y:3,z:4,ry:2},{x:14,y:3,z:8,ry:2},{x:14,y:4,z:0,ry:2},{x:14,y:4,z:1,ry:1},{x:14,y:4,z:2},{x:14,y:4,z:3,ry:2},{x:14,y:4,z:4,ry:1},{x:14,y:4,z:5},{x:14,y:4,z:6,ry:3},{x:14,y:4,z:7,ry:2},{x:14,y:4,z:8,ry:3},{x:14,y:5,z:0,ry:2},{x:14,y:5,z:7,ry:3},{x:14,y:5,z:8,ry:2},{x:14,y:6,z:0,ry:1},{x:14,y:6,z:1,ry:2},{x:14,y:6,z:2},{x:14,y:6,z:3,ry:1},{x:14,y:6,z:4,ry:3},{x:14,y:6,z:5,ry:2},{x:14,y:6,z:6,ry:3},{x:14,y:6,z:7,ry:3},{x:14,y:6,z:8},{x:14,y:6,z:9,ry:2},{x:14,y:7,z:0,ry:1},{x:14,y:7,z:4,ry:3},{x:14,y:7,z:5},{x:14,y:7,z:6,ry:3},{x:14,y:7,z:7,ry:3},{x:14,y:7,z:8},{x:14,y:8,z:0},{x:14,y:8,z:1,ry:2},{x:14,y:8,z:2},{x:14,y:8,z:3},{x:14,y:8,z:4,ry:3},{x:14,y:8,z:5},{x:14,y:8,z:6},{x:14,y:8,z:7},{x:14,y:8,z:8,ry:1},{x:14,y:9,z:4},{x:14,y:9,z:5,ry:1},{x:14,y:9,z:7,ry:3},{x:14,y:9,z:8,ry:3},{x:14,y:10,z:3,ry:1},{x:14,y:10,z:4},{x:14,y:10,z:5,ry:3},{x:14,y:10,z:6,ry:2},{x:14,y:10,z:7},{x:14,y:10,z:8,ry:2},{x:14,y:10,z:9,ry:2},{x:15,y:1,z:0},{x:15,y:1,z:1},{x:15,y:1,z:2,ry:2},{x:15,y:1,z:4,ry:2},{x:15,y:1,z:5},{x:15,y:1,z:6,ry:1},{x:15,y:1,z:7},{x:15,y:1,z:8},{x:15,y:2,z:0,ry:3},{x:15,y:2,z:1,ry:2},{x:15,y:2,z:2,ry:1},{x:15,y:2,z:3,ry:3},{x:15,y:2,z:4,ry:2},{x:15,y:2,z:6,ry:3},{x:15,y:2,z:7},{x:15,y:2,z:8,ry:2},{x:15,y:3,z:0,ry:1},{x:15,y:3,z:1,ry:1},{x:15,y:3,z:2,ry:2},{x:15,y:3,z:3,ry:3},{x:15,y:3,z:4,ry:1},{x:15,y:3,z:8,ry:3},{x:15,y:4,z:0,ry:1},{x:15,y:4,z:1,ry:1},{x:15,y:4,z:2,ry:2},{x:15,y:4,z:3,ry:3},{x:15,y:4,z:4,ry:3},{x:15,y:4,z:8},{x:15,y:5,z:0,ry:3},{x:15,y:5,z:1},{x:15,y:5,z:3},{x:15,y:5,z:4,ry:1},{x:15,y:5,z:8,ry:1},{x:15,y:6,z:0,ry:1},{x:15,y:6,z:1},{x:15,y:6,z:2,ry:3},{x:15,y:6,z:3,ry:3},{x:15,y:6,z:4,ry:3},{x:15,y:6,z:5,ry:3},{x:15,y:6,z:6,ry:2},{x:15,y:6,z:7,ry:2},{x:15,y:6,z:8,ry:2},{x:15,y:6,z:9,ry:1},{x:15,y:7,z:0,ry:3},{x:15,y:7,z:1,ry:2},{x:15,y:7,z:8,ry:1},{x:15,y:8,z:0,ry:2},{x:15,y:8,z:1,ry:2},{x:15,y:8,z:2,ry:3},{x:15,y:8,z:3},{x:15,y:8,z:4,ry:2},{x:15,y:8,z:5},{x:15,y:8,z:6,ry:3},{x:15,y:8,z:7},{x:15,y:8,z:8,ry:2},{x:15,y:9,z:4},{x:15,y:9,z:8,ry:1},{x:15,y:10,z:3},{x:15,y:10,z:4},{x:15,y:10,z:5,ry:3},{x:15,y:10,z:6,ry:2},{x:15,y:10,z:7,ry:1},{x:15,y:10,z:8,ry:2},{x:15,y:10,z:9,ry:1},{x:16,y:1,z:2,ry:2},{x:16,y:1,z:4,ry:1},{x:16,y:1,z:6,ry:2},{x:16,y:1,z:7},{x:16,y:1,z:8,ry:1},{x:16,y:2,z:2},{x:16,y:2,z:3},{x:16,y:2,z:4,ry:2},{x:16,y:2,z:6,ry:1},{x:16,y:2,z:7,ry:2},{x:16,y:2,z:8,ry:3},{x:16,y:3,z:2,ry:3},{x:16,y:3,z:3,ry:1},{x:16,y:3,z:4,ry:3},{x:16,y:3,z:8,ry:2},{x:16,y:4,z:4},{x:16,y:4,z:8,ry:2},{x:16,y:5,z:4,ry:2},{x:16,y:5,z:8},{x:16,y:6,z:4,ry:2},{x:16,y:6,z:5},{x:16,y:6,z:6,ry:1},{x:16,y:6,z:7},{x:16,y:6,z:8},{x:16,y:6,z:9},{x:16,y:7,z:4,ry:3},{x:16,y:8,z:3,ry:3},{x:16,y:8,z:4,ry:2},{x:16,y:8,z:5},{x:16,y:8,z:7},{x:16,y:8,z:8,ry:2},{x:16,y:9,z:4},{x:16,y:10,z:3,ry:2},{x:16,y:10,z:4,ry:2},{x:16,y:10,z:5,ry:2},{x:16,y:10,z:6},{x:16,y:10,z:7,ry:2},{x:16,y:10,z:9,ry:1},{x:17,y:1,z:6},{x:17,y:1,z:7,ry:2},{x:17,y:1,z:8,ry:1},{x:17,y:2,z:2},{x:17,y:2,z:6},{x:17,y:2,z:7},{x:17,y:2,z:8},{x:17,y:3,z:2},{x:17,y:3,z:3,ry:2},{x:17,y:3,z:4,ry:3},{x:17,y:3,z:6},{x:17,y:3,z:8,ry:2},{x:17,y:4,z:4,ry:1},{x:17,y:4,z:6},{x:17,y:4,z:8,ry:1},{x:17,y:5,z:4,ry:1},{x:17,y:5,z:6},{x:17,y:5,z:8,ry:3},{x:17,y:6,z:4,ry:2},{x:17,y:6,z:5,ry:2},{x:17,y:6,z:6,ry:2},{x:17,y:6,z:7,ry:2},{x:17,y:6,z:8,ry:2},{x:17,y:6,z:9,ry:1},{x:17,y:7,z:4,ry:1},{x:17,y:7,z:5,ry:2},{x:17,y:7,z:6},{x:17,y:7,z:7,ry:1},{x:17,y:7,z:8,ry:3},{x:17,y:8,z:3,ry:1},{x:17,y:8,z:4,ry:1},{x:17,y:8,z:5,ry:3},{x:17,y:8,z:6,ry:1},{x:17,y:8,z:7,ry:2},{x:17,y:8,z:8,ry:3},{x:17,y:9,z:3,ry:1},{x:17,y:9,z:4},{x:17,y:9,z:8,ry:1},{x:17,y:10,z:4},{x:17,y:10,z:5,ry:3},{x:17,y:10,z:6,ry:2},{x:17,y:10,z:7,ry:1},{x:17,y:10,z:8,ry:1},{x:17,y:10,z:9,ry:2},{x:18,y:2,z:2,ry:1},{x:18,y:3,z:2,ry:1},{x:18,y:3,z:3,ry:3},{x:18,y:3,z:4,ry:3},{x:18,y:3,z:5,ry:3},{x:18,y:3,z:6,ry:2},{x:18,y:3,z:7,ry:1},{x:18,y:3,z:8},{x:18,y:4,z:4,ry:3},{x:18,y:4,z:5,ry:1},{x:18,y:4,z:6,ry:2},{x:18,y:4,z:8,ry:3},{x:18,y:5,z:4},{x:18,y:5,z:5,ry:1},{x:18,y:5,z:6,ry:1},{x:18,y:5,z:7,ry:2},{x:18,y:5,z:8},{x:18,y:6,z:4,ry:2},{x:18,y:6,z:5,ry:3},{x:18,y:6,z:6,ry:2},{x:18,y:6,z:7},{x:18,y:6,z:8},{x:18,y:6,z:9,ry:3},{x:18,y:7,z:4,ry:3},{x:18,y:7,z:5},{x:18,y:7,z:6,ry:2},{x:18,y:7,z:7,ry:3},{x:18,y:7,z:8,ry:1},{x:18,y:8,z:3,ry:1},{x:18,y:8,z:4,ry:2},{x:18,y:8,z:5},{x:18,y:8,z:6,ry:3},{x:18,y:8,z:7,ry:2},{x:18,y:8,z:8},{x:18,y:9,z:4,ry:2},{x:18,y:9,z:5},{x:18,y:9,z:7,ry:2},{x:18,y:9,z:8,ry:1},{x:18,y:10,z:4},{x:18,y:10,z:5},{x:18,y:10,z:6},{x:18,y:10,z:7,ry:3},{x:18,y:10,z:8},{x:18,y:10,z:9,ry:3},{x:18,y:11,z:4,ry:1},{x:18,y:11,z:9,ry:3},{x:19,y:1,z:2},{x:19,y:2,z:2,ry:1},{x:19,y:3,z:2,ry:1},{x:19,y:3,z:3,ry:1},{x:19,y:3,z:4},{x:19,y:3,z:5,ry:2},{x:19,y:3,z:6,ry:3},{x:19,y:3,z:7},{x:19,y:3,z:8,ry:2},{x:19,y:6,z:7,ry:3},{x:19,y:6,z:8,ry:2},{x:19,y:6,z:9,ry:1},{x:19,y:7,z:7,ry:1},{x:19,y:8,z:3,ry:1},{x:19,y:8,z:4},{x:19,y:8,z:5},{x:19,y:8,z:6,ry:1},{x:20,y:1,z:2,ry:1},{x:20,y:2,z:2,ry:1},{x:20,y:3,z:2,ry:2},{x:20,y:3,z:3},{x:20,y:3,z:4,ry:1},{x:20,y:3,z:5},{x:20,y:3,z:6,ry:3},{x:20,y:3,z:7,ry:3},{x:20,y:3,z:8,ry:2},{x:21,y:1,z:2},{x:21,y:2,z:2,ry:2},{x:21,y:3,z:2,ry:1},{x:21,y:3,z:3,ry:3},{x:21,y:3,z:4,ry:3},{x:21,y:3,z:5,ry:3},{x:21,y:3,z:6},{x:21,y:3,z:7,ry:2},{x:21,y:3,z:8,ry:1},{x:22,y:1,z:2,ry:2},{x:22,y:1,z:3,ry:2},{x:22,y:1,z:4,ry:2},{x:22,y:1,z:5},{x:22,y:1,z:6,ry:3},{x:22,y:1,z:8,ry:3},{x:22,y:2,z:2,ry:1},{x:22,y:2,z:3,ry:2},{x:22,y:2,z:4},{x:22,y:2,z:5,ry:3},{x:22,y:2,z:6,ry:1},{x:22,y:2,z:8},{x:22,y:3,z:2},{x:22,y:3,z:3},{x:22,y:3,z:4,ry:2},{x:22,y:3,z:5,ry:2},{x:22,y:3,z:6,ry:1},{x:22,y:3,z:7,ry:2},{x:22,y:3,z:8,ry:3}],"generic.stairs.wedge":[{x:3,y:1,z:0,ry:1},{x:4,y:4,z:3,ry:2},{x:5,y:1,z:6,ry:2},{x:5,y:3,z:4,ry:3},{x:6,y:2,z:5,ry:1},{x:6,y:5,z:8,ry:1},{x:7,y:6,z:8,ry:1},{x:8,y:7,z:6,ry:2},{x:9,y:2,z:1},{x:10,y:2,z:1},{x:13,y:1,z:7,ry:1},{x:13,y:5,z:7},{x:13,y:6,z:8},{x:14,y:2,z:7,ry:1},{x:15,y:2,z:5,ry:3},{x:16,y:1,z:5,ry:3},{x:16,y:4,z:2,ry:3},{x:17,y:3,z:7,ry:1},{x:17,y:10,z:3,ry:3},{x:18,y:9,z:3,ry:3},{x:19,y:7,z:8,ry:2},{x:19,y:8,z:7,ry:2}],"generic.barricade.aabb":[{x:4,y:8,z:5,ry:1},{x:4,y:8,z:9},{x:9,y:8,z:5,ry:2},{x:9,y:8,z:7,ry:3},{x:9,y:8,z:9,ry:2},{x:13,y:12,z:3,ry:3},{x:13,y:12,z:9},{x:18,y:12,z:4,ry:3},{x:18,y:12,z:9,ry:2}],"generic.metal-ladder.ladder":[{x:10,y:1,z:9,ry:2},{x:10,y:2,z:9,ry:2},{x:13,y:3,z:4,ry:1},{x:13,y:4,z:4,ry:1},{x:13,y:5,z:2,ry:2},{x:13,y:6,z:2,ry:2},{x:16,y:7,z:6,ry:1},{x:16,y:8,z:6,ry:1},{x:16,y:9,z:8,ry:1},{x:16,y:10,z:8,ry:1}]},palette:["nature.rocks-big.aabb","nature.dirtwalk-center.full","generic.stairs.wedge","scifi.computer.obb",null,null,null,null,null,null],width:24,height:13,depth:12,name:"",surfaceArea:532},{fileVersion:1,data:{"generic.concrete.full":[{x:0,y:0,z:3,ry:2},{x:0,y:0,z:4,ry:3},{x:0,y:0,z:5},{x:0,y:0,z:6},{x:0,y:0,z:7},{x:0,y:0,z:8,ry:3},{x:0,y:0,z:9},{x:0,y:0,z:10,ry:3},{x:0,y:0,z:11,ry:1},{x:0,y:0,z:12},{x:0,y:0,z:13,ry:2},{x:0,y:0,z:14,ry:1},{x:0,y:0,z:15,ry:3},{x:0,y:0,z:16,ry:3},{x:0,y:0,z:17,ry:1},{x:0,y:0,z:18,ry:2},{x:0,y:0,z:19},{x:0,y:1,z:0,ry:3},{x:0,y:1,z:1,ry:3},{x:0,y:1,z:2,ry:3},{x:0,y:1,z:3,ry:1},{x:1,y:0,z:3},{x:1,y:0,z:4,ry:2},{x:1,y:0,z:5},{x:1,y:0,z:6,ry:3},{x:1,y:0,z:7,ry:3},{x:1,y:0,z:8,ry:3},{x:1,y:0,z:9,ry:3},{x:1,y:0,z:10,ry:1},{x:1,y:0,z:11},{x:1,y:0,z:12,ry:3},{x:1,y:0,z:13,ry:2},{x:1,y:0,z:14},{x:1,y:0,z:15,ry:3},{x:1,y:0,z:16},{x:1,y:0,z:17,ry:1},{x:1,y:0,z:18,ry:1},{x:1,y:0,z:19},{x:1,y:1,z:0,ry:1},{x:1,y:1,z:1,ry:1},{x:1,y:1,z:2},{x:1,y:1,z:3,ry:1},{x:2,y:0,z:3,ry:2},{x:2,y:0,z:4,ry:3},{x:2,y:0,z:5},{x:2,y:0,z:6,ry:1},{x:2,y:0,z:7,ry:3},{x:2,y:0,z:8,ry:1},{x:2,y:0,z:9,ry:2},{x:2,y:0,z:10,ry:2},{x:2,y:0,z:11,ry:3},{x:2,y:0,z:12},{x:2,y:0,z:13,ry:3},{x:2,y:0,z:14,ry:2},{x:2,y:0,z:15,ry:3},{x:2,y:0,z:16,ry:2},{x:2,y:0,z:17},{x:2,y:0,z:18,ry:3},{x:2,y:0,z:19,ry:1},{x:2,y:1,z:0,ry:1},{x:2,y:1,z:1},{x:2,y:1,z:2,ry:3},{x:3,y:0,z:0,ry:3},{x:3,y:0,z:1,ry:3},{x:3,y:0,z:2},{x:3,y:0,z:3,ry:1},{x:3,y:0,z:4,ry:3},{x:3,y:0,z:5,ry:1},{x:3,y:0,z:6,ry:1},{x:3,y:0,z:7,ry:3},{x:3,y:0,z:8,ry:1},{x:3,y:0,z:9},{x:3,y:0,z:10},{x:3,y:0,z:11,ry:3},{x:3,y:0,z:12,ry:2},{x:3,y:0,z:13,ry:2},{x:3,y:0,z:14,ry:1},{x:3,y:0,z:15,ry:2},{x:3,y:0,z:16,ry:1},{x:3,y:0,z:17,ry:1},{x:3,y:0,z:18,ry:2},{x:3,y:0,z:19,ry:1},{x:3,y:0,z:20,ry:3},{x:3,y:1,z:0,ry:1},{x:3,y:1,z:1,ry:1},{x:4,y:0,z:0},{x:4,y:0,z:1,ry:1},{x:4,y:0,z:2},{x:4,y:0,z:3,ry:2},{x:4,y:0,z:4,ry:3},{x:4,y:0,z:5,ry:1},{x:4,y:0,z:6},{x:4,y:0,z:7,ry:1},{x:4,y:0,z:8,ry:3},{x:4,y:0,z:9,ry:1},{x:4,y:0,z:10,ry:1},{x:4,y:0,z:11,ry:3},{x:4,y:0,z:12,ry:3},{x:4,y:0,z:13,ry:3},{x:4,y:0,z:14,ry:2},{x:4,y:0,z:15,ry:3},{x:4,y:0,z:16,ry:2},{x:4,y:0,z:17},{x:4,y:0,z:18,ry:3},{x:4,y:0,z:19,ry:2},{x:4,y:0,z:20},{x:5,y:0,z:0},{x:5,y:0,z:1,ry:3},{x:5,y:0,z:2,ry:2},{x:5,y:0,z:3,ry:2},{x:5,y:0,z:4},{x:5,y:0,z:5,ry:1},{x:5,y:0,z:6,ry:3},{x:5,y:0,z:7,ry:2},{x:5,y:0,z:8,ry:1},{x:5,y:0,z:9},{x:5,y:0,z:10,ry:1},{x:5,y:0,z:11,ry:1},{x:5,y:0,z:12},{x:5,y:0,z:13,ry:2},{x:5,y:0,z:14,ry:2},{x:5,y:0,z:15},{x:5,y:0,z:16,ry:2},{x:5,y:0,z:17,ry:3},{x:5,y:0,z:18,ry:2},{x:5,y:0,z:19,ry:3},{x:5,y:0,z:20,ry:2},{x:6,y:0,z:0,ry:3},{x:6,y:0,z:1,ry:3},{x:6,y:0,z:2,ry:3},{x:6,y:0,z:3},{x:6,y:0,z:4,ry:2},{x:6,y:0,z:5},{x:6,y:0,z:6,ry:1},{x:6,y:0,z:7,ry:3},{x:6,y:0,z:8,ry:2},{x:6,y:0,z:9,ry:2},{x:6,y:0,z:10,ry:1},{x:6,y:0,z:11,ry:2},{x:6,y:0,z:12,ry:2},{x:6,y:0,z:13,ry:1},{x:6,y:0,z:14,ry:3},{x:6,y:0,z:15,ry:2},{x:6,y:0,z:16,ry:3},{x:6,y:0,z:17,ry:3},{x:6,y:0,z:18},{x:6,y:0,z:19},{x:6,y:0,z:20,ry:3},{x:7,y:0,z:0},{x:7,y:0,z:1,ry:1},{x:7,y:0,z:2},{x:7,y:0,z:3,ry:2},{x:7,y:0,z:4},{x:7,y:0,z:5},{x:7,y:0,z:6,ry:1},{x:7,y:0,z:7},{x:7,y:0,z:8},{x:7,y:0,z:9,ry:1},{x:7,y:0,z:10,ry:3},{x:7,y:0,z:11,ry:3},{x:7,y:0,z:12,ry:2},{x:7,y:0,z:13,ry:2},{x:7,y:0,z:14,ry:3},{x:7,y:0,z:15},{x:7,y:0,z:16},{x:7,y:0,z:17,ry:2},{x:7,y:0,z:18},{x:7,y:0,z:19,ry:3},{x:7,y:0,z:20,ry:2},{x:8,y:0,z:0,ry:2},{x:8,y:0,z:1,ry:1},{x:8,y:0,z:2,ry:1},{x:8,y:0,z:3,ry:3},{x:8,y:0,z:4,ry:3},{x:8,y:0,z:5,ry:3},{x:8,y:0,z:6},{x:8,y:0,z:7,ry:1},{x:8,y:0,z:8,ry:1},{x:8,y:0,z:9,ry:3},{x:8,y:0,z:10},{x:8,y:0,z:11,ry:3},{x:8,y:0,z:12,ry:2},{x:8,y:0,z:13},{x:8,y:0,z:14,ry:3},{x:8,y:0,z:15},{x:8,y:0,z:16,ry:1},{x:8,y:0,z:17,ry:3},{x:8,y:0,z:18,ry:2},{x:8,y:0,z:19},{x:8,y:0,z:20,ry:1},{x:9,y:0,z:0,ry:1},{x:9,y:0,z:1},{x:9,y:0,z:2,ry:3},{x:9,y:0,z:3,ry:1},{x:9,y:0,z:4},{x:9,y:0,z:5,ry:3},{x:9,y:0,z:6,ry:1},{x:9,y:0,z:7,ry:1},{x:9,y:0,z:8},{x:9,y:0,z:9,ry:2},{x:9,y:0,z:10},{x:9,y:0,z:11,ry:2},{x:9,y:0,z:12,ry:3},{x:9,y:0,z:13,ry:1},{x:9,y:0,z:14},{x:9,y:0,z:15,ry:3},{x:9,y:0,z:16},{x:9,y:0,z:17},{x:9,y:0,z:18},{x:9,y:0,z:19,ry:3},{x:9,y:0,z:20,ry:1},{x:9,y:0,z:21},{x:10,y:0,z:0,ry:1},{x:10,y:0,z:1,ry:2},{x:10,y:0,z:2,ry:2},{x:10,y:0,z:3,ry:1},{x:10,y:0,z:4,ry:1},{x:10,y:0,z:5,ry:2},{x:10,y:0,z:6,ry:1},{x:10,y:0,z:7},{x:10,y:0,z:8},{x:10,y:0,z:9,ry:3},{x:10,y:0,z:10,ry:1},{x:10,y:0,z:11,ry:3},{x:10,y:0,z:12,ry:1},{x:10,y:0,z:13},{x:10,y:0,z:14},{x:10,y:0,z:15,ry:3},{x:10,y:0,z:16,ry:3},{x:10,y:0,z:17,ry:2},{x:10,y:0,z:18,ry:1},{x:10,y:0,z:19,ry:3},{x:10,y:0,z:20,ry:3},{x:10,y:0,z:21,ry:3},{x:11,y:0,z:0,ry:1},{x:11,y:0,z:1},{x:11,y:0,z:2,ry:3},{x:11,y:0,z:3},{x:11,y:0,z:4,ry:3},{x:11,y:0,z:5,ry:3},{x:11,y:0,z:6},{x:11,y:0,z:7,ry:2},{x:11,y:0,z:8},{x:11,y:0,z:9,ry:2},{x:11,y:0,z:10,ry:3},{x:11,y:0,z:11,ry:3},{x:11,y:0,z:12,ry:2},{x:11,y:0,z:13},{x:11,y:0,z:14,ry:1},{x:11,y:0,z:15},{x:11,y:0,z:16,ry:3},{x:11,y:0,z:17},{x:11,y:0,z:18,ry:3},{x:11,y:0,z:19,ry:2},{x:11,y:0,z:20,ry:3},{x:12,y:0,z:0,ry:3},{x:12,y:0,z:1,ry:2},{x:12,y:0,z:2,ry:1},{x:12,y:0,z:3},{x:12,y:0,z:4},{x:12,y:0,z:5},{x:12,y:0,z:6},{x:12,y:0,z:7,ry:1},{x:12,y:0,z:8,ry:1},{x:12,y:0,z:9,ry:3},{x:12,y:0,z:10},{x:12,y:0,z:11,ry:3},{x:12,y:0,z:12,ry:1},{x:12,y:0,z:13,ry:1},{x:12,y:0,z:14},{x:12,y:0,z:15,ry:3},{x:12,y:0,z:16,ry:3},{x:12,y:0,z:17,ry:1},{x:12,y:0,z:18,ry:1},{x:12,y:0,z:19,ry:1},{x:12,y:0,z:20,ry:2},{x:13,y:0,z:0,ry:1},{x:13,y:0,z:1,ry:1},{x:13,y:0,z:2,ry:3},{x:13,y:0,z:3,ry:3},{x:13,y:0,z:4,ry:3},{x:13,y:0,z:5},{x:13,y:0,z:6,ry:3},{x:13,y:0,z:7},{x:13,y:0,z:8},{x:13,y:0,z:9,ry:2},{x:13,y:0,z:10,ry:1},{x:13,y:0,z:11},{x:13,y:0,z:12},{x:13,y:0,z:13,ry:2},{x:13,y:0,z:14,ry:2},{x:13,y:0,z:15,ry:2},{x:13,y:0,z:16,ry:1},{x:13,y:0,z:17,ry:3},{x:13,y:0,z:18},{x:13,y:0,z:19},{x:13,y:0,z:20,ry:1},{x:14,y:0,z:0,ry:2},{x:14,y:0,z:1,ry:1},{x:14,y:0,z:2,ry:1},{x:14,y:0,z:3,ry:1},{x:14,y:0,z:4,ry:1},{x:14,y:0,z:5,ry:3},{x:14,y:0,z:6},{x:14,y:0,z:7,ry:1},{x:14,y:0,z:8,ry:3},{x:14,y:0,z:9},{x:14,y:0,z:10,ry:3},{x:14,y:0,z:11},{x:14,y:0,z:12,ry:3},{x:14,y:0,z:13},{x:14,y:0,z:14,ry:1},{x:14,y:0,z:15,ry:3},{x:14,y:0,z:16,ry:3},{x:14,y:0,z:17,ry:3},{x:14,y:0,z:18},{x:14,y:0,z:19},{x:14,y:0,z:20,ry:3},{x:15,y:0,z:0},{x:15,y:0,z:1,ry:1},{x:15,y:0,z:2,ry:1},{x:15,y:0,z:3},{x:15,y:0,z:4},{x:15,y:0,z:5,ry:2},{x:15,y:0,z:6,ry:3},{x:15,y:0,z:7},{x:15,y:0,z:8,ry:1},{x:15,y:0,z:9,ry:1},{x:15,y:0,z:10,ry:3},{x:15,y:0,z:11},{x:15,y:0,z:12,ry:1},{x:15,y:0,z:13,ry:1},{x:15,y:0,z:14,ry:1},{x:15,y:0,z:15},{x:15,y:0,z:16,ry:1},{x:15,y:0,z:17},{x:15,y:0,z:18},{x:15,y:0,z:19,ry:2},{x:15,y:0,z:20,ry:2},{x:15,y:0,z:21,ry:1},{x:16,y:0,z:0,ry:2},{x:16,y:0,z:1,ry:2},{x:16,y:0,z:2,ry:3},{x:16,y:0,z:3,ry:2},{x:16,y:0,z:4,ry:1},{x:16,y:0,z:5,ry:3},{x:16,y:0,z:6},{x:16,y:0,z:7,ry:1},{x:16,y:0,z:8,ry:3},{x:16,y:0,z:9,ry:1},{x:16,y:0,z:10,ry:1},{x:16,y:0,z:11},{x:16,y:0,z:12,ry:2},{x:16,y:0,z:13,ry:2},{x:16,y:0,z:14,ry:1},{x:16,y:0,z:15,ry:2},{x:16,y:0,z:16},{x:16,y:0,z:17,ry:2},{x:16,y:0,z:18,ry:2},{x:16,y:0,z:19},{x:16,y:0,z:20,ry:1},{x:16,y:0,z:21},{x:17,y:0,z:0},{x:17,y:0,z:1,ry:3},{x:17,y:0,z:2,ry:3},{x:17,y:0,z:3,ry:1},{x:17,y:0,z:4,ry:2},{x:17,y:0,z:5},{x:17,y:0,z:6,ry:1},{x:17,y:0,z:7,ry:2},{x:17,y:0,z:8,ry:1},{x:17,y:0,z:9,ry:1},{x:17,y:0,z:10,ry:3},{x:17,y:0,z:11,ry:3},{x:17,y:0,z:12,ry:3},{x:17,y:0,z:13,ry:1},{x:17,y:0,z:14,ry:3},{x:17,y:0,z:15,ry:1},{x:17,y:0,z:16},{x:17,y:0,z:17,ry:2},{x:17,y:0,z:18,ry:3},{x:17,y:0,z:19,ry:3},{x:17,y:0,z:20,ry:3},{x:17,y:0,z:21,ry:3},{x:18,y:0,z:0,ry:2},{x:18,y:0,z:1,ry:1},{x:18,y:0,z:2,ry:2},{x:18,y:0,z:3,ry:3},{x:18,y:0,z:4,ry:2},{x:18,y:0,z:5},{x:18,y:0,z:6,ry:3},{x:18,y:0,z:7,ry:2},{x:18,y:0,z:8},{x:18,y:0,z:9,ry:2},{x:18,y:0,z:10,ry:2},{x:18,y:0,z:11,ry:1},{x:18,y:0,z:12},{x:18,y:0,z:13,ry:1},{x:18,y:0,z:14,ry:2},{x:18,y:0,z:15,ry:1},{x:18,y:0,z:16,ry:2},{x:18,y:0,z:17},{x:18,y:0,z:18},{x:18,y:0,z:19,ry:3},{x:18,y:0,z:20,ry:3},{x:19,y:0,z:0,ry:1},{x:19,y:0,z:1,ry:2},{x:19,y:0,z:2,ry:2},{x:19,y:0,z:3,ry:3},{x:19,y:0,z:4,ry:3},{x:19,y:0,z:5},{x:19,y:0,z:6,ry:2},{x:19,y:0,z:7,ry:3},{x:19,y:0,z:8},{x:19,y:0,z:9,ry:1},{x:19,y:0,z:10,ry:2},{x:19,y:0,z:11,ry:3},{x:19,y:0,z:12,ry:3},{x:19,y:0,z:13},{x:19,y:0,z:14},{x:19,y:0,z:15},{x:19,y:0,z:16,ry:2},{x:19,y:0,z:17,ry:1},{x:19,y:0,z:18,ry:1},{x:19,y:0,z:19,ry:3},{x:19,y:0,z:20,ry:2},{x:20,y:0,z:0,ry:1},{x:20,y:0,z:1},{x:20,y:0,z:2,ry:2},{x:20,y:0,z:3,ry:2},{x:20,y:0,z:4,ry:3},{x:20,y:0,z:5,ry:3},{x:20,y:0,z:6},{x:20,y:0,z:7,ry:1},{x:20,y:0,z:8,ry:2},{x:20,y:0,z:9,ry:1},{x:20,y:0,z:10,ry:1},{x:20,y:0,z:11,ry:2},{x:20,y:0,z:12,ry:2},{x:20,y:0,z:13,ry:1},{x:20,y:0,z:14},{x:20,y:0,z:15,ry:1},{x:20,y:0,z:16,ry:2},{x:20,y:0,z:17},{x:20,y:0,z:18,ry:3},{x:20,y:0,z:19,ry:2},{x:20,y:0,z:20},{x:21,y:0,z:0,ry:3},{x:21,y:0,z:1,ry:3},{x:21,y:0,z:2,ry:3},{x:21,y:0,z:3},{x:21,y:0,z:4,ry:1},{x:21,y:0,z:5,ry:2},{x:21,y:0,z:6,ry:3},{x:21,y:0,z:7},{x:21,y:0,z:8},{x:21,y:0,z:9},{x:21,y:0,z:10,ry:1},{x:21,y:0,z:11},{x:21,y:0,z:12,ry:2},{x:21,y:0,z:13},{x:21,y:0,z:14,ry:3},{x:21,y:0,z:15,ry:3},{x:21,y:0,z:16,ry:3},{x:21,y:0,z:17,ry:2},{x:21,y:0,z:18,ry:2},{x:21,y:0,z:19,ry:2},{x:21,y:0,z:20,ry:1},{x:22,y:0,z:0},{x:22,y:0,z:1,ry:2},{x:22,y:0,z:2,ry:3},{x:22,y:0,z:3,ry:2},{x:22,y:0,z:4,ry:2},{x:22,y:0,z:5,ry:2},{x:22,y:0,z:6,ry:1},{x:22,y:0,z:7,ry:1},{x:22,y:0,z:8,ry:2},{x:22,y:0,z:9,ry:3},{x:22,y:0,z:10},{x:22,y:0,z:11,ry:1},{x:22,y:0,z:12,ry:2},{x:22,y:0,z:13,ry:1},{x:22,y:0,z:14,ry:1},{x:22,y:0,z:15,ry:2},{x:22,y:0,z:16,ry:3},{x:22,y:0,z:17,ry:3},{x:22,y:0,z:18,ry:3},{x:22,y:0,z:19,ry:2},{x:22,y:0,z:20,ry:1},{x:22,y:1,z:0},{x:22,y:1,z:1,ry:3},{x:23,y:0,z:3,ry:2},{x:23,y:0,z:4,ry:2},{x:23,y:0,z:5,ry:2},{x:23,y:0,z:6},{x:23,y:0,z:7,ry:2},{x:23,y:0,z:8,ry:3},{x:23,y:0,z:9},{x:23,y:0,z:10},{x:23,y:0,z:11,ry:3},{x:23,y:0,z:12,ry:2},{x:23,y:0,z:13},{x:23,y:0,z:14,ry:2},{x:23,y:0,z:15,ry:1},{x:23,y:0,z:16},{x:23,y:0,z:17},{x:23,y:0,z:18,ry:2},{x:23,y:0,z:19},{x:23,y:1,z:0},{x:23,y:1,z:1,ry:3},{x:23,y:1,z:2,ry:2},{x:24,y:0,z:3,ry:2},{x:24,y:0,z:4,ry:2},{x:24,y:0,z:5,ry:2},{x:24,y:0,z:6,ry:3},{x:24,y:0,z:7,ry:1},{x:24,y:0,z:8,ry:1},{x:24,y:0,z:9,ry:2},{x:24,y:0,z:10,ry:3},{x:24,y:0,z:11,ry:1},{x:24,y:0,z:12,ry:3},{x:24,y:0,z:13,ry:2},{x:24,y:0,z:14,ry:2},{x:24,y:0,z:15,ry:3},{x:24,y:0,z:16,ry:3},{x:24,y:0,z:17,ry:2},{x:24,y:0,z:18,ry:1},{x:24,y:0,z:19,ry:1},{x:24,y:1,z:0,ry:2},{x:24,y:1,z:1},{x:24,y:1,z:2,ry:1},{x:24,y:1,z:3},{x:25,y:0,z:3,ry:1},{x:25,y:0,z:4,ry:2},{x:25,y:0,z:5,ry:2},{x:25,y:0,z:6,ry:3},{x:25,y:0,z:7},{x:25,y:0,z:8},{x:25,y:0,z:9,ry:1},{x:25,y:0,z:10},{x:25,y:0,z:11,ry:2},{x:25,y:0,z:12,ry:2},{x:25,y:0,z:13},{x:25,y:0,z:14,ry:3},{x:25,y:0,z:15,ry:1},{x:25,y:0,z:16,ry:3},{x:25,y:0,z:17},{x:25,y:0,z:18,ry:3},{x:25,y:0,z:19,ry:3},{x:25,y:1,z:0,ry:3},{x:25,y:1,z:1,ry:3},{x:25,y:1,z:2,ry:1},{x:25,y:1,z:3,ry:1}],"generic.stairs.wedge":[{x:0,y:1,z:4,ry:2},{x:0,y:5,z:7},{x:1,y:1,z:4,ry:2},{x:1,y:1,z:16,ry:2},{x:1,y:2,z:12,ry:2},{x:3,y:2,z:14,ry:1},{x:3,y:5,z:17,ry:3},{x:4,y:1,z:1,ry:3},{x:4,y:2,z:0,ry:1},{x:5,y:1,z:6,ry:1},{x:5,y:1,z:7,ry:1},{x:5,y:3,z:0,ry:1},{x:6,y:1,z:5},{x:6,y:1,z:8,ry:2},{x:6,y:5,z:20},{x:6,y:6,z:7,ry:2},{x:7,y:1,z:5},{x:7,y:1,z:8,ry:2},{x:7,y:2,z:14,ry:3},{x:7,y:6,z:7,ry:2},{x:8,y:1,z:6,ry:3},{x:8,y:1,z:7,ry:3},{x:8,y:1,z:14,ry:3},{x:10,y:5,z:21,ry:3},{x:11,y:3,z:9,ry:2},{x:12,y:1,z:9},{x:12,y:2,z:10},{x:12,y:4,z:7},{x:12,y:5,z:8},{x:12,y:5,z:17,ry:2},{x:12,y:6,z:2},{x:13,y:1,z:9},{x:13,y:2,z:10},{x:13,y:4,z:7},{x:13,y:5,z:8},{x:13,y:5,z:17,ry:2},{x:13,y:6,z:2},{x:14,y:3,z:9,ry:2},{x:15,y:5,z:21,ry:1},{x:17,y:1,z:6,ry:1},{x:17,y:1,z:7,ry:1},{x:17,y:1,z:14,ry:1},{x:18,y:1,z:5},{x:18,y:1,z:8,ry:2},{x:18,y:2,z:14,ry:1},{x:18,y:6,z:7,ry:2},{x:19,y:1,z:5},{x:19,y:1,z:8,ry:2},{x:19,y:5,z:20},{x:19,y:6,z:7,ry:2},{x:20,y:1,z:6,ry:3},{x:20,y:1,z:7,ry:3},{x:20,y:3,z:0,ry:3},{x:21,y:1,z:1,ry:1},{x:21,y:2,z:0,ry:3},{x:22,y:2,z:14,ry:3},{x:22,y:5,z:17,ry:1},{x:24,y:1,z:4,ry:2},{x:24,y:1,z:16,ry:2},{x:24,y:2,z:12,ry:2},{x:25,y:1,z:4,ry:2},{x:25,y:5,z:7}],"generic.green-block.full":[{x:0,y:1,z:9,ry:3},{x:0,y:1,z:10,ry:3},{x:0,y:1,z:11,ry:3},{x:0,y:1,z:12,ry:3},{x:0,y:1,z:13,ry:2},{x:0,y:1,z:14,ry:2},{x:0,y:1,z:15,ry:2},{x:0,y:1,z:16,ry:2},{x:0,y:1,z:17,ry:2},{x:0,y:1,z:18,ry:2},{x:0,y:1,z:19,ry:2},{x:0,y:2,z:9,ry:3},{x:0,y:2,z:10,ry:3},{x:0,y:2,z:11,ry:3},{x:0,y:2,z:12,ry:3},{x:0,y:2,z:13,ry:2},{x:0,y:2,z:15,ry:2},{x:0,y:2,z:17,ry:2},{x:0,y:2,z:19,ry:2},{x:0,y:3,z:12,ry:3},{x:0,y:3,z:13,ry:2},{x:0,y:3,z:15,ry:2},{x:0,y:3,z:17,ry:2},{x:0,y:3,z:19,ry:2},{x:0,y:4,z:1},{x:0,y:4,z:2},{x:0,y:4,z:3},{x:0,y:4,z:4},{x:0,y:4,z:5},{x:0,y:4,z:6},{x:0,y:4,z:7},{x:0,y:4,z:12,ry:3},{x:0,y:4,z:13,ry:2},{x:0,y:4,z:14,ry:2},{x:0,y:4,z:15,ry:2},{x:0,y:4,z:16,ry:2},{x:0,y:4,z:17,ry:2},{x:0,y:4,z:18,ry:2},{x:0,y:4,z:19,ry:2},{x:0,y:5,z:8},{x:0,y:5,z:9},{x:0,y:5,z:10},{x:0,y:5,z:11},{x:0,y:5,z:12},{x:0,y:5,z:13},{x:0,y:5,z:14,ry:3},{x:0,y:5,z:15,ry:3},{x:0,y:5,z:16,ry:3},{x:0,y:5,z:17,ry:3},{x:0,y:5,z:18,ry:3},{x:0,y:5,z:19,ry:3},{x:0,y:5,z:20,ry:3},{x:0,y:5,z:21,ry:3},{x:0,y:6,z:21,ry:3},{x:0,y:7,z:21,ry:3},{x:0,y:8,z:21,ry:3},{x:0,y:9,z:21,ry:3},{x:1,y:1,z:10,ry:3},{x:1,y:1,z:11,ry:3},{x:1,y:1,z:12,ry:3},{x:1,y:1,z:13,ry:3},{x:1,y:1,z:14,ry:3},{x:1,y:1,z:15,ry:3},{x:1,y:1,z:19,ry:2},{x:1,y:2,z:10,ry:3},{x:1,y:2,z:11,ry:3},{x:1,y:4,z:1},{x:1,y:4,z:2},{x:1,y:4,z:3},{x:1,y:4,z:4},{x:1,y:4,z:5},{x:1,y:4,z:6},{x:1,y:4,z:7},{x:1,y:4,z:19,ry:2},{x:1,y:5,z:8},{x:1,y:5,z:9},{x:1,y:5,z:10},{x:1,y:5,z:11},{x:1,y:5,z:12},{x:1,y:5,z:13},{x:1,y:5,z:14,ry:3},{x:1,y:5,z:15,ry:3},{x:1,y:5,z:16,ry:3},{x:1,y:5,z:17,ry:3},{x:1,y:5,z:18,ry:3},{x:1,y:5,z:19,ry:3},{x:1,y:5,z:20,ry:3},{x:1,y:5,z:21,ry:3},{x:1,y:6,z:21,ry:3},{x:1,y:9,z:21,ry:3},{x:2,y:1,z:3,ry:3},{x:2,y:1,z:9,ry:3},{x:2,y:1,z:10,ry:3},{x:2,y:1,z:11,ry:3},{x:2,y:1,z:12,ry:3},{x:2,y:1,z:13,ry:3},{x:2,y:1,z:14,ry:3},{x:2,y:1,z:15,ry:3},{x:2,y:1,z:19,ry:2},{x:2,y:1,z:20,ry:3},{x:2,y:2,z:3},{x:2,y:2,z:9,ry:3},{x:2,y:2,z:10,ry:3},{x:2,y:2,z:11,ry:3},{x:2,y:2,z:12,ry:3},{x:2,y:2,z:19,ry:2},{x:2,y:2,z:20,ry:3},{x:2,y:3,z:3},{x:2,y:3,z:12,ry:3},{x:2,y:3,z:19,ry:2},{x:2,y:3,z:20,ry:3},{x:2,y:4,z:1},{x:2,y:4,z:3},{x:2,y:4,z:4},{x:2,y:4,z:5},{x:2,y:4,z:6},{x:2,y:4,z:7},{x:2,y:4,z:12,ry:3},{x:2,y:4,z:19,ry:2},{x:2,y:4,z:20,ry:3},{x:2,y:5,z:8},{x:2,y:5,z:9},{x:2,y:5,z:10},{x:2,y:5,z:11},{x:2,y:5,z:12},{x:2,y:5,z:13},{x:2,y:5,z:14,ry:3},{x:2,y:5,z:15,ry:3},{x:2,y:5,z:16,ry:3},{x:2,y:5,z:17,ry:3},{x:2,y:5,z:18,ry:3},{x:2,y:5,z:19,ry:3},{x:2,y:5,z:20,ry:3},{x:2,y:5,z:21,ry:3},{x:2,y:6,z:21,ry:3},{x:2,y:6,z:22,ry:3},{x:2,y:7,z:21,ry:3},{x:2,y:7,z:22,ry:3},{x:2,y:8,z:21,ry:3},{x:2,y:8,z:22,ry:3},{x:2,y:9,z:21,ry:3},{x:2,y:9,z:22,ry:3},{x:3,y:1,z:2,ry:3},{x:3,y:1,z:11,ry:3},{x:3,y:1,z:12,ry:3},{x:3,y:1,z:13,ry:3},{x:3,y:1,z:14,ry:3},{x:3,y:1,z:15,ry:3},{x:3,y:1,z:20,ry:2},{x:3,y:2,z:2,ry:1},{x:3,y:2,z:11,ry:3},{x:3,y:2,z:12,ry:3},{x:3,y:2,z:20,ry:2},{x:3,y:3,z:2},{x:3,y:3,z:11,ry:3},{x:3,y:3,z:12,ry:3},{x:3,y:3,z:20,ry:2},{x:3,y:4,z:1},{x:3,y:4,z:2},{x:3,y:4,z:3},{x:3,y:4,z:11,ry:3},{x:3,y:4,z:12,ry:3},{x:3,y:4,z:16,ry:3},{x:3,y:4,z:17,ry:3},{x:3,y:4,z:18,ry:3},{x:3,y:4,z:19,ry:3},{x:3,y:4,z:20,ry:2},{x:3,y:5,z:10},{x:3,y:5,z:11},{x:3,y:5,z:12},{x:3,y:5,z:16,ry:3},{x:3,y:5,z:18,ry:3},{x:3,y:5,z:19,ry:3},{x:3,y:5,z:20,ry:3},{x:3,y:5,z:21,ry:3},{x:3,y:5,z:22,ry:3},{x:3,y:6,z:12},{x:3,y:6,z:22,ry:3},{x:3,y:7,z:12,ry:2},{x:3,y:7,z:22,ry:3},{x:3,y:8,z:12,ry:2},{x:3,y:8,z:22,ry:3},{x:3,y:9,z:12,ry:2},{x:3,y:9,z:22,ry:3},{x:4,y:1,z:0,ry:3},{x:4,y:1,z:12,ry:3},{x:4,y:1,z:13,ry:3},{x:4,y:1,z:14,ry:3},{x:4,y:1,z:15,ry:3},{x:4,y:1,z:16,ry:3},{x:4,y:1,z:20,ry:2},{x:4,y:2,z:12,ry:3},{x:4,y:2,z:13,ry:3},{x:4,y:2,z:14,ry:3},{x:4,y:2,z:15,ry:3},{x:4,y:2,z:16,ry:3},{x:4,y:3,z:16,ry:3},{x:4,y:4,z:16,ry:3},{x:4,y:4,z:17,ry:3},{x:4,y:4,z:18,ry:3},{x:4,y:4,z:19,ry:3},{x:4,y:4,z:20,ry:2},{x:4,y:5,z:10},{x:4,y:5,z:11},{x:4,y:5,z:12},{x:4,y:5,z:19,ry:3},{x:4,y:5,z:20,ry:3},{x:4,y:5,z:21,ry:3},{x:4,y:5,z:22,ry:3},{x:4,y:6,z:12},{x:4,y:6,z:22,ry:3},{x:4,y:9,z:12,ry:2},{x:4,y:9,z:22,ry:3},{x:5,y:1,z:0,ry:3},{x:5,y:1,z:12,ry:3},{x:5,y:1,z:13,ry:3},{x:5,y:1,z:14,ry:3},{x:5,y:1,z:15,ry:3},{x:5,y:1,z:16,ry:3},{x:5,y:1,z:17,ry:3},{x:5,y:1,z:20,ry:2},{x:5,y:2,z:0,ry:3},{x:5,y:2,z:12,ry:3},{x:5,y:2,z:13,ry:3},{x:5,y:2,z:14,ry:3},{x:5,y:2,z:15,ry:3},{x:5,y:2,z:16,ry:3},{x:5,y:2,z:17,ry:3},{x:5,y:2,z:20,ry:2},{x:5,y:3,z:17,ry:3},{x:5,y:3,z:20,ry:2},{x:5,y:4,z:17,ry:3},{x:5,y:4,z:18,ry:3},{x:5,y:4,z:19,ry:3},{x:5,y:4,z:20,ry:2},{x:5,y:5,z:10},{x:5,y:5,z:11},{x:5,y:5,z:12},{x:5,y:5,z:19,ry:3},{x:5,y:5,z:20,ry:3},{x:5,y:5,z:21,ry:3},{x:5,y:5,z:22,ry:3},{x:5,y:6,z:3,ry:2},{x:5,y:6,z:4,ry:2},{x:5,y:6,z:5,ry:2},{x:5,y:6,z:6,ry:3},{x:5,y:6,z:7,ry:3},{x:5,y:6,z:12},{x:5,y:6,z:22,ry:3},{x:5,y:7,z:12,ry:2},{x:5,y:7,z:22,ry:3},{x:5,y:8,z:12,ry:2},{x:5,y:8,z:22,ry:3},{x:5,y:9,z:12,ry:2},{x:5,y:9,z:22,ry:3},{x:6,y:1,z:0,ry:2},{x:6,y:1,z:12,ry:3},{x:6,y:1,z:13,ry:3},{x:6,y:1,z:14,ry:3},{x:6,y:1,z:15,ry:3},{x:6,y:1,z:16,ry:3},{x:6,y:1,z:20,ry:2},{x:6,y:2,z:12,ry:3},{x:6,y:2,z:13,ry:3},{x:6,y:2,z:14,ry:3},{x:6,y:2,z:15,ry:3},{x:6,y:2,z:16,ry:3},{x:6,y:3,z:0,ry:1},{x:6,y:3,z:1,ry:2},{x:6,y:3,z:16,ry:3},{x:6,y:4,z:16,ry:3},{x:6,y:4,z:17,ry:3},{x:6,y:4,z:18,ry:3},{x:6,y:4,z:19,ry:3},{x:6,y:4,z:20,ry:2},{x:6,y:5,z:7,ry:2},{x:6,y:5,z:8,ry:3},{x:6,y:5,z:9,ry:3},{x:6,y:5,z:10},{x:6,y:5,z:11},{x:6,y:5,z:12},{x:6,y:5,z:21,ry:3},{x:6,y:5,z:22,ry:3},{x:6,y:6,z:3,ry:2},{x:6,y:6,z:4,ry:2},{x:6,y:6,z:5,ry:2},{x:6,y:6,z:6,ry:2},{x:6,y:6,z:12},{x:6,y:6,z:22,ry:3},{x:6,y:9,z:12,ry:2},{x:6,y:9,z:22,ry:3},{x:7,y:1,z:0,ry:2},{x:7,y:1,z:13,ry:3},{x:7,y:1,z:14,ry:3},{x:7,y:1,z:15,ry:3},{x:7,y:1,z:20,ry:2},{x:7,y:1,z:21,ry:3},{x:7,y:2,z:20,ry:2},{x:7,y:2,z:21,ry:3},{x:7,y:3,z:0,ry:1},{x:7,y:3,z:1,ry:2},{x:7,y:3,z:2,ry:2},{x:7,y:3,z:20,ry:2},{x:7,y:3,z:21,ry:3},{x:7,y:4,z:16,ry:3},{x:7,y:4,z:17,ry:3},{x:7,y:4,z:18,ry:3},{x:7,y:4,z:19,ry:3},{x:7,y:4,z:20,ry:2},{x:7,y:4,z:21,ry:3},{x:7,y:5,z:7,ry:2},{x:7,y:5,z:8,ry:3},{x:7,y:5,z:9,ry:3},{x:7,y:5,z:10},{x:7,y:5,z:11},{x:7,y:5,z:12},{x:7,y:5,z:20,ry:3},{x:7,y:5,z:21,ry:3},{x:7,y:5,z:22,ry:3},{x:7,y:6,z:3,ry:2},{x:7,y:6,z:4,ry:2},{x:7,y:6,z:5,ry:2},{x:7,y:6,z:6,ry:2},{x:7,y:6,z:12},{x:7,y:6,z:22,ry:3},{x:7,y:6,z:23,ry:3},{x:7,y:7,z:12,ry:2},{x:7,y:7,z:22,ry:3},{x:7,y:7,z:23,ry:3},{x:7,y:8,z:12,ry:2},{x:7,y:8,z:22,ry:3},{x:7,y:8,z:23,ry:3},{x:7,y:9,z:12,ry:2},{x:7,y:9,z:22,ry:3},{x:7,y:9,z:23,ry:3},{x:8,y:0,z:21,ry:2},{x:8,y:1,z:0,ry:2},{x:8,y:1,z:21,ry:2},{x:8,y:2,z:0,ry:2},{x:8,y:2,z:21,ry:2},{x:8,y:3,z:0,ry:1},{x:8,y:3,z:1,ry:2},{x:8,y:3,z:2,ry:2},{x:8,y:3,z:3,ry:2},{x:8,y:3,z:21,ry:2},{x:8,y:4,z:20,ry:3},{x:8,y:4,z:21,ry:2},{x:8,y:5,z:10},{x:8,y:5,z:11},{x:8,y:5,z:12},{x:8,y:5,z:20,ry:3},{x:8,y:5,z:21,ry:3},{x:8,y:5,z:22,ry:3},{x:8,y:6,z:3,ry:2},{x:8,y:6,z:4,ry:2},{x:8,y:6,z:5,ry:2},{x:8,y:6,z:6,ry:3},{x:8,y:6,z:7,ry:3},{x:8,y:6,z:12},{x:8,y:6,z:23,ry:3},{x:8,y:7,z:23,ry:3},{x:8,y:8,z:23,ry:3},{x:8,y:9,z:12,ry:2},{x:8,y:9,z:23,ry:3},{x:9,y:1,z:0,ry:2},{x:9,y:1,z:21,ry:2},{x:9,y:3,z:0,ry:1},{x:9,y:3,z:1,ry:2},{x:9,y:3,z:2,ry:2},{x:9,y:3,z:3,ry:2},{x:9,y:3,z:4,ry:2},{x:9,y:4,z:20,ry:3},{x:9,y:4,z:21,ry:2},{x:9,y:5,z:10},{x:9,y:5,z:11},{x:9,y:5,z:12},{x:9,y:5,z:20,ry:3},{x:9,y:5,z:21,ry:3},{x:9,y:5,z:22,ry:3},{x:9,y:6,z:3,ry:2},{x:9,y:6,z:4,ry:2},{x:9,y:6,z:5,ry:2},{x:9,y:6,z:12},{x:9,y:6,z:23,ry:3},{x:9,y:7,z:12,ry:2},{x:9,y:8,z:12,ry:2},{x:9,y:9,z:12,ry:2},{x:9,y:9,z:23,ry:3},{x:10,y:1,z:0,ry:2},{x:10,y:1,z:21,ry:2},{x:10,y:2,z:21,ry:2},{x:10,y:3,z:0,ry:1},{x:10,y:3,z:1,ry:1},{x:10,y:3,z:2,ry:1},{x:10,y:3,z:3,ry:1},{x:10,y:3,z:4,ry:1},{x:10,y:3,z:5,ry:2},{x:10,y:3,z:21,ry:2},{x:10,y:4,z:0,ry:2},{x:10,y:4,z:21,ry:2},{x:10,y:5,z:0,ry:2},{x:10,y:5,z:10},{x:10,y:5,z:11},{x:10,y:5,z:12},{x:10,y:5,z:22,ry:3},{x:10,y:6,z:0,ry:2},{x:10,y:6,z:3,ry:2},{x:10,y:6,z:4,ry:2},{x:10,y:6,z:5,ry:2},{x:10,y:6,z:12},{x:10,y:6,z:23,ry:3},{x:10,y:7,z:0,ry:2},{x:10,y:7,z:23,ry:3},{x:10,y:8,z:0,ry:2},{x:10,y:8,z:23,ry:3},{x:10,y:9,z:0,ry:2},{x:10,y:9,z:12,ry:2},{x:10,y:9,z:23,ry:3},{x:11,y:1,z:0,ry:2},{x:11,y:1,z:9},{x:11,y:1,z:10},{x:11,y:1,z:11},{x:11,y:1,z:12,ry:1},{x:11,y:1,z:13},{x:11,y:1,z:20},{x:11,y:1,z:21,ry:3},{x:11,y:2,z:0,ry:2},{x:11,y:2,z:9},{x:11,y:2,z:10},{x:11,y:2,z:11},{x:11,y:2,z:12},{x:11,y:2,z:13,ry:1},{x:11,y:2,z:20},{x:11,y:2,z:21,ry:3},{x:11,y:3,z:0,ry:1},{x:11,y:3,z:1,ry:1},{x:11,y:3,z:2,ry:1},{x:11,y:3,z:3,ry:1},{x:11,y:3,z:4,ry:1},{x:11,y:3,z:5,ry:1},{x:11,y:3,z:6,ry:1},{x:11,y:3,z:7,ry:1},{x:11,y:3,z:8},{x:11,y:3,z:20},{x:11,y:3,z:21,ry:3},{x:11,y:4,z:2,ry:2},{x:11,y:4,z:16},{x:11,y:4,z:17},{x:11,y:4,z:18},{x:11,y:4,z:19},{x:11,y:4,z:20},{x:11,y:4,z:21},{x:11,y:5,z:2,ry:2},{x:11,y:5,z:9},{x:11,y:5,z:10},{x:11,y:5,z:11},{x:11,y:5,z:12},{x:11,y:5,z:13,ry:1},{x:11,y:5,z:14,ry:1},{x:11,y:5,z:15,ry:1},{x:11,y:5,z:16,ry:1},{x:11,y:5,z:22},{x:11,y:6,z:0,ry:2},{x:11,y:6,z:3,ry:2},{x:11,y:6,z:4,ry:2},{x:11,y:6,z:5,ry:2},{x:11,y:6,z:12},{x:11,y:6,z:22},{x:11,y:6,z:23,ry:3},{x:11,y:7,z:12,ry:2},{x:11,y:7,z:22,ry:3},{x:11,y:7,z:23,ry:3},{x:11,y:8,z:12,ry:2},{x:11,y:8,z:22,ry:3},{x:11,y:8,z:23,ry:3},{x:11,y:9,z:0,ry:2},{x:11,y:9,z:12,ry:2},{x:11,y:9,z:22,ry:3},{x:11,y:9,z:23,ry:3},{x:12,y:1,z:10},{x:12,y:1,z:11},{x:12,y:1,z:12,ry:1},{x:12,y:1,z:13,ry:1},{x:12,y:1,z:14,ry:1},{x:12,y:1,z:15,ry:1},{x:12,y:1,z:20},{x:12,y:2,z:11},{x:12,y:2,z:12},{x:12,y:2,z:13,ry:1},{x:12,y:2,z:14,ry:1},{x:12,y:2,z:15,ry:1},{x:12,y:3,z:1,ry:2},{x:12,y:3,z:2,ry:1},{x:12,y:3,z:3,ry:1},{x:12,y:3,z:4,ry:1},{x:12,y:3,z:5,ry:1},{x:12,y:3,z:6,ry:1},{x:12,y:3,z:7,ry:1},{x:12,y:3,z:8,ry:3},{x:12,y:3,z:15},{x:12,y:4,z:1,ry:2},{x:12,y:4,z:2,ry:2},{x:12,y:4,z:8,ry:1},{x:12,y:4,z:15},{x:12,y:4,z:16},{x:12,y:4,z:17},{x:12,y:4,z:18},{x:12,y:4,z:19},{x:12,y:4,z:20},{x:12,y:4,z:21},{x:12,y:5,z:1,ry:3},{x:12,y:5,z:2,ry:2},{x:12,y:5,z:9},{x:12,y:5,z:10},{x:12,y:5,z:11},{x:12,y:5,z:12},{x:12,y:5,z:13,ry:1},{x:12,y:5,z:14,ry:1},{x:12,y:5,z:15,ry:1},{x:12,y:5,z:16,ry:1},{x:12,y:5,z:22},{x:12,y:6,z:0,ry:2},{x:12,y:6,z:3,ry:2},{x:12,y:6,z:4,ry:2},{x:12,y:6,z:5,ry:2},{x:12,y:6,z:22},{x:12,y:7,z:0,ry:2},{x:12,y:8,z:0,ry:2},{x:12,y:9,z:0,ry:2},{x:12,y:9,z:12,ry:2},{x:12,y:9,z:22,ry:3},{x:13,y:1,z:10},{x:13,y:1,z:11},{x:13,y:1,z:12,ry:1},{x:13,y:1,z:13},{x:13,y:1,z:14},{x:13,y:1,z:15,ry:1},{x:13,y:1,z:20},{x:13,y:2,z:11,ry:3},{x:13,y:2,z:12,ry:3},{x:13,y:2,z:13,ry:1},{x:13,y:2,z:14,ry:1},{x:13,y:2,z:15,ry:1},{x:13,y:3,z:1,ry:3},{x:13,y:3,z:2,ry:1},{x:13,y:3,z:3,ry:1},{x:13,y:3,z:4,ry:1},{x:13,y:3,z:5,ry:1},{x:13,y:3,z:6,ry:1},{x:13,y:3,z:7,ry:1},{x:13,y:3,z:8},{x:13,y:3,z:15},{x:13,y:4,z:1,ry:3},{x:13,y:4,z:2,ry:2},{x:13,y:4,z:8,ry:1},{x:13,y:4,z:15},{x:13,y:4,z:16},{x:13,y:4,z:17},{x:13,y:4,z:18},{x:13,y:4,z:19},{x:13,y:4,z:20},{x:13,y:4,z:21},{x:13,y:5,z:1,ry:3},{x:13,y:5,z:2,ry:2},{x:13,y:5,z:9},{x:13,y:5,z:10},{x:13,y:5,z:11},{x:13,y:5,z:12},{x:13,y:5,z:13,ry:1},{x:13,y:5,z:14,ry:1},{x:13,y:5,z:15,ry:1},{x:13,y:5,z:16,ry:1},{x:13,y:5,z:22},{x:13,y:6,z:0,ry:2},{x:13,y:6,z:3,ry:2},{x:13,y:6,z:4,ry:2},{x:13,y:6,z:5,ry:2},{x:13,y:6,z:22},{x:13,y:7,z:0,ry:2},{x:13,y:8,z:0,ry:2},{x:13,y:9,z:0,ry:2},{x:13,y:9,z:12,ry:2},{x:13,y:9,z:22,ry:3},{x:14,y:1,z:0,ry:2},{x:14,y:1,z:9},{x:14,y:1,z:10},{x:14,y:1,z:11},{x:14,y:1,z:12,ry:1},{x:14,y:1,z:13},{x:14,y:1,z:20},{x:14,y:1,z:21,ry:3},{x:14,y:2,z:0,ry:2},{x:14,y:2,z:9},{x:14,y:2,z:10},{x:14,y:2,z:11},{x:14,y:2,z:12},{x:14,y:2,z:13,ry:1},{x:14,y:2,z:20},{x:14,y:2,z:21,ry:3},{x:14,y:3,z:0,ry:3},{x:14,y:3,z:1,ry:1},{x:14,y:3,z:2,ry:1},{x:14,y:3,z:3,ry:1},{x:14,y:3,z:4,ry:3},{x:14,y:3,z:5,ry:1},{x:14,y:3,z:6,ry:1},{x:14,y:3,z:7,ry:1},{x:14,y:3,z:8},{x:14,y:3,z:20},{x:14,y:3,z:21,ry:3},{x:14,y:4,z:2,ry:2},{x:14,y:4,z:16},{x:14,y:4,z:17},{x:14,y:4,z:18},{x:14,y:4,z:19},{x:14,y:4,z:20},{x:14,y:4,z:21},{x:14,y:5,z:2,ry:2},{x:14,y:5,z:9,ry:1},{x:14,y:5,z:10,ry:1},{x:14,y:5,z:11,ry:1},{x:14,y:5,z:12},{x:14,y:5,z:13,ry:1},{x:14,y:5,z:14,ry:1},{x:14,y:5,z:15,ry:1},{x:14,y:5,z:16,ry:1},{x:14,y:5,z:22},{x:14,y:6,z:0,ry:2},{x:14,y:6,z:3,ry:2},{x:14,y:6,z:4,ry:2},{x:14,y:6,z:5,ry:2},{x:14,y:6,z:12},{x:14,y:6,z:22},{x:14,y:6,z:23,ry:3},{x:14,y:7,z:12,ry:2},{x:14,y:7,z:22,ry:3},{x:14,y:7,z:23,ry:3},{x:14,y:8,z:12,ry:2},{x:14,y:8,z:22,ry:3},{x:14,y:8,z:23,ry:3},{x:14,y:9,z:0,ry:2},{x:14,y:9,z:12,ry:2},{x:14,y:9,z:22,ry:3},{x:14,y:9,z:23,ry:3},{x:15,y:1,z:0,ry:2},{x:15,y:1,z:21},{x:15,y:2,z:21},{x:15,y:3,z:0,ry:3},{x:15,y:3,z:1,ry:1},{x:15,y:3,z:2,ry:1},{x:15,y:3,z:3,ry:1},{x:15,y:3,z:4,ry:3},{x:15,y:3,z:5,ry:3},{x:15,y:3,z:21},{x:15,y:4,z:0,ry:2},{x:15,y:4,z:21},{x:15,y:5,z:0,ry:2},{x:15,y:5,z:10,ry:1},{x:15,y:5,z:11,ry:1},{x:15,y:5,z:12},{x:15,y:5,z:22},{x:15,y:6,z:0,ry:2},{x:15,y:6,z:3,ry:2},{x:15,y:6,z:4,ry:2},{x:15,y:6,z:5,ry:2},{x:15,y:6,z:12},{x:15,y:6,z:23,ry:3},{x:15,y:7,z:0,ry:2},{x:15,y:7,z:23,ry:3},{x:15,y:8,z:0,ry:2},{x:15,y:8,z:23,ry:3},{x:15,y:9,z:0,ry:2},{x:15,y:9,z:12,ry:2},{x:15,y:9,z:23,ry:3},{x:16,y:1,z:0,ry:2},{x:16,y:1,z:21},{x:16,y:3,z:0,ry:3},{x:16,y:3,z:1,ry:3},{x:16,y:3,z:2,ry:3},{x:16,y:3,z:3,ry:3},{x:16,y:3,z:4,ry:3},{x:16,y:4,z:20},{x:16,y:4,z:21},{x:16,y:5,z:10,ry:1},{x:16,y:5,z:11,ry:1},{x:16,y:5,z:12},{x:16,y:5,z:20},{x:16,y:5,z:21},{x:16,y:5,z:22},{x:16,y:6,z:3,ry:2},{x:16,y:6,z:4,ry:2},{x:16,y:6,z:5,ry:2},{x:16,y:6,z:12},{x:16,y:6,z:23,ry:3},{x:16,y:7,z:12,ry:2},{x:16,y:8,z:12,ry:2},{x:16,y:9,z:12,ry:2},{x:16,y:9,z:23,ry:3},{x:17,y:1,z:0,ry:2},{x:17,y:1,z:21},{x:17,y:2,z:0,ry:2},{x:17,y:2,z:21},{x:17,y:3,z:0,ry:3},{x:17,y:3,z:1,ry:3},{x:17,y:3,z:2,ry:3},{x:17,y:3,z:3,ry:3},{x:17,y:3,z:21},{x:17,y:4,z:20},{x:17,y:4,z:21},{x:17,y:5,z:10,ry:1},{x:17,y:5,z:11,ry:1},{x:17,y:5,z:12},{x:17,y:5,z:20},{x:17,y:5,z:21},{x:17,y:5,z:22},{x:17,y:6,z:3,ry:2},{x:17,y:6,z:4,ry:2},{x:17,y:6,z:5,ry:2},{x:17,y:6,z:6,ry:3},{x:17,y:6,z:7,ry:3},{x:17,y:6,z:12},{x:17,y:6,z:23,ry:3},{x:17,y:7,z:23,ry:3},{x:17,y:8,z:23,ry:3},{x:17,y:9,z:12,ry:2},{x:17,y:9,z:23,ry:3},{x:18,y:1,z:0,ry:2},{x:18,y:1,z:13},{x:18,y:1,z:14},{x:18,y:1,z:15},{x:18,y:1,z:20,ry:1},{x:18,y:1,z:21,ry:3},{x:18,y:2,z:20,ry:1},{x:18,y:2,z:21,ry:3},{x:18,y:3,z:0,ry:3},{x:18,y:3,z:1,ry:3},{x:18,y:3,z:2,ry:3},{x:18,y:3,z:20,ry:1},{x:18,y:3,z:21,ry:3},{x:18,y:4,z:16},{x:18,y:4,z:17},{x:18,y:4,z:18},{x:18,y:4,z:19},{x:18,y:4,z:20,ry:1},{x:18,y:4,z:21,ry:3},{x:18,y:5,z:7,ry:3},{x:18,y:5,z:8,ry:3},{x:18,y:5,z:9,ry:3},{x:18,y:5,z:10,ry:1},{x:18,y:5,z:11,ry:1},{x:18,y:5,z:12},{x:18,y:5,z:20},{x:18,y:5,z:21},{x:18,y:5,z:22},{x:18,y:6,z:3,ry:2},{x:18,y:6,z:4,ry:2},{x:18,y:6,z:5,ry:2},{x:18,y:6,z:6,ry:2},{x:18,y:6,z:12},{x:18,y:6,z:22},{x:18,y:6,z:23,ry:3},{x:18,y:7,z:12,ry:2},{x:18,y:7,z:22,ry:3},{x:18,y:7,z:23,ry:3},{x:18,y:8,z:12,ry:2},{x:18,y:8,z:22,ry:3},{x:18,y:8,z:23,ry:3},{x:18,y:9,z:12,ry:2},{x:18,y:9,z:22,ry:3},{x:18,y:9,z:23,ry:3},{x:19,y:1,z:0,ry:2},{x:19,y:1,z:12,ry:3},{x:19,y:1,z:13,ry:3},{x:19,y:1,z:14,ry:3},{x:19,y:1,z:15,ry:3},{x:19,y:1,z:16,ry:3},{x:19,y:1,z:20,ry:1},{x:19,y:2,z:12,ry:3},{x:19,y:2,z:13,ry:3},{x:19,y:2,z:14,ry:3},{x:19,y:2,z:15,ry:3},{x:19,y:2,z:16,ry:3},{x:19,y:3,z:0,ry:3},{x:19,y:3,z:1,ry:3},{x:19,y:3,z:16,ry:3},{x:19,y:4,z:16,ry:3},{x:19,y:4,z:17,ry:3},{x:19,y:4,z:18,ry:1},{x:19,y:4,z:19,ry:1},{x:19,y:4,z:20,ry:1},{x:19,y:5,z:7,ry:3},{x:19,y:5,z:8,ry:3},{x:19,y:5,z:9,ry:3},{x:19,y:5,z:10,ry:1},{x:19,y:5,z:11,ry:1},{x:19,y:5,z:12},{x:19,y:5,z:21},{x:19,y:5,z:22},{x:19,y:6,z:3,ry:2},{x:19,y:6,z:4,ry:2},{x:19,y:6,z:5,ry:2},{x:19,y:6,z:6,ry:2},{x:19,y:6,z:12},{x:19,y:6,z:22},{x:19,y:9,z:12,ry:2},{x:19,y:9,z:22,ry:3},{x:20,y:1,z:0},{x:20,y:1,z:12,ry:3},{x:20,y:1,z:13,ry:3},{x:20,y:1,z:14,ry:3},{x:20,y:1,z:15,ry:3},{x:20,y:1,z:16,ry:3},{x:20,y:1,z:17,ry:3},{x:20,y:1,z:20,ry:1},{x:20,y:2,z:0},{x:20,y:2,z:12,ry:3},{x:20,y:2,z:13,ry:3},{x:20,y:2,z:14,ry:3},{x:20,y:2,z:15,ry:3},{x:20,y:2,z:16,ry:3},{x:20,y:2,z:17,ry:3},{x:20,y:2,z:20,ry:1},{x:20,y:3,z:17,ry:3},{x:20,y:3,z:20,ry:1},{x:20,y:4,z:17,ry:3},{x:20,y:4,z:18,ry:1},{x:20,y:4,z:19,ry:1},{x:20,y:4,z:20},{x:20,y:5,z:10,ry:1},{x:20,y:5,z:11,ry:1},{x:20,y:5,z:12},{x:20,y:5,z:19,ry:1},{x:20,y:5,z:20,ry:1},{x:20,y:5,z:21},{x:20,y:5,z:22},{x:20,y:6,z:3,ry:2},{x:20,y:6,z:4,ry:2},{x:20,y:6,z:5,ry:2},{x:20,y:6,z:6,ry:3},{x:20,y:6,z:7,ry:3},{x:20,y:6,z:12},{x:20,y:6,z:22},{x:20,y:7,z:12,ry:2},{x:20,y:7,z:22,ry:3},{x:20,y:8,z:12,ry:2},{x:20,y:8,z:22,ry:3},{x:20,y:9,z:12,ry:2},{x:20,y:9,z:22,ry:3},{x:21,y:1,z:0},{x:21,y:1,z:12,ry:3},{x:21,y:1,z:13,ry:3},{x:21,y:1,z:14,ry:3},{x:21,y:1,z:15,ry:3},{x:21,y:1,z:16,ry:1},{x:21,y:1,z:20,ry:1},{x:21,y:2,z:12,ry:3},{x:21,y:2,z:13,ry:3},{x:21,y:2,z:14,ry:3},{x:21,y:2,z:15,ry:3},{x:21,y:2,z:16,ry:3},{x:21,y:3,z:16,ry:3},{x:21,y:4,z:16,ry:3},{x:21,y:4,z:17,ry:3},{x:21,y:4,z:18,ry:1},{x:21,y:4,z:19,ry:1},{x:21,y:4,z:20,ry:1},{x:21,y:5,z:10,ry:1},{x:21,y:5,z:11,ry:1},{x:21,y:5,z:12},{x:21,y:5,z:19,ry:1},{x:21,y:5,z:20,ry:1},{x:21,y:5,z:21,ry:3},{x:21,y:5,z:22,ry:3},{x:21,y:6,z:12},{x:21,y:6,z:22,ry:3},{x:21,y:9,z:12,ry:2},{x:21,y:9,z:22,ry:3},{x:22,y:1,z:2},{x:22,y:1,z:11,ry:2},{x:22,y:1,z:12,ry:2},{x:22,y:1,z:13,ry:3},{x:22,y:1,z:14,ry:2},{x:22,y:1,z:15,ry:3},{x:22,y:1,z:20,ry:1},{x:22,y:2,z:2,ry:1},{x:22,y:2,z:11,ry:2},{x:22,y:2,z:12,ry:2},{x:22,y:2,z:20,ry:1},{x:22,y:3,z:2,ry:1},{x:22,y:3,z:11,ry:2},{x:22,y:3,z:12,ry:2},{x:22,y:3,z:20,ry:1},{x:22,y:4,z:1,ry:1},{x:22,y:4,z:2,ry:1},{x:22,y:4,z:3},{x:22,y:4,z:11,ry:2},{x:22,y:4,z:12,ry:2},{x:22,y:4,z:16,ry:3},{x:22,y:4,z:17,ry:3},{x:22,y:4,z:18,ry:1},{x:22,y:4,z:19,ry:1},{x:22,y:4,z:20,ry:1},{x:22,y:5,z:10,ry:1},{x:22,y:5,z:11,ry:1},{x:22,y:5,z:12},{x:22,y:5,z:16,ry:3},{x:22,y:5,z:18,ry:1},{x:22,y:5,z:19,ry:1},{x:22,y:5,z:20,ry:1},{x:22,y:5,z:21,ry:3},{x:22,y:5,z:22,ry:3},{x:22,y:6,z:12},{x:22,y:6,z:22,ry:3},{x:22,y:7,z:12,ry:2},{x:22,y:7,z:22,ry:3},{x:22,y:8,z:12,ry:2},{x:22,y:8,z:22,ry:3},{x:22,y:9,z:12,ry:2},{x:22,y:9,z:22,ry:3},{x:23,y:1,z:3},{x:23,y:1,z:9},{x:23,y:1,z:10},{x:23,y:1,z:11},{x:23,y:1,z:12},{x:23,y:1,z:13,ry:2},{x:23,y:1,z:14,ry:2},{x:23,y:1,z:15,ry:2},{x:23,y:1,z:19,ry:1},{x:23,y:1,z:20,ry:3},{x:23,y:2,z:3},{x:23,y:2,z:9},{x:23,y:2,z:10},{x:23,y:2,z:11},{x:23,y:2,z:12},{x:23,y:2,z:19,ry:1},{x:23,y:2,z:20,ry:3},{x:23,y:3,z:3,ry:1},{x:23,y:3,z:12,ry:2},{x:23,y:3,z:19,ry:1},{x:23,y:3,z:20,ry:3},{x:23,y:4,z:1,ry:1},{x:23,y:4,z:3,ry:1},{x:23,y:4,z:4,ry:1},{x:23,y:4,z:5,ry:1},{x:23,y:4,z:6,ry:1},{x:23,y:4,z:7,ry:1},{x:23,y:4,z:12,ry:2},{x:23,y:4,z:19,ry:1},{x:23,y:4,z:20,ry:3},{x:23,y:5,z:8,ry:1},{x:23,y:5,z:9,ry:1},{x:23,y:5,z:10,ry:1},{x:23,y:5,z:11,ry:1},{x:23,y:5,z:12},{x:23,y:5,z:13},{x:23,y:5,z:14,ry:3},{x:23,y:5,z:15,ry:1},{x:23,y:5,z:16,ry:1},{x:23,y:5,z:17,ry:1},{x:23,y:5,z:18,ry:1},{x:23,y:5,z:19,ry:1},{x:23,y:5,z:20,ry:3},{x:23,y:5,z:21,ry:3},{x:23,y:6,z:21,ry:3},{x:23,y:6,z:22,ry:3},{x:23,y:7,z:21,ry:3},{x:23,y:7,z:22,ry:3},{x:23,y:8,z:21,ry:3},{x:23,y:8,z:22,ry:3},{x:23,y:9,z:21,ry:3},{x:23,y:9,z:22,ry:3},{x:24,y:1,z:10},{x:24,y:1,z:11},{x:24,y:1,z:12,ry:2},{x:24,y:1,z:13,ry:2},{x:24,y:1,z:14,ry:2},{x:24,y:1,z:15,ry:2},{x:24,y:1,z:19,ry:1},{x:24,y:2,z:10},{x:24,y:2,z:11},{x:24,y:4,z:1,ry:1},{x:24,y:4,z:2,ry:1},{x:24,y:4,z:3,ry:1},{x:24,y:4,z:4,ry:1},{x:24,y:4,z:5,ry:1},{x:24,y:4,z:6,ry:1},{x:24,y:4,z:7,ry:1},{x:24,y:4,z:19,ry:1},{x:24,y:5,z:8,ry:1},{x:24,y:5,z:9,ry:1},{x:24,y:5,z:10,ry:1},{x:24,y:5,z:11,ry:1},{x:24,y:5,z:12},{x:24,y:5,z:13},{x:24,y:5,z:14,ry:3},{x:24,y:5,z:15,ry:1},{x:24,y:5,z:16,ry:1},{x:24,y:5,z:17,ry:1},{x:24,y:5,z:18,ry:1},{x:24,y:5,z:19,ry:1},{x:24,y:5,z:20,ry:3},{x:24,y:5,z:21,ry:3},{x:24,y:6,z:21,ry:3},{x:24,y:9,z:21,ry:3},{x:25,y:1,z:9},{x:25,y:1,z:10},{x:25,y:1,z:11},{x:25,y:1,z:12,ry:2},{x:25,y:1,z:13,ry:2},{x:25,y:1,z:14,ry:2},{x:25,y:1,z:15,ry:2},{x:25,y:1,z:16},{x:25,y:1,z:17},{x:25,y:1,z:18},{x:25,y:1,z:19,ry:1},{x:25,y:2,z:9},{x:25,y:2,z:10},{x:25,y:2,z:11},{x:25,y:2,z:12,ry:2},{x:25,y:2,z:13},{x:25,y:2,z:15},{x:25,y:2,z:17},{x:25,y:2,z:19,ry:1},{x:25,y:3,z:12,ry:2},{x:25,y:3,z:13},{x:25,y:3,z:15},{x:25,y:3,z:17},{x:25,y:3,z:19,ry:1},{x:25,y:4,z:1,ry:1},{x:25,y:4,z:2,ry:1},{x:25,y:4,z:3,ry:1},{x:25,y:4,z:4,ry:1},{x:25,y:4,z:5,ry:1},{x:25,y:4,z:6,ry:1},{x:25,y:4,z:7,ry:1},{x:25,y:4,z:12,ry:2},{x:25,y:4,z:13},{x:25,y:4,z:14},{x:25,y:4,z:15},{x:25,y:4,z:16},{x:25,y:4,z:17},{x:25,y:4,z:18},{x:25,y:4,z:19,ry:1},{x:25,y:5,z:8,ry:1},{x:25,y:5,z:9,ry:1},{x:25,y:5,z:10,ry:1},{x:25,y:5,z:11,ry:1},{x:25,y:5,z:12},{x:25,y:5,z:13},{x:25,y:5,z:14,ry:3},{x:25,y:5,z:15,ry:1},{x:25,y:5,z:16,ry:1},{x:25,y:5,z:17,ry:1},{x:25,y:5,z:18,ry:1},{x:25,y:5,z:19,ry:1},{x:25,y:5,z:20,ry:3},{x:25,y:5,z:21,ry:3},{x:25,y:6,z:21,ry:3},{x:25,y:7,z:21,ry:3},{x:25,y:8,z:21,ry:3},{x:25,y:9,z:21,ry:3}],"SPECIAL.barrier.full.verysoft":[{x:0,y:2,z:14,ry:2},{x:0,y:2,z:16,ry:2},{x:0,y:2,z:18,ry:2},{x:0,y:3,z:14,ry:2},{x:0,y:3,z:16,ry:2},{x:0,y:3,z:18,ry:2},{x:0,y:10,z:21,ry:3},{x:1,y:2,z:19,ry:2},{x:1,y:3,z:19,ry:2},{x:1,y:7,z:21,ry:1},{x:1,y:8,z:21,ry:1},{x:1,y:10,z:21,ry:3},{x:2,y:7,z:8,ry:2},{x:2,y:7,z:9,ry:2},{x:2,y:7,z:14,ry:1},{x:2,y:7,z:15,ry:1},{x:2,y:10,z:21,ry:3},{x:2,y:10,z:22,ry:3},{x:3,y:10,z:12,ry:2},{x:3,y:10,z:22,ry:3},{x:4,y:2,z:20,ry:2},{x:4,y:3,z:20,ry:2},{x:4,y:7,z:12,ry:2},{x:4,y:7,z:19,ry:1},{x:4,y:7,z:22,ry:1},{x:4,y:8,z:12,ry:2},{x:4,y:8,z:22,ry:1},{x:4,y:10,z:12,ry:2},{x:4,y:10,z:22,ry:3},{x:5,y:7,z:19,ry:1},{x:5,y:10,z:12,ry:2},{x:5,y:10,z:22,ry:3},{x:6,y:2,z:0,ry:2},{x:6,y:2,z:20,ry:2},{x:6,y:3,z:20,ry:2},{x:6,y:7,z:12,ry:2},{x:6,y:7,z:22,ry:1},{x:6,y:8,z:12,ry:2},{x:6,y:8,z:22,ry:1},{x:6,y:10,z:12,ry:2},{x:6,y:10,z:22,ry:3},{x:7,y:2,z:0,ry:2},{x:7,y:10,z:12,ry:2},{x:7,y:10,z:22,ry:3},{x:7,y:10,z:23,ry:3},{x:8,y:7,z:12,ry:2},{x:8,y:8,z:12,ry:2},{x:8,y:10,z:12,ry:2},{x:8,y:10,z:23,ry:3},{x:9,y:2,z:0,ry:2},{x:9,y:2,z:21,ry:2},{x:9,y:3,z:21,ry:2},{x:9,y:7,z:23,ry:1},{x:9,y:8,z:5,ry:1},{x:9,y:8,z:23,ry:1},{x:9,y:10,z:12,ry:2},{x:9,y:10,z:23,ry:3},{x:10,y:2,z:0,ry:2},{x:10,y:7,z:12,ry:2},{x:10,y:8,z:5,ry:1},{x:10,y:8,z:12,ry:2},{x:10,y:10,z:0,ry:2},{x:10,y:10,z:12,ry:2},{x:10,y:10,z:23,ry:3},{x:11,y:7,z:0,ry:2},{x:11,y:8,z:0,ry:2},{x:11,y:10,z:0,ry:2},{x:11,y:10,z:12,ry:2},{x:11,y:10,z:22,ry:3},{x:11,y:10,z:23,ry:3},{x:12,y:2,z:3,ry:1},{x:12,y:2,z:20},{x:12,y:3,z:20},{x:12,y:7,z:22,ry:1},{x:12,y:8,z:22,ry:1},{x:12,y:10,z:0,ry:2},{x:12,y:10,z:12,ry:2},{x:12,y:10,z:22,ry:3},{x:13,y:2,z:3,ry:1},{x:13,y:2,z:20},{x:13,y:3,z:20},{x:13,y:7,z:22,ry:1},{x:13,y:8,z:22,ry:1},{x:13,y:10,z:0,ry:2},{x:13,y:10,z:12,ry:2},{x:13,y:10,z:22,ry:3},{x:14,y:7,z:0,ry:2},{x:14,y:8,z:0,ry:2},{x:14,y:10,z:0,ry:2},{x:14,y:10,z:12,ry:2},{x:14,y:10,z:22,ry:3},{x:14,y:10,z:23,ry:3},{x:15,y:2,z:0,ry:2},{x:15,y:7,z:12,ry:2},{x:15,y:8,z:5,ry:1},{x:15,y:8,z:12,ry:2},{x:15,y:10,z:0,ry:2},{x:15,y:10,z:12,ry:2},{x:15,y:10,z:23,ry:3},{x:16,y:2,z:0,ry:2},{x:16,y:2,z:21},{x:16,y:3,z:21},{x:16,y:7,z:23,ry:1},{x:16,y:8,z:5,ry:1},{x:16,y:8,z:23,ry:1},{x:16,y:10,z:12,ry:2},{x:16,y:10,z:23,ry:3},{x:17,y:7,z:12,ry:2},{x:17,y:8,z:12,ry:2},{x:17,y:10,z:12,ry:2},{x:17,y:10,z:23,ry:3},{x:18,y:2,z:0,ry:2},{x:18,y:10,z:12,ry:2},{x:18,y:10,z:22,ry:3},{x:18,y:10,z:23,ry:3},{x:19,y:2,z:0,ry:2},{x:19,y:2,z:20,ry:1},{x:19,y:3,z:20,ry:1},{x:19,y:7,z:12,ry:2},{x:19,y:7,z:22,ry:1},{x:19,y:8,z:12,ry:2},{x:19,y:8,z:22,ry:1},{x:19,y:10,z:12,ry:2},{x:19,y:10,z:22,ry:3},{x:20,y:7,z:19,ry:1},{x:20,y:10,z:12,ry:2},{x:20,y:10,z:22,ry:3},{x:21,y:2,z:20,ry:1},{x:21,y:3,z:20,ry:1},{x:21,y:7,z:12,ry:2},{x:21,y:7,z:19,ry:1},{x:21,y:7,z:22,ry:1},{x:21,y:8,z:12,ry:2},{x:21,y:8,z:22,ry:1},{x:21,y:10,z:12,ry:2},{x:21,y:10,z:22,ry:3},{x:22,y:10,z:12,ry:2},{x:22,y:10,z:22,ry:3},{x:23,y:7,z:8,ry:2},{x:23,y:7,z:9,ry:2},{x:23,y:7,z:14,ry:1},{x:23,y:7,z:15,ry:1},{x:23,y:10,z:21,ry:3},{x:23,y:10,z:22,ry:3},{x:24,y:2,z:19,ry:1},{x:24,y:3,z:19,ry:1},{x:24,y:7,z:21,ry:1},{x:24,y:8,z:21,ry:1},{x:24,y:10,z:21,ry:3},{x:25,y:2,z:14},{x:25,y:2,z:16},{x:25,y:2,z:18},{x:25,y:3,z:14},{x:25,y:3,z:16},{x:25,y:3,z:18},{x:25,y:10,z:21,ry:3}],"generic.metal-ladder.ladder":[{x:1,y:1,z:9},{x:1,y:2,z:9},{x:2,y:2,z:2},{x:2,y:3,z:2},{x:2,y:4,z:2},{x:5,y:3,z:16},{x:5,y:4,z:16},{x:10,y:1,z:20,ry:1},{x:10,y:2,z:20,ry:1},{x:10,y:3,z:20,ry:1},{x:10,y:4,z:20,ry:1},{x:11,y:1,z:14,ry:1},{x:11,y:2,z:14,ry:1},{x:11,y:4,z:1,ry:1},{x:11,y:5,z:1,ry:1},{x:12,y:1,z:0,ry:3},{x:12,y:2,z:0,ry:3},{x:12,y:3,z:0,ry:3},{x:13,y:1,z:0,ry:1},{x:13,y:2,z:0,ry:1},{x:13,y:3,z:0,ry:1},{x:14,y:1,z:14,ry:3},{x:14,y:2,z:14,ry:3},{x:14,y:4,z:1,ry:3},{x:14,y:5,z:1,ry:3},{x:15,y:1,z:20,ry:3},{x:15,y:2,z:20,ry:3},{x:15,y:3,z:20,ry:3},{x:15,y:4,z:20,ry:3},{x:20,y:3,z:16},{x:20,y:4,z:16},{x:23,y:2,z:2},{x:23,y:3,z:2},{x:23,y:4,z:2},{x:24,y:1,z:9},{x:24,y:2,z:9}],"generic.barricade.aabb":[{x:2,y:3,z:9,ry:1},{x:3,y:5,z:1},{x:3,y:5,z:3},{x:5,y:1,z:5,ry:3},{x:5,y:1,z:8,ry:3},{x:6,y:3,z:12,ry:2},{x:7,y:2,z:13,ry:3},{x:7,y:2,z:15,ry:3},{x:7,y:5,z:16,ry:3},{x:8,y:1,z:5,ry:3},{x:8,y:1,z:8,ry:3},{x:9,y:6,z:20,ry:3},{x:10,y:4,z:5,ry:1},{x:11,y:6,z:2,ry:2},{x:11,y:6,z:9},{x:11,y:6,z:16},{x:14,y:6,z:2,ry:2},{x:14,y:6,z:9},{x:14,y:6,z:16},{x:15,y:4,z:5,ry:1},{x:16,y:6,z:20,ry:3},{x:17,y:1,z:5},{x:17,y:1,z:8},{x:18,y:2,z:13},{x:18,y:2,z:15},{x:18,y:5,z:16,ry:3},{x:19,y:3,z:12,ry:2},{x:20,y:1,z:5},{x:20,y:1,z:8},{x:22,y:5,z:1},{x:22,y:5,z:3},{x:23,y:3,z:9,ry:1}],"generic.inset-blue.full":[{x:2,y:6,z:8},{x:2,y:6,z:9,ry:2},{x:2,y:6,z:14},{x:2,y:6,z:15,ry:2},{x:4,y:6,z:19,ry:1},{x:5,y:6,z:19,ry:3},{x:6,y:1,z:6,ry:1},{x:6,y:1,z:7,ry:1},{x:7,y:1,z:6,ry:1},{x:7,y:1,z:7,ry:1},{x:9,y:7,z:5,ry:1},{x:10,y:7,z:5,ry:3},{x:12,y:1,z:3,ry:1},{x:13,y:1,z:3,ry:3},{x:15,y:7,z:5,ry:1},{x:16,y:7,z:5,ry:3},{x:18,y:1,z:6,ry:1},{x:18,y:1,z:7,ry:1},{x:19,y:1,z:6,ry:1},{x:19,y:1,z:7,ry:1},{x:20,y:6,z:19,ry:1},{x:21,y:6,z:19,ry:3},{x:23,y:6,z:8},{x:23,y:6,z:9,ry:2},{x:23,y:6,z:14},{x:23,y:6,z:15,ry:2}]},palette:["generic.green-block.full","SPECIAL.barrier.full.verysoft","generic.stairs.wedge","scifi.computer.obb","generic.metal-ladder.ladder","shipyard.container-green.full","generic.concrete.full","shipyard.container-orange.full","SPECIAL.barrier.full.verysoft","generic.inset-blue.full"],width:26,height:11,depth:24,name:"",surfaceArea:956},{fileVersion:1,data:{"generic.pavement.full":[{x:0,y:2,z:0,ry:2},{x:0,y:2,z:1,ry:1},{x:0,y:2,z:2,ry:2},{x:0,y:2,z:3},{x:0,y:2,z:4,ry:3},{x:0,y:2,z:5},{x:0,y:2,z:6,ry:3},{x:0,y:2,z:7},{x:0,y:2,z:8,ry:3},{x:0,y:2,z:9,ry:2},{x:0,y:2,z:10,ry:2},{x:0,y:2,z:11},{x:0,y:2,z:12,ry:1},{x:0,y:2,z:13,ry:2},{x:0,y:2,z:14,ry:2},{x:0,y:2,z:15,ry:1},{x:0,y:2,z:16,ry:2},{x:0,y:2,z:17,ry:1},{x:0,y:2,z:18,ry:3},{x:0,y:2,z:19,ry:3},{x:0,y:2,z:20},{x:1,y:2,z:0,ry:2},{x:1,y:2,z:1},{x:1,y:2,z:2},{x:1,y:2,z:3,ry:3},{x:1,y:2,z:4},{x:1,y:2,z:5,ry:1},{x:1,y:2,z:6},{x:1,y:2,z:7,ry:2},{x:1,y:2,z:8},{x:1,y:2,z:9,ry:3},{x:1,y:2,z:10,ry:3},{x:1,y:2,z:11},{x:1,y:2,z:12,ry:1},{x:1,y:2,z:13,ry:3},{x:1,y:2,z:14,ry:1},{x:1,y:2,z:15,ry:1},{x:1,y:2,z:16,ry:1},{x:1,y:2,z:17,ry:3},{x:1,y:2,z:18},{x:1,y:2,z:19,ry:1},{x:1,y:2,z:20,ry:2},{x:2,y:2,z:0,ry:1},{x:2,y:2,z:1,ry:3},{x:2,y:2,z:2,ry:3},{x:2,y:2,z:3,ry:1},{x:2,y:2,z:4},{x:2,y:2,z:5,ry:2},{x:2,y:2,z:6,ry:1},{x:2,y:2,z:7,ry:2},{x:2,y:2,z:8,ry:1},{x:2,y:2,z:9,ry:2},{x:2,y:2,z:10,ry:1},{x:2,y:2,z:11,ry:1},{x:2,y:2,z:12,ry:2},{x:2,y:2,z:13,ry:3},{x:2,y:2,z:14},{x:2,y:2,z:15,ry:2},{x:2,y:2,z:16,ry:3},{x:2,y:2,z:17,ry:2},{x:2,y:2,z:18},{x:2,y:2,z:19,ry:1},{x:2,y:2,z:20,ry:3},{x:3,y:2,z:0,ry:1},{x:3,y:2,z:1,ry:1},{x:3,y:2,z:2,ry:2},{x:3,y:2,z:3,ry:2},{x:3,y:2,z:4,ry:2},{x:3,y:2,z:5,ry:2},{x:3,y:2,z:6},{x:3,y:2,z:7,ry:3},{x:3,y:2,z:8,ry:1},{x:3,y:2,z:9,ry:1},{x:3,y:2,z:10,ry:3},{x:3,y:2,z:11,ry:3},{x:3,y:2,z:12,ry:3},{x:3,y:2,z:13,ry:3},{x:3,y:2,z:14},{x:3,y:2,z:15},{x:3,y:2,z:16},{x:3,y:2,z:17},{x:3,y:2,z:18,ry:1},{x:3,y:2,z:19,ry:1},{x:3,y:2,z:20,ry:2},{x:4,y:2,z:0,ry:3},{x:4,y:2,z:1,ry:3},{x:4,y:2,z:2},{x:4,y:2,z:3},{x:4,y:2,z:4,ry:2},{x:4,y:2,z:5,ry:1},{x:4,y:2,z:6,ry:2},{x:4,y:2,z:7,ry:1},{x:4,y:2,z:8,ry:3},{x:4,y:2,z:9,ry:1},{x:4,y:2,z:10,ry:1},{x:4,y:2,z:11},{x:4,y:2,z:12},{x:4,y:2,z:13,ry:1},{x:4,y:2,z:14},{x:4,y:2,z:15,ry:3},{x:4,y:2,z:16,ry:2},{x:4,y:2,z:17,ry:1},{x:4,y:2,z:18,ry:2},{x:4,y:2,z:19,ry:1},{x:4,y:2,z:20,ry:1},{x:5,y:2,z:0,ry:1},{x:5,y:2,z:1,ry:2},{x:5,y:2,z:2,ry:1},{x:5,y:2,z:3,ry:2},{x:5,y:2,z:4,ry:2},{x:5,y:2,z:5,ry:3},{x:5,y:2,z:6},{x:5,y:2,z:7},{x:5,y:2,z:8,ry:3},{x:5,y:2,z:9,ry:1},{x:5,y:2,z:10,ry:1},{x:5,y:2,z:11,ry:1},{x:5,y:2,z:12,ry:3},{x:5,y:2,z:13,ry:3},{x:5,y:2,z:14},{x:5,y:2,z:15,ry:2},{x:5,y:2,z:16},{x:5,y:2,z:17},{x:5,y:2,z:18,ry:2},{x:5,y:2,z:19,ry:1},{x:5,y:2,z:20},{x:6,y:2,z:0},{x:6,y:2,z:1,ry:2},{x:6,y:2,z:2},{x:6,y:2,z:3},{x:6,y:2,z:4},{x:6,y:2,z:5},{x:6,y:2,z:6},{x:6,y:2,z:7,ry:3},{x:6,y:2,z:8},{x:6,y:2,z:9,ry:1},{x:6,y:2,z:10,ry:3},{x:6,y:2,z:11,ry:2},{x:6,y:2,z:12},{x:6,y:2,z:13},{x:6,y:2,z:14,ry:3},{x:6,y:2,z:15,ry:3},{x:6,y:2,z:16},{x:6,y:2,z:17,ry:1},{x:6,y:2,z:18,ry:3},{x:6,y:2,z:19,ry:2},{x:6,y:2,z:20,ry:3},{x:7,y:2,z:0,ry:2},{x:7,y:2,z:1,ry:1},{x:7,y:2,z:2,ry:1},{x:7,y:2,z:3,ry:1},{x:7,y:2,z:4,ry:1},{x:7,y:2,z:5,ry:2},{x:7,y:2,z:6,ry:3},{x:7,y:2,z:7,ry:3},{x:7,y:2,z:8},{x:7,y:2,z:9,ry:2},{x:7,y:2,z:10},{x:7,y:2,z:11,ry:3},{x:7,y:2,z:12,ry:1},{x:7,y:2,z:13,ry:1},{x:7,y:2,z:14,ry:3},{x:7,y:2,z:15},{x:7,y:2,z:16,ry:1},{x:7,y:2,z:17,ry:2},{x:7,y:2,z:18,ry:1},{x:7,y:2,z:19,ry:2},{x:7,y:2,z:20,ry:1},{x:8,y:1,z:12,ry:2},{x:8,y:1,z:13,ry:1},{x:8,y:1,z:14},{x:8,y:1,z:15},{x:8,y:1,z:16,ry:1},{x:8,y:2,z:0,ry:2},{x:8,y:2,z:1,ry:2},{x:8,y:2,z:2},{x:8,y:2,z:3,ry:1},{x:8,y:2,z:4,ry:2},{x:8,y:2,z:5,ry:3},{x:8,y:2,z:6,ry:3},{x:8,y:2,z:7,ry:1},{x:8,y:2,z:8,ry:1},{x:8,y:2,z:9,ry:2},{x:8,y:2,z:10,ry:2},{x:8,y:2,z:11},{x:8,y:2,z:12,ry:3},{x:8,y:2,z:13,ry:1},{x:8,y:2,z:14},{x:8,y:2,z:15,ry:3},{x:8,y:2,z:16,ry:1},{x:8,y:2,z:17},{x:8,y:2,z:18,ry:1},{x:8,y:2,z:19,ry:3},{x:8,y:2,z:20,ry:1},{x:9,y:0,z:12,ry:1},{x:9,y:0,z:13,ry:1},{x:9,y:0,z:14,ry:1},{x:9,y:0,z:15,ry:1},{x:9,y:0,z:16,ry:2},{x:9,y:1,z:11,ry:1},{x:9,y:1,z:17,ry:2},{x:9,y:2,z:0,ry:3},{x:9,y:2,z:1,ry:3},{x:9,y:2,z:2,ry:2},{x:9,y:2,z:3,ry:2},{x:9,y:2,z:4,ry:2},{x:9,y:2,z:5,ry:3},{x:9,y:2,z:6,ry:1},{x:9,y:2,z:7,ry:1},{x:9,y:2,z:8,ry:2},{x:9,y:2,z:9,ry:2},{x:9,y:2,z:10,ry:2},{x:9,y:2,z:11},{x:9,y:2,z:12,ry:3},{x:9,y:2,z:13,ry:2},{x:9,y:2,z:14},{x:9,y:2,z:15,ry:3},{x:9,y:2,z:17,ry:2},{x:9,y:2,z:18,ry:1},{x:9,y:2,z:19,ry:3},{x:9,y:2,z:20,ry:1},{x:10,y:0,z:12,ry:3},{x:10,y:0,z:13,ry:3},{x:10,y:0,z:14,ry:2},{x:10,y:1,z:11,ry:2},{x:10,y:1,z:15,ry:2},{x:10,y:1,z:16,ry:3},{x:10,y:2,z:0,ry:2},{x:10,y:2,z:1},{x:10,y:2,z:2,ry:3},{x:10,y:2,z:3},{x:10,y:2,z:4,ry:3},{x:10,y:2,z:5},{x:10,y:2,z:6,ry:3},{x:10,y:2,z:7,ry:1},{x:10,y:2,z:8,ry:1},{x:10,y:2,z:9,ry:1},{x:10,y:2,z:10,ry:3},{x:10,y:2,z:11,ry:3},{x:10,y:2,z:12},{x:10,y:2,z:13,ry:1},{x:10,y:2,z:14},{x:10,y:2,z:15,ry:1},{x:10,y:2,z:16,ry:2},{x:10,y:2,z:17,ry:2},{x:10,y:2,z:18,ry:2},{x:10,y:2,z:19,ry:2},{x:10,y:2,z:20,ry:3},{x:11,y:0,z:12,ry:1},{x:11,y:0,z:13},{x:11,y:0,z:14},{x:11,y:1,z:11,ry:3},{x:11,y:1,z:15,ry:1},{x:11,y:2,z:0,ry:1},{x:11,y:2,z:1,ry:2},{x:11,y:2,z:2,ry:2},{x:11,y:2,z:3},{x:11,y:2,z:4},{x:11,y:2,z:5},{x:11,y:2,z:6},{x:11,y:2,z:7,ry:3},{x:11,y:2,z:8,ry:2},{x:11,y:2,z:9,ry:2},{x:11,y:2,z:10,ry:1},{x:11,y:2,z:11,ry:2},{x:11,y:2,z:12,ry:3},{x:11,y:2,z:13,ry:3},{x:11,y:2,z:14,ry:2},{x:11,y:2,z:15,ry:3},{x:11,y:2,z:16,ry:3},{x:11,y:2,z:17,ry:3},{x:11,y:2,z:18,ry:1},{x:11,y:2,z:19},{x:11,y:2,z:20,ry:3},{x:12,y:0,z:12,ry:3},{x:12,y:0,z:13,ry:1},{x:12,y:0,z:14,ry:2},{x:12,y:1,z:11,ry:2},{x:12,y:1,z:15},{x:12,y:2,z:0,ry:2},{x:12,y:2,z:1,ry:3},{x:12,y:2,z:2,ry:1},{x:12,y:2,z:3,ry:3},{x:12,y:2,z:4,ry:2},{x:12,y:2,z:5,ry:1},{x:12,y:2,z:6,ry:3},{x:12,y:2,z:7,ry:3},{x:12,y:2,z:8},{x:12,y:2,z:9,ry:3},{x:12,y:2,z:10,ry:3},{x:12,y:2,z:11,ry:1},{x:12,y:2,z:12},{x:12,y:2,z:13},{x:12,y:2,z:14,ry:1},{x:12,y:2,z:15,ry:2},{x:12,y:2,z:16},{x:12,y:2,z:17,ry:1},{x:12,y:2,z:18},{x:12,y:2,z:19},{x:12,y:2,z:20,ry:3},{x:13,y:0,z:12,ry:1},{x:13,y:0,z:13,ry:1},{x:13,y:0,z:14,ry:1},{x:13,y:1,z:11,ry:3},{x:13,y:1,z:15,ry:3},{x:13,y:1,z:16,ry:1},{x:13,y:2,z:0,ry:3},{x:13,y:2,z:1,ry:1},{x:13,y:2,z:2,ry:2},{x:13,y:2,z:3,ry:2},{x:13,y:2,z:4},{x:13,y:2,z:5,ry:1},{x:13,y:2,z:6},{x:13,y:2,z:7},{x:13,y:2,z:8,ry:2},{x:13,y:2,z:9,ry:3},{x:13,y:2,z:10,ry:3},{x:13,y:2,z:11,ry:2},{x:13,y:2,z:12},{x:13,y:2,z:13,ry:1},{x:13,y:2,z:14,ry:2},{x:13,y:2,z:15,ry:1},{x:13,y:2,z:16,ry:2},{x:13,y:2,z:17,ry:1},{x:13,y:2,z:18,ry:3},{x:13,y:2,z:19,ry:2},{x:13,y:2,z:20,ry:1},{x:14,y:0,z:12},{x:14,y:0,z:13},{x:14,y:0,z:14},{x:14,y:0,z:15,ry:1},{x:14,y:0,z:16,ry:3},{x:14,y:1,z:11},{x:14,y:1,z:17,ry:1},{x:14,y:2,z:0},{x:14,y:2,z:1,ry:2},{x:14,y:2,z:2,ry:2},{x:14,y:2,z:3},{x:14,y:2,z:4,ry:3},{x:14,y:2,z:5},{x:14,y:2,z:6,ry:3},{x:14,y:2,z:7,ry:3},{x:14,y:2,z:8},{x:14,y:2,z:9,ry:2},{x:14,y:2,z:10},{x:14,y:2,z:11,ry:3},{x:14,y:2,z:12,ry:3},{x:14,y:2,z:13,ry:3},{x:14,y:2,z:14},{x:14,y:2,z:15,ry:2},{x:14,y:2,z:16,ry:1},{x:14,y:2,z:17},{x:14,y:2,z:18,ry:3},{x:14,y:2,z:19,ry:1},{x:14,y:2,z:20},{x:15,y:0,z:12,ry:1},{x:15,y:0,z:13,ry:1},{x:15,y:0,z:14,ry:2},{x:15,y:0,z:15,ry:2},{x:15,y:0,z:16,ry:1},{x:15,y:1,z:11,ry:3},{x:15,y:1,z:17,ry:2},{x:15,y:2,z:0},{x:15,y:2,z:1,ry:2},{x:15,y:2,z:2,ry:2},{x:15,y:2,z:3,ry:3},{x:15,y:2,z:4,ry:3},{x:15,y:2,z:5,ry:3},{x:15,y:2,z:6,ry:1},{x:15,y:2,z:7,ry:2},{x:15,y:2,z:8,ry:1},{x:15,y:2,z:9,ry:1},{x:15,y:2,z:10,ry:3},{x:15,y:2,z:11,ry:1},{x:15,y:2,z:12,ry:1},{x:15,y:2,z:13,ry:3},{x:15,y:2,z:14,ry:3},{x:15,y:2,z:15,ry:1},{x:15,y:2,z:16,ry:2},{x:15,y:2,z:17,ry:2},{x:15,y:2,z:18,ry:1},{x:15,y:2,z:19},{x:15,y:2,z:20,ry:2},{x:16,y:0,z:12,ry:3},{x:16,y:0,z:13,ry:2},{x:16,y:0,z:14,ry:2},{x:16,y:0,z:15,ry:3},{x:16,y:0,z:16,ry:2},{x:16,y:1,z:11},{x:16,y:1,z:17,ry:2},{x:16,y:2,z:0},{x:16,y:2,z:1,ry:3},{x:16,y:2,z:2},{x:16,y:2,z:3,ry:2},{x:16,y:2,z:4},{x:16,y:2,z:5},{x:16,y:2,z:6},{x:16,y:2,z:7,ry:3},{x:16,y:2,z:8,ry:2},{x:16,y:2,z:9,ry:1},{x:16,y:2,z:10,ry:3},{x:16,y:2,z:11,ry:1},{x:16,y:2,z:12,ry:2},{x:16,y:2,z:13,ry:1},{x:16,y:2,z:14,ry:2},{x:16,y:2,z:15},{x:16,y:2,z:16,ry:2},{x:16,y:2,z:17},{x:16,y:2,z:18,ry:2},{x:16,y:2,z:19},{x:16,y:2,z:20,ry:3},{x:17,y:0,z:12,ry:2},{x:17,y:0,z:13,ry:1},{x:17,y:0,z:14},{x:17,y:0,z:15,ry:2},{x:17,y:0,z:16,ry:3},{x:17,y:1,z:11},{x:17,y:1,z:17},{x:17,y:2,z:0},{x:17,y:2,z:1,ry:2},{x:17,y:2,z:2},{x:17,y:2,z:3},{x:17,y:2,z:4,ry:1},{x:17,y:2,z:5,ry:3},{x:17,y:2,z:6},{x:17,y:2,z:7},{x:17,y:2,z:8,ry:3},{x:17,y:2,z:9,ry:1},{x:17,y:2,z:10,ry:1},{x:17,y:2,z:11,ry:3},{x:17,y:2,z:12,ry:2},{x:17,y:2,z:13,ry:2},{x:17,y:2,z:14,ry:3},{x:17,y:2,z:15,ry:3},{x:17,y:2,z:16,ry:1},{x:17,y:2,z:17,ry:3},{x:17,y:2,z:18},{x:17,y:2,z:19,ry:2},{x:17,y:2,z:20,ry:2},{x:18,y:0,z:12,ry:2},{x:18,y:0,z:13,ry:1},{x:18,y:0,z:14,ry:2},{x:18,y:0,z:15,ry:2},{x:18,y:0,z:16,ry:1},{x:18,y:1,z:11,ry:1},{x:18,y:1,z:17},{x:18,y:2,z:0,ry:1},{x:18,y:2,z:1,ry:1},{x:18,y:2,z:2},{x:18,y:2,z:3,ry:2},{x:18,y:2,z:4},{x:18,y:2,z:5,ry:3},{x:18,y:2,z:6},{x:18,y:2,z:7,ry:1},{x:18,y:2,z:8,ry:1},{x:18,y:2,z:9,ry:2},{x:18,y:2,z:10},{x:18,y:2,z:11,ry:3},{x:18,y:2,z:12,ry:1},{x:18,y:2,z:13},{x:18,y:2,z:14},{x:18,y:2,z:15,ry:3},{x:18,y:2,z:16,ry:1},{x:18,y:2,z:17},{x:18,y:2,z:18,ry:2},{x:18,y:2,z:19,ry:2},{x:18,y:2,z:20,ry:2},{x:19,y:0,z:15,ry:1},{x:19,y:0,z:16,ry:3},{x:19,y:1,z:12,ry:2},{x:19,y:1,z:13,ry:2},{x:19,y:1,z:14,ry:3},{x:19,y:1,z:17,ry:1},{x:19,y:2,z:0,ry:3},{x:19,y:2,z:1,ry:2},{x:19,y:2,z:2},{x:19,y:2,z:3,ry:1},{x:19,y:2,z:4,ry:3},{x:19,y:2,z:5,ry:1},{x:19,y:2,z:6,ry:1},{x:19,y:2,z:7,ry:3},{x:19,y:2,z:8,ry:2},{x:19,y:2,z:9,ry:2},{x:19,y:2,z:10,ry:2},{x:19,y:2,z:11,ry:2},{x:19,y:2,z:12},{x:19,y:2,z:13,ry:1},{x:19,y:2,z:14,ry:2},{x:19,y:2,z:15,ry:1},{x:19,y:2,z:16},{x:19,y:2,z:17},{x:19,y:2,z:18},{x:19,y:2,z:19,ry:3},{x:19,y:2,z:20,ry:1},{x:20,y:0,z:15,ry:3},{x:20,y:0,z:16,ry:1},{x:20,y:1,z:14,ry:3},{x:20,y:1,z:16},{x:20,y:1,z:17,ry:3},{x:20,y:2,z:0,ry:3},{x:20,y:2,z:1,ry:1},{x:20,y:2,z:2,ry:2},{x:20,y:2,z:3},{x:20,y:2,z:4,ry:2},{x:20,y:2,z:5,ry:1},{x:20,y:2,z:6,ry:2},{x:20,y:2,z:7,ry:2},{x:20,y:2,z:8,ry:1},{x:20,y:2,z:9},{x:20,y:2,z:10,ry:1},{x:20,y:2,z:11,ry:1},{x:20,y:2,z:12,ry:3},{x:20,y:2,z:13,ry:2},{x:20,y:2,z:14,ry:1},{x:20,y:2,z:15},{x:20,y:2,z:16,ry:1},{x:20,y:2,z:17,ry:3},{x:20,y:2,z:18,ry:2},{x:20,y:2,z:19,ry:3},{x:20,y:2,z:20,ry:2},{x:21,y:0,z:15},{x:21,y:0,z:16,ry:3},{x:21,y:0,z:17,ry:2},{x:21,y:1,z:14,ry:1},{x:21,y:1,z:18,ry:2},{x:21,y:2,z:0,ry:1},{x:21,y:2,z:1,ry:1},{x:21,y:2,z:2},{x:21,y:2,z:3,ry:2},{x:21,y:2,z:4,ry:1},{x:21,y:2,z:5,ry:3},{x:21,y:2,z:6,ry:3},{x:21,y:2,z:7},{x:21,y:2,z:8,ry:3},{x:21,y:2,z:9},{x:21,y:2,z:10},{x:21,y:2,z:11},{x:21,y:2,z:12},{x:21,y:2,z:13,ry:1},{x:21,y:2,z:14,ry:2},{x:21,y:2,z:15,ry:1},{x:21,y:2,z:16,ry:3},{x:21,y:2,z:18},{x:21,y:2,z:19},{x:21,y:2,z:20,ry:3},{x:22,y:1,z:15,ry:3},{x:22,y:1,z:16,ry:2},{x:22,y:1,z:17,ry:3},{x:22,y:2,z:0,ry:2},{x:22,y:2,z:1},{x:22,y:2,z:2,ry:3},{x:22,y:2,z:3,ry:1},{x:22,y:2,z:4},{x:22,y:2,z:5,ry:2},{x:22,y:2,z:6,ry:2},{x:22,y:2,z:7,ry:3},{x:22,y:2,z:8},{x:22,y:2,z:9,ry:3},{x:22,y:2,z:10,ry:3},{x:22,y:2,z:11,ry:3},{x:22,y:2,z:12,ry:1},{x:22,y:2,z:13},{x:22,y:2,z:14},{x:22,y:2,z:15},{x:22,y:2,z:16},{x:22,y:2,z:17,ry:1},{x:22,y:2,z:18,ry:2},{x:22,y:2,z:19},{x:22,y:2,z:20},{x:23,y:2,z:0,ry:3},{x:23,y:2,z:1},{x:23,y:2,z:2,ry:1},{x:23,y:2,z:3},{x:23,y:2,z:4,ry:3},{x:23,y:2,z:5,ry:1},{x:23,y:2,z:6,ry:2},{x:23,y:2,z:7,ry:3},{x:23,y:2,z:8,ry:1},{x:23,y:2,z:9,ry:1},{x:23,y:2,z:10,ry:3},{x:23,y:2,z:11,ry:2},{x:23,y:2,z:12,ry:3},{x:23,y:2,z:13,ry:2},{x:23,y:2,z:14,ry:1},{x:23,y:2,z:15},{x:23,y:2,z:16,ry:3},{x:23,y:2,z:17,ry:2},{x:23,y:2,z:18,ry:2},{x:23,y:2,z:19,ry:3},{x:23,y:2,z:20,ry:3},{x:24,y:2,z:0},{x:24,y:2,z:1,ry:3},{x:24,y:2,z:2,ry:2},{x:24,y:2,z:3,ry:3},{x:24,y:2,z:4,ry:1},{x:24,y:2,z:5,ry:1},{x:24,y:2,z:6,ry:3},{x:24,y:2,z:7,ry:2},{x:24,y:2,z:8,ry:1},{x:24,y:2,z:9,ry:1},{x:24,y:2,z:10},{x:24,y:2,z:11,ry:1},{x:24,y:2,z:12},{x:24,y:2,z:13,ry:1},{x:24,y:2,z:14,ry:2},{x:24,y:2,z:15,ry:3},{x:24,y:2,z:16,ry:3},{x:24,y:2,z:17,ry:1},{x:24,y:2,z:18,ry:1},{x:24,y:2,z:19,ry:3},{x:24,y:2,z:20,ry:2}],"shipyard.crate-wood.full":[{x:0,y:3,z:9,ry:2},{x:6,y:3,z:0,ry:2},{x:7,y:3,z:10,ry:1},{x:9,y:3,z:13,ry:2},{x:23,y:3,z:6},{x:23,y:3,z:9}],"generic.brown-block.full":[{x:1,y:3,z:1,ry:3},{x:1,y:3,z:2,ry:2},{x:1,y:3,z:3,ry:1},{x:1,y:3,z:4,ry:1},{x:2,y:4,z:1},{x:2,y:4,z:3,ry:2},{x:2,y:4,z:4,ry:1},{x:3,y:4,z:1,ry:3},{x:3,y:4,z:2},{x:3,y:4,z:3,ry:1},{x:3,y:4,z:4,ry:2},{x:4,y:3,z:1},{x:4,y:3,z:2,ry:2},{x:4,y:3,z:3,ry:3},{x:4,y:3,z:4,ry:2},{x:9,y:3,z:4,ry:2},{x:9,y:3,z:5,ry:1},{x:9,y:3,z:6,ry:3},{x:9,y:3,z:9,ry:3},{x:9,y:3,z:10,ry:2},{x:9,y:3,z:11,ry:3},{x:9,y:4,z:5,ry:3},{x:9,y:4,z:6,ry:3},{x:9,y:4,z:9,ry:3},{x:9,y:4,z:10,ry:3},{x:9,y:5,z:6,ry:2},{x:9,y:5,z:7},{x:9,y:5,z:8,ry:1},{x:9,y:5,z:9,ry:1},{x:9,y:6,z:7,ry:2},{x:9,y:6,z:8,ry:1},{x:10,y:3,z:4,ry:2},{x:10,y:3,z:11,ry:3},{x:10,y:4,z:5,ry:1},{x:10,y:4,z:10},{x:10,y:5,z:6,ry:2},{x:10,y:5,z:9,ry:3},{x:10,y:6,z:7,ry:3},{x:10,y:6,z:8},{x:11,y:1,z:13,ry:1},{x:11,y:3,z:4},{x:11,y:3,z:11,ry:2},{x:11,y:4,z:5,ry:2},{x:11,y:4,z:10,ry:3},{x:11,y:5,z:6,ry:2},{x:11,y:5,z:9,ry:2},{x:11,y:6,z:7,ry:1},{x:11,y:6,z:8,ry:3},{x:12,y:1,z:13},{x:12,y:3,z:4,ry:1},{x:12,y:3,z:11,ry:1},{x:12,y:4,z:5,ry:1},{x:12,y:4,z:10,ry:1},{x:12,y:5,z:6,ry:1},{x:12,y:5,z:9,ry:3},{x:12,y:6,z:7},{x:12,y:6,z:8},{x:13,y:3,z:4,ry:3},{x:13,y:3,z:11,ry:3},{x:13,y:4,z:5,ry:3},{x:13,y:4,z:10,ry:2},{x:13,y:5,z:6,ry:2},{x:13,y:5,z:9,ry:2},{x:13,y:6,z:7},{x:13,y:6,z:8,ry:3},{x:14,y:3,z:4,ry:3},{x:14,y:3,z:11,ry:3},{x:14,y:4,z:5,ry:2},{x:14,y:4,z:10,ry:1},{x:14,y:5,z:9,ry:3},{x:14,y:6,z:6},{x:14,y:6,z:7,ry:3},{x:14,y:6,z:8,ry:2},{x:15,y:1,z:13,ry:3},{x:15,y:4,z:5,ry:3},{x:15,y:4,z:10,ry:3},{x:15,y:5,z:9,ry:3},{x:15,y:6,z:6,ry:2},{x:15,y:6,z:7},{x:15,y:6,z:8,ry:2},{x:16,y:1,z:13,ry:2},{x:16,y:3,z:4,ry:1},{x:16,y:3,z:11},{x:16,y:4,z:5,ry:1},{x:16,y:4,z:10,ry:3},{x:16,y:5,z:9},{x:16,y:6,z:6},{x:16,y:6,z:7,ry:3},{x:16,y:6,z:8,ry:2},{x:17,y:3,z:4,ry:2},{x:17,y:3,z:11},{x:17,y:4,z:5,ry:3},{x:17,y:4,z:10,ry:3},{x:17,y:5,z:6,ry:1},{x:17,y:5,z:9,ry:2},{x:17,y:6,z:7,ry:3},{x:17,y:6,z:8,ry:1},{x:18,y:3,z:4},{x:18,y:3,z:11,ry:1},{x:18,y:4,z:5,ry:2},{x:18,y:4,z:10},{x:18,y:5,z:6},{x:18,y:5,z:9,ry:2},{x:18,y:6,z:7},{x:18,y:6,z:8,ry:2},{x:19,y:3,z:4,ry:1},{x:19,y:3,z:11,ry:1},{x:19,y:4,z:5,ry:2},{x:19,y:4,z:10,ry:1},{x:19,y:5,z:6,ry:1},{x:19,y:5,z:9,ry:1},{x:19,y:6,z:7,ry:1},{x:19,y:6,z:8},{x:20,y:3,z:4,ry:1},{x:20,y:3,z:11},{x:20,y:3,z:16,ry:3},{x:20,y:4,z:5,ry:1},{x:20,y:4,z:10,ry:2},{x:20,y:5,z:6,ry:1},{x:20,y:5,z:9,ry:1},{x:20,y:6,z:7},{x:20,y:6,z:8,ry:2},{x:21,y:3,z:4,ry:2},{x:21,y:3,z:5,ry:1},{x:21,y:3,z:6,ry:3},{x:21,y:3,z:9,ry:2},{x:21,y:3,z:10,ry:3},{x:21,y:3,z:11,ry:3},{x:21,y:3,z:16,ry:1},{x:21,y:4,z:5},{x:21,y:4,z:6,ry:3},{x:21,y:4,z:9,ry:1},{x:21,y:4,z:10,ry:1},{x:21,y:5,z:6,ry:3},{x:21,y:5,z:7},{x:21,y:5,z:8,ry:2},{x:21,y:5,z:9,ry:3},{x:21,y:6,z:7,ry:3},{x:21,y:6,z:8,ry:3},{x:22,y:3,z:16}],"generic.metal-ladder.ladder":[{x:1,y:3,z:11,ry:1},{x:1,y:3,z:16,ry:1},{x:1,y:4,z:16,ry:1},{x:2,y:3,z:2,ry:3},{x:2,y:4,z:9,ry:1},{x:5,y:3,z:13},{x:5,y:4,z:17,ry:3},{x:5,y:5,z:17,ry:3},{x:6,y:3,z:8,ry:3},{x:9,y:1,z:16,ry:1},{x:9,y:2,z:16,ry:1},{x:9,y:3,z:16,ry:1},{x:10,y:4,z:16,ry:2},{x:10,y:5,z:15,ry:3},{x:12,y:3,z:8,ry:1},{x:13,y:3,z:16,ry:1},{x:13,y:4,z:16,ry:1},{x:17,y:4,z:16,ry:2},{x:18,y:3,z:7,ry:3},{x:18,y:3,z:16,ry:3},{x:18,y:4,z:7,ry:3},{x:21,y:1,z:17},{x:21,y:2,z:17},{x:22,y:3,z:1,ry:2}],"generic.roof.wedge":[{x:1,y:4,z:1,ry:1},{x:1,y:4,z:3,ry:1},{x:1,y:4,z:4,ry:1},{x:2,y:5,z:1,ry:1},{x:2,y:5,z:2,ry:1},{x:2,y:5,z:3,ry:1},{x:2,y:5,z:4,ry:1},{x:3,y:5,z:1,ry:3},{x:3,y:5,z:2,ry:3},{x:3,y:5,z:3,ry:3},{x:3,y:5,z:4,ry:3},{x:4,y:4,z:1,ry:3},{x:4,y:4,z:2,ry:3},{x:4,y:4,z:3,ry:3},{x:4,y:4,z:4,ry:3},{x:9,y:4,z:4},{x:9,y:4,z:11,ry:2},{x:9,y:5,z:5},{x:9,y:5,z:10,ry:2},{x:9,y:6,z:6},{x:9,y:6,z:9,ry:2},{x:9,y:7,z:7},{x:9,y:7,z:8,ry:2},{x:10,y:4,z:4},{x:10,y:4,z:11,ry:2},{x:10,y:5,z:5},{x:10,y:5,z:10,ry:2},{x:10,y:6,z:6},{x:10,y:6,z:9,ry:2},{x:10,y:7,z:7},{x:10,y:7,z:8,ry:2},{x:11,y:4,z:4},{x:11,y:4,z:11,ry:2},{x:11,y:5,z:5},{x:11,y:5,z:10,ry:2},{x:11,y:6,z:6},{x:11,y:6,z:9,ry:2},{x:11,y:7,z:7},{x:11,y:7,z:8,ry:2},{x:12,y:4,z:4},{x:12,y:4,z:11,ry:2},{x:12,y:5,z:5},{x:12,y:5,z:10,ry:2},{x:12,y:6,z:6},{x:12,y:6,z:9,ry:2},{x:12,y:7,z:7},{x:12,y:7,z:8,ry:2},{x:13,y:4,z:4},{x:13,y:4,z:11,ry:2},{x:13,y:5,z:5},{x:13,y:5,z:10,ry:2},{x:13,y:6,z:6},{x:13,y:6,z:9,ry:2},{x:13,y:7,z:7},{x:13,y:7,z:8,ry:2},{x:14,y:4,z:4},{x:14,y:4,z:11,ry:2},{x:14,y:5,z:10,ry:2},{x:14,y:6,z:5},{x:14,y:6,z:9,ry:2},{x:14,y:7,z:7},{x:14,y:7,z:8,ry:2},{x:15,y:4,z:4},{x:15,y:4,z:11,ry:2},{x:15,y:5,z:10,ry:2},{x:15,y:6,z:5},{x:15,y:6,z:9,ry:2},{x:15,y:7,z:7},{x:15,y:7,z:8,ry:2},{x:16,y:4,z:4},{x:16,y:4,z:11,ry:2},{x:16,y:5,z:10,ry:2},{x:16,y:6,z:5},{x:16,y:6,z:9,ry:2},{x:16,y:7,z:7},{x:16,y:7,z:8,ry:2},{x:17,y:4,z:4},{x:17,y:4,z:11,ry:2},{x:17,y:5,z:5},{x:17,y:5,z:10,ry:2},{x:17,y:6,z:6},{x:17,y:6,z:9,ry:2},{x:17,y:7,z:7},{x:17,y:7,z:8,ry:2},{x:18,y:4,z:4},{x:18,y:4,z:11,ry:2},{x:18,y:5,z:5},{x:18,y:5,z:10,ry:2},{x:18,y:6,z:6},{x:18,y:6,z:9,ry:2},{x:18,y:7,z:7},{x:18,y:7,z:8,ry:2},{x:19,y:4,z:4},{x:19,y:4,z:11,ry:2},{x:19,y:5,z:5},{x:19,y:5,z:10,ry:2},{x:19,y:6,z:6},{x:19,y:6,z:9,ry:2},{x:19,y:7,z:7},{x:19,y:7,z:8,ry:2},{x:20,y:4,z:4},{x:20,y:4,z:11,ry:2},{x:20,y:5,z:5},{x:20,y:5,z:10,ry:2},{x:20,y:6,z:6},{x:20,y:6,z:9,ry:2},{x:20,y:7,z:7},{x:20,y:7,z:8,ry:2},{x:21,y:4,z:4},{x:21,y:4,z:11,ry:2},{x:21,y:5,z:5},{x:21,y:5,z:10,ry:2},{x:21,y:6,z:6},{x:21,y:6,z:9,ry:2},{x:21,y:7,z:7},{x:21,y:7,z:8,ry:2}],"shipyard.container-green.full":[{x:2,y:3,z:7,ry:3},{x:2,y:3,z:8,ry:1},{x:2,y:3,z:15,ry:2},{x:2,y:4,z:14,ry:3},{x:2,y:5,z:17,ry:3},{x:2,y:5,z:18,ry:2},{x:3,y:3,z:9},{x:3,y:3,z:10,ry:1},{x:3,y:3,z:18,ry:2},{x:3,y:4,z:15,ry:2},{x:3,y:4,z:16,ry:2},{x:3,y:4,z:17,ry:2},{x:4,y:3,z:9,ry:1},{x:4,y:3,z:10,ry:1},{x:4,y:3,z:14,ry:2},{x:4,y:3,z:15,ry:2},{x:4,y:3,z:16,ry:2},{x:4,y:3,z:17,ry:2},{x:4,y:4,z:17,ry:2},{x:4,y:4,z:18,ry:2},{x:4,y:5,z:8,ry:1},{x:5,y:3,z:9},{x:5,y:3,z:10,ry:1},{x:5,y:3,z:16,ry:3},{x:5,y:3,z:17,ry:2},{x:8,y:3,z:2,ry:3},{x:8,y:3,z:18,ry:3},{x:8,y:4,z:18,ry:3},{x:8,y:5,z:14,ry:3},{x:8,y:5,z:15,ry:1},{x:8,y:5,z:16},{x:9,y:3,z:2,ry:1},{x:9,y:3,z:14,ry:2},{x:9,y:4,z:18,ry:2},{x:9,y:5,z:14,ry:2},{x:9,y:5,z:17,ry:1},{x:9,y:5,z:18},{x:10,y:3,z:5,ry:3},{x:10,y:3,z:10,ry:1},{x:10,y:4,z:15,ry:1},{x:10,y:5,z:18},{x:11,y:3,z:10,ry:3},{x:11,y:3,z:16},{x:11,y:3,z:17},{x:11,y:4,z:14,ry:1},{x:11,y:4,z:15,ry:2},{x:12,y:3,z:2,ry:3},{x:12,y:3,z:9,ry:1},{x:13,y:3,z:5,ry:3},{x:13,y:3,z:9},{x:14,y:3,z:0,ry:1},{x:14,y:3,z:5},{x:14,y:3,z:16},{x:14,y:3,z:18,ry:1},{x:14,y:4,z:14,ry:3},{x:15,y:3,z:16,ry:2},{x:15,y:4,z:14,ry:2},{x:15,y:4,z:16,ry:3},{x:15,y:4,z:17,ry:3},{x:16,y:3,z:1,ry:3},{x:16,y:3,z:10,ry:3},{x:16,y:3,z:13,ry:2},{x:16,y:3,z:16,ry:1},{x:16,y:4,z:1,ry:3},{x:16,y:4,z:6,ry:1},{x:16,y:4,z:17,ry:1},{x:17,y:3,z:7,ry:3},{x:17,y:3,z:16,ry:1},{x:17,y:3,z:17,ry:2},{x:17,y:3,z:18,ry:1},{x:17,y:4,z:6,ry:1},{x:17,y:4,z:7,ry:1},{x:17,y:4,z:15},{x:18,y:3,z:2},{x:19,y:3,z:5},{x:20,y:3,z:5,ry:2},{x:21,y:3,z:0,ry:1},{x:23,y:4,z:1,ry:1}],"shipyard.container-blue.full":[{x:2,y:3,z:9,ry:3},{x:2,y:3,z:10,ry:2},{x:2,y:3,z:11,ry:2},{x:2,y:3,z:14,ry:2},{x:2,y:3,z:16,ry:3},{x:2,y:3,z:17},{x:2,y:4,z:17,ry:2},{x:3,y:3,z:15,ry:2},{x:3,y:3,z:16,ry:2},{x:3,y:3,z:17,ry:2},{x:3,y:4,z:8,ry:2},{x:3,y:4,z:9,ry:2},{x:3,y:4,z:14,ry:2},{x:3,y:4,z:18,ry:2},{x:4,y:3,z:7,ry:1},{x:4,y:4,z:8,ry:2},{x:4,y:4,z:10,ry:3},{x:4,y:4,z:14},{x:4,y:4,z:16,ry:2},{x:4,y:5,z:15,ry:3},{x:4,y:5,z:17,ry:2},{x:5,y:3,z:7,ry:2},{x:5,y:3,z:11,ry:2},{x:5,y:3,z:15,ry:3},{x:8,y:3,z:15},{x:8,y:3,z:16,ry:1},{x:8,y:3,z:17,ry:1},{x:8,y:4,z:14,ry:1},{x:8,y:4,z:15,ry:1},{x:8,y:5,z:17,ry:3},{x:9,y:3,z:15},{x:9,y:3,z:17,ry:2},{x:9,y:3,z:18},{x:9,y:4,z:15,ry:3},{x:9,y:5,z:15,ry:1},{x:10,y:3,z:15,ry:3},{x:10,y:4,z:14,ry:2},{x:10,y:4,z:17,ry:3},{x:10,y:4,z:18,ry:2},{x:11,y:3,z:2,ry:3},{x:11,y:3,z:5,ry:2},{x:11,y:3,z:15,ry:1},{x:11,y:3,z:18,ry:3},{x:11,y:4,z:1},{x:11,y:4,z:18,ry:1},{x:11,y:5,z:15,ry:3},{x:11,y:5,z:16},{x:11,y:5,z:17,ry:3},{x:12,y:3,z:5},{x:12,y:4,z:9,ry:3},{x:13,y:3,z:8,ry:3},{x:13,y:3,z:10,ry:3},{x:14,y:3,z:10,ry:2},{x:14,y:3,z:17,ry:2},{x:14,y:4,z:15,ry:2},{x:15,y:3,z:14,ry:1},{x:15,y:3,z:17},{x:15,y:4,z:15,ry:2},{x:15,y:4,z:18,ry:1},{x:15,y:5,z:15,ry:1},{x:16,y:3,z:6},{x:16,y:3,z:14},{x:16,y:3,z:17},{x:16,y:4,z:7,ry:1},{x:16,y:4,z:14,ry:1},{x:16,y:4,z:15,ry:2},{x:16,y:4,z:16,ry:1},{x:17,y:3,z:5,ry:1},{x:17,y:3,z:10,ry:3},{x:17,y:3,z:14},{x:21,y:3,z:1},{x:22,y:3,z:0,ry:2},{x:23,y:3,z:0,ry:1}],"shipyard.container-orange.full":[{x:2,y:3,z:18,ry:2},{x:2,y:4,z:15,ry:2},{x:2,y:4,z:16,ry:3},{x:2,y:4,z:18,ry:3},{x:3,y:3,z:7,ry:3},{x:3,y:3,z:8,ry:3},{x:3,y:3,z:11},{x:3,y:3,z:14,ry:2},{x:3,y:4,z:10,ry:3},{x:3,y:5,z:15},{x:3,y:5,z:16,ry:3},{x:3,y:5,z:17,ry:2},{x:3,y:5,z:18,ry:3},{x:4,y:3,z:8,ry:2},{x:4,y:3,z:11},{x:4,y:3,z:18,ry:2},{x:4,y:4,z:9,ry:3},{x:4,y:4,z:15,ry:2},{x:4,y:5,z:16,ry:3},{x:4,y:5,z:18,ry:3},{x:5,y:3,z:8,ry:3},{x:5,y:3,z:14,ry:2},{x:5,y:3,z:18,ry:2},{x:8,y:3,z:14,ry:2},{x:8,y:4,z:16},{x:8,y:4,z:17,ry:2},{x:8,y:5,z:18},{x:9,y:4,z:14},{x:9,y:4,z:17,ry:2},{x:10,y:3,z:14,ry:1},{x:10,y:3,z:16,ry:3},{x:10,y:3,z:17,ry:3},{x:10,y:3,z:18,ry:2},{x:10,y:5,z:14,ry:1},{x:10,y:5,z:17,ry:1},{x:11,y:3,z:1},{x:11,y:3,z:14,ry:1},{x:11,y:4,z:16,ry:2},{x:11,y:4,z:17},{x:11,y:5,z:14},{x:11,y:5,z:18,ry:3},{x:11,y:6,z:17,ry:1},{x:12,y:3,z:1,ry:1},{x:12,y:3,z:10,ry:3},{x:13,y:3,z:2},{x:13,y:4,z:9,ry:3},{x:14,y:3,z:8,ry:2},{x:14,y:3,z:9,ry:1},{x:14,y:3,z:14},{x:14,y:3,z:15,ry:2},{x:14,y:4,z:16,ry:3},{x:14,y:4,z:17,ry:3},{x:15,y:3,z:15,ry:1},{x:15,y:3,z:18,ry:1},{x:15,y:5,z:17,ry:1},{x:16,y:3,z:2,ry:1},{x:16,y:3,z:5,ry:1},{x:16,y:3,z:7,ry:3},{x:16,y:3,z:15,ry:2},{x:16,y:3,z:18,ry:3},{x:16,y:4,z:18,ry:1},{x:17,y:3,z:2,ry:3},{x:17,y:3,z:6},{x:17,y:3,z:15,ry:3},{x:17,y:4,z:14,ry:2},{x:17,y:4,z:18},{x:18,y:3,z:10,ry:3},{x:19,y:3,z:10,ry:2},{x:20,y:3,z:10,ry:2},{x:23,y:3,z:1,ry:1},{x:24,y:3,z:0,ry:2},{x:24,y:3,z:1}],"SPECIAL.barrier.full.verysoft":[{x:4,y:6,z:8,ry:1},{x:11,y:5,z:1},{x:11,y:7,z:17,ry:1},{x:15,y:6,z:15,ry:1},{x:15,y:6,z:17,ry:1},{x:16,y:5,z:1},{x:23,y:5,z:1}],"generic.barricade.aabb":[{x:16,y:1,z:15,ry:1}],"generic.metal-ramp.wedge":[{x:20,y:3,z:15},{x:20,y:3,z:17,ry:2},{x:21,y:3,z:15},{x:22,y:3,z:15},{x:22,y:3,z:17,ry:2}]},palette:["shipyard.crate-wood.full","nature.dirtwalk-center.full","generic.stairs.wedge","scifi.computer.obb","generic.metal-ladder.ladder","shipyard.container-green.full","shipyard.container-blue.full","shipyard.container-orange.full","SPECIAL.barrier.full.verysoft",null],width:25,height:8,depth:21,name:"",surfaceArea:627},{fileVersion:1,data:{"nature.ground_02.full":[{x:0,y:0,z:14,rx:2,ry:3},{x:0,y:0,z:15,rx:2},{x:1,y:0,z:3,rx:2,ry:1},{x:1,y:0,z:4,rx:2,ry:2},{x:1,y:0,z:11,rx:2,ry:2},{x:1,y:0,z:13,ry:3,rz:3},{x:1,y:0,z:15,rx:2,ry:1},{x:2,y:0,z:12,rz:1},{x:12,y:0,z:15,ry:2,rz:3},{x:14,y:0,z:15,ry:2,rz:3},{x:17,y:0,z:2,rx:2,ry:2},{x:17,y:0,z:15,ry:1,rz:1},{x:18,y:0,z:2,rx:2,ry:3},{x:18,y:0,z:6,ry:3,rz:3},{x:18,y:0,z:8,ry:2,rz:1},{x:18,y:0,z:12,ry:3,rz:3},{x:18,y:0,z:15,rx:1,ry:3},{x:19,y:0,z:4,ry:3,rz:3},{x:19,y:0,z:5,rx:1,ry:3},{x:19,y:0,z:8,rz:3},{x:19,y:0,z:11,rz:1},{x:19,y:0,z:13,ry:1,rz:3},{x:20,y:0,z:0,rx:2,ry:3},{x:20,y:0,z:3,ry:2}],"town.shop4.full":[{x:0,y:1,z:1,ry:1},{x:0,y:1,z:2,ry:3},{x:0,y:1,z:3},{x:0,y:1,z:4},{x:0,y:1,z:5,ry:3},{x:0,y:1,z:6,ry:3},{x:0,y:1,z:7,ry:3},{x:0,y:1,z:8,ry:3},{x:0,y:1,z:9},{x:0,y:1,z:10,ry:3},{x:0,y:1,z:11,ry:3},{x:0,y:1,z:12,ry:3},{x:0,y:1,z:13,ry:2},{x:0,y:2,z:11,ry:3},{x:0,y:2,z:12,ry:3},{x:0,y:2,z:13,ry:2},{x:0,y:3,z:0,ry:1},{x:0,y:3,z:1},{x:0,y:3,z:4,ry:3},{x:0,y:3,z:5,ry:3},{x:0,y:3,z:6,ry:3},{x:0,y:3,z:7,ry:1},{x:1,y:1,z:1,ry:3},{x:1,y:1,z:2,ry:2},{x:1,y:1,z:10,ry:1},{x:1,y:2,z:1,ry:3},{x:1,y:2,z:2,ry:3},{x:1,y:2,z:3,ry:1},{x:1,y:2,z:4,ry:1},{x:1,y:2,z:6,ry:1},{x:1,y:2,z:7,ry:1},{x:1,y:2,z:11,ry:2},{x:1,y:3,z:0,ry:1},{x:1,y:3,z:5,ry:2},{x:1,y:3,z:12,ry:2},{x:2,y:1,z:1,ry:3},{x:2,y:1,z:2},{x:2,y:1,z:14,ry:1},{x:2,y:1,z:15,ry:1},{x:2,y:2,z:0,ry:2},{x:2,y:2,z:2},{x:2,y:3,z:0},{x:2,y:3,z:13,ry:2},{x:3,y:1,z:0,ry:2},{x:3,y:1,z:1,ry:3},{x:3,y:1,z:13,ry:1},{x:3,y:1,z:14},{x:3,y:1,z:15,ry:1},{x:3,y:2,z:2,ry:1},{x:3,y:3,z:2,ry:1},{x:3,y:3,z:13,ry:3},{x:4,y:1,z:0,ry:2},{x:4,y:1,z:1,ry:3},{x:4,y:1,z:14,ry:1},{x:4,y:1,z:15,ry:1},{x:4,y:2,z:13},{x:4,y:2,z:14,ry:1},{x:4,y:3,z:13,ry:3},{x:4,y:4,z:7,ry:3},{x:5,y:1,z:0,ry:2},{x:5,y:1,z:2,ry:1},{x:5,y:1,z:13,ry:1},{x:5,y:1,z:14,ry:1},{x:5,y:1,z:15,ry:1},{x:5,y:2,z:1},{x:5,y:2,z:2,ry:1},{x:6,y:1,z:0,ry:2},{x:6,y:2,z:0,ry:2},{x:6,y:2,z:1},{x:7,y:1,z:7,ry:1},{x:7,y:2,z:1,ry:2},{x:7,y:2,z:2},{x:7,y:3,z:2},{x:7,y:4,z:2},{x:8,y:1,z:0,ry:1},{x:8,y:2,z:1},{x:8,y:2,z:2},{x:8,y:3,z:2,ry:1},{x:8,y:4,z:2,ry:1},{x:9,y:1,z:0},{x:9,y:1,z:2,ry:1},{x:9,y:2,z:1,ry:2},{x:9,y:2,z:2},{x:10,y:1,z:0},{x:10,y:1,z:2},{x:10,y:2,z:0},{x:10,y:2,z:1},{x:10,y:2,z:2},{x:10,y:4,z:0,ry:1},{x:10,y:4,z:8,ry:1},{x:11,y:2,z:0},{x:11,y:2,z:1},{x:11,y:2,z:2},{x:11,y:4,z:8},{x:12,y:1,z:1,ry:2},{x:12,y:2,z:0},{x:12,y:2,z:1},{x:12,y:2,z:2},{x:12,y:4,z:7,ry:2},{x:12,y:4,z:8,ry:2},{x:13,y:2,z:0,ry:2},{x:13,y:2,z:1,ry:3},{x:13,y:2,z:2},{x:14,y:1,z:1,ry:3},{x:14,y:1,z:2},{x:14,y:2,z:1,ry:2},{x:18,y:1,z:3,ry:3},{x:18,y:1,z:4,ry:1},{x:18,y:2,z:4},{x:18,y:2,z:5,ry:3},{x:18,y:2,z:6,ry:3},{x:18,y:3,z:7,ry:3},{x:18,y:3,z:8},{x:18,y:3,z:9},{x:18,y:4,z:6,ry:3},{x:18,y:4,z:7,ry:3},{x:19,y:1,z:7},{x:19,y:1,z:15,ry:2},{x:19,y:2,z:4},{x:19,y:2,z:5,ry:3},{x:19,y:2,z:7,ry:1},{x:19,y:2,z:10,ry:3},{x:19,y:2,z:14},{x:19,y:3,z:5},{x:19,y:3,z:8,ry:2},{x:19,y:3,z:9},{x:19,y:3,z:10},{x:19,y:4,z:5,ry:1},{x:20,y:1,z:4,ry:3},{x:20,y:1,z:5,ry:3},{x:20,y:1,z:6,ry:1},{x:20,y:1,z:7,ry:3},{x:20,y:1,z:15,ry:2},{x:20,y:2,z:4,ry:2},{x:20,y:2,z:11,ry:2},{x:20,y:2,z:12,ry:2},{x:20,y:2,z:13,ry:2},{x:20,y:3,z:8,ry:1},{x:20,y:3,z:9,ry:1},{x:20,y:3,z:10,ry:1},{x:20,y:3,z:11,ry:3}],"town.fire-escape.ladder.soft":[{x:0,y:1,z:14,ry:2},{x:0,y:2,z:3,ry:1},{x:0,y:2,z:9},{x:0,y:2,z:14,ry:2},{x:1,y:1,z:15,ry:1},{x:2,y:3,z:2,ry:1},{x:3,y:3,z:0,ry:3},{x:4,y:1,z:2,ry:1},{x:4,y:2,z:2,ry:1},{x:4,y:4,z:9,ry:2},{x:5,y:2,z:6},{x:5,y:3,z:13,ry:3},{x:6,y:3,z:4,ry:1},{x:7,y:1,z:0,ry:1},{x:7,y:1,z:6},{x:7,y:2,z:6},{x:7,y:4,z:1},{x:8,y:2,z:0},{x:8,y:3,z:0},{x:9,y:1,z:14,ry:2},{x:9,y:4,z:8,ry:1},{x:12,y:2,z:11,ry:2},{x:12,y:4,z:9,ry:2},{x:13,y:1,z:5,ry:1},{x:13,y:1,z:12,ry:1},{x:14,y:3,z:8},{x:15,y:1,z:7,ry:2},{x:15,y:1,z:10},{x:17,y:1,z:15,ry:3},{x:17,y:3,z:0,ry:3},{x:18,y:2,z:11,ry:1},{x:19,y:1,z:3,ry:3},{x:19,y:2,z:3,ry:1},{x:19,y:4,z:0},{x:19,y:4,z:6,ry:3},{x:20,y:1,z:0,ry:3},{x:20,y:2,z:0,ry:3},{x:20,y:3,z:7},{x:20,y:4,z:4,ry:3}],"town.shop3.full":[{x:0,y:2,z:1,ry:1},{x:0,y:2,z:10,ry:2},{x:1,y:1,z:6,ry:2},{x:1,y:1,z:7,ry:1},{x:1,y:1,z:8},{x:1,y:1,z:9,ry:2},{x:4,y:1,z:12,ry:3},{x:4,y:1,z:13,ry:3},{x:4,y:4,z:8,ry:2},{x:6,y:1,z:5,ry:2},{x:6,y:1,z:7,ry:1},{x:10,y:3,z:0,ry:2},{x:11,y:4,z:7,ry:3},{x:13,y:4,z:9,ry:2},{x:15,y:1,z:2,ry:1},{x:18,y:4,z:8,ry:1},{x:19,y:1,z:10},{x:19,y:3,z:14},{x:20,y:1,z:14,ry:3}],"town.awning2.aabb":[{x:0,y:2,z:2,ry:1},{x:2,y:1,z:6,ry:2},{x:4,y:1,z:11,ry:3},{x:5,y:4,z:8,ry:2},{x:6,y:4,z:2},{x:7,y:1,z:5,ry:2},{x:7,y:3,z:14},{x:11,y:2,z:5,ry:3},{x:14,y:3,z:15,ry:1},{x:14,y:4,z:9,ry:2},{x:15,y:1,z:3,ry:1},{x:15,y:4,z:0,ry:3},{x:18,y:1,z:10}],"town.newspaperbin.aabb":[{x:0,y:2,z:6,ry:1},{x:1,y:3,z:1,ry:3},{x:2,y:1,z:7,ry:3},{x:6,y:1,z:2,ry:3},{x:6,y:1,z:11,ry:2},{x:10,y:2,z:6,ry:1},{x:11,y:1,z:4},{x:11,y:3,z:2,ry:3},{x:12,y:1,z:9,ry:2},{x:15,y:3,z:8,ry:1},{x:16,y:4,z:1,ry:3},{x:18,y:1,z:9,ry:3},{x:19,y:4,z:10}],"town.chimney.aabb":[{x:0,y:4,z:7,ry:1},{x:1,y:4,z:0,ry:3},{x:1,y:4,z:12,ry:1},{x:3,y:4,z:2,ry:1},{x:4,y:5,z:8,ry:1},{x:8,y:4,z:14,ry:1},{x:8,y:5,z:2},{x:10,y:5,z:0},{x:12,y:5,z:7,ry:3},{x:14,y:4,z:14,ry:1},{x:15,y:5,z:1,ry:3},{x:18,y:5,z:8,ry:2},{x:19,y:4,z:14}],"nature.ground_01.full":[{x:1,y:0,z:12,ry:1,rz:1},{x:1,y:0,z:14,ry:2,rz:1},{x:2,y:0,z:13,rx:1,rz:2},{x:13,y:0,z:15,ry:2,rz:3},{x:15,y:0,z:15,ry:2,rz:3},{x:18,y:0,z:5,ry:1,rz:1},{x:18,y:0,z:7,ry:3,rz:3},{x:18,y:0,z:11,ry:1,rz:1},{x:18,y:0,z:13,ry:3,rz:3},{x:18,y:0,z:14,ry:3,rz:3},{x:19,y:0,z:1,ry:1,rz:1},{x:19,y:0,z:2,ry:3,rz:3},{x:19,y:0,z:3,ry:3,rz:3},{x:19,y:0,z:6,ry:1},{x:19,y:0,z:12,ry:1,rz:3},{x:19,y:0,z:14,rx:1,rz:2},{x:20,y:0,z:1,ry:2,rz:3},{x:20,y:0,z:2,rx:3,ry:2,rz:2}],"town.dumpster.obb":[{x:1,y:1,z:4,ry:3},{x:1,y:1,z:11,ry:3},{x:6,y:1,z:4},{x:6,y:1,z:15},{x:8,y:1,z:2,ry:1},{x:9,y:1,z:8,ry:2},{x:12,y:1,z:2,ry:2},{x:13,y:1,z:10},{x:13,y:1,z:15},{x:14,y:1,z:15},{x:17,y:1,z:4,ry:1},{x:18,y:1,z:15,ry:1}],"town.stairs2.wedge":[{x:1,y:1,z:5,ry:3},{x:1,y:2,z:8,ry:2},{x:1,y:3,z:4},{x:1,y:3,z:6,ry:2},{x:1,y:3,z:13,ry:1},{x:2,y:2,z:1,ry:3},{x:3,y:1,z:12},{x:3,y:2,z:14,ry:1},{x:4,y:4,z:6},{x:5,y:2,z:0,ry:1},{x:10,y:4,z:7},{x:14,y:2,z:2,ry:3},{x:17,y:1,z:3,ry:1},{x:19,y:2,z:6,ry:3},{x:19,y:4,z:8,ry:3},{x:20,y:1,z:8,ry:2},{x:20,y:2,z:5,ry:2},{x:20,y:2,z:14,ry:2},{x:20,y:3,z:12,ry:2}],"town.awning1.aabb":[{x:1,y:2,z:10,ry:2},{x:6,y:2,z:9,ry:1},{x:7,y:1,z:11,ry:3},{x:10,y:1,z:4,ry:3},{x:11,y:3,z:0,ry:2},{x:11,y:4,z:6,ry:3},{x:13,y:3,z:7,ry:2},{x:18,y:3,z:14},{x:18,y:4,z:9,ry:1}],"town.shop4-crnr.obb":[{x:1,y:2,z:12,ry:2},{x:1,y:3,z:11,ry:3},{x:2,y:1,z:13},{x:3,y:1,z:2,rx:2,rz:2},{x:5,y:1,z:12,ry:3},{x:6,y:1,z:1,rx:2,rz:2},{x:9,y:2,z:0,rx:2,ry:2,rz:2},{x:13,y:4,z:8,ry:3},{x:14,y:2,z:0,ry:3},{x:15,y:1,z:1,ry:3},{x:18,y:2,z:7,ry:1},{x:18,y:3,z:10,ry:1},{x:18,y:4,z:5},{x:19,y:1,z:6},{x:19,y:1,z:14},{x:20,y:2,z:10,ry:3}],"town.street.full":[{x:2,y:0,z:3,ry:1,rz:2},{x:2,y:0,z:4,ry:1,rz:2},{x:2,y:0,z:5,ry:1,rz:2},{x:2,y:0,z:6,ry:1,rz:2},{x:2,y:0,z:7,ry:1,rz:2},{x:2,y:0,z:8,ry:1,rz:2},{x:2,y:0,z:9,ry:1,rz:2},{x:2,y:0,z:10,ry:1,rz:2},{x:2,y:0,z:11,ry:1,rz:2},{x:3,y:0,z:2,ry:1,rz:2},{x:3,y:0,z:3,ry:1,rz:2},{x:3,y:0,z:4,rz:1},{x:3,y:0,z:5,ry:1},{x:3,y:0,z:6,rx:3,ry:1},{x:3,y:0,z:7,ry:1},{x:3,y:0,z:8,ry:1},{x:3,y:0,z:9,ry:1},{x:3,y:0,z:10,ry:1,rz:1},{x:3,y:0,z:11,ry:1,rz:2},{x:4,y:0,z:2,ry:1,rz:2},{x:4,y:0,z:3,ry:1,rz:2},{x:4,y:0,z:4,ry:3,rz:1},{x:4,y:0,z:5,ry:3},{x:4,y:0,z:6,ry:3},{x:4,y:0,z:7,ry:3},{x:4,y:0,z:8,ry:3},{x:4,y:0,z:9,rz:3},{x:4,y:0,z:10,ry:2},{x:4,y:0,z:11,ry:1,rz:2},{x:5,y:0,z:3,ry:1,rz:2},{x:5,y:0,z:4,ry:1,rz:2},{x:5,y:0,z:5,ry:1,rz:2},{x:5,y:0,z:6,ry:1,rz:2},{x:5,y:0,z:7,ry:1,rz:2},{x:5,y:0,z:8,ry:1,rz:2},{x:5,y:0,z:9},{x:5,y:0,z:10,ry:2},{x:5,y:0,z:11,ry:1,rz:2},{x:5,y:0,z:12,ry:1,rz:2},{x:6,y:0,z:1,ry:1,rz:2},{x:6,y:0,z:2,ry:1,rz:2},{x:6,y:0,z:3,ry:1,rz:2},{x:6,y:0,z:4,ry:1,rz:2},{x:6,y:0,z:6,ry:1,rz:2},{x:6,y:0,z:8,ry:1,rz:2},{x:6,y:0,z:9,rx:3},{x:6,y:0,z:10,ry:2},{x:6,y:0,z:11,ry:1,rz:2},{x:6,y:0,z:12,ry:1,rz:2},{x:6,y:0,z:13,ry:1,rz:2},{x:6,y:0,z:14,ry:1,rz:2},{x:6,y:0,z:15,ry:1,rz:2},{x:7,y:0,z:0,ry:1,rz:2},{x:7,y:0,z:1,ry:1,rz:2},{x:7,y:0,z:2,ry:1,rz:2},{x:7,y:0,z:3,ry:1,rz:2},{x:7,y:0,z:4,ry:1,rz:2},{x:7,y:0,z:5,ry:2,rz:2},{x:7,y:0,z:6,ry:1,rz:2},{x:7,y:0,z:8,ry:1,rz:2},{x:7,y:0,z:9},{x:7,y:0,z:10,ry:2},{x:7,y:0,z:11,ry:1,rz:2},{x:7,y:0,z:13,ry:1,rz:2},{x:7,y:0,z:14,ry:1,rz:2},{x:8,y:0,z:1,ry:1,rz:2},{x:8,y:0,z:2,ry:1,rz:2},{x:8,y:0,z:3,ry:1,rz:2},{x:8,y:0,z:4,ry:2,rz:2},{x:8,y:0,z:5,ry:1,rz:2},{x:8,y:0,z:6,ry:1,rz:2},{x:8,y:0,z:7,ry:2,rz:2},{x:8,y:0,z:8,ry:1,rz:2},{x:8,y:0,z:9},{x:8,y:0,z:10,ry:2},{x:8,y:0,z:11,ry:1,rz:2},{x:8,y:0,z:14,ry:1,rz:2},{x:9,y:0,z:1,ry:1,rz:2},{x:9,y:0,z:3,ry:1,rz:2},{x:9,y:0,z:4,ry:1,rz:2},{x:9,y:0,z:8,ry:1,rz:2},{x:9,y:0,z:9},{x:9,y:0,z:10,rx:3,ry:2},{x:9,y:0,z:11,ry:1,rz:2},{x:9,y:0,z:14,ry:1,rz:2},{x:10,y:0,z:1,ry:1,rz:2},{x:10,y:0,z:3,ry:1,rz:2},{x:10,y:0,z:4,ry:1,rz:2},{x:10,y:0,z:8,ry:1,rz:2},{x:10,y:0,z:9},{x:10,y:0,z:10,ry:2,rz:3},{x:10,y:0,z:11,ry:1},{x:10,y:0,z:12,rx:3,ry:1},{x:10,y:0,z:13,ry:1},{x:10,y:0,z:14,ry:1,rz:1},{x:11,y:0,z:0,ry:1,rz:2},{x:11,y:0,z:1,ry:1,rz:2},{x:11,y:0,z:2,ry:1,rz:2},{x:11,y:0,z:3,ry:1,rz:2},{x:11,y:0,z:4,ry:2,rz:2},{x:11,y:0,z:8,ry:1,rz:2},{x:11,y:0,z:9,ry:3,rz:1},{x:11,y:0,z:10,ry:3},{x:11,y:0,z:11,ry:3},{x:11,y:0,z:12,ry:3},{x:11,y:0,z:13,rz:3},{x:11,y:0,z:14,rx:3,ry:2},{x:12,y:0,z:0,ry:1,rz:2},{x:12,y:0,z:2,ry:1,rz:2},{x:12,y:0,z:3,ry:1,rz:2},{x:12,y:0,z:4,ry:1,rz:2},{x:12,y:0,z:5,ry:1,rz:2},{x:12,y:0,z:7,ry:2,rz:2},{x:12,y:0,z:8,ry:1,rz:2},{x:12,y:0,z:9,ry:1,rz:2},{x:12,y:0,z:10,ry:1,rz:2},{x:12,y:0,z:11,ry:1,rz:2},{x:12,y:0,z:12,ry:1,rz:2},{x:12,y:0,z:13},{x:12,y:0,z:14,ry:2},{x:13,y:0,z:0,ry:1,rz:2},{x:13,y:0,z:1,ry:1,rz:2},{x:13,y:0,z:2,ry:1,rz:2},{x:13,y:0,z:3,ry:1,rz:2},{x:13,y:0,z:4,ry:1,rz:2},{x:13,y:0,z:5,ry:1,rz:2},{x:13,y:0,z:6,ry:1,rz:2},{x:13,y:0,z:7,ry:1,rz:2},{x:13,y:0,z:8,ry:1,rz:2},{x:13,y:0,z:9,ry:1,rz:2},{x:13,y:0,z:10,ry:1,rz:2},{x:13,y:0,z:11,ry:1,rz:2},{x:13,y:0,z:12,ry:3,rz:2},{x:13,y:0,z:13},{x:13,y:0,z:14,ry:2},{x:14,y:0,z:0,ry:1,rz:2},{x:14,y:0,z:3,ry:1,rz:2},{x:14,y:0,z:4,ry:1,rz:2},{x:14,y:0,z:5,ry:1,rz:2},{x:14,y:0,z:8,ry:1,rz:2},{x:14,y:0,z:9,ry:1,rz:2},{x:14,y:0,z:10,ry:1,rz:2},{x:14,y:0,z:12,ry:1,rz:2},{x:14,y:0,z:13,rx:3},{x:14,y:0,z:14,ry:2},{x:15,y:0,z:0,ry:1,rz:2},{x:15,y:0,z:1,ry:1,rz:2},{x:15,y:0,z:3,ry:1,rz:2},{x:15,y:0,z:4,ry:1,rz:2},{x:15,y:0,z:5,ry:2,rz:2},{x:15,y:0,z:6,ry:2,rz:2},{x:15,y:0,z:7,ry:1,rz:2},{x:15,y:0,z:8,ry:1,rz:2},{x:15,y:0,z:9,ry:1,rz:2},{x:15,y:0,z:10,ry:1,rz:2},{x:15,y:0,z:11,ry:1,rz:2},{x:15,y:0,z:12,ry:1,rz:2},{x:15,y:0,z:13},{x:15,y:0,z:14,ry:2},{x:16,y:0,z:0,ry:1,rz:2},{x:16,y:0,z:1,ry:1,rz:2},{x:16,y:0,z:2,ry:1,rz:2},{x:16,y:0,z:3,ry:1,rz:2},{x:16,y:0,z:4,rz:1},{x:16,y:0,z:5,ry:1},{x:16,y:0,z:6,ry:1},{x:16,y:0,z:7,rx:3,ry:1},{x:16,y:0,z:8,ry:1},{x:16,y:0,z:9,ry:1},{x:16,y:0,z:10,rx:3,ry:1},{x:16,y:0,z:11,ry:1},{x:16,y:0,z:12,ry:1},{x:16,y:0,z:13,ry:1,rz:3},{x:16,y:0,z:14,rx:3,ry:2},{x:17,y:0,z:4,ry:3,rz:1},{x:17,y:0,z:5,ry:3},{x:17,y:0,z:6,ry:3},{x:17,y:0,z:7,ry:3},{x:17,y:0,z:8,rx:3,ry:3},{x:17,y:0,z:9,ry:3},{x:17,y:0,z:10,ry:3},{x:17,y:0,z:11,rx:3,ry:3},{x:17,y:0,z:12,ry:3},{x:17,y:0,z:13,ry:3},{x:17,y:0,z:14,ry:2,rz:1},{x:18,y:0,z:9,ry:2,rz:2},{x:18,y:0,z:10,ry:1,rz:2},{x:19,y:0,z:9,ry:2,rz:2},{x:20,y:0,z:9,ry:2,rz:2},{x:20,y:0,z:10,ry:2,rz:2},{x:20,y:0,z:11,ry:2,rz:2},{x:20,y:0,z:12,ry:2,rz:2},{x:20,y:0,z:13,ry:2,rz:2}],"town.shrub_01.aabb":[{x:2,y:1,z:3,ry:1},{x:3,y:2,z:13,ry:1},{x:5,y:1,z:8},{x:5,y:2,z:15,ry:1},{x:5,y:3,z:1,ry:3},{x:8,y:2,z:13},{x:9,y:2,z:6,ry:3},{x:9,y:3,z:0,ry:1},{x:11,y:2,z:8},{x:11,y:4,z:5},{x:12,y:2,z:5},{x:12,y:3,z:15,ry:2},{x:13,y:3,z:6,ry:2},{x:14,y:4,z:1,ry:1},{x:15,y:2,z:1},{x:18,y:1,z:5,ry:2},{x:18,y:3,z:5,ry:2},{x:19,y:1,z:8,ry:2},{x:19,y:1,z:11,ry:2},{x:19,y:3,z:7,ry:2},{x:19,y:4,z:9,ry:3},{x:20,y:1,z:3,ry:1},{x:20,y:2,z:15,ry:1}],"town.firehyrdrant.aabb":[{x:2,y:1,z:11,ry:3},{x:5,y:1,z:4},{x:12,y:1,z:12,ry:1},{x:15,y:1,z:4,ry:3}],"town.fire-escape-bridge-con.aabb.soft":[{x:2,y:2,z:7,ry:3},{x:4,y:3,z:9,ry:2},{x:4,y:3,z:12},{x:5,y:2,z:7,ry:1},{x:5,y:2,z:14,ry:3},{x:6,y:2,z:2,ry:2},{x:6,y:2,z:4},{x:7,y:3,z:8,ry:3},{x:8,y:3,z:1},{x:10,y:3,z:3,ry:2},{x:13,y:3,z:10,ry:2},{x:13,y:3,z:13},{x:14,y:3,z:9,ry:3},{x:15,y:2,z:14,ry:3},{x:17,y:3,z:9,ry:1},{x:18,y:2,z:14,ry:1},{x:19,y:2,z:11,ry:2},{x:19,y:2,z:13},{x:19,y:4,z:2,ry:2},{x:19,y:4,z:4}],"town.fire-escape.aabb.soft":[{x:3,y:2,z:0,ry:3},{x:5,y:2,z:13,ry:3},{x:6,y:3,z:2,ry:1},{x:7,y:3,z:1},{x:12,y:2,z:9,ry:1},{x:12,y:2,z:10,ry:1},{x:12,y:3,z:9,ry:1},{x:14,y:1,z:5},{x:14,y:1,z:12,ry:2},{x:15,y:1,z:6,ry:3},{x:15,y:1,z:11,ry:3},{x:19,y:3,z:6,ry:2},{x:20,y:2,z:3},{x:20,y:3,z:5,ry:3}],"town.fire-escape-bridge.aabb.soft":[{x:3,y:2,z:7,ry:3},{x:4,y:2,z:7,ry:3},{x:4,y:3,z:10,ry:2},{x:4,y:3,z:11,ry:2},{x:6,y:2,z:3},{x:6,y:2,z:14,ry:3},{x:8,y:3,z:8,ry:3},{x:9,y:3,z:8,ry:3},{x:10,y:3,z:4},{x:13,y:3,z:11,ry:2},{x:13,y:3,z:12,ry:2},{x:15,y:3,z:9,ry:3},{x:16,y:2,z:14,ry:3},{x:16,y:3,z:9,ry:3},{x:17,y:2,z:14,ry:3},{x:19,y:2,z:12},{x:19,y:4,z:3}],"town.shop2.full":[{x:4,y:3,z:5,ry:3},{x:4,y:3,z:6},{x:4,y:3,z:8},{x:5,y:2,z:5,ry:2},{x:5,y:3,z:5,ry:2},{x:5,y:3,z:8},{x:6,y:2,z:5,ry:2},{x:6,y:2,z:6,ry:1},{x:6,y:2,z:7},{x:6,y:2,z:8},{x:6,y:3,z:5,ry:1},{x:6,y:3,z:8,ry:1},{x:7,y:2,z:7,ry:1},{x:7,y:2,z:14,ry:2},{x:7,y:3,z:4,ry:2},{x:8,y:1,z:12,ry:3},{x:8,y:1,z:15,ry:2},{x:8,y:2,z:14,ry:2},{x:9,y:1,z:6},{x:9,y:1,z:13,ry:2},{x:9,y:1,z:15,ry:2},{x:9,y:2,z:15,ry:2},{x:10,y:1,z:7,ry:2},{x:10,y:1,z:15,ry:2},{x:10,y:2,z:15,ry:2},{x:10,y:3,z:5,ry:3},{x:10,y:3,z:6,ry:3},{x:11,y:1,z:8,ry:1},{x:11,y:1,z:15,ry:2},{x:11,y:2,z:15,ry:2},{x:11,y:3,z:6,ry:2},{x:11,y:3,z:7,ry:1},{x:12,y:1,z:6,ry:1},{x:12,y:1,z:8,ry:2},{x:12,y:2,z:6,ry:3},{x:12,y:2,z:14,ry:2},{x:12,y:2,z:15,ry:2},{x:13,y:2,z:6,ry:3},{x:13,y:2,z:7,ry:3},{x:13,y:2,z:9},{x:13,y:2,z:10,ry:3},{x:13,y:2,z:14,ry:2},{x:13,y:2,z:15,ry:2},{x:13,y:3,z:9,ry:1},{x:13,y:3,z:14},{x:14,y:1,z:6,ry:3},{x:14,y:1,z:7,ry:1},{x:14,y:1,z:11,ry:1},{x:14,y:2,z:8,ry:1},{x:14,y:2,z:9,ry:2},{x:14,y:2,z:10,ry:2},{x:14,y:2,z:14,ry:2},{x:14,y:2,z:15,ry:2},{x:14,y:3,z:0,ry:1},{x:14,y:3,z:1},{x:15,y:2,z:8,ry:1},{x:15,y:3,z:0,ry:1},{x:15,y:3,z:1},{x:16,y:1,z:15,ry:3},{x:16,y:3,z:0},{x:16,y:3,z:1},{x:17,y:1,z:0},{x:17,y:3,z:1},{x:18,y:1,z:0},{x:18,y:1,z:1,ry:1},{x:19,y:1,z:0},{x:19,y:2,z:0},{x:19,y:4,z:1}],"town.fire-escape-corner.aabb.soft":[{x:6,y:3,z:1,ry:1},{x:12,y:3,z:10,ry:2},{x:14,y:3,z:10,ry:3},{x:15,y:1,z:5},{x:15,y:1,z:12,ry:3},{x:18,y:2,z:13,ry:1},{x:20,y:3,z:4},{x:20,y:3,z:6,ry:3}],"town.stairs.wedge":[{x:6,y:3,z:6,ry:2},{x:7,y:2,z:13},{x:8,y:2,z:7,ry:3},{x:8,y:2,z:15,ry:1},{x:9,y:1,z:5,ry:1},{x:9,y:1,z:12},{x:10,y:1,z:8,ry:2},{x:10,y:3,z:2},{x:12,y:3,z:6,ry:3},{x:12,y:3,z:14,ry:1},{x:13,y:2,z:8,ry:1},{x:13,y:3,z:0,ry:1},{x:14,y:2,z:6},{x:14,y:2,z:11,ry:3},{x:15,y:2,z:15,ry:3},{x:17,y:1,z:1,ry:2},{x:18,y:2,z:0,ry:1},{x:18,y:4,z:1,ry:1}],"town.shop1.full":[{x:7,y:1,z:12,ry:3},{x:7,y:1,z:15,ry:3},{x:8,y:1,z:13},{x:8,y:3,z:14},{x:9,y:1,z:7},{x:10,y:1,z:5,ry:3},{x:10,y:1,z:6,ry:3},{x:11,y:1,z:5},{x:11,y:1,z:6,ry:1},{x:11,y:1,z:7,ry:2},{x:11,y:2,z:6,ry:3},{x:12,y:2,z:7},{x:12,y:3,z:7,ry:2},{x:14,y:2,z:7},{x:14,y:3,z:14,ry:1},{x:15,y:4,z:1,ry:3},{x:18,y:3,z:1,ry:2}],"town.shop2-crnr.obb":[{x:7,y:2,z:8,ry:2},{x:7,y:3,z:5,ry:2},{x:10,y:3,z:7,ry:1},{x:11,y:2,z:14},{x:11,y:3,z:5,ry:3},{x:12,y:1,z:5,ry:3},{x:12,y:1,z:15,ry:3},{x:13,y:1,z:11,ry:1},{x:13,y:2,z:11,ry:1},{x:13,y:3,z:1,ry:1},{x:14,y:1,z:8,ry:2},{x:14,y:1,z:10,ry:3},{x:15,y:1,z:15},{x:15,y:2,z:9,ry:2},{x:18,y:2,z:1,ry:1},{x:19,y:1,z:1,ry:2},{x:19,y:2,z:1,ry:2}]},palette:[null,"town.shrub_01.aabb","town.shop2-crnr.obb","town.shop4.full","town.shop1.full","town.shop4-crnr.obb","town.newspaperbin.aabb","town.dumpster.obb","nature.ground_01.full","SPECIAL.barrier.full.verysoft"],width:21,height:6,depth:16,name:"",surfaceArea:448}];MunitionsManager.prototype.update=function(delta){for(var that=this,c=0;c<4;c++)this.bulletPool.forEachActive(function(bullet){bullet.update(.25*delta),that.projectileCollidesWithPlayer(bullet)&&bullet.remove()}),this.rocketPool.forEachActive(function(rocket){rocket.update(.25*delta),that.projectileCollidesWithPlayer(rocket)&&rocket.remove()});this.grenadePool.forEachActive(function(grenade){grenade.update(delta)})},MunitionsManager.prototype.fireBullet=function(player,pos,dir,dmg,ttl,velocity){this.bulletPool.retrieve().fire(player,pos,dir,dmg,ttl,velocity)},MunitionsManager.prototype.fireRocket=function(player,pos,dir,dmg,ttl,velocity){this.rocketPool.retrieve().fire(player,pos,dir,dmg,ttl,velocity)},MunitionsManager.prototype.throwGrenade=function(player,pos,vec){this.grenadePool.retrieve().throw(player,pos,vec)},MunitionsManager.prototype.projectileCollidesWithPlayer=function(proj){for(var i=0;i<playerLimit;i++){var player=players[i];if(player&&player.playing&&player.id!=proj.player.id&&(0==player.team||player.team!=proj.player.team)&&Math.abs(proj.x-player.x)<.3&&Math.abs(proj.y-(player.y+.3))<.3&&Math.abs(proj.z-player.z)<.3){proj.player;tv1.x=proj.dx,tv1.y=proj.dy,tv1.z=proj.dz,tv2.x=player.x-proj.x,tv2.y=player.y+.32-proj.y,tv2.z=player.z-proj.z;var dist=BABYLON.Vector3.Cross(tv1,tv2);proj.damage,dist.length();return hitPlayer(tv1.x,tv1.z),!0}}return!1};var tv3=new BABYLON.Vector3,tv4=new BABYLON.Vector3;MunitionsManager.prototype.projectileCollidesWithMap=function(proj,collideCallback){tv3.x=proj.x,tv3.y=proj.y,tv3.z=proj.z,tv4.x=proj.dx,tv4.y=proj.dy,tv4.z=proj.dz;var res=collider.projectileCollidesWithMap(tv3,tv4);if(res&&!mapMeshes[res.cell.idx].softness){if(proj.actor){var cell=map.data[res.x][res.y][res.z];if(cell&&cell.idx){var mapMesh=mapMeshes[cell.idx],ray=new BABYLON.Ray(new BABYLON.Vector3(proj.x-proj.dx-res.x-.5,proj.y-proj.dy-res.y-.5,proj.z-proj.dz-res.z-.5),new BABYLON.Vector3(2*proj.dx,2*proj.dy,2*proj.dz),1);mapMesh.rotation.x=cell.rx*Math.PI90,mapMesh.rotation.y=cell.ry*Math.PI90,mapMesh.rotation.z=cell.rz*Math.PI90;var pickInfo=ray.intersectsMesh(mapMesh,!1);if(pickInfo.hit){var ofs=new BABYLON.Vector3(-proj.dx,-proj.dy,-proj.dz).normalize().scale(.005);collideCallback&&collideCallback(pickInfo.pickedPoint.x+res.x+.5+ofs.x,pickInfo.pickedPoint.y+res.y+.5+ofs.y,pickInfo.pickedPoint.z+res.z+.5+ofs.z)}}}return!0}return!1};var CONTROL={up:1,down:2,left:4,right:8,jump:16,fire:32},classes=[{name:"Soldier",weapon:Eggk47},{name:"Scrambler",weapon:DozenGauge},{name:"Free Ranger",weapon:CSG1}],stateBufferSize=256;if(Player.prototype.changeWeaponLoadout=function(primaryWeaponItem,secondaryWeaponItem){this.actor&&this.weapons&&(this.weapons[0].actor.dispose(),this.weapons[1].actor.dispose()),this.primaryWeaponItem=primaryWeaponItem,this.secondaryWeaponItem=secondaryWeaponItem,this.weapons=[primaryWeaponItem.instantiateNew(this),secondaryWeaponItem.instantiateNew(this)],this.weapon=this.weapons[this.weaponIdx],this.actor&&this.weapon.actor.equip()},Player.prototype.update=function(delta,resim){var dx=0,dy=0,dz=0;if(!resim&&this.actor&&this.id==meId&&(this.stateBuffer[this.stateIdx].controlKeys=this.controlKeys,this.stateBuffer[this.stateIdx].yaw=this.yaw,this.stateBuffer[this.stateIdx].pitch=this.pitch),!this.actor||this.id!=meId){var idx=this.stateIdx;this.actor&&this.id!=meId&&(idx=Math.min(idx,FramesBetweenSyncs-1)),this.controlKeys=this.stateBuffer[idx].controlKeys,this.yaw=this.stateBuffer[idx].yaw,this.pitch=this.stateBuffer[idx].pitch}if(this.controlKeys&CONTROL.left&&(dx-=Math.cos(this.yaw),dz+=Math.sin(this.yaw)),this.controlKeys&CONTROL.right&&(dx+=Math.cos(this.yaw),dz-=Math.sin(this.yaw)),this.controlKeys&CONTROL.up&&(this.climbing?dy+=1:(dx+=Math.sin(this.yaw),dz+=Math.cos(this.yaw))),this.controlKeys&CONTROL.down&&(this.climbing?dy-=1:(dx-=Math.sin(this.yaw),dz-=Math.cos(this.yaw))),this.climbing){this.setJumping(!1);pdy=this.dy;this.corrections&&(pdy+=this.corrected.dy/6,this.corrections--),this.dy+=.014*dy*delta;ndy=.5*(this.dy+pdy)*delta;this.y+=ndy,this.dy*=Math.pow(.5,delta);var cx=Math.floor(this.climbingCell.x),cy=Math.floor(this.y+1e-4),cz=Math.floor(this.climbingCell.z);if(0==this.climbingCell.ry||this.climbingCell.ry,cy>=map.height)this.climbing=!1;else{var cell=map.data[cx][cy][cz];cell.idx&&"ladder"==mapMeshes[cell.idx].colliderType&&cell.ry==this.climbingCell.ry||(this.y=Math.round(this.y),this.climbing=!1)}this.collidesWithMap()&&(ndy>0&&this.y%1>.3?(this.y-=ndy,this.dy*=.5):ndy<0&&(this.y-=ndy,this.dy*=.5,this.climbing=!1))}else{var deltaVector=new BABYLON.Vector3(dx,dy,dz).normalize(),pdx=this.dx,pdy=this.dy,pdz=this.dz;this.corrections&&(pdx+=this.corrected.dx/6,this.jumping||(pdy+=this.corrected.dy/6),pdz+=this.corrected.dz/6,this.corrections--),this.dx+=.007*deltaVector.x*delta,this.dz+=.007*deltaVector.z*delta,this.dy-=.003*delta,this.dy=Math.max(-.2,this.dy);var ndx=.5*(this.dx+pdx)*delta,ndy=.5*(this.dy+pdy)*delta,ndz=.5*(this.dz+pdz)*delta;this.moveX(ndx,delta),this.moveZ(ndz,delta),this.moveY(ndy,delta)}if(!resim){this.shield>0&&this.playing&&(this.shield-=delta,(0!=dx||0!=dy||this.shield<=0)&&this.disableShield());var speed=Math.length3(this.dx,this.dy,this.dz);this.actor&&this.id==meId&&(speed*=.75),(this.climbing||this.jumping)&&(speed*=2),this.bobble=(this.bobble+7*speed)%Math.PI2,this.shotSpread+=Math.floor(150*speed*delta);var settleFactor=Math.pow(this.weapon.subClass.accuracySettleFactor,delta);this.shotSpread=Math.max(this.shotSpread*settleFactor-4*(1-settleFactor),0),this.weapon&&this.weapon.update(delta),this.hp>0&&(this.hp=Math.min(100,this.hp+.05*delta)),this.swapWeaponCountdown>0&&(this.shotSpread=this.weapon.subClass.shotSpreadIncrement,this.swapWeaponCountdown-=delta,!this.actor&&this.swapWeaponCountdown<=0&&(this.swapWeaponCountdown=0,this.weaponIdx=this.equipWeaponIdx,this.weapon=this.weapons[this.weaponIdx])),this.reloadCountdown>0&&(this.shotSpread=this.weapon.subClass.shotSpreadIncrement,this.reloadCountdown-=delta,this.reloadCountdown<=0&&(this.reloadCountdown=0,this.reloaded())),this.rofCountdown>0&&(this.rofCountdown=Math.max(this.rofCountdown-delta,0)),this.recoilCountdown>0&&(this.recoilCountdown=Math.max(this.recoilCountdown-delta,0)),this.grenadeCountdown>0&&(this.grenadeCountdown-=delta,this.grenadeCountdown<=0&&this.grenadesQueued>0&&!this.actor&&this.throwGrenade()),this.chatLineCap=Math.min(this.chatLineCap+delta/120,2),this.actor?this.id==meId&&this.triggerPulled&&this.fire():this.shotsQueued>0&&this.fire(),this.stateBuffer[this.stateIdx].x=this.x,this.stateBuffer[this.stateIdx].y=this.y,this.stateBuffer[this.stateIdx].z=this.z,this.stateBuffer[this.stateIdx].dx=this.dx,this.stateBuffer[this.stateIdx].dy=this.dy,this.stateBuffer[this.stateIdx].dz=this.dz,this.stateIdx=Math.mod(this.stateIdx+1,stateBufferSize)}this.dx*=Math.pow(.8,delta),this.dz*=Math.pow(.8,delta),this.actor&&this.id==meId||(this.reloadsQueued>0&&this.reload(),this.weaponSwapsQueued>0&&this.swapWeapon(this.equipWeaponIdx))},Player.prototype.disableShield=function(){this.shield=0,this.actor&&(this.actor.bodyMesh.renderOverlay=!1,this.actor.hands.renderOverlay=!1)},Player.prototype.enableShield=function(){this.shield=120,this.actor&&(this.actor.bodyMesh.renderOverlay=!0,this.actor.hands.renderOverlay=!0)},Player.prototype.resetStateBuffer=function(){for(var i=0;i<stateBufferSize;i++)this.stateBuffer[i]={delta:0,yaw:this.yaw,pitch:this.pitch,fire:!1,jump:!1,jumping:!1,climbing:!1,x:this.x,y:this.y,z:this.z,dx:0,dy:0,dz:0,controlKeys:0}},Player.prototype.moveX=function(ndx,delta){var old_x=this.x;this.x+=ndx;var collide=this.collidesWithMap();if(collide){var old_y=this.y;this.y+=Math.abs(ndx)+.01*delta,this.collidesWithMap()?(this.x=old_x,this.dx*=.5,this.y=old_y):this.dx*=.92,this.lookForLadder(collide)}},Player.prototype.moveZ=function(ndz,delta){var old_z=this.z;this.z+=ndz;var collide=this.collidesWithMap();if(collide){var old_y=this.y;this.y+=Math.abs(ndz)+.01*delta,this.collidesWithMap()?(this.z=old_z,this.dz*=.5,this.y=old_y):this.dz*=.92,this.lookForLadder(collide)}},Player.prototype.moveY=function(ndy,delta){var old_y=this.y;this.y+=ndy,this.collidesWithMap()?(ndy<0&&(this.actor&&this.id==meId&&0==this.lastTouchedGround&&(this.lastTouchedGround=Date.now()),this.setJumping(!1)),this.y=old_y,this.dy*=.5):0==this.jumping&&this.setJumping(!0)},Player.prototype.canJump=function(){if(this.actor&&this.id!=meId)return!0;var canJump=!this.jumping|this.climbing;return canJump||(this.y-=.2,this.collidesWithMap()&&(canJump=!0),this.y+=.2),canJump},Player.prototype.jump=function(){return this.climbing?(this.dy=.03,this.climbing=!1,this.setJumping(!0),!0):!!this.canJump()&&(this.dy=.06,this.setJumping(!0),this.lastTouchedGround=0,!0)},Player.prototype.setJumping=function(jumping){this.jumping=jumping,this.stateBuffer[this.stateIdx].jumping=jumping},Player.prototype.changeCharacter=function(classIdx,primaryWeaponItem,secondaryWeaponItem,shellColor,hatItem,stampItem){var itemChanged=function(oldItem,newItem){return oldItem&&!newItem||!oldItem&&newItem||oldItem.id!==newItem.id};if(classIdx!==this.charClass||primaryWeaponItem.id!==this.primaryWeaponItem.id||secondaryWeaponItem.id!==this.secondaryWeaponItem.id||shellColor!==this.shellColor||itemChanged(hatItem)||itemChanged(stampItem)){if(this.charClass=classIdx,this.primaryWeaponItem=primaryWeaponItem,this.secondaryWeaponItem=secondaryWeaponItem,this.shellColor=shellColor,this.hatItem=hatItem,this.stampItem=stampItem,this.actor)this.actor.setShellColor(shellColor),this.id==meId?((output=new Comm.output(7)).packInt8(CommCode.changeCharacter),output.packInt8(classIdx),output.packInt8(catalog.get8BitItemId(primaryWeaponItem,classIdx)),output.packInt8(catalog.get8BitItemId(secondaryWeaponItem,classIdx)),output.packInt8(shellColor),output.packInt8(catalog.get8BitItemId(hatItem,classIdx)),output.packInt8(catalog.get8BitItemId(stampItem,classIdx)),ws.send(output.buffer)):(this.actor.wearHat(this.hatItem),this.actor.applyStamp(this.stampItem));else{var output=new Comm.output(8);output.packInt8(CommCode.changeCharacter),output.packInt8(this.id),output.packInt8(classIdx),output.packInt8(catalog.get8BitItemId(primaryWeaponItem,classIdx)),output.packInt8(catalog.get8BitItemId(secondaryWeaponItem,classIdx)),output.packInt8(shellColor),output.packInt8(catalog.get8BitItemId(hatItem,classIdx)),output.packInt8(catalog.get8BitItemId(stampItem,classIdx)),sendToOthers(output.buffer,this.id)}this.changeWeaponLoadout(primaryWeaponItem,secondaryWeaponItem)}},Player.prototype.swapWeapon=function(idx){if(this.actor&&this.id!=meId||this.canSwapOrReload())if(this.equipWeaponIdx=idx,this.releaseTrigger(),this.swapWeaponCountdown=this.weapon.stowWeaponTime+this.weapons[idx].equipTime,this.actor){if(this.weapon.actor.stow(),this.id==meId){var output=new Comm.output(2);output.packInt8(CommCode.swapWeapon),output.packInt8(idx),ws.send(output.buffer)}}else this.swapWeaponCountdown*=.9,this.weaponSwapsQueued--,(output=new Comm.output(3)).packInt8(CommCode.swapWeapon),output.packInt8(this.id),output.packInt8(idx),sendToOthers(output.buffer,this.id)},Player.prototype.addRotationShotSpread=function(diffYaw,diffPitch){},Player.prototype.collectItem=function(kind,applyToWeaponIdx){switch(kind){case ItemManager.AMMO:return!!this.weapons[applyToWeaponIdx].collectAmmo()&&(this.actor&&(Sounds.ammo.play(),updateAmmoUi()),!0);case ItemManager.GRENADE:return this.grenadeCount<this.grenadeCapacity&&(this.grenadeCount++,this.actor&&(Sounds.ammo.play(),updateAmmoUi()),!0)}},Player.prototype.isAtReady=function(scoped){return!(!(this.playing&&this.weapon&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0)||this.actor&&0!=grenadePowerUp)},Player.prototype.canSwapOrReload=function(){return!(!(this.playing&&this.weapon&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0&&this.shotsQueued<=0)||this.actor&&0!=grenadePowerUp)},Player.prototype.fire=function(){this.shield>0?this.releaseTrigger():this.isAtReady()&&this.rofCountdown<=0&&(this.weapon.ammo.rounds>0?(this.actor?this.actor.fire():(this.recoilCountdown*=.9,this.rofCountdown*=.9,this.shotsQueued--),this.weapon.fire(),this.weapon.ammo.rounds--,this.recoilCountdown=this.weapon.subClass.rof/3,this.rofCountdown=this.weapon.subClass.rof,this.shotSpread+=this.weapon.subClass.shotSpreadIncrement,this.actor&&this.id==meId&&this.shotsQueued++,0==this.weapon.subClass.automatic&&this.releaseTrigger(),this.actor&&this.id==meId&&updateAmmoUi()):this.weapon.actor&&(this.weapon.actor.dryFire(),this.releaseTrigger()))},Player.prototype.pullTrigger=function(){1==grenadePowerUp&&me.grenadeCountdown<=0?this.cancelGrenade():this.isAtReady()&&this.rofCountdown<=0&&(this.weapon.ammo.rounds>0?(this.triggerPulled=!0,this.fire()):this.weapon.ammo.store>0?this.reload():this.weapon.actor.dryFire())},Player.prototype.releaseTrigger=function(){this.triggerPulled=!1},Player.prototype.reload=function(){if(this.actor&&this.id!=meId)this.weapon.actor.reload();else if(this.weapon.ammo.rounds!=this.weapon.ammo.capacity&&0!=this.weapon.ammo.store&&this.canSwapOrReload()){var rounds=Math.min(Math.min(this.weapon.ammo.capacity,this.weapon.ammo.reload)-this.weapon.ammo.rounds,this.weapon.ammo.store);if(this.roundsToReload=rounds,this.actor)this.weapon.actor.reload(),this.releaseTrigger(),(output=new Comm.output(1)).packInt8(CommCode.reload),ws.send(output.buffer),this.weapon.ammo.store-=rounds;else{var output=new Comm.output(2);output.packInt8(CommCode.reload),output.packInt8(this.id),sendToOthers(output.buffer,this.id),this.reloadsQueued--}0==this.weapon.ammo.rounds?this.reloadCountdown=this.weapon.longReloadTime:this.reloadCountdown=this.weapon.shortReloadTime,this.actor||(this.reloadCountdown*=.9)}},Player.prototype.reloaded=function(){this.weapon.ammo.rounds+=this.roundsToReload,this.actor?this.id==meId&&updateAmmoUi():this.weapon.ammo.store-=this.roundsToReload},Player.prototype.queueGrenade=function(throwPower){this.grenadesQueued++,this.grenadeThrowPower=Math.clamp(throwPower,0,1),this.grenadeCountdown=20,this.actor||(this.grenadeCountdown*=.9)},Player.prototype.cancelGrenade=function(){grenadePowerUp=!1,me.grenadeCountdown=30,this.id==meId&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.actor&&(this.actor.gripBone._frozen=!1)},Player.prototype.throwGrenade=function(){if(this.shield>0&&this.disableShield(),this.actor){var output=new Comm.output(3);output.packInt8(CommCode.throwGrenade),output.packFloat(Math.clamp(grenadeThrowPower,0,1)),ws.send(output.buffer),me.grenadeCountdown=80,this.actor.reachForGrenade()}else if(this.isAtReady()&&this.grenadeCount>0){this.grenadeCount--,this.grenadesQueued--,this.grenadeCountdown=72;var rotMat=BABYLON.Matrix.RotationYawPitchRoll(this.yaw,this.pitch,0),vec=BABYLON.Matrix.Translation(0,.1,1).multiply(rotMat).getTranslation(),posMat=BABYLON.Matrix.Translation(0,-.05,.2),pos=(posMat=(posMat=posMat.multiply(rotMat)).add(BABYLON.Matrix.Translation(this.x,this.y+.3,this.z))).getTranslation(),speed=.1*this.grenadeThrowPower+.1;vec.x*=speed,vec.y*=speed,vec.z*=speed,(output=new Comm.output(14)).packInt8(CommCode.throwGrenade),output.packInt8(this.id),output.packFloat(pos.x),output.packFloat(pos.y),output.packFloat(pos.z),output.packFloat(vec.x),output.packFloat(vec.y),output.packFloat(vec.z),sendToAll(output.buffer),munitionsManager.throwGrenade(this,pos,vec)}},Player.prototype.removeFromPlay=function(){this.playing=!1,this.controlKeys=0,this.shotSpread=0,this.jumping=!1,this.climbing=!1,this.actor&&(this.actor.removeFromPlay(),this.id==meId&&(reticle.hide(),scope.hide(),camera.fov=1.25,grenadePowerUp=!1,document.getElementById("grenadeThrowContainer").style.visibility="hidden"))},Player.prototype.scoreKill=function(){this.kills++,this.totalKills++,this.streak++,this.bestGameStreak=Math.max(this.bestGameStreak,this.streak),this.bestOverallStreak=Math.max(this.bestOverallStreak,this.streak),this.score=this.streak},Player.prototype.die=function(){this.score=0,this.streak=0,this.deaths++,this.totalDeaths++,this.hp=0,this.playing=!1,this.removeFromPlay()},Player.prototype.respawn=function(x,y,z){this.x=x,this.y=y,this.z=z,this.respawnQueued=!1,this.playing=!0,this.hp<=0?(this.hp=100,this.resetWeaponState()):this.resetWeaponState(!0),this.resetStateBuffer(),this.actor&&(this.actor.mesh.position.x=x,this.actor.mesh.position.y=y,this.actor.mesh.position.z=z,this.actor.restoreToPlay(),this.weapon.equip(),this.id==meId&&(shake=0,reticle.show(),updateAmmoUi())),this.enableShield()},Player.prototype.resetWeaponState=function(dontReload){if(this.rofCountdown=0,this.shotsQueued=0,this.reloadsQueued=0,this.recoilCountdown=0,this.reloadCountdown=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.shotSpread=0,this.equipWeaponIdx=this.weaponIdx,this.weapon=this.weapons[this.weaponIdx],this.grenadeCountdown=0,this.grenadesQueued=0,this.releaseTrigger(),this.actor&&(this.weapons[0].actor.gunMesh.setEnabled(!1),this.weapons[1].actor.gunMesh.setEnabled(!1)),!dontReload){for(var i=0;i<this.weapons.length;i++)this.weapons[i]&&(this.weapons[i].ammo.rounds=this.weapons[i].ammo.capacity,this.weapons[i].ammo.store=this.weapons[i].ammo.storeMax);this.grenadeCount=Math.max(this.grenadeCount,1)}},Player.prototype.isDead=function(){return this.hp<=0},Player.prototype.lookForLadder=function(collide){if(collide&&collide.cell&&this.controlKeys&CONTROL.up&&"ladder"==mapMeshes[collide.cell.idx].colliderType){var diff=Math.abs(Math.radDifference(this.yaw,collide.cell.ry*Math.PI90));if(!(diff>.75&&diff<2.391)){if(1==collide.cell.ry||3==collide.cell.ry){if(Math.abs(this.z-collide.z-.5)>.2)return}else if(Math.abs(this.x-collide.x-.5)>.2)return;this.climbingCell.x=collide.x,this.climbingCell.z=collide.z,this.climbingCell.ry=collide.cell.ry,this.climbing=!0,this.lastTouchedGround=Date.now()+100,this.setJumping(!1)}}},Player.prototype.getOccupiedCell=function(){if(this.x<0||this.y<0||this.z<0||this.x>=map.width||this.y>=map.height||this.z>map.depth)return{};var cx=Math.floor(this.x),cy=Math.floor(this.y+1e-4),cz=Math.floor(this.z);return map.data[cx][cy][cz]},Player.prototype.collidesWithMap=function(){return collider.playerCollidesWithMap(this)},Pool.prototype.expand=function(num){for(var i=0;i<num;i++){var obj=this.constructorFn();obj.id=i+this.size,obj.active=!1,this.objects.push(obj)}this.size+=num},Pool.prototype.retrieve=function(id){if(void 0!=id){for(;id>=this.size;)this.expand(this.originalSize);return this.numActive++,this.objects[id].active=!0,this.objects[id]}var i=this.idx;do{i=(i+1)%this.size;var obj=this.objects[i];if(!obj.active)return this.idx=i,this.numActive++,obj.active=!0,obj}while(i!=this.idx);return this.expand(this.originalSize),this.retrieve()},Pool.prototype.recycle=function(obj){obj.active=!1,this.numActive--},Pool.prototype.forEachActive=function(fn){for(var i=0;i<this.size;i++){var obj=this.objects[i];!0===obj.active&&fn(obj,i)}},"undefined"==typeof window)var fs=require("fs");var mapMeshes;Rocket.prototype.remove=function(){munitionsManager.bulletPool.recycle(this),this.actor&&this.actor.remove()},Rocket.prototype.update=function(delta){this.ttl<=0||munitionsManager.projectileCollidesWithMap(this,this.collidesWithMapCallback)?this.remove():(this.x+=this.dx*delta,this.y+=this.dy*delta,this.z+=this.dz*delta,this.ttl-=delta,this.actor&&this.actor.update())},Rocket.prototype.fire=function(player,pos,dir,dmg,ttl,speed){this.player=player,this.x=pos.x,this.y=pos.y,this.z=pos.z,this.dx=dir.x*speed,this.dy=dir.y*speed,this.dz=dir.z*speed,this.ttl=ttl,this.damage=dmg,this.active=!0,this.actor&&this.actor.fire()},Rocket.prototype.collidesWithMapCallback=function(x,y,z){if(this.actor){addExplosion(this.x,this.y,this.z,this.damage);var pos=new BABYLON.Vector3(this.x,this.y,this.z);this.actor.explodeSound.setPosition(pos),this.actor.explodeSound.play()}};var bigAdTimeout,bigAdIdx,smallAdIdx,aipPrerollPlayer,adTest=!1,lastAdProvider=null;"?adTest"==window.location.search&&(adTest=!0);var lastBannerLoaded,aipBannerDisplayed=!1,aipMultisizeBannerDisplayed=!1;BulletActor.prototype.fire=function(){this.bullet.player.id==meId?this.delayFrames=Math.ceil(ping/17)+5:this.delayFrames=5,this.mesh.position.x=this.bullet.x,this.mesh.position.y=this.bullet.y,this.mesh.position.z=this.bullet.z,this.mesh.lookAt(new BABYLON.Vector3(this.bullet.x+this.bullet.dx,this.bullet.y+this.bullet.dy,this.bullet.z+this.bullet.dz)),this.mesh.rotation.x+=.015,this.mesh.rotation.y-=.015,this.mesh.scaling.z=.5},BulletActor.prototype.update=function(){--this.delayFrames<=0&&this.mesh.setEnabled(!0),this.mesh.position.x=this.bullet.x,this.mesh.position.y=this.bullet.y,this.mesh.position.z=this.bullet.z,this.bullet.player.id!=meId&&(this.mesh.scaling.z=Math.min(this.mesh.scaling.z+.03,3))},BulletActor.prototype.remove=function(){this.mesh.setEnabled(!1)};var Comm={output:function(size){this.buffer=new Uint8Array(size),this.idx=0,this.packInt8=function(val){this.buffer[this.idx]=255&val,this.idx++},this.packInt16=function(val){this.buffer[this.idx]=255&val,this.buffer[this.idx+1]=val>>8&255,this.idx+=2},this.packInt32=function(val){this.buffer[this.idx]=255&val,this.buffer[this.idx+1]=val>>8&255,this.buffer[this.idx+2]=val>>16&255,this.buffer[this.idx+3]=val>>24&255,this.idx+=4},this.packRadU=function(val){this.packInt16(1e4*val)},this.packRad=function(val){this.packInt16(1e4*(val+Math.PI))},this.packFloat=function(val){this.packInt16(300*val)},this.packDouble=function(val){this.packInt32(1e6*val)},this.packString=function(str){this.packInt8(str.length);for(var i=0;i<str.length;i++)this.packInt16(str.charCodeAt(i))}},input:function(buf){this.buffer=new Uint8Array(buf),this.idx=0,this.isMoreDataAvailable=function(){return Math.max(0,this.buffer.length-this.idx)},this.unPackInt8U=function(){var i=this.idx;return this.idx++,this.buffer[i]},this.unPackInt8=function(){return(this.unPackInt8U()+128)%256-128},this.unPackInt16U=function(){var i=this.idx;return this.idx+=2,this.buffer[i]+(this.buffer[i+1]<<8)},this.unPackInt32U=function(){var i=this.idx;return this.idx+=4,this.buffer[i]+256*this.buffer[i+1]+65536*this.buffer[i+2]+16777216*this.buffer[i+3]},this.unPackInt16=function(){return(this.unPackInt16U()+32768)%65536-32768},this.unPackInt32=function(){return(this.unPackInt32U()+2147483648)%4294967296-2147483648},this.unPackRadU=function(){return this.unPackInt16U()/1e4},this.unPackRad=function(){return this.unPackRadU()-Math.PI},this.unPackFloat=function(){return this.unPackInt16()/300},this.unPackDouble=function(){return this.unPackInt32()/1e6},this.unPackString=function(maxLen){maxLen=maxLen||1e3;for(var len=Math.min(this.unPackInt8U(),maxLen),str=new String,i=0;i<len;i++){var c=this.unPackInt16U();c>0&&(str+=String.fromCharCode(c))}return str}}},tv1=new BABYLON.Vector3,tv2=new BABYLON.Vector3;BABYLON.Skeleton.prototype.disableBlending=function(){this.bones.forEach(function(bone){bone.animations.forEach(function(animation){animation.enableBlending=!1})})},BABYLON.Scene.prototype.cloneMesh=function(name,parent){return this.getMeshByName(name).clone("",parent)},BABYLON.Scene.prototype.cloneSkeleton=function(name){var skeleton=this.getSkeletonByName(name).clone();return skeleton.name=name+Date.now(),skeleton},BABYLON.SceneOptimizer.OptimizeAsync=function(scene,options,onSuccess,onFailure){gameScene.executeWhenReady(function(){BABYLON.SceneOptimizer._timer=setTimeout(function(){BABYLON.SceneOptimizer._CheckCurrentState(scene,options,0,onSuccess,onFailure)},options.trackerDuration)})},BABYLON.SceneOptimizer.Stop=function(){clearTimeout(BABYLON.SceneOptimizer._timer)},BABYLON.DynamicTexture.prototype.clearRect=function(x,y,w,h){this._context.clearRect(x,y,w,h)},BABYLON.AbstractMesh.prototype.setLayerMask=function(mask){this.layerMask=mask;for(var children=this.getChildMeshes(),i=0;i<children.length;i++)children[i].setLayerMask(mask)},BABYLON.AbstractMesh.prototype.setRenderingGroupId=function(id){this.renderingGroupId=id;for(var children=this.getChildMeshes(),i=0;i<children.length;i++)children[i].setRenderingGroupId(id)},BABYLON.TransformNode.prototype.setVisible=function(visible){this.isVisible=visible,this._isWorldMatrixFrozen=!visible;for(var children=this.getChildTransformNodes(),i=0;i<children.length;i++)children[i].setVisible(visible)},BABYLON.AbstractMesh.prototype.setMaterial=function(mat){this.material=mat;for(var children=this.getChildMeshes(),i=0;i<children.length;i++)children[i].setMaterial(mat)},BABYLON.AbstractMesh.prototype.attachSound=function(sound){this.attachedSounds||(this.attachedSounds=[]);var clonedSound=sound.clone();return clonedSound.attachToMesh(this),this.attachedSounds.push(clonedSound),clonedSound},BABYLON.TransformNode.prototype.disposeOfSounds=function(){if(this.attachedSounds)for(var s in this.attachedSounds){var sound=this.attachedSounds[s];sound&&(sound.detachFromMesh(),sound.dispose())}for(var children=this.getChildTransformNodes(),i=0;i<children.length;i++)children[i].disposeOfSounds()};var bulletHoleManager,explosionSmokeManager,explosionFireManager,respawnTime,uiCamera,grenadePowerUp,chatting,mapOverview,scope,reticle,hitIndicator,lastTimeStamp,lastDelta,escPressed,kills,deaths,bestOverallStreak,timedGame,roundLength,roundEndTime,roundRestartTime,betweenRounds,respawnInterval,oldClockSeconds,gameScene,map,minMap,light,me,grenadeThrowPower,players,keyIsDown,nameTexture,nameSprites,mapMesh,collider,gameCode,Sounds={},Music={},mapOverviewAxis=0,teamColors={text:["rgba(255, 255, 255, 1)","rgba(64, 224, 255, 1)","rgba(255, 192, 160, 1)"],meBackground:["rgba(255, 192, 64, 0.75)","rgba(0, 192, 255, 0.8)","rgba(192, 64, 32, 0.8)"],themBackground:["rgba(0, 0, 0, 0.25)","rgba(0, 64, 192, 0.3)","rgba(192, 64, 32, 0.3)"],summaryBackground:["rgba(64, 64, 64, 0.75)","rgba(0, 64, 192, 0.75)","rgba(192, 64, 32, 0.75)"],outline:[new BABYLON.Color4(1,1,1,1),new BABYLON.Color4(0,.75,1,1),new BABYLON.Color4(1,.25,.25,1)]};startGame=function(){var oneSignalBell=document.getElementById("onesignal-bell-container");oneSignalBell&&(oneSignalBell.style.display="none"),players=[],keyIsDown={},respawnTime=null,me=null,escPressed=!0,betweenRounds=!1,oldClockSeconds=null,grenadePowerUp=!1,lastTimeStamp=performance.now(),lastDelta=0,ping=0,highestPing=0,pingTotal=0,pingSamples=0,fpsTotal=0,fpsSamples=0,kills=0,deaths=0,bestOverallStreak=0,gameStartTime=Date.now(),nextPingSample=Date.now()+1e3,engine.clear(BABYLON.Color3.Black()),engine.stopRenderLoop(),gameScene=new BABYLON.Scene(engine),scene=gameScene,settings.autoDetail||(gameScene.shadowsEnabled=settings.shadowsEnabled),gameScene.autoClear=!1,gameScene.autoClearDepthAndStencil=!1,settings.autoDetail&&enableAutoDetail(),light=setupLights(),camera=new BABYLON.TargetCamera("camera",BABYLON.Vector3.Zero(),gameScene),gameScene.activeCameras.push(camera),camera.maxZ=100,camera.fov=1.25,camera.minZ=.05,(uiCamera=new BABYLON.FreeCamera("uiCamera",new BABYLON.Vector3(0,0,-1),gameScene)).mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA,uiCamera.layerMask=536870912,uiCamera.autoClear=!1,gameScene.activeCameras.push(uiCamera),window.onfocus=function(){lastTimeStamp=performance.now()},window.onblur=function(){},document.onpointerlockchange=function(){if(me)if(document.pointerLockElement)hideGameMenu();else{if(lastKey=null,me.controlKeys=0,me.releaseTrigger(),escPressed){var output=new Comm.output(1);output.packInt8(CommCode.pause),ws.send(output.buffer),setRespawnTime(5),timeout.set(function(){me.removeFromPlay()},3e3)}"none"==document.getElementById("overlay").style.display&&showGameMenu()}escPressed=!0},resetGameUI();var helpEl=document.getElementById("helpControls");helpEl.innerHTML="";var helpSlots={up:null,down:null,left:null,right:null,jump:null,fire:null,scope:null,reload:null,weapon:null,grenade:null};for(var k in inputToControlMap)helpSlots[inputToControlMap[k]]=k;var count=0;for(var k in helpSlots)helpEl.innerHTML+=helpSlots[k],count++,helpEl.innerHTML+=count>=4?"<br>":" ";gameType!=GameType.teams?(document.getElementById("teamButtonContainer").style.display="none",document.getElementById("goButton").style.height="6.5em"):(document.getElementById("teamButtonContainer").style.display="block",document.getElementById("goButton").style.height="4em"),document.body.style.overflow="hidden",loadResources(gameScene,onLoadingComplete)};var munitionsManager,itemManager,queueVideoAd,killDisplayTimeout,SPS,pingStartTime,debugWindow,lastMouseMovement={},smokeColor=new BABYLON.Color4(.2,.2,.2,1),fireColors=(new BABYLON.Color4(1,.8,.2,1),[{pos:0,color:new BABYLON.Color4(1,.9,.8,1)},{pos:.2,color:new BABYLON.Color4(1,.5,.1,1)},{pos:.4,color:new BABYLON.Color4(.6,.2,0,1)},{pos:.7,color:new BABYLON.Color4(0,0,0,0)},{pos:1,color:new BABYLON.Color4(0,0,0,0)}]),chatParser=document.createElement("DIV"),rotInc=Math.PI/2,lastLeadingTeam=1,lastKey=null;Scope.prototype.show=function(){var h=engine.getRenderHeight();this.crosshairs.scaling.x=h/2,this.crosshairs.scaling.y=h/2,this.crosshairs.setEnabled(!0),document.getElementById("scopeBorder").style.display="block",camera.viewport.width=h/engine.getRenderWidth(),camera.viewport.x=.5-.5*camera.viewport.width},Scope.prototype.hide=function(){this.crosshairs.setEnabled(!1),document.getElementById("scopeBorder").style.display="none",camera.viewport.width=1,camera.viewport.x=0},HitIndicator.prototype.resize=function(){this.mesh.scaling.x=engine.getRenderWidth(),this.mesh.scaling.y=engine.getRenderHeight()},HitIndicator.prototype.update=function(delta){for(var i=7;i<48;i+=4)this.colors[i]-=(this.colors[i]+.5)/10*delta;var mult=Math.pow(.9,delta);me&&me.playing&&(camera.position.x*=mult,camera.position.z*=mult),this.mesh.updateVerticesData(BABYLON.VertexBuffer.ColorKind,this.colors,!0)},HitIndicator.prototype.hit=function(dx,dz){var a=Math.radRange(-Math.atan2(dx,-dz)-me.yaw+.393);a=Math.floor(a/Math.PI2*8);var vec=new BABYLON.Vector2(-this.positions[3*a+3],-this.positions[3*a+4]).normalize();camera.position.x=.03*vec.x,camera.position.z=.03*vec.y,this.colors[4*a+7]=2},Reticle.prototype.show=function(){this.mesh.setEnabled(!0)},Reticle.prototype.hide=function(){this.mesh.setEnabled(!1)},Reticle.prototype.update=function(delta){if(me.weapon)for(var i=0;i<4;i++){var a=i*Math.PI/2,spread=me.shotSpread+me.weapon.subClass.accuracy;this.lines[i].position.x=-Math.sin(a)*spread,this.lines[i].position.y=Math.cos(a)*spread}},Reticle.prototype.resize=function(){var scale=engine.getRenderHeight()/640;this.mesh.scaling.x=scale,this.mesh.scaling.y=scale};window.console=function(origConsole){window.console&&origConsole||(origConsole={});var logArray=[];return{dir:function(){origConsole.dir&&origConsole.dir.apply(origConsole,arguments)},log:function(){this.addLog(arguments),origConsole.log&&origConsole.log.apply(origConsole,arguments)},warn:function(){this.addLog(arguments),origConsole.warn&&origConsole.warn.apply(origConsole,arguments)},error:function(){this.addLog(arguments),origConsole.error&&origConsole.error.apply(origConsole,arguments)},info:function(){this.addLog(arguments),origConsole.info&&origConsole.info.apply(origConsole,arguments)},addLog:function(args){var msg=args[0];"object"==typeof msg&&(msg=JSON.stringify(msg)),logArray.push(msg),logArray.length>100&&logArray.shift()},logArray:function(){return logArray},clearLog:function(){logArray=[]}}}(window.console);var weaponStats={totalDamage:{name:"damage",max:-1e3,min:1e3,flip:!1},accuracy:{name:"accuracy",max:-1e3,min:1e3,flip:!0},rof:{name:"fireRate",max:-1e3,min:1e3,flip:!0},range:{name:"range",max:-1e3,min:1e3,flip:!1}};Customizer.prototype.onResourcesLoaded=function(){var outer=this;scene=this.scene;try{var meshName=playerAccount.getPrimaryWeapon().item_data.meshName;this.avatar=new function(c){this.id=-1,this.name="",this.x=0,this.y=0,this.z=0,this.hp=100,this.hatItem=playerAccount.hatItem,this.stampItem=playerAccount.stampItem,this.shellColor=playerAccount.colorIdx,this.actor=new PlayerActor(this),this.actor.mesh.rotation.y=outer.rotY,this.weapon=new classes[c].weapon(this,meshName),this.weapon.actor.equip()}(playerAccount.classIdx),console.log("avatar created: "+this.avatar);var lastNow=Date.now();this.scene.registerBeforeRender(function(){var now=Date.now(),delta=now-lastNow;lastNow=now,delta/=17,outer.update(delta)})}catch(e){console.log(e)}},Customizer.prototype.startRendering=function(){var outer=this;engine.runRenderLoop(function(){outer.scene.render()})},Customizer.prototype.update=function(delta){if(this.avatar.actor.handsToWeaponSkeleton(),this.camera.target.x+=(this.camX-this.camera.target.x)/5,this.camera.target.y+=(this.camY-this.camera.target.y)/5,this.camera.radius+=(this.camRadius-this.camera.radius)/5,this.avatar.actor.head.rotation.x+=(this.rotX-this.avatar.actor.head.rotation.x)/5,this.avatar.actor.mesh.rotation.y+=(this.rotY-this.avatar.actor.mesh.rotation.y)/5,this.avatar.actor.mesh.rotation.x=.5*this.avatar.actor.head.rotation.x,this.avatar.actor.mesh.position.x=.1*-this.avatar.actor.mesh.rotation.y,this.avatar.actor.mesh.position.y+=delta*this.jump,this.jump-=.002*delta,this.avatar.actor.mesh.position.y=Math.max(0,this.avatar.actor.mesh.position.y+this.jump*delta),this.turnCountdown-=delta,this.turnCountdown<=0){var rx=.6*Math.random()-.4,ry=2*Math.random()-1+.5*this.camX,d=Math.length2(rx-this.rotX,ry-this.rotY);this.rotX=rx,this.rotY=ry,this.jump=Math.min(.01,d/100),this.turnCountdown=90*Math.random()+30}},Customizer.prototype.open=function(){menuIn("customizationMenu"),document.getElementById("customizeButton").style.display="none",document.getElementById("customizerBackButton").style.display="inline",document.getElementById("customizerClassSelectorContainer").appendChild(document.getElementById("classSelector")),document.getElementById("redeemCodeButton").style.display=playerAccount.session?"inline":"none",this.camX=.39,this.camY=.3,this.camRadius=3.4,this.initWeaponButton(Slot.Primary),this.initWeaponButton(Slot.Secondary),this.initHatButton(),this.initStampButton()},Customizer.prototype.openToItem=function(item){switch(item.item_type_id){case ItemType.Primary:this.openWeaponSelectorToItem(Slot.Primary,item);break;case ItemType.Secondary:this.openWeaponSelectorToItem(Slot.Secondary,item);break;case ItemType.Hat:this.openHatSelectorToItem(item);break;case ItemType.Stamp:this.openStampSelectorToItem(item)}this.currentSelectByItemFunc(item)},Customizer.prototype.openToTaggedItems=function(tag){var taggedItems=catalog.getTaggedItems(tag);this.openItemSelector("Items: "+tag,taggedItems,null,null,!1,!1)},Customizer.prototype.close=function(){playerAccount.syncToServer(),menuOut("customizationMenu"),document.getElementById("customizerBackButton").style.display="none",document.getElementById("redeemCodeButton").style.display="none",document.getElementById("customizeButton").style.display="inline",document.getElementById("mainMenuClassSelectorContainer").appendChild(document.getElementById("classSelector")),inGame?(engine.stopRenderLoop(),scene=gameScene,startRendering(),me.changeCharacter(playerAccount.classIdx,playerAccount.getPrimaryWeapon(),playerAccount.getSecondaryWeapon(),playerAccount.colorIdx,playerAccount.hatItem,playerAccount.stampItem,0,0),chatting&&chatInEl.focus(),showMultisizeBannerAd(),loadBannerAd()):menuIn("mainMenu",function(){showBannerAd(),loadBannerAd()}),this.camX=0,this.camY=.4,this.camRadius=3.4},Customizer.prototype.updatePageArrows=function(){document.getElementById("itemPageLeft").style.visibility=this.page>0?"visible":"hidden",document.getElementById("itemPageRight").style.visibility=this.page<this.numItems/this.pageSize-1?"visible":"hidden";var str="Page "+(this.page+1)+"/"+Math.ceil(this.numItems/this.pageSize);document.getElementById("itemPageCount").innerText=str},Customizer.prototype.flipPage=function(dir){this.page+=dir,this.currentRenderFunc(),this.updatePageArrows()},Customizer.prototype.iteratePage=function(callbackPerItem){for(var start=this.page*this.pageSize,end=Math.min(start+this.pageSize,this.numItems),i=start,b=0;i<end;i++,b++)callbackPerItem(i,b)},Customizer.prototype.renderEmptyButton=function(){var i=document.getElementById("noItemImg");document.getElementById("item0").getContext("2d").drawImage(i,0,0)},Customizer.prototype.clearItemButtons=function(){for(var i=0;i<this.pageSize;i++)document.getElementById("item"+i).getContext("2d").clearRect(0,0,256,256);this.clearItemLocks()},Customizer.prototype.clearItemLocks=function(){for(var i=0;i<this.pageSize;i++)this.setItemLocked(i,!1,0),this.setItemRequiresPhysicalUnlock(i,!1)},Customizer.prototype.clearHighlight=function(){for(var i=0;i<this.pageSize;i++)document.getElementById("item"+i).className="itemButton"},Customizer.prototype.highlightSelectedIndex=function(listIndex){var start=this.page*this.pageSize,end=start+this.pageSize;listIndex>=start&&listIndex<end&&(pageIndex=listIndex%this.pageSize,document.getElementById("item"+pageIndex).className="itemButtonSelected")},Customizer.prototype.isItemPickable=function(item){var requiresPhysicalPurchase=this.doesItemRequirePhysicalUnlock(item);return 0===item.price&&!requiresPhysicalPurchase||playerAccount.inventory.includes(item)},Customizer.prototype.doesItemRequirePhysicalUnlock=function(item){return void 0!==item.item_data.unlock&&null!==item.item_data.unlock&&"physical"===item.item_data.unlock},Customizer.prototype.setItemLocked=function(displayIdx,locked,price){document.getElementById("lockedItem"+displayIdx).style.visibility=locked?"visible":"hidden",document.getElementById("lockedItemCost"+displayIdx).innerText=price},Customizer.prototype.setItemRequiresPhysicalUnlock=function(displayIdx,requiresPhysicalPurchase){document.getElementById("lockedItemPhysical"+displayIdx).style.visibility=requiresPhysicalPurchase?"visible":"hidden"},Customizer.prototype.boughtItem=function(){this.currentPickedItem=this.buyingItem,this.currentPickedItem.pick(),this.currentPickedItem.poseEgg(),this.buyingItem=null,this.currentRenderFunc(this.currentPickedItem),menuOut("buyItem"),menuFlexIn("itemSelectorGrid"),menuIn("itemSelectorBackButton"),menuIn("itemSelectorBuyEggsButton")},Customizer.prototype.buyItemBack=function(){null!==this.currentPickedItem?this.currentPickedItem.poseEgg():this.buyingItem.takeOffItem(),this.buyingItem=null,this.currentHighlightFunc(),menuOut("buyItem"),menuOut("getMoreEggsLoozer"),menuFlexIn("itemSelectorGrid"),menuIn("itemSelectorBackButton"),menuIn("itemSelectorBuyEggsButton")},Customizer.prototype.openPhysicalItemStoreDialog=function(){openAlertDialog("Go To Store","Open the store in a new tab?",{label:"Yes",width:"4em",onclick:physicalUnlockOpenStore},{label:"No",width:"4em",onclick:closeAlertDialog})},Customizer.prototype.physicalUnlockBack=function(){this.buyItemBack(),menuOut("physicalUnlock")},Customizer.prototype.pickColor=function(idx){if(this.avatar){playerAccount.colorIdx=idx;for(var ci=0;ci<7;ci++)document.getElementById("color"+ci).style.borderWidth=ci===playerAccount.colorIdx?"0.2em":"0.1em";this.avatar.actor.setShellColor(playerAccount.colorIdx)}},Customizer.prototype.pickNextClass=function(dir){var classIdx=Math.mod(playerAccount.classIdx+dir,classes.length);this.pickClass(classIdx)},Customizer.prototype.pickClass=function(classIdx){playerAccount.setClass(classIdx);var primaryWeaponItem=playerAccount.getPrimaryWeapon();this.poseWithWeapon(primaryWeaponItem),this.initWeaponButton(Slot.Primary),this.initWeaponButton(Slot.Secondary),this.updateWeaponStatsUI()},Customizer.prototype.updateWeaponStatsUI=function(){if(this.avatar){document.getElementById("className").innerText=classes[playerAccount.classIdx].name,document.getElementById("classWeapon").innerText=this.avatar.weapon.subClass.weaponName;for(var key in weaponStats){var pct=(this.avatar.weapon.subClass[key]+weaponStats[key].min)/(weaponStats[key].max-Math.abs(weaponStats[key].min));pct=5.6-5.5*pct,document.getElementById(weaponStats[key].name).style.borderRight=pct+"em solid var(--egg-brown)"}}},Customizer.prototype.dressUpEgg=function(){void 0!==playerAccount&&null!==playerAccount&&void 0!==this.avatar&&null!==this.avatar&&(this.pickClass(playerAccount.classIdx),this.poseWithWeapon(playerAccount.getPrimaryWeapon()),this.poseWithHat(playerAccount.hatItem),this.poseWithStamp(playerAccount.stampItem),this.pickColor(playerAccount.colorIdx))},Customizer.prototype.initWeaponButton=function(slot){var currentPickedWeaponItem=playerAccount.getPickedWeaponInSlot(slot),canvasId=slot===Slot.Primary?"primarySelectorButton":"secondarySelectorButton",c=document.getElementById(canvasId);itemRenderer.renderToCanvas(currentPickedWeaponItem.item_data.meshName,c,this.weaponCam[slot])},Customizer.prototype.openWeaponSelector=function(slot){this.openWeaponSelectorToItem(slot,playerAccount.getPickedWeaponInSlot(slot))},Customizer.prototype.openWeaponSelectorToItem=function(slot,weaponItem){var weaponList=catalog.forClass[playerAccount.classIdx].forWeaponSlot[slot],title=slot===Slot.Primary?"Primary Weapons":"Secondary Weapons";this.openItemSelector(title,weaponList,weaponItem,!1,!0)},Customizer.prototype.poseWithWeapon=function(weaponItem){this.avatar&&(this.avatar.weapon&&this.avatar.weapon.actor.dispose(),this.avatar.weapon=weaponItem.instantiateNew(this.avatar),this.avatar.weapon.actor.gunMesh.setEnabled(!0),this.initWeaponButton(0),this.initWeaponButton(1))},Customizer.prototype.initHatButton=function(){var c=document.getElementById("hatSelectorButton");if(null!==playerAccount.hatItem)itemRenderer.renderToCanvas(playerAccount.hatItem.item_data.meshName,c,this.hatCam);else{var i=document.getElementById("noHatImg"),ctx=c.getContext("2d");ctx.clearRect(0,0,256,256),ctx.drawImage(i,0,0)}},Customizer.prototype.openHatSelector=function(){this.openHatSelectorToItem(playerAccount.hatItem)},Customizer.prototype.openHatSelectorToItem=function(hatItem){this.openItemSelector("Hats",catalog.hats,hatItem,!0,!0)},Customizer.prototype.poseWithHat=function(hatItem){null===hatItem?this.avatar.actor.removeHat():this.avatar.actor.wearHat(hatItem)},Customizer.prototype.initStampButton=function(){var c=document.getElementById("stampSelectorButton");if(null!==playerAccount.stampItem)itemRenderer.renderStampToCanvas(playerAccount.stampItem,c);else{var i=document.getElementById("noStampImg"),ctx=c.getContext("2d");ctx.clearRect(0,0,256,256),ctx.drawImage(i,0,0)}},Customizer.prototype.openStampSelector=function(){this.openStampSelectorToItem(playerAccount.stampItem)},Customizer.prototype.openStampSelectorToItem=function(stampItem){this.openItemSelector("Stamps",catalog.stamps,stampItem,!0,!0)},Customizer.prototype.poseWithStamp=function(stampItem){null===stampItem?this.avatar.actor.removeStamp():this.avatar.actor.applyStamp(stampItem)},Customizer.prototype.openItemSelector=function(title,itemList,item,firstItemBlank,highlightSelected){if(playerAccount.isLoggedIn){this.camX=.6,this.camY=.35,this.pageSize=9;var uiItems=this.filterItemsForUI(itemList),blankFirstItemShim=!0===firstItemBlank?1:0;this.numItems=uiItems.length+blankFirstItemShim;var itemIdx=0;null!==item&&null===(itemIdx=this.getItemIndex(item,uiItems))&&(itemIdx=0),highlightSelected&&playerAccount.isItemEquipped(item)&&(this.currentPickedItem=item),this.page=Math.floor(itemIdx/this.pageSize),this.currentRenderFunc=this.encloseRenderPageFunc(uiItems,firstItemBlank,highlightSelected),this.currentHighlightFunc=this.encloseHighlightFunc(uiItems,firstItemBlank,highlightSelected),this.currentSelectByIndexFunc=this.encloseSelectByIndexFunc(uiItems,firstItemBlank,highlightSelected),this.currentSelectByItemFunc=this.encloseSelectByItemFunc(uiItems,firstItemBlank,highlightSelected),this.currentRenderFunc(),this.currentHighlightFunc(),this.updatePageArrows(),document.getElementById("itemSelectorHeader").innerText=title,menuOut("customizationMenu"),menuIn("itemSelectorMenu")}else promoteLogin()},Customizer.prototype.encloseRenderPageFunc=function(itemList,firstItemBlank,highlightSelected){var outer=this;return function(){outer.clearItemButtons(),outer.iteratePage(function(i,b){if(!0===firstItemBlank&&0===i)outer.renderEmptyButton(),outer.setItemLocked(0,!1,0),outer.setItemRequiresPhysicalUnlock(0,!1);else{var renderingItem=itemList[!0===firstItemBlank?i-1:i],canvas=document.getElementById("item"+b);renderingItem.renderToCanvas(canvas);var locked=!outer.isItemPickable(renderingItem),requiresPhysicalUnlock=outer.doesItemRequirePhysicalUnlock(renderingItem);outer.setItemRequiresPhysicalUnlock(b,locked&&requiresPhysicalUnlock),outer.setItemLocked(b,locked&&!requiresPhysicalUnlock,renderingItem.price)}}),outer.currentHighlightFunc()}},Customizer.prototype.encloseHighlightFunc=function(itemList,firstItemBlank,highlightSelected){var outer=this;return function(){outer.clearHighlight(),!1!==highlightSelected&&outer.iteratePage(function(i,b){if(!0===firstItemBlank&&0===i)null===outer.currentPickedItem&&outer.highlightSelectedIndex(0);else{var item=itemList[!0===firstItemBlank?i-1:i];null!==outer.currentPickedItem&&item.id===outer.currentPickedItem.id&&outer.highlightSelectedIndex(i)}})}},Customizer.prototype.encloseSelectByIndexFunc=function(itemList,firstItemBlank,highlightSelected){var outer=this;return function(displayIndex){var listIndex=displayIndex;!0===firstItemBlank&&listIndex--;var noItem=!0===firstItemBlank&&0===displayIndex,item=noItem?null:itemList[listIndex];!0===noItem||outer.isItemPickable(item)?(!0===highlightSelected&&outer.highlightSelectedIndex(displayIndex),!0===noItem?(outer.currentPickedItem.takeOffItem(),outer.currentPickedItem=null):(item.pick(),item.poseEgg())):(item.select(),item.poseEgg(),this.buyingItem=item,outer.itemSelected(item))}},Customizer.prototype.encloseSelectByItemFunc=function(itemList,firstItemBlank){return function(item){var itemIdx=this.getItemIndex(item,itemList);!0===firstItemBlank&&itemIdx++,this.currentSelectByIndexFunc(itemIdx)}},Customizer.prototype.itemSelected=function(item){menuOut("itemSelectorGrid"),menuOut("itemSelectorBackButton"),menuOut("itemSelectorBuyEggsButton"),this.doesItemRequirePhysicalUnlock(item)?(menuFlexIn("physicalUnlock"),document.getElementById("physicalUnlockText").innerText=void 0!==item.item_data.physicalUnlockText?item.item_data.physicalUnlockText:"Buy a REAL THING to unlock this item!",document.getElementById("physicalUnlockButton").onclick=function(){return customizer.openPhysicalItemStoreDialog(),!1}):playerAccount.currentBalance>=item.price?(menuFlexIn("buyItem"),document.getElementById("buyItemText").innerText=item.price,document.getElementById("buyItemButton").onclick=function(){return extern.buyItem(item.id),!1}):(menuFlexIn("getMoreEggsLoozer"),document.getElementById("moreEggsPrice").innerText=item.price)},Customizer.prototype.getItemIndex=function(item,itemList){if(null===item)return null;for(var i=0;i<itemList.length;i++)if(item.id===itemList[i].id)return i;return null},Customizer.prototype.selectItem=function(pageIndex){listIndex=pageIndex+this.page*this.pageSize,listIndex<this.numItems&&(this.clearHighlight(),this.currentSelectByIndexFunc(listIndex))},Customizer.prototype.closeItemSelector=function(){menuOut("itemSelectorMenu");var primaryWeapon=playerAccount.getPickedWeaponInSlot(Slot.Primary);this.poseWithWeapon(primaryWeapon),this.initWeaponButton(Slot.Primary),this.initWeaponButton(Slot.Secondary),this.initHatButton(),this.initStampButton(),this.open()},Customizer.prototype.filterItemsForUI=function(itemList){for(var uiItems=[],i=0;i<itemList.length;i++)!0===itemList[i].showInUI&&uiItems.push(itemList[i]);return uiItems},Customizer.prototype.setupItems=function(){this.extendStampItems(),this.extendHatItems();for(var cIdx=0;cIdx<3;cIdx++)this.extendWeaponItems(cIdx,Slot.Primary),this.extendWeaponItems(cIdx,Slot.Secondary)},Customizer.prototype.extendItems=function(itemList,renderItemToCanvasFunc,poseEggWithItemFunc,selectItemFunc,takeOffItemFunc,pickItemFunc){for(var i=0;i<itemList.length;i++){var showInUI=!0===itemList[i].is_available||!0===playerAccount.isItemOwned(itemList[i]);itemList[i].showInUI=showInUI,itemList[i].renderToCanvas=renderItemToCanvasFunc,itemList[i].poseEgg=poseEggWithItemFunc,itemList[i].select=selectItemFunc,itemList[i].takeOffItem=takeOffItemFunc,itemList[i].pick=pickItemFunc}},Customizer.prototype.extendWeaponItems=function(classIdx,slot){var outer=this,weaponList=catalog.forClass[classIdx].forWeaponSlot[slot],poseEggWithWeaponFunc=function(){outer.poseWithWeapon(this)};this.extendItems(weaponList,function(canvas){itemRenderer.renderToCanvas(this.item_data.meshName,canvas,outer.weaponCam[slot])},poseEggWithWeaponFunc,function(){outer.currentPickedItem=playerAccount.getPickedWeaponInSlot(slot)},function(){poseEggWithWeaponFunc(this.currentPickedItem)},function(){void 0!==this.exclusive_for_class&&null!==this.exclusive_for_class&&this.exclusive_for_class!==playerAccount.classIdx&&outer.pickClass(this.exclusive_for_class),playerAccount.pickWeapon(slot,this),outer.initWeaponButton(slot)})},Customizer.prototype.extendHatItems=function(){var outer=this;this.extendItems(catalog.hats,function(canvas){itemRenderer.renderToCanvas(this.item_data.meshName,canvas,outer.hatCam)},function(){outer.poseWithHat(this)},function(){outer.currentPickedItem=playerAccount.hatItem},function(){playerAccount.hatItem=null,outer.poseWithHat(null)},function(){outer.currentPickedItem=this,playerAccount.hatItem=this,outer.initHatButton()})},Customizer.prototype.extendStampItems=function(){var outer=this;this.extendItems(catalog.stamps,function(canvas){itemRenderer.renderStampToCanvas(this,canvas)},function(){outer.poseWithStamp(this)},function(){outer.currentPickedItem=playerAccount.stampItem},function(){playerAccount.stampItem=null,outer.poseWithStamp(null)},function(){outer.currentPickedItem=this,playerAccount.stampItem=this,outer.initStampButton()})},Customizer.prototype.setupScene=function(){this.scene=new BABYLON.Scene(engine),this.scene.fogMode=BABYLON.Scene.FOGMODE_EXP2,this.scene.fogDensity=.06;var skyColor=new BABYLON.Color3(.52,.68,.82);this.scene.fogColor=skyColor,this.scene.clearColor=skyColor;var topLight=new BABYLON.DirectionalLight("",new BABYLON.Vector3(0,-1,0),this.scene);topLight.intensity=1;var hemLight=new BABYLON.HemisphericLight("",new BABYLON.Vector3(.25,1,-.5),this.scene);hemLight.intensity=.8,(hemLight=new BABYLON.HemisphericLight("",new BABYLON.Vector3(0,-1,0),this.scene)).intensity=.5,hemLight.diffuse=new BABYLON.Color3(.6,.8,1),(shadowGen=new BABYLON.ShadowGenerator(1024,topLight)).useBlurExponentialShadowMap=!0,shadowGen.frustumEdgeFalloff=1,shadowGen.blurScale=2,shadowGen.blurBoxOffset=1,this.camera=new BABYLON.ArcRotateCamera("",.5*Math.PI,1.5,this.camRadius,new BABYLON.Vector3(this.camX,this.camY,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.maxZ=100,this.camera.fov=.5,this.camera.minZ=.1;var groundMat=new BABYLON.StandardMaterial("groundMat",this.scene);groundMat.diffuseColor=new BABYLON.Color3(.4,.5,.6),groundMat.specularColor=BABYLON.Color3.Black();var ground=BABYLON.Mesh.CreatePlane("ground",100,this.scene);ground.rotation.x=Math.PI/2,ground.receiveShadows=!0,ground.material=groundMat,this.scene.render(),document.getElementById("color"+playerAccount.colorIdx).style.borderWidth="0.2em";for(var i=0;i<shellColors.length;i++)document.getElementById("color"+i).style.background=shellColors[i];stampTexture=new BABYLON.Texture("img/stamps.png?v="+version,this.scene),this.weaponCam=[{alpha:0,radius:1.3,primaryGun:!0},{alpha:0,radius:1,secondaryGun:!0}],this.hatCam={alpha:0,radius:1.3}},Customizer.prototype.setupWeaponStats=function(){var setupWeaponStatsInList=function(weaponList){for(var i=0;i<weaponList.length;i++){var weapon=weaponList[i].item_data.class;for(var key in weaponStats)"range"==key&&(weapon.range=weapon.ttl*weapon.velocity),weaponStats[key].flip?(weaponStats[key].max=Math.max(weaponStats[key].max,-weapon[key]),weaponStats[key].min=Math.min(weaponStats[key].min,-weapon[key])):(weaponStats[key].max=Math.max(weaponStats[key].max,weapon[key]),weaponStats[key].min=0)}};setupWeaponStatsInList(catalog.primaryWeapons),setupWeaponStatsInList(catalog.secondaryWeapons)};var flashColors=[new BABYLON.Color3(1,1,0),new BABYLON.Color3(0,.5,1),new BABYLON.Color3(1,0,0)];GrenadeActor.prototype.throw=function(){this.mesh.setEnabled(!0),this.mesh.position.x=this.grenade.x,this.mesh.position.y=this.grenade.y,this.mesh.position.z=this.grenade.z,this.grenade.player.id==meId?this.flashColor=flashColors[0]:this.flashColor=flashColors[this.grenade.player.team],this.pinSound.play(),this.bounce()},GrenadeActor.prototype.update=function(){this.mesh.position.x=this.grenade.x,this.mesh.position.y=this.grenade.y,this.mesh.position.z=this.grenade.z,this.mesh.rotation.x+=this.rx,this.mesh.rotation.y+=this.ry,this.mesh.rotation.z+=this.rz,Math.sqrt(this.grenade.ttl)%2>1?(0==this.beep&&(this.beepSound.play(),this.beep=!0),this.mesh.emissiveColor=this.flashColor):(this.mesh.emissiveColor=BABYLON.Color3.Black(),this.beep=!1)},GrenadeActor.prototype.remove=function(){this.mesh.setEnabled(!1)},GrenadeActor.prototype.bounce=function(){var s=Math.length3(this.grenade.dx,this.grenade.dy,this.grenade.dz);this.rx=(4*Math.random()-2)*s,this.ry=(4*Math.random()-2)*s,this.rz=(4*Math.random()-2)*s},GunActor.prototype.setup=function(muzFlashZ){this.gunMesh=this.playerActor.gunContainer.getScene().cloneMesh(this.meshName,this.playerActor.gunContainer),this.gunMesh.skeleton=this.skeleton,this.gunMesh.setEnabled(!1),muzFlashZ&&(this.muzzleFlash=this.playerActor.gunContainer.getScene().cloneMesh("muzzleFlash",this.playerActor.gunContainer),this.muzzleFlash.setEnabled(!1),this.muzzleFlash.parent=this.playerActor.gunContainer,this.muzzleFlash.position.x=.25,this.muzzleFlash.position.z=muzFlashZ),this.gun.player.id==meId&&(this.gunMesh.setRenderingGroupId(1),this.muzzleFlash&&this.muzzleFlash.setRenderingGroupId(1))},GunActor.prototype.addSoundEvent=function(animation,frame,sound){frame+=this.skeleton.getAnimationRange(animation).from;var event=new BABYLON.AnimationEvent(frame,function(){sound.play()});this.skeleton.bones[0].animations[0].addEvent(event)},GunActor.prototype.dispose=function(){this.gunMesh.dispose()},GunActor.prototype.stow=function(){var that=this;this.playerActor.gunContainer.getScene().beginAnimation(this.playerActor.gunContainer,0,25,!1,1,function(){that.gunMesh.setEnabled(!1),that.gun.equip()})},GunActor.prototype.equip=function(){this.gunMesh.setEnabled(!0),this.playerActor.setWeaponSkeleton(this.skeleton),this.skeleton.beginAnimation("fire"),this.playerActor.gunContainer.getScene().beginAnimation(this.playerActor.gunContainer,30,55,!1,1)},GunActor.prototype.dryFire=function(){this.dryFireSound.play()},GunActor.prototype.fire=function(){if(this.fireSound.play(),this.muzzleFlash){this.muzzleFlash.rotation.z=3.141*Math.random(),this.muzzleFlash.setEnabled(!0);var that=this;setTimeout(function(){that.muzzleFlash.setEnabled(!1)},40)}this.skeleton.beginAnimation("fire")},GunActor.prototype.reload=function(){this.gun.longReloadTime==this.gun.shortReloadTime?this.skeleton.beginAnimation("reload"):this.gun.ammo.rounds>0?this.skeleton.beginAnimation("shortReload"):this.skeleton.beginAnimation("longReload")},GunActor.prototype.update=function(){},(Eggk47Actor.prototype=Object.create(GunActor.prototype)).constructor=GunActor,(DozenGaugeActor.prototype=Object.create(GunActor.prototype)).constructor=GunActor,(CSG1Actor.prototype=Object.create(GunActor.prototype)).constructor=GunActor,(Cluck9mmActor.prototype=Object.create(GunActor.prototype)).constructor=GunActor,(RPEGGActor.prototype=Object.create(GunActor.prototype)).constructor=GunActor,ItemActor.prototype.update=function(delta){this.mesh.rotation.y+=.03*delta},ItemActor.prototype.remove=function(){this.mesh.setEnabled(!1)},(AmmoActor.prototype=Object.create(ItemActor.prototype)).constructor=ItemActor,(GrenadeItemActor.prototype=Object.create(ItemActor.prototype)).constructor=ItemActor,ItemManager.AMMO=0,ItemManager.GRENADE=1,ItemManager.Constructors=[AmmoActor,GrenadeItemActor],ItemManager.prototype.update=function(delta){for(var k=0;k<this.pools.length;k++)this.pools[k].forEachActive(function(item){item.update(delta),item.mesh.isVisible=isMeshVisible(item.mesh)})},ItemManager.prototype.spawnItem=function(id,kind,x,y,z){var item=this.pools[kind].retrieve(id);item.mesh.setEnabled(!0),item.mesh.position.x=x,item.mesh.position.y=y,item.mesh.position.z=z,testing&&item.mesh.freezeWorldMatrix()},ItemManager.prototype.collectItem=function(kind,id){this.pools[kind].recycle(this.pools[kind].objects[id]),this.pools[kind].objects[id].remove()},ItemRenderer.prototype.renderToCanvas=function(meshName,destCanvas,cam){this.engine.clear(),this.camera.alpha=0,this.camera.beta=Math.PI90,this.camera.radius=cam.radius||1;cam.y;var mesh=this.scene.getMeshByName(meshName).clone();cam.primaryGun?(mesh.rotation.x=-.7,mesh.position.y=-.1,mesh.position.z=-.1):cam.secondaryGun?(mesh.position.z=-.32,mesh.position.y=.05):(mesh.position.y=-.25,mesh.rotation.y=2,mesh.rotation.x=.25),mesh.computeWorldMatrix();var verts=mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);this.scene.updateTransformMatrix();for(var min={x:1e4,y:1e4},max={x:-1e4,y:-1e4},i=0;i<verts.length;i+=3){var sp=BABYLON.Vector3.Project(new BABYLON.Vector3(verts[i],verts[i+1],verts[i+2]),mesh.getWorldMatrix(),this.scene.getTransformMatrix(),this.camera.viewport.toGlobal(this.engine));min.x=Math.min(min.x,sp.x),max.x=Math.max(max.x,sp.x),min.y=Math.min(min.y,sp.y),max.y=Math.max(max.y,sp.y)}var cx=(max.x+min.x)/2-128,cy=(max.y+min.y)/2-128;mesh.position.z-=cx/512,mesh.position.y+=cy/512,this.scene.render(),mesh.dispose();var ctx=destCanvas.getContext("2d");ctx.clearRect(0,0,256,256),ctx.drawImage(this.canvas,0,0)},ItemRenderer.prototype.renderStampToCanvas=function(stampItem,destCanvas){var s=new BABYLON.Sprite("",this.stampSprites),x=stampItem.item_data.x,y=stampItem.item_data.y;s.cellIndex=x+16*y,s.size=1,this.camera.alpha=0,this.camera.beta=0,this.camera.radius=2.5,this.scene.render(),s.dispose();var ctx=destCanvas.getContext("2d");ctx.clearRect(0,0,256,256),ctx.drawImage(this.canvas,0,0)};var scene,engine,camera,customizer,itemRenderer,stampTexture,canvas,shadowGen,engineCaps,ws,selectedServer,meId,myTeam,username,gameStartTime,pingTotal,pingSamples,fpsTotal,fpsSamples,nextPingSample,uniqueId,uniqueKey,mapIdx,gameType,privateGame,firebaseUi,user,timesPlayed,chatInEl,chatOutEl,killEl,statsEl,purchasingEnabled,lastVer,globalXsollaToken,inGame=!1,playOffline=!1,mapTest={},settings={},nameTestCanvas=document.createElement("canvas"),freezeFrame=!1,createPrivateGame=!1,highestPing=0,playerAccount={},testing=!1,teamSummaryEls=[],loggingIn=!1,noSkybox=!1,debugArray=[],debugObject={},consent=void 0;window.onerror=function(msg,url,lineNo,columnNo,error){var str=["Message: "+msg,"URL: "+url,"Line: "+lineNo,"Column: "+columnNo].join("\n");return str+=JSON.stringify(error,["message","arguments","type","name"])+"\n",console.addLog(str),!1};var shellColors=["#ffffff","#c4e3e8","#e2bc8b","#d48e52","#cb6d4b","#8d3213","#5e260f"],inputToControlMap={W:"up",S:"down",A:"left",D:"right",SPACE:"jump","MOUSE 0":"fire",SHIFT:"scope",R:"reload",E:"weapon",Q:"grenade"};!function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",m.parentNode.insertBefore(a,m)}(window,document,"script",0,"ga"),ga("set","anonymizeIp",!isFromEU),ga("create","UA-105800112-1","auto"),ga("send","pageview"),window.addEventListener("contextmenu",function(e){e.preventDefault()},!1),window.onresize=function(){resize()},window.onload=function(){if(lastVer=getStoredString("lastVersionPlayed",version),localStorage.setItem("lastVersionPlayed",version),lastVer!=version){var req=window.indexedDB.deleteDatabase("babylonjs");req.onerror=function(event){window.location.reload(!0)},req.onsuccess=function(event){window.location.reload(!0)}}else{chatInEl=document.getElementById("chatIn"),chatOutEl=document.getElementById("chatOut"),killEl=document.getElementById("killTicker"),preLoadHouseBannerAd(),window.addEventListener("error",function(e){console.log(e)}),resize(),document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var str="",missingFeatures=0;if(BABYLON.Engine.isSupported()||(str+='<li>WebGL (<a href="https://shellshock.io/faq.html#webgl" target="_window">More info</a>)',missingFeatures++),(!document.exitPointerLock||navigator.userAgent.indexOf("10.1.2 Safari")>=0)&&(str+='<li>Pointer Lock (<a href="https://shellshock.io/faq.html#pointerlock" target="_window">More info</a>)',missingFeatures++),localStorage||(str+="<li>LocalStorage",missingFeatures++),void 0===new KeyboardEvent("").key&&(str+="<li>KeyboardEvent.key",missingFeatures++),missingFeatures>0)return str=1==missingFeatures?"Your browser is missing a feature that Shell Shockers requires:<br><ul>"+str+"</ul>":"Your browser is missing features that Shell Shockers requires:<br><ul>"+str+"</ul>",str+="Downloading the latest version of your browser of choice will usually correct this. Internet Explorer is not supported.",void openAlertDialog("Oh, no!",'<div style="text-align: left">'+str+"</div>");console.log("From EU: "+isFromEU),document.getElementById("privacyOptionsLink").style.display=isFromEU?"block":"none",selectedServer=getStoredNumber("selectedServer",0),gameType=getStoredNumber("gameType",GameType.ffa);for(var gameTypeSelect=document.getElementById("gameTypeSelect"),i=0;i<GameTypes.length;i++){var gt=GameTypes[i];gt.el=document.createElement("option"),gt.el.textContent=gt.longName,gameTypeSelect.appendChild(gt.el)}gameTypeSelect.selectedIndex=gameType,settings.volume=getStoredNumber("volume",1),settings.mouseSensitivity=Math.max(Math.min(11,getStoredNumber("mouseSensitivity",5)),0),settings.mouseInvert=getStoredNumber("mouseInvert",1),settings.holdToAim=getStoredBool("holdToAim",!0),settings.enableChat=getStoredBool("enableChat",!1),settings.autoDetail=getStoredBool("autoDetail",!0),settings.shadowsEnabled=getStoredBool("shadowsEnabled",!0),settings.highRes=getStoredBool("highRes",!0),document.getElementById("volume").value=settings.volume,document.getElementById("mouseSensitivity").value=settings.mouseSensitivity,document.getElementById("mouseInvert").checked=-1==settings.mouseInvert,document.getElementById("holdToAim").checked=settings.holdToAim,document.getElementById("enableChat").checked=settings.enableChat,document.getElementById("autoDetail").checked=settings.autoDetail,document.getElementById("shadowsEnabled").checked=settings.shadowsEnabled,document.getElementById("highRes").checked=settings.highRes,setDetailSettingsVisibility(settings.autoDetail);var storedControlMap=JSON.parse(localStorage.getItem("controlConfig"));for(var sk in storedControlMap)Object.keys(inputToControlMap).forEach(function(ik){inputToControlMap[ik]==storedControlMap[sk]&&delete inputToControlMap[ik]}),inputToControlMap[sk]=storedControlMap[sk];for(var p in inputToControlMap){var ps=""+p;inputToControlMap.hasOwnProperty(ps)&&ps!=ps.toLocaleUpperCase()&&(delete inputToControlMap[ps],inputToControlMap[ps.toLocaleUpperCase()]=inputToControlMap[p])}for(var k in inputToControlMap){var el=document.getElementById(inputToControlMap[k]);el&&(el.innerText=(""+k).toLocaleUpperCase(),el.style.fontWeight="bold",el.style.color="#fff")}for(var playerList=document.getElementById("playerList"),slotTemplate=document.getElementById("playerSlot"),i=0;i<20;i++){var slot=slotTemplate.cloneNode(!0);playerList.appendChild(slot)}for(var containerEl=document.getElementById("leaderboard"),team=0;team<3;team++){var teamEl=document.getElementById("teamSummary").cloneNode(!0);teamEl.style.color=teamColors.text[team],teamEl.style.backgroundColor=teamColors.summaryBackground[team],teamSummaryEls.push(teamEl);teamEl.children[0];for(i=0;i<20;i++){var rowEl=document.getElementById("teamRow").cloneNode(!0);rowEl.children[0].innerText=i+1,rowEl.style.display="flex",rowEl.style.background=i%2==0?"rgba(0, 0, 0, 0.25)":"transparent",teamEl.appendChild(rowEl)}containerEl.appendChild(teamEl)}if(firebase&&login(loggedIn,loginFail),itemRenderer=new ItemRenderer,canvas=document.getElementById("canvas"),engine=new BABYLON.Engine(canvas,!0,null,!1),engineCaps=engine.getCaps(),BABYLON.Engine.audioEngine.setGlobalVolume(settings.volume),0==settings.volume?BABYLON.Engine.audioEngine.audioContext.suspend():BABYLON.Engine.audioEngine.audioContext.resume(),settings.autoDetail||settings.highRes||lowerResolution(),"?openSettings"==window.location.search&&openSettingsMenu(),"?test"==window.location.search&&(testing=!0),"?noSkybox"==window.location.search&&(noSkybox=!0),window.location.search.startsWith("?testMap")){playOffline=!0;var params=window.location.search.split("&");mapTest.x=Number(params[1]),mapTest.y=Number(params[2]),mapTest.z=Number(params[3]),mapTest.pitch=Number(params[4]),mapTest.yaw=Number(params[5])}window.location.hash&&(openJoinBox(),document.getElementById("joinCode").value=window.location.hash.substr(1)),aiptag.cmd.player.push(function(){aipPrerollPlayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,AD_CENTERPLAYER:!1,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:function(){hideDarkOverlay(),inGame?timedGame&&(openGameMenu(),showGameSummary(),resetGame()):joinGame(),BABYLON.Engine.audioEngine.setGlobalVolume(settings.volume)},AIP_REMOVE:function(){BABYLON.Engine.audioEngine.setGlobalVolume(settings.volume)}})});var loginBox=document.getElementById("username");loginBox.value=getStoredString("lastUsername",""),loginBox.addEventListener("keyup",function(event){loginBox.value=fixStringWidth(event.target.value),"Enter"!=event.code&&13!=event.keyCode||loginBox.value.length>0&&(loginBox.disabled=!0,play())}),playOffline?(ws={send:function(){}},inGame=!0,engine.stopRenderLoop(),startGame()):pingServers(!0,function(){hideSpinner(),showMainMenu()})}},window.onbeforeunload=function(e){if(gameStartTime>0){var timePlayed=Date.now()-gameStartTime;if(ga("send","timing","game","play time",timePlayed),fbq("trackCustom","EndGame",{timePlayed:timePlayed}),me&&kills>0){var ratio=Math.floor(kills/Math.max(kills+deaths,1)*100);ga("send","event","player stats","kill ratio",classes[me.charClass].name,ratio),ga("send","event","player stats","best kill streak",classes[me.charClass].name,bestOverallStreak)}}pingSamples>4&&(ga("send","timing","game","ping",Math.floor(pingTotal/pingSamples),servers[selectedServer].name),ga("send","event","game","stats","fps",Math.ceil(fpsTotal/fpsSamples)),ga("send","event","game","settings","volume",settings.volume),ga("send","event","game","settings","mouse sensitivity",settings.mouseSensitivity),ga("send","event","game","settings","mouse invert",settings.mouseInvert))};var feedbackValidateTimeout,controlEl,alertBarInterval;document.onfullscreenchange=onFullscreenChange,document.onmsfullscreenchange=onFullscreenChange,document.onmozfullscreenchange=onFullscreenChange,document.onwebkitfullscreenchange=onFullscreenChange;var shake,interval={intervals:{},set:function(func,delay){var newInterval=setInterval.apply(window,[func,delay].concat([].slice.call(arguments,2)));return interval.intervals[newInterval]=!0,newInterval},clear:function(handle){return delete interval.intervals[handle],clearInterval(handle)},clearAll:function(){for(var all=Object.keys(interval.intervals),len=all.length;len-- >0;)clearInterval(all.shift());interval.intervals={}}},timeout={timeouts:{},set:function(func,delay){var newTimeout=setTimeout.apply(window,[func,delay].concat([].slice.call(arguments,2)));return timeout.timeouts[newTimeout]=!0,newTimeout},clear:function(handle){return delete timeout.timeouts[handle],clearTimeout(handle)},clearAll:function(){for(var all=Object.keys(timeout.timeouts),len=all.length;len-- >0;)clearTimeout(all.shift());timeout.timeouts={}}},playerAccount=new function(){this.loggedOut=function(){this.firebaseId=null,this.session=null,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.classIdx=0,this.inventory=[],this.pickedWeapons=[],this.stampItem=null,this.hatItem=null,this.colorIdx=0,this.isLoggedIn=!1;for(var cIdx=0;cIdx<classes.length;cIdx++){var defaultPicks=[catalog.forClass[cIdx].primaryWeapons[0],catalog.forClass[cIdx].secondaryWeapons[0]];this.pickedWeapons.push(defaultPicks)}},this.setClass=function(classIdx){this.classIdx=classIdx},this.pickWeapon=function(slot,weaponItem){!1===catalog.findItemInListById(weaponItem,catalog.forClass[this.classIdx].forWeaponSlot[slot])&&(weaponItem=catalog.forClass[this.classIdx].forWeaponSlot[slot][0]),this.pickedWeapons[this.classIdx][slot]=weaponItem},this.getPickedWeaponInSlot=function(slot){return this.pickedWeapons[this.classIdx][slot]},this.getPrimaryWeapon=function(){return this.getPickedWeaponInSlot(Slot.Primary)},this.getSecondaryWeapon=function(){return this.getPickedWeaponInSlot(Slot.Secondary)},this.isItemOwned=function(item){for(var i=0;i<this.inventory.length;i++)if(this.inventory[i].id===item.id)return!0;return!1},this.getEquippedItems=function(){var equippedItems=[this.getPrimaryWeapon(),this.getSecondaryWeapon()];return null!==this.hatItem&&equippedItems.push(this.hatItem),null!==this.stampItem&&equippedItems.push(this.stampItem),equippedItems},this.isItemEquipped=function(item){return null!==item&&null!==catalog.findItemInListById(item.id,this.getEquippedItems())},this.loggedIn=function(accountData){this.firebaseId=accountData.firebaseId,this.session=accountData.session,this.kills=accountData.kills,this.deaths=accountData.deaths,this.streak=accountData.streak,this.currentBalance=accountData.currentBalance,this.ownedItemIds=accountData.ownedItemIds;var hasValue=function(a){return void 0!==a&&null!==a&&0!==a};if((void 0===accountData.version||null===accountData.version?1:accountData.version)>=1){if(void 0!==accountData.loadout&&null!==accountData.loadout){void 0!==accountData.loadout.classIdx&&null!==accountData.loadout.classIdx&&accountData.loadout.classIdx<=2&&this.setClass(accountData.loadout.classIdx);for(var outer=this,trySetPickedWeapon=function(weaponId,classIdx,slot){var weaponItem=catalog.forClass[classIdx].forWeaponSlot[slot][0];hasValue(weaponId)&&(weaponItem=catalog.findItemById(weaponId)),outer.pickedWeapons[classIdx][slot]=weaponItem},c=0;c<classes.length;c++)trySetPickedWeapon(accountData.loadout.primaryId[c],c,Slot.Primary),trySetPickedWeapon(accountData.loadout.secondaryId[c],c,Slot.Secondary);if(hasValue(accountData.loadout.hatId)){var hatItem=catalog.findItemById(accountData.loadout.hatId);this.hatItem=hatItem}if(hasValue(accountData.loadout.stampId)){var stampItem=catalog.findItemById(accountData.loadout.stampId);this.stampItem=stampItem}hasValue(accountData.loadout.colorIdx)&&(this.colorIdx=accountData.loadout.colorIdx)}if(hasValue(accountData.ownedItemIds))for(var i=0;i<accountData.ownedItemIds.length;i++){var item=catalog.findItemById(accountData.ownedItemIds[i]);this.inventory.push(item)}}this.isLoggedIn=!0},this.syncToServer=function(){try{var servicesWs=new WebSocket(servicesServer)}catch(e){console.log(e)}var updateHatId=void 0!==playerAccount.hatItem&&null!==playerAccount.hatItem?playerAccount.hatItem.id:null,updateStampId=void 0!==playerAccount.stampItem&&null!==playerAccount.stampItem?playerAccount.stampItem.id:null,json=JSON.stringify({cmd:"saveEquip",dbId:this.firebaseId,class_idx:this.classIdx,soldier_primary_item_id:this.pickedWeapons[Class.Soldier][Slot.Primary].id,soldier_secondary_item_id:this.pickedWeapons[Class.Soldier][Slot.Secondary].id,scrambler_primary_item_id:this.pickedWeapons[Class.Scrambler][Slot.Primary].id,scrambler_secondary_item_id:this.pickedWeapons[Class.Scrambler][Slot.Secondary].id,ranger_primary_item_id:this.pickedWeapons[Class.Ranger][Slot.Primary].id,ranger_secondary_item_id:this.pickedWeapons[Class.Ranger][Slot.Secondary].id,hat_id:updateHatId,stamp_id:updateStampId,color:this.colorIdx});servicesWs.onopen=function(e){servicesWs.send(json),console.log("servicesWs opened, and saveEquip request sent")},servicesWs.onmessage=function(e){responseData=JSON.parse(e.data),responseData.error?console.log("SyncToServer Error: "+JSON.stringify(responseData.error)):console.log("SyncToServer completed successfully"),servicesWs.close()},servicesWs.onclose=function(e){console.log("servicesWs closed: "+e.code+" "+e.reason)},servicesWs.onerror=function(e){console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"]))}},this.loggedOut()};return PlayerActor.prototype.wearHat=function(hatItem){this.removeHat(),null!==hatItem&&(this.hat=scene.cloneMesh(hatItem.item_data.meshName,this.bodyMesh),this.hat.position.y=-.02)},PlayerActor.prototype.removeHat=function(){void 0!==this.hat&&null!==this.hat&&this.hat.dispose()},PlayerActor.prototype.applyStamp=function(stampItem){this.removeStamp(),null!==stampItem&&(this.bodyMesh.stampU=stampItem.item_data.x/16,this.bodyMesh.stampV=1-stampItem.item_data.y/16)},PlayerActor.prototype.removeStamp=function(){this.bodyMesh.stampU=0,this.bodyMesh.stampV=1},PlayerActor.prototype.drawTextOnNameTexture=function(text,x,y,size,color,center){var shadowCoords=[{x:0,y:-4},{x:-4,y:0},{x:4,y:0},{x:0,y:4}],coords=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}];x+=this.player.id%4*512,y=-y+(2048-256*Math.floor(this.player.id/4)),center&&(x+=256-getFloatingNameWidth(text,size)/2);for(i=0;i<4;i++)nameTexture.drawText(text,x+shadowCoords[i].x,y+shadowCoords[i].y,"bold "+size+"px Nunito, sans-serif","rgba(0, 0, 0, 0.5)","transparent");for(var i=0;i<4;i++)nameTexture.drawText(text,x+coords[i].x,y+coords[i].y,"bold "+size+"px Nunito, sans-serif",color,"transparent")},PlayerActor.prototype.setupNameSprite=function(){var tx=this.player.id%4*512,ty=2048-256*Math.floor(this.player.id/4);nameTexture.clearRect(tx,ty-256,512,256),this.drawTextOnNameTexture(this.player.name,0,32,60,"white",!0)},PlayerActor.prototype.updateTeam=function(){this.player.id==meId||(this.player.team>0?(this.player.team==myTeam?this.bodyMesh.outlineColor=teamColors.outline[this.player.team].clone():this.bodyMesh.outlineColor.a=0,this.nameSprite&&(this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.color=teamColors.outline[this.player.team])):this.bodyMesh.outlineColor.a=0)},PlayerActor.prototype.update=function(delta){var bcos=Math.cos(this.player.bobble)*this.bobbleIntensity,bsina=Math.abs(Math.sin(this.player.bobble)*this.bobbleIntensity),bsin=Math.sin(2*this.player.bobble)*this.bobbleIntensity;if(this.player.shield>0){var alpha=.7*Math.random()+.2;this.bodyMesh.overlayAlpha=alpha,this.hands.overlayAlpha=alpha}if(this.player.id==meId)this.scope&&this.player.isAtReady(!0)?(camera.fov=camera.fov+(this.player.weapon.actor.scopeFov-camera.fov)/3,this.gunContainer.rotation.y*=.667,this.gunContainer.rotation.x*=.667,this.gunContainer.position.x+=(-.25-this.gunContainer.position.x)/3,this.gunContainer.position.y+=(this.player.weapon.actor.scopeY-this.gunContainer.position.y)/4,this.gunContainer.position.z+=(-.05-this.gunContainer.position.z)/3,this.player.weapon.hasScope&&!this.zoomed&&camera.fov<this.player.weapon.actor.scopeFov+.05&&(scope.show(),this.gunContainer.setEnabled(!1),this.zoomed=!0)):(camera.fov=camera.fov+(1.25-camera.fov)/3,this.gunContainer.rotation.y+=(2*bcos-.14-this.gunContainer.rotation.y)/3,this.gunContainer.rotation.x+=(.75*bsin-.035-this.gunContainer.rotation.x)/3,this.gunContainer.position.x*=.667,this.gunContainer.position.y*=.667,this.gunContainer.position.z*=.667,this.zoomed&&camera.fov>this.player.weapon.actor.scopeFov+.05&&(scope.hide(),this.gunContainer.setEnabled(!0),this.zoomed=!1));else if(this.player.team>0&&this.player.team==myTeam&&this.nameSprite){var dist=Math.length3(this.player.x-me.x,this.player.y-me.y,this.player.z-me.z),fac=Math.pow(dist,1.25);this.nameSprite.width=fac/10+.6,this.nameSprite.height=fac/20+.3}var dx=this.player.x-this.mesh.position.x,dy=this.player.y-this.mesh.position.y,dz=this.player.z-this.mesh.position.z,dist=Math.length3(dx,dy,dz);this.player.id==meId?(this.mesh.position.x+=dx/2,this.mesh.position.y+=dy/2,this.mesh.position.z+=dz/2):(this.mesh.position.x+=dx/6,this.mesh.position.y+=dy/2,this.mesh.position.z+=dz/6);var diffYaw=Math.radDifference(this.player.yaw,this.mesh.rotation.y),diffPitch=Math.radDifference(this.player.pitch,this.head.rotation.x);this.player.addRotationShotSpread(diffYaw,diffPitch),this.mesh.rotation.y=this.player.yaw,this.head.rotation.x=this.player.pitch,this.bodyMesh.rotation.x=this.head.rotation.x/4;var bobbleTarget;if(bobbleTarget=this.player.jumping?0:Math.length3(this.player.dx,this.player.dy,this.player.dz),this.bobbleIntensity+=(bobbleTarget-this.bobbleIntensity)/10,this.bodyMesh.rotation.z=5*bcos,this.bodyMesh.position.y=1.5*bsina+.32,shake>0)if((shake*=.9)<.001)shake=0;else{var x=Math.random()*shake-.5*shake,y=Math.random()*shake-.5*shake,z=Math.random()*shake-.5*shake;this.eye.rotation.x+=(x-this.eye.rotation.x)/10,this.eye.rotation.y+=(y-this.eye.rotation.y)/10,this.eye.rotation.z+=(z-this.eye.rotation.z)/10}else this.eye.rotation.x*=.9,this.eye.rotation.y*=.9,this.eye.rotation.z*=.9;if(this.player.id!=meId){var visible=isMeshVisible(this.mesh,.31);this.mesh.setVisible(visible),visible?this.showNameSprite():this.hideNameSprite(),this.nameSprite&&this.positionNameSprite()}this.hitSoundDelay=Math.max(this.hitSoundDelay-delta,0)},PlayerActor.prototype.positionNameSprite=function(){if(this.nameSprite){var mp=this.mesh.position.clone();mp.y+=.5*this.nameSprite.height+.65;var v=new BABYLON.Vector3(camera.globalPosition.x-mp.x,camera.globalPosition.y-mp.y,camera.globalPosition.z-mp.z).normalize();v.scaleInPlace(.4),v.addInPlace(mp),this.nameSprite.position=v}},PlayerActor.prototype.showNameSprite=function(){this.player.playing&&!this.nameSprite&&(this.nameSprite=new BABYLON.Sprite("",nameSprites),this.nameSprite.invertV=!0,this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.cellIndex=this.player.id,this.nameSprite.color=teamColors.outline[this.player.team])},PlayerActor.prototype.hideNameSprite=function(){this.nameSprite&&(this.nameSprite.dispose(),this.nameSprite=null)},PlayerActor.prototype.scopeIn=function(){this.scope=!0},PlayerActor.prototype.scopeOut=function(){this.scope=!1},PlayerActor.prototype.hit=function(){this.hitSoundDelay<=0&&(this.hitSound.play(),this.hitSoundDelay=10)},PlayerActor.prototype.removeFromPlay=function(){this.scope=!1,this.zoomed=!1,this.throwingGrenade=!1,this.gripBone._frozen=!1,this.bodyMesh.setEnabled(!1),this.head.setEnabled(!1),this.eye.setEnabled(!1),this.gunContainer.setEnabled(!1),this.hideNameSprite()},PlayerActor.prototype.restoreToPlay=function(){this.bodyMesh.setEnabled(!0),this.head.setEnabled(!0),this.eye.setEnabled(!0),this.gunContainer.setEnabled(!0),this.player.id!=meId&&this.showNameSprite(),this.explodeMesh.setEnabled(!1),this.whiteMesh.setEnabled(!1),this.yolkMesh.setEnabled(!1)},PlayerActor.prototype.remove=function(){this.mesh.disposeOfSounds(),this.mesh.dispose(),this.hideNameSprite()},PlayerActor.prototype.fire=function(){this.zoomed&&this.player.weapon.hasScope&&(shake=.25,this.eye.rotation.x=-.1)},PlayerActor.prototype.reachForGrenade=function(){var that=this;this.throwingGrenade=!0,this.gripBone._frozen=!0,this.hands.skeleton.enableBlending(.2),this.hands.skeleton.beginAnimation("grenade_grab",!1,1,function(){that.hands.skeleton&&that.hands.skeleton.disableBlending()})},PlayerActor.prototype.throwGrenade=function(){var that=this;this.player.id==meId&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.hands.skeleton.beginAnimation("grenade_throw",!1,1,function(){that.hands.skeleton&&(that.throwingGrenade=!1,that.gripBone._frozen=!1)})},PlayerActor.prototype.setShellColor=function(colorIdx){var color=BABYLON.Color3.FromHexString(shellColors[colorIdx]);this.bodyMesh.colorMult=color,this.hands.colorMult=color},PlayerActor.prototype.setWeaponSkeleton=function(skeleton){this.skeleton=skeleton,this.weaponGripBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("gripHand")],this.weaponForeBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("foreHand")]},PlayerActor.prototype.handsToWeaponSkeleton=function(){this.gripBone.position=this.weaponGripBone.position,this.gripBone.setRotationQuaternion(this.weaponGripBone.rotationQuaternion),1!=this.throwingGrenade&&(this.foreBone.position=this.weaponForeBone.position,this.foreBone.setRotationQuaternion(this.weaponForeBone.rotationQuaternion))},PlayerActor.prototype.setupStowAnims=function(){var gunRotationAnimation=new BABYLON.Animation("","rotation",60,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),gunScaleAnimation=new BABYLON.Animation("","scaling",60,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),gunPositionAnimation=new BABYLON.Animation("","position",60,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),gunRotationEase=new BABYLON.CubicEase;gunRotationEase.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),gunRotationAnimation.setEasingFunction(gunRotationEase);var gunScaleEase=new BABYLON.CubicEase;gunScaleEase.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),gunScaleAnimation.setEasingFunction(gunScaleEase);var gunPositionEase=new BABYLON.CubicEase;gunPositionEase.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT),gunPositionAnimation.setEasingFunction(gunPositionEase);var gunRotationKeys=[{frame:0,value:new BABYLON.Vector3(-.035,-.14,0)},{frame:25,value:new BABYLON.Vector3(1,-1.5,0)},{frame:30,value:new BABYLON.Vector3(-1,-1.5,0)},{frame:55,value:new BABYLON.Vector3(-.035,-.14,0)}],gunScaleKeys=[{frame:0,value:new BABYLON.Vector3(1,1,1)},{frame:25,value:new BABYLON.Vector3(.25,.25,.25)},{frame:30,value:new BABYLON.Vector3(.25,.25,.25)},{frame:55,value:new BABYLON.Vector3(1,1,1)}],gunPositionKeys=[{frame:0,value:new BABYLON.Vector3(0,0,0)},{frame:25,value:new BABYLON.Vector3(.1,.1,-.2)},{frame:30,value:new BABYLON.Vector3(.1,0,-.2)},{frame:55,value:new BABYLON.Vector3(0,0,0)}];gunRotationAnimation.setKeys(gunRotationKeys),gunScaleAnimation.setKeys(gunScaleKeys),gunPositionAnimation.setKeys(gunPositionKeys),this.gunContainer.animations.push(gunRotationAnimation),this.gunContainer.animations.push(gunScaleAnimation),this.gunContainer.animations.push(gunPositionAnimation)},RocketActor.prototype.fire=function(){this.rocket.player.id==meId?this.delayFrames=Math.ceil(ping/17)+5:this.delayFrames=5,this.mesh.position.x=this.rocket.x,this.mesh.position.y=this.rocket.y,this.mesh.position.z=this.rocket.z,this.mesh.lookAt(new BABYLON.Vector3(this.rocket.x+this.rocket.dx,this.rocket.y+this.rocket.dy,this.rocket.z+this.rocket.dz)),this.mesh.rotation.x+=.015,this.mesh.rotation.y-=.015,this.mesh.scaling.z=.5},RocketActor.prototype.update=function(){--this.delayFrames<=0&&this.mesh.setEnabled(!0),this.mesh.position.x=this.rocket.x,this.mesh.position.y=this.rocket.y,this.mesh.position.z=this.rocket.z},RocketActor.prototype.remove=function(){this.mesh.setEnabled(!1)},BABYLON.Effect.ShadersStore.standardVertexShader="\n#include<instancesDeclaration>\n#include<bonesDeclaration>\n\nprecision lowp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 view;\nuniform mat4 viewProjection;\nuniform mat4 shadowLightMat;\nuniform vec3 cameraPosition;\nuniform vec3 colorMult;\n\n// Varying\nvarying vec4 vPositionFromLight;\nvarying vec3 vPositionFromCamera;\nvarying vec3 vNormal;\nvarying vec4 vColor;\nvarying vec4 vEmissiveColor;\nvarying float fFogDistance;\n\n#ifdef EGGSHELL\n\tvarying vec2 vUV;\n#endif\n\nfloat random(vec3 p)\n{\n    vec3 K1 = vec3(23.14069263277926, 2.665144142690225, 8.2318798443);\n    return fract(cos(dot(p, K1)) * 12345.6789);\n}\n\n// MAIN\nvoid main(void) {\n\t#include<instancesVertex>\n\t#include<bonesVertex>\n\tvec4 worldPosition = finalWorld * vec4(position, 1.);\n\n\t#ifdef RECEIVESHADOWS\n\t\tvPositionFromLight = shadowLightMat * worldPosition;\n\t#endif\n\n\tvNormal = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\tvColor = color;\n\t\n\t#ifdef COLORMULT\n\t\tvColor.rgb *= colorMult;\n\t#endif\n\n\t#ifdef DIRT\n\t\tvColor.rgb *= random(floor(worldPosition.xyz + vec3(0.5, 0.5, 0.5))) * 0.2 + 0.7;\n\t#endif\n\n\tfFogDistance = (view * worldPosition).z;\n\tgl_Position = viewProjection * worldPosition;\n\n\t#ifdef EGGSHELL\n\t\tvUV = uv;\n\t\tvPositionFromCamera = normalize(cameraPosition - worldPosition.xyz);\n\t#endif\n}\n",BABYLON.Effect.ShadersStore.standardPixelShader="\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\n\nprecision lowp float;\n\n// Uniforms\nuniform sampler2D shadowSampler;\nuniform vec3 shadowParams;\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nuniform vec3 emissiveColor;\nuniform mat4 worldView;\nuniform float hp;\nuniform vec3 colorMult;\nuniform vec4 outlineColor;\nuniform sampler2D textureSampler;\nuniform vec2 stampOffset;\n\n// Varying\nvarying vec4 vPositionFromLight;\nvarying vec3 vPositionFromCamera;\nvarying vec4 vColor;\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying float fFogDistance;\n\nconst float sOff = .001;\n\n// FUNCTIONS\nfloat unpack(vec4 color)\n{\n\tconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\n\treturn dot(color, bit_shift);\n}\n\nfloat random(vec2 p)\n{\n    vec2 K1 = vec2(23.14069263277926, 2.665144142690225);\n    return fract(cos(dot(p, K1)) * 12345.6789);\n}\n\nfloat calcFogFactor()\n{\n\tfloat fogCoeff = 1.0;\n\tfloat fogStart = vFogInfos.y;\n\tfloat fogEnd = vFogInfos.z;\n\tfloat fogDensity = vFogInfos.w;\n\n\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity * 4.); // Exp2\n\n\treturn clamp(fogCoeff, 0.0, 1.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tdepth = 0.5 * depth + vec3(0.5);\n\tvec2 uv = depth.xy;\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\t#ifndef SHADOWFULLFLOAT\n\t\tfloat shadow = unpack(texture2D(shadowSampler, uv));\n\t#else\n\t\tfloat shadow = texture2D(shadowSampler, uv).x;\n\t#endif\n\n\tif (depth.z < shadow) return 1.;\n\tfloat s = clamp((depth.z - shadow) * 12. + 0.5, 0.5, 1.0);\n\treturn min(1.0, max(s, length(vPositionFromLight.xy)));\n}\n\nvec3 desaturate(vec3 color, float amount)\n{\n    vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n    return vec3(mix(color, gray, amount));\n}\n\n// MAIN\nvoid main(void)\n{\n\tvec4 color = vColor;\n\n\t#ifdef EGGSHELL // Show cracks and stamp texture!\n\t\tcolor.rgb = min((color.rgb - 0.5) * 4. + hp + 2., 1.);\n\t\tcolor.rgb *= colorMult;\n\t\tvec2 uv = clamp(vUV, vec2(0., 0.9375), vec2(.0625, 1.));\n\t\tuv += stampOffset;\n\t\tcolor.rgb = mix(color.rgb, texture2D(textureSampler, uv).rgb, texture2D(textureSampler, uv).a);\n\t#endif\n\n\t#ifdef RECEIVESHADOWS\n\t\tfloat s = computeShadow(vPositionFromLight, shadowSampler, shadowParams.x);\n\t\tcolor *= vec4(s, s, s, 1.);\n\t#endif\n\n\tcolor.rgb *= max(max(0., -vNormal.y * 0.4), dot(vNormal, normalize(vec3(.2, 1., .1)) * 1.) + 0.4);\n\t//color.rgb *= max(0., dot(vNormal, normalize(vec3(-.2, 1., -.1))) + 0.4);\n\n\t#ifdef FLASH\n\t\tcolor.rgb += emissiveColor;\n\t#endif\n\n\tfloat fog = calcFogFactor();\n\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n\n\t#ifdef EGGSHELL\n\t\tfloat f = step(dot(vNormal, vPositionFromCamera), 0.4);\n\t\tcolor.rgb = mix(color.rgb, outlineColor.rgb, f * outlineColor.a);\n\t#endif\n\n\tgl_FragColor = color;\n}\n",{openLoginDialog:openLoginDialog,logout:function(callback){firebase.auth().signOut().then(function(){document.getElementById("login").style.display="block",document.getElementById("logout").style.display="none",document.getElementById("profilePic").style.display="none",document.getElementById("playerStats").style.display="none",document.getElementById("statsMessage").style.display="none",document.getElementById("currentBalanceContainer").style.display="none",document.getElementById("currentBalance").innerText="0",playerAccount.loggedOut(),user=null,customizer.dressUpEgg()},function(err){console.log(err)})},play:play,openServerList:function(){openAlertDialog("Servers","",{label:"Close",width:"6em",onclick:closeServerList});for(var serverItem=document.getElementById("serverItem"),list=document.createElement("form"),barColors=["lime","yellow","orange","red"],i=0;i<servers.length;i++){var server=serverItem.cloneNode(!0);server.style.display="block";var checkEl=server.children[0].children[0],nameEl=server.children[0].children[1],barEl=(server.children[0].children[2],server.children[0].children[3]),offlineEl=server.children[0].children[4],msEl=server.children[0].children[5];nameEl.innerText=servers[i].name,checkEl.value=i;var border,pingColor;servers[i].ping?(border=Math.min(5.4,Math.max(0,(servers[i].ping-50)/65))+.1,pingColor=Math.min(3,Math.floor(servers[i].ping/100)),barEl.style.display="block",offlineEl.style.display="none",barEl.style.backgroundColor=barColors[pingColor],barEl.style.borderRight=border+"em solid var(--egg-brown)",msEl.innerText=servers[i].ping+"ms"):(barEl.style.display="none",offlineEl.style.display="block"),list.appendChild(server)}document.getElementById("alertMessage").appendChild(list),list.children[selectedServer].children[0].children[0].checked=!0,list.addEventListener("change",function(e){selectServer(e.target.value)})},openCustomizerFromMainMenu:openCustomizerFromMainMenu,openCustomizerInGame:function(){hideGameDom(),engine.stopRenderLoop(),scene=customizer.scene,customizer.open(),customizer.startRendering()},showFeedbackForm:function(){inGame&&releaseKeys(),ga("send","event","feedback opened"),openAlertDialog("Feedback","",{label:"Send",width:"6em",onclick:sendFeedback},{label:"Cancel",width:"6em",onclick:closeFeedback}),document.getElementById("alertButton1").style.visibility="hidden",document.getElementById("alertMessage").appendChild(document.getElementById("feedback")),document.getElementById("feedback").style.display="block"},feedbackChanged:function(e){var fd=document.getElementById("feedbackComments"),fe=document.getElementById("feedbackEmail");feedbackValidateTimeout&&clearTimeout(feedbackValidateTimeout),feedbackValidateTimeout=setTimeout(function(){""!=fd.value&&""!=fe.value?document.getElementById("alertButton1").style.visibility="visible":document.getElementById("alertButton1").style.visibility="hidden"},200)},selectGameType:function(i){gameType=i,localStorage.setItem("gameType",i)},openJoinBox:openJoinBox,closeJoinBox:function(){document.getElementById("customGame").style.display="block",document.getElementById("joinGame").style.display="none",document.getElementById("joinCode").value="",history.replaceState(null,null,location.pathname)},showChangelog:function(){ga("send","event","view changelog"),openAlertDialog("Version "+version,document.getElementById("changelog").innerHTML,{label:"OK"})},respawn:function(){if(playOffline)return me.playing=!0,void canvas.requestPointerLock();console.log("Respawn pressed - respawnTime: "+respawnTime),(null==respawnTime||respawnTime<0)&&(interval.clearAll(),timeout.clearAll(),timedGame?requestRespawn():isTimeToPlayVideoAd()?playVideoAd():requestRespawn())},copyFriendCode:copyFriendCode,dismissNotification:dismissNotification,closeSettingsMenu:closeSettingsMenu,setVolume:function(el){settings.volume=el.value,localStorage.setItem("volume",settings.volume),BABYLON.Engine.audioEngine.setGlobalVolume(settings.volume),0==settings.volume?BABYLON.Engine.audioEngine.audioContext.suspend():BABYLON.Engine.audioEngine.audioContext.resume()},setMusicVolue:function(el){settings.musicVolume=el.value,localStorage.setItem("musicVolume",settings.musicVolume),Music.menu&&Music.menu.setVolume(el.value),Music.game&&Music.game.setVolume(el.value)},setMouseSensitivity:function(el){settings.mouseSensitivity=el.value,localStorage.setItem("mouseSensitivity",settings.mouseSensitivity)},setCheckOption:function(el){var val=el.checked;switch(el.id){case"mouseInvert":val=el.checked?-1:1;break;case"autoDetail":el.checked?enableAutoDetail():disableAutoDetail(),setDetailSettingsVisibility(el.checked);break;case"shadowsEnabled":el.checked?enableShadows():disableShadows();break;case"highRes":el.checked?increaseResolution():lowerResolution();break;case"enableChat":el.checked?enableChat():disableChat()}settings[el.id]=val,localStorage.setItem(el.id,val)},openPrivacyOptions:function(){closeSettingsMenu(),openAlertDialog("Privacy Options",document.getElementById("privacyOptions").innerHTML,{label:"OK"});var ofAgeCheck=document.getElementById("ofAgeCheck"),targetedAdsCheck=document.getElementById("targetedAdsCheck");consent?(ofAgeCheck.checked=consent.ofAge,targetedAdsCheck.checked=consent.targetedAds):(consent={ofAge:!1,targetedAds:!1},ofAgeCheck.checked=!1,targetedAdsCheck.checked=!1),consent.ofAge||(targetedAdsCheck.disabled=!0,document.getElementById("targetedAdsText").style.opacity=.25)},switchTeamDialog:function(){openAlertDialog("",1==me.team?'Switch to team<h1 class="redTeam">RED?</h1>Your score will be reset!':'Switch to team<h1 class="blueTeam">BLUE?</h1>Your score will be reset!',{label:"Yes",width:"5em",onclick:switchTeam},{label:"No",width:"5em",onclick:closeAlertDialog})},showMainMenuConfirm:showMainMenuConfirm,inviteFriends:inviteFriends,openSettingsMenu:openSettingsMenu,toggleFullscreen:function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)(f=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)&&f.call(document);else{var e=document.body,f=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen;f&&(f.call(e),ga("send","event","fullscreen"))}},hideBigAd:hideBigAd,clickedBigAd:function(){ga("send","event",{eventCategory:"Big ad",eventAction:"click",eventLabel:bigAds[bigAdIdx].label})},doConsent:function(){dismissNotification(function(){notify(document.getElementById("doConsent").innerHTML)}),ga("send","event","privacy","age gate","agree"),consent={ofAge:!0,targetedAds:!0},document.getElementById("login").style.display="block",aiptag.consented=!0,localStorage.setItem("consent",JSON.stringify(consent))},dontConsent:function(){dismissNotification(function(){notify(document.getElementById("dontConsent").innerHTML)}),ga("send","event","privacy","age gate","disagree"),consent={ofAge:!1,targetedAds:!1},aiptag.consented=!1,localStorage.setItem("consent",JSON.stringify(consent))},setOfAge:function(e){var targetedAdsCheck=document.getElementById("targetedAdsCheck"),targetedAdsText=document.getElementById("targetedAdsText");consent.ofAge=e.checked,ga("send","event","privacy","of age",e.checked?"yes":"no"),e.checked?(targetedAdsCheck.disabled=!1,targetedAdsText.style.opacity=1,document.getElementById("login").style.display="block"):(consent.targetedAds=!1,targetedAdsCheck.checked=!1,targetedAdsCheck.disabled=!0,targetedAdsText.style.opacity=.25,aiptag.consented=!1,document.getElementById("login").style.display="none"),localStorage.setItem("consent",JSON.stringify(consent))},setTargetedAds:function(e){consent.targetedAds=e.checked,aiptag.consented=e.checked,ga("send","event","privacy","targetedAds",e.checked?"yes":"no"),localStorage.setItem("consent",JSON.stringify(consent))},configKey:function(e){var el=e.target;e=e||window.event,el==controlEl?(1==e.button&&window.event.preventDefault(),el.style.fontWeight="bold",el.style.color="#fff",el.innerText="MOUSE "+e.button,setControl(el)):(controlEl&&(controlEl.style.fontWeight="bold",controlEl.style.color="#fff",controlEl.innerText=controlEl.oldText),el.oldText=el.innerText,el.style.fontWeight="normal",el.style.color="#edc",el.innerText="Press key or button",controlEl=el,el.focus(),inGame&&releaseKeys(),window.onkeydown=function(e){var key=(e=e||window.event).key;if("Escape"!=key&&"Tab"!=key&&"Enter"!=key)return" "==key&&(key="space",e.preventDefault()),el.style.fontWeight="bold",el.style.color="#fff",el.innerText=key.toLocaleUpperCase(),setControl(el),e.stopPropagation(),!1;el.style.fontWeight="bold",el.style.color="#fff",el.innerText=el.oldText,controlEl=null},window.onkeyup=function(e){return e.stopPropagation(),!1})},onChatKeyDown:function(e){var key=(e=e||window.event).key;switch(chatInEl.value=fixStringWidth(chatInEl.value,280),key){case"Enter":var text=chatInEl.value.trim();if(""!=text&&text.indexOf("<")<0){var output=new Comm.output(2+2*text.length);output.packInt8(CommCode.chat),output.packString(text),ws.send(output.buffer),addChat(text,me),me.chatLineCap--}case"Tab":initChatIn(),e.preventDefault(),e.stopPropagation(),captureKeys()}},clickedHouseAd:function(){ga("send","event",{eventCategory:"House banner ad",eventAction:"click",eventLabel:smallAds[smallAdIdx].label}),smallAds[smallAdIdx].link&&window.open(smallAds[smallAdIdx].link,"_window"),smallAds[smallAdIdx].linksToItemId&&openItemInCustomizer(smallAds[smallAdIdx].linksToItemId)},buyItem:function(itemId){console.log("buyItem called for item ID: "+itemId);try{var servicesWs=new WebSocket(servicesServer)}catch(e){console.log(e)}servicesWs.onopen=function(e){servicesWs.send(JSON.stringify({cmd:"buy",uid:playerAccount.firebaseId,item_id:itemId}))},servicesWs.onmessage=function(e){switch(purchaseResult=JSON.parse(e.data),console.log("purchase response: "+purchaseResult.result),purchaseResult.result){case"SUCCESS":if(void 0!==purchaseResult.item_id&&null!==purchaseResult){var boughtItem=catalog.findItemById(purchaseResult.item_id);playerAccount.inventory.push(boughtItem)}playerAccount.currentBalance=purchaseResult.current_balance,updateCurrentBalance(),customizer.boughtItem();break;case"INSUFFICIENT_FUNDS":openAlertDialog("Need More Eggs!","You need more eggs",{label:"OK",width:"4em",onclick:closeAlertDialog},null,null);break;case"ALREADY_OWNED":openAlertDialog("Already Owned","You already have this. Try reloading the game.",{label:"OK",width:"4em",onclick:closeAlertDialog},null,null);break;case"PLAYER_NOT_FOUND":openAlertDialog("Uh Oh","There was a problem. Try logging in again.",{label:"OK",width:"4em",onclick:closeAlertDialog},null,null);break;case"ITEM_NOT_FOUND":openAlertDialog("Uh Oh","There was a problem. Try reloading the game.",{label:"OK",width:"4em",onclick:closeAlertDialog},null,null);break;case"ERROR":default:console.log("buyItem error: "+purchaseResult.error),openAlertDialog("Uh Oh","There was a problem. Try reloading the game.",{label:"OK",width:"4em",onclick:closeAlertDialog},null,null)}servicesWs.close()},servicesWs.onclose=function(e){console.log("servicesWs closed: "+e.code+" "+e.reason)},servicesWs.onerror=function(e){statsEl.innerHTML='<p style="text-align: left">WebSocket connection failure. Please check your connection at:<br><a href="http://websocketstest.com" target="_window">websocketstest.com</a><br>as well as your firewall and antivirus settings.</p>',console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"]))}},buyEggs:function(){purchasingEnabled?XPayStationWidget.open():getXsollaToken()},openRedeemCodeDialog:function(){showDarkOverlay(),document.getElementById("redeemCodeDialog").style.display="inline-block";var redeemCodeInput=document.getElementById("redeemCodeInput");redeemCodeInput.value="",redeemCodeInput.disabled=!1,document.getElementById("enterRedeemCode").style.display="inline-block",document.getElementById("redeemCodeResult").style.display="none",document.exitPointerLock(),window.onkeydown=null,window.onkeyup=null},closeRedeemCodeDialog:function(){document.getElementById("redeemCodeDialog").style.display="none",hideDarkOverlay()},redeemCode:function(){console.log("redeem code called");try{var servicesWs=new WebSocket(servicesServer)}catch(e){console.log(e)}var redeemCodeInput=document.getElementById("redeemCodeInput");redeemCodeInput.disbled=!0;var code=redeemCodeInput.value;code&&0!=code.length&&(servicesWs.onopen=function(e){servicesWs.send(JSON.stringify({cmd:"redeem",uid:playerAccount.firebaseId,code:code}))},servicesWs.onmessage=function(e){if(redeemResult=JSON.parse(e.data),redeemResult.error)console.log("redeemCode Error: "+JSON.stringify(redeemResult.error));else{console.log("redeemCode response: "+redeemResult.result);var redeemCodeResultText=document.getElementById("redeemCodeResultText"),redeemCodeSuccessButton=document.getElementById("redeemCodeCompleteButton");switch(document.getElementById("enterRedeemCode").style.display="none",document.getElementById("redeemCodeResult").style.display="inline-block",redeemResult.result){case"SUCCESS":if(redeemResult.item_ids)for(var i=0;i<redeemResult.item_ids.length;i++){var redeemedItem=catalog.findItemById(redeemResult.item_ids[i]);playerAccount.isItemOwned(redeemedItem)||playerAccount.inventory.push(redeemedItem)}redeemCodeResultText.innerHTML="<h1>CODE CRACKED!!</h1><div>Your new gear is ready to use</div>",redeemCodeSuccessButton.style="ssbutton green";break;case"CODE_PREV_REDEEMED":redeemCodeResultText.innerText="That code has already been used!",redeemCodeSuccessButton.style="ssbutton red";break;case"CODE_NOT_FOUND":redeemCodeResultText.innerText="Invalid code",redeemCodeSuccessButton.style="ssbutton red";break;case"ERROR":console.log("error: "+redeemResult.error),redeemCodeResultText.innerText="Uh oh, there was problem",redeemCodeSuccessButton.style="ssbutton red";break;default:redeemCodeResultText.innerText="Uh oh, there was problem. Try logging in again.",redeemCodeSuccessButton.style="ssbutton red"}}servicesWs.close()},servicesWs.onclose=function(e){console.log("servicesWs closed: "+e.code+" "+e.reason)},servicesWs.onerror=function(e){statsEl.innerHTML='<p style="text-align: left">WebSocket connection failure. Please check your connection at:<br><a href="http://websocketstest.com" target="_window">websocketstest.com</a><br>as well as your firewall and antivirus settings.</p>',console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"]))})},testAddBalance:function(amount){},openItemInCustomizer:openItemInCustomizer,openTaggedItemsInCustomizer:function(tag){playerAccount.isLoggedIn?(openCustomizerFromMainMenu(),customizer.openToTaggedItems(tag)):promoteLogin()},physicalUnlockOpenStore:physicalUnlockOpenStore}}();